import{r as Te,ar as Ci,bs as Ae,g as zh,bt as sU,bu as Ou,_ as AB,a$ as aU,j as Yc,c as gB,b7 as mB,bc as yB,J as G_,bv as vB,b3 as cU,L as lU,ao as uU,bw as hU,bx as _B}from"./index-C08LT-R7.js";import{_ as ho,C as fU}from"./slicedToArray-wWrld5kI.js";import{a as Lu,b as Fu,_ as j_,c as gd,d as V_}from"./inherits-D1oDQOuG.js";import{E as bB,w as dU}from"./withFullScreenWrapper-C6OFHNq5.js";import{T as pU,a as AU}from"./Toolbar-KmsdFNjA.js";import{u as gU}from"./useBasicWidgetState-DZWY5hj-.js";import{u as mU,s as yU}from"./threshold-CT01Jj2z.js";function vU(e,t){for(var i=0;i<t.length;i++){const n=t[i];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in e)){const s=Object.getOwnPropertyDescriptor(n,r);s&&Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function Um(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const H_=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),xB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);xB&&parseFloat(xB[1]);const wB=globalThis,CB=globalThis.process||{};function _U(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function W_(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||_U()}const EB="4.0.7";function bU(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let xU=class{constructor(e,t,i="sessionStorage"){this.storage=bU(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function wU(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function CU(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var zm;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(zm||(zm={}));const EU=10;function BB(e){return typeof e!="string"?e:(e=e.toUpperCase(),zm[e]||zm.WHITE)}function BU(e,t,i){return!W_&&typeof e=="string"&&(t&&(e=`\x1B[${BB(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${BB(i)+EU}m${e}\x1B[49m`)),e}function TU(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(c=>s===c)||(r[s]=o.bind(e)))}}function J_(e,t){if(!e)throw new Error("Assertion failed")}function md(){let e;if(W_()&&wB.performance)e=wB?.performance?.now?.();else if("hrtime"in CB){const t=CB?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}const yd={debug:W_()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},SU={enabled:!0,level:0};function vd(){}const TB={},SB={once:!0};let IB=class{constructor({id:e}={id:""}){this.VERSION=EB,this._startTs=md(),this._deltaTs=md(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new xU(`__probe-${this.id}__`,SU),this.timeStamp(`${this.id} started`),TU(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((md()-this._startTs).toPrecision(10))}getDelta(){return Number((md()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,yd.warn,arguments,SB)}error(e){return this._getLogFunction(0,e,yd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,yd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,yd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,yd.debug||yd.info,arguments,SB)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||vd,i&&[i],{tag:MU(t)}):vd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||vd)}group(e,t,i={collapsed:!1}){const n=PB({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||vd)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=MB(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=PB({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,J_(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=md();const s=r.tag||r.message;if(r.once&&s)if(!TB[s])TB[s]=md();else return vd;return t=IU(this.id,r.message,r),i.bind(console,t,...r.args)}return vd}};IB.VERSION=EB;function MB(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return J_(Number.isFinite(t)&&t>=0),t}function PB(e){const{logLevel:t,message:i}=e;e.logLevel=MB(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return J_(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function IU(e,t,i){if(typeof t=="string"){const n=i.time?CU(wU(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=BU(t,i.color,i.background)}return t}function MU(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const X_="4.3.1",PU=X_[0]>="0"&&X_[0]<="9"?`v${X_}`:"";function RU(){const e=new IB({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=PU,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const DU=RU();function OU(e,t){return RB(e||{},t)}function RB(e,t,i=0){if(i>3)return t;const n={...e};for(const[r,s]of Object.entries(t))s&&typeof s=="object"&&!Array.isArray(s)?n[r]=RB(n[r]||{},t[r],i+1):n[r]=t[r];return n}const LU="latest";function FU(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const kU=FU();function ku(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Gh=typeof process!="object"||String(process)!=="[object process]"||process.browser,NU=typeof window<"u"&&typeof window.orientation<"u",DB=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);DB&&parseFloat(DB[1]);let UU=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ku(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ku(this.isRunning),this.isRunning=!1,this._reject(e)}},Q_=class{terminate(){}};const K_=new Map;function zU(e){ku(e.source&&!e.url||!e.source&&e.url);let t=K_.get(e.source||e.url);return t||(e.url&&(t=GU(e.url),K_.set(e.url,t)),e.source&&(t=OB(e.source),K_.set(e.source,t))),ku(t),t}function GU(e){if(!e.startsWith("http"))return e;const t=jU(e);return OB(t)}function OB(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function jU(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function LB(e,t=!0,i){const n=i||new Set;if(e){if(FB(e))n.add(e);else if(FB(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&typeof e=="object")for(const r in e)LB(e[r],t,n)}return i===void 0?Array.from(n):[]}function FB(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const q_=()=>{};let Z_=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Gh||typeof Q_<"u"&&!Gh}constructor(e){const{name:t,source:i,url:n}=e;ku(i||n),this.name=t,this.source=i,this.url=n,this.onMessage=q_,this.onError=r=>console.log(r),this.worker=Gh?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=q_,this.onError=q_,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||LB(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=zU({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Q_(t,{eval:!1})}else if(this.source)e=new Q_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}},VU=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return Z_.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(n,r,s)=>n.done(s),i=(n,r)=>n.error(r)){const n=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:r}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new UU(t.name,e);e.onMessage=n=>t.onMessage(i,n.type,n.payload),e.onError=n=>t.onError(i,n),t.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Gh||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Z_({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return NU?this.maxMobileConcurrency:this.maxConcurrency}};const HU={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};let kB=class tA{props;workerPools=new Map;static _workerFarm;static isSupported(){return Z_.isSupported()}static getWorkerFarm(t={}){return tA._workerFarm=tA._workerFarm||new tA({}),tA._workerFarm.setProps(t),tA._workerFarm}constructor(t){this.props={...HU},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:i,source:n,url:r}=t;let s=this.workerPools.get(i);return s||(s=new VU({name:i,source:n,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function WU(e,t={}){const i=t[e.id]||{},n=Gh?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=i.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(Gh?r=`modules/${e.module}/dist/${n}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let s=e.version;s==="latest"&&(s=LU);const o=s?`@${s}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${n}`}return ku(r),r}function JU(e,t=kU){ku(e,"no worker provided");const i=e.version;return!(!t||!i)}const Nu={};function XU(e,t){return!kB.isSupported()||!Gh&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function QU(e,t,i,n,r){const s=e.id,o=WU(e,i),c=kB.getWorkerFarm(i).getWorkerPool({name:s,url:o});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const h=await c.startJob("process-on-worker",KU.bind(null,r));return h.postMessage("process",{input:t,options:i,context:n}),await(await h.result).result}async function KU(e,t,i,n){switch(i){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:r,input:s,options:o}=n;try{const c=await e(s,o);t.postMessage("done",{id:r,result:c})}catch(c){const h=c instanceof Error?c.message:"unknown error";t.postMessage("error",{id:r,error:h})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function qU(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0}function ZU(...e){return YU(e)}function YU(e){const t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=t.reduce((s,o)=>s+o.byteLength,0),n=new Uint8Array(i);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n.buffer}async function $U(e){const t=[];for await(const i of e)t.push(i);return ZU(...t)}let tz="";const NB={};function ez(e){for(const t in NB)if(e.startsWith(t)){const i=NB[t];e=e.replace(t,i)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${tz}${e}`),e}function iz(e){return e&&typeof e=="object"&&e.isBuffer}function UB(e){if(iz(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function zB(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function nz(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const rz=e=>typeof e=="boolean",kA=e=>typeof e=="function",NA=e=>e!==null&&typeof e=="object",GB=e=>NA(e)&&e.constructor==={}.constructor,oz=e=>!!e&&typeof e[Symbol.iterator]=="function",sz=e=>e&&typeof e[Symbol.asyncIterator]=="function",jh=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Vh=e=>typeof Blob<"u"&&e instanceof Blob,az=e=>e&&typeof e=="object"&&e.isBuffer,cz=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||NA(e)&&kA(e.tee)&&kA(e.cancel)&&kA(e.getReader),lz=e=>NA(e)&&kA(e.read)&&kA(e.pipe)&&rz(e.readable),jB=e=>cz(e)||lz(e);let uz=class extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response};const hz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,fz=/^([-\w.]+\/[-\w.+]+)/;function VB(e,t){return e.toLowerCase()===t.toLowerCase()}function dz(e){const t=fz.exec(e);return t?t[1]:e}function HB(e){const t=hz.exec(e);return t?t[1]:""}const WB=/\?.*/;function pz(e){const t=e.match(WB);return t&&t[0]}function Y_(e){return e.replace(WB,"")}function Az(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function Gm(e){return jh(e)?e.url:Vh(e)?e.name||"":typeof e=="string"?e:""}function $_(e){if(jh(e)){const t=e,i=t.headers.get("content-type")||"",n=Y_(t.url);return dz(i)||HB(n)}return Vh(e)?e.type||"":typeof e=="string"?HB(e):""}function gz(e){return jh(e)?e.headers["content-length"]||-1:Vh(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function JB(e){if(jh(e))return e;const t={},i=gz(e);i>=0&&(t["content-length"]=String(i));const n=Gm(e),r=$_(e);r&&(t["content-type"]=r);const s=await vz(e);s&&(t["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:n}),o}async function mz(e){if(!e.ok)throw await yz(e)}async function yz(e){const t=Az(e.url);let i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:e.statusText,url:e.url,response:e};try{const r=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&r?.includes("application/json")?await e.json():await e.text()}catch{}return new uz(i,n)}async function vz(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=r=>i(r?.target?.result),n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=e.slice(0,5);return`data:base64,${_z(t)}`}return null}function _z(e){let t="";const i=new Uint8Array(e);for(let n=0;n<i.byteLength;n++)t+=String.fromCharCode(i[n]);return btoa(t)}function bz(e){return!xz(e)&&!wz(e)}function xz(e){return e.startsWith("http:")||e.startsWith("https:")}function wz(e){return e.startsWith("data:")}async function XB(e,t){if(typeof e=="string"){const i=ez(e);return bz(i)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(i,t):await fetch(i,t)}return await JB(e)}const QB=globalThis,KB=globalThis.process||{};function Cz(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function t1(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Cz()}const qB="4.0.7";function Ez(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let Bz=class{constructor(e,t,i="sessionStorage"){this.storage=Ez(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function Tz(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function Sz(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var jm;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(jm||(jm={}));const Iz=10;function ZB(e){return typeof e!="string"?e:(e=e.toUpperCase(),jm[e]||jm.WHITE)}function Mz(e,t,i){return!t1&&typeof e=="string"&&(t&&(e=`\x1B[${ZB(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${ZB(i)+Iz}m${e}\x1B[49m`)),e}function Pz(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(c=>s===c)||(r[s]=o.bind(e)))}}function e1(e,t){if(!e)throw new Error("Assertion failed")}function _d(){let e;if(t1()&&QB.performance)e=QB?.performance?.now?.();else if("hrtime"in KB){const t=KB?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}const bd={debug:t1()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Rz={enabled:!0,level:0};function xd(){}const YB={},$B={once:!0};let tT=class{constructor({id:e}={id:""}){this.VERSION=qB,this._startTs=_d(),this._deltaTs=_d(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Bz(`__probe-${this.id}__`,Rz),this.timeStamp(`${this.id} started`),Pz(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((_d()-this._startTs).toPrecision(10))}getDelta(){return Number((_d()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,bd.warn,arguments,$B)}error(e){return this._getLogFunction(0,e,bd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,bd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,bd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,bd.debug||bd.info,arguments,$B)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||xd,i&&[i],{tag:Oz(t)}):xd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||xd)}group(e,t,i={collapsed:!1}){const n=iT({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||xd)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=eT(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=iT({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,e1(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=_d();const s=r.tag||r.message;if(r.once&&s)if(!YB[s])YB[s]=_d();else return xd;return t=Dz(this.id,r.message,r),i.bind(console,t,...r.args)}return xd}};tT.VERSION=qB;function eT(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return e1(Number.isFinite(t)&&t>=0),t}function iT(e){const{logLevel:t,message:i}=e;e.logLevel=eT(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return e1(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function Dz(e,t,i){if(typeof t=="string"){const n=i.time?Sz(Tz(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=Mz(t,i.color,i.background)}return t}function Oz(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const nT=new tT({id:"loaders.gl"});let Lz=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},Fz=class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};const rT={fetch:null,mimeType:void 0,nothrow:!1,log:new Fz,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:H_,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kz={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function oT(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function sT(){const e=oT();return e.globalOptions=e.globalOptions||{...rT},e.globalOptions}function Nz(e,t,i,n){return i=i||[],i=Array.isArray(i)?i:[i],Uz(e,i),Gz(t,e,n)}function Uz(e,t){aT(e,null,rT,kz,t);for(const i of t){const n=e&&e[i.id]||{},r=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};aT(n,i.id,r,s,t)}}function aT(e,t,i,n,r){const s=t||"Top level",o=t?`${t}.`:"";for(const c in e){const h=!t&&NA(e[c]),A=c==="baseUri"&&!t,_=c==="workerUrl"&&t;if(!(c in i)&&!A&&!_){if(c in n)nT.warn(`${s} loader option '${o}${c}' no longer supported, use '${n[c]}'`)();else if(!h){const C=zz(c,r);nT.warn(`${s} loader option '${o}${c}' not recognized. ${C}`)()}}}}function zz(e,t){const i=e.toLowerCase();let n="";for(const r of t)for(const s in r.options){if(e===s)return`Did you mean '${r.id}.${s}'?`;const o=s.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(n=n||`Did you mean '${r.id}.${s}'?`)}return n}function Gz(e,t,i){const n={...e.options||{}};return jz(n,i),n.log===null&&(n.log=new Lz),cT(n,sT()),cT(n,t),n}function cT(e,t){for(const i in t)if(i in t){const n=t[i];GB(n)&&GB(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i]}}function jz(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function i1(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function n1(e){Um(e,"null loader"),Um(i1(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const lT=()=>{const e=oT();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Vz(e){const t=lT();e=Array.isArray(e)?e:[e];for(const i of e){const n=n1(i);t.find(r=>n===r)||t.unshift(n)}}function Hz(){return lT()}const Wz=/\.([^.]+)$/;async function Jz(e,t=[],i,n){if(!hT(e))return null;let r=uT(e,t,{...i,nothrow:!0},n);if(r)return r;if(Vh(e)&&(e=await e.slice(0,10).arrayBuffer(),r=uT(e,t,i,n)),!r&&!i?.nothrow)throw new Error(fT(e));return r}function uT(e,t=[],i,n){if(!hT(e))return null;if(t&&!Array.isArray(t))return n1(t);let r=[];t&&(r=r.concat(t)),i?.ignoreRegisteredLoaders||r.push(...Hz()),Qz(r);const s=Xz(e,r,i,n);if(!s&&!i?.nothrow)throw new Error(fT(e));return s}function Xz(e,t,i,n){const r=Gm(e),s=$_(e),o=Y_(r)||n?.url;let c=null,h="";return i?.mimeType&&(c=r1(t,i?.mimeType),h=`match forced by supplied MIME type ${i?.mimeType}`),c=c||Kz(t,o),h=h||(c?`matched url ${o}`:""),c=c||r1(t,s),h=h||(c?`matched MIME type ${s}`:""),c=c||Zz(t,e),h=h||(c?`matched initial data ${pT(e)}`:""),i?.fallbackMimeType&&(c=c||r1(t,i?.fallbackMimeType),h=h||(c?`matched fallback MIME type ${s}`:"")),h&&DU.log(1,`selectLoader selected ${c?.name}: ${h}.`),c}function hT(e){return!(e instanceof Response&&e.status===204)}function fT(e){const t=Gm(e),i=$_(e);let n="No valid loader found (";n+=t?`${zB(t)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const r=e?pT(e):"";return n+=r?` first bytes: "${r}"`:"first bytes: not available",n+=")",n}function Qz(e){for(const t of e)n1(t)}function Kz(e,t){const i=t&&Wz.exec(t),n=i&&i[1];return n?qz(e,n):null}function qz(e,t){t=t.toLowerCase();for(const i of e)for(const n of i.extensions)if(n.toLowerCase()===t)return i;return null}function r1(e,t){for(const i of e)if(i.mimeTypes?.some(n=>VB(t,n))||VB(t,`application/x.${i.id}`))return i;return null}function Zz(e,t){if(!t)return null;for(const i of e)if(typeof t=="string"){if(Yz(t,i))return i}else if(ArrayBuffer.isView(t)){if(dT(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&dT(t,0,i))return i;return null}function Yz(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>e.startsWith(i))}function dT(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(n=>$z(e,t,i,n))}function $z(e,t,i,n){if(n instanceof ArrayBuffer)return qU(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":const r=o1(e,t,n.length);return n===r;default:return!1}}function pT(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?o1(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?o1(e,0,t):""}function o1(e,t,i){if(e.byteLength<t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}const tG=256*1024;function*eG(e,t){const i=t?.chunkSize||tG;let n=0;const r=new TextEncoder;for(;n<e.length;){const s=Math.min(e.length-n,i),o=e.slice(n,n+s);n+=s,yield r.encode(o)}}const iG=256*1024;function*nG(e,t={}){const{chunkSize:i=iG}=t;let n=0;for(;n<e.byteLength;){const r=Math.min(e.byteLength-n,i),s=new ArrayBuffer(r),o=new Uint8Array(e,n,r);new Uint8Array(s).set(o),n+=r,yield s}}const rG=1024*1024;async function*oG(e,t){const i=t?.chunkSize||rG;let n=0;for(;n<e.size;){const r=n+i,s=await e.slice(n,r).arrayBuffer();n=r,yield s}}function AT(e,t){return H_?sG(e,t):aG(e)}async function*sG(e,t){const i=e.getReader();let n;try{for(;;){const r=n||i.read();t?._streamReadAhead&&(n=i.read());const{done:s,value:o}=await r;if(s)return;yield UB(o)}}catch{i.releaseLock()}}async function*aG(e,t){for await(const i of e)yield UB(i)}function cG(e,t){if(typeof e=="string")return eG(e,t);if(e instanceof ArrayBuffer)return nG(e,t);if(Vh(e))return oG(e,t);if(jB(e))return AT(e,t);if(jh(e))return AT(e.body,t);throw new Error("makeIterator")}const gT="Cannot convert supplied data type";function lG(e,t,i){if(t.text&&typeof e=="string")return e;if(az(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(gT)}async function uG(e,t,i){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return lG(e,t);if(Vh(e)&&(e=await JB(e)),jh(e)){const r=e;return await mz(r),t.binary?await r.arrayBuffer():await r.text()}if(jB(e)&&(e=cG(e,i)),oz(e)||sz(e))return $U(e);throw new Error(gT)}function mT(e,t){const i=sT(),n=e||i;return typeof n.fetch=="function"?n.fetch:NA(n.fetch)?r=>XB(r,n.fetch):t?.fetch?t?.fetch:XB}function hG(e,t,i){if(i)return i;const n={fetch:mT(t,e),...e};if(n.url){const r=Y_(n.url);n.baseUrl=r,n.queryString=pz(n.url),n.filename=zB(r),n.baseUrl=nz(r)}return Array.isArray(n.loaders)||(n.loaders=null),n}function fG(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function Vm(e,t,i,n){t&&!Array.isArray(t)&&!i1(t)&&(n=void 0,i=t,t=void 0),e=await e,i=i||{};const r=Gm(e),s=fG(t,n),o=await Jz(e,s,i);return o?(i=Nz(i,o,s,r),n=hG({url:r,_parse:Vm,loaders:s},i,n||null),await dG(o,e,i,n)):null}async function dG(e,t,i,n){if(JU(e),i=OU(e.options,i),jh(t)){const s=t,{ok:o,redirected:c,status:h,statusText:A,type:_,url:C}=s,S=Object.fromEntries(s.headers.entries());n.response={headers:S,ok:o,redirected:c,status:h,statusText:A,type:_,url:C}}t=await uG(t,e,i);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,i,n);if(XU(e,i))return await QU(e,t,i,n,Vm);if(r.parseText&&typeof t=="string")return await r.parseText(t,i,n);if(r.parse)return await r.parse(t,i,n);throw ku(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function s1(e,t,i,n){let r,s;!Array.isArray(t)&&!i1(t)?(r=[],s=t):(r=t,s=i);const o=mT(s);let c=e;return typeof e=="string"&&(c=await o(e)),Vh(e)&&(c=await o(e)),Array.isArray(r)?await Vm(c,r,s):await Vm(c,r,s)}const pG="4.3.1",AG=globalThis.loaders?.parseImageNode,a1=typeof Image<"u",c1=typeof ImageBitmap<"u",gG=!!AG,l1=H_?!0:gG;function mG(e){switch(e){case"auto":return c1||a1||l1;case"imagebitmap":return c1;case"image":return a1;case"data":return l1;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function yG(){if(c1)return"imagebitmap";if(a1)return"image";if(l1)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function vG(e){const t=bG(e);if(!t)throw new Error("Not an image");return t}function _G(e){switch(vG(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function bG(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const xG=/^data:image\/svg\+xml/,wG=/\.svg((\?|#).*)?$/;function u1(e){return e&&(xG.test(e)||wG.test(e))}function CG(e,t){if(u1(t)){let i=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return yT(e,t)}function yT(e,t){if(u1(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function vT(e,t,i){const n=CG(e,i),r=self.URL||self.webkitURL,s=typeof n!="string"&&r.createObjectURL(n);try{return await EG(s||n,t)}finally{s&&r.revokeObjectURL(s)}}async function EG(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=s=>{const o=s instanceof Error?s.message:"error";r(new Error(o))}}catch(s){r(s)}})}const BG={};let _T=!0;async function TG(e,t,i){let n;u1(i)?n=await vT(e,t,i):n=yT(e,i);const r=t&&t.imagebitmap;return await SG(n,r)}async function SG(e,t=null){if((IG(t)||!_T)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(i){console.warn(i),_T=!1}return await createImageBitmap(e)}function IG(e){for(const t in e||BG)return!1;return!0}function MG(e){return!OG(e,"ftyp",4)||(e[8]&96)===0?null:PG(e)}function PG(e){switch(RG(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function RG(e,t,i){return String.fromCharCode(...e.slice(t,i))}function DG(e){return[...e].map(t=>t.charCodeAt(0))}function OG(e,t,i=0){const n=DG(t);for(let r=0;r<n.length;++r)if(n[r]!==e[r+i])return!1;return!0}const $c=!1,UA=!0;function bT(e){const t=zA(e);return FG(t)||UG(t)||kG(t)||NG(t)||LG(t)}function LG(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),i=MG(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}function FG(e){const t=zA(e);return t.byteLength>=24&&t.getUint32(0,$c)===2303741511?{mimeType:"image/png",width:t.getUint32(16,$c),height:t.getUint32(20,$c)}:null}function kG(e){const t=zA(e);return t.byteLength>=10&&t.getUint32(0,$c)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,UA),height:t.getUint16(8,UA)}:null}function NG(e){const t=zA(e);return t.byteLength>=14&&t.getUint16(0,$c)===16973&&t.getUint32(2,UA)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,UA),height:t.getUint32(22,UA)}:null}function UG(e){const t=zA(e);if(!(t.byteLength>=3&&t.getUint16(0,$c)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=zG();let r=2;for(;r+9<t.byteLength;){const s=t.getUint16(r,$c);if(n.has(s))return{mimeType:"image/jpeg",height:t.getUint16(r+5,$c),width:t.getUint16(r+7,$c)};if(!i.has(s))return null;r+=2,r+=t.getUint16(r,$c)}return null}function zG(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function zA(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function GG(e,t){const{mimeType:i}=bT(e)||{},n=globalThis.loaders?.parseImageNode;return Um(n),await n(e,i)}async function jG(e,t,i){t=t||{};const n=(t.image||{}).type||"auto",{url:r}=i||{},s=VG(n);let o;switch(s){case"imagebitmap":o=await TG(e,t,r);break;case"image":o=await vT(e,t,r);break;case"data":o=await GG(e);break;default:Um(!1)}return n==="data"&&(o=_G(o)),o}function VG(e){switch(e){case"auto":case"data":return yG();default:return mG(e),e}}const HG=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],WG=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],JG={image:{type:"auto",decode:!0}},XG={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:pG,mimeTypes:WG,extensions:HG,parse:jG,tests:[e=>!!bT(new DataView(e))],options:JG},Hm=globalThis,Wm=globalThis.process||{},QG=globalThis.navigator||{};function xT(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function tl(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||xT()}function KG(e){return tl()?xT()?"Electron":(QG.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Jm="4.1.0";function qG(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let ZG=class{constructor(e,t,i="sessionStorage"){this.storage=qG(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function YG(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function $G(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var Xm;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Xm||(Xm={}));const t7=10;function wT(e){return typeof e!="string"?e:(e=e.toUpperCase(),Xm[e]||Xm.WHITE)}function e7(e,t,i){return!tl&&typeof e=="string"&&(t&&(e=`\x1B[${wT(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${wT(i)+t7}m${e}\x1B[49m`)),e}function i7(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(c=>s===c)||(r[s]=o.bind(e)))}}function h1(e,t){if(!e)throw new Error("Assertion failed")}function wd(){let e;if(tl()&&Hm.performance)e=Hm?.performance?.now?.();else if("hrtime"in Wm){const t=Wm?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}const Cd={debug:tl()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},n7={enabled:!0,level:0};function Ed(){}const CT={},ET={once:!0};let BT=class{constructor({id:e}={id:""}){this.VERSION=Jm,this._startTs=wd(),this._deltaTs=wd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new ZG(`__probe-${this.id}__`,n7),this.timeStamp(`${this.id} started`),i7(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wd()-this._startTs).toPrecision(10))}getDelta(){return Number((wd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Cd.warn,arguments,ET)}error(e){return this._getLogFunction(0,e,Cd.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Cd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Cd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Cd.debug||Cd.info,arguments,ET)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Ed,i&&[i],{tag:o7(t)}):Ed}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Ed)}group(e,t,i={collapsed:!1}){const n=ST({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ed)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=TT(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=ST({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,h1(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=wd();const s=r.tag||r.message;if(r.once&&s)if(!CT[s])CT[s]=wd();else return Ed;return t=r7(this.id,r.message,r),i.bind(console,t,...r.args)}return Ed}};BT.VERSION=Jm;function TT(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return h1(Number.isFinite(t)&&t>=0),t}function ST(e){const{logLevel:t,message:i}=e;e.logLevel=TT(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return h1(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function r7(e,t,i){if(typeof t=="string"){const n=i.time?$G(YG(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=e7(t,i.color,i.background)}return t}function o7(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const Zi=new BT({id:"deck"});let f1={};function s7(e){f1=e}function fs(e,t,i,n){Zi.level>0&&f1[e]&&f1[e].call(null,t,i,n)}function a7(e){const t=e[0],i=e[e.length-1];return t==="{"&&i==="}"||t==="["&&i==="]"}const c7={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:a7,parseTextSync:JSON.parse};function l7(){const e="9.1.14",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(Zi.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:Zi,_registerLoggers:s7},Vz([c7,[XG,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}const u7=l7();function d1(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const p1={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function h7(e){const t={};for(const[i,n]of Object.entries(e))t[i]=f7(n);return t}function f7(e){let t=IT(e);if(t!=="object")return{value:e,...p1[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...p1[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=IT(e.value),{...e,...p1[t],type:t}):{type:"object",value:null};throw new Error("props")}function IT(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const d7=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,p7=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,A7={vertex:d7,fragment:p7},MT=/void\s+main\s*\([^)]*\)\s*\{\n?/,PT=/}\n?[^{}]*$/,A1=[],Qm="__LUMA_INJECT_DECLARATIONS__";function g7(e){const t={vertex:{},fragment:{}};for(const i in e){let n=e[i];const r=m7(i);typeof n=="string"&&(n={order:0,injection:n}),t[r][i]=n}return t}function m7(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Km(e,t,i,n=!1){const r=t==="vertex";for(const s in i){const o=i[s];o.sort((h,A)=>h.order-A.order),A1.length=o.length;for(let h=0,A=o.length;h<A;++h)A1[h]=o[h].injection;const c=`${A1.join(`
`)}
`;switch(s){case"vs:#decl":r&&(e=e.replace(Qm,c));break;case"vs:#main-start":r&&(e=e.replace(MT,h=>h+c));break;case"vs:#main-end":r&&(e=e.replace(PT,h=>c+h));break;case"fs:#decl":r||(e=e.replace(Qm,c));break;case"fs:#main-start":r||(e=e.replace(MT,h=>h+c));break;case"fs:#main-end":r||(e=e.replace(PT,h=>c+h));break;default:e=e.replace(s,h=>h+c)}}return e=e.replace(Qm,""),n&&(e=e.replace(/\}\s*$/,s=>s+A7[t])),e}function qm(e){e.map(t=>RT(t))}function RT(e){if(e.instance)return;qm(e.dependencies||[]);const{propTypes:t={},deprecations:i=[],inject:n={}}=e,r={normalizedInjections:g7(n),parsedDeprecations:y7(i)};t&&(r.propValidators=h7(t)),e.instance=r;let s={};t&&(s=Object.entries(t).reduce((o,[c,h])=>{const A=h?.value;return A&&(o[c]=A),o},{})),e.defaultUniforms={...e.defaultUniforms,...s}}function DT(e,t,i){e.deprecations?.forEach(n=>{n.regex?.test(t)&&(n.deprecated?i.deprecated(n.old,n.new)():i.removed(n.old,n.new)())})}function y7(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}function g1(e){qm(e);const t={},i={};OT({modules:e,level:0,moduleMap:t,moduleDepth:i});const n=Object.keys(i).sort((r,s)=>i[s]-i[r]).map(r=>t[r]);return qm(n),n}function OT(e){const{modules:t,level:i,moduleMap:n,moduleDepth:r}=e;if(i>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)n[s.name]=s,(r[s.name]===void 0||r[s.name]<i)&&(r[s.name]=i);for(const s of t)s.dependencies&&OT({modules:s.dependencies,level:i+1,moduleMap:n,moduleDepth:r})}function v7(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function _7(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=FT(e,b7),e;case"fragment":return e=FT(e,x7),e;default:throw new Error(t)}}const LT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],b7=[...LT,[m1("attribute"),"in $1"],[m1("varying"),"out $1"]],x7=[...LT,[m1("varying"),"in $1"]];function FT(e,t){for(const[i,n]of t)e=e.replace(i,n);return e}function m1(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function kT(e,t){let i="";for(const n in e){const r=e[n];if(i+=`void ${r.signature} {
`,r.header&&(i+=`  ${r.header}`),t[n]){const s=t[n];s.sort((o,c)=>o.order-c.order);for(const o of s)i+=`  ${o.injection}
`}r.footer&&(i+=`  ${r.footer}`),i+=`}
`}return i}function NT(e){const t={vertex:{},fragment:{}};for(const i of e){let n,r;typeof i!="string"?(n=i,r=n.hook):(n={},r=i),r=r.trim();const[s,o]=r.split(":"),c=r.replace(/\(.+/,""),h=Object.assign(n,{signature:o});switch(s){case"vs":t.vertex[c]=h;break;case"fs":t.fragment[c]=h;break;default:throw new Error(s)}}return t}function w7(e,t){return{name:C7(e,t),language:"glsl",version:E7(e)}}function C7(e,t="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return i?i[1]:t}function E7(e){let t=100;const i=e.match(/[^\s]+/g);if(i&&i.length>=2&&i[0]==="#version"){const n=parseInt(i[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}const UT=`

${Qm}
`,B7=`precision highp float;
`;function T7(e){const t=g1(e.modules||[]);return{source:I7(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:GT(t)}}function S7(e){const{vs:t,fs:i}=e,n=g1(e.modules||[]);return{vs:zT(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:zT(e.platformInfo,{...e,source:i,stage:"fragment",modules:n}),getUniforms:GT(n)}}function I7(e,t){const{source:i,stage:n,modules:r,hookFunctions:s=[],inject:o={},log:c}=t;d1(typeof i=="string","shader source must be a string");const h=i;let A="";const _=NT(s),C={},S={},L={};for(const U in o){const H=typeof o[U]=="string"?{injection:o[U],order:0}:o[U],j=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(j){const tt=j[2],K=j[3];tt?K==="decl"?S[U]=[H]:L[U]=[H]:C[U]=[H]}else L[U]=[H]}const N=r;for(const U of N){c&&DT(U,h,c);const H=jT(U,"wgsl");A+=H;const j=U.injections?.[n]||{};for(const tt in j){const K=/^(v|f)s:#([\w-]+)$/.exec(tt);if(K){const Q=K[2]==="decl"?S:L;Q[tt]=Q[tt]||[],Q[tt].push(j[tt])}else C[tt]=C[tt]||[],C[tt].push(j[tt])}}return A+=UT,A=Km(A,n,S),A+=kT(_[n],C),A+=h,A=Km(A,n,L),A}function zT(e,t){const{id:i,source:n,stage:r,language:s="glsl",modules:o,defines:c={},hookFunctions:h=[],inject:A={},prologue:_=!0,log:C}=t;d1(typeof n=="string","shader source must be a string");const S=s==="glsl"?w7(n).version:-1,L=e.shaderLanguageVersion,N=S===100?"#version 100":"#version 300 es",U=n.split(`
`).slice(1).join(`
`),H={};o.forEach($=>{Object.assign(H,$.defines)}),Object.assign(H,c);let j="";switch(s){case"wgsl":break;case"glsl":j=_?`${N}

// ----- PROLOGUE -------------------------
${M7({id:i,source:n,stage:r})}
${`#define SHADER_TYPE_${r.toUpperCase()}`}

${v7(e)}
${r==="fragment"?B7:""}

// ----- APPLICATION DEFINES -------------------------

${P7(H)}

`:`${N}
`;break}const tt=NT(h),K={},Q={},pt={};for(const $ in A){const zt=typeof A[$]=="string"?{injection:A[$],order:0}:A[$],Gt=/^(v|f)s:(#)?([\w-]+)$/.exec($);if(Gt){const dt=Gt[2],lt=Gt[3];dt?lt==="decl"?Q[$]=[zt]:pt[$]=[zt]:K[$]=[zt]}else pt[$]=[zt]}for(const $ of o){C&&DT($,U,C);const zt=jT($,r);j+=zt;const Gt=$.instance?.normalizedInjections[r]||{};for(const dt in Gt){const lt=/^(v|f)s:#([\w-]+)$/.exec(dt);if(lt){const Lt=lt[2]==="decl"?Q:pt;Lt[dt]=Lt[dt]||[],Lt[dt].push(Gt[dt])}else K[dt]=K[dt]||[],K[dt].push(Gt[dt])}}return j+="// ----- MAIN SHADER SOURCE -------------------------",j+=UT,j=Km(j,r,Q),j+=kT(tt[r],K),j+=U,j=Km(j,r,pt),s==="glsl"&&S!==L&&(j=_7(j,r)),j.trim()}function GT(e){return function(t){const i={};for(const n of e){const r=n.getUniforms?.(t,i);Object.assign(i,r)}return i}}function M7(e){const{id:t,source:i,stage:n}=e;return t&&i.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${t}_${n}`:""}function P7(e={}){let t="";for(const i in e){const n=e[i];(n||Number.isFinite(n))&&(t+=`#define ${i.toUpperCase()} ${e[i]}
`)}return t}function jT(e,t){let i;switch(t){case"vertex":i=e.vs||"";break;case"fragment":i=e.fs||"";break;case"wgsl":i=e.source||"";break;default:d1(!1)}if(!e.name)throw new Error("Shader module must have a name");const n=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let r=`// ----- MODULE ${e.name} ---------------

`;return t!=="wgsl"&&(r+=`#define MODULE_${n}
`),r+=`${i}
`,r}const R7=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,D7=/^\s*\#\s*endif\s*$/;function O7(e,t){const i=e.split(`
`),n=[];let r=!0,s=null;for(const o of i){const c=o.match(R7),h=o.match(D7);c?(s=c[1],r=!!t?.defines?.[s]):h?r=!0:r&&n.push(o)}return n.join(`
`)}class If{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return If.defaultShaderAssembler=If.defaultShaderAssembler||new If,If.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(i=>i.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){const i=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==i)}addShaderHook(t,i){i&&(t=Object.assign(i,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){const i=this._getModuleList(t.modules),n=this._hookFunctions,{source:r,getUniforms:s}=T7({...t,source:t.source,modules:i,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?O7(r):r,getUniforms:s,modules:i}}assembleGLSLShaderPair(t){const i=this._getModuleList(t.modules),n=this._hookFunctions;return{...S7({...t,vs:t.vs,fs:t.fs,modules:i,hookFunctions:n}),modules:i}}_getModuleList(t=[]){const i=new Array(this._defaultModules.length+t.length),n={};let r=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const c=this._defaultModules[s],h=c.name;i[r++]=c,n[h]=!0}for(let s=0,o=t.length;s<o;++s){const c=t[s],h=c.name;n[h]||(i[r++]=c,n[h]=!0)}return i.length=r,qm(i),i}}const L7=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,F7=`#version 300 es
${L7}`;function VT(e){const{input:t,inputChannels:i,output:n}=e||{};if(!t)return F7;if(!i)throw new Error("inputChannels");const r=k7(i),s=N7(t,i);return`#version 300 es
in ${r} ${t};
out vec4 ${n};
void main() {
  ${n} = ${s};
}`}function k7(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function N7(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}function HT(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let WT=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=HT(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(HT()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},U7=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof WT?n=e:n=new WT(t,i),this.stats[t]=n),n}};class z7{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new U7({id:t})),this.stats.get(t)}}const JT=new z7;function G7(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}let j7=class{constructor(e,t,i="sessionStorage"){this.storage=G7(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}};function V7(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function H7(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var Zm;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Zm||(Zm={}));const W7=10;function XT(e){return typeof e!="string"?e:(e=e.toUpperCase(),Zm[e]||Zm.WHITE)}function J7(e,t,i){return!tl&&typeof e=="string"&&(t&&(e=`\x1B[${XT(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${XT(i)+W7}m${e}\x1B[49m`)),e}function X7(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(c=>s===c)||(r[s]=o.bind(e)))}}function y1(e,t){if(!e)throw new Error("Assertion failed")}function Bd(){let e;if(tl()&&Hm.performance)e=Hm?.performance?.now?.();else if("hrtime"in Wm){const t=Wm?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}const Td={debug:tl()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Q7={enabled:!0,level:0};function Sd(){}const QT={},KT={once:!0};let qT=class{constructor({id:e}={id:""}){this.VERSION=Jm,this._startTs=Bd(),this._deltaTs=Bd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new j7(`__probe-${this.id}__`,Q7),this.timeStamp(`${this.id} started`),X7(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Bd()-this._startTs).toPrecision(10))}getDelta(){return Number((Bd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Td.warn,arguments,KT)}error(e){return this._getLogFunction(0,e,Td.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Td.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Td.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Td.debug||Td.info,arguments,KT)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Sd,i&&[i],{tag:q7(t)}):Sd}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Sd)}group(e,t,i={collapsed:!1}){const n=YT({logLevel:e,message:t,opts:i}),{collapsed:r}=i;return n.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Sd)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=ZT(e)}_getLogFunction(e,t,i,n,r){if(this._shouldLog(e)){r=YT({logLevel:e,message:t,args:n,opts:r}),i=i||r.method,y1(i),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Bd();const s=r.tag||r.message;if(r.once&&s)if(!QT[s])QT[s]=Bd();else return Sd;return t=K7(this.id,r.message,r),i.bind(console,t,...r.args)}return Sd}};qT.VERSION=Jm;function ZT(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return y1(Number.isFinite(t)&&t>=0),t}function YT(e){const{logLevel:t,message:i}=e;e.logLevel=ZT(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return y1(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function K7(e,t,i){if(typeof t=="string"){const n=i.time?H7(V7(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=J7(t,i.color,i.background)}return t}function q7(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}const $e=new qT({id:"luma.gl"}),v1={};function Ym(e="id"){v1[e]=v1[e]||1;const t=v1[e]++;return`${e}-${t}`}let pr=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=Z7(t,i);const n=this.props.id!=="undefined"?this.props.id:Ym(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function Z7(e,t){const i={...t};for(const n in e)e[n]!==void 0&&(i[n]=e[n]);return i}class Cr extends pr{static defaultProps={...pr.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,i){const n={...i};(i.usage||0)&Cr.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?n.indexType="uint32":i.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(t,n,Cr.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,i){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,i,n){const r=ArrayBuffer.isView(t)?t.buffer:t,s=Math.min(t?t.byteLength:n,Cr.DEBUG_DATA_MAX_LENGTH);r===null?this.debugData=new ArrayBuffer(s):i===0&&n===r.byteLength?this.debugData=r.slice(0,s):this.debugData=r.slice(i,i+s)}}function $T(e){const t=tS[e],i=Y7(t),n=e.includes("norm"),r=!n&&!e.startsWith("float"),s=e.startsWith("s");return{dataType:tS[e],byteLength:i,integer:r,signed:s,normalized:n}}function Y7(e){return $7[e]}const tS={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},$7={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},ds="texture-compression-bc",Ar="texture-compression-astc",el="texture-compression-etc2",tj="texture-compression-etc1-webgl",$m="texture-compression-pvrtc-webgl",_1="texture-compression-atc-webgl",t0="float32-renderable-webgl",b1="float16-renderable-webgl",ej="rgb9e5ufloat-renderable-webgl",x1="snorm8-renderable-webgl",GA="norm16-renderable-webgl",w1="snorm16-renderable-webgl",e0="float32-filterable",eS="float16-filterable-webgl";function iS(e){const t=ij[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}const ij={r8unorm:{},r8snorm:{render:x1},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:x1},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:b1,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:GA},"r16snorm-webgl":{f:w1},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:x1},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:b1,filter:eS},"rg16unorm-webgl":{render:GA},"rg16snorm-webgl":{render:w1},r32uint:{},r32sint:{},r32float:{render:t0,filter:e0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:ej},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:t0},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:GA},"rgb16snorm-webgl":{f:GA},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:e0},rgba16uint:{},rgba16sint:{},rgba16float:{render:b1,filter:eS},"rgba16unorm-webgl":{render:GA},"rgba16snorm-webgl":{render:w1},"rgb32float-webgl":{render:t0,filter:e0},rgba32uint:{},rgba32sint:{},rgba32float:{render:t0,filter:e0},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:ds},"bc1-rgb-unorm-srgb-webgl":{f:ds},"bc1-rgba-unorm":{f:ds},"bc1-rgba-unorm-srgb":{f:ds},"bc2-rgba-unorm":{f:ds},"bc2-rgba-unorm-srgb":{f:ds},"bc3-rgba-unorm":{f:ds},"bc3-rgba-unorm-srgb":{f:ds},"bc4-r-unorm":{f:ds},"bc4-r-snorm":{f:ds},"bc5-rg-unorm":{f:ds},"bc5-rg-snorm":{f:ds},"bc6h-rgb-ufloat":{f:ds},"bc6h-rgb-float":{f:ds},"bc7-rgba-unorm":{f:ds},"bc7-rgba-unorm-srgb":{f:ds},"etc2-rgb8unorm":{f:el},"etc2-rgb8unorm-srgb":{f:el},"etc2-rgb8a1unorm":{f:el},"etc2-rgb8a1unorm-srgb":{f:el},"etc2-rgba8unorm":{f:el},"etc2-rgba8unorm-srgb":{f:el},"eac-r11unorm":{f:el},"eac-r11snorm":{f:el},"eac-rg11unorm":{f:el},"eac-rg11snorm":{f:el},"astc-4x4-unorm":{f:Ar},"astc-4x4-unorm-srgb":{f:Ar},"astc-5x4-unorm":{f:Ar},"astc-5x4-unorm-srgb":{f:Ar},"astc-5x5-unorm":{f:Ar},"astc-5x5-unorm-srgb":{f:Ar},"astc-6x5-unorm":{f:Ar},"astc-6x5-unorm-srgb":{f:Ar},"astc-6x6-unorm":{f:Ar},"astc-6x6-unorm-srgb":{f:Ar},"astc-8x5-unorm":{f:Ar},"astc-8x5-unorm-srgb":{f:Ar},"astc-8x6-unorm":{f:Ar},"astc-8x6-unorm-srgb":{f:Ar},"astc-8x8-unorm":{f:Ar},"astc-8x8-unorm-srgb":{f:Ar},"astc-10x5-unorm":{f:Ar},"astc-10x5-unorm-srgb":{f:Ar},"astc-10x6-unorm":{f:Ar},"astc-10x6-unorm-srgb":{f:Ar},"astc-10x8-unorm":{f:Ar},"astc-10x8-unorm-srgb":{f:Ar},"astc-10x10-unorm":{f:Ar},"astc-10x10-unorm-srgb":{f:Ar},"astc-12x10-unorm":{f:Ar},"astc-12x10-unorm-srgb":{f:Ar},"astc-12x12-unorm":{f:Ar},"astc-12x12-unorm-srgb":{f:Ar},"pvrtc-rgb4unorm-webgl":{f:$m},"pvrtc-rgba4unorm-webgl":{f:$m},"pvrtc-rbg2unorm-webgl":{f:$m},"pvrtc-rgba2unorm-webgl":{f:$m},"etc1-rbg-unorm-webgl":{f:tj},"atc-rgb-unorm-webgl":{f:_1},"atc-rgba-unorm-webgl":{f:_1},"atc-rgbai-unorm-webgl":{f:_1}},nj=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],rj=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function nS(e){return nj.some(t=>e.startsWith(t))}function C1(e){let t=oj(e);if(nS(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;const n=sj(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}const i=rj.exec(e);if(i){const[,n,r,s,o,c]=i,h=`${s}${r}`,A=$T(h),_=A.byteLength*8,C=n.length,S=[_,C>=2?_:0,C>=3?_:0,C>=4?_:0];t={format:e,attachment:t.attachment,dataType:A.dataType,components:C,channels:n,integer:A.integer,signed:A.signed,normalized:A.normalized,bitsPerChannel:S,bytesPerPixel:A.byteLength*n.length,packed:t.packed,srgb:t.srgb},c==="-webgl"&&(t.webgl=!0),o==="-srgb"&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}function oj(e){const t=iS(e),i=t.bytesPerPixel||1,n=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:i,bitsPerChannel:n,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function sj(e){const t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){const[,i,n]=t;return{blockWidth:Number(i),blockHeight:Number(n)}}return null}function aj(e){const t=iS(e),i={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},n=C1(e),r=e.startsWith("depth")||e.startsWith("stencil"),s=n?.signed,o=n?.integer,c=n?.webgl;return i.render&&=!s,i.filter&&=!r&&!s&&!o&&!c,i}class cj{}class lj{features;disabledFeatures;constructor(t=[],i){this.features=new Set(t),this.disabledFeatures=i||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}}class dh{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:t=>$e.error(t.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:$e.get("debug")||void 0,debugShaders:$e.get("debug-shaders")||void 0,debugFramebuffers:!!$e.get("debug-framebuffers"),debugWebGL:!!$e.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(t){this.props={...dh.defaultProps,...t},this.id=this.props.id||Ym(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=JT;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(t){const i=aj(t),n=o=>(typeof o=="string"?this.features.has(o):o)??!0,r=n(i.create),s={format:t,create:r,render:r&&n(i.render),filter:r&&n(i.filter),blend:r&&n(i.blend),store:r&&n(i.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(t,i){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return nS(t)}loseDevice(){return!1}reportError(t){this.props.onError(t)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(t={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,i){throw new Error("not implemented")}readPixelsToBufferWebGL(t,i){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,i){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(t){return t.createCanvasContext===!0?{}:t.createCanvasContext}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const i={...t};return(t.usage||0)&Cr.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array?i.indexType="uint16":$e.warn("indices buffer content must be of integer type")()),i}}const uj=tl()&&typeof document<"u",hj=()=>uj&&document.readyState==="complete",fj="set luma.log.level=1 (or higher) to trace rendering",rS="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class eA{static defaultProps={...dh.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=dj().then(()=>{$e.probe(2,"DOM is loaded")()});stats=JT;log=$e;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw $e.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),$e.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");$e.error("This version of luma.gl has already been initialized")()}$e.log(1,`${this.VERSION} - ${fj}`)(),globalThis.luma=this}registerAdapters(t){for(const i of t)this.preregisteredAdapters.set(i.type,i)}getSupportedAdapters(t=[]){const i=this.getAdapterMap(t);return Array.from(i).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapter(t=[]){const i=this.getAdapterMap(t);return i.get("webgpu")?.isSupported?.()?"webgpu":i.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(t){Object.assign(eA.defaultProps,t)}async createDevice(t={}){t={...eA.defaultProps,...t},t.waitForPageLoad&&await eA.pageLoaded;const i=this.getAdapterMap(t.adapters);let n=t.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(t.adapters)||n);const r=await(this.getAdapterMap(t.adapters)||i).get(n)?.create?.(t);if(r)return r;throw new Error(rS)}async attachDevice(t){const i=this.getAdapterMap(t.adapters);let n="";t.handle instanceof WebGL2RenderingContext&&(n="webgl"),t.createCanvasContext&&await eA.pageLoaded,t.handle===null&&(n="unknown");const r=await i.get(n)?.attach?.(null);if(r)return r;throw new Error(rS)}enforceWebGL2(t=!0,i=[]){const n=this.getAdapterMap(i).get("webgl");n||$e.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(t)}getAdapterMap(t=[]){const i=new Map(this.preregisteredAdapters);for(const n of t)i.set(n.type,n);return i}registerDevices(t){$e.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const i of t){const n=i.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}}const E1=new eA;function dj(){return hj()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}class pj{}class BE{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...BE.defaultProps,...t},t=this.props,!tl()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=gj(t.canvas):this.canvas=t.canvas;else{const i=mj(t),n=Aj(t?.container||null);n.insertBefore(i,n.firstChild),this.canvas=i,t?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(i=>{for(const n of i)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),i=this.canvas;return i.parentElement?[i.clientWidth*t,i.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,i]=this.getPixelSize();return t/i}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),i=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return i?t/i:1}catch{return 1}}cssToDevicePixels(t,i=!0){const n=this.cssToDeviceRatio(),[r,s]=this.getDrawingBufferSize();return yj(t,n,r,s,i)}setDevicePixelRatio(t,i={}){if(!this.htmlCanvas)return;let n="width"in i?i.width:this.htmlCanvas.clientWidth,r="height"in i?i.height:this.htmlCanvas.clientHeight;(!n||!r)&&($e.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==n||s.clientHeight!==r||s.devicePixelRatio!==t){let o=t;const c=Math.floor(n*o),h=Math.floor(r*o);if(this.htmlCanvas.width=c,this.htmlCanvas.height=h,this.device.gl){const[A,_]=this.getDrawingBufferSize();(A!==c||_!==h)&&(o=Math.min(A/n,_/r),this.htmlCanvas.width=Math.floor(n*o),this.htmlCanvas.height=Math.floor(r*o),$e.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=t}}}getDrawingBufferSize(){const t=this.device.gl;return t?[t.drawingBufferWidth,t.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}}function Aj(e){if(typeof e=="string"){const t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function gj(e){const t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function mj(e){const{width:t,height:i}=e,n=document.createElement("canvas");return n.id=Ym("lumagl-auto-created-canvas"),n.width=t||1,n.height=i||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(i)?`${i}px`:"100%",n}function yj(e,t,i,n,r){const s=e,o=oS(s[0],t,i);let c=sS(s[1],t,n,r),h=oS(s[0]+1,t,i);const A=h===i-1?h:h-1;h=sS(s[1]+1,t,n,r);let _;return r?(h=h===0?h:h+1,_=c,c=h):_=h===n-1?h:h-1,{x:o,y:c,width:Math.max(A-o+1,1),height:Math.max(_-c+1,1)}}function oS(e,t,i){return Math.min(Math.round(e*t),i-1)}function sS(e,t,i,n){return n?Math.max(0,i-1-Math.round(e*t)):Math.min(Math.round(e*t),i-1)}class cr extends pr{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...pr.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(t,i){if(i=cr.normalizeProps(t,i),super(t,i,cr.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const n=cr.getTextureDataSize(this.props.data);this.width=n?.width||1,this.height=n?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?cr.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const i=t?.data;return ArrayBuffer.isView(i)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return cr.getTextureDataSize(t[0]);if(cr.isExternalImage(t))return cr.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,i){let n;return ArrayBuffer.isView(t)?n=[{data:t,width:i.width,height:i.height}]:Array.isArray(t)?n=t:n=[t],n}static getMipLevelCount(t,i){return Math.floor(Math.log2(Math.max(t,i)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(t,i){const n={...i},r=t?.props?._resourceDefaults?.texture||{};Object.assign(n,r);const{width:s,height:o}=n;return typeof s=="number"&&(n.width=Math.max(1,Math.ceil(s))),typeof o=="number"&&(n.height=Math.max(1,Math.ceil(o))),n}}class r_ extends pr{static defaultProps={...pr.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(t,i){super(t,i,r_.defaultProps)}}function vj(e,t,i){let n="";const r=t.split(/\r?\n/),s=e.slice().sort((o,c)=>o.lineNum-c.lineNum);switch(i?.showSourceCode||"no"){case"all":let o=0;for(let c=1;c<=r.length;c++)for(n+=cS(r[c-1],c,i);s.length>o&&s[o].lineNum===c;){const h=s[o++];n+=aS(h,r,h.lineNum,{...i,inlineSource:!1})}return n;case"issues":case"no":for(const c of e)n+=aS(c,r,c.lineNum,{inlineSource:i?.showSourceCode!=="no"});return n}}function aS(e,t,i,n){if(n?.inlineSource){const s=_j(t,i),o=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${s}${o}${e.type.toUpperCase()}: ${e.message}

`}const r=e.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${r};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function _j(e,t,i){let n="";for(let r=t-2;r<=t;r++){const s=e[r-1];s!==void 0&&(n+=cS(s,t,i))}return n}function cS(e,t,i){const n=i?.html?xj(e):e;return`${bj(String(t),4)}: ${n}${i?.html?"<br/>":`
`}`}function bj(e,t){let i="";for(let n=e.length;n<t;++n)i+=" ";return i+e}function xj(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class o_ extends pr{static defaultProps={...pr.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,i){i={...i,debugShaders:i.debugShaders||t.props.debugShaders||"errors"},super(t,{id:wj(i),...i},o_.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();t==="warnings"&&i?.length===0||this._displayShaderLog(i)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;const i=lS(this.source),n=`${this.stage} ${i}`;let r=vj(t,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(r+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${r}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{const c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}}function wj(e){return lS(e.source)||e.id||Ym(`unnamed ${e.stage}-shader`)}function lS(e,t="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return i?i[1]:t}class om extends pr{static defaultProps={...pr.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,i){i=om.normalizeProps(t,i),super(t,i,om.defaultProps)}static normalizeProps(t,i){const n=t?.props?._resourceDefaults?.sampler||{};return{...i,...n}}}class s_ extends pr{static defaultProps={...pr.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,i={}){super(t,i,s_.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){const i=this.colorAttachments.map(r=>r.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:i,depthStencilAttachment:n})}resize(t){let i=!t;if(t){const[n,r]=Array.isArray(t)?t:[t.width,t.height];i=i||r!==this.height||n!==this.width,this.width=n,this.height=r}i&&($e.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((i,n)=>{if(typeof i=="string"){const r=this.createColorTexture(i,n);return this.attachResource(r),r.view}return i instanceof cr?i.view:i});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const i=this.createDepthStencilTexture(t);this.attachResource(i),this.depthStencilAttachment=i.view}else t instanceof cr?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,i){return this.device.createTexture({id:`${this.id}-color-attachment-${i}`,usage:cr.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:cr.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,i){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const r=this.colorAttachments[n].texture.clone({width:t,height:i});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=r.view,this.attachResource(r.view)}if(this.depthStencilAttachment){const n=this.depthStencilAttachment.texture.clone({width:t,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}}class iA extends pr{static defaultProps={...pr.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,i){super(t,i,iA.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}}class Bf extends pr{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...pr.defaultProps,framebuffer:null,parameters:void 0,clearColor:Bf.defaultClearColor,clearColors:void 0,clearDepth:Bf.defaultClearDepth,clearStencil:Bf.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(t,i){i=Bf.normalizeProps(t,i),super(t,i,Bf.defaultProps)}static normalizeProps(t,i){return{...t.props._resourceDefaults?.renderPass,...i}}}class a_ extends pr{static defaultProps={...pr.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,i){super(t,i,a_.defaultProps),this.shaderLayout=i.shaderLayout}}class TE extends pr{static defaultProps={...pr.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,i){super(t,i,TE.defaultProps)}}class SE extends pr{static defaultProps={...pr.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,i){super(t,i,SE.defaultProps)}}function Cj(e){const[t,i]=Bj[e],n=t==="i32"||t==="u32",r=t!=="u32",s=Tj[t]*i,o=Ej(t,i);return{dataType:t,components:i,defaultVertexFormat:o,byteLength:s,integer:n,signed:r}}function Ej(e,t){let i;switch(e){case"f32":i="float32";break;case"i32":i="sint32";break;case"u32":i="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?i:`${i}x${t}`}const Bj={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},Tj={f32:4,f16:2,i32:4,u32:4};function uS(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[i,n]=e.split("x"),r=i,s=n?parseInt(n):1,o=$T(r),c={type:r,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(c.webglOnly=!0),c}function hS(e,t){const i={};for(const n of e.attributes){const r=Ij(e,t,n.name);r&&(i[n.name]=r)}return i}function Sj(e,t,i=16){const n=hS(e,t),r=new Array(i).fill(null);for(const s of Object.values(n))r[s.location]=s;return r}function Ij(e,t,i){const n=Mj(e,i),r=Pj(t,i);if(!n)return null;const s=Cj(n.type),o=r?.vertexFormat||s.defaultVertexFormat,c=uS(o);return{attributeName:r?.attributeName||n.name,bufferName:r?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:s.integer,stepMode:r?.stepMode||n.stepMode||"vertex",byteOffset:r?.byteOffset||0,byteStride:r?.byteStride||0}}function Mj(e,t){const i=e.attributes.find(n=>n.name===t);return i||$e.warn(`shader layout attribute "${t}" not present in shader`),i||null}function Pj(e,t){Rj(e);let i=Dj(e,t);return i||(i=Oj(e,t),i)?i:($e.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function Rj(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&$e.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function Dj(e,t){for(const i of e)if(i.format&&i.name===t)return{attributeName:i.name,bufferName:t,stepMode:i.stepMode,vertexFormat:i.format,byteOffset:0,byteStride:i.byteStride||0};return null}function Oj(e,t){for(const i of e){let n=i.byteStride;if(typeof i.byteStride!="number")for(const s of i.attributes||[]){const o=uS(s.format);n+=o.byteLength}const r=i.attributes?.find(s=>s.attribute===t);if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:n}}return null}class IE extends pr{static defaultProps={...pr.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,i){super(t,i,IE.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:n,bufferLayout:r}=i.renderPipeline||{};if(!n||!r)throw new Error("VertexArray");this.attributeInfos=Sj(n,r,this.maxVertexAttributes)}setConstantWebGL(t,i){this.device.reportError(new Error("constant attributes not supported"))}}class ME extends pr{static defaultProps={...pr.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,i){super(t,i,ME.defaultProps)}}class PE extends pr{static defaultProps={...pr.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(t,i){super(t,i,PE.defaultProps)}}const Lj={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function Fj(e){return Lj[e]}function kj(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}let i0;function fS(e){return(!i0||i0.byteLength<e)&&(i0=new ArrayBuffer(e)),i0}function Nj(e,t){const i=fS(e.BYTES_PER_ELEMENT*t);return new e(i,0,t)}function Uj(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function n0(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":Uj(e)}const dS=1024;class zj{layout={};byteLength;constructor(t){let i=0;for(const[r,s]of Object.entries(t)){const o=Fj(s),{type:c,components:h}=o;i=kj(i,h);const A=i;i+=h,this.layout[r]={type:c,size:h,offset:A}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,dS)}getData(t){const i=Math.max(this.byteLength,dS),n=fS(i),r={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[s,o]of Object.entries(t)){const c=this.layout[s];if(!c){$e.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:h,size:A,offset:_}=c,C=r[h];if(A===1){if(typeof o!="number"&&typeof o!="boolean"){$e.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}C[_]=Number(o)}else{if(!n0(o)){$e.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}C.set(o,_)}}return new Uint8Array(n)}has(t){return!!this.layout[t]}get(t){return this.layout[t]}}function Gj(e,t,i=16){if(e!==t)return!1;const n=e,r=t;if(!n0(n))return!1;if(n0(r)&&n.length===r.length){for(let s=0;s<n.length;++s)if(r[s]!==n[s])return!1}return!0}function jj(e){return n0(e)?e.slice():e}class Vj{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){const i=t?.shaderLayout.bindings?.find(r=>r.type==="uniform"&&r.name===t?.name);if(!i)throw new Error(t?.name);const n=i;for(const r of n.uniforms||[])this.bindingLayout[r.name]=r}}setUniforms(t){for(const[i,n]of Object.entries(t))this._setUniform(i,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${i}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,i){Gj(this.uniforms[t],i)||(this.uniforms[t]=jj(i),this.modifiedUniforms[t]=!0,this.modified=!0)}}class Hj{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(const[i,n]of Object.entries(t)){const r=i,s=new zj(n.uniformTypes||{});this.uniformBufferLayouts.set(r,s);const o=new Vj({name:i});o.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(r,o)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[i,n]of Object.entries(t))this.uniformBlocks.get(i)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){const i=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(i)}createUniformBuffer(t,i,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(i),s=t.createBuffer({usage:Cr.UNIFORM|Cr.COPY_DST,byteLength:r}),o=this.getUniformBufferData(i);return s.write(o),s}getManagedUniformBuffer(t,i){if(!this.uniformBuffers.get(i)){const n=this.getUniformBufferByteLength(i),r=t.createBuffer({usage:Cr.UNIFORM|Cr.COPY_DST,byteLength:n});this.uniformBuffers.set(i,r)}return this.uniformBuffers.get(i)}updateUniformBuffers(){let t=!1;for(const i of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(i);t||=n}return t&&$e.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const i=this.uniformBlocks.get(t);let n=this.uniformBuffers.get(t),r=!1;if(n&&i?.needsRedraw){r||=i.needsRedraw;const s=this.getUniformBufferData(t);n=this.uniformBuffers.get(t),n?.write(s);const o=this.uniformBlocks.get(t)?.getAllUniforms();$e.log(4,`Writing to uniform buffer ${String(t)}`,s,o)()}return r}}function pS(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function AS(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function Wj(e,t,i){if(!t||t>4)throw new Error(`size ${t}`);const n=t;let r=pS(e);if(r==="uint8"&&i&&n===1)return"unorm8-webgl";if(r==="uint8"&&i&&n===3)return"unorm8x3-webgl";if(r==="uint8"||r==="sint8"){if(n===1||n===3)throw new Error(`size: ${t}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}if(r==="uint16"||r==="sint16"){if(n===1||n===3)throw new Error(`size: ${t}`);return i&&(r=r.replace("int","norm")),`${r}x${n}`}return n===1?r:`${r}x${n}`}class B1{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(i=>i.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(i=>i.attribute):[t.name]}mergeBufferLayouts(t,i){const n=[...t];for(const r of i){const s=n.findIndex(o=>o.name===r.name);s<0?n.push(r):n[s]=r}return n}getBufferIndex(t){const i=this.bufferLayouts.findIndex(n=>n.name===t);return i===-1&&$e.warn(`BufferLayout: Missing buffer for "${t}".`)(),i}}function Jj(e,t){const i=Object.fromEntries(e.attributes.map(r=>[r.name,r.location])),n=t.slice();return n.sort((r,s)=>{const o=r.attributes?r.attributes.map(_=>_.attribute):[r.name],c=s.attributes?s.attributes.map(_=>_.attribute):[s.name],h=Math.min(...o.map(_=>i[_])),A=Math.min(...c.map(_=>i[_]));return h-A}),n}class Da{constructor(t,i){this.name=t,this.attributes=i,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class gS{constructor(t,i,n){this.name=t,this.type=i,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Uu extends Da{constructor(t,i){super(t,i),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class zu extends Da{constructor(t,i){super(t,i),this.count=0,this.stride=0}get isArray(){return!0}}class Hh extends Da{constructor(t,i,n,r){super(t,n),this.format=i,this.access=r}get isTemplate(){return!0}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}var Gu;(e=>{e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Gu||(Gu={}));class r0{constructor(t,i,n,r,s,o,c){this.name=t,this.type=i,this.group=n,this.binding=r,this.attributes=s,this.resourceType=o,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Xj{constructor(t,i){this.name=t,this.type=i}}class Qj{constructor(t,i,n,r){this.name=t,this.type=i,this.locationType=n,this.location=r,this.interpolation=null}}class mS{constructor(t,i,n,r){this.name=t,this.type=i,this.locationType=n,this.location=r}}class Kj{constructor(t,i,n,r){this.name=t,this.type=i,this.attributes=n,this.id=r}}class qj{constructor(t,i,n){this.name=t,this.type=i,this.attributes=n}}class Zj{constructor(t,i=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=i,this.attributes=n}}class Yj{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const yS=new Float32Array(1),$j=new Int32Array(yS.buffer),ps=new Uint16Array(1);function tV(e){yS[0]=e;const t=$j[0],i=t>>31&1;let n=t>>23&255,r=8388607&t;if(n===255)return ps[0]=i<<15|31744|(r!==0?512:0),ps[0];if(n===0){if(r===0)return ps[0]=i<<15,ps[0];r|=8388608;let s=113;for(;!(8388608&r);)r<<=1,s--;return n=127-s,r&=8388607,n>0?(r=(r>>126-n)+(r>>127-n&1),ps[0]=i<<15|n<<10|r>>13,ps[0]):(ps[0]=i<<15,ps[0])}return n=n-127+15,n>=31?(ps[0]=i<<15|31744,ps[0]):n<=0?n<-10?(ps[0]=i<<15,ps[0]):(r=(8388608|r)>>1-n,ps[0]=i<<15|r>>13,ps[0]):(r>>=13,ps[0]=i<<15|n<<10|r,ps[0])}const T1=new Uint32Array(1),vS=new Float32Array(T1.buffer,0,1);function _S(e){const t=112+(e>>6&31)<<23|(63&e)<<17;return T1[0]=t,vS[0]}function eV(e,t,i,n,r,s,o,c,h){const A=n*(o>>=r)*(s>>=r)+i*o+t*c;switch(h){case"r8unorm":return[qn(e,A,"8unorm",1)[0]];case"r8snorm":return[qn(e,A,"8snorm",1)[0]];case"r8uint":return[qn(e,A,"8uint",1)[0]];case"r8sint":return[qn(e,A,"8sint",1)[0]];case"rg8unorm":{const _=qn(e,A,"8unorm",2);return[_[0],_[1]]}case"rg8snorm":{const _=qn(e,A,"8snorm",2);return[_[0],_[1]]}case"rg8uint":{const _=qn(e,A,"8uint",2);return[_[0],_[1]]}case"rg8sint":{const _=qn(e,A,"8sint",2);return[_[0],_[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const _=qn(e,A,"8unorm",4);return[_[0],_[1],_[2],_[3]]}case"rgba8snorm":{const _=qn(e,A,"8snorm",4);return[_[0],_[1],_[2],_[3]]}case"rgba8uint":{const _=qn(e,A,"8uint",4);return[_[0],_[1],_[2],_[3]]}case"rgba8sint":{const _=qn(e,A,"8sint",4);return[_[0],_[1],_[2],_[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const _=qn(e,A,"8unorm",4);return[_[2],_[1],_[0],_[3]]}case"r16uint":return[qn(e,A,"16uint",1)[0]];case"r16sint":return[qn(e,A,"16sint",1)[0]];case"r16float":return[qn(e,A,"16float",1)[0]];case"rg16uint":{const _=qn(e,A,"16uint",2);return[_[0],_[1]]}case"rg16sint":{const _=qn(e,A,"16sint",2);return[_[0],_[1]]}case"rg16float":{const _=qn(e,A,"16float",2);return[_[0],_[1]]}case"rgba16uint":{const _=qn(e,A,"16uint",4);return[_[0],_[1],_[2],_[3]]}case"rgba16sint":{const _=qn(e,A,"16sint",4);return[_[0],_[1],_[2],_[3]]}case"rgba16float":{const _=qn(e,A,"16float",4);return[_[0],_[1],_[2],_[3]]}case"r32uint":return[qn(e,A,"32uint",1)[0]];case"r32sint":return[qn(e,A,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[qn(e,A,"32float",1)[0]];case"rg32uint":{const _=qn(e,A,"32uint",2);return[_[0],_[1]]}case"rg32sint":{const _=qn(e,A,"32sint",2);return[_[0],_[1]]}case"rg32float":{const _=qn(e,A,"32float",2);return[_[0],_[1]]}case"rgba32uint":{const _=qn(e,A,"32uint",4);return[_[0],_[1],_[2],_[3]]}case"rgba32sint":{const _=qn(e,A,"32sint",4);return[_[0],_[1],_[2],_[3]]}case"rgba32float":{const _=qn(e,A,"32float",4);return[_[0],_[1],_[2],_[3]]}case"rg11b10ufloat":{const _=new Uint32Array(e.buffer,A,1)[0],C=(4192256&_)>>11,S=(4290772992&_)>>22;return[_S(2047&_),_S(C),function(L){const N=112+(L>>5&31)<<23|(31&L)<<18;return T1[0]=N,vS[0]}(S),1]}}return null}function qn(e,t,i,n){const r=[0,0,0,0];for(let A=0;A<n;++A)switch(i){case"8unorm":r[A]=e[t]/255,t++;break;case"8snorm":r[A]=e[t]/255*2-1,t++;break;case"8uint":r[A]=e[t],t++;break;case"8sint":r[A]=e[t]-127,t++;break;case"16uint":r[A]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":r[A]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":r[A]=(s=e[t]|e[t+1]<<8,o=void 0,c=void 0,h=void 0,o=(32768&s)>>15,h=1023&s,(c=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):c==31?h?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,c-15)*(1+h/Math.pow(2,10))),t+=2;break;case"32uint":case"32sint":r[A]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":r[A]=new Float32Array(e.buffer,t,1)[0],t+=4}var s,o,c,h;return r}function er(e,t,i,n,r){for(let s=0;s<n;++s)switch(i){case"8unorm":e[t]=255*r[s],t++;break;case"8snorm":e[t]=.5*(r[s]+1)*255,t++;break;case"8uint":e[t]=r[s],t++;break;case"8sint":e[t]=r[s]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=r[s],t+=2;break;case"16float":{const o=tV(r[s]);new Uint16Array(e.buffer,t,1)[0]=o,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=r[s],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=r[s],t+=4}return r}const S1={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Va{constructor(){this.id=Va._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(t){t(this)}searchBlock(t,i){if(t){i(o0.instance);for(const n of t)n instanceof Array?this.searchBlock(n,i):n.search(i);i(s0.instance)}}constEvaluate(t,i){throw new Error("Cannot evaluate node")}constEvaluateString(t){return this.constEvaluate(t).toString()}}Va._id=0;let o0=class extends Va{};o0.instance=new o0;class s0 extends Va{}s0.instance=new s0;const bS=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Ur extends Va{constructor(){super()}}class jA extends Ur{constructor(t,i,n,r,s,o){super(),this.calls=new Set,this.name=t,this.args=i,this.returnType=n,this.body=r,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(t){if(this.attributes)for(const i of this.attributes)t(i);t(this);for(const i of this.args)t(i);this.searchBlock(this.body,t)}}class iV extends Ur{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class xS extends Ur{constructor(t,i){super(),this.condition=t,this.body=i}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class I1 extends Ur{constructor(t,i){super(),this.body=t,this.loopId=i}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class wS extends Ur{constructor(t,i,n,r){super(),this.init=t,this.condition=i,this.increment=n,this.body=r}get astNodeType(){return"for"}search(t){var i,n,r;(i=this.init)===null||i===void 0||i.search(t),(n=this.condition)===null||n===void 0||n.search(t),(r=this.increment)===null||r===void 0||r.search(t),this.searchBlock(this.body,t)}}class Vl extends Ur{constructor(t,i,n,r,s){super(),this.attributes=null,this.name=t,this.type=i,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"var"}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}let M1=class extends Ur{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}};class VA extends Ur{constructor(t,i,n,r,s){super(),this.attributes=null,this.name=t,this.type=i,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"let"}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}class a0 extends Ur{constructor(t,i,n,r,s){super(),this.attributes=null,this.name=t,this.type=i,this.storage=n,this.access=r,this.value=s}get astNodeType(){return"const"}constEvaluate(t,i){return this.value.constEvaluate(t,i)}search(t){var i;t(this),(i=this.value)===null||i===void 0||i.search(t)}}var Id,HA,me,ie;(e=>{e.increment="++",e.decrement="--"})(Id||(Id={})),(e=>{e.parse=function(t){const i=t;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return e[i]}})(Id||(Id={}));class CS extends Ur{constructor(t,i){super(),this.operator=t,this.variable=i}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}(e=>{e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(HA||(HA={})),(e=>{e.parse=function(t){const i=t;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}})(HA||(HA={}));class ES extends Ur{constructor(t,i,n){super(),this.operator=t,this.variable=i,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class P1 extends Ur{constructor(t,i){super(),this.name=t,this.args=i}get astNodeType(){return"call"}isBuiltin(){return bS.has(this.name)}search(t){for(const i of this.args)i.search(t);t(this)}}class BS extends Ur{constructor(t,i){super(),this.body=t,this.continuing=i}get astNodeType(){return"loop"}}class TS extends Ur{constructor(t,i){super(),this.condition=t,this.cases=i}get astNodeType(){return"switch"}}class SS extends Ur{constructor(t,i,n,r){super(),this.condition=t,this.body=i,this.elseif=n,this.else=r}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class IS extends Ur{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var i;(i=this.value)===null||i===void 0||i.search(t)}}class nV extends Ur{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class rV extends Ur{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class MS extends Ur{constructor(t,i){super(),this.severity=t,this.rule=i}get astNodeType(){return"diagnostic"}}class R1 extends Ur{constructor(t,i){super(),this.name=t,this.type=i}get astNodeType(){return"alias"}}class oV extends Ur{constructor(){super()}get astNodeType(){return"discard"}}class PS extends Ur{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class RS extends Ur{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Ne extends Ur{constructor(t){super(),this.attributes=null,this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(t){let i=t[0];if(i.name==="f32")return i;for(let n=1;n<t.length;++n){const r=Ne._priority.get(i.name);Ne._priority.get(t[n].name)<r&&(i=t[n])}return i.name==="x32"?Ne.i32:i}getTypeName(){return this.name}}Ne.x32=new Ne("x32"),Ne.f32=new Ne("f32"),Ne.i32=new Ne("i32"),Ne.u32=new Ne("u32"),Ne.f16=new Ne("f16"),Ne.bool=new Ne("bool"),Ne.void=new Ne("void"),Ne._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class DS extends Ne{constructor(t){super(t)}}class Hl extends Ne{constructor(t,i,n,r){super(t),this.members=i,this.startLine=n,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let i=0;i<this.members.length;i++)if(this.members[i].name==t)return i;return-1}search(t){for(const i of this.members)t(i)}}class ue extends Ne{constructor(t,i,n){super(t),this.format=i,this.access=n}get astNodeType(){return"template"}getTypeName(){let t=this.name;if(this.format!==null){if(t==="vec2"||t==="vec3"||t==="vec4"||t==="mat2x2"||t==="mat2x3"||t==="mat2x4"||t==="mat3x2"||t==="mat3x3"||t==="mat3x4"||t==="mat4x2"||t==="mat4x3"||t==="mat4x4"){if(this.format.name==="f32")return t+="f",t;if(this.format.name==="i32")return t+="i",t;if(this.format.name==="u32")return t+="u",t;if(this.format.name==="bool")return t+="b",t;if(this.format.name==="f16")return t+="h",t}t+=`<${this.format.name}>`}else if(t==="vec2"||t==="vec3"||t==="vec4")return t;return t}}ue.vec2f=new ue("vec2",Ne.f32,null),ue.vec3f=new ue("vec3",Ne.f32,null),ue.vec4f=new ue("vec4",Ne.f32,null),ue.vec2i=new ue("vec2",Ne.i32,null),ue.vec3i=new ue("vec3",Ne.i32,null),ue.vec4i=new ue("vec4",Ne.i32,null),ue.vec2u=new ue("vec2",Ne.u32,null),ue.vec3u=new ue("vec3",Ne.u32,null),ue.vec4u=new ue("vec4",Ne.u32,null),ue.vec2h=new ue("vec2",Ne.f16,null),ue.vec3h=new ue("vec3",Ne.f16,null),ue.vec4h=new ue("vec4",Ne.f16,null),ue.vec2b=new ue("vec2",Ne.bool,null),ue.vec3b=new ue("vec3",Ne.bool,null),ue.vec4b=new ue("vec4",Ne.bool,null),ue.mat2x2f=new ue("mat2x2",Ne.f32,null),ue.mat2x3f=new ue("mat2x3",Ne.f32,null),ue.mat2x4f=new ue("mat2x4",Ne.f32,null),ue.mat3x2f=new ue("mat3x2",Ne.f32,null),ue.mat3x3f=new ue("mat3x3",Ne.f32,null),ue.mat3x4f=new ue("mat3x4",Ne.f32,null),ue.mat4x2f=new ue("mat4x2",Ne.f32,null),ue.mat4x3f=new ue("mat4x3",Ne.f32,null),ue.mat4x4f=new ue("mat4x4",Ne.f32,null),ue.mat2x2h=new ue("mat2x2",Ne.f16,null),ue.mat2x3h=new ue("mat2x3",Ne.f16,null),ue.mat2x4h=new ue("mat2x4",Ne.f16,null),ue.mat3x2h=new ue("mat3x2",Ne.f16,null),ue.mat3x3h=new ue("mat3x3",Ne.f16,null),ue.mat3x4h=new ue("mat3x4",Ne.f16,null),ue.mat4x2h=new ue("mat4x2",Ne.f16,null),ue.mat4x3h=new ue("mat4x3",Ne.f16,null),ue.mat4x4h=new ue("mat4x4",Ne.f16,null),ue.mat2x2i=new ue("mat2x2",Ne.i32,null),ue.mat2x3i=new ue("mat2x3",Ne.i32,null),ue.mat2x4i=new ue("mat2x4",Ne.i32,null),ue.mat3x2i=new ue("mat3x2",Ne.i32,null),ue.mat3x3i=new ue("mat3x3",Ne.i32,null),ue.mat3x4i=new ue("mat3x4",Ne.i32,null),ue.mat4x2i=new ue("mat4x2",Ne.i32,null),ue.mat4x3i=new ue("mat4x3",Ne.i32,null),ue.mat4x4i=new ue("mat4x4",Ne.i32,null),ue.mat2x2u=new ue("mat2x2",Ne.u32,null),ue.mat2x3u=new ue("mat2x3",Ne.u32,null),ue.mat2x4u=new ue("mat2x4",Ne.u32,null),ue.mat3x2u=new ue("mat3x2",Ne.u32,null),ue.mat3x3u=new ue("mat3x3",Ne.u32,null),ue.mat3x4u=new ue("mat3x4",Ne.u32,null),ue.mat4x2u=new ue("mat4x2",Ne.u32,null),ue.mat4x3u=new ue("mat4x3",Ne.u32,null),ue.mat4x4u=new ue("mat4x4",Ne.u32,null);class D1 extends Ne{constructor(t,i,n,r){super(t),this.storage=i,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class WA extends Ne{constructor(t,i,n,r){super(t),this.attributes=i,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class JA extends Ne{constructor(t,i,n){super(t),this.format=i,this.access=n}get astNodeType(){return"sampler"}}class il extends Va{constructor(){super(),this.postfix=null}}class Wh extends il{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class nl extends il{constructor(t,i){super(),this.type=t,this.args=i}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const i of this.args)i.search(t)}constEvaluate(t,i){return i&&(i[0]=this.type),t.evalExpression(this,t.context)}}class O1 extends il{constructor(t,i){super(),this.cachedReturnValue=null,this.name=t,this.args=i}get astNodeType(){return"callExpr"}setCachedReturnValue(t){this.cachedReturnValue=t}get isBuiltin(){return bS.has(this.name)}constEvaluate(t,i){return t.evalExpression(this,t.context)}search(t){for(const i of this.args)i.search(t);t(this)}}class aa extends il{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}constEvaluate(t,i){return t.evalExpression(this,t.context)}}class OS extends il{constructor(t,i){super(),this.name=t,this.initializer=i}get astNodeType(){return"constExpr"}constEvaluate(t,i){if(this.initializer){const n=t.evalExpression(this.initializer,t.context);return n!==null&&this.postfix?n.getSubData(t,this.postfix,t.context):n}return null}search(t){this.initializer.search(t)}}class wo extends il{constructor(t,i){super(),this.value=t,this.type=i}get astNodeType(){return"literalExpr"}constEvaluate(t,i){return i!==void 0&&(i[0]=this.type),this.value}get isScalar(){return this.value instanceof ee}get isVector(){return this.value instanceof Ut||this.value instanceof sn}get scalarValue(){return this.value instanceof ee?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Ut||this.value instanceof sn?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class LS extends il{constructor(t,i){super(),this.type=t,this.value=i}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class Md extends il{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class FS extends il{constructor(){super()}}class fo extends FS{constructor(t,i){super(),this.operator=t,this.right=i}get astNodeType(){return"unaryOp"}constEvaluate(t,i){return t.evalExpression(this,t.context)}search(t){this.right.search(t)}}class lc extends FS{constructor(t,i,n){super(),this.operator=t,this.left=i,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(t,i){return t.name===i.name?t:t.name==="f32"||i.name==="f32"?Ne.f32:t.name==="u32"||i.name==="u32"?Ne.u32:Ne.i32}constEvaluate(t,i){return t.evalExpression(this,t.context)}search(t){this.left.search(t),this.right.search(t)}}class kS extends Va{constructor(t){super(),this.body=t}}class c0 extends il{constructor(){super()}get astNodeType(){return"default"}}class NS extends kS{constructor(t,i){super(i),this.selectors=t}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class US extends kS{constructor(t){super(t)}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class zS extends Va{constructor(t,i,n){super(),this.name=t,this.type=i,this.attributes=n}get astNodeType(){return"argument"}}class sV extends Va{constructor(t,i){super(),this.condition=t,this.body=i}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class GS extends Va{constructor(t,i,n){super(),this.name=t,this.type=i,this.attributes=n}get astNodeType(){return"member"}}class jS extends Va{constructor(t,i){super(),this.name=t,this.value=i}get astNodeType(){return"attribute"}}class Ha{constructor(t,i){this.parent=null,this.typeInfo=t,this.parent=i,this.id=Ha._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(t,i,n,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(t,i,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}Ha._id=0;class L1 extends Ha{constructor(){super(new Da("void",null),null)}toString(){return"void"}}L1.void=new L1;class Pd extends Ha{constructor(t){super(new Da("pointer",null),null),this.reference=t}clone(){return this}setDataValue(t,i,n,r){this.reference.setDataValue(t,i,n,r)}getSubData(t,i,n){return i?this.reference.getSubData(t,i,n):this}}class ee extends Ha{constructor(t,i,n=null){super(i,n),t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array?this.data=t:this.typeInfo.name==="x32"?t-Math.floor(t)!=0?this.data=new Float32Array([t]):this.data=t>=0?new Uint32Array([t]):new Int32Array([t]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([t]):this.typeInfo.name==="u32"?this.data=new Uint32Array([t]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([t]):console.error("ScalarData2: Invalid type",i)}clone(){if(this.data instanceof Float32Array)return new ee(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new ee(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new ee(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(t){this.data[0]=t}setDataValue(t,i,n,r){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(i instanceof ee))return void console.error("SetDataValue: Invalid value",i);let s=i.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(t,i,n){return i?(console.error("getSubData: Scalar data does not support postfix",i),null):this}toString(){return`${this.value}`}}function aV(e,t,i){const n=t.length;return n===2?i==="f32"?new Ut(new Float32Array(t),e.getTypeInfo("vec2f")):i==="i32"||i==="bool"?new Ut(new Int32Array(t),e.getTypeInfo("vec2i")):i==="u32"?new Ut(new Uint32Array(t),e.getTypeInfo("vec2u")):i==="f16"?new Ut(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${i}`),null):n===3?i==="f32"?new Ut(new Float32Array(t),e.getTypeInfo("vec3f")):i==="i32"||i==="bool"?new Ut(new Int32Array(t),e.getTypeInfo("vec3i")):i==="u32"?new Ut(new Uint32Array(t),e.getTypeInfo("vec3u")):i==="f16"?new Ut(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${i}`),null):n===4?i==="f32"?new Ut(new Float32Array(t),e.getTypeInfo("vec4f")):i==="i32"||i==="bool"?new Ut(new Int32Array(t),e.getTypeInfo("vec4i")):i==="u32"?new Ut(new Uint32Array(t),e.getTypeInfo("vec4u")):i==="f16"?new Ut(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${i}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}class Ut extends Ha{constructor(t,i,n=null){if(super(i,n),t instanceof Float32Array||t instanceof Uint32Array||t instanceof Int32Array)this.data=t;else{const r=this.typeInfo.name;r==="vec2f"||r==="vec3f"||r==="vec4f"?this.data=new Float32Array(t):r==="vec2i"||r==="vec3i"||r==="vec4i"?this.data=new Int32Array(t):r==="vec2u"||r==="vec3u"||r==="vec4u"?this.data=new Uint32Array(t):r==="vec2h"||r==="vec3h"||r==="vec4h"?this.data=new Float32Array(t):r==="vec2b"||r==="vec3b"||r==="vec4b"?this.data=new Int32Array(t):r==="vec2"||r==="vec3"||r==="vec4"?this.data=new Float32Array(t):console.error(`VectorData: Invalid type ${r}`)}}clone(){if(this.data instanceof Float32Array)return new Ut(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Ut(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Ut(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(t,i,n,r){n instanceof Wh?console.error("TODO: Set vector postfix"):i instanceof Ut?this.data=i.data:console.error("SetDataValue: Invalid value",i)}getSubData(t,i,n){if(i===null)return this;let r=t.getTypeInfo("f32");if(this.typeInfo instanceof Hh)r=this.typeInfo.format||r;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?r=t.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?r=t.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?r=t.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?r=t.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?r=t.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;i!==null&&s!==null;){if(i instanceof Md){const o=i.index;let c=-1;if(o instanceof wo){if(!(o.value instanceof ee))return console.error(`GetSubData: Invalid array index ${o.value}`),null;c=o.value.value}else{const h=t.evalExpression(o,n);if(!(h instanceof ee))return console.error("GetSubData: Unknown index type",o),null;c=h.value}if(c<0||c>=s.data.length)return console.error("GetSubData: Index out of range",c),null;if(s.data instanceof Float32Array){const h=new Float32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ee(h,r)}if(s.data instanceof Int32Array){const h=new Int32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ee(h,r)}if(s.data instanceof Uint32Array){const h=new Uint32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new ee(h,r)}throw"GetSubData: Invalid data type"}if(!(i instanceof Wh))return console.error("GetSubData: Unknown postfix",i),null;{const o=i.value.toLowerCase();if(o.length===1){let h=0;if(o==="x"||o==="r")h=0;else if(o==="y"||o==="g")h=1;else if(o==="z"||o==="b")h=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;h=3}if(this.data instanceof Float32Array){let A=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ee(A,r,this)}if(this.data instanceof Int32Array){let A=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ee(A,r,this)}if(this.data instanceof Uint32Array){let A=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new ee(A,r,this)}}const c=[];for(const h of o)h==="x"||h==="r"?c.push(this.data[0]):h==="y"||h==="g"?c.push(this.data[1]):h==="z"||h==="b"?c.push(this.data[2]):h==="w"||h==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);s=aV(t,c,r.name)}i=i.postfix}return s}toString(){let t=`${this.data[0]}`;for(let i=1;i<this.data.length;++i)t+=`, ${this.data[i]}`;return t}}class sn extends Ha{constructor(t,i,n=null){super(i,n),t instanceof Float32Array?this.data=t:this.data=new Float32Array(t)}clone(){return new sn(new Float32Array(this.data),this.typeInfo,null)}setDataValue(t,i,n,r){n instanceof Wh?console.error("TODO: Set matrix postfix"):i instanceof sn?this.data=i.data:console.error("SetDataValue: Invalid value",i)}getSubData(t,i,n){if(i===null)return this;const r=this.typeInfo.name;if(t.getTypeInfo("f32"),this.typeInfo instanceof Hh)this.typeInfo.format;else if(r.endsWith("f"))t.getTypeInfo("f32");else if(r.endsWith("i"))t.getTypeInfo("i32");else if(r.endsWith("u"))t.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;t.getTypeInfo("f16")}if(i instanceof Md){const s=i.index;let o=-1;if(s instanceof wo){if(!(s.value instanceof ee))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const A=t.evalExpression(s,n);if(!(A instanceof ee))return console.error("GetDataValue: Unknown index type",s),null;o=A.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const c=r.endsWith("h")?"h":"f";let h;if(r==="mat2x2"||r==="mat2x2f"||r==="mat2x2h"||r==="mat3x2"||r==="mat3x2f"||r==="mat3x2h"||r==="mat4x2"||r==="mat4x2f"||r==="mat4x2h")h=new Ut(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),t.getTypeInfo(`vec2${c}`));else if(r==="mat2x3"||r==="mat2x3f"||r==="mat2x3h"||r==="mat3x3"||r==="mat3x3f"||r==="mat3x3h"||r==="mat4x3"||r==="mat4x3f"||r==="mat4x3h")h=new Ut(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),t.getTypeInfo(`vec3${c}`));else{if(r!=="mat2x4"&&r!=="mat2x4f"&&r!=="mat2x4h"&&r!=="mat3x4"&&r!=="mat3x4f"&&r!=="mat3x4h"&&r!=="mat4x4"&&r!=="mat4x4f"&&r!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${r}`),null;h=new Ut(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),t.getTypeInfo(`vec4${c}`))}return i.postfix?h.getSubData(t,i.postfix,n):h}return console.error("GetDataValue: Invalid postfix",i),null}toString(){let t=`${this.data[0]}`;for(let i=1;i<this.data.length;++i)t+=`, ${this.data[i]}`;return t}}class to extends Ha{constructor(t,i,n=0,r=null){super(i,r),this.buffer=t instanceof ArrayBuffer?t:t.buffer,this.offset=n}clone(){const t=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new to(t.buffer,this.typeInfo,0,null)}setDataValue(t,i,n,r){if(i===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;n;){if(n instanceof Md)if(o instanceof zu){const c=n.index;if(c instanceof wo){if(!(c.value instanceof ee))return void console.error(`SetDataValue: Invalid index type ${c.value}`);s+=c.value.value*o.stride}else{const h=t.evalExpression(c,r);if(!(h instanceof ee))return void console.error("SetDataValue: Unknown index type",c);s+=h.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(n instanceof Wh))return void console.error("SetDataValue: Unknown postfix type",n);{const c=n.value;if(o instanceof Uu){let h=!1;for(const A of o.members)if(A.name===c){s+=A.offset,o=A.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${c} not found`)}else if(o instanceof Da){const h=o.getTypeName();let A=0;if(c==="x"||c==="r")A=0;else if(c==="y"||c==="g")A=1;else if(c==="z"||c==="b")A=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);A=3}if(!(i instanceof ee))return void console.error("SetDataValue: Invalid value",i);const _=i.value;return h==="vec2f"?void(new Float32Array(this.buffer,s,2)[A]=_):h==="vec3f"?void(new Float32Array(this.buffer,s,3)[A]=_):h==="vec4f"?void(new Float32Array(this.buffer,s,4)[A]=_):h==="vec2i"?void(new Int32Array(this.buffer,s,2)[A]=_):h==="vec3i"?void(new Int32Array(this.buffer,s,3)[A]=_):h==="vec4i"?void(new Int32Array(this.buffer,s,4)[A]=_):h==="vec2u"?void(new Uint32Array(this.buffer,s,2)[A]=_):h==="vec3u"?void(new Uint32Array(this.buffer,s,3)[A]=_):h==="vec4u"?void(new Uint32Array(this.buffer,s,4)[A]=_):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}n=n.postfix}this.setData(t,i,o,s,r)}setData(t,i,n,r,s){const o=n.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(i instanceof to){if(n===i.typeInfo)return void new Uint8Array(this.buffer,r,i.buffer.byteLength).set(new Uint8Array(i.buffer));console.error("SetDataValue: Type mismatch",o,i.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const c=new Float32Array(this.buffer,r,16);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5],c[6]=i.data[6],c[7]=i.data[7],c[8]=i.data[8],c[9]=i.data[9],c[10]=i.data[10],c[11]=i.data[11],c[12]=i.data[12],c[13]=i.data[13],c[14]=i.data[14],c[15]=i.data[15]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15])}else{const c=new Float32Array(this.buffer,r,12);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5],c[6]=i.data[6],c[7]=i.data[7],c[8]=i.data[8],c[9]=i.data[9],c[10]=i.data[10],c[11]=i.data[11]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11])}else{const c=new Float32Array(this.buffer,r,8);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5],c[6]=i.data[6],c[7]=i.data[7]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7])}else{const c=new Float32Array(this.buffer,r,12);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5],c[6]=i.data[6],c[7]=i.data[7],c[8]=i.data[8],c[9]=i.data[9],c[10]=i.data[10],c[11]=i.data[11]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11])}else{const c=new Float32Array(this.buffer,r,9);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5],c[6]=i.data[6],c[7]=i.data[7],c[8]=i.data[8]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[8]=i[8])}else{const c=new Float32Array(this.buffer,r,6);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5])}else{const c=new Float32Array(this.buffer,r,8);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5],c[6]=i.data[6],c[7]=i.data[7]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7])}else{const c=new Float32Array(this.buffer,r,6);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3],c[4]=i.data[4],c[5]=i.data[5]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[4]=i[4],c[5]=i[5])}else{const c=new Float32Array(this.buffer,r,4);i instanceof sn?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3])}else{const c=new Uint32Array(this.buffer,r,4);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3])}else{const c=new Uint32Array(this.buffer,r,3);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2]):(c[0]=i[0],c[1]=i[1],c[2]=i[2])}else{const c=new Uint32Array(this.buffer,r,2);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1]):(c[0]=i[0],c[1]=i[1])}else{const c=new Uint32Array(this.buffer,r,4);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3])}else{const c=new Uint32Array(this.buffer,r,3);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2]):(c[0]=i[0],c[1]=i[1],c[2]=i[2])}else{const c=new Uint32Array(this.buffer,r,2);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1]):(c[0]=i[0],c[1]=i[1])}else{const c=new Int32Array(this.buffer,r,4);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3])}else{const c=new Int32Array(this.buffer,r,3);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2]):(c[0]=i[0],c[1]=i[1],c[2]=i[2])}else{const c=new Int32Array(this.buffer,r,2);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1]):(c[0]=i[0],c[1]=i[1])}else{const c=new Float32Array(this.buffer,r,4);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2],c[3]=i.data[3]):(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3])}else{const c=new Float32Array(this.buffer,r,3);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1],c[2]=i.data[2]):(c[0]=i[0],c[1]=i[1],c[2]=i[2])}else{const c=new Float32Array(this.buffer,r,2);i instanceof Ut?(c[0]=i.data[0],c[1]=i.data[1]):(c[0]=i[0],c[1]=i[1])}else i instanceof ee&&(new Int32Array(this.buffer,r,1)[0]=i.value);else i instanceof ee&&(new Uint32Array(this.buffer,r,1)[0]=i.value);else i instanceof ee&&(new Int32Array(this.buffer,r,1)[0]=i.value);else i instanceof ee&&(new Float32Array(this.buffer,r,1)[0]=i.value)}getSubData(t,i,n){var r,s,o;if(i===null)return this;let c=this.offset,h=this.typeInfo;for(;i;){if(i instanceof Md){const _=i.index,C=t.evalExpression(_,n);let S=0;if(C instanceof ee?S=C.value:console.error("GetDataValue: Invalid index type",_),h instanceof zu)c+=S*h.stride,h=h.format;else{const L=h.getTypeName();L==="mat4x4"||L==="mat4x4f"||L==="mat4x4h"?(c+=16*S,h=t.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(i instanceof Wh))return console.error("GetDataValue: Unknown postfix type",i),null;{const _=i.value;if(h instanceof Uu){let C=!1;for(const S of h.members)if(S.name===_){c+=S.offset,h=S.type,C=!0;break}if(!C)return console.error(`GetDataValue: Member ${_} not found`),null}else if(h instanceof Da){const C=h.getTypeName();if(C==="vec2f"||C==="vec3f"||C==="vec4f"||C==="vec2i"||C==="vec3i"||C==="vec4i"||C==="vec2u"||C==="vec3u"||C==="vec4u"||C==="vec2b"||C==="vec3b"||C==="vec4b"||C==="vec2h"||C==="vec3h"||C==="vec4h"||C==="vec2"||C==="vec3"||C==="vec4"){if(_.length>0&&_.length<5){let S="f";const L=[];for(let N=0;N<_.length;++N){const U=_[N].toLowerCase();let H=0;if(U==="x"||U==="r")H=0;else if(U==="y"||U==="g")H=1;else if(U==="z"||U==="b")H=2;else{if(U!=="w"&&U!=="a")return console.error(`Unknown member ${_}`),null;H=3}if(_.length===1){if(C.endsWith("f"))return this.buffer.byteLength<c+4*H+4?(console.log("Insufficient buffer data"),null):new ee(new Float32Array(this.buffer,c+4*H,1),t.getTypeInfo("f32"),this);if(C.endsWith("h"))return new ee(new Float32Array(this.buffer,c+4*H,1),t.getTypeInfo("f16"),this);if(C.endsWith("i"))return new ee(new Int32Array(this.buffer,c+4*H,1),t.getTypeInfo("i32"),this);if(C.endsWith("b"))return new ee(new Int32Array(this.buffer,c+4*H,1),t.getTypeInfo("bool"),this);if(C.endsWith("u"))return new ee(new Uint32Array(this.buffer,c+4*H,1),t.getTypeInfo("i32"),this)}if(C==="vec2f")L.push(new Float32Array(this.buffer,c,2)[H]);else if(C==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const j=new Float32Array(this.buffer,c,3);L.push(j[H])}else if(C==="vec4f")L.push(new Float32Array(this.buffer,c,4)[H]);else if(C==="vec2i")S="i",L.push(new Int32Array(this.buffer,c,2)[H]);else if(C==="vec3i")S="i",L.push(new Int32Array(this.buffer,c,3)[H]);else if(C==="vec4i")S="i",L.push(new Int32Array(this.buffer,c,4)[H]);else if(C==="vec2u"){S="u";const j=new Uint32Array(this.buffer,c,2);L.push(j[H])}else C==="vec3u"?(S="u",L.push(new Uint32Array(this.buffer,c,3)[H])):C==="vec4u"&&(S="u",L.push(new Uint32Array(this.buffer,c,4)[H]))}return L.length===2?h=t.getTypeInfo(`vec2${S}`):L.length===3?h=t.getTypeInfo(`vec3${S}`):L.length===4?h=t.getTypeInfo(`vec4${S}`):console.error(`GetDataValue: Invalid vector length ${L.length}`),new Ut(L,h,null)}return console.error(`GetDataValue: Unknown member ${_}`),null}return console.error(`GetDataValue: Type ${C} is not a struct`),null}}}i=i.postfix}const A=h.getTypeName();return A==="f32"?new ee(new Float32Array(this.buffer,c,1),h,this):A==="i32"?new ee(new Int32Array(this.buffer,c,1),h,this):A==="u32"?new ee(new Uint32Array(this.buffer,c,1),h,this):A==="vec2f"?new Ut(new Float32Array(this.buffer,c,2),h,this):A==="vec3f"?new Ut(new Float32Array(this.buffer,c,3),h,this):A==="vec4f"?new Ut(new Float32Array(this.buffer,c,4),h,this):A==="vec2i"?new Ut(new Int32Array(this.buffer,c,2),h,this):A==="vec3i"?new Ut(new Int32Array(this.buffer,c,3),h,this):A==="vec4i"?new Ut(new Int32Array(this.buffer,c,4),h,this):A==="vec2u"?new Ut(new Uint32Array(this.buffer,c,2),h,this):A==="vec3u"?new Ut(new Uint32Array(this.buffer,c,3),h,this):A==="vec4u"?new Ut(new Uint32Array(this.buffer,c,4),h,this):h instanceof Hh&&h.name==="atomic"?((r=h.format)===null||r===void 0?void 0:r.name)==="u32"?new ee(new Uint32Array(this.buffer,c,1)[0],h.format,this):((s=h.format)===null||s===void 0?void 0:s.name)==="i32"?new ee(new Int32Array(this.buffer,c,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=h.format)===null||o===void 0?void 0:o.name}`),null):new to(this.buffer,h,c,this)}toString(){let t="";if(this.typeInfo instanceof zu)if(this.typeInfo.format.name==="f32"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}`;for(let n=1;n<i.length;++n)t+=`, ${i[n]}`}else if(this.typeInfo.format.name==="i32"){const i=new Int32Array(this.buffer,this.offset);t=`[${i[0]}`;for(let n=1;n<i.length;++n)t+=`, ${i[n]}`}else if(this.typeInfo.format.name==="u32"){const i=new Uint32Array(this.buffer,this.offset);t=`[${i[0]}`;for(let n=1;n<i.length;++n)t+=`, ${i[n]}`}else if(this.typeInfo.format.name==="vec2f"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}, ${i[1]}]`;for(let n=1;n<i.length/2;++n)t+=`, [${i[2*n]}, ${i[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}, ${i[1]}, ${i[2]}]`;for(let n=4;n<i.length;n+=4)t+=`, [${i[n]}, ${i[n+1]}, ${i[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const i=new Float32Array(this.buffer,this.offset);t=`[${i[0]}, ${i[1]}, ${i[2]}, ${i[3]}]`;for(let n=4;n<i.length;n+=4)t+=`, [${i[n]}, ${i[n+1]}, ${i[n+2]}, ${i[n+3]}]`}else t="[...]";else this.typeInfo instanceof Uu?t+="{...}":t="[...]";return t}}class su extends Ha{constructor(t,i,n,r){super(i,null),this.data=t,this.descriptor=n,this.view=r}clone(){return new su(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var t,i;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(t=n[0])!==null&&t!==void 0?t:0:n instanceof Object&&(i=n.width)!==null&&i!==void 0?i:0}get height(){var t,i;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(t=n[1])!==null&&t!==void 0?t:0:n instanceof Object&&(i=n.height)!==null&&i!==void 0?i:0}get depthOrArrayLayers(){var t,i;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(t=n[2])!==null&&t!==void 0?t:0:n instanceof Object&&(i=n.depthOrArrayLayers)!==null&&i!==void 0?i:0}get format(){var t;return this.descriptor&&(t=this.descriptor.format)!==null&&t!==void 0?t:"rgba8unorm"}get sampleCount(){var t;return this.descriptor&&(t=this.descriptor.sampleCount)!==null&&t!==void 0?t:1}get mipLevelCount(){var t;return this.descriptor&&(t=this.descriptor.mipLevelCount)!==null&&t!==void 0?t:1}get dimension(){var t;return this.descriptor&&(t=this.descriptor.dimension)!==null&&t!==void 0?t:"2d"}getMipLevelSize(t){if(t>=this.mipLevelCount)return[0,0,0];const i=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<i.length;++n)i[n]=Math.max(1,i[n]>>t);return i}get texelByteSize(){const t=this.format,i=S1[t];return i?i.isDepthStencil?4:i.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const t=this.format,i=S1[t];return!!i&&i.isDepthStencil}getGpuSize(){const t=this.format,i=S1[t],n=this.width;if(!t||n<=0||!i)return-1;const r=this.height,s=this.depthOrArrayLayers,o=this.dimension;return n/i.blockWidth*(o==="1d"?1:r/i.blockHeight)*i.bytesPerBlock*s}getPixel(t,i,n=0,r=0){const s=this.texelByteSize,o=this.bytesPerRow,c=this.height,h=this.data[r];return eV(new Uint8Array(h),t,i,n,r,c,o,s,this.format)}setPixel(t,i,n,r,s){const o=this.texelByteSize,c=this.bytesPerRow,h=this.height,A=this.data[r];(function(_,C,S,L,N,U,H,j,tt,K){const Q=L*(H>>=N)*(U>>=N)+S*H+C*j;switch(tt){case"r8unorm":return void er(_,Q,"8unorm",1,K);case"r8snorm":return void er(_,Q,"8snorm",1,K);case"r8uint":return void er(_,Q,"8uint",1,K);case"r8sint":return void er(_,Q,"8sint",1,K);case"rg8unorm":return void er(_,Q,"8unorm",2,K);case"rg8snorm":return void er(_,Q,"8snorm",2,K);case"rg8uint":return void er(_,Q,"8uint",2,K);case"rg8sint":return void er(_,Q,"8sint",2,K);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void er(_,Q,"8unorm",4,K);case"rgba8snorm":return void er(_,Q,"8snorm",4,K);case"rgba8uint":return void er(_,Q,"8uint",4,K);case"rgba8sint":return void er(_,Q,"8sint",4,K);case"r16uint":return void er(_,Q,"16uint",1,K);case"r16sint":return void er(_,Q,"16sint",1,K);case"r16float":return void er(_,Q,"16float",1,K);case"rg16uint":return void er(_,Q,"16uint",2,K);case"rg16sint":return void er(_,Q,"16sint",2,K);case"rg16float":return void er(_,Q,"16float",2,K);case"rgba16uint":return void er(_,Q,"16uint",4,K);case"rgba16sint":return void er(_,Q,"16sint",4,K);case"rgba16float":return void er(_,Q,"16float",4,K);case"r32uint":return void er(_,Q,"32uint",1,K);case"r32sint":return void er(_,Q,"32sint",1,K);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void er(_,Q,"32float",1,K);case"rg32uint":return void er(_,Q,"32uint",2,K);case"rg32sint":return void er(_,Q,"32sint",2,K);case"rg32float":return void er(_,Q,"32float",2,K);case"rgba32uint":return void er(_,Q,"32uint",4,K);case"rgba32sint":return void er(_,Q,"32sint",4,K);case"rgba32float":return void er(_,Q,"32float",4,K);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(A),t,i,n,r,h,c,o,this.format,s)}}(e=>{e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(ie||(ie={}));class ne{constructor(t,i,n){this.name=t,this.type=i,this.rule=n}toString(){return this.name}}class Dt{}me=Dt,Dt.none=new ne("",ie.reserved,""),Dt.eof=new ne("EOF",ie.token,""),Dt.reserved={asm:new ne("asm",ie.reserved,"asm"),bf16:new ne("bf16",ie.reserved,"bf16"),do:new ne("do",ie.reserved,"do"),enum:new ne("enum",ie.reserved,"enum"),f16:new ne("f16",ie.reserved,"f16"),f64:new ne("f64",ie.reserved,"f64"),handle:new ne("handle",ie.reserved,"handle"),i8:new ne("i8",ie.reserved,"i8"),i16:new ne("i16",ie.reserved,"i16"),i64:new ne("i64",ie.reserved,"i64"),mat:new ne("mat",ie.reserved,"mat"),premerge:new ne("premerge",ie.reserved,"premerge"),regardless:new ne("regardless",ie.reserved,"regardless"),typedef:new ne("typedef",ie.reserved,"typedef"),u8:new ne("u8",ie.reserved,"u8"),u16:new ne("u16",ie.reserved,"u16"),u64:new ne("u64",ie.reserved,"u64"),unless:new ne("unless",ie.reserved,"unless"),using:new ne("using",ie.reserved,"using"),vec:new ne("vec",ie.reserved,"vec"),void:new ne("void",ie.reserved,"void")},Dt.keywords={array:new ne("array",ie.keyword,"array"),atomic:new ne("atomic",ie.keyword,"atomic"),bool:new ne("bool",ie.keyword,"bool"),f32:new ne("f32",ie.keyword,"f32"),i32:new ne("i32",ie.keyword,"i32"),mat2x2:new ne("mat2x2",ie.keyword,"mat2x2"),mat2x3:new ne("mat2x3",ie.keyword,"mat2x3"),mat2x4:new ne("mat2x4",ie.keyword,"mat2x4"),mat3x2:new ne("mat3x2",ie.keyword,"mat3x2"),mat3x3:new ne("mat3x3",ie.keyword,"mat3x3"),mat3x4:new ne("mat3x4",ie.keyword,"mat3x4"),mat4x2:new ne("mat4x2",ie.keyword,"mat4x2"),mat4x3:new ne("mat4x3",ie.keyword,"mat4x3"),mat4x4:new ne("mat4x4",ie.keyword,"mat4x4"),ptr:new ne("ptr",ie.keyword,"ptr"),sampler:new ne("sampler",ie.keyword,"sampler"),sampler_comparison:new ne("sampler_comparison",ie.keyword,"sampler_comparison"),struct:new ne("struct",ie.keyword,"struct"),texture_1d:new ne("texture_1d",ie.keyword,"texture_1d"),texture_2d:new ne("texture_2d",ie.keyword,"texture_2d"),texture_2d_array:new ne("texture_2d_array",ie.keyword,"texture_2d_array"),texture_3d:new ne("texture_3d",ie.keyword,"texture_3d"),texture_cube:new ne("texture_cube",ie.keyword,"texture_cube"),texture_cube_array:new ne("texture_cube_array",ie.keyword,"texture_cube_array"),texture_multisampled_2d:new ne("texture_multisampled_2d",ie.keyword,"texture_multisampled_2d"),texture_storage_1d:new ne("texture_storage_1d",ie.keyword,"texture_storage_1d"),texture_storage_2d:new ne("texture_storage_2d",ie.keyword,"texture_storage_2d"),texture_storage_2d_array:new ne("texture_storage_2d_array",ie.keyword,"texture_storage_2d_array"),texture_storage_3d:new ne("texture_storage_3d",ie.keyword,"texture_storage_3d"),texture_depth_2d:new ne("texture_depth_2d",ie.keyword,"texture_depth_2d"),texture_depth_2d_array:new ne("texture_depth_2d_array",ie.keyword,"texture_depth_2d_array"),texture_depth_cube:new ne("texture_depth_cube",ie.keyword,"texture_depth_cube"),texture_depth_cube_array:new ne("texture_depth_cube_array",ie.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ne("texture_depth_multisampled_2d",ie.keyword,"texture_depth_multisampled_2d"),texture_external:new ne("texture_external",ie.keyword,"texture_external"),u32:new ne("u32",ie.keyword,"u32"),vec2:new ne("vec2",ie.keyword,"vec2"),vec3:new ne("vec3",ie.keyword,"vec3"),vec4:new ne("vec4",ie.keyword,"vec4"),bitcast:new ne("bitcast",ie.keyword,"bitcast"),block:new ne("block",ie.keyword,"block"),break:new ne("break",ie.keyword,"break"),case:new ne("case",ie.keyword,"case"),continue:new ne("continue",ie.keyword,"continue"),continuing:new ne("continuing",ie.keyword,"continuing"),default:new ne("default",ie.keyword,"default"),diagnostic:new ne("diagnostic",ie.keyword,"diagnostic"),discard:new ne("discard",ie.keyword,"discard"),else:new ne("else",ie.keyword,"else"),enable:new ne("enable",ie.keyword,"enable"),fallthrough:new ne("fallthrough",ie.keyword,"fallthrough"),false:new ne("false",ie.keyword,"false"),fn:new ne("fn",ie.keyword,"fn"),for:new ne("for",ie.keyword,"for"),function:new ne("function",ie.keyword,"function"),if:new ne("if",ie.keyword,"if"),let:new ne("let",ie.keyword,"let"),const:new ne("const",ie.keyword,"const"),loop:new ne("loop",ie.keyword,"loop"),while:new ne("while",ie.keyword,"while"),private:new ne("private",ie.keyword,"private"),read:new ne("read",ie.keyword,"read"),read_write:new ne("read_write",ie.keyword,"read_write"),return:new ne("return",ie.keyword,"return"),requires:new ne("requires",ie.keyword,"requires"),storage:new ne("storage",ie.keyword,"storage"),switch:new ne("switch",ie.keyword,"switch"),true:new ne("true",ie.keyword,"true"),alias:new ne("alias",ie.keyword,"alias"),type:new ne("type",ie.keyword,"type"),uniform:new ne("uniform",ie.keyword,"uniform"),var:new ne("var",ie.keyword,"var"),override:new ne("override",ie.keyword,"override"),workgroup:new ne("workgroup",ie.keyword,"workgroup"),write:new ne("write",ie.keyword,"write"),r8unorm:new ne("r8unorm",ie.keyword,"r8unorm"),r8snorm:new ne("r8snorm",ie.keyword,"r8snorm"),r8uint:new ne("r8uint",ie.keyword,"r8uint"),r8sint:new ne("r8sint",ie.keyword,"r8sint"),r16uint:new ne("r16uint",ie.keyword,"r16uint"),r16sint:new ne("r16sint",ie.keyword,"r16sint"),r16float:new ne("r16float",ie.keyword,"r16float"),rg8unorm:new ne("rg8unorm",ie.keyword,"rg8unorm"),rg8snorm:new ne("rg8snorm",ie.keyword,"rg8snorm"),rg8uint:new ne("rg8uint",ie.keyword,"rg8uint"),rg8sint:new ne("rg8sint",ie.keyword,"rg8sint"),r32uint:new ne("r32uint",ie.keyword,"r32uint"),r32sint:new ne("r32sint",ie.keyword,"r32sint"),r32float:new ne("r32float",ie.keyword,"r32float"),rg16uint:new ne("rg16uint",ie.keyword,"rg16uint"),rg16sint:new ne("rg16sint",ie.keyword,"rg16sint"),rg16float:new ne("rg16float",ie.keyword,"rg16float"),rgba8unorm:new ne("rgba8unorm",ie.keyword,"rgba8unorm"),rgba8unorm_srgb:new ne("rgba8unorm_srgb",ie.keyword,"rgba8unorm_srgb"),rgba8snorm:new ne("rgba8snorm",ie.keyword,"rgba8snorm"),rgba8uint:new ne("rgba8uint",ie.keyword,"rgba8uint"),rgba8sint:new ne("rgba8sint",ie.keyword,"rgba8sint"),bgra8unorm:new ne("bgra8unorm",ie.keyword,"bgra8unorm"),bgra8unorm_srgb:new ne("bgra8unorm_srgb",ie.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ne("rgb10a2unorm",ie.keyword,"rgb10a2unorm"),rg11b10float:new ne("rg11b10float",ie.keyword,"rg11b10float"),rg32uint:new ne("rg32uint",ie.keyword,"rg32uint"),rg32sint:new ne("rg32sint",ie.keyword,"rg32sint"),rg32float:new ne("rg32float",ie.keyword,"rg32float"),rgba16uint:new ne("rgba16uint",ie.keyword,"rgba16uint"),rgba16sint:new ne("rgba16sint",ie.keyword,"rgba16sint"),rgba16float:new ne("rgba16float",ie.keyword,"rgba16float"),rgba32uint:new ne("rgba32uint",ie.keyword,"rgba32uint"),rgba32sint:new ne("rgba32sint",ie.keyword,"rgba32sint"),rgba32float:new ne("rgba32float",ie.keyword,"rgba32float"),static_assert:new ne("static_assert",ie.keyword,"static_assert")},Dt.tokens={decimal_float_literal:new ne("decimal_float_literal",ie.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new ne("hex_float_literal",ie.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new ne("int_literal",ie.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ne("uint_literal",ie.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new ne("name",ie.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new ne("ident",ie.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new ne("and",ie.token,"&"),and_and:new ne("and_and",ie.token,"&&"),arrow:new ne("arrow ",ie.token,"->"),attr:new ne("attr",ie.token,"@"),forward_slash:new ne("forward_slash",ie.token,"/"),bang:new ne("bang",ie.token,"!"),bracket_left:new ne("bracket_left",ie.token,"["),bracket_right:new ne("bracket_right",ie.token,"]"),brace_left:new ne("brace_left",ie.token,"{"),brace_right:new ne("brace_right",ie.token,"}"),colon:new ne("colon",ie.token,":"),comma:new ne("comma",ie.token,","),equal:new ne("equal",ie.token,"="),equal_equal:new ne("equal_equal",ie.token,"=="),not_equal:new ne("not_equal",ie.token,"!="),greater_than:new ne("greater_than",ie.token,">"),greater_than_equal:new ne("greater_than_equal",ie.token,">="),shift_right:new ne("shift_right",ie.token,">>"),less_than:new ne("less_than",ie.token,"<"),less_than_equal:new ne("less_than_equal",ie.token,"<="),shift_left:new ne("shift_left",ie.token,"<<"),modulo:new ne("modulo",ie.token,"%"),minus:new ne("minus",ie.token,"-"),minus_minus:new ne("minus_minus",ie.token,"--"),period:new ne("period",ie.token,"."),plus:new ne("plus",ie.token,"+"),plus_plus:new ne("plus_plus",ie.token,"++"),or:new ne("or",ie.token,"|"),or_or:new ne("or_or",ie.token,"||"),paren_left:new ne("paren_left",ie.token,"("),paren_right:new ne("paren_right",ie.token,")"),semicolon:new ne("semicolon",ie.token,";"),star:new ne("star",ie.token,"*"),tilde:new ne("tilde",ie.token,"~"),underscore:new ne("underscore",ie.token,"_"),xor:new ne("xor",ie.token,"^"),plus_equal:new ne("plus_equal",ie.token,"+="),minus_equal:new ne("minus_equal",ie.token,"-="),times_equal:new ne("times_equal",ie.token,"*="),division_equal:new ne("division_equal",ie.token,"/="),modulo_equal:new ne("modulo_equal",ie.token,"%="),and_equal:new ne("and_equal",ie.token,"&="),or_equal:new ne("or_equal",ie.token,"|="),xor_equal:new ne("xor_equal",ie.token,"^="),shift_right_equal:new ne("shift_right_equal",ie.token,">>="),shift_left_equal:new ne("shift_left_equal",ie.token,"<<=")},Dt.simpleTokens={"@":me.tokens.attr,"{":me.tokens.brace_left,"}":me.tokens.brace_right,":":me.tokens.colon,",":me.tokens.comma,"(":me.tokens.paren_left,")":me.tokens.paren_right,";":me.tokens.semicolon},Dt.literalTokens={"&":me.tokens.and,"&&":me.tokens.and_and,"->":me.tokens.arrow,"/":me.tokens.forward_slash,"!":me.tokens.bang,"[":me.tokens.bracket_left,"]":me.tokens.bracket_right,"=":me.tokens.equal,"==":me.tokens.equal_equal,"!=":me.tokens.not_equal,">":me.tokens.greater_than,">=":me.tokens.greater_than_equal,">>":me.tokens.shift_right,"<":me.tokens.less_than,"<=":me.tokens.less_than_equal,"<<":me.tokens.shift_left,"%":me.tokens.modulo,"-":me.tokens.minus,"--":me.tokens.minus_minus,".":me.tokens.period,"+":me.tokens.plus,"++":me.tokens.plus_plus,"|":me.tokens.or,"||":me.tokens.or_or,"*":me.tokens.star,"~":me.tokens.tilde,_:me.tokens.underscore,"^":me.tokens.xor,"+=":me.tokens.plus_equal,"-=":me.tokens.minus_equal,"*=":me.tokens.times_equal,"/=":me.tokens.division_equal,"%=":me.tokens.modulo_equal,"&=":me.tokens.and_equal,"|=":me.tokens.or_equal,"^=":me.tokens.xor_equal,">>=":me.tokens.shift_right_equal,"<<=":me.tokens.shift_left_equal},Dt.regexTokens={decimal_float_literal:me.tokens.decimal_float_literal,hex_float_literal:me.tokens.hex_float_literal,int_literal:me.tokens.int_literal,uint_literal:me.tokens.uint_literal,ident:me.tokens.ident},Dt.storage_class=[me.keywords.function,me.keywords.private,me.keywords.workgroup,me.keywords.uniform,me.keywords.storage],Dt.access_mode=[me.keywords.read,me.keywords.write,me.keywords.read_write],Dt.sampler_type=[me.keywords.sampler,me.keywords.sampler_comparison],Dt.sampled_texture_type=[me.keywords.texture_1d,me.keywords.texture_2d,me.keywords.texture_2d_array,me.keywords.texture_3d,me.keywords.texture_cube,me.keywords.texture_cube_array],Dt.multisampled_texture_type=[me.keywords.texture_multisampled_2d],Dt.storage_texture_type=[me.keywords.texture_storage_1d,me.keywords.texture_storage_2d,me.keywords.texture_storage_2d_array,me.keywords.texture_storage_3d],Dt.depth_texture_type=[me.keywords.texture_depth_2d,me.keywords.texture_depth_2d_array,me.keywords.texture_depth_cube,me.keywords.texture_depth_cube_array,me.keywords.texture_depth_multisampled_2d],Dt.texture_external_type=[me.keywords.texture_external],Dt.any_texture_type=[...me.sampled_texture_type,...me.multisampled_texture_type,...me.storage_texture_type,...me.depth_texture_type,...me.texture_external_type],Dt.texel_format=[me.keywords.r8unorm,me.keywords.r8snorm,me.keywords.r8uint,me.keywords.r8sint,me.keywords.r16uint,me.keywords.r16sint,me.keywords.r16float,me.keywords.rg8unorm,me.keywords.rg8snorm,me.keywords.rg8uint,me.keywords.rg8sint,me.keywords.r32uint,me.keywords.r32sint,me.keywords.r32float,me.keywords.rg16uint,me.keywords.rg16sint,me.keywords.rg16float,me.keywords.rgba8unorm,me.keywords.rgba8unorm_srgb,me.keywords.rgba8snorm,me.keywords.rgba8uint,me.keywords.rgba8sint,me.keywords.bgra8unorm,me.keywords.bgra8unorm_srgb,me.keywords.rgb10a2unorm,me.keywords.rg11b10float,me.keywords.rg32uint,me.keywords.rg32sint,me.keywords.rg32float,me.keywords.rgba16uint,me.keywords.rgba16sint,me.keywords.rgba16float,me.keywords.rgba32uint,me.keywords.rgba32sint,me.keywords.rgba32float],Dt.const_literal=[me.tokens.int_literal,me.tokens.uint_literal,me.tokens.decimal_float_literal,me.tokens.hex_float_literal,me.keywords.true,me.keywords.false],Dt.literal_or_ident=[me.tokens.ident,me.tokens.int_literal,me.tokens.uint_literal,me.tokens.decimal_float_literal,me.tokens.hex_float_literal,me.tokens.name],Dt.element_count_expression=[me.tokens.int_literal,me.tokens.uint_literal,me.tokens.ident],Dt.template_types=[me.keywords.vec2,me.keywords.vec3,me.keywords.vec4,me.keywords.mat2x2,me.keywords.mat2x3,me.keywords.mat2x4,me.keywords.mat3x2,me.keywords.mat3x3,me.keywords.mat3x4,me.keywords.mat4x2,me.keywords.mat4x3,me.keywords.mat4x4,me.keywords.atomic,me.keywords.bitcast,...me.any_texture_type],Dt.attribute_name=[me.tokens.ident,me.keywords.block,me.keywords.diagnostic],Dt.assignment_operators=[me.tokens.equal,me.tokens.plus_equal,me.tokens.minus_equal,me.tokens.times_equal,me.tokens.division_equal,me.tokens.modulo_equal,me.tokens.and_equal,me.tokens.or_equal,me.tokens.xor_equal,me.tokens.shift_right_equal,me.tokens.shift_left_equal],Dt.increment_operators=[me.tokens.plus_plus,me.tokens.minus_minus];class VS{constructor(t,i,n,r,s){this.type=t,this.lexeme=i,this.line=n,this.start=r,this.end=s}toString(){return this.lexeme}isTemplateType(){return Dt.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Dt.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class cV{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new VS(Dt.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const i=Dt.simpleTokens[t];if(i)return this._addToken(i),!0;let n=Dt.none;const r=this._isAlpha(t),s=t==="_";if(this._isAlphaNumeric(t)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)t+=this._advance(),o=this._peekAhead()}if(r){const o=Dt.keywords[t];if(o)return this._addToken(o),!0}if(r||s)return this._addToken(Dt.tokens.ident),!0;for(;;){let o=this._findType(t);const c=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(c=="=")return this._current++,t+=c,this._addToken(Dt.tokens.minus_equal),!0;if(c=="-")return this._current++,t+=c,this._addToken(Dt.tokens.minus_minus),!0;const h=this._tokens.length-1;if((Dt.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==Dt.tokens.paren_right)&&c!=">")return this._addToken(o),!0}if(t==">"&&(c==">"||c=="=")){let h=!1,A=this._tokens.length-1;for(let _=0;_<5&&A>=0&&Dt.assignment_operators.indexOf(this._tokens[A].type)===-1;++_,--A)if(this._tokens[A].type===Dt.tokens.less_than){A>0&&this._tokens[A-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(o),!0}if(o===Dt.none){let h=t,A=0;const _=2;for(let C=0;C<_;++C)if(h+=this._peekAhead(C),o=this._findType(h),o!==Dt.none){A=C;break}if(o===Dt.none)return n!==Dt.none&&(this._current--,this._addToken(n),!0);t=h,this._current+=A+1}if(n=o,this._isAtEnd())break;t+=this._advance()}return n!==Dt.none&&(this._addToken(n),!0)}_findType(t){for(const i in Dt.regexTokens){const n=Dt.regexTokens[i];if(this._match(t,n.rule))return n}return Dt.literalTokens[t]||Dt.none}_match(t,i){const n=i.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return!this._isNumeric(t)&&!this._isWhitespace(t)&&t!=="_"&&t!=="."&&t!=="("&&t!==")"&&t!=="["&&t!=="]"&&t!=="{"&&t!=="}"&&t!==","&&t!==";"&&t!==":"&&t!=="="&&t!=="!"&&t!=="<"&&t!==">"&&t!=="+"&&t!=="-"&&t!=="*"&&t!=="/"&&t!=="%"&&t!=="&"&&t!=="|"&&t!=="^"&&t!=="~"&&t!=="@"&&t!=="#"&&t!=="?"&&t!=="'"&&t!=="`"&&t!=='"'&&t!=="\\"&&t!==`
`&&t!=="\r"&&t!=="	"&&t!=="\0"}_isNumeric(t){return t>="0"&&t<="9"}_isAlphaNumeric(t){return this._isAlpha(t)||this._isNumeric(t)||t==="_"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let i=this._source[this._current];return t=t||0,t++,this._current+=t,i}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const i=this._source.substring(this._start,this._current);this._tokens.push(new VS(t,i,this._line,this._start,this._current))}}function pi(e){return Array.isArray(e)||e?.buffer instanceof ArrayBuffer}const l0=new Float32Array(1),lV=new Uint32Array(l0.buffer),uV=new Uint32Array(l0.buffer),u0=new Int32Array(1),hV=new Float32Array(u0.buffer),fV=new Uint32Array(u0.buffer),h0=new Uint32Array(1),dV=new Float32Array(h0.buffer),pV=new Int32Array(h0.buffer);function HS(e,t,i){if(t===i)return e;if(t==="f32"){if(i==="i32"||i==="x32")return l0[0]=e,lV[0];if(i==="u32")return l0[0]=e,uV[0]}else if(t==="i32"||t==="x32"){if(i==="f32")return u0[0]=e,hV[0];if(i==="u32")return u0[0]=e,fV[0]}else if(t==="u32"){if(i==="f32")return h0[0]=e,dV[0];if(i==="i32"||i==="x32")return h0[0]=e,pV[0]}return console.error(`Unsupported cast from ${t} to ${i}`),e}class AV{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class f0{constructor(t,i){this.align=t,this.size=i}}class yl{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Yj,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}updateAST(t){for(const i of t)i instanceof jA&&this._functions.set(i.name,new AV(i));for(const i of t)if(i instanceof Hl){const n=this.getTypeInfo(i,null);n instanceof Uu&&this.structs.push(n)}for(const i of t)if(i instanceof R1)this.aliases.push(this._getAliasInfo(i));else if(i instanceof M1){const n=i,r=this._getAttributeNum(n.attributes,"id",0),s=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new Kj(n.name,s,n.attributes,r))}else if(this._isUniformVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),c=new r0(n.name,o,r,s,n.attributes,Gu.Uniform,n.access);c.access||(c.access="read"),this.uniforms.push(c)}else if(this._isStorageVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),c=this._isStorageTexture(o),h=new r0(n.name,o,r,s,n.attributes,c?Gu.StorageTexture:Gu.Storage,n.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),c=this._isStorageTexture(o),h=new r0(n.name,o,r,s,n.attributes,c?Gu.StorageTexture:Gu.Texture,n.access);h.access||(h.access="read"),c?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(i)){const n=i,r=this._getAttributeNum(n.attributes,"group",0),s=this._getAttributeNum(n.attributes,"binding",0),o=this.getTypeInfo(n.type,n.attributes),c=new r0(n.name,o,r,s,n.attributes,Gu.Sampler,n.access);this.samplers.push(c)}else if(i instanceof jA){const n=this._getAttribute(i,"vertex"),r=this._getAttribute(i,"fragment"),s=this._getAttribute(i,"compute"),o=n||r||s,c=new Zj(i.name,o?.name,i.attributes);c.attributes=i.attributes,c.startLine=i.startLine,c.endLine=i.endLine,this.functions.push(c),this._functions.get(i.name).info=c,o&&(this._functions.get(i.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(i,!!o),c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[o.name].push(c)),c.arguments=i.args.map(h=>new qj(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),c.returnType=i.returnType?this.getTypeInfo(i.returnType,i.attributes):null}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this._functions.values())i.node.search(n=>{var r,s,o;if(n instanceof jS){if(n.value)if(pi(n.value))for(const c of n.value)for(const h of this.overrides)c===h.name&&((r=i.info)===null||r===void 0||r.overrides.push(h));else for(const c of this.overrides)n.value===c.name&&((s=i.info)===null||s===void 0||s.overrides.push(c))}else if(n instanceof aa)for(const c of this.overrides)n.name===c.name&&((o=i.info)===null||o===void 0||o.overrides.push(c))});for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}getStructInfo(t){for(const i of this.structs)if(i.name==t)return i;return null}getOverrideInfo(t){for(const i of this.overrides)if(i.name==t)return i;return null}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const i of t.members)this._markStructsInUse(i.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const i=this._getAlias(t.name);i&&this._markStructsInUse(i)}}_addCalls(t,i){var n;for(const r of t.calls){const s=(n=this._functions.get(r.name))===null||n===void 0?void 0:n.info;s&&i.add(s)}}findResource(t,i,n){if(n){for(const r of this.entry.compute)if(r.name===n){for(const s of r.resources)if(s.group==t&&s.binding==i)return s}for(const r of this.entry.vertex)if(r.name===n){for(const s of r.resources)if(s.group==t&&s.binding==i)return s}for(const r of this.entry.fragment)if(r.name===n){for(const s of r.resources)if(s.group==t&&s.binding==i)return s}}for(const r of this.uniforms)if(r.group==t&&r.binding==i)return r;for(const r of this.storage)if(r.group==t&&r.binding==i)return r;for(const r of this.textures)if(r.group==t&&r.binding==i)return r;for(const r of this.samplers)if(r.group==t&&r.binding==i)return r;return null}_findResource(t){for(const i of this.uniforms)if(i.name==t)return i;for(const i of this.storage)if(i.name==t)return i;for(const i of this.textures)if(i.name==t)return i;for(const i of this.samplers)if(i.name==t)return i;return null}_markStructsFromAST(t){const i=this.getTypeInfo(t,null);this._markStructsInUse(i)}_findResources(t,i){const n=[],r=this,s=[];return t.search(o=>{if(o instanceof o0)s.push({});else if(o instanceof s0)s.pop();else if(o instanceof Vl){const c=o;i&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(o instanceof nl){const c=o;i&&c.type!==null&&this._markStructsFromAST(c.type)}else if(o instanceof VA){const c=o;i&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(o instanceof aa){const c=o;if(s.length>0&&s[s.length-1][c.name])return;const h=r._findResource(c.name);h&&n.push(h)}else if(o instanceof O1){const c=o,h=r._functions.get(c.name);h&&(i&&(h.inUse=!0),t.calls.add(h.node),h.resources===null&&(h.resources=r._findResources(h.node,i)),n.push(...h.resources))}else if(o instanceof P1){const c=o,h=r._functions.get(c.name);h&&(i&&(h.inUse=!0),t.calls.add(h.node),h.resources===null&&(h.resources=r._findResources(h.node,i)),n.push(...h.resources))}}),[...new Map(n.map(o=>[o.name,o])).values()]}getBindGroups(){const t=[];function i(n,r){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),r>=t[n].length&&(t[n].length=r+1)}for(const n of this.uniforms)i(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.storage)i(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.textures)i(n.group,n.binding),t[n.group][n.binding]=n;for(const n of this.samplers)i(n.group,n.binding),t[n.group][n.binding]=n;return t}_getOutputs(t,i=void 0){if(i===void 0&&(i=[]),t instanceof Hl)this._getStructOutputs(t,i);else{const n=this._getOutputInfo(t);n!==null&&i.push(n)}return i}_getStructOutputs(t,i){for(const n of t.members)if(n.type instanceof Hl)this._getStructOutputs(n.type,i);else{const r=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(r!==null){const s=this.getTypeInfo(n.type,n.type.attributes),o=this._parseInt(r.value),c=new mS(n.name,s,r.name,o);i.push(c)}}}_getOutputInfo(t){const i=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(i!==null){const n=this.getTypeInfo(t,t.attributes),r=this._parseInt(i.value);return new mS("",n,i.name,r)}return null}_getInputs(t,i=void 0){i===void 0&&(i=[]);for(const n of t)if(n.type instanceof Hl)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}return i}_getStructInputs(t,i){for(const n of t.members)if(n.type instanceof Hl)this._getStructInputs(n.type,i);else{const r=this._getInputInfo(n);r!==null&&i.push(r)}}_getInputInfo(t){const i=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(i!==null){const n=this._getAttribute(t,"interpolation"),r=this.getTypeInfo(t.type,t.attributes),s=this._parseInt(i.value),o=new Qj(t.name,r,i.name,s);return n!==null&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const i=parseInt(t);return isNaN(i)?t:i}_getAlias(t){for(const i of this.aliases)if(i.name==t)return i.type;return null}_getAliasInfo(t){return new Xj(t.name,this.getTypeInfo(t.type,null))}getTypeInfoByName(t){for(const i of this.structs)if(i.name==t)return i;for(const i of this.aliases)if(i.name==t)return i.type;return null}getTypeInfo(t,i=null){if(this._types.has(t))return this._types.get(t);if(t instanceof WA){const r=t,s=r.format?this.getTypeInfo(r.format,r.attributes):null,o=new zu(r.name,i);return o.format=s,o.count=r.count,this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof Hl){const r=t,s=new Uu(r.name,i);s.startLine=r.startLine,s.endLine=r.endLine;for(const o of r.members){const c=this.getTypeInfo(o.type,o.attributes);s.members.push(new gS(o.name,c,o.attributes))}return this._types.set(t,s),this._updateTypeInfo(s),s}if(t instanceof JA){const r=t,s=r.format instanceof Ne,o=r.format?s?this.getTypeInfo(r.format,null):new Da(r.format,null):null,c=new Hh(r.name,o,i,r.access);return this._types.set(t,c),this._updateTypeInfo(c),c}if(t instanceof ue){const r=t,s=r.format?this.getTypeInfo(r.format,null):null,o=new Hh(r.name,s,i,r.access);return this._types.set(t,o),this._updateTypeInfo(o),o}const n=new Da(t.name,i);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var i,n,r;const s=this._getTypeSize(t);if(t.size=(i=s?.size)!==null&&i!==void 0?i:0,t instanceof zu&&t.format){const o=this._getTypeSize(t.format);t.stride=Math.max((n=o?.size)!==null&&n!==void 0?n:0,(r=o?.align)!==null&&r!==void 0?r:0),this._updateTypeInfo(t.format)}t instanceof Uu&&this._updateStructInfo(t)}_updateStructInfo(t){var i;let n=0,r=0,s=0,o=0;for(let c=0,h=t.members.length;c<h;++c){const A=t.members[c],_=this._getTypeSize(A);if(!_)continue;(i=this._getAlias(A.type.name))!==null&&i!==void 0||A.type;const C=_.align,S=_.size;n=this._roundUp(C,n+r),r=S,s=n,o=Math.max(o,C),A.offset=n,A.size=S,this._updateTypeInfo(A.type)}t.size=this._roundUp(o,s+r),t.align=o}_getTypeSize(t){var i,n;if(t==null)return null;const r=this._getAttributeNum(t.attributes,"size",0),s=this._getAttributeNum(t.attributes,"align",0);if(t instanceof gS&&(t=t.type),t instanceof Da){const o=this._getAlias(t.name);o!==null&&(t=o)}{const o=yl._typeInfo[t.name];if(o!==void 0){const c=((i=t.format)===null||i===void 0?void 0:i.name)==="f16"?2:1;return new f0(Math.max(s,o.align/c),Math.max(r,o.size/c))}}{const o=yl._typeInfo[t.name.substring(0,t.name.length-1)];if(o){const c=t.name[t.name.length-1]==="h"?2:1;return new f0(Math.max(s,o.align/c),Math.max(r,o.size/c))}}if(t instanceof zu){let o=t,c=8,h=8;const A=this._getTypeSize(o.format);return A!==null&&(h=A.size,c=A.align),h=o.count*this._getAttributeNum((n=t?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(c,h)),r&&(h=r),new f0(Math.max(s,c),Math.max(r,h))}if(t instanceof Uu){let o=0,c=0,h=0,A=0,_=0;for(const C of t.members){const S=this._getTypeSize(C.type);S!==null&&(o=Math.max(S.align,o),h=this._roundUp(S.align,h+A),A=S.size,_=h)}return c=this._roundUp(o,_+A),new f0(Math.max(s,o),Math.max(r,c))}return null}_isUniformVar(t){return t instanceof Vl&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Vl&&t.storage=="storage"}_isTextureVar(t){return t instanceof Vl&&t.type!==null&&yl._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Vl&&t.type!==null&&yl._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,i){const n=t;if(!n||!n.attributes)return null;const r=n.attributes;for(let s of r)if(s.name==i)return s;return null}_getAttributeNum(t,i,n){if(t===null)return n;for(let r of t)if(r.name==i){let s=r!==null&&r.value!==null?r.value:n;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):n}return n}_roundUp(t,i){return Math.ceil(i/t)*t}}yl._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},yl._textureTypes=Dt.any_texture_type.map(e=>e.name),yl._samplerTypes=Dt.sampler_type.map(e=>e.name);class RE{constructor(t,i,n){this.name=t,this.value=i,this.node=n}clone(){return new RE(this.name,this.value,this.node)}}class DE{constructor(t){this.name=t.name,this.node=t}clone(){return new DE(this.node)}}class OE{constructor(t){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",t&&(this.parent=t,this.currentFunctionName=t.currentFunctionName)}getVariable(t){var i;return this.variables.has(t)?(i=this.variables.get(t))!==null&&i!==void 0?i:null:this.parent?this.parent.getVariable(t):null}getFunction(t){var i;return this.functions.has(t)?(i=this.functions.get(t))!==null&&i!==void 0?i:null:this.parent?this.parent.getFunction(t):null}createVariable(t,i,n){this.variables.set(t,new RE(t,i,n??null))}setVariable(t,i,n){const r=this.getVariable(t);r!==null?r.value=i:this.createVariable(t,i,n)}getVariableValue(t){var i;return(i=this.getVariable(t)?.value)!==null&&i!==void 0?i:null}clone(){return new OE(this)}}class gV{evalExpression(t,i){return null}getTypeInfo(t){return null}getVariableName(t,i){return""}}class mV{constructor(t){this.exec=t}getTypeInfo(t){return this.exec.getTypeInfo(t)}All(t,i){const n=this.exec.evalExpression(t.args[0],i);let r=!0;if(n instanceof Ut)return n.data.forEach(s=>{s||(r=!1)}),new ee(r?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${t.line}`)}Any(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut){const r=n.data.some(s=>s);return new ee(r?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${t.line}`)}Select(t,i){const n=this.exec.evalExpression(t.args[2],i);if(!(n instanceof ee))throw new Error(`Select() expects a bool condition. Line ${t.line}`);return n.value?this.exec.evalExpression(t.args[1],i):this.exec.evalExpression(t.args[0],i)}ArrayLength(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.evalExpression(n,i);if(r instanceof to&&r.typeInfo.size===0){const s=r.typeInfo,o=r.buffer.byteLength/s.stride;return new ee(o,this.getTypeInfo("u32"))}return new ee(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.abs(s)),n.typeInfo);const r=n;return new ee(Math.abs(r.value),r.typeInfo)}Acos(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.acos(s)),n.typeInfo);const r=n;return new ee(Math.acos(r.value),n.typeInfo)}Acosh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.acosh(s)),n.typeInfo);const r=n;return new ee(Math.acosh(r.value),n.typeInfo)}Asin(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.asin(s)),n.typeInfo);const r=n;return new ee(Math.asin(r.value),n.typeInfo)}Asinh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.asinh(s)),n.typeInfo);const r=n;return new ee(Math.asinh(r.value),n.typeInfo)}Atan(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.atan(s)),n.typeInfo);const r=n;return new ee(Math.atan(r.value),n.typeInfo)}Atanh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.atanh(s)),n.typeInfo);const r=n;return new ee(Math.atanh(r.value),n.typeInfo)}Atan2(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut)return new Ut(n.data.map((c,h)=>Math.atan2(c,r.data[h])),n.typeInfo);const s=n,o=r;return new ee(Math.atan2(s.value,o.value),n.typeInfo)}Ceil(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.ceil(s)),n.typeInfo);const r=n;return new ee(Math.ceil(r.value),n.typeInfo)}_clamp(t,i,n){return Math.min(Math.max(t,i),n)}Clamp(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof Ut&&r instanceof Ut&&s instanceof Ut)return new Ut(n.data.map((A,_)=>this._clamp(A,r.data[_],s.data[_])),n.typeInfo);const o=n,c=r,h=s;return new ee(this._clamp(o.value,c.value,h.value),n.typeInfo)}Cos(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.cos(s)),n.typeInfo);const r=n;return new ee(Math.cos(r.value),n.typeInfo)}Cosh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.cosh(s)),n.typeInfo);const r=n;return new ee(Math.cos(r.value),n.typeInfo)}CountLeadingZeros(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.clz32(s)),n.typeInfo);const r=n;return new ee(Math.clz32(r.value),n.typeInfo)}_countOneBits(t){let i=0;for(;t!==0;)1&t&&i++,t>>=1;return i}CountOneBits(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>this._countOneBits(s)),n.typeInfo);const r=n;return new ee(this._countOneBits(r.value),n.typeInfo)}_countTrailingZeros(t){if(t===0)return 32;let i=0;for(;!(1&t);)t>>=1,i++;return i}CountTrailingZeros(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>this._countTrailingZeros(s)),n.typeInfo);const r=n;return new ee(this._countTrailingZeros(r.value),n.typeInfo)}Cross(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut){if(n.data.length!==3||r.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${t.line}`),null;const s=n.data,o=r.data;return new Ut([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${t.line}`),null}Degrees(t,i){const n=this.exec.evalExpression(t.args[0],i),r=180/Math.PI;return n instanceof Ut?new Ut(n.data.map(s=>s*r),n.typeInfo):new ee(n.value*r,this.getTypeInfo("f32"))}Determinant(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof sn){const r=n.data,s=n.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new ee(r[0]*r[3]-r[1]*r[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new ee(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new ee(r[0]*(r[4]*r[8]-r[5]*r[7])-r[1]*(r[3]*r[8]-r[5]*r[6])+r[2]*(r[3]*r[7]-r[4]*r[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${t.line}`),null}Distance(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut){let c=0;for(let h=0;h<n.data.length;++h)c+=(n.data[h]-r.data[h])*(n.data[h]-r.data[h]);return new ee(Math.sqrt(c),this.getTypeInfo("f32"))}const s=n,o=r;return new ee(Math.abs(s.value-o.value),n.typeInfo)}_dot(t,i){let n=0;for(let r=0;r<t.length;++r)n+=i[r]*t[r];return n}Dot(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);return n instanceof Ut&&r instanceof Ut?new ee(this._dot(n.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${t.line}`),null)}Dot4U8Packed(t,i){return console.error(`TODO: dot4U8Packed. Line ${t.line}`),null}Dot4I8Packed(t,i){return console.error(`TODO: dot4I8Packed. Line ${t.line}`),null}Exp(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.exp(s)),n.typeInfo);const r=n;return new ee(Math.exp(r.value),n.typeInfo)}Exp2(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.pow(2,s)),n.typeInfo);const r=n;return new ee(Math.pow(2,r.value),n.typeInfo)}ExtractBits(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(r.typeInfo.name!=="u32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${t.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${t.line}`),null;const o=r.value,c=s.value;if(n instanceof Ut)return new Ut(n.data.map(A=>A>>o&(1<<c)-1),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${t.line}`),null;const h=n.value;return new ee(h>>o&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof Ut&&r instanceof Ut&&s instanceof Ut){const o=this._dot(r.data,s.data);return new Ut(o<0?Array.from(n.data):n.data.map(c=>-c),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${t.line}`),null}_firstLeadingBit(t){return t===0?-1:31-Math.clz32(t)}FirstLeadingBit(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>this._firstLeadingBit(s)),n.typeInfo);const r=n;return new ee(this._firstLeadingBit(r.value),n.typeInfo)}_firstTrailingBit(t){return t===0?-1:Math.log2(t&-t)}FirstTrailingBit(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>this._firstTrailingBit(s)),n.typeInfo);const r=n;return new ee(this._firstTrailingBit(r.value),n.typeInfo)}Floor(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.floor(s)),n.typeInfo);const r=n;return new ee(Math.floor(r.value),n.typeInfo)}Fma(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof Ut&&r instanceof Ut&&s instanceof Ut)return n.data.length!==r.data.length||n.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${t.line}`),null):new Ut(n.data.map((A,_)=>A*r.data[_]+s.data[_]),n.typeInfo);const o=n,c=r,h=s;return new ee(o.value*c.value+h.value,o.typeInfo)}Fract(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>s-Math.floor(s)),n.typeInfo);const r=n;return new ee(r.value-Math.floor(r.value),n.typeInfo)}Frexp(t,i){return console.error(`TODO: frexp. Line ${t.line}`),null}InsertBits(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i),o=this.exec.evalExpression(t.args[3],i);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${t.line}`),null;const c=s.value,h=(1<<o.value)-1<<c,A=~h;if(n instanceof Ut&&r instanceof Ut)return new Ut(n.data.map((S,L)=>S&A|r.data[L]<<c&h),n.typeInfo);const _=n.value,C=r.value;return new ee(_&A|C<<c&h,n.typeInfo)}InverseSqrt(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>1/Math.sqrt(s)),n.typeInfo);const r=n;return new ee(1/Math.sqrt(r.value),n.typeInfo)}Ldexp(t,i){return console.error(`TODO: ldexp. Line ${t.line}`),null}Length(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut){let s=0;return n.data.forEach(o=>{s+=o*o}),new ee(Math.sqrt(s),this.getTypeInfo("f32"))}const r=n;return new ee(Math.abs(r.value),n.typeInfo)}Log(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.log(s)),n.typeInfo);const r=n;return new ee(Math.log(r.value),n.typeInfo)}Log2(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.log2(s)),n.typeInfo);const r=n;return new ee(Math.log2(r.value),n.typeInfo)}Max(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut)return new Ut(n.data.map((c,h)=>Math.max(c,r.data[h])),n.typeInfo);const s=n,o=r;return new ee(Math.max(s.value,o.value),n.typeInfo)}Min(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut)return new Ut(n.data.map((c,h)=>Math.min(c,r.data[h])),n.typeInfo);const s=n,o=r;return new ee(Math.min(s.value,o.value),n.typeInfo)}Mix(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof Ut&&r instanceof Ut&&s instanceof Ut)return new Ut(n.data.map((h,A)=>n.data[A]*(1-s.data[A])+r.data[A]*s.data[A]),n.typeInfo);const o=r,c=s;return new ee(n.value*(1-c.value)+o.value*c.value,n.typeInfo)}Modf(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut)return new Ut(n.data.map((o,c)=>o%r.data[c]),n.typeInfo);const s=r;return new ee(n.value%s.value,n.typeInfo)}Normalize(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut){const r=this.Length(t,i).value;return new Ut(n.data.map(s=>s/r),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${t.line}`),null}Pow(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut)return new Ut(n.data.map((c,h)=>Math.pow(c,r.data[h])),n.typeInfo);const s=n,o=r;return new ee(Math.pow(s.value,o.value),n.typeInfo)}QuantizeToF16(t,i){const n=this.exec.evalExpression(t.args[0],i);return n instanceof Ut?new Ut(n.data.map(r=>r),n.typeInfo):new ee(n.value,n.typeInfo)}Radians(t,i){const n=this.exec.evalExpression(t.args[0],i);return n instanceof Ut?new Ut(n.data.map(r=>r*Math.PI/180),n.typeInfo):new ee(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(t,i){let n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(n instanceof Ut&&r instanceof Ut){const s=this._dot(n.data,r.data);return new Ut(n.data.map((o,c)=>o-2*s*r.data[c]),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${t.line}`),null}Refract(t,i){let n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(n instanceof Ut&&r instanceof Ut&&s instanceof ee){const o=this._dot(r.data,n.data);return new Ut(n.data.map((c,h)=>{const A=1-s.value*s.value*(1-o*o);if(A<0)return 0;const _=Math.sqrt(A);return s.value*c-(s.value*o+_)*r.data[h]}),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${t.line}`),null}ReverseBits(t,i){return console.error(`TODO: reverseBits. Line ${t.line}`),null}Round(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.round(s)),n.typeInfo);const r=n;return new ee(Math.round(r.value),n.typeInfo)}Saturate(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.min(Math.max(s,0),1)),n.typeInfo);const r=n;return new ee(Math.min(Math.max(r.value,0),1),n.typeInfo)}Sign(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.sign(s)),n.typeInfo);const r=n;return new ee(Math.sign(r.value),n.typeInfo)}Sin(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.sin(s)),n.typeInfo);const r=n;return new ee(Math.sin(r.value),n.typeInfo)}Sinh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.sinh(s)),n.typeInfo);const r=n;return new ee(Math.sinh(r.value),n.typeInfo)}_smoothstep(t,i,n){const r=Math.min(Math.max((n-t)/(i-t),0),1);return r*r*(3-2*r)}SmoothStep(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i),s=this.exec.evalExpression(t.args[2],i);if(s instanceof Ut&&n instanceof Ut&&r instanceof Ut)return new Ut(s.data.map((A,_)=>this._smoothstep(n.data[_],r.data[_],A)),s.typeInfo);const o=n,c=r,h=s;return new ee(this._smoothstep(o.value,c.value,h.value),s.typeInfo)}Sqrt(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.sqrt(s)),n.typeInfo);const r=n;return new ee(Math.sqrt(r.value),n.typeInfo)}Step(t,i){const n=this.exec.evalExpression(t.args[0],i),r=this.exec.evalExpression(t.args[1],i);if(r instanceof Ut&&n instanceof Ut)return new Ut(r.data.map((o,c)=>o<n.data[c]?0:1),r.typeInfo);const s=n;return new ee(r.value<s.value?0:1,s.typeInfo)}Tan(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.tan(s)),n.typeInfo);const r=n;return new ee(Math.tan(r.value),n.typeInfo)}Tanh(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.tanh(s)),n.typeInfo);const r=n;return new ee(Math.tanh(r.value),n.typeInfo)}_getTransposeType(t){const i=t.getTypeName();return i==="mat2x2f"||i==="mat2x2h"?t:i==="mat2x3f"?this.getTypeInfo("mat3x2f"):i==="mat2x3h"?this.getTypeInfo("mat3x2h"):i==="mat2x4f"?this.getTypeInfo("mat4x2f"):i==="mat2x4h"?this.getTypeInfo("mat4x2h"):i==="mat3x2f"?this.getTypeInfo("mat2x3f"):i==="mat3x2h"?this.getTypeInfo("mat2x3h"):i==="mat3x3f"||i==="mat3x3h"?t:i==="mat3x4f"?this.getTypeInfo("mat4x3f"):i==="mat3x4h"?this.getTypeInfo("mat4x3h"):i==="mat4x2f"?this.getTypeInfo("mat2x4f"):i==="mat4x2h"?this.getTypeInfo("mat2x4h"):i==="mat4x3f"?this.getTypeInfo("mat3x4f"):i==="mat4x3h"?this.getTypeInfo("mat3x4h"):(i==="mat4x4f"||i==="mat4x4h"||console.error(`Invalid matrix type ${i}`),t)}Transpose(t,i){const n=this.exec.evalExpression(t.args[0],i);if(!(n instanceof sn))return console.error(`Transpose() expects a matrix argument. Line ${t.line}`),null;const r=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const s=n.data;return new sn([s[0],s[2],s[1],s[3]],r)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const s=n.data;return new sn([s[0],s[3],s[6],s[1],s[4],s[7]],r)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const s=n.data;return new sn([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],r)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const s=n.data;return new sn([s[0],s[3],s[1],s[4],s[2],s[5]],r)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const s=n.data;return new sn([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],r)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const s=n.data;return new sn([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],r)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const s=n.data;return new sn([s[0],s[4],s[1],s[5],s[2],s[6]],r)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const s=n.data;return new sn([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],r)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const s=n.data;return new sn([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],r)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(t,i){const n=this.exec.evalExpression(t.args[0],i);if(n instanceof Ut)return new Ut(n.data.map(s=>Math.trunc(s)),n.typeInfo);const r=n;return new ee(Math.trunc(r.value),n.typeInfo)}Dpdx(t,i){return console.error(`TODO: dpdx. Line ${t.line}`),null}DpdxCoarse(t,i){return console.error(`TODO: dpdxCoarse. Line ${t.line}`),null}DpdxFine(t,i){return console.error("TODO: dpdxFine"),null}Dpdy(t,i){return console.error("TODO: dpdy"),null}DpdyCoarse(t,i){return console.error("TODO: dpdyCoarse"),null}DpdyFine(t,i){return console.error("TODO: dpdyFine"),null}Fwidth(t,i){return console.error("TODO: fwidth"),null}FwidthCoarse(t,i){return console.error("TODO: fwidthCoarse"),null}FwidthFine(t,i){return console.error("TODO: fwidthFine"),null}TextureDimensions(t,i){const n=t.args[0],r=t.args.length>1?this.exec.evalExpression(t.args[1],i).value:0;if(n instanceof aa){const s=n.name,o=i.getVariableValue(s);if(o instanceof su){if(r<0||r>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${t.line}`),null;const c=o.getMipLevelSize(r),h=o.dimension;return h==="1d"?new ee(c[0],this.getTypeInfo("u32")):h==="3d"?new Ut(c,this.getTypeInfo("vec3u")):h==="2d"?new Ut(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${t.line}`),null)}return console.error(`Texture ${s} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${t.line}`),null}TextureGather(t,i){return console.error("TODO: textureGather"),null}TextureGatherCompare(t,i){return console.error("TODO: textureGatherCompare"),null}TextureLoad(t,i){const n=t.args[0],r=this.exec.evalExpression(t.args[1],i),s=t.args.length>2?this.exec.evalExpression(t.args[2],i).value:0;if(!(r instanceof Ut)||r.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${t.line}`),null;if(n instanceof aa){const o=n.name,c=i.getVariableValue(o);if(c instanceof su){const h=Math.floor(r.data[0]),A=Math.floor(r.data[1]);if(h<0||h>=c.width||A<0||A>=c.height)return console.error(`Texture ${o} out of bounds. Line ${t.line}`),null;const _=c.getPixel(h,A,0,s);return _===null?(console.error(`Invalid texture format for textureLoad. Line ${t.line}`),null):new Ut(_,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${t.line}`),null}TextureNumLayers(t,i){const n=t.args[0];if(n instanceof aa){const r=n.name,s=i.getVariableValue(r);return s instanceof su?new ee(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${t.line}`),null}TextureNumLevels(t,i){const n=t.args[0];if(n instanceof aa){const r=n.name,s=i.getVariableValue(r);return s instanceof su?new ee(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${t.line}`),null}TextureNumSamples(t,i){const n=t.args[0];if(n instanceof aa){const r=n.name,s=i.getVariableValue(r);return s instanceof su?new ee(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${t.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${t.line}`),null}TextureSample(t,i){return console.error("TODO: textureSample"),null}TextureSampleBias(t,i){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(t,i){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(t,i){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(t,i){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(t,i){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(t,i){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(t,i){const n=t.args[0],r=this.exec.evalExpression(t.args[1],i),s=t.args.length===4?this.exec.evalExpression(t.args[2],i).value:0,o=t.args.length===4?this.exec.evalExpression(t.args[3],i).data:this.exec.evalExpression(t.args[2],i).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${t.line}`),null;if(!(r instanceof Ut)||r.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${t.line}`),null;if(n instanceof aa){const c=n.name,h=i.getVariableValue(c);if(h instanceof su){const A=h.getMipLevelSize(0),_=Math.floor(r.data[0]),C=Math.floor(r.data[1]);return _<0||_>=A[0]||C<0||C>=A[1]?(console.error(`Texture ${c} out of bounds. Line ${t.line}`),null):(h.setPixel(_,C,0,s,Array.from(o)),null)}return console.error(`Texture ${c} not found. Line ${t.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${t.line}`),null}AtomicLoad(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i);return i.getVariable(r).value.getSubData(this.exec,n.postfix,i)}AtomicStore(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i);return h instanceof ee&&c instanceof ee&&(h.value=c.value),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),null}AtomicAdd(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value+=c.value),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicSub(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value-=c.value),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicMax(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value=Math.max(h.value,c.value)),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicMin(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value=Math.min(h.value,c.value)),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicAnd(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value=h.value&c.value),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicOr(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value=h.value|c.value),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicXor(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value=h.value^c.value),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicExchange(t,i){let n=t.args[0];n instanceof fo&&(n=n.right);const r=this.exec.getVariableName(n,i),s=i.getVariable(r);let o=t.args[1];const c=this.exec.evalExpression(o,i),h=s.value.getSubData(this.exec,n.postfix,i),A=new ee(h.value,h.typeInfo);return h instanceof ee&&c instanceof ee&&(h.value=c.value),s.value instanceof to&&s.value.setDataValue(this.exec,h,n.postfix,i),A}AtomicCompareExchangeWeak(t,i){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(t,i){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(t,i){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(t,i){return console.error("TODO: pack4xI8"),null}Pack4xU8(t,i){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(t,i){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(t,i){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(t,i){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(t,i){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(t,i){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(t,i){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(t,i){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(t,i){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(t,i){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(t,i){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(t,i){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(t,i){return console.error("TODO: unpack2x16float"),null}StorageBarrier(t,i){return null}TextureBarrier(t,i){return null}WorkgroupBarrier(t,i){return null}WorkgroupUniformLoad(t,i){return null}SubgroupAdd(t,i){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(t,i){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(t,i){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(t,i){return console.error("TODO: subgroupAll"),null}SubgroupAnd(t,i){return console.error("TODO: subgroupAnd"),null}SubgroupAny(t,i){return console.error("TODO: subgroupAny"),null}SubgroupBallot(t,i){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(t,i){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(t,i){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(t,i){return console.error("TODO: subgroupElect"),null}SubgroupMax(t,i){return console.error("TODO: subgroupMax"),null}SubgroupMin(t,i){return console.error("TODO: subgroupMin"),null}SubgroupMul(t,i){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(t,i){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(t,i){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(t,i){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(t,i){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(t,i){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(t,i){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(t,i){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(t,i){return console.error("TODO: subgroupXor"),null}QuadBroadcast(t,i){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(t,i){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(t,i){return console.error("TODO: quadSwapX"),null}QuadSwapY(t,i){return console.error("TODO: quadSwapY"),null}}const F1={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Is={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class bs extends gV{constructor(t,i){var n;super(),this.ast=t??[],this.reflection=new yl,this.reflection.updateAST(this.ast),this.context=(n=i?.clone())!==null&&n!==void 0?n:new OE,this.builtins=new mV(this),this.typeInfo={bool:this.getTypeInfo(Ne.bool),i32:this.getTypeInfo(Ne.i32),u32:this.getTypeInfo(Ne.u32),f32:this.getTypeInfo(Ne.f32),f16:this.getTypeInfo(Ne.f16),vec2f:this.getTypeInfo(ue.vec2f),vec2u:this.getTypeInfo(ue.vec2u),vec2i:this.getTypeInfo(ue.vec2i),vec2h:this.getTypeInfo(ue.vec2h),vec3f:this.getTypeInfo(ue.vec3f),vec3u:this.getTypeInfo(ue.vec3u),vec3i:this.getTypeInfo(ue.vec3i),vec3h:this.getTypeInfo(ue.vec3h),vec4f:this.getTypeInfo(ue.vec4f),vec4u:this.getTypeInfo(ue.vec4u),vec4i:this.getTypeInfo(ue.vec4i),vec4h:this.getTypeInfo(ue.vec4h),mat2x2f:this.getTypeInfo(ue.mat2x2f),mat2x3f:this.getTypeInfo(ue.mat2x3f),mat2x4f:this.getTypeInfo(ue.mat2x4f),mat3x2f:this.getTypeInfo(ue.mat3x2f),mat3x3f:this.getTypeInfo(ue.mat3x3f),mat3x4f:this.getTypeInfo(ue.mat3x4f),mat4x2f:this.getTypeInfo(ue.mat4x2f),mat4x3f:this.getTypeInfo(ue.mat4x3f),mat4x4f:this.getTypeInfo(ue.mat4x4f)}}getVariableValue(t){var i,n;const r=(n=(i=this.context.getVariable(t))===null||i===void 0?void 0:i.value)!==null&&n!==void 0?n:null;if(r===null)return null;if(r instanceof ee)return r.value;if(r instanceof Ut||r instanceof sn)return Array.from(r.data);if(r instanceof to&&r.typeInfo instanceof zu){if(r.typeInfo.format.name==="u32")return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="i32")return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if(r.typeInfo.format.name==="f32")return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(t){(t=t??{}).constants&&this._setOverrides(t.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(t,i,n,r){const s=this.context.clone();(r=r??{}).constants&&this._setOverrides(r.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(t);if(!o)return void console.error(`Function ${t} not found`);if(typeof i=="number")i=[i,1,1];else{if(i.length===0)return void console.error("Invalid dispatch count");i.length===1?i=[i[0],1,1]:i.length===2?i=[i[0],i[1],1]:i.length>3&&(i=[i[0],i[1],i[2]])}const c=i[0],h=i[1],A=i[2],_=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new Ut(i,_));for(const C in n)for(const S in n[C]){const L=n[C][S];s.variables.forEach(N=>{var U;const H=N.node;if(H?.attributes){let j=null,tt=null;for(const K of H.attributes)K.name==="binding"?j=K.value:K.name==="group"&&(tt=K.value);if(S==j&&C==tt)if(L.texture!==void 0&&L.descriptor!==void 0){const K=new su(L.texture,this.getTypeInfo(H.type),L.descriptor,(U=L.texture.view)!==null&&U!==void 0?U:null);N.value=K}else L.uniform!==void 0?N.value=new to(L.uniform,this.getTypeInfo(H.type)):N.value=new to(L,this.getTypeInfo(H.type))}})}for(let C=0;C<A;++C)for(let S=0;S<h;++S)for(let L=0;L<c;++L)s.setVariable("@workgroup_id",new Ut([L,S,C],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[L,S,C],s)}execStatement(t,i){if(t instanceof IS)return this.evalExpression(t.value,i);if(t instanceof PS){if(t.condition){const n=this.evalExpression(t.condition,i);if(!(n instanceof ee))throw new Error("Invalid break-if condition");if(!n.value)return null}return bs._breakObj}if(t instanceof RS)return bs._continueObj;if(t instanceof VA)this._let(t,i);else if(t instanceof Vl)this._var(t,i);else if(t instanceof a0)this._const(t,i);else if(t instanceof jA)this._function(t,i);else{if(t instanceof SS)return this._if(t,i);if(t instanceof TS)return this._switch(t,i);if(t instanceof wS)return this._for(t,i);if(t instanceof xS)return this._while(t,i);if(t instanceof BS)return this._loop(t,i);if(t instanceof I1){const n=i.clone();return n.currentFunctionName=i.currentFunctionName,this._execStatements(t.body,n)}if(t instanceof ES)this._assign(t,i);else if(t instanceof CS)this._increment(t,i);else{if(t instanceof Hl)return null;if(t instanceof M1){const n=t.name;i.getVariable(n)===null&&i.setVariable(n,new ee(0,this.getTypeInfo("u32")))}else if(t instanceof P1)this._call(t,i);else{if(t instanceof MS||t instanceof R1)return null;console.error("Invalid statement type.",t,`Line ${t.line}`)}}}return null}evalExpression(t,i){return t instanceof lc?this._evalBinaryOp(t,i):t instanceof wo?this._evalLiteral(t,i):t instanceof aa?this._evalVariable(t,i):t instanceof O1?this._evalCall(t,i):t instanceof nl?this._evalCreate(t,i):t instanceof OS?this._evalConst(t,i):t instanceof LS?this._evalBitcast(t,i):t instanceof fo?this._evalUnaryOp(t,i):(console.error("Invalid expression type",t,`Line ${t.line}`),null)}getTypeInfo(t){var i;if(t instanceof Ne){const r=this.reflection.getTypeInfo(t);if(r!==null)return r}let n=(i=this.typeInfo[t])!==null&&i!==void 0?i:null;return n!==null||(n=this.reflection.getTypeInfoByName(t)),n}_setOverrides(t,i){for(const n in t){const r=t[n],s=this.reflection.getOverrideInfo(n);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?i.setVariable(n,new ee(r,s.type)):s.type.name==="bool"?i.setVariable(n,new ee(r?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?i.setVariable(n,new Ut(r,s.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(t,i,n){const r=[1,1,1];for(const _ of t.node.attributes)if(_.name==="workgroup_size"){if(_.value.length>0){const C=n.getVariableValue(_.value[0]);r[0]=C instanceof ee?C.value:parseInt(_.value[0])}if(_.value.length>1){const C=n.getVariableValue(_.value[1]);r[1]=C instanceof ee?C.value:parseInt(_.value[1])}if(_.value.length>2){const C=n.getVariableValue(_.value[2]);r[2]=C instanceof ee?C.value:parseInt(_.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new Ut(r,s));const c=r[0],h=r[1],A=r[2];for(let _=0,C=0;_<A;++_)for(let S=0;S<h;++S)for(let L=0;L<c;++L,++C){const N=[L,S,_],U=[L+i[0]*r[0],S+i[1]*r[1],_+i[2]*r[2]];n.setVariable("@local_invocation_id",new Ut(N,s)),n.setVariable("@global_invocation_id",new Ut(U,s)),n.setVariable("@local_invocation_index",new ee(C,o)),this._dispatchExec(t,n)}}_dispatchExec(t,i){for(const n of t.node.args)for(const r of n.attributes)if(r.name==="builtin"){const s=`@${r.value}`,o=i.getVariable(s);o!==void 0&&i.variables.set(n.name,o)}this._execStatements(t.node.body,i)}getVariableName(t,i){for(;t instanceof fo;)t=t.right;return t instanceof aa?t.name:(console.error("Unknown variable type",t,"Line",t.line),null)}_execStatements(t,i){for(const n of t){if(n instanceof Array){const s=i.clone(),o=this._execStatements(n,s);if(o)return o;continue}const r=this.execStatement(n,i);if(r)return r}return null}_call(t,i){const n=i.clone();n.currentFunctionName=t.name;const r=i.getFunction(t.name);if(r){for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],c=this.evalExpression(t.args[s],n);n.setVariable(o.name,c,o)}this._execStatements(r.node.body,n)}else t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)&&this._evalCreate(t,i)}_increment(t,i){const n=this.getVariableName(t.variable,i),r=i.getVariable(n);r?t.operator==="++"?r.value instanceof ee?r.value.value++:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):t.operator==="--"?r.value instanceof ee?r.value.value--:console.error(`Variable ${n} is not a scalar. Line ${t.line}`):console.error(`Unknown increment operator ${t.operator}. Line ${t.line}`):console.error(`Variable ${n} not found. Line ${t.line}`)}_getVariableData(t,i){if(t instanceof aa){const n=this.getVariableName(t,i),r=i.getVariable(n);return r===null?(console.error(`Variable ${n} not found. Line ${t.line}`),null):r.value.getSubData(this,t.postfix,i)}if(t instanceof fo){if(t.operator==="*"){const n=this._getVariableData(t.right,i);return n instanceof Pd?n.reference.getSubData(this,t.postfix,i):(console.error(`Variable ${t.right} is not a pointer. Line ${t.line}`),null)}if(t.operator==="&"){const n=this._getVariableData(t.right,i);return new Pd(n)}}return null}_assign(t,i){let n=null,r="<var>",s=null;if(t.variable instanceof fo){const h=this._getVariableData(t.variable,i),A=this.evalExpression(t.value,i),_=t.operator;if(_==="="){if(h instanceof ee||h instanceof Ut||h instanceof sn){if(A instanceof ee||A instanceof Ut||A instanceof sn&&h.data.length===A.data.length)return void h.data.set(A.data);console.error(`Invalid assignment. Line ${t.line}`)}else if(h instanceof to&&A instanceof to&&h.buffer.byteLength-h.offset>=A.buffer.byteLength-A.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(A.buffer,A.offset,A.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(A.buffer,A.offset,A.typeInfo.size)));return console.error(`Invalid assignment. Line ${t.line}`),null}if(_==="+=")return h instanceof ee||h instanceof Ut||h instanceof sn?A instanceof ee||A instanceof Ut||A instanceof sn?void h.data.set(A.data.map((C,S)=>h.data[S]+C)):void console.error(`Invalid assignment . Line ${t.line}`):void console.error(`Invalid assignment. Line ${t.line}`);if(_==="-=")return(h instanceof ee||h instanceof Ut||h instanceof sn)&&(A instanceof ee||A instanceof Ut||A instanceof sn)?void h.data.set(A.data.map((C,S)=>h.data[S]-C)):void console.error(`Invalid assignment. Line ${t.line}`)}if(t.variable instanceof fo){if(t.variable.operator==="*"){r=this.getVariableName(t.variable.right,i);const h=i.getVariable(r);if(!(h&&h.value instanceof Pd))return void console.error(`Variable ${r} is not a pointer. Line ${t.line}`);n=h.value.reference;let A=t.variable.postfix;if(!A){let _=t.variable.right;for(;_ instanceof fo;){if(_.postfix){A=_.postfix;break}_=_.right}}A&&(n=n.getSubData(this,A,i))}}else{s=t.variable.postfix,r=this.getVariableName(t.variable,i);const h=i.getVariable(r);if(h===null)return void console.error(`Variable ${r} not found. Line ${t.line}`);n=h.value}if(n instanceof Pd&&(n=n.reference),n===null)return void console.error(`Variable ${r} not found. Line ${t.line}`);const o=this.evalExpression(t.value,i),c=t.operator;if(c==="=")if(n instanceof to)n.setDataValue(this,o,s,i);else if(s){if(!(n instanceof Ut||n instanceof sn))return void console.error(`Variable ${r} is not a vector or matrix. Line ${t.line}`);if(s instanceof Md){const h=this.evalExpression(s.index,i).value;if(n instanceof Ut){if(!(o instanceof ee))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[h]=o.value}else{if(!(n instanceof sn))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);{const A=this.evalExpression(s.index,i).value;if(A<0)return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(!(o instanceof Ut))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);{const _=n.typeInfo.getTypeName();if(_==="mat2x2"||_==="mat2x2f"||_==="mat2x2h"){if(!(A<2&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*A]=o.data[0],n.data[2*A+1]=o.data[1]}else if(_==="mat2x3"||_==="mat2x3f"||_==="mat2x3h"){if(!(A<2&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*A]=o.data[0],n.data[3*A+1]=o.data[1],n.data[3*A+2]=o.data[2]}else if(_==="mat2x4"||_==="mat2x4f"||_==="mat2x4h"){if(!(A<2&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*A]=o.data[0],n.data[4*A+1]=o.data[1],n.data[4*A+2]=o.data[2],n.data[4*A+3]=o.data[3]}else if(_==="mat3x2"||_==="mat3x2f"||_==="mat3x2h"){if(!(A<3&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*A]=o.data[0],n.data[2*A+1]=o.data[1]}else if(_==="mat3x3"||_==="mat3x3f"||_==="mat3x3h"){if(!(A<3&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*A]=o.data[0],n.data[3*A+1]=o.data[1],n.data[3*A+2]=o.data[2]}else if(_==="mat3x4"||_==="mat3x4f"||_==="mat3x4h"){if(!(A<3&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*A]=o.data[0],n.data[4*A+1]=o.data[1],n.data[4*A+2]=o.data[2],n.data[4*A+3]=o.data[3]}else if(_==="mat4x2"||_==="mat4x2f"||_==="mat4x2h"){if(!(A<4&&o.data.length===2))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[2*A]=o.data[0],n.data[2*A+1]=o.data[1]}else if(_==="mat4x3"||_==="mat4x3f"||_==="mat4x3h"){if(!(A<4&&o.data.length===3))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[3*A]=o.data[0],n.data[3*A+1]=o.data[1],n.data[3*A+2]=o.data[2]}else{if(_!=="mat4x4"&&_!=="mat4x4f"&&_!=="mat4x4h")return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(!(A<4&&o.data.length===4))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);n.data[4*A]=o.data[0],n.data[4*A+1]=o.data[1],n.data[4*A+2]=o.data[2],n.data[4*A+3]=o.data[3]}}}}}else if(s instanceof Wh){const h=s.value;if(!(n instanceof Ut))return void console.error(`Invalid assignment to ${h}. Variable ${r} is not a vector. Line ${t.line}`);if(o instanceof ee){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);if(h==="x")n.data[0]=o.value;else if(h==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);n.data[1]=o.value}else if(h==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);n.data[2]=o.value}else if(h==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);n.data[3]=o.value}}else{if(!(o instanceof Ut))return void console.error(`Invalid assignment to ${r}. Line ${t.line}`);if(h.length!==o.data.length)return void console.error(`Invalid assignment to ${h} for variable ${r}. Line ${t.line}`);for(let A=0;A<h.length;++A){const _=h[A];if(_==="x"||_==="r")n.data[0]=o.data[A];else if(_==="y"||_==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);n.data[1]=o.data[A]}else if(_==="z"||_==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);n.data[2]=o.data[A]}else{if(_!=="w"&&_!=="a")return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${_} for variable ${r}. Line ${t.line}`);n.data[3]=o.data[A]}}}}}else n instanceof ee&&o instanceof ee?n.value=o.value:n instanceof Ut&&o instanceof Ut||n instanceof sn&&o instanceof sn?n.data.set(o.data):console.error(`Invalid assignment to ${r}. Line ${t.line}`);else{const h=n.getSubData(this,s,i);if(h instanceof Ut&&o instanceof ee){const A=h.data,_=o.value;if(c==="+=")for(let C=0;C<A.length;++C)A[C]+=_;else if(c==="-=")for(let C=0;C<A.length;++C)A[C]-=_;else if(c==="*=")for(let C=0;C<A.length;++C)A[C]*=_;else if(c==="/=")for(let C=0;C<A.length;++C)A[C]/=_;else if(c==="%=")for(let C=0;C<A.length;++C)A[C]%=_;else if(c==="&=")for(let C=0;C<A.length;++C)A[C]&=_;else if(c==="|=")for(let C=0;C<A.length;++C)A[C]|=_;else if(c==="^=")for(let C=0;C<A.length;++C)A[C]^=_;else if(c==="<<=")for(let C=0;C<A.length;++C)A[C]<<=_;else if(c===">>=")for(let C=0;C<A.length;++C)A[C]>>=_;else console.error(`Invalid operator ${c}. Line ${t.line}`)}else if(h instanceof Ut&&o instanceof Ut){const A=h.data,_=o.data;if(A.length!==_.length)return void console.error(`Vector length mismatch. Line ${t.line}`);if(c==="+=")for(let C=0;C<A.length;++C)A[C]+=_[C];else if(c==="-=")for(let C=0;C<A.length;++C)A[C]-=_[C];else if(c==="*=")for(let C=0;C<A.length;++C)A[C]*=_[C];else if(c==="/=")for(let C=0;C<A.length;++C)A[C]/=_[C];else if(c==="%=")for(let C=0;C<A.length;++C)A[C]%=_[C];else if(c==="&=")for(let C=0;C<A.length;++C)A[C]&=_[C];else if(c==="|=")for(let C=0;C<A.length;++C)A[C]|=_[C];else if(c==="^=")for(let C=0;C<A.length;++C)A[C]^=_[C];else if(c==="<<=")for(let C=0;C<A.length;++C)A[C]<<=_[C];else if(c===">>=")for(let C=0;C<A.length;++C)A[C]>>=_[C];else console.error(`Invalid operator ${c}. Line ${t.line}`)}else{if(!(h instanceof ee&&o instanceof ee))return void console.error(`Invalid type for ${t.operator} operator. Line ${t.line}`);c==="+="?h.value+=o.value:c==="-="?h.value-=o.value:c==="*="?h.value*=o.value:c==="/="?h.value/=o.value:c==="%="?h.value%=o.value:c==="&="?h.value&=o.value:c==="|="?h.value|=o.value:c==="^="?h.value^=o.value:c==="<<="?h.value<<=o.value:c===">>="?h.value>>=o.value:console.error(`Invalid operator ${c}. Line ${t.line}`)}n instanceof to&&n.setDataValue(this,h,s,i)}}_function(t,i){const n=new DE(t);i.functions.set(t.name,n)}_const(t,i){let n=null;t.value!==null&&(n=this.evalExpression(t.value,i)),i.createVariable(t.name,n,t)}_let(t,i){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,i),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof fo||(n=n.clone())}else{const r=t.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||r==="array"){const s=new nl(t.type,[]);n=this._evalCreate(s,i)}}i.createVariable(t.name,n,t)}_var(t,i){let n=null;if(t.value!==null){if(n=this.evalExpression(t.value,i),n===null)return void console.error(`Invalid value for variable ${t.name}. Line ${t.line}`);t.value instanceof fo||(n=n.clone())}else{if(t.type===null)return void console.error(`Variable ${t.name} has no type. Line ${t.line}`);const r=t.type.name;if(r==="f32"||r==="i32"||r==="u32"||r==="bool"||r==="f16"||r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2b"||r==="vec3b"||r==="vec4b"||r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"||t.type instanceof WA||t.type instanceof Hl||t.type instanceof ue){const s=new nl(t.type,[]);n=this._evalCreate(s,i)}}i.createVariable(t.name,n,t)}_switch(t,i){i=i.clone();const n=this.evalExpression(t.condition,i);if(!(n instanceof ee))return console.error(`Invalid if condition. Line ${t.line}`),null;let r=null;for(const s of t.cases)if(s instanceof NS)for(const o of s.selectors){if(o instanceof c0){r=s;continue}const c=this.evalExpression(o,i);if(!(c instanceof ee))return console.error(`Invalid case selector. Line ${t.line}`),null;if(c.value===n.value)return this._execStatements(s.body,i)}else s instanceof US&&(r=s);return r?this._execStatements(r.body,i):null}_if(t,i){i=i.clone();const n=this.evalExpression(t.condition,i);if(!(n instanceof ee))return console.error(`Invalid if condition. Line ${t.line}`),null;if(n.value)return this._execStatements(t.body,i);for(const r of t.elseif){const s=this.evalExpression(r.condition,i);if(!(s instanceof ee))return console.error(`Invalid if condition. Line ${t.line}`),null;if(s.value)return this._execStatements(r.body,i)}return t.else?this._execStatements(t.else,i):null}_getScalarValue(t){return t instanceof ee?t.value:(console.error("Expected scalar value.",t),0)}_for(t,i){for(i=i.clone(),this.execStatement(t.init,i);this._getScalarValue(this.evalExpression(t.condition,i));){const n=this._execStatements(t.body,i);if(n===bs._breakObj)break;if(n!==null&&n!==bs._continueObj)return n;this.execStatement(t.increment,i)}return null}_loop(t,i){for(i=i.clone();;){const n=this._execStatements(t.body,i);if(n===bs._breakObj)break;if(n===bs._continueObj){if(t.continuing&&this._execStatements(t.continuing.body,i)===bs._breakObj)break}else if(n!==null)return n}return null}_while(t,i){for(i=i.clone();this._getScalarValue(this.evalExpression(t.condition,i));){const n=this._execStatements(t.body,i);if(n===bs._breakObj)break;if(n!==bs._continueObj&&n!==null)return n}return null}_evalBitcast(t,i){const n=this.evalExpression(t.value,i),r=t.type;if(n instanceof ee){const s=HS(n.value,n.typeInfo.name,r.name);return new ee(s,this.getTypeInfo(r))}if(n instanceof Ut){const s=n.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${t.line}`),null;o="f16"}const c=r.getTypeName();let h="";if(c.endsWith("f"))h="f32";else if(c.endsWith("i"))h="i32";else if(c.endsWith("u"))h="u32";else if(c.endsWith("b"))h="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${t.line}`),null;h="f16"}const A=function(_,C,S){if(C===S)return _;const L=new Array(_.length);for(let N=0;N<_.length;N++)L[N]=HS(_[N],C,S);return L}(Array.from(n.data),o,h);return new Ut(A,this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${t.line}`),null}_evalConst(t,i){return i.getVariableValue(t.name).clone().getSubData(this,t.postfix,i)}_evalCreate(t,i){var n;if(t instanceof nl){if(t.type===null)return L1.void;switch(t.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(t,i);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(t,i);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(t,i)}}const r=t instanceof nl?t.type.name:t.name,s=t instanceof nl?this.getTypeInfo(t.type):this.getTypeInfo(t.name);if(s===null)return console.error(`Unknown type ${r}. Line ${t.line}`),null;if(s.size===0)return null;const o=new to(new ArrayBuffer(s.size),s,0);if(s instanceof Uu){if(t.args)for(let c=0;c<t.args.length;++c){const h=s.members[c],A=t.args[c],_=this.evalExpression(A,i);o.setData(this,_,h.type,h.offset,i)}}else if(s instanceof zu){let c=0;if(t.args)for(let h=0;h<t.args.length;++h){const A=t.args[h],_=this.evalExpression(A,i);s.format===null&&(((n=_.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=_.typeInfo),o.setData(this,_,s.format,c,i),c+=s.stride}}else console.error(`Unknown type "${r}". Line ${t.line}`);return t instanceof nl?o.getSubData(this,t.postfix,i):o}_evalLiteral(t,i){const n=this.getTypeInfo(t.type),r=n.name;return r==="x32"||r==="u32"||r==="f32"||r==="f16"||r==="i32"||r==="bool"?new ee(t.scalarValue,n):r==="vec2"||r==="vec3"||r==="vec4"||r==="vec2f"||r==="vec3f"||r==="vec4f"||r==="vec2h"||r==="vec3h"||r==="vec4h"||r==="vec2i"||r==="vec3i"||r==="vec4i"||r==="vec2u"||r==="vec3u"||r==="vec4u"?this._callConstructorVec(t,i):r==="mat2x2"||r==="mat2x3"||r==="mat2x4"||r==="mat3x2"||r==="mat3x3"||r==="mat3x4"||r==="mat4x2"||r==="mat4x3"||r==="mat4x4"||r==="mat2x2f"||r==="mat2x3f"||r==="mat2x4f"||r==="mat3x2f"||r==="mat3x3f"||r==="mat3x4f"||r==="mat4x2f"||r==="mat4x3f"||r==="mat4x4f"||r==="mat2x2h"||r==="mat2x3h"||r==="mat2x4h"||r==="mat3x2h"||r==="mat3x3h"||r==="mat3x4h"||r==="mat4x2h"||r==="mat4x3h"||r==="mat4x4h"?this._callConstructorMatrix(t,i):t.value}_evalVariable(t,i){const n=i.getVariableValue(t.name);return n===null?n:n.getSubData(this,t.postfix,i)}_maxFormatTypeInfo(t){let i=t[0];if(i.name==="f32")return i;for(let n=1;n<t.length;++n){const r=bs._priority.get(i.name);bs._priority.get(t[n].name)<r&&(i=t[n])}return i.name==="x32"?this.getTypeInfo("i32"):i}_evalUnaryOp(t,i){const n=this.evalExpression(t.right,i);if(t.operator==="&")return new Pd(n);if(t.operator==="*")return n instanceof Pd?n.reference.getSubData(this,t.postfix,i):(console.error(`Invalid dereference. Line ${t.line}`),null);const r=n instanceof ee?n.value:n instanceof Ut?Array.from(n.data):null;switch(t.operator){case"+":{if(pi(r)){const c=r.map((h,A)=>+h);return new Ut(c,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ee(+s,o)}case"-":{if(pi(r)){const c=r.map((h,A)=>-h);return new Ut(c,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ee(-s,o)}case"!":{if(pi(r)){const c=r.map((h,A)=>h?0:1);return new Ut(c,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ee(s?0:1,o)}case"~":{if(pi(r)){const c=r.map((h,A)=>~h);return new Ut(c,n.typeInfo)}const s=r,o=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new ee(~s,o)}}return console.error(`Invalid unary operator ${t.operator}. Line ${t.line}`),null}_evalBinaryOp(t,i){const n=this.evalExpression(t.left,i),r=this.evalExpression(t.right,i),s=n instanceof ee?n.value:n instanceof Ut||n instanceof sn?Array.from(n.data):null,o=r instanceof ee?r.value:r instanceof Ut||r instanceof sn?Array.from(r.data):null;switch(t.operator){case"+":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L+C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S+_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_+S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c+h,A)}case"-":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L-C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S-_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_-S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c-h,A)}case"*":{if(pi(s)&&pi(o)){const _=s,C=o;if(n instanceof sn&&r instanceof sn){const S=function(H,j,tt,K){if(Is[j.name]===void 0||Is[K.name]===void 0)return null;const Q=Is[j.name][0],pt=Is[j.name][1],$=Is[K.name][0];if(Q!==Is[K.name][1])return null;const zt=new Array($*pt);for(let Gt=0;Gt<pt;Gt++)for(let dt=0;dt<$;dt++){let lt=0;for(let Lt=0;Lt<Q;Lt++)lt+=H[Lt*pt+Gt]*tt[dt*Q+Lt];zt[Gt*$+dt]=lt}return zt}(_,n.typeInfo,C,r.typeInfo);if(S===null)return console.error(`Matrix multiplication failed. Line ${t.line}.`),null;const L=Is[r.typeInfo.name][0],N=Is[n.typeInfo.name][1],U=this.getTypeInfo(`mat${L}x${N}f`);return new sn(S,U)}if(n instanceof sn&&r instanceof Ut){const S=function(L,N,U,H){if(Is[N.name]===void 0||F1[H.name]===void 0)return null;const j=Is[N.name][0],tt=Is[N.name][1];if(j!==U.length)return null;const K=new Array(tt);for(let Q=0;Q<tt;Q++){let pt=0;for(let $=0;$<j;$++)pt+=L[$*tt+Q]*U[$];K[Q]=pt}return K}(_,n.typeInfo,C,r.typeInfo);return S===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new Ut(S,r.typeInfo)}if(n instanceof Ut&&r instanceof sn){const S=function(L,N,U,H){if(F1[N.name]===void 0||Is[H.name]===void 0)return null;const j=Is[H.name][0],tt=Is[H.name][1];if(tt!==L.length)return null;const K=[];for(let Q=0;Q<j;Q++){let pt=0;for(let $=0;$<tt;$++)pt+=L[$]*U[$*j+Q];K[Q]=pt}return K}(_,n.typeInfo,C,r.typeInfo);return S===null?(console.error(`Matrix vector multiplication failed. Line ${t.line}.`),null):new Ut(S,n.typeInfo)}{if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L*C[N]);return new Ut(S,n.typeInfo)}}if(pi(s)){const _=o,C=s.map((S,L)=>S*_);return n instanceof sn?new sn(C,n.typeInfo):new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_*S);return r instanceof sn?new sn(C,r.typeInfo):new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c*h,A)}case"%":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L%C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S%_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_%S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c%h,A)}case"/":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L/C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S/_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_/S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c/h,A)}case"&":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L&C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S&_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_&S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c&h,A)}case"|":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L|C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S|_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_|S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c|h,A)}case"^":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L^C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S^_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_^S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c^h,A)}case"<<":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L<<C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S<<_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_<<S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c<<h,A)}case">>":{if(pi(s)&&pi(o)){const _=s,C=o;if(_.length!==C.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const S=_.map((L,N)=>L>>C[N]);return new Ut(S,n.typeInfo)}if(pi(s)){const _=o,C=s.map((S,L)=>S>>_);return new Ut(C,n.typeInfo)}if(pi(o)){const _=s,C=o.map((S,L)=>_>>S);return new Ut(C,r.typeInfo)}const c=s,h=o,A=this._maxFormatTypeInfo([n.typeInfo,r.typeInfo]);return new ee(c>>h,A)}case">":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_>h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A>c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c>A?1:0);return new Ut(h,r.typeInfo)}return new ee(s>o?1:0,this.getTypeInfo("bool"));case"<":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_<h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A<c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c<A?1:0);return new Ut(h,r.typeInfo)}return new ee(s<o?1:0,this.getTypeInfo("bool"));case"==":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_===h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A==c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c==A?1:0);return new Ut(h,r.typeInfo)}return new ee(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_!==h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A!==c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c!==A?1:0);return new Ut(h,r.typeInfo)}return new ee(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_>=h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A>=c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c>=A?1:0);return new Ut(h,r.typeInfo)}return new ee(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_<=h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A<=c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c<=A?1:0);return new Ut(h,r.typeInfo)}return new ee(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_&&h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A&&c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c&&A?1:0);return new Ut(h,r.typeInfo)}return new ee(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(pi(s)&&pi(o)){const c=s,h=o;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${t.line}.`),null;const A=c.map((_,C)=>_||h[C]?1:0);return new Ut(A,n.typeInfo)}if(pi(s)){const c=o,h=s.map((A,_)=>A||c?1:0);return new Ut(h,n.typeInfo)}if(pi(o)){const c=s,h=o.map((A,_)=>c||A?1:0);return new Ut(h,r.typeInfo)}return new ee(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${t.operator}. Line ${t.line}`),null}_evalCall(t,i){if(t.cachedReturnValue!==null)return t.cachedReturnValue;const n=i.clone();n.currentFunctionName=t.name;const r=i.getFunction(t.name);if(!r)return t.isBuiltin?this._callBuiltinFunction(t,n):this.getTypeInfo(t.name)?this._evalCreate(t,i):(console.error(`Unknown function "${t.name}". Line ${t.line}`),null);for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],c=this.evalExpression(t.args[s],n);n.createVariable(o.name,c,o)}return this._execStatements(r.node.body,n)}_callBuiltinFunction(t,i){switch(t.name){case"all":return this.builtins.All(t,i);case"any":return this.builtins.Any(t,i);case"select":return this.builtins.Select(t,i);case"arrayLength":return this.builtins.ArrayLength(t,i);case"abs":return this.builtins.Abs(t,i);case"acos":return this.builtins.Acos(t,i);case"acosh":return this.builtins.Acosh(t,i);case"asin":return this.builtins.Asin(t,i);case"asinh":return this.builtins.Asinh(t,i);case"atan":return this.builtins.Atan(t,i);case"atanh":return this.builtins.Atanh(t,i);case"atan2":return this.builtins.Atan2(t,i);case"ceil":return this.builtins.Ceil(t,i);case"clamp":return this.builtins.Clamp(t,i);case"cos":return this.builtins.Cos(t,i);case"cosh":return this.builtins.Cosh(t,i);case"countLeadingZeros":return this.builtins.CountLeadingZeros(t,i);case"countOneBits":return this.builtins.CountOneBits(t,i);case"countTrailingZeros":return this.builtins.CountTrailingZeros(t,i);case"cross":return this.builtins.Cross(t,i);case"degrees":return this.builtins.Degrees(t,i);case"determinant":return this.builtins.Determinant(t,i);case"distance":return this.builtins.Distance(t,i);case"dot":return this.builtins.Dot(t,i);case"dot4U8Packed":return this.builtins.Dot4U8Packed(t,i);case"dot4I8Packed":return this.builtins.Dot4I8Packed(t,i);case"exp":return this.builtins.Exp(t,i);case"exp2":return this.builtins.Exp2(t,i);case"extractBits":return this.builtins.ExtractBits(t,i);case"faceForward":return this.builtins.FaceForward(t,i);case"firstLeadingBit":return this.builtins.FirstLeadingBit(t,i);case"firstTrailingBit":return this.builtins.FirstTrailingBit(t,i);case"floor":return this.builtins.Floor(t,i);case"fma":return this.builtins.Fma(t,i);case"fract":return this.builtins.Fract(t,i);case"frexp":return this.builtins.Frexp(t,i);case"insertBits":return this.builtins.InsertBits(t,i);case"inverseSqrt":return this.builtins.InverseSqrt(t,i);case"ldexp":return this.builtins.Ldexp(t,i);case"length":return this.builtins.Length(t,i);case"log":return this.builtins.Log(t,i);case"log2":return this.builtins.Log2(t,i);case"max":return this.builtins.Max(t,i);case"min":return this.builtins.Min(t,i);case"mix":return this.builtins.Mix(t,i);case"modf":return this.builtins.Modf(t,i);case"normalize":return this.builtins.Normalize(t,i);case"pow":return this.builtins.Pow(t,i);case"quantizeToF16":return this.builtins.QuantizeToF16(t,i);case"radians":return this.builtins.Radians(t,i);case"reflect":return this.builtins.Reflect(t,i);case"refract":return this.builtins.Refract(t,i);case"reverseBits":return this.builtins.ReverseBits(t,i);case"round":return this.builtins.Round(t,i);case"saturate":return this.builtins.Saturate(t,i);case"sign":return this.builtins.Sign(t,i);case"sin":return this.builtins.Sin(t,i);case"sinh":return this.builtins.Sinh(t,i);case"smoothStep":return this.builtins.SmoothStep(t,i);case"sqrt":return this.builtins.Sqrt(t,i);case"step":return this.builtins.Step(t,i);case"tan":return this.builtins.Tan(t,i);case"tanh":return this.builtins.Tanh(t,i);case"transpose":return this.builtins.Transpose(t,i);case"trunc":return this.builtins.Trunc(t,i);case"dpdx":return this.builtins.Dpdx(t,i);case"dpdxCoarse":return this.builtins.DpdxCoarse(t,i);case"dpdxFine":return this.builtins.DpdxFine(t,i);case"dpdy":return this.builtins.Dpdy(t,i);case"dpdyCoarse":return this.builtins.DpdyCoarse(t,i);case"dpdyFine":return this.builtins.DpdyFine(t,i);case"fwidth":return this.builtins.Fwidth(t,i);case"fwidthCoarse":return this.builtins.FwidthCoarse(t,i);case"fwidthFine":return this.builtins.FwidthFine(t,i);case"textureDimensions":return this.builtins.TextureDimensions(t,i);case"textureGather":return this.builtins.TextureGather(t,i);case"textureGatherCompare":return this.builtins.TextureGatherCompare(t,i);case"textureLoad":return this.builtins.TextureLoad(t,i);case"textureNumLayers":return this.builtins.TextureNumLayers(t,i);case"textureNumLevels":return this.builtins.TextureNumLevels(t,i);case"textureNumSamples":return this.builtins.TextureNumSamples(t,i);case"textureSample":return this.builtins.TextureSample(t,i);case"textureSampleBias":return this.builtins.TextureSampleBias(t,i);case"textureSampleCompare":return this.builtins.TextureSampleCompare(t,i);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(t,i);case"textureSampleGrad":return this.builtins.TextureSampleGrad(t,i);case"textureSampleLevel":return this.builtins.TextureSampleLevel(t,i);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(t,i);case"textureStore":return this.builtins.TextureStore(t,i);case"atomicLoad":return this.builtins.AtomicLoad(t,i);case"atomicStore":return this.builtins.AtomicStore(t,i);case"atomicAdd":return this.builtins.AtomicAdd(t,i);case"atomicSub":return this.builtins.AtomicSub(t,i);case"atomicMax":return this.builtins.AtomicMax(t,i);case"atomicMin":return this.builtins.AtomicMin(t,i);case"atomicAnd":return this.builtins.AtomicAnd(t,i);case"atomicOr":return this.builtins.AtomicOr(t,i);case"atomicXor":return this.builtins.AtomicXor(t,i);case"atomicExchange":return this.builtins.AtomicExchange(t,i);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(t,i);case"pack4x8snorm":return this.builtins.Pack4x8snorm(t,i);case"pack4x8unorm":return this.builtins.Pack4x8unorm(t,i);case"pack4xI8":return this.builtins.Pack4xI8(t,i);case"pack4xU8":return this.builtins.Pack4xU8(t,i);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(t,i);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(t,i);case"pack2x16snorm":return this.builtins.Pack2x16snorm(t,i);case"pack2x16unorm":return this.builtins.Pack2x16unorm(t,i);case"pack2x16float":return this.builtins.Pack2x16float(t,i);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(t,i);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(t,i);case"unpack4xI8":return this.builtins.Unpack4xI8(t,i);case"unpack4xU8":return this.builtins.Unpack4xU8(t,i);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(t,i);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(t,i);case"unpack2x16float":return this.builtins.Unpack2x16float(t,i);case"storageBarrier":return this.builtins.StorageBarrier(t,i);case"textureBarrier":return this.builtins.TextureBarrier(t,i);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(t,i);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(t,i);case"subgroupAdd":return this.builtins.SubgroupAdd(t,i);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(t,i);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(t,i);case"subgroupAll":return this.builtins.SubgroupAll(t,i);case"subgroupAnd":return this.builtins.SubgroupAnd(t,i);case"subgroupAny":return this.builtins.SubgroupAny(t,i);case"subgroupBallot":return this.builtins.SubgroupBallot(t,i);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(t,i);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(t,i);case"subgroupElect":return this.builtins.SubgroupElect(t,i);case"subgroupMax":return this.builtins.SubgroupMax(t,i);case"subgroupMin":return this.builtins.SubgroupMin(t,i);case"subgroupMul":return this.builtins.SubgroupMul(t,i);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(t,i);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(t,i);case"subgroupOr":return this.builtins.SubgroupOr(t,i);case"subgroupShuffle":return this.builtins.SubgroupShuffle(t,i);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(t,i);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(t,i);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(t,i);case"subgroupXor":return this.builtins.SubgroupXor(t,i);case"quadBroadcast":return this.builtins.QuadBroadcast(t,i);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(t,i);case"quadSwapX":return this.builtins.QuadSwapX(t,i);case"quadSwapY":return this.builtins.QuadSwapY(t,i)}const n=i.getFunction(t.name);if(n){const r=i.clone();for(let s=0;s<n.node.args.length;++s){const o=n.node.args[s],c=this.evalExpression(t.args[s],r);r.setVariable(o.name,c,o)}return this._execStatements(n.node.body,r)}return null}_callConstructorValue(t,i){if(!t.args||t.args.length===0)return new ee(0,this.getTypeInfo(t.type));const n=this.evalExpression(t.args[0],i);return n.typeInfo=this.getTypeInfo(t.type),n.getSubData(this,t.postfix,i).clone()}_callConstructorVec(t,i){const n=this.getTypeInfo(t.type),r=t.type.getTypeName(),s=F1[r];if(s===void 0)return console.error(`Invalid vec constructor ${r}. Line ${t.line}`),null;const o=[];if(t instanceof wo)if(t.isVector){const c=t.vectorValue;for(const h of c)o.push(h)}else o.push(t.scalarValue);else if(t.args)for(const c of t.args){const h=this.evalExpression(c,i);if(h instanceof Ut){const A=h.data;for(let _=0;_<A.length;++_){let C=A[_];o.push(C)}}else if(h instanceof ee){let A=h.value;o.push(A)}}if(t.type instanceof ue&&t.type.format===null&&(t.type.format=ue.f32),o.length===0){const c=new Array(s).fill(0);return new Ut(c,n).getSubData(this,t.postfix,i)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${t.line}`),null):new Ut(o.length>s?o.slice(0,s):o,n).getSubData(this,t.postfix,i)}_callConstructorMatrix(t,i){const n=this.getTypeInfo(t.type),r=t.type.getTypeName(),s=Is[r];if(s===void 0)return console.error(`Invalid matrix constructor ${r}. Line ${t.line}`),null;const o=[];if(t instanceof wo)if(t.isVector){const c=t.vectorValue;for(const h of c)o.push(h)}else o.push(t.scalarValue);else if(t.args)for(const c of t.args){const h=this.evalExpression(c,i);h instanceof Ut?o.push(...h.data):h instanceof ee?o.push(h.value):h instanceof sn&&o.push(...h.data)}if(n instanceof Hh&&n.format===null&&(n.format=this.getTypeInfo("f32")),o.length===0){const c=new Array(s[2]).fill(0);return new sn(c,n).getSubData(this,t.postfix,i)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${t.line}`),null):new sn(o,n).getSubData(this,t.postfix,i)}}bs._breakObj=new Ha(new Da("BREAK",null),null),bs._continueObj=new Ha(new Da("CONTINUE",null),null),bs._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class yV{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class vV{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new yV,this._exec=new bs,this._forwardTypeCount=0}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const i=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;i.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const r=n.arrayType,s=n.countNode;if(s instanceof aa){const o=s.name,c=this._context.constants.get(o);if(c)try{const h=c.constEvaluate(this._exec);r.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of i)n.search(r=>{r instanceof GS||r instanceof D1?r.type=this._forwardType(r.type):r instanceof WA?r.format=this._forwardType(r.format):r instanceof Vl||r instanceof VA||r instanceof a0?r.type=this._forwardType(r.type):r instanceof jA?r.returnType=this._forwardType(r.returnType):r instanceof zS&&(r.type=this._forwardType(r.type))});return i}_forwardType(t){if(t instanceof DS){const i=this._getType(t.name);if(i)return i}else t instanceof D1?t.type=this._forwardType(t.type):t instanceof WA&&(t.format=this._forwardType(t.format));return t}_initialize(t){if(t)if(typeof t=="string"){const i=new cV(t);this._tokens=i.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_updateNode(t,i){return t.line=i??this._currentLine,t}_error(t,i){return{token:t,message:i,toString:()=>`${i}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Dt.eof}_match(t){if(t instanceof ne)return!!this._check(t)&&(this._advance(),!0);for(let i=0,n=t.length;i<n;++i){const r=t[i];if(this._check(r))return this._advance(),!0}return!1}_consume(t,i){if(this._check(t))return this._advance();throw this._error(this._peek(),`${i}. Line:${this._currentLine}`)}_check(t){if(this._isAtEnd())return!1;const i=this._peek();if(t instanceof Array){const n=i.type;let r=!1;for(const s of t){if(n===s)return!0;s===Dt.tokens.name&&(r=!0)}if(r){const s=Dt.tokens.name.rule.exec(i.lexeme);if(s&&s.index==0&&s[0]==i.lexeme)return!0}return!1}if(i.type===t)return!0;if(t===Dt.tokens.name){const n=Dt.tokens.name.rule.exec(i.lexeme);return n&&n.index==0&&n[0]==i.lexeme}return!1}_advance(){var t,i;return this._currentLine=(i=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&i!==void 0?i:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Dt.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Dt.keywords.alias)){const i=this._type_alias();return this._consume(Dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(Dt.keywords.diagnostic)){const i=this._diagnostic();return this._consume(Dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(Dt.keywords.requires)){const i=this._requires_directive();return this._consume(Dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}if(this._match(Dt.keywords.enable)){const i=this._enable_directive();return this._consume(Dt.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([i]),i}const t=this._attribute();if(this._check(Dt.keywords.var)){const i=this._global_variable_decl();return i!=null&&(i.attributes=t),this._consume(Dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Dt.keywords.override)){const i=this._override_variable_decl();return i!=null&&(i.attributes=t),this._consume(Dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Dt.keywords.let)){const i=this._global_let_decl();return i!=null&&(i.attributes=t),this._consume(Dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Dt.keywords.const)){const i=this._global_const_decl();return i!=null&&(i.attributes=t),this._consume(Dt.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([i]),i}if(this._check(Dt.keywords.struct)){const i=this._struct_decl();return i!=null&&(i.attributes=t),this._exec.reflection.updateAST([i]),i}if(this._check(Dt.keywords.fn)){const i=this._function_decl();return i!=null&&(i.attributes=t),this._exec.reflection.updateAST([i]),i}return null}_function_decl(){if(!this._match(Dt.keywords.fn))return null;const t=this._currentLine,i=this._consume(Dt.tokens.ident,"Expected function name.").toString();this._consume(Dt.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(Dt.tokens.paren_right))do{if(this._check(Dt.tokens.paren_right))break;const c=this._attribute(),h=this._consume(Dt.tokens.name,"Expected argument name.").toString();this._consume(Dt.tokens.colon,"Expected ':' for argument type.");const A=this._attribute(),_=this._type_decl();_!=null&&(_.attributes=A,n.push(this._updateNode(new zS(h,_,c))))}while(this._match(Dt.tokens.comma));this._consume(Dt.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(Dt.tokens.arrow)){const c=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=c)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new jA(i,n,r,s,t,o),t)}_compound_statement(){const t=[];for(this._consume(Dt.tokens.brace_left,"Expected '{' for block.");!this._check(Dt.tokens.brace_right);){const i=this._statement();i!==null&&t.push(i)}return this._consume(Dt.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(Dt.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Dt.tokens.attr)&&this._attribute(),this._check(Dt.keywords.if))return this._if_statement();if(this._check(Dt.keywords.switch))return this._switch_statement();if(this._check(Dt.keywords.loop))return this._loop_statement();if(this._check(Dt.keywords.for))return this._for_statement();if(this._check(Dt.keywords.while))return this._while_statement();if(this._check(Dt.keywords.continuing))return this._continuing_statement();if(this._check(Dt.keywords.static_assert))return this._static_assert_statement();if(this._check(Dt.tokens.brace_left))return this._compound_statement();let t=null;if(this._check(Dt.keywords.return))t=this._return_statement();else if(this._check([Dt.keywords.var,Dt.keywords.let,Dt.keywords.const]))t=this._variable_statement();else if(this._match(Dt.keywords.discard))t=this._updateNode(new oV);else if(this._match(Dt.keywords.break)){const i=this._updateNode(new PS);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];i.loopId=n.id}t=i,this._check(Dt.keywords.if)&&(this._advance(),i.condition=this._optional_paren_expression())}else if(this._match(Dt.keywords.continue)){const i=this._updateNode(new RS);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${i.line}`);{const n=this._currentLoop[this._currentLoop.length-1];i.loopId=n.id}t=i}else t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return t!=null&&this._consume(Dt.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(Dt.keywords.static_assert))return null;const t=this._currentLine,i=this._optional_paren_expression();return this._updateNode(new iV(i),t)}_while_statement(){if(!this._match(Dt.keywords.while))return null;const t=this._updateNode(new xS(null,null));return this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(Dt.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_continuing_statement(){const t=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Dt.keywords.continuing))return null;const i=this._currentLine,n=this._compound_statement();return this._updateNode(new I1(n,t),i)}_for_statement(){if(!this._match(Dt.keywords.for))return null;this._consume(Dt.tokens.paren_left,"Expected '('.");const t=this._updateNode(new wS(null,null,null,null));return this._currentLoop.push(t),t.init=this._check(Dt.tokens.semicolon)?null:this._for_init(),this._consume(Dt.tokens.semicolon,"Expected ';'."),t.condition=this._check(Dt.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Dt.tokens.semicolon,"Expected ';'."),t.increment=this._check(Dt.tokens.paren_right)?null:this._for_increment(),this._consume(Dt.tokens.paren_right,"Expected ')'."),this._check(Dt.tokens.attr)&&this._attribute(),t.body=this._compound_statement(),this._currentLoop.pop(),t}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Dt.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let i=null;return this._match(Dt.tokens.equal)&&(i=this._short_circuit_or_expression()),this._updateNode(new Vl(t.name,t.type,t.storage,t.access,i),t.line)}if(this._match(Dt.keywords.let)){const t=this._currentLine,i=this._consume(Dt.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(Dt.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(Dt.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return this._updateNode(new VA(i,n,null,null,r),t)}if(this._match(Dt.keywords.const)){const t=this._currentLine,i=this._consume(Dt.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(Dt.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}this._consume(Dt.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return n===null&&r instanceof wo&&(n=r.type),this._updateNode(new a0(i,n,null,null,r),t)}return null}_increment_decrement_statement(){const t=this._current,i=this._unary_expression();if(i==null)return null;if(!this._check(Dt.increment_operators))return this._current=t,null;const n=this._consume(Dt.increment_operators,"Expected increment operator");return this._updateNode(new CS(n.type===Dt.tokens.plus_plus?Id.increment:Id.decrement,i))}_assignment_statement(){let t=null;const i=this._currentLine;if(this._check(Dt.tokens.brace_right))return null;let n=this._match(Dt.tokens.underscore);if(n||(t=this._unary_expression()),!n&&t==null)return null;const r=this._consume(Dt.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new ES(HA.parse(r.lexeme),t,s),i)}_func_call_statement(){if(!this._check(Dt.tokens.ident))return null;const t=this._currentLine,i=this._current,n=this._consume(Dt.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=i,null):this._updateNode(new P1(n.lexeme,r),t)}_loop_statement(){if(!this._match(Dt.keywords.loop))return null;this._check(Dt.tokens.attr)&&this._attribute(),this._consume(Dt.tokens.brace_left,"Expected '{' for loop.");const t=this._updateNode(new BS([],null));this._currentLoop.push(t);let i=this._statement();for(;i!==null;){if(Array.isArray(i))for(let n of i)t.body.push(n);else t.body.push(i);if(i instanceof I1){t.continuing=i;break}i=this._statement()}return this._currentLoop.pop(),this._consume(Dt.tokens.brace_right,"Expected '}' for loop."),t}_switch_statement(){if(!this._match(Dt.keywords.switch))return null;const t=this._updateNode(new TS(null,[]));if(this._currentLoop.push(t),t.condition=this._optional_paren_expression(),this._check(Dt.tokens.attr)&&this._attribute(),this._consume(Dt.tokens.brace_left,"Expected '{' for switch."),t.cases=this._switch_body(),t.cases==null||t.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Dt.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),t}_switch_body(){const t=[];let i=!1;for(;this._check([Dt.keywords.default,Dt.keywords.case]);){if(this._match(Dt.keywords.case)){const n=this._case_selectors();for(const s of n)if(s instanceof c0){if(i)throw this._error(this._previous(),"Multiple default cases in switch statement.");i=!0;break}this._match(Dt.tokens.colon),this._check(Dt.tokens.attr)&&this._attribute(),this._consume(Dt.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(Dt.tokens.brace_right,"Exected '}' for switch case."),t.push(this._updateNode(new NS(n,r)))}if(this._match(Dt.keywords.default)){if(i)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Dt.tokens.colon),this._check(Dt.tokens.attr)&&this._attribute(),this._consume(Dt.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(Dt.tokens.brace_right,"Exected '}' for switch default."),t.push(this._updateNode(new US(n)))}}return t}_case_selectors(){const t=[];for(this._match(Dt.keywords.default)?t.push(this._updateNode(new c0)):t.push(this._shift_expression());this._match(Dt.tokens.comma);)this._match(Dt.keywords.default)?t.push(this._updateNode(new c0)):t.push(this._shift_expression());return t}_case_body(){if(this._match(Dt.keywords.fallthrough))return this._consume(Dt.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const i=this._case_body();return i.length==0?t:[...t,i[0]]}_if_statement(){if(!this._match(Dt.keywords.if))return null;const t=this._currentLine,i=this._optional_paren_expression();this._check(Dt.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(Dt.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let s=null;return this._match(Dt.keywords.else)&&(this._check(Dt.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new SS(i,n,r,s),t)}_match_elseif(){return this._tokens[this._current].type===Dt.keywords.else&&this._tokens[this._current+1].type===Dt.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(t=[]){const i=this._optional_paren_expression(),n=this._compound_statement();return t.push(this._updateNode(new sV(i,n))),this._match_elseif()&&(this._check(Dt.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(Dt.keywords.return))return null;const t=this._short_circuit_or_expression();return this._updateNode(new IS(t))}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(Dt.tokens.or_or);)t=this._updateNode(new lc(this._previous().toString(),t,this._short_circuit_and_expr()));return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(Dt.tokens.and_and);)t=this._updateNode(new lc(this._previous().toString(),t,this._inclusive_or_expression()));return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(Dt.tokens.or);)t=this._updateNode(new lc(this._previous().toString(),t,this._exclusive_or_expression()));return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(Dt.tokens.xor);)t=this._updateNode(new lc(this._previous().toString(),t,this._and_expression()));return t}_and_expression(){let t=this._equality_expression();for(;this._match(Dt.tokens.and);)t=this._updateNode(new lc(this._previous().toString(),t,this._equality_expression()));return t}_equality_expression(){const t=this._relational_expression();return this._match([Dt.tokens.equal_equal,Dt.tokens.not_equal])?this._updateNode(new lc(this._previous().toString(),t,this._relational_expression())):t}_relational_expression(){let t=this._shift_expression();for(;this._match([Dt.tokens.less_than,Dt.tokens.greater_than,Dt.tokens.less_than_equal,Dt.tokens.greater_than_equal]);)t=this._updateNode(new lc(this._previous().toString(),t,this._shift_expression()));return t}_shift_expression(){let t=this._additive_expression();for(;this._match([Dt.tokens.shift_left,Dt.tokens.shift_right]);)t=this._updateNode(new lc(this._previous().toString(),t,this._additive_expression()));return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([Dt.tokens.plus,Dt.tokens.minus]);)t=this._updateNode(new lc(this._previous().toString(),t,this._multiplicative_expression()));return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([Dt.tokens.star,Dt.tokens.forward_slash,Dt.tokens.modulo]);)t=this._updateNode(new lc(this._previous().toString(),t,this._unary_expression()));return t}_unary_expression(){return this._match([Dt.tokens.minus,Dt.tokens.bang,Dt.tokens.tilde,Dt.tokens.star,Dt.tokens.and])?this._updateNode(new fo(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),i=this._postfix_expression();return i&&(t.postfix=i),t}_postfix_expression(){if(this._match(Dt.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(Dt.tokens.bracket_right,"Expected ']'.");const i=this._updateNode(new Md(t)),n=this._postfix_expression();return n&&(i.postfix=n),i}if(this._match(Dt.tokens.period)){const t=this._consume(Dt.tokens.name,"Expected member name."),i=this._postfix_expression(),n=this._updateNode(new Wh(t.lexeme));return i&&(n.postfix=i),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_getType(t){const i=this._getStruct(t);if(i!==null)return i;switch(t){case"void":return Ne.void;case"bool":return Ne.bool;case"i32":return Ne.i32;case"u32":return Ne.u32;case"f32":return Ne.f32;case"f16":return Ne.f16;case"vec2f":return ue.vec2f;case"vec3f":return ue.vec3f;case"vec4f":return ue.vec4f;case"vec2i":return ue.vec2i;case"vec3i":return ue.vec3i;case"vec4i":return ue.vec4i;case"vec2u":return ue.vec2u;case"vec3u":return ue.vec3u;case"vec4u":return ue.vec4u;case"vec2h":return ue.vec2h;case"vec3h":return ue.vec3h;case"vec4h":return ue.vec4h;case"mat2x2f":return ue.mat2x2f;case"mat2x3f":return ue.mat2x3f;case"mat2x4f":return ue.mat2x4f;case"mat3x2f":return ue.mat3x2f;case"mat3x3f":return ue.mat3x3f;case"mat3x4f":return ue.mat3x4f;case"mat4x2f":return ue.mat4x2f;case"mat4x3f":return ue.mat4x3f;case"mat4x4f":return ue.mat4x4f;case"mat2x2h":return ue.mat2x2h;case"mat2x3h":return ue.mat2x3h;case"mat2x4h":return ue.mat2x4h;case"mat3x2h":return ue.mat3x2h;case"mat3x3h":return ue.mat3x3h;case"mat3x4h":return ue.mat3x4h;case"mat4x2h":return ue.mat4x2h;case"mat4x3h":return ue.mat4x3h;case"mat4x4h":return ue.mat4x4h;case"mat2x2i":return ue.mat2x2i;case"mat2x3i":return ue.mat2x3i;case"mat2x4i":return ue.mat2x4i;case"mat3x2i":return ue.mat3x2i;case"mat3x3i":return ue.mat3x3i;case"mat3x4i":return ue.mat3x4i;case"mat4x2i":return ue.mat4x2i;case"mat4x3i":return ue.mat4x3i;case"mat4x4i":return ue.mat4x4i;case"mat2x2u":return ue.mat2x2u;case"mat2x3u":return ue.mat2x3u;case"mat2x4u":return ue.mat2x4u;case"mat3x2u":return ue.mat3x2u;case"mat3x3u":return ue.mat3x3u;case"mat3x4u":return ue.mat3x4u;case"mat4x2u":return ue.mat4x2u;case"mat4x3u":return ue.mat4x3u;case"mat4x4u":return ue.mat4x4u}return null}_validateTypeRange(t,i){if(i.name==="i32"){if(t<-2147483648||t>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${t}. Line: ${this._currentLine}.`)}else if(i.name==="u32"&&(t<0||t>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${t}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Dt.tokens.ident)){const n=this._previous().toString();if(this._check(Dt.tokens.paren_left)){const r=this._argument_expression_list(),s=this._getType(n);return s!==null?this._updateNode(new nl(s,r)):this._updateNode(new O1(n,r))}if(this._context.constants.has(n)){const r=this._context.constants.get(n);return this._updateNode(new OS(n,r.value))}return this._updateNode(new aa(n))}if(this._match(Dt.tokens.int_literal)){const n=this._previous().toString();let r=n.endsWith("i")||n.endsWith("i")?Ne.i32:n.endsWith("u")||n.endsWith("U")?Ne.u32:Ne.x32;const s=parseInt(n);return this._validateTypeRange(s,r),this._updateNode(new wo(new ee(s,this._exec.getTypeInfo(r)),r))}if(this._match(Dt.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,Ne.u32),this._updateNode(new wo(new ee(n,this._exec.getTypeInfo(Ne.u32)),Ne.u32))}if(this._match([Dt.tokens.decimal_float_literal,Dt.tokens.hex_float_literal])){let n=this._previous().toString(),r=n.endsWith("h");r&&(n=n.substring(0,n.length-1));const s=parseFloat(n);this._validateTypeRange(s,r?Ne.f16:Ne.f32);const o=r?Ne.f16:Ne.f32;return this._updateNode(new wo(new ee(s,this._exec.getTypeInfo(o)),o))}if(this._match([Dt.keywords.true,Dt.keywords.false])){let n=this._previous().toString()===Dt.keywords.true.rule;return this._updateNode(new wo(new ee(n?1:0,this._exec.getTypeInfo(Ne.bool)),Ne.bool))}if(this._check(Dt.tokens.paren_left))return this._paren_expression();if(this._match(Dt.keywords.bitcast)){this._consume(Dt.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(Dt.tokens.greater_than,"Expected '>'.");const r=this._paren_expression();return this._updateNode(new LS(n,r))}const t=this._type_decl(),i=this._argument_expression_list();return this._updateNode(new nl(t,i))}_argument_expression_list(){if(!this._match(Dt.tokens.paren_left))return null;const t=[];do{if(this._check(Dt.tokens.paren_right))break;const i=this._short_circuit_or_expression();t.push(i)}while(this._match(Dt.tokens.comma));return this._consume(Dt.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(Dt.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(Dt.tokens.paren_right),t}_paren_expression(){this._consume(Dt.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(Dt.tokens.paren_right,"Expected ')'."),t}_struct_decl(){if(!this._match(Dt.keywords.struct))return null;const t=this._currentLine,i=this._consume(Dt.tokens.ident,"Expected name for struct.").toString();this._consume(Dt.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(Dt.tokens.brace_right);){const o=this._attribute(),c=this._consume(Dt.tokens.name,"Expected variable name.").toString();this._consume(Dt.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),A=this._type_decl();A!=null&&(A.attributes=h),this._check(Dt.tokens.brace_right)?this._match(Dt.tokens.comma):this._consume(Dt.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new GS(c,A,o)))}this._consume(Dt.tokens.brace_right,"Expected '}' after struct body.");const r=this._currentLine,s=this._updateNode(new Hl(i,n,t,r),t);return this._context.structs.set(i,s),s}_global_variable_decl(){const t=this._variable_decl();if(!t)return null;if(this._match(Dt.tokens.equal)){const i=this._const_expression();t.value=i}if(t.type!==null&&t.value instanceof wo){if(t.value.type.name!=="x32"&&t.type.getTypeName()!==t.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${t.value.type.name} to ${t.type.name}. Line:${this._currentLine}`);t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type),t.value.type=t.type}else t.type===null&&t.value instanceof wo&&(t.type=t.value.type.name==="x32"?Ne.i32:t.value.type,t.value.isScalar&&this._validateTypeRange(t.value.scalarValue,t.type));return t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(Dt.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){var t;if(!this._match(Dt.keywords.const))return null;const i=this._consume(Dt.tokens.name,"Expected variable name"),n=this._currentLine;let r=null;if(this._match(Dt.tokens.colon)){const h=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=h)}let s=null;this._consume(Dt.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let h=[Ne.f32],A=o.constEvaluate(this._exec,h);A instanceof ee&&this._validateTypeRange(A.value,h[0]),h[0]instanceof ue&&h[0].format===null&&A.typeInfo instanceof Hh&&A.typeInfo.format!==null&&(A.typeInfo.format.name==="f16"?h[0].format=Ne.f16:A.typeInfo.format.name==="f32"?h[0].format=Ne.f32:A.typeInfo.format.name==="i32"?h[0].format=Ne.i32:A.typeInfo.format.name==="u32"?h[0].format=Ne.u32:A.typeInfo.format.name==="bool"?h[0].format=Ne.bool:console.error(`TODO: impelement template format type ${A.typeInfo.format.name}`)),s=this._updateNode(new wo(A,h[0])),this._exec.context.setVariable(i.toString(),A)}catch{s=o}if(r!==null&&s instanceof wo){if(s.type.name!=="x32"&&r.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${r.name}. Line:${this._currentLine}`);s.type=r,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else r===null&&s instanceof wo&&(r=(t=s?.type)!==null&&t!==void 0?t:Ne.f32,r===Ne.x32&&(r=Ne.i32));const c=this._updateNode(new a0(i.toString(),r,"","",s),n);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(Dt.keywords.let))return null;const t=this._currentLine,i=this._consume(Dt.tokens.name,"Expected variable name");let n=null;if(this._match(Dt.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(Dt.tokens.equal)&&(r=this._const_expression()),n!==null&&r instanceof wo){if(r.type.name!=="x32"&&n.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${n.name}. Line:${this._currentLine}`);r.type=n}else n===null&&r instanceof wo&&(n=r.type.name==="x32"?Ne.i32:r.type);return r instanceof wo&&r.isScalar&&this._validateTypeRange(r.scalarValue,n),this._updateNode(new VA(i.toString(),n,"","",r),t)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Dt.keywords.var))return null;const t=this._currentLine;let i="",n="";this._match(Dt.tokens.less_than)&&(i=this._consume(Dt.storage_class,"Expected storage_class.").toString(),this._match(Dt.tokens.comma)&&(n=this._consume(Dt.access_mode,"Expected access_mode.").toString()),this._consume(Dt.tokens.greater_than,"Expected '>'."));const r=this._consume(Dt.tokens.name,"Expected variable name");let s=null;if(this._match(Dt.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new Vl(r.toString(),s,i,n,null),t)}_override_decl(){if(!this._match(Dt.keywords.override))return null;const t=this._consume(Dt.tokens.name,"Expected variable name");let i=null;if(this._match(Dt.tokens.colon)){const n=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=n)}return this._updateNode(new M1(t.toString(),i,null))}_diagnostic(){this._consume(Dt.tokens.paren_left,"Expected '('");const t=this._consume(Dt.tokens.ident,"Expected severity control name.");this._consume(Dt.tokens.comma,"Expected ','");let i=this._consume(Dt.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Dt.tokens.period)&&(i+=`.${this._consume(Dt.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Dt.tokens.paren_right,"Expected ')'"),this._updateNode(new MS(t.toString(),i))}_enable_directive(){const t=this._consume(Dt.tokens.ident,"identity expected.");return this._updateNode(new nV(t.toString()))}_requires_directive(){const t=[this._consume(Dt.tokens.ident,"identity expected.").toString()];for(;this._match(Dt.tokens.comma);){const i=this._consume(Dt.tokens.ident,"identity expected.");t.push(i.toString())}return this._updateNode(new rV(t))}_type_alias(){const t=this._consume(Dt.tokens.ident,"identity expected.");this._consume(Dt.tokens.equal,"Expected '=' for type alias.");let i=this._type_decl();if(i===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);const n=this._updateNode(new R1(t.toString(),i));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Dt.tokens.ident,...Dt.texel_format,Dt.keywords.bool,Dt.keywords.f32,Dt.keywords.i32,Dt.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const r=this._updateNode(new DS(n));return this._forwardTypeCount++,r}return this._updateNode(new Ne(n))}let t=this._texture_sampler_types();if(t)return t;if(this._check(Dt.template_types)){let n=this._advance().toString(),r=null,s=null;return this._match(Dt.tokens.less_than)&&(r=this._type_decl(),s=null,this._match(Dt.tokens.comma)&&(s=this._consume(Dt.access_mode,"Expected access_mode for pointer").toString()),this._consume(Dt.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ue(n,r,s))}if(this._match(Dt.keywords.ptr)){let n=this._previous().toString();this._consume(Dt.tokens.less_than,"Expected '<' for pointer.");const r=this._consume(Dt.storage_class,"Expected storage_class for pointer");this._consume(Dt.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(Dt.tokens.comma)&&(o=this._consume(Dt.access_mode,"Expected access_mode for pointer").toString()),this._consume(Dt.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new D1(n,r.toString(),s,o))}const i=this._attribute();if(this._match(Dt.keywords.array)){let n=null,r=-1;const s=this._previous();let o=null;if(this._match(Dt.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let h="";if(this._match(Dt.tokens.comma)){o=this._shift_expression();try{h=o.constEvaluate(this._exec).toString(),o=null}catch{h="1"}}this._consume(Dt.tokens.greater_than,"Expected '>' for array."),r=h?parseInt(h):0}const c=this._updateNode(new WA(s.toString(),i,n,r));return o&&this._deferArrayCountEval.push({arrayType:c,countNode:o}),c}return null}_texture_sampler_types(){if(this._match(Dt.sampler_type))return this._updateNode(new JA(this._previous().toString(),null,null));if(this._match(Dt.depth_texture_type))return this._updateNode(new JA(this._previous().toString(),null,null));if(this._match(Dt.sampled_texture_type)||this._match(Dt.multisampled_texture_type)){const t=this._previous();this._consume(Dt.tokens.less_than,"Expected '<' for sampler type.");const i=this._type_decl();return this._consume(Dt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new JA(t.toString(),i,null))}if(this._match(Dt.storage_texture_type)){const t=this._previous();this._consume(Dt.tokens.less_than,"Expected '<' for sampler type.");const i=this._consume(Dt.texel_format,"Invalid texel format.").toString();this._consume(Dt.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Dt.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Dt.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new JA(t.toString(),i,n))}return null}_attribute(){let t=[];for(;this._match(Dt.tokens.attr);){const i=this._consume(Dt.attribute_name,"Expected attribute name"),n=this._updateNode(new jS(i.toString(),null));if(this._match(Dt.tokens.paren_left)){if(n.value=this._consume(Dt.literal_or_ident,"Expected attribute value").toString(),this._check(Dt.tokens.comma)){this._advance();do{const r=this._consume(Dt.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(r)}while(this._match(Dt.tokens.comma))}this._consume(Dt.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}}class _V extends yl{constructor(t){super(),t&&this.update(t)}update(t){const i=new vV().parse(t);this.updateAST(i)}}function bV(e){const t={attributes:[],bindings:[]};let i;try{i=xV(e)}catch(s){return $e.error(s.message)(),t}for(const s of i.uniforms){const o=[];for(const c of s.type?.members||[])o.push({name:c.name,type:WS(c.type)});t.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:o})}for(const s of i.textures)t.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of i.samplers)t.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const n=i.entry.vertex[0],r=n?.inputs.length||0;for(let s=0;s<r;s++){const o=n.inputs[s];if(o.locationType==="location"){const c=WS(o.type);t.attributes.push({name:o.name,location:Number(o.location),type:c})}}return t}function WS(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function xV(e){try{return new _V(e)}catch(t){if(t instanceof Error)throw t;let i="WGSL parse error";throw typeof t=="object"&&t?.message&&(i+=`: ${t.message} `),typeof t=="object"&&t?.token&&(i+=t.token.line||""),new Error(i,{cause:t})}}const wV=1/Math.PI*180,CV=1/180*Math.PI,EV={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...EV}};const Co=globalThis.mathgl.config;function BV(e,{precision:t=Co.precision}={}){return e=MV(e),`${parseFloat(e.toPrecision(t))}`}function ju(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function TV(e){return IV(e)}function SV(e){return uc(e)}function IV(e,t){return k1(e,i=>i*CV,t)}function uc(e,t){return k1(e,i=>i*wV,t)}function Wl(e,t,i){return k1(e,n=>Math.max(t,Math.min(i,n)))}function hc(e,t,i){return ju(e)?e.map((n,r)=>hc(n,t[r],i)):i*t+(1-i)*e}function ca(e,t,i){const n=Co.EPSILON;i&&(Co.EPSILON=i);try{if(e===t)return!0;if(ju(e)&&ju(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!ca(e[r],t[r]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Co.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Co.EPSILON=n}}function MV(e){return Math.round(e/Co.EPSILON)*Co.EPSILON}function PV(e){return e.clone?e.clone():new Array(e.length)}function k1(e,t,i){if(ju(e)){const n=e;i=i||PV(n);for(let r=0;r<i.length&&r<n.length;++r){const s=typeof e=="number"?e:e[r];i[r]=t(s,r,i)}return i}return t(e)}class N1 extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,i=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+i];return this.check()}toArray(t=[],i=0){for(let n=0;n<this.ELEMENTS;++n)t[i+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ju(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Co)}formatString(t){let i="";for(let n=0;n<this.ELEMENTS;++n)i+=(n>0?", ":"")+BV(this[n],t);return`${t.printTypes?this.constructor.name:""}[${i}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(!ca(this[i],t[i]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let i=0;i<this.ELEMENTS;++i)if(this[i]!==t[i])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,i,n){if(n===void 0)return this.lerp(this,t,i);for(let r=0;r<this.ELEMENTS;++r){const s=t[r],o=typeof i=="number"?i:i[r];this[r]=s+n*(o-s)}return this.check()}min(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(t[i],this[i]);return this.check()}max(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.max(t[i],this[i]);return this.check()}clamp(t,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),i[n]);return this.check()}add(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=i[n];return this.check()}subtract(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=i[n];return this.check()}scale(t){if(typeof t=="number")for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;else for(let i=0;i<this.ELEMENTS&&i<t.length;++i)this[i]*=t[i];return this.check()}multiplyByScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;return this.check()}check(){if(Co.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let i=0;i<this.ELEMENTS;++i)t=t&&Number.isFinite(this[i]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]=t;return this.check()}addScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let i=0;i<this.ELEMENTS;++i)this[i]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,i){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),i);return this.check()}get elements(){return this}}function RV(e,t){if(e.length!==t)return!1;for(let i=0;i<e.length;++i)if(!Number.isFinite(e[i]))return!1;return!0}function Zn(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function XA(e,t,i=""){if(Co.debug&&!RV(e,t))throw new Error(`math.gl: ${i} some fields set to invalid numbers'`);return e}function fc(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class U1 extends N1{get x(){return this[0]}set x(t){this[0]=Zn(t)}get y(){return this[1]}set y(t){this[1]=Zn(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*this[i];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let i=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-t[n];i+=r*r}return Zn(i)}dot(t){let i=0;for(let n=0;n<this.ELEMENTS;++n)i+=this[n]*t[n];return Zn(i)}normalize(){const t=this.magnitude();if(t!==0)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t;return this.check()}multiply(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=i[n];return this.check()}divide(...t){for(const i of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=i[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return fc(t>=0&&t<this.ELEMENTS,"index is out of range"),Zn(this[t])}setComponent(t,i){return fc(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=i,this.check()}addVectors(t,i){return this.copy(t).add(i)}subVectors(t,i){return this.copy(t).subtract(i)}multiplyVectors(t,i){return this.copy(t).multiply(i)}addScaledVector(t,i){return this.add(new this.constructor(t).multiplyScalar(i))}}const QA=1e-6;let dc=typeof Float32Array<"u"?Float32Array:Array;function DV(){const e=new dc(2);return dc!=Float32Array&&(e[0]=0,e[1]=0),e}function JS(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function OV(e,t){return e[0]=-t[0],e[1]=-t[1],e}function XS(e,t,i,n){const r=t[0],s=t[1];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e}function LV(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e}function FV(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r+i[4],e[1]=i[1]*n+i[3]*r+i[5],e}function QS(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[3]*r+i[6],e[1]=i[1]*n+i[4]*r+i[7],e}function KS(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[4]*r+i[12],e[1]=i[1]*n+i[5]*r+i[13],e}(function(){const e=DV();return function(t,i,n,r,s,o){let c,h;for(i||(i=2),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,c=n;c<h;c+=i)e[0]=t[c],e[1]=t[c+1],s(e,e,o),t[c]=e[0],t[c+1]=e[1];return t}})();function qS(e,t,i){const n=t[0],r=t[1],s=i[3]*n+i[7]*r||1;return e[0]=(i[0]*n+i[4]*r)/s,e[1]=(i[1]*n+i[5]*r)/s,e}function ZS(e,t,i){const n=t[0],r=t[1],s=t[2],o=i[3]*n+i[7]*r+i[11]*s||1;return e[0]=(i[0]*n+i[4]*r+i[8]*s)/o,e[1]=(i[1]*n+i[5]*r+i[9]*s)/o,e[2]=(i[2]*n+i[6]*r+i[10]*s)/o,e}function kV(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2],e}function NV(e,t,i){const n=t[0],r=t[1];return e[0]=i[0]*n+i[2]*r,e[1]=i[1]*n+i[3]*r,e[2]=t[2],e[3]=t[3],e}function YS(e,t,i){const n=t[0],r=t[1],s=t[2];return e[0]=i[0]*n+i[3]*r+i[6]*s,e[1]=i[1]*n+i[4]*r+i[7]*s,e[2]=i[2]*n+i[5]*r+i[8]*s,e[3]=t[3],e}class z1 extends U1{constructor(t=0,i=0){super(2),ju(t)&&arguments.length===1?this.copy(t):(Co.debug&&(Zn(t),Zn(i)),this[0]=t,this[1]=i)}set(t,i){return this[0]=t,this[1]=i,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Co.debug&&(Zn(t.x),Zn(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return KS(this,this,t),this.check()}transformAsVector(t){return qS(this,this,t),this.check()}transformByMatrix3(t){return QS(this,this,t),this.check()}transformByMatrix2x3(t){return FV(this,this,t),this.check()}transformByMatrix2(t){return LV(this,this,t),this.check()}}function $S(){const e=new dc(3);return dc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function tI(e){const t=e[0],i=e[1],n=e[2];return Math.sqrt(t*t+i*i+n*n)}function eI(e,t,i){const n=new dc(3);return n[0]=e,n[1]=t,n[2]=i,n}function UV(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function zV(e){const t=e[0],i=e[1],n=e[2];return t*t+i*i+n*n}function GV(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function jV(e,t){const i=t[0],n=t[1],r=t[2];let s=i*i+n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function G1(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function d0(e,t,i){const n=t[0],r=t[1],s=t[2],o=i[0],c=i[1],h=i[2];return e[0]=r*h-s*c,e[1]=s*o-n*h,e[2]=n*c-r*o,e}function VV(e,t,i,n){const r=t[0],s=t[1],o=t[2];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=o+n*(i[2]-o),e}function j1(e,t,i){const n=t[0],r=t[1],s=t[2];let o=i[3]*n+i[7]*r+i[11]*s+i[15];return o=o||1,e[0]=(i[0]*n+i[4]*r+i[8]*s+i[12])/o,e[1]=(i[1]*n+i[5]*r+i[9]*s+i[13])/o,e[2]=(i[2]*n+i[6]*r+i[10]*s+i[14])/o,e}function iI(e,t,i){const n=t[0],r=t[1],s=t[2];return e[0]=n*i[0]+r*i[3]+s*i[6],e[1]=n*i[1]+r*i[4]+s*i[7],e[2]=n*i[2]+r*i[5]+s*i[8],e}function nI(e,t,i){const n=i[0],r=i[1],s=i[2],o=i[3],c=t[0],h=t[1],A=t[2];let _=r*A-s*h,C=s*c-n*A,S=n*h-r*c,L=r*S-s*C,N=s*_-n*S,U=n*C-r*_;const H=o*2;return _*=H,C*=H,S*=H,L*=2,N*=2,U*=2,e[0]=c+_+L,e[1]=h+C+N,e[2]=A+S+U,e}function HV(e,t,i,n){const r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0],s[1]=r[1]*Math.cos(n)-r[2]*Math.sin(n),s[2]=r[1]*Math.sin(n)+r[2]*Math.cos(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function WV(e,t,i,n){const r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[2]*Math.sin(n)+r[0]*Math.cos(n),s[1]=r[1],s[2]=r[2]*Math.cos(n)-r[0]*Math.sin(n),e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function JV(e,t,i,n){const r=[],s=[];return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],s[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),s[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),s[2]=r[2],e[0]=s[0]+i[0],e[1]=s[1]+i[1],e[2]=s[2]+i[2],e}function XV(e,t){const i=e[0],n=e[1],r=e[2],s=t[0],o=t[1],c=t[2],h=Math.sqrt((i*i+n*n+r*r)*(s*s+o*o+c*c)),A=h&&G1(e,t)/h;return Math.acos(Math.min(Math.max(A,-1),1))}const rI=UV,oI=tI,V1=zV;(function(){const e=$S();return function(t,i,n,r,s,o){let c,h;for(i||(i=3),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,c=n;c<h;c+=i)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],s(e,e,o),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}})();const H1=[0,0,0];let p0;class fe extends U1{static get ZERO(){return p0||(p0=new fe(0,0,0),Object.freeze(p0)),p0}constructor(t=0,i=0,n=0){super(-0,-0,-0),arguments.length===1&&ju(t)?this.copy(t):(Co.debug&&(Zn(t),Zn(i),Zn(n)),this[0]=t,this[1]=i,this[2]=n)}set(t,i,n){return this[0]=t,this[1]=i,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Co.debug&&(Zn(t.x),Zn(t.y),Zn(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Zn(t)}angle(t){return XV(this,t)}cross(t){return d0(this,this,t),this.check()}rotateX({radians:t,origin:i=H1}){return HV(this,this,i,t),this.check()}rotateY({radians:t,origin:i=H1}){return WV(this,this,i,t),this.check()}rotateZ({radians:t,origin:i=H1}){return JV(this,this,i,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return j1(this,this,t),this.check()}transformAsVector(t){return ZS(this,this,t),this.check()}transformByMatrix3(t){return iI(this,this,t),this.check()}transformByMatrix2(t){return kV(this,this,t),this.check()}transformByQuaternion(t){return nI(this,this,t),this.check()}}let A0;class LE extends U1{static get ZERO(){return A0||(A0=new LE(0,0,0,0),Object.freeze(A0)),A0}constructor(t=0,i=0,n=0,r=0){super(-0,-0,-0,-0),ju(t)&&arguments.length===1?this.copy(t):(Co.debug&&(Zn(t),Zn(i),Zn(n),Zn(r)),this[0]=t,this[1]=i,this[2]=n,this[3]=r)}set(t,i,n,r){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Co.debug&&(Zn(t.x),Zn(t.y),Zn(t.z),Zn(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=Zn(t)}get w(){return this[3]}set w(t){this[3]=Zn(t)}transform(t){return j1(this,this,t),this.check()}transformByMatrix3(t){return YS(this,this,t),this.check()}transformByMatrix2(t){return NV(this,this,t),this.check()}transformByQuaternion(t){return nI(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class sI extends N1{toString(){let t="[";if(Co.printRowMajor){t+="row-major:";for(let i=0;i<this.RANK;++i)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+i]}`}else{t+="column-major:";for(let i=0;i<this.ELEMENTS;++i)t+=` ${this[i]}`}return t+="]",t}getElementIndex(t,i){return i*this.RANK+t}getElement(t,i){return this[i*this.RANK+t]}setElement(t,i,n){return this[i*this.RANK+t]=Zn(n),this}getColumn(t,i=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let r=0;r<this.RANK;++r)i[r]=this[n+r];return i}setColumn(t,i){const n=t*this.RANK;for(let r=0;r<this.RANK;++r)this[n+r]=i[r];return this}}function QV(){const e=new dc(9);return dc!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function KV(e,t){if(e===t){const i=t[1],n=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=n,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function qV(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],c=t[5],h=t[6],A=t[7],_=t[8],C=_*o-c*A,S=-_*s+c*h,L=A*s-o*h;let N=i*C+n*S+r*L;return N?(N=1/N,e[0]=C*N,e[1]=(-_*n+r*A)*N,e[2]=(c*n-r*o)*N,e[3]=S*N,e[4]=(_*i-r*h)*N,e[5]=(-c*i+r*s)*N,e[6]=L*N,e[7]=(-A*i+n*h)*N,e[8]=(o*i-n*s)*N,e):null}function ZV(e){const t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],c=e[6],h=e[7],A=e[8];return t*(A*s-o*h)+i*(-A*r+o*c)+n*(h*r-s*c)}function aI(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],c=t[4],h=t[5],A=t[6],_=t[7],C=t[8],S=i[0],L=i[1],N=i[2],U=i[3],H=i[4],j=i[5],tt=i[6],K=i[7],Q=i[8];return e[0]=S*n+L*o+N*A,e[1]=S*r+L*c+N*_,e[2]=S*s+L*h+N*C,e[3]=U*n+H*o+j*A,e[4]=U*r+H*c+j*_,e[5]=U*s+H*h+j*C,e[6]=tt*n+K*o+Q*A,e[7]=tt*r+K*c+Q*_,e[8]=tt*s+K*h+Q*C,e}function YV(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],c=t[4],h=t[5],A=t[6],_=t[7],C=t[8],S=i[0],L=i[1];return e[0]=n,e[1]=r,e[2]=s,e[3]=o,e[4]=c,e[5]=h,e[6]=S*n+L*o+A,e[7]=S*r+L*c+_,e[8]=S*s+L*h+C,e}function $V(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],c=t[4],h=t[5],A=t[6],_=t[7],C=t[8],S=Math.sin(i),L=Math.cos(i);return e[0]=L*n+S*o,e[1]=L*r+S*c,e[2]=L*s+S*h,e[3]=L*o-S*n,e[4]=L*c-S*r,e[5]=L*h-S*s,e[6]=A,e[7]=_,e[8]=C,e}function cI(e,t,i){const n=i[0],r=i[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function tH(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,c=n+n,h=r+r,A=i*o,_=n*o,C=n*c,S=r*o,L=r*c,N=r*h,U=s*o,H=s*c,j=s*h;return e[0]=1-C-N,e[3]=_-j,e[6]=S+H,e[1]=_+j,e[4]=1-A-N,e[7]=L-U,e[2]=S-H,e[5]=L+U,e[8]=1-A-C,e}var W1;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(W1||(W1={}));const eH=Object.freeze([1,0,0,0,1,0,0,0,1]);class gr extends sI{static get IDENTITY(){return nH()}static get ZERO(){return iH()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return W1}constructor(t,...i){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):i.length>0?this.copy([t,...i]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(eH)}fromObject(t){return this.check()}fromQuaternion(t){return tH(this,t),this.check()}set(t,i,n,r,s,o,c,h,A){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this[4]=s,this[5]=o,this[6]=c,this[7]=h,this[8]=A,this.check()}setRowMajor(t,i,n,r,s,o,c,h,A){return this[0]=t,this[1]=r,this[2]=c,this[3]=i,this[4]=s,this[5]=h,this[6]=n,this[7]=o,this[8]=A,this.check()}determinant(){return ZV(this)}transpose(){return KV(this,this),this.check()}invert(){return qV(this,this),this.check()}multiplyLeft(t){return aI(this,t,this),this.check()}multiplyRight(t){return aI(this,this,t),this.check()}rotate(t){return $V(this,this,t),this.check()}scale(t){return Array.isArray(t)?cI(this,this,t):cI(this,this,[t,t]),this.check()}translate(t){return YV(this,this,t),this.check()}transform(t,i){let n;switch(t.length){case 2:n=QS(i||[-0,-0],t,this);break;case 3:n=iI(i||[-0,-0,-0],t,this);break;case 4:n=YS(i||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return XA(n,t.length),n}transformVector(t,i){return this.transform(t,i)}transformVector2(t,i){return this.transform(t,i)}transformVector3(t,i){return this.transform(t,i)}}let g0,m0=null;function iH(){return g0||(g0=new gr([0,0,0,0,0,0,0,0,0]),Object.freeze(g0)),g0}function nH(){return m0||(m0=new gr,Object.freeze(m0)),m0}function rH(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function oH(e,t){if(e===t){const i=t[1],n=t[2],r=t[3],s=t[6],o=t[7],c=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=r,e[13]=o,e[14]=c}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function J1(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],c=t[5],h=t[6],A=t[7],_=t[8],C=t[9],S=t[10],L=t[11],N=t[12],U=t[13],H=t[14],j=t[15],tt=i*c-n*o,K=i*h-r*o,Q=i*A-s*o,pt=n*h-r*c,$=n*A-s*c,zt=r*A-s*h,Gt=_*U-C*N,dt=_*H-S*N,lt=_*j-L*N,Lt=C*H-S*U,J=C*j-L*U,ut=S*j-L*H;let Et=tt*ut-K*J+Q*Lt+pt*lt-$*dt+zt*Gt;return Et?(Et=1/Et,e[0]=(c*ut-h*J+A*Lt)*Et,e[1]=(r*J-n*ut-s*Lt)*Et,e[2]=(U*zt-H*$+j*pt)*Et,e[3]=(S*$-C*zt-L*pt)*Et,e[4]=(h*lt-o*ut-A*dt)*Et,e[5]=(i*ut-r*lt+s*dt)*Et,e[6]=(H*Q-N*zt-j*K)*Et,e[7]=(_*zt-S*Q+L*K)*Et,e[8]=(o*J-c*lt+A*Gt)*Et,e[9]=(n*lt-i*J-s*Gt)*Et,e[10]=(N*$-U*Q+j*tt)*Et,e[11]=(C*Q-_*$-L*tt)*Et,e[12]=(c*dt-o*Lt-h*Gt)*Et,e[13]=(i*Lt-n*dt+r*Gt)*Et,e[14]=(U*K-N*pt-H*tt)*Et,e[15]=(_*pt-C*K+S*tt)*Et,e):null}function sH(e){const t=e[0],i=e[1],n=e[2],r=e[3],s=e[4],o=e[5],c=e[6],h=e[7],A=e[8],_=e[9],C=e[10],S=e[11],L=e[12],N=e[13],U=e[14],H=e[15],j=t*o-i*s,tt=t*c-n*s,K=i*c-n*o,Q=A*N-_*L,pt=A*U-C*L,$=_*U-C*N,zt=t*$-i*pt+n*Q,Gt=s*$-o*pt+c*Q,dt=A*K-_*tt+C*j,lt=L*K-N*tt+U*j;return h*zt-r*Gt+H*dt-S*lt}function Jh(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],c=t[4],h=t[5],A=t[6],_=t[7],C=t[8],S=t[9],L=t[10],N=t[11],U=t[12],H=t[13],j=t[14],tt=t[15];let K=i[0],Q=i[1],pt=i[2],$=i[3];return e[0]=K*n+Q*c+pt*C+$*U,e[1]=K*r+Q*h+pt*S+$*H,e[2]=K*s+Q*A+pt*L+$*j,e[3]=K*o+Q*_+pt*N+$*tt,K=i[4],Q=i[5],pt=i[6],$=i[7],e[4]=K*n+Q*c+pt*C+$*U,e[5]=K*r+Q*h+pt*S+$*H,e[6]=K*s+Q*A+pt*L+$*j,e[7]=K*o+Q*_+pt*N+$*tt,K=i[8],Q=i[9],pt=i[10],$=i[11],e[8]=K*n+Q*c+pt*C+$*U,e[9]=K*r+Q*h+pt*S+$*H,e[10]=K*s+Q*A+pt*L+$*j,e[11]=K*o+Q*_+pt*N+$*tt,K=i[12],Q=i[13],pt=i[14],$=i[15],e[12]=K*n+Q*c+pt*C+$*U,e[13]=K*r+Q*h+pt*S+$*H,e[14]=K*s+Q*A+pt*L+$*j,e[15]=K*o+Q*_+pt*N+$*tt,e}function y0(e,t,i){const n=i[0],r=i[1],s=i[2];let o,c,h,A,_,C,S,L,N,U,H,j;return t===e?(e[12]=t[0]*n+t[4]*r+t[8]*s+t[12],e[13]=t[1]*n+t[5]*r+t[9]*s+t[13],e[14]=t[2]*n+t[6]*r+t[10]*s+t[14],e[15]=t[3]*n+t[7]*r+t[11]*s+t[15]):(o=t[0],c=t[1],h=t[2],A=t[3],_=t[4],C=t[5],S=t[6],L=t[7],N=t[8],U=t[9],H=t[10],j=t[11],e[0]=o,e[1]=c,e[2]=h,e[3]=A,e[4]=_,e[5]=C,e[6]=S,e[7]=L,e[8]=N,e[9]=U,e[10]=H,e[11]=j,e[12]=o*n+_*r+N*s+t[12],e[13]=c*n+C*r+U*s+t[13],e[14]=h*n+S*r+H*s+t[14],e[15]=A*n+L*r+j*s+t[15]),e}function X1(e,t,i){const n=i[0],r=i[1],s=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function aH(e,t,i,n){let r=n[0],s=n[1],o=n[2],c=Math.sqrt(r*r+s*s+o*o),h,A,_,C,S,L,N,U,H,j,tt,K,Q,pt,$,zt,Gt,dt,lt,Lt,J,ut,Et,le;return c<QA?null:(c=1/c,r*=c,s*=c,o*=c,A=Math.sin(i),h=Math.cos(i),_=1-h,C=t[0],S=t[1],L=t[2],N=t[3],U=t[4],H=t[5],j=t[6],tt=t[7],K=t[8],Q=t[9],pt=t[10],$=t[11],zt=r*r*_+h,Gt=s*r*_+o*A,dt=o*r*_-s*A,lt=r*s*_-o*A,Lt=s*s*_+h,J=o*s*_+r*A,ut=r*o*_+s*A,Et=s*o*_-r*A,le=o*o*_+h,e[0]=C*zt+U*Gt+K*dt,e[1]=S*zt+H*Gt+Q*dt,e[2]=L*zt+j*Gt+pt*dt,e[3]=N*zt+tt*Gt+$*dt,e[4]=C*lt+U*Lt+K*J,e[5]=S*lt+H*Lt+Q*J,e[6]=L*lt+j*Lt+pt*J,e[7]=N*lt+tt*Lt+$*J,e[8]=C*ut+U*Et+K*le,e[9]=S*ut+H*Et+Q*le,e[10]=L*ut+j*Et+pt*le,e[11]=N*ut+tt*Et+$*le,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function lI(e,t,i){const n=Math.sin(i),r=Math.cos(i),s=t[4],o=t[5],c=t[6],h=t[7],A=t[8],_=t[9],C=t[10],S=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+A*n,e[5]=o*r+_*n,e[6]=c*r+C*n,e[7]=h*r+S*n,e[8]=A*r-s*n,e[9]=_*r-o*n,e[10]=C*r-c*n,e[11]=S*r-h*n,e}function cH(e,t,i){const n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],c=t[2],h=t[3],A=t[8],_=t[9],C=t[10],S=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r-A*n,e[1]=o*r-_*n,e[2]=c*r-C*n,e[3]=h*r-S*n,e[8]=s*n+A*r,e[9]=o*n+_*r,e[10]=c*n+C*r,e[11]=h*n+S*r,e}function uI(e,t,i){const n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],c=t[2],h=t[3],A=t[4],_=t[5],C=t[6],S=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+A*n,e[1]=o*r+_*n,e[2]=c*r+C*n,e[3]=h*r+S*n,e[4]=A*r-s*n,e[5]=_*r-o*n,e[6]=C*r-c*n,e[7]=S*r-h*n,e}function lH(e,t){const i=t[0],n=t[1],r=t[2],s=t[4],o=t[5],c=t[6],h=t[8],A=t[9],_=t[10];return e[0]=Math.sqrt(i*i+n*n+r*r),e[1]=Math.sqrt(s*s+o*o+c*c),e[2]=Math.sqrt(h*h+A*A+_*_),e}function uH(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=i+i,c=n+n,h=r+r,A=i*o,_=n*o,C=n*c,S=r*o,L=r*c,N=r*h,U=s*o,H=s*c,j=s*h;return e[0]=1-C-N,e[1]=_+j,e[2]=S-H,e[3]=0,e[4]=_-j,e[5]=1-A-N,e[6]=L+U,e[7]=0,e[8]=S+H,e[9]=L-U,e[10]=1-A-C,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hH(e,t,i,n,r,s,o){const c=1/(i-t),h=1/(r-n),A=1/(s-o);return e[0]=s*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*h,e[6]=0,e[7]=0,e[8]=(i+t)*c,e[9]=(r+n)*h,e[10]=(o+s)*A,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*s*2*A,e[15]=0,e}function fH(e,t,i,n,r){const s=1/Math.tan(t/2);if(e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0){const o=1/(n-r);e[10]=(r+n)*o,e[14]=2*r*n*o}else e[10]=-1,e[14]=-2*n;return e}const dH=fH;function pH(e,t,i,n,r,s,o){const c=1/(t-i),h=1/(n-r),A=1/(s-o);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*h,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*A,e[11]=0,e[12]=(t+i)*c,e[13]=(r+n)*h,e[14]=(o+s)*A,e[15]=1,e}const AH=pH;function gH(e,t,i,n){let r,s,o,c,h,A,_,C,S,L;const N=t[0],U=t[1],H=t[2],j=n[0],tt=n[1],K=n[2],Q=i[0],pt=i[1],$=i[2];return Math.abs(N-Q)<QA&&Math.abs(U-pt)<QA&&Math.abs(H-$)<QA?rH(e):(C=N-Q,S=U-pt,L=H-$,r=1/Math.sqrt(C*C+S*S+L*L),C*=r,S*=r,L*=r,s=tt*L-K*S,o=K*C-j*L,c=j*S-tt*C,r=Math.sqrt(s*s+o*o+c*c),r?(r=1/r,s*=r,o*=r,c*=r):(s=0,o=0,c=0),h=S*c-L*o,A=L*s-C*c,_=C*o-S*s,r=Math.sqrt(h*h+A*A+_*_),r?(r=1/r,h*=r,A*=r,_*=r):(h=0,A=0,_=0),e[0]=s,e[1]=h,e[2]=C,e[3]=0,e[4]=o,e[5]=A,e[6]=S,e[7]=0,e[8]=c,e[9]=_,e[10]=L,e[11]=0,e[12]=-(s*N+o*U+c*H),e[13]=-(h*N+A*U+_*H),e[14]=-(C*N+S*U+L*H),e[15]=1,e)}function mH(){const e=new dc(4);return dc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function yH(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function Q1(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function vH(e){const t=e[0],i=e[1],n=e[2],r=e[3];return Math.sqrt(t*t+i*i+n*n+r*r)}function _H(e){const t=e[0],i=e[1],n=e[2],r=e[3];return t*t+i*i+n*n+r*r}function bH(e,t){const i=t[0],n=t[1],r=t[2],s=t[3];let o=i*i+n*n+r*r+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=n*o,e[2]=r*o,e[3]=s*o,e}function xH(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function wH(e,t,i,n){const r=t[0],s=t[1],o=t[2],c=t[3];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e[2]=o+n*(i[2]-o),e[3]=c+n*(i[3]-c),e}function Rd(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,e}function CH(e,t,i){const n=t[0],r=t[1],s=t[2],o=i[0],c=i[1],h=i[2],A=i[3],_=A*n+c*s-h*r,C=A*r+h*n-o*s,S=A*s+o*r-c*n,L=-o*n-c*r-h*s;return e[0]=_*A+L*-o+C*-h-S*-c,e[1]=C*A+L*-c+S*-o-_*-h,e[2]=S*A+L*-h+_*-c-C*-o,e[3]=t[3],e}(function(){const e=mH();return function(t,i,n,r,s,o){let c,h;for(i||(i=4),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,c=n;c<h;c+=i)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],s(e,e,o),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}})();var K1;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(K1||(K1={}));const EH=45*Math.PI/180,BH=1,q1=.1,Z1=500,TH=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class yn extends sI{static get IDENTITY(){return IH()}static get ZERO(){return SH()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return K1}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,i,n,r,s,o,c,h,A,_,C,S,L,N,U,H){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this[4]=s,this[5]=o,this[6]=c,this[7]=h,this[8]=A,this[9]=_,this[10]=C,this[11]=S,this[12]=L,this[13]=N,this[14]=U,this[15]=H,this.check()}setRowMajor(t,i,n,r,s,o,c,h,A,_,C,S,L,N,U,H){return this[0]=t,this[1]=s,this[2]=A,this[3]=L,this[4]=i,this[5]=o,this[6]=_,this[7]=N,this[8]=n,this[9]=c,this[10]=C,this[11]=U,this[12]=r,this[13]=h,this[14]=S,this[15]=H,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(TH)}fromObject(t){return this.check()}fromQuaternion(t){return uH(this,t),this.check()}frustum(t){const{left:i,right:n,bottom:r,top:s,near:o=q1,far:c=Z1}=t;return c===1/0?MH(this,i,n,r,s,o):hH(this,i,n,r,s,o,c),this.check()}lookAt(t){const{eye:i,center:n=[0,0,0],up:r=[0,1,0]}=t;return gH(this,i,n,r),this.check()}ortho(t){const{left:i,right:n,bottom:r,top:s,near:o=q1,far:c=Z1}=t;return AH(this,i,n,r,s,o,c),this.check()}orthographic(t){const{fovy:i=EH,aspect:n=BH,focalDistance:r=1,near:s=q1,far:o=Z1}=t;hI(i);const c=i/2,h=r*Math.tan(c),A=h*n;return this.ortho({left:-A,right:A,bottom:-h,top:h,near:s,far:o})}perspective(t){const{fovy:i=45*Math.PI/180,aspect:n=1,near:r=.1,far:s=500}=t;return hI(i),dH(this,i,n,r,s),this.check()}determinant(){return sH(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,i){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],s=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*s,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*s,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,i){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],i=i||[-0,-0,-0];const n=this.getScale(i),r=1/n[0],s=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*s,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*s,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*s,t[8]=this[10]*o,t}transpose(){return oH(this,this),this.check()}invert(){return J1(this,this),this.check()}multiplyLeft(t){return Jh(this,t,this),this.check()}multiplyRight(t){return Jh(this,this,t),this.check()}rotateX(t){return lI(this,this,t),this.check()}rotateY(t){return cH(this,this,t),this.check()}rotateZ(t){return uI(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,i){return aH(this,this,t,i),this.check()}scale(t){return X1(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return y0(this,this,t),this.check()}transform(t,i){return t.length===4?(i=Rd(i||[-0,-0,-0,-0],t,this),XA(i,4),i):this.transformAsPoint(t,i)}transformAsPoint(t,i){const{length:n}=t;let r;switch(n){case 2:r=KS(i||[-0,-0],t,this);break;case 3:r=j1(i||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return XA(r,t.length),r}transformAsVector(t,i){let n;switch(t.length){case 2:n=qS(i||[-0,-0],t,this);break;case 3:n=ZS(i||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return XA(n,t.length),n}transformPoint(t,i){return this.transformAsPoint(t,i)}transformVector(t,i){return this.transformAsPoint(t,i)}transformDirection(t,i){return this.transformAsVector(t,i)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,i,n){return this.identity().translate([t,i,n])}}let v0,_0;function SH(){return v0||(v0=new yn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(v0)),v0}function IH(){return _0||(_0=new yn,Object.freeze(_0)),_0}function hI(e){if(e>Math.PI*2)throw Error("expected radians")}function MH(e,t,i,n,r,s){const o=2*s/(i-t),c=2*s/(r-n),h=(i+t)/(i-t),A=(r+n)/(r-n),_=-1,C=-1,S=-2*s;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=h,e[9]=A,e[10]=_,e[11]=C,e[12]=0,e[13]=0,e[14]=S,e[15]=0,e}function fI(){const e=new dc(4);return dc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function PH(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function dI(e,t,i){i=i*.5;const n=Math.sin(i);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(i),e}function pI(e,t,i){const n=t[0],r=t[1],s=t[2],o=t[3],c=i[0],h=i[1],A=i[2],_=i[3];return e[0]=n*_+o*c+r*A-s*h,e[1]=r*_+o*h+s*c-n*A,e[2]=s*_+o*A+n*h-r*c,e[3]=o*_-n*c-r*h-s*A,e}function RH(e,t,i){i*=.5;const n=t[0],r=t[1],s=t[2],o=t[3],c=Math.sin(i),h=Math.cos(i);return e[0]=n*h+o*c,e[1]=r*h+s*c,e[2]=s*h-r*c,e[3]=o*h-n*c,e}function DH(e,t,i){i*=.5;const n=t[0],r=t[1],s=t[2],o=t[3],c=Math.sin(i),h=Math.cos(i);return e[0]=n*h-s*c,e[1]=r*h+o*c,e[2]=s*h+n*c,e[3]=o*h-r*c,e}function OH(e,t,i){i*=.5;const n=t[0],r=t[1],s=t[2],o=t[3],c=Math.sin(i),h=Math.cos(i);return e[0]=n*h+r*c,e[1]=r*h-n*c,e[2]=s*h+o*c,e[3]=o*h-s*c,e}function LH(e,t){const i=t[0],n=t[1],r=t[2];return e[0]=i,e[1]=n,e[2]=r,e[3]=Math.sqrt(Math.abs(1-i*i-n*n-r*r)),e}function b0(e,t,i,n){const r=t[0],s=t[1],o=t[2],c=t[3];let h=i[0],A=i[1],_=i[2],C=i[3],S,L,N,U,H;return S=r*h+s*A+o*_+c*C,S<0&&(S=-S,h=-h,A=-A,_=-_,C=-C),1-S>QA?(L=Math.acos(S),H=Math.sin(L),N=Math.sin((1-n)*L)/H,U=Math.sin(n*L)/H):(N=1-n,U=n),e[0]=N*r+U*h,e[1]=N*s+U*A,e[2]=N*o+U*_,e[3]=N*c+U*C,e}function FH(e,t){const i=t[0],n=t[1],r=t[2],s=t[3],o=i*i+n*n+r*r+s*s,c=o?1/o:0;return e[0]=-i*c,e[1]=-n*c,e[2]=-r*c,e[3]=s*c,e}function kH(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function AI(e,t){const i=t[0]+t[4]+t[8];let n;if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);const s=(r+1)%3,o=(r+2)%3;n=Math.sqrt(t[r*3+r]-t[s*3+s]-t[o*3+o]+1),e[r]=.5*n,n=.5/n,e[3]=(t[s*3+o]-t[o*3+s])*n,e[s]=(t[s*3+r]+t[r*3+s])*n,e[o]=(t[o*3+r]+t[r*3+o])*n}return e}const NH=yH,UH=Q1,zH=xH,GH=wH,jH=vH,VH=_H,gI=bH,HH=function(){const e=$S(),t=eI(1,0,0),i=eI(0,1,0);return function(n,r,s){const o=G1(r,s);return o<-.999999?(d0(e,t,r),oI(e)<1e-6&&d0(e,i,r),jV(e,e),dI(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(d0(e,r,s),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,gI(n,n))}}();(function(){const e=fI(),t=fI();return function(i,n,r,s,o,c){return b0(e,n,o,c),b0(t,r,s,c),b0(i,e,t,2*c*(1-c)),i}})(),function(){const e=QV();return function(t,i,n,r){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],gI(t,AI(t,e))}}();const WH=[0,0,0,1];class KA extends N1{constructor(t=0,i=0,n=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,i,n,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,i,n,r){return this[0]=t,this[1]=i,this[2]=n,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return AI(this,t),this.check()}fromAxisRotation(t,i){return dI(this,t,i),this.check()}identity(){return PH(this),this.check()}setAxisAngle(t,i){return this.fromAxisRotation(t,i)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=Zn(t)}get y(){return this[1]}set y(t){this[1]=Zn(t)}get z(){return this[2]}set z(t){this[2]=Zn(t)}get w(){return this[3]}set w(t){this[3]=Zn(t)}len(){return jH(this)}lengthSquared(){return VH(this)}dot(t){return zH(this,t)}rotationTo(t,i){return HH(this,t,i),this.check()}add(t){return NH(this,this,t),this.check()}calculateW(){return LH(this,this),this.check()}conjugate(){return kH(this,this),this.check()}invert(){return FH(this,this),this.check()}lerp(t,i,n){return n===void 0?this.lerp(this,t,i):(GH(this,t,i,n),this.check())}multiplyRight(t){return pI(this,this,t),this.check()}multiplyLeft(t){return pI(this,t,this),this.check()}normalize(){const t=this.len(),i=t>0?1/t:0;return this[0]=this[0]*i,this[1]=this[1]*i,this[2]=this[2]*i,this[3]=this[3]*i,t===0&&(this[3]=1),this.check()}rotateX(t){return RH(this,this,t),this.check()}rotateY(t){return DH(this,this,t),this.check()}rotateZ(t){return OH(this,this,t),this.check()}scale(t){return UH(this,this,t),this.check()}slerp(t,i,n){let r,s,o;switch(arguments.length){case 1:({start:r=WH,target:s,ratio:o}=t);break;case 2:r=this,s=t,o=i;break;default:r=t,s=i,o=n}return b0(this,r,s,o),this.check()}transformVector4(t,i=new LE){return CH(i,t,this),XA(i,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,i){return this.setAxisAngle(t,i)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}const JH=.1,XH=1e-12,mI=1e-15,QH=1e-20;function yI(e,t=[],i=0){const n=Math.fround(e),r=e-n;return t[i]=n,t[i+1]=r,t}function KH(e){return e-Math.fround(e)}function qH(e){const t=new Float32Array(32);for(let i=0;i<4;++i)for(let n=0;n<4;++n){const r=i*4+n;yI(e[n*4+i],t,r*2)}return t}const ZH=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,YH={name:"fp32",vs:ZH},$H=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,tW={ONE:1},eW={name:"fp64arithmetic",vs:$H,defaultUniforms:tW,uniformTypes:{ONE:"f32"},fp64ify:yI,fp64LowPart:KH,fp64ifyMatrix4:qH},iW=[0,1,1,1],nW=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,rW=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,vI={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:iW},vs:nW,fs:rW,getUniforms:oW};function oW(e={},t){const i={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)i.isHighlightActive=!1;else{i.isHighlightActive=!0;const n=e.highlightedObjectColor.slice(0,3);i.highlightedObjectColor=n}if(e.highlightColor){const n=Array.from(e.highlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),i.highlightColor=n}return e.isActive!==void 0&&(i.isActive=!!e.isActive,i.isAttribute=!!e.isAttribute),e.useFloatColors!==void 0&&(i.useFloatColors=!!e.useFloatColors),i}const _I=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,sW=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,bI=3,aW=255;var qA;(function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"})(qA||(qA={}));const Dd={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:bI},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:qA.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:sW,vs:_I,fs:_I,getUniforms:cW};function cW(e,t={}){if(e=e&&{...e},!e)return{...Dd.defaultUniforms};e.lights&&(e={...e,...uW(e.lights),lights:void 0});const{ambientLight:i,pointLights:n,directionalLights:r}=e||{};if(!(i||n&&n.length>0||r&&r.length>0))return{...Dd.defaultUniforms,enabled:0};const s={...Dd.defaultUniforms,...t,...lW({ambientLight:i,pointLights:n,directionalLights:r})};return e.enabled!==void 0&&(s.enabled=e.enabled?1:0),s}function lW({ambientLight:e,pointLights:t=[],directionalLights:i=[]}){const n={};n.ambientLightColor=Y1(e);let r=0;for(const s of t){n.lightType=qA.POINT;const o=r;n[`lightColor${o}`]=Y1(s),n[`lightPosition${o}`]=s.position,n[`lightAttenuation${o}`]=s.attenuation||[1,0,0],r++}for(const s of i){n.lightType=qA.DIRECTIONAL;const o=r;n[`lightColor${o}`]=Y1(s),n[`lightDirection${o}`]=s.direction,r++}return r>bI&&$e.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=i.length,n.pointLightCount=t.length,n}function uW(e){const t={pointLights:[],directionalLights:[]};for(const i of e||[])switch(i.type){case"ambient":t.ambientLight=i;break;case"directional":t.directionalLights?.push(i);break;case"point":t.pointLights?.push(i);break}return t}function Y1(e={}){const{color:t=[0,0,0],intensity:i=1}=e;return t.map(n=>n*i/aW)}const xI=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,wI=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,CI=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,x0={props:{},name:"gouraudMaterial",vs:wI.replace("phongMaterial","gouraudMaterial"),fs:xI.replace("phongMaterial","gouraudMaterial"),source:CI.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Dd],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(i=>i/255)),{...x0.defaultUniforms,...t}}},$1={name:"phongMaterial",dependencies:[Dd],source:CI,vs:xI,fs:wI,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(i=>i/255)),{...$1.defaultUniforms,...t}}},hW=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fW=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,EI=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,dW={name:"pbrProjection",vs:EI,fs:EI,getUniforms:e=>e,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}},tb={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Dd,dW],vs:hW,fs:fW,defines:{LIGHTING_FRAGMENT:1},getUniforms:e=>e,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}},BI=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,pW={name:"layer",vs:BI,fs:BI,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},AW=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,TI="#define SMOOTH_EDGE_RADIUS 0.5",gW=`${TI}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,mW=`${TI}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,SI={name:"geometry",source:AW,vs:gW,fs:mW},yW=25;var po;(function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"})(po||(po={}));var Eo;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"})(Eo||(Eo={}));var vn;(function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"})(vn||(vn={}));const vW="compute",_W="auto",eb="manipulation",w0="none",ib="pan-x",nb="pan-y";function bW(e){if(e.includes(w0))return w0;const t=e.includes(ib),i=e.includes(nb);return t&&i?w0:t||i?t?ib:nb:e.includes(eb)?eb:_W}class xW{constructor(t,i){this.actions="",this.manager=t,this.set(i)}set(t){t===vW&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(const i of this.manager.recognizers)i.options.enable&&(t=t.concat(i.getTouchAction()));return bW(t.join(" "))}}function C0(e){return e.trim().split(/\s+/g)}function rb(e,t,i){if(e)for(const n of C0(t))e.addEventListener(n,i,!1)}function ob(e,t,i){if(e)for(const n of C0(t))e.removeEventListener(n,i,!1)}function II(e){return(e.ownerDocument||e).defaultView}function wW(e,t){let i=e;for(;i;){if(i===t)return!0;i=i.parentNode}return!1}function MI(e){const t=e.length;if(t===1)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let i=0,n=0,r=0;for(;r<t;)i+=e[r].clientX,n+=e[r].clientY,r++;return{x:Math.round(i/t),y:Math.round(n/t)}}function PI(e){const t=[];let i=0;for(;i<e.pointers.length;)t[i]={clientX:Math.round(e.pointers[i].clientX),clientY:Math.round(e.pointers[i].clientY)},i++;return{timeStamp:Date.now(),pointers:t,center:MI(t),deltaX:e.deltaX,deltaY:e.deltaY}}function RI(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}function DI(e,t){const i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(i*i+n*n)}function CW(e,t){const i=t.x-e.x,n=t.y-e.y;return Math.atan2(n,i)*180/Math.PI}function OI(e,t){const i=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.atan2(n,i)*180/Math.PI}function LI(e,t){return e===t?Eo.None:Math.abs(e)>=Math.abs(t)?e<0?Eo.Left:Eo.Right:t<0?Eo.Up:Eo.Down}function EW(e,t){const i=t.center;let n=e.offsetDelta,r=e.prevDelta;const s=e.prevInput;return(t.eventType===po.Start||s?.eventType===po.End)&&(r=e.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},n=e.offsetDelta={x:i.x,y:i.y}),{deltaX:r.x+(i.x-n.x),deltaY:r.y+(i.y-n.y)}}function FI(e,t,i){return{x:t/e||0,y:i/e||0}}function BW(e,t){return DI(t[0],t[1])/DI(e[0],e[1])}function TW(e,t){return OI(t[1],t[0])-OI(e[1],e[0])}function SW(e,t){const i=e.lastInterval||t,n=t.timeStamp-i.timeStamp;let r,s,o,c;if(t.eventType!==po.Cancel&&(n>yW||i.velocity===void 0)){const h=t.deltaX-i.deltaX,A=t.deltaY-i.deltaY,_=FI(n,h,A);s=_.x,o=_.y,r=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,c=LI(h,A),e.lastInterval=t}else r=i.velocity,s=i.velocityX,o=i.velocityY,c=i.direction;t.velocity=r,t.velocityX=s,t.velocityY=o,t.direction=c}function IW(e,t){const{session:i}=e,{pointers:n}=t,{length:r}=n;i.firstInput||(i.firstInput=PI(t)),r>1&&!i.firstMultiple?i.firstMultiple=PI(t):r===1&&(i.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=i,c=o?o.center:s.center,h=t.center=MI(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=CW(c,h),t.distance=RI(c,h);const{deltaX:A,deltaY:_}=EW(i,t);t.deltaX=A,t.deltaY=_,t.offsetDirection=LI(t.deltaX,t.deltaY);const C=FI(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=C.x,t.overallVelocityY=C.y,t.overallVelocity=Math.abs(C.x)>Math.abs(C.y)?C.x:C.y,t.scale=o?BW(o.pointers,n):1,t.rotation=o?TW(o.pointers,n):0,t.maxPointers=i.prevInput?t.pointers.length>i.prevInput.maxPointers?t.pointers.length:i.prevInput.maxPointers:t.pointers.length;let S=e.element;return wW(t.srcEvent.target,S)&&(S=t.srcEvent.target),t.target=S,SW(i,t),t}function MW(e,t,i){const n=i.pointers.length,r=i.changedPointers.length,s=t&po.Start&&n-r===0,o=t&(po.End|po.Cancel)&&n-r===0;i.isFirst=!!s,i.isFinal=!!o,s&&(e.session={}),i.eventType=t;const c=IW(e,i);e.emit("hammer.input",c),e.recognize(c),e.session.prevInput=c}let PW=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){MW(this.manager,e,t)}init(){rb(this.element,this.evEl,this.domHandler),rb(this.target,this.evTarget,this.domHandler),rb(II(this.element),this.evWin,this.domHandler)}destroy(){ob(this.element,this.evEl,this.domHandler),ob(this.target,this.evTarget,this.domHandler),ob(II(this.element),this.evWin,this.domHandler)}};const RW={pointerdown:po.Start,pointermove:po.Move,pointerup:po.End,pointercancel:po.Cancel,pointerout:po.Cancel},DW="pointerdown",OW="pointermove pointerup pointercancel";class LW extends PW{constructor(t){super(t),this.evEl=DW,this.evWin=OW,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){const{store:i}=this;let n=!1;const r=RW[t.type],s=t.pointerType,o=s==="touch";let c=i.findIndex(h=>h.pointerId===t.pointerId);r&po.Start&&(t.buttons||o)?c<0&&(i.push(t),c=i.length-1):r&(po.End|po.Cancel)&&(n=!0),!(c<0)&&(i[c]=t,this.callback(r,{pointers:i,changedPointers:[t],eventType:r,pointerType:s,srcEvent:t}),n&&i.splice(c,1))}}const FW=["","webkit","Moz","MS","ms","o"];function kW(e,t){const i=t[0].toUpperCase()+t.slice(1);for(const n of FW){const r=n?n+i:t;if(r in e)return r}}const NW=1,kI=2,NI={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};let UW=class{constructor(e,t){this.options={...NI,...t,cssProps:{...NI.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new LW(this),this.touchAction=new xW(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?kI:NW}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:n}=this;let{curRecognizer:r}=t;(!r||r&&r.state&vn.Recognized)&&(r=t.curRecognizer=null);let s=0;for(;s<n.length;)i=n[s],t.stopped!==kI&&(!r||i===r||i.canRecognizeWith(r))?i.recognize(e):i.reset(),!r&&i.state&(vn.Began|vn.Changed|vn.Ended)&&(r=t.curRecognizer=i),s++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,n=i.indexOf(t);n!==-1&&(i.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const n of C0(e))i[n]=i[n]||[],i[n].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const n of C0(e))t?i[n]&&i[n].splice(i[n].indexOf(t),1):delete i[n]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const n=t;n.type=e,n.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<i.length;)i[r](n),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,n]of Object.entries(this.options.cssProps)){const r=kW(t.style,i);e?(this.oldCssProps[r]=t.style[r],t.style[r]=n):t.style[r]=this.oldCssProps[r]||""}e||(this.oldCssProps={})}}},zW=1;function GW(){return zW++}function UI(e){return e&vn.Cancelled?"cancel":e&vn.Ended?"end":e&vn.Changed?"move":e&vn.Began?"start":""}class zI{constructor(t){this.options=t,this.id=GW(),this.state=vn.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(const r of t)this.recognizeWith(r);return this}let i;if(typeof t=="string"){if(i=this.manager.get(t),!i)throw new Error(`Cannot find recognizer ${t}`)}else i=t;const{simultaneous:n}=this;return n[i.id]||(n[i.id]=i,i.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(const n of t)this.dropRecognizeWith(n);return this}let i;return typeof t=="string"?i=this.manager.get(t):i=t,i&&delete this.simultaneous[i.id],this}requireFailure(t){if(Array.isArray(t)){for(const r of t)this.requireFailure(r);return this}let i;if(typeof t=="string"){if(i=this.manager.get(t),!i)throw new Error(`Cannot find recognizer ${t}`)}else i=t;const{requireFail:n}=this;return n.indexOf(i)===-1&&(n.push(i),i.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(const n of t)this.dropRequireFailure(n);return this}let i;if(typeof t=="string"?i=this.manager.get(t):i=t,i){const n=this.requireFail.indexOf(i);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return!!this.requireFail.find(t=>t.options.enable)}canRecognizeWith(t){return!!this.simultaneous[t.id]}emit(t){if(!t)return;const{state:i}=this;i<vn.Ended&&this.manager.emit(this.options.event+UI(i),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),i>=vn.Ended&&this.manager.emit(this.options.event+UI(i),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=vn.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(vn.Failed|vn.Possible)))return!1;t++}return!0}recognize(t){const i={...t};if(!this.options.enable){this.reset(),this.state=vn.Failed;return}this.state&(vn.Recognized|vn.Cancelled|vn.Failed)&&(this.state=vn.Possible),this.state=this.process(i),this.state&(vn.Began|vn.Changed|vn.Ended|vn.Cancelled)&&this.tryEmit(i)}getEventNames(){return[this.options.event]}reset(){}}class GI extends zI{attrTest(t){const i=this.options.pointers;return i===0||t.pointers.length===i}process(t){const{state:i}=this,{eventType:n}=t,r=i&(vn.Began|vn.Changed),s=this.attrTest(t);return r&&(n&po.Cancel||!s)?i|vn.Cancelled:r||s?n&po.End?i|vn.Ended:i&vn.Began?i|vn.Changed:vn.Began:vn.Failed}}class jI extends zI{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[eb]}process(t){const{options:i}=this,n=t.pointers.length===i.pointers,r=t.distance<i.threshold,s=t.deltaTime<i.time;if(this.reset(),t.eventType&po.Start&&this.count===0)return this.failTimeout();if(r&&s&&n){if(t.eventType!==po.End)return this.failTimeout();const o=this.pTime?t.timeStamp-this.pTime<i.interval:!0,c=!this.pCenter||RI(this.pCenter,t.center)<i.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!c||!o?this.count=1:this.count+=1,this._input=t,this.count%i.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=vn.Recognized,this.tryEmit(this._input)},i.interval),vn.Began):vn.Recognized}return vn.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=vn.Failed},this.options.interval),vn.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===vn.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}}const jW=["","start","move","end","cancel","up","down","left","right"];class VI extends GI{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Eo.All,...t}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:t}}=this,i=[];return t&Eo.Horizontal&&i.push(nb),t&Eo.Vertical&&i.push(ib),i}getEventNames(){return jW.map(t=>this.options.event+t)}directionTest(t){const{options:i}=this;let n=!0,{distance:r}=t,{direction:s}=t;const o=t.deltaX,c=t.deltaY;return s&i.direction||(i.direction&Eo.Horizontal?(s=o===0?Eo.None:o<0?Eo.Left:Eo.Right,n=o!==this.pX,r=Math.abs(t.deltaX)):(s=c===0?Eo.None:c<0?Eo.Up:Eo.Down,n=c!==this.pY,r=Math.abs(t.deltaY))),t.direction=s,n&&r>i.threshold&&!!(s&i.direction)}attrTest(t){return super.attrTest(t)&&(!!(this.state&vn.Began)||!(this.state&vn.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;const i=Eo[t.direction].toLowerCase();i&&(t.additionalEvent=this.options.event+i),super.emit(t)}}const VW=["","start","move","end","cancel","in","out"];class HW extends GI{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[w0]}getEventNames(){return VW.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||!!(this.state&vn.Began))}emit(t){if(t.scale!==1){const i=t.scale<1?"in":"out";t.additionalEvent=this.options.event+i}super.emit(t)}}let E0=class{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}};const WW=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",JW=WW.indexOf("firefox")!==-1,HI=4.000244140625,XW=40,QW=.25;let KW=class extends E0{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=n=>{if(!this.options.enable)return;let r=n.deltaY;globalThis.WheelEvent&&(JW&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(r/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(r*=XW)),r!==0&&r%HI===0&&(r=Math.floor(r/HI)),n.shiftKey&&r&&(r=r*QW),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-r,srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}};const WI=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];let qW=class extends E0{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=r=>{this.handleOverEvent(r),this.handleOutEvent(r),this.handleEnterEvent(r),this.handleLeaveEvent(r),this.handleMoveEvent(r)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,WI.forEach(r=>e.addEventListener(r,this.handleEvent))}destroy(){WI.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}};const JI=["keydown","keyup"];let ZW=class extends E0{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=n=>{const r=n.target||n.srcElement;r.tagName==="INPUT"&&r.type==="text"||r.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",JI.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){JI.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}},YW=class extends E0{constructor(e,t,i){super(e,t,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}};const XI=1,sb=2,QI=4,$W={pointerdown:XI,pointermove:sb,pointerup:QI,mousedown:XI,mousemove:sb,mouseup:QI},tJ=0,eJ=1,iJ=2,nJ=1,rJ=2,oJ=4;function sJ(e){const t=$W[e.srcEvent.type];if(!t)return null;const{buttons:i,button:n}=e.srcEvent;let r=!1,s=!1,o=!1;return t===sb?(r=!!(i&nJ),s=!!(i&oJ),o=!!(i&rJ)):(r=n===tJ,s=n===eJ,o=n===iJ),{leftButton:r,middleButton:s,rightButton:o}}function aJ(e,t){const i=e.center;if(!i)return null;const n=t.getBoundingClientRect(),r=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,o={x:(i.x-n.left-t.clientLeft)/r,y:(i.y-n.top-t.clientTop)/s};return{center:i,offsetCenter:o}}const cJ={srcElement:"root",priority:0};let lJ=class{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==n.rootElement;){if(this._emit(n,r),n.handled)return;r=r.parentNode}this._emit(n,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,n=!1,r=!1){const{handlers:s,handlersByElement:o}=this,c={...cJ,...i};let h=o.get(c.srcElement);h||(h=[],o.set(c.srcElement,h));const A={type:e,handler:t,srcElement:c.srcElement,priority:c.priority};n&&(A.once=!0),r&&(A.passive=!0),s.push(A),this._active=this._active||!A.passive;let _=h.length-1;for(;_>=0&&!(h[_].priority>=A.priority);)_--;h.splice(_+1,0,A)}remove(e,t){const{handlers:i,handlersByElement:n}=this;for(let r=i.length-1;r>=0;r--){const s=i[r];if(s.type===e&&s.handler===t){i.splice(r,1);const o=n.get(s.srcElement);o.splice(o.indexOf(s),1),o.length===0&&n.delete(s.srcElement)}}this._active=i.some(r=>!r.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let n=!1;const r=()=>{e.handled=!0},s=()=>{e.handled=!0,n=!0},o=[];for(let c=0;c<i.length;c++){const{type:h,handler:A,once:_}=i[c];if(A({...e,type:h,stopPropagation:r,stopImmediatePropagation:s}),_&&o.push(i[c]),n)break}for(let c=0;c<o.length;c++){const{type:h,handler:A}=o[c];this.remove(h,A)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...sJ(e),...aJ(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}};function uJ(e){if("recognizer"in e)return e;let t;const i=Array.isArray(e)?[...e]:[e];if(typeof i[0]=="function"){const n=i.shift(),r=i.shift()||{};t=new n(r)}else t=i.shift();return{recognizer:t,recognizeWith:typeof i[0]=="string"?[i[0]]:i[0],requireFailure:typeof i[1]=="string"?[i[1]]:i[1]}}let hJ=class{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new UW(e,this.options);for(const i of this.options.recognizers){const{recognizer:n,recognizeWith:r,requireFailure:s}=uJ(i);this.manager.add(n),r&&n.recognizeWith(r),s&&n.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new KW(e,this._onOtherEvent,{enable:!1}),this.moveInput=new qW(e,this._onOtherEvent,{enable:!1}),this.keyInput=new ZW(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new YW(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const n=i.get(e);n&&(n.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,n,r){if(typeof e!="string"){i=t;for(const[h,A]of Object.entries(e))this._addEventHandler(h,A,i,n,r);return}const{manager:s,events:o}=this;if(!s)return;let c=o.get(e);if(!c){const h=this._getRecognizerName(e)||e;c=new lJ(this,h),o.set(e,c),s&&s.on(e,c.handleEvent)}c.add(e,t,i,n,r),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[r,s]of Object.entries(e))this._removeEventHandler(r,s);return}const{events:i}=this,n=i.get(e);if(n&&(n.remove(e,t),n.isEmpty())){const{recognizerName:r}=n;let s=!1;for(const o of i.values())if(o.recognizerName===r&&!o.isEmpty()){s=!0;break}s||this._toggleRecognizer(r,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}};const $i={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty($i,"IDENTITY",{get:()=>(Zi.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const la={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ms={common:0,meters:1,pixels:2},ab={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},KI={multipan:[VI,{threshold:10,direction:Eo.Vertical,pointers:2}],pinch:[HW,{},null,["multipan"]],pan:[VI,{threshold:1},["pinch"],["multipan"]],dblclick:[jI,{event:"dblclick",taps:2}],click:[jI,{event:"click"},null,["dblclick"]]};function fJ(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}function ZA(e){let t={},i;return n=>{for(const r in n)if(!fJ(n[r],t[r])){i=e(n),t=n;break}return i}}const qI=[0,0,0,0],dJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ZI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],pJ=[0,0,0],YI=[0,0,0],AJ=ZA(yJ);function $I(e,t,i=YI){i.length<3&&(i=[i[0],i[1],0]);let n=i,r,s=!0;switch(t===$i.LNGLAT_OFFSETS||t===$i.METER_OFFSETS?r=i:r=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case la.WEB_MERCATOR:(t===$i.LNGLAT||t===$i.CARTESIAN)&&(r=[0,0,0],s=!1);break;case la.WEB_MERCATOR_AUTO_OFFSET:t===$i.LNGLAT?n=r:t===$i.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],r=e.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case la.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case la.GLOBE:s=!1,r=null;break;default:s=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:s}}function gJ(e,t,i){const{viewMatrixUncentered:n,projectionMatrix:r}=e;let{viewMatrix:s,viewProjectionMatrix:o}=e,c=qI,h=qI,A=e.cameraPosition;const{geospatialOrigin:_,shaderCoordinateOrigin:C,offsetMode:S}=$I(e,t,i);return S&&(h=e.projectPosition(_||C),A=[A[0]-h[0],A[1]-h[1],A[2]-h[2]],h[3]=1,c=Rd([],h,o),s=n||s,o=Jh([],r,s),o=Jh([],o,dJ)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:c,originCommon:h,cameraPosCommon:A,shaderCoordinateOrigin:C,geospatialOrigin:_}}function mJ({viewport:e,devicePixelRatio:t=1,modelMatrix:i=null,coordinateSystem:n=$i.DEFAULT,coordinateOrigin:r=YI,autoWrapLongitude:s=!1}){n===$i.DEFAULT&&(n=e.isGeospatial?$i.LNGLAT:$i.CARTESIAN);const o=AJ({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:r});return o.wrapLongitude=s,o.modelMatrix=i||ZI,o}function yJ({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:n}){const{projectionCenter:r,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:A}=gJ(e,i,n),_=e.getDistanceScales(),C=[e.width*t,e.height*t],S=Rd([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,L={coordinateSystem:i,projectionMode:e.projectionMode,coordinateOrigin:h,commonOrigin:o.slice(0,3),center:r,pseudoMeters:!!e._pseudoMeters,viewportSize:C,devicePixelRatio:t,focalDistance:S,commonUnitsPerMeter:_.unitsPerMeter,commonUnitsPerWorldUnit:_.unitsPerMeter,commonUnitsPerWorldUnit2:pJ,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:ZI,cameraPosition:c};if(A){const N=e.getDistanceScales(A);switch(i){case $i.METER_OFFSETS:L.commonUnitsPerWorldUnit=N.unitsPerMeter,L.commonUnitsPerWorldUnit2=N.unitsPerMeter2;break;case $i.LNGLAT:case $i.LNGLAT_OFFSETS:e._pseudoMeters||(L.commonUnitsPerMeter=N.unitsPerMeter),L.commonUnitsPerWorldUnit=N.unitsPerDegree,L.commonUnitsPerWorldUnit2=N.unitsPerDegree2;break;case $i.CARTESIAN:L.commonUnitsPerWorldUnit=[1,1,N.unitsPerMeter[2]],L.commonUnitsPerWorldUnit2=[0,0,N.unitsPerMeter2[2]];break}}return L}const vJ=Object.keys($i).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${$i[e]};`).join(""),_J=Object.keys(la).map(e=>`const PROJECTION_MODE_${e}: i32 = ${la[e]};`).join(""),bJ=Object.keys(Ms).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${Ms[e]};`).join(""),xJ=`${vJ}
${_J}
${bJ}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,wJ=`${xJ}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z\u2011axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,CJ=Object.keys($i).map(e=>`const int COORDINATE_SYSTEM_${e} = ${$i[e]};`).join(""),EJ=Object.keys(la).map(e=>`const int PROJECTION_MODE_${e} = ${la[e]};`).join(""),BJ=Object.keys(Ms).map(e=>`const int UNIT_${e.toUpperCase()} = ${Ms[e]};`).join(""),TJ=`${CJ}
${EJ}
${BJ}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,SJ={};function IJ(e=SJ){return"viewport"in e?mJ(e):{}}const B0={name:"project",dependencies:[YH,SI],source:wJ,vs:TJ,getUniforms:IJ,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},MJ=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,PJ=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Fo={name:"project32",dependencies:[B0],source:MJ,vs:PJ};function RJ(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Od(e,t){const i=Rd([],t,e);return Q1(i,i,1/i[3]),i}function tM(e,t){const i=e%t;return i<0?t+i:i}function cb(e,t,i){return e<t?t:e>i?i:e}function DJ(e){return Math.log(e)*Math.LOG2E}const lb=Math.log2||DJ;function Jl(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const pc=Math.PI,eM=pc/4,Oa=pc/180,ub=180/pc,Ld=512,T0=4003e4,Fd=85.051129,OJ=1.5;function LJ(e){return lb(e)}function Xl(e){const[t,i]=e;Jl(Number.isFinite(t)),Jl(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=t*Oa,r=i*Oa,s=Ld*(n+pc)/(2*pc),o=Ld*(pc+Math.log(Math.tan(eM+r*.5)))/(2*pc);return[s,o]}function rl(e){const[t,i]=e,n=t/Ld*(2*pc)-pc,r=2*(Math.atan(Math.exp(i/Ld*(2*pc)-pc))-eM);return[n*ub,r*ub]}function FJ(e){const{latitude:t}=e;Jl(Number.isFinite(t));const i=Math.cos(t*Oa);return LJ(T0*i)-9}function hb(e){const t=Math.cos(e*Oa);return Ld/T0/t}function fb(e){const{latitude:t,longitude:i,highPrecision:n=!1}=e;Jl(Number.isFinite(t)&&Number.isFinite(i));const r=Ld,s=Math.cos(t*Oa),o=r/360,c=o/s,h=r/T0/s,A={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[o,c,h],degreesPerUnit:[1/o,1/c,1/h]};if(n){const _=Oa*Math.tan(t*Oa)/s,C=o*_/2,S=r/T0*_,L=S/c*h;A.unitsPerDegree2=[0,C,S],A.unitsPerMeter2=[L,0,L]}return A}function iM(e,t){const[i,n,r]=e,[s,o,c]=t,{unitsPerMeter:h,unitsPerMeter2:A}=fb({longitude:i,latitude:n,highPrecision:!0}),_=Xl(e);_[0]+=s*(h[0]+A[0]*o),_[1]+=o*(h[1]+A[1]*o);const C=rl(_),S=(r||0)+(c||0);return Number.isFinite(r)||Number.isFinite(c)?[C[0],C[1],S]:C}function kJ(e){const{height:t,pitch:i,bearing:n,altitude:r,scale:s,center:o}=e,c=RJ();y0(c,c,[0,0,-r]),lI(c,c,-i*Oa),uI(c,c,n*Oa);const h=s/t;return X1(c,c,[h,h,h]),o&&y0(c,c,GV([],o)),c}function NJ(e){const{width:t,height:i,altitude:n,pitch:r=0,offset:s,center:o,scale:c,nearZMultiplier:h=1,farZMultiplier:A=1}=e;let{fovy:_=YA(OJ)}=e;n!==void 0&&(_=YA(n));const C=_*Oa,S=r*Oa,L=db(_);let N=L;o&&(N+=o[2]*c/Math.cos(S)/i);const U=C*(.5+(s?s[1]:0)/i),H=Math.sin(U)*N/Math.sin(cb(Math.PI/2-S-U,.01,Math.PI-.01)),j=Math.sin(S)*H+N,tt=N*10,K=Math.min(j*A,tt);return{fov:C,aspect:t/i,focalDistance:L,near:h,far:K}}function YA(e){return 2*Math.atan(.5/e)*ub}function db(e){return .5/Math.tan(.5*e*Oa)}function nM(e,t){const[i,n,r=0]=e;return Jl(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(r)),Od(t,[i,n,r,1])}function pb(e,t,i=0){const[n,r,s]=e;if(Jl(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return Od(t,[n,r,s,1]);const o=Od(t,[n,r,0,1]),c=Od(t,[n,r,1,1]),h=o[2],A=c[2],_=h===A?0:((i||0)-h)/(A-h);return XS([],o,c,_)}function UJ(e){const{width:t,height:i,bounds:n,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=e,[[c,h],[A,_]]=n,C=zJ(e.padding),S=Xl([c,cb(_,-Fd,Fd)]),L=Xl([A,cb(h,-Fd,Fd)]),N=[Math.max(Math.abs(L[0]-S[0]),r),Math.max(Math.abs(L[1]-S[1]),r)],U=[t-C.left-C.right-Math.abs(o[0])*2,i-C.top-C.bottom-Math.abs(o[1])*2];Jl(U[0]>0&&U[1]>0);const H=U[0]/N[0],j=U[1]/N[1],tt=(C.right-C.left)/2/H,K=(C.top-C.bottom)/2/j,Q=[(L[0]+S[0])/2+tt,(L[1]+S[1])/2+K],pt=rl(Q),$=Math.min(s,lb(Math.abs(Math.min(H,j))));return Jl(Number.isFinite($)),{longitude:pt[0],latitude:pt[1],zoom:$}}function zJ(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(Jl(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const rM=Math.PI/180;function GJ(e,t=0){const{width:i,height:n,unproject:r}=e,s={targetZ:t},o=r([0,n],s),c=r([i,n],s);let h,A;const _=e.fovy?.5*e.fovy*rM:Math.atan(.5/e.altitude),C=(90-e.pitch)*rM;return _>C-.01?(h=oM(e,0,t),A=oM(e,i,t)):(h=r([0,0],s),A=r([i,0],s)),[o,c,A,h]}function oM(e,t,i){const{pixelUnprojectionMatrix:n}=e,r=Od(n,[t,0,1,1]),s=Od(n,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),c=XS([],r,s,o),h=rl(c);return h.push(i),h}const sM=512;function jJ(e){const{width:t,height:i,pitch:n=0}=e;let{longitude:r,latitude:s,zoom:o,bearing:c=0}=e;(r<-180||r>180)&&(r=tM(r+180,360)-180),(c<-180||c>180)&&(c=tM(c+180,360)-180);const h=lb(i/sM);if(o<=h)o=h,s=0;else{const A=i/2/Math.pow(2,o),_=rl([0,A])[1];if(s<_)s=_;else{const C=rl([0,sM-A])[1];s>C&&(s=C)}}return{width:t,height:i,longitude:r,latitude:s,zoom:o,pitch:n,bearing:c}}const aM=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,VJ=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,HJ=`
${aM}
${VJ}
`,WJ=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,JJ=`
${aM}
${WJ}
`,XJ=ZA(YJ),QJ=ZA($J),KJ=[0,0,0,1],qJ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function ZJ(e,t){const[i,n,r]=e,s=pb([i,n,r],t);return Number.isFinite(r)?s:[s[0],s[1],0]}function YJ({viewport:e,center:t}){return new yn(e.viewProjectionMatrix).invert().transform(t)}function $J({viewport:e,shadowMatrices:t}){const i=[],n=e.pixelUnprojectionMatrix,r=e.isGeospatial?void 0:1,s=[[0,0,r],[e.width,0,r],[0,e.height,r],[e.width,e.height,r],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(o=>ZJ(o,n));for(const o of t){const c=o.clone().translate(new fe(e.center).negate()),h=s.map(_=>c.transform(_)),A=new yn().ortho({left:Math.min(...h.map(_=>_[0])),right:Math.max(...h.map(_=>_[0])),bottom:Math.min(...h.map(_=>_[1])),top:Math.max(...h.map(_=>_[1])),near:Math.min(...h.map(_=>-_[2])),far:Math.max(...h.map(_=>-_[2]))});i.push(A.multiplyRight(o))}return i}function tX(e){const{shadowEnabled:t=!0,project:i}=e;if(!t||!i||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};const n=B0.getUniforms(i),r=XJ({viewport:i.viewport,center:n.center}),s=[],o=QJ({shadowMatrices:e.shadowMatrices,viewport:i.viewport}).slice();for(let h=0;h<e.shadowMatrices.length;h++){const A=o[h],_=A.clone().translate(new fe(i.viewport.center).negate());n.coordinateSystem===$i.LNGLAT&&n.projectionMode===la.WEB_MERCATOR?(o[h]=_,s[h]=r):(o[h]=A.clone().multiplyRight(qJ),s[h]=_.transform(r))}const c={drawShadowMap:!!e.drawToShadowMap,useShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,color:e.shadowColor||KJ,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let h=0;h<o.length;h++)c[`viewProjectionMatrix${h}`]=o[h],c[`projectCenter${h}`]=s[h];for(let h=0;h<2;h++)c[`shadow_uShadowMap${h}`]=e.shadowMaps&&e.shadowMaps[h]||e.dummyShadowMap;return c}const cM={name:"shadow",dependencies:[B0],vs:HJ,fs:JJ,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:tX,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},ua={...vI,defaultUniforms:{...vI.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},eX=[SI],iX=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],nX=[];function rX(e){const t=If.getDefaultShaderAssembler();for(const n of eX)t.addDefaultModule(n);const i=e==="glsl"?iX:nX;for(const n of i)t.addShaderHook(n);return t}const oX=[255,255,255],sX=1;let aX=0;class cX{constructor(t={}){this.type="ambient";const{color:i=oX}=t,{intensity:n=sX}=t;this.id=t.id||`ambient-${aX++}`,this.color=i,this.intensity=n}}const lX=[255,255,255],uX=1,hX=[0,0,-1];let fX=0;class lM{constructor(t={}){this.type="directional";const{color:i=lX}=t,{intensity:n=uX}=t,{direction:r=hX}=t,{_shadow:s=!1}=t;this.id=t.id||`directional-${fX++}`,this.color=i,this.intensity=n,this.type="directional",this.direction=new fe(r).normalize().toArray(),this.shadow=s}getProjectedLight(t){return this}}class uM{constructor(t,i={id:"pass"}){const{id:n}=i;this.id=n,this.device=t,this.props={...i}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}}class S0 extends uM{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){const[i,n]=this.device.canvasContext.getDrawingBufferSize(),r=t.clearCanvas??!0,s=t.clearColor??(r?[0,0,0,0]:!1),o=r?1:!1,c=r?0:!1,h=t.colorMask??15,A={viewport:[0,0,i,n]};t.colorMask&&(A.colorMask=h),t.scissorRect&&(A.scissorRect=t.scissorRect);const _=this.device.beginRenderPass({framebuffer:t.target,parameters:A,clearColor:s,clearDepth:o,clearStencil:c});try{return this._drawLayers(_,t)}finally{_.end(),this.device.submit()}}_drawLayers(t,i){const{target:n,shaderModuleProps:r,viewports:s,views:o,onViewportActive:c,clearStack:h=!0}=i;i.pass=i.pass||"unknown",h&&(this._lastRenderIndex=-1);const A=[];for(const _ of s){const C=o&&o[_.id];c?.(_);const S=this._getDrawLayerParams(_,i),L=_.subViewports||[_];for(const N of L){const U=this._drawLayersInViewport(t,{target:n,shaderModuleProps:r,viewport:N,view:C,pass:i.pass,layers:i.layers},S);A.push(U)}}return A}_getDrawLayerParams(t,{layers:i,pass:n,isPicking:r=!1,layerFilter:s,cullRect:o,effects:c,shaderModuleProps:h},A=!1){const _=[],C=hM(this._lastRenderIndex+1),S={layer:i[0],viewport:t,isPicking:r,renderPass:n,cullRect:o},L={};for(let N=0;N<i.length;N++){const U=i[N],H=this._shouldDrawLayer(U,S,s,L),j={shouldDrawLayer:H};H&&!A&&(j.shouldDrawLayer=!0,j.layerRenderIndex=C(U,H),j.shaderModuleProps=this._getShaderModuleProps(U,c,n,h),j.layerParameters={...U.context.deck?.props.parameters,...this.getLayerParameters(U,N,t)}),_[N]=j}return _}_drawLayersInViewport(t,{layers:i,shaderModuleProps:n,pass:r,target:s,viewport:o,view:c},h){const A=dX(this.device,{shaderModuleProps:n,target:s,viewport:o});if(c&&c.props.clear){const C=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:A,scissorRect:A},clearColor:C.color?[0,0,0,0]:!1,clearDepth:C.depth?1:!1}).end()}const _={totalCount:i.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:A});for(let C=0;C<i.length;C++){const S=i[C],L=h[C],{shouldDrawLayer:N}=L;if(N&&S.props.pickable&&_.pickableCount++,S.isComposite&&_.compositeCount++,S.isDrawable&&L.shouldDrawLayer){const{layerRenderIndex:U,shaderModuleProps:H,layerParameters:j}=L;_.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,U),H.project&&(H.project.viewport=o),S.context.renderPass=t;try{S._drawLayer({renderPass:t,shaderModuleProps:H,uniforms:{layerIndex:U},parameters:j})}catch(tt){S.raiseError(tt,`drawing ${S} to ${r}`)}}}return _}shouldDrawLayer(t){return!0}getShaderModuleProps(t,i,n){return null}getLayerParameters(t,i,n){return t.props.parameters}_shouldDrawLayer(t,i,n,r){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;i.layer=t;let s=t.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(i))return!1;i.layer=s,s=s.parent}if(n){const o=i.layer.id;if(o in r||(r[o]=n(i)),!r[o])return!1}return t.activateViewport(i.viewport),!0}_getShaderModuleProps(t,i,n,r){const s=this.device.canvasContext.cssToDeviceRatio(),o=t.internalState?.propsInTransition||t.props,c={layer:o,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(i)for(const h of i)fM(c,h.getShaderModuleProps?.(t,c));return fM(c,this.getShaderModuleProps(t,i,c),r)}}function hM(e=0,t={}){const i={},n=(r,s)=>{const o=r.props._offset,c=r.id,h=r.parent&&r.parent.id;let A;if(h&&!(h in t)&&n(r.parent,!1),h in i){const _=i[h]=i[h]||hM(t[h],t);A=_(r,s),i[c]=_}else Number.isFinite(o)?(A=o+(t[h]||0),i[c]=null):A=e;return s&&A>=e&&(e=A+1),t[c]=A,A};return n}function dX(e,{shaderModuleProps:t,target:i,viewport:n}){const r=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,s]=e.canvasContext.getDrawingBufferSize(),o=i?i.height:s,c=n;return[c.x*r,o-(c.y+c.height)*r,c.width*r,c.height*r]}function fM(e,...t){for(const i of t)if(i)for(const n in i)e[n]?Object.assign(e[n],i[n]):e[n]=i[n];return e}class pX extends S0{constructor(t,i){super(t,i);const n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),r=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){const i=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),r=t.viewports[0],s=r.width*n,o=r.height*n,c=[1,1,1,1];(s!==i.width||o!==i.height)&&i.resize({width:s,height:o}),super.render({...t,clearColor:c,target:i,pass:"shadow"})}getLayerParameters(t,i,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,i,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}}const AX={color:[255,255,255],intensity:1},dM=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],gX=[0,0,0,200/255];class pM{constructor(t={}){this.id="lighting-effect",this.shadowColor=gX,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;const{device:i,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(i),n._addDefaultShaderModule(cM),this.dummyShadowMap=i.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const i in t){const n=t[i];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(i=>i.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:i,viewports:n,onViewportActive:r,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:t,layerFilter:i,viewports:n,onViewportActive:r,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,i){const n=this.shadow?{project:i.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:t})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:t}))},s=t.props.material;return{shadow:n,lighting:r,phongMaterial:s,gouraudMaterial:s}}cleanup(t){for(const i of this.shadowPasses)i.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(cM))}_calculateMatrices(){const t=[];for(const i of this.directionalLights){const n=new yn().lookAt({eye:new fe(i.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let i=0;i<this.directionalLights.length;i++){const n=new pX(t);this.shadowPasses[i]=n}}_applyDefaultLights(){const{ambientLight:t,pointLights:i,directionalLights:n}=this;!t&&i.length===0&&n.length===0&&(this.ambientLight=new cX(AX),this.directionalLights.push(new lM(dM[0]),new lM(dM[1])))}}class mX{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,i,{size:n=1,type:r,padding:s=0,copy:o=!1,initialize:c=!1,maxCount:h}){const A=r||t&&t.constructor||Float32Array,_=i*n+s;if(ArrayBuffer.isView(t)){if(_<=t.length)return t;if(_*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new A(t.buffer,0,_)}let C=1/0;h&&(C=h*n+s);const S=this._allocate(A,_,c,C);return t&&o?S.set(t):c||S.fill(0,0,4),this._release(t),S}release(t){this._release(t)}_allocate(t,i,n,r){let s=Math.max(Math.ceil(i*this.opts.overAlloc),1);s>r&&(s=r);const o=this._pool,c=t.BYTES_PER_ELEMENT*s,h=o.findIndex(A=>A.byteLength>=c);if(h>=0){const A=new t(o.splice(h,1)[0],0,s);return n&&A.fill(0),A}return new t(s)}_release(t){if(!ArrayBuffer.isView(t))return;const i=this._pool,{buffer:n}=t,{byteLength:r}=n,s=i.findIndex(o=>o.byteLength>=r);s<0?i.push(n):(s>0||i.length<this.opts.poolSize)&&i.splice(s,0,n),i.length>this.opts.poolSize&&i.shift()}}const kd=new mX;function $A(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function yX(e){return[e[12],e[13],e[14]]}function vX(e){return{left:Nd(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Nd(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Nd(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Nd(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Nd(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Nd(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}const AM=new fe;function Nd(e,t,i,n){AM.set(e,t,i);const r=AM.len();return{distance:n/r,normal:new fe(-e/r,-t/r,-i/r)}}function _X(e){return e-Math.fround(e)}let tg;function Ab(e,t){const{size:i=1,startIndex:n=0}=t,r=t.endIndex!==void 0?t.endIndex:e.length,s=(r-n)/i;tg=kd.allocate(tg,s,{type:Float32Array,size:i*2});let o=n,c=0;for(;o<r;){for(let h=0;h<i;h++){const A=e[o++];tg[c+h]=A,tg[c+h+i]=_X(A)}c+=i*2}return tg.subarray(0,s*i*2)}function bX(e){let t=null,i=!1;for(const n of e)n&&(t?(i||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],i=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}const xX=Math.PI/180,wX=$A(),gM=[0,0,0],CX={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function EX({width:e,height:t,orthographic:i,fovyRadians:n,focalDistance:r,padding:s,near:o,far:c}){const h=e/t,A=i?new yn().orthographic({fovy:n,aspect:h,focalDistance:r,near:o,far:c}):new yn().perspective({fovy:n,aspect:h,near:o,far:c});if(s){const{left:_=0,right:C=0,top:S=0,bottom:L=0}=s,N=Wl((_+e-C)/2,0,e)-e/2,U=Wl((S+t-L)/2,0,t)-t/2;A[8]-=N*2/e,A[9]+=U*2/t}return A}class au{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||CX,this.focalDistance=t.focalDistance||1,this.position=t.position||gM,this.modelMatrix=t.modelMatrix||null;const{longitude:i,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(i),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?la.WEB_MERCATOR:la.WEB_MERCATOR_AUTO_OFFSET:la.IDENTITY}equals(t){return t instanceof au?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&ca(t.projectionMatrix,this.projectionMatrix)&&ca(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:i=!0}={}){const n=this.projectPosition(t),r=nM(n,this.pixelProjectionMatrix),[s,o]=r,c=i?o:this.height-o;return t.length===2?[s,c]:[s,c,r[2]]}unproject(t,{topLeft:i=!0,targetZ:n}={}){const[r,s,o]=t,c=i?s:this.height-s,h=n&&n*this.distanceScales.unitsPerMeter[2],A=pb([r,c,o],this.pixelUnprojectionMatrix,h),[_,C,S]=this.unprojectPosition(A);return Number.isFinite(o)?[_,C,S]:Number.isFinite(n)?[_,C,n]:[_,C]}projectPosition(t){const[i,n]=this.projectFlat(t),r=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[i,n,r]}unprojectPosition(t){const[i,n]=this.unprojectFlat(t),r=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[i,n,r]}projectFlat(t){if(this.isGeospatial){const i=Xl(t);return i[1]=Wl(i[1],-318,830),i}return t}unprojectFlat(t){return this.isGeospatial?rl(t):t}getBounds(t={}){const i={targetZ:t.z||0},n=this.unproject([0,0],i),r=this.unproject([this.width,0],i),s=this.unproject([0,this.height],i),o=this.unproject([this.width,this.height],i);return[Math.min(n[0],r[0],s[0],o[0]),Math.min(n[1],r[1],s[1],o[1]),Math.max(n[0],r[0],s[0],o[0]),Math.max(n[1],r[1],s[1],o[1])]}getDistanceScales(t){return t&&this.isGeospatial?fb({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:i,width:n=1,height:r=1}){return t<this.x+this.width&&this.x<t+n&&i<this.y+this.height&&this.y<i+r}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,vX(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,i){return null}_initProps(t){const i=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=FJ({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||fb({latitude:n,longitude:i}));const r=Math.pow(2,this.zoom);this.scale=r;const{position:s,modelMatrix:o}=t;let c=gM;if(s&&(c=o?new yn(o).transformAsVector(s,[]):s),this.isGeospatial){const h=this.projectPosition([i,n,0]);this.center=new fe(c).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(c)}_initMatrices(t){const{viewMatrix:i=wX,projectionMatrix:n=null,orthographic:r=!1,fovyRadians:s,fovy:o=75,near:c=.1,far:h=1e3,padding:A=null,focalDistance:_=1}=t;this.viewMatrixUncentered=i,this.viewMatrix=new yn().multiplyRight(i).translate(new fe(this.center).negate()),this.projectionMatrix=n||EX({width:this.width,height:this.height,orthographic:r,fovyRadians:s||o*xX,focalDistance:_,padding:A,near:c,far:h});const C=$A();Jh(C,C,this.projectionMatrix),Jh(C,C,this.viewMatrix),this.viewProjectionMatrix=C,this.viewMatrixInverse=J1([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=yX(this.viewMatrixInverse);const S=$A(),L=$A();X1(S,S,[this.width/2,-this.height/2,1]),y0(S,S,[1,-1,0]),Jh(L,S,this.viewProjectionMatrix),this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=J1($A(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Zi.warn("Pixel project matrix not invertible")()}}au.displayName="Viewport";let eg=class EE extends au{constructor(t={}){const{latitude:i=0,longitude:n=0,zoom:r=0,pitch:s=0,bearing:o=0,nearZMultiplier:c=.1,farZMultiplier:h=1.01,nearZ:A,farZ:_,orthographic:C=!1,projectionMatrix:S,repeat:L=!1,worldOffset:N=0,position:U,padding:H,legacyMeterSizes:j=!1}=t;let{width:tt,height:K,altitude:Q=1.5}=t;const pt=Math.pow(2,r);tt=tt||1,K=K||1;let $,zt=null;if(S)Q=S[5]/2,$=YA(Q);else{t.fovy?($=t.fovy,Q=db($)):$=YA(Q);let dt;if(H){const{top:lt=0,bottom:Lt=0}=H;dt=[0,Wl((lt+K-Lt)/2,0,K)-K/2]}zt=NJ({width:tt,height:K,scale:pt,center:U&&[0,0,U[2]*hb(i)],offset:dt,pitch:s,fovy:$,nearZMultiplier:c,farZMultiplier:h}),Number.isFinite(A)&&(zt.near=A),Number.isFinite(_)&&(zt.far=_)}let Gt=kJ({height:K,pitch:s,bearing:o,scale:pt,altitude:Q});N&&(Gt=new yn().translate([512*N,0,0]).multiplyLeft(Gt)),super({...t,width:tt,height:K,viewMatrix:Gt,longitude:n,latitude:i,zoom:r,...zt,fovy:$,focalDistance:Q}),this.latitude=i,this.longitude=n,this.zoom=r,this.pitch=s,this.bearing=o,this.altitude=Q,this.fovy=$,this.orthographic=C,this._subViewports=L?[]:null,this._pseudoMeters=j,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const t=this.getBounds(),i=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let r=i;r<=n;r++){const s=r?new EE({...this,worldOffset:r}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);const[i,n]=this.projectFlat(t),r=(t[2]||0)*hb(t[1]);return[i,n,r]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);const[i,n]=this.unprojectFlat(t),r=(t[2]||0)/hb(n);return[i,n,r]}addMetersToLngLat(t,i){return iM(t,i)}panByPosition(t,i){const n=pb(i,this.pixelUnprojectionMatrix),r=this.projectFlat(t),s=JS([],r,OV([],n)),o=JS([],this.center,s),[c,h]=this.unprojectFlat(o);return{longitude:c,latitude:h}}getBounds(t={}){const i=GJ(this,t.z||0);return[Math.min(i[0][0],i[1][0],i[2][0],i[3][0]),Math.min(i[0][1],i[1][1],i[2][1],i[3][1]),Math.max(i[0][0],i[1][0],i[2][0],i[3][0]),Math.max(i[0][1],i[1][1],i[2][1],i[3][1])]}fitBounds(t,i={}){const{width:n,height:r}=this,{longitude:s,latitude:o,zoom:c}=UJ({width:n,height:r,bounds:t,...i});return new EE({width:n,height:r,longitude:s,latitude:o,zoom:c})}};eg.displayName="WebMercatorViewport";const mM=[0,0,0];function gb(e,t,i=!1){const n=t.projectPosition(e);if(i&&t instanceof eg){const[r,s,o=0]=e,c=t.getDistanceScales([r,s]);n[2]=o*c.unitsPerMeter[2]}return n}function BX(e){const{viewport:t,modelMatrix:i,coordinateOrigin:n}=e;let{coordinateSystem:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}=e;return r===$i.DEFAULT&&(r=t.isGeospatial?$i.LNGLAT:$i.CARTESIAN),s===void 0&&(s=r),o===void 0&&(o=n),{viewport:t,coordinateSystem:r,coordinateOrigin:n,modelMatrix:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function yM(e,{viewport:t,modelMatrix:i,coordinateSystem:n,coordinateOrigin:r,offsetMode:s}){let[o,c,h=0]=e;switch(i&&([o,c,h]=Rd([],[o,c,h,1],i)),n){case $i.LNGLAT:return gb([o,c,h],t,s);case $i.LNGLAT_OFFSETS:return gb([o+r[0],c+r[1],h+(r[2]||0)],t,s);case $i.METER_OFFSETS:return gb(iM(r,[o,c,h]),t,s);case $i.CARTESIAN:default:return t.isGeospatial?[o+r[0],c+r[1],h+r[2]]:t.projectPosition([o,c,h])}}function TX(e,t){const{viewport:i,coordinateSystem:n,coordinateOrigin:r,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:c}=BX(t),{autoOffset:h=!0}=t,{geospatialOrigin:A=mM,shaderCoordinateOrigin:_=mM,offsetMode:C=!1}=h?$I(i,n,r):{},S=yM(e,{viewport:i,modelMatrix:s,coordinateSystem:o,coordinateOrigin:c,offsetMode:C});if(C){const L=i.projectPosition(A||_);rI(S,S,L)}return S}let SX=1,IX=1;class vM{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){const{delay:i=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:s=1}=t,o=SX++,c={time:0,delay:i,duration:n,rate:r,repeat:s};return this._setChannelTime(c,this.time),this.channels.set(o,c),o}removeChannel(t){this.channels.delete(t);for(const[i,n]of this.animations)n.channel===t&&this.detachAnimation(i)}isFinished(t){const i=this.channels.get(t);return i===void 0?!1:this.time>=i.delay+i.duration*i.repeat}getTime(t){if(t===void 0)return this.time;const i=this.channels.get(t);return i===void 0?-1:i.time}setTime(t){this.time=Math.max(0,t);const i=this.channels.values();for(const r of i)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:s,channel:o}=r;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,i){const n=IX++;return this.animations.set(n,{animation:t,channel:i}),t.setTime(this.getTime(i)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,i){const n=i-t.delay,r=t.duration*t.repeat;n>=r?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}}function MX(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function PX(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}function _M(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let bM=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=_M(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(_M()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},RX=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof bM?n=e:n=new bM(t,i),this.stats[t]=n),n}},DX=0;const OX={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:E1.stats.get(`animation-loop-${DX++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class LX{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...OX,...t},t=this.props,!t.device)throw new Error("No device provided");const{useDevicePixels:i=!0}=this.props;this.stats=t.stats||new RX({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:i}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(t){if(this.props.onError(t),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=t.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){const i=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(i),i}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=MX(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(PX(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const t=this.device?.canvasContext?.canvas;if(!this.device||!t)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:t,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:t,height:i,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||i!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=i,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";const i=document.createElement("div");i.style.position="absolute",i.style.left="10px",i.style.bottom="10px",i.style.width="300px",i.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(i);const n=this.props.onAddHTML(i);n&&(i.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[t,i]=this.device?.canvasContext?.getPixelSize()||[1,1];let n=1;const r=this.device?.canvasContext?.canvas;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:t>0&&i>0&&(n=t/i),{width:t,height:i,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}}const mb={};function Xh(e="id"){mb[e]=mb[e]||1;const t=mb[e]++;return`${e}-${t}`}class xM{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||Xh("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&Cr.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}}function FX(e,t){if(t instanceof xM)return t;const i=kX(e,t),{attributes:n,bufferLayout:r}=NX(e,t);return new xM({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:i,attributes:n})}function kX(e,t){if(!t.indices)return;const i=t.indices.value;return e.createBuffer({usage:Cr.INDEX,data:i})}function NX(e,t){const i=[],n={};for(const[s,o]of Object.entries(t.attributes)){let c=s;switch(s){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(o){n[c]=e.createBuffer({data:o.value,id:`${s}-buffer`});const{value:h,size:A,normalized:_}=o;i.push({name:c,format:Wj(h,A,_)})}}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:i,vertexCount:r}}class FE{static defaultProps={...iA.defaultProps};static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new FE(t),t._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(t){this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}createRenderPipeline(t){const i={...iA.defaultProps,...t},n=this._hashRenderPipeline(i);if(!this._renderPipelineCache[n]){const r=this.device.createRenderPipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._renderPipelineCache[n]={pipeline:r,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(t){const i={...a_.defaultProps,...t},n=this._hashComputePipeline(i);if(!this._computePipelineCache[n]){const r=this.device.createComputePipeline({...i,id:i.id?`${i.id}-cached`:void 0});r.hash=n,this._computePipelineCache[n]={pipeline:r,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(t){const i=t.hash,n=t instanceof a_?this._computePipelineCache:this._renderPipelineCache;n[i].useCount--,n[i].useCount===0&&this.destroyPolicy==="unused"&&(n[i].pipeline.destroy(),delete n[i])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){const i=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,r="-",s=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${i}/${n}V${r}BL${s}`;default:const o=this._getHash(JSON.stringify(t.parameters));return`${i}/${n}V${r}T${t.topology}P${o}BL${s}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}}class kE{static defaultProps={...o_.defaultProps};static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new kE(t),t._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(t){this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}createShader(t){const i=this._hashShader(t);let n=this._cache[i];if(!n){const r=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[i]=n={shader:r,useCount:0}}return n.useCount++,n.shader}release(t){const i=this._hashShader(t),n=this._cache[i];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[i],n.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}}function UX(e,t){const i={},n="Values";if(e.attributes.length===0&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(const r of e.attributes)if(r){const s=`${r.location} ${r.name}: ${r.type}`;i[`in ${s}`]={[n]:r.stepMode||"vertex"}}for(const r of e.varyings||[]){const s=`${r.location} ${r.name}`;i[`out ${s}`]={[n]:JSON.stringify(r)}}return i}let ko=null,yb=null;function zX(e,{id:t,minimap:i,opaque:n,top:r="0",left:s="0",rgbaScale:o=1}){ko||(ko=document.createElement("canvas"),ko.id=t,ko.title=t,ko.style.zIndex="100",ko.style.position="absolute",ko.style.top=r,ko.style.left=s,ko.style.border="blue 5px solid",ko.style.transform="scaleY(-1)",document.body.appendChild(ko),yb=ko.getContext("2d")),(ko.width!==e.width||ko.height!==e.height)&&(ko.width=e.width/2,ko.height=e.height/2,ko.style.width="400px",ko.style.height="400px");const c=e.device.readPixelsToArrayWebGL(e),h=yb?.createImageData(e.width,e.height);if(h){for(let A=0;A<c.length;A+=4)h.data[0+A+0]=c[A+0]*o,h.data[0+A+1]=c[A+1]*o,h.data[0+A+2]=c[A+2]*o,h.data[0+A+3]=n?255:c[A+3]*o;yb?.putImageData(h,0,0)}}function vb(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!vb(e[n],t[n],i-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!vb(e[s],t[s],i-1))return!1;return!0}return!1}function GX(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function jX(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function wM(e){return GX(e)||jX(e)}function VX(e){return wM(e)||typeof e=="number"||typeof e=="boolean"}function CM(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(i=>{const n=e[i];VX(n)?t.uniforms[i]=n:t.bindings[i]=n}),t}class HX{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,i){Object.assign(this.options,i);const n=g1(Object.values(t).filter(r=>r.dependencies));for(const r of n)t[r.name]=r;$e.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(const[r,s]of Object.entries(t))this._addModule(s),s.name&&r!==s.name&&!this.options.disableWarnings&&$e.warn(`Module name: ${r} vs ${s.name}`)()}destroy(){}setProps(t){for(const i of Object.keys(t)){const n=i,r=t[n]||{},s=this.modules[n];if(!s){this.options.disableWarnings||$e.warn(`Module ${i} not found`)();continue}const o=this.moduleUniforms[n],c=this.moduleBindings[n],h=s.getUniforms?.(r,o)||r,{uniforms:A,bindings:_}=CM(h);this.moduleUniforms[n]={...o,...A},this.moduleBindings[n]={...c,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const t={};for(const i of Object.values(this.moduleBindings))Object.assign(t,i);return t}getDebugTable(){const t={};for(const[i,n]of Object.entries(this.moduleUniforms))for(const[r,s]of Object.entries(n))t[`${i}.${r}`]={type:this.modules[i].uniformTypes?.[r],value:String(s)};return t}_addModule(t){const i=t.name;this.moduleUniforms[i]=t.defaultUniforms||{},this.moduleBindings[i]={}}}let WX="";async function JX(e,t){const i=new Image;return i.crossOrigin="anonymous",i.src=e.startsWith("http")?e:WX+e,await i.decode(),t?await createImageBitmap(i,t):await createImageBitmap(i)}class _b{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,i){this.device=t,this.id=i.id||Xh("async-texture"),typeof i?.data=="string"&&i.dimension==="2d"&&(i={...i,data:JX(i.data)}),this.ready=new Promise((n,r)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=r}),this.initAsync(i)}async initAsync(t){const i=t.data;let n;try{n=await EM(i)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const r={...t,data:n};this.texture=this.device.createTexture(r),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){const i=this.texture;this.texture=i.clone(t),i.destroy()}return!0}}async function EM(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(EM));if(e&&typeof e=="object"&&e.constructor===Object){const t=e,i=await Promise.all(Object.values(t)),n=Object.keys(t),r={};for(let s=0;s<n.length;s++)r[n[s]]=i[s];return r}return e}const Qh=2,XX=1e4;class Lr{static defaultProps={...iA.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:If.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,i){this.props={...Lr.defaultProps,...i},i=this.props,this.id=i.id||Xh("model"),this.device=t,Object.assign(this.userData,i.userData);const n=Object.fromEntries(this.props.modules?.map(c=>[c.name,c])||[]),r=i.shaderInputs||new HX(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const s=KX(t),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:c,getUniforms:h}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=c,this._getModuleUniforms=h,this.props.shaderLayout||=bV(this.source)}else{const{vs:c,fs:h,getUniforms:A}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=c,this.fs=h,this._getModuleUniforms=A}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,i.geometry&&this.setGeometry(i.geometry),this.pipelineFactory=i.pipelineFactory||FE.getDefaultPipelineFactory(this.device),this.shaderFactory=i.shaderFactory||kE.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in i&&(this.isInstanced=i.isInstanced),i.instanceCount&&this.setInstanceCount(i.instanceCount),i.vertexCount&&this.setVertexCount(i.vertexCount),i.indexBuffer&&this.setIndexBuffer(i.indexBuffer),i.attributes&&this.setAttributes(i.attributes),i.constantAttributes&&this.setConstantAttributes(i.constantAttributes),i.bindings&&this.setBindings(i.bindings),i.uniforms&&this.setUniformsWebGL(i.uniforms),i.moduleSettings&&this.updateModuleSettingsWebGL(i.moduleSettings),i.transformFeedback&&(this.transformFeedback=i.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){const i=this._areBindingsLoading();if(i)return $e.info(Qh,`>>> DRAWING ABORTED ${this.id}: ${i} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),bb(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){this._gpuGeometry?.destroy();const i=t&&FX(this.device,t);if(i){this.setTopology(i.topology||"triangle-list");const n=new B1(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(i.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(i)}this._gpuGeometry=i}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){const i=new B1(this.bufferLayout);this.bufferLayout=this._gpuGeometry?i.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){vb(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new Hj(this.shaderInputs.modules);for(const[i,n]of Object.entries(this.shaderInputs.modules))if(QX(n)){const r=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,i){const n=i?.disableWarnings??this.props.disableWarnings;t.indices&&$e.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=Jj(this.pipeline.shaderLayout,this.bufferLayout);const r=new B1(this.bufferLayout);for(const[s,o]of Object.entries(t)){const c=r.getBufferLayout(s);if(!c){n||$e.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const h=r.getAttributeNamesForBuffer(c);let A=!1;for(const _ of h){const C=this._attributeInfos[_];if(C){const S=this.device.type==="webgpu"?r.getBufferIndex(C.bufferName):C.location;this.vertexArray.setBuffer(S,o),A=!0}}!A&&!n&&$e.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,i){for(const[n,r]of Object.entries(t)){const s=this._attributeInfos[n];s?this.vertexArray.setConstantWebGL(s.location,r):(i?.disableWarnings??this.props.disableWarnings)||$e.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){this.setUniformsWebGL(t)}setUniformsWebGL(t){bb(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(t){const{bindings:i,uniforms:n}=CM(this._getModuleUniforms(t));Object.assign(this.bindings,i),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const t of Object.values(this.bindings))if(t instanceof _b&&!t.isReady)return t.id;return!1}_getBindings(){const t={};for(const[i,n]of Object.entries(this.bindings))n instanceof _b?n.isReady&&(t[i]=n.texture):t[i]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(const i of Object.values(this.bindings))i instanceof r_?t=Math.max(t,i.texture.updateTimestamp):i instanceof Cr||i instanceof cr?t=Math.max(t,i.updateTimestamp):i instanceof _b?t=i.texture?Math.max(t,i.texture.updateTimestamp):1/0:i instanceof om||(t=Math.max(t,i.buffer.updateTimestamp));return t}_setGeometryAttributes(t){const i={...t.attributes};for(const[n]of Object.entries(i))!this.pipeline.shaderLayout.attributes.find(r=>r.name===n)&&n!=="positions"&&delete i[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(i,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,i=null;this.pipeline&&($e.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,i=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let r=null;this.source?r=n:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:r}),this._attributeInfos=hS(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),i&&this.shaderFactory.release(i)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const t=$e.level>3?0:XX;$e.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,$e.group(Qh,`>>> DRAWING MODEL ${this.id}`,{collapsed:$e.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const t=UX(this.pipeline.shaderLayout,this.id);$e.table(Qh,t)();const i=this.shaderInputs.getDebugTable();for(const[r,s]of Object.entries(this.uniforms))i[r]={value:s};$e.table(Qh,i)();const n=this._getAttributeDebugTable();$e.table(Qh,this._attributeInfos)(),$e.table(Qh,n)(),$e.groupEnd(Qh)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){const i=this.device.props.debugFramebuffers;if(this._drawCount++,!i)return;const n=t.props.framebuffer;n&&zX(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const t={};for(const[i,n]of Object.entries(this._attributeInfos)){const r=this.vertexArray.attributes[n.location];t[n.location]={name:i,type:n.shaderType,values:r?this._getBufferOrConstantValues(r,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:i}=this.vertexArray,n=i.indexType==="uint32"?new Uint32Array(i.debugData):new Uint16Array(i.debugData);t.indices={name:"indices",type:i.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,i){const n=AS(i);return(t instanceof Cr?new n(t.debugData):t).toString()}}function QX(e){return!!(e.uniformTypes&&!bb(e.uniformTypes))}function KX(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function bb(e){for(const t in e)return!1;return!0}class Mf{device;model;transformFeedback;static defaultProps={...Lr.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(t){return t?.info?.type==="webgl"}constructor(t,i=Mf.defaultProps){if(!Mf.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Lr(this.device,{id:i.id||"buffer-transform-model",fs:i.fs||VT(),topology:i.topology||"point-list",varyings:i.outputs||i.varyings,...i}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:i.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);const i=this.device.beginRenderPass(t);this.model.draw(i),i.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){const i=this.getBuffer(t);if(!i)throw new Error("BufferTransform#getBuffer");if(i instanceof Cr)return i.readAsync();const{buffer:n,byteOffset:r=0,byteLength:s=n.byteLength}=i;return n.readAsync(r,s)}}const qX="transform_output";class BM{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(t,i){this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Lr(this.device,{id:i.id||"texture-transform-model",fs:i.fs||VT({input:i.targetTextureVarying,inputChannels:i.targetTextureChannels,output:qX}),vertexCount:i.vertexCount,...i}),this._initialize(i),Object.seal(this)}destroy(){this.model.destroy();for(const t of this.bindings)t.framebuffer?.destroy()}delete(){this.destroy()}run(t){const{framebuffer:i}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:i,...t});this.model.draw(n),n.end()}getTargetTexture(){const{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:i,sourceTextures:n,targetTexture:r}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,i),r){t.targetTexture=r;const{width:s,height:o}=r;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:s,height:o,colorAttachments:[r]}),t.framebuffer.resize({width:s,height:o})}return t}_setSourceTextureParameters(){const t=this.currentIndex,{sourceTextures:i}=this.bindings[t];for(const n in i)i[n].sampler=this.sampler}}class Yo{id;topology;vertexCount;indices;attributes;userData={};constructor(t){const{attributes:i={},indices:n=null,vertexCount:r=null}=t;this.id=t.id||Xh("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[s,o]of Object.entries(i)){const c=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!c.size&&(c.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[s]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,i){return this}_calculateVertexCount(t,i){if(i)return i.value.length;let n=1/0;for(const r of Object.values(t)){const{value:s,size:o,constant:c}=r;!c&&s&&o!==void 0&&o>=1&&(n=Math.min(n,s.length/o))}return n}}const ZX=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,YX=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,TM=[-1,-1,1,-1,-1,1,1,1];class $X extends Lr{constructor(t,i){const n=TM.map(r=>r===-1?0:r);i.source&&(i={...i,source:`${ZX}
${i.source}`}),super(t,{id:i.id||Xh("clip-space"),...i,vs:YX,vertexCount:4,geometry:new Yo({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(TM)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}}class I0{id;matrix=new yn;display=!0;position=new fe;rotation=new fe;scale=new fe(1,1,1);userData={};props={};constructor(t={}){const{id:i}=t;this.id=i||Xh(this.constructor.name),this._setScenegraphNodeProps(t)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(t){return this.position=t,this}setRotation(t){return this.rotation=t,this}setScale(t){return this.scale=t,this}setMatrix(t,i=!0){i?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){const{position:i,rotation:n,scale:r,update:s=!0}=t;return i&&this.setPosition(i),n&&this.setRotation(n),r&&this.setScale(r),s&&this.updateMatrix(),this}updateMatrix(){const t=this.position,i=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(i),this.matrix.scale(n),this}update(t={}){const{position:i,rotation:n,scale:r}=t;return i&&this.setPosition(i),n&&this.setRotation(n),r&&this.setScale(r),this.updateMatrix(),this}getCoordinateUniforms(t,i){i=i||this.matrix;const n=new yn(t).multiplyRight(i),r=n.invert(),s=r.transpose();return{viewMatrix:t,modelMatrix:i,objectMatrix:i,worldMatrix:n,worldInverseMatrix:r,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(t){"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}}class nA extends I0{children;constructor(t={}){t=Array.isArray(t)?{children:t}:t;const{children:i=[]}=t;$e.assert(i.every(n=>n instanceof I0),"every child must an instance of ScenegraphNode"),super(t),this.children=i}getBounds(){const t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((i,{worldMatrix:n})=>{const r=i.getBounds();if(!r)return;const[s,o]=r,c=new fe(s).add(o).divide([2,2,2]);n.transformAsPoint(c,c);const h=new fe(o).subtract(s).divide([2,2,2]);n.transformAsVector(h,h);for(let A=0;A<8;A++){const _=new fe(A&1?-1:1,A&2?-1:1,A&4?-1:1).multiply(h).add(c);for(let C=0;C<3;C++)t[0][C]=Math.min(t[0][C],_[C]),t[1][C]=Math.max(t[1][C],_[C])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(const i of t)Array.isArray(i)?this.add(...i):this.children.push(i);return this}remove(t){const i=this.children,n=i.indexOf(t);return n>-1&&i.splice(n,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:i=new yn}={}){const n=new yn(i).multiplyRight(this.matrix);for(const r of this.children)r instanceof nA?r.traverse(t,{worldMatrix:n}):t(r,{worldMatrix:n})}}class xb extends I0{model;bounds=null;managedResources;constructor(t){super(t),this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}}class SM extends Yo{constructor(t={}){const{id:i=Xh("cube-geometry"),indices:n=!0}=t;super(n?{...t,id:i,topology:"triangle-list",indices:{size:1,value:tQ},attributes:{...aQ,...t.attributes}}:{...t,id:i,topology:"triangle-list",indices:void 0,attributes:{...cQ,...t.attributes}})}}const tQ=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),eQ=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),iQ=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),nQ=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),rQ=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),oQ=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),sQ=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),aQ={POSITION:{size:3,value:eQ},NORMAL:{size:3,value:iQ},TEXCOORD_0:{size:2,value:nQ}},cQ={POSITION:{size:3,value:rQ},TEXCOORD_0:{size:2,value:oQ},COLOR_0:{size:3,value:sQ}},lQ=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,uQ={name:"screen",fs:lQ,uniformTypes:{texSize:"vec2<f32>"}};class hQ extends uM{constructor(t,i){super(t,i);const{module:n,fs:r,id:s}=i,o={depthWriteEnabled:!1,depthCompare:"always"};this.model=new $X(t,{id:s,fs:r,modules:[n,uQ],parameters:o})}render(t){this._renderPass(this.device,t)}delete(){this.model.destroy(),this.model=null}_renderPass(t,i){const{clearCanvas:n,inputBuffer:r,outputBuffer:s}=i,o=[r.width,r.height],c={texSrc:r.colorAttachments[0],texSize:o};this.model.shaderInputs.setProps({screen:c,...i.moduleProps});const h=this.device.beginRenderPass({framebuffer:s,parameters:{viewport:[0,0,...o]},clearColor:n?[0,0,0,0]:!1,clearDepth:1,clearStencil:!1});this.model.draw(h),h.end()}}class fQ{constructor(t,i){this.id=`${t.name}-pass`,this.props=i,RT(t),this.module=t}setup({device:t}){this.passes=dQ(t,this.module,this.id)}setProps(t){this.props=t}preRender(){}postRender(t){const i=this.passes,{target:n}=t;let r=t.inputBuffer,s=t.swapBuffer;for(let o=0;o<i.length;o++){const c=o===i.length-1,h=n!==void 0&&c;h&&(s=n);const A=!h||!!t.clearCanvas,_={},C=this.module.passes[o].uniforms;_[this.module.name]={...this.props,...C},i[o].render({clearCanvas:A,inputBuffer:r,outputBuffer:s,moduleProps:_});const S=s;s=r,r=S}return r}cleanup(){if(this.passes){for(const t of this.passes)t.delete();this.passes=void 0}}}function dQ(e,t,i){return t.passes.map((n,r)=>{const s=gQ(t,n),o=`${i}-${r}`;return new hQ(e,{id:o,module:t,fs:s})})}const IM=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,pQ=e=>`${IM}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${e}(fragColor, screen.texSize, coordinate);
}
`,AQ=e=>`${IM}
void main() {
  fragColor = ${e}(texSrc, screen.texSize, coordinate);
}
`;function gQ(e,t){if(t.filter){const i=typeof t.filter=="string"?t.filter:`${e.name}_filterColor_ext`;return pQ(i)}if(t.sampler){const i=typeof t.sampler=="string"?t.sampler:`${e.name}_sampleColor`;return AQ(i)}return""}const mQ={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class MM extends S0{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:i,views:n,viewports:r,onViewportActive:s,pickingFBO:o,deviceRect:{x:c,y:h,width:A,height:_},cullRect:C,effects:S,pass:L="picking",pickZ:N,shaderModuleProps:U}){this.pickZ=N;const H=this._resetColorEncoder(N),j=[c,h,A,_],tt=super.render({target:o,layers:t,layerFilter:i,views:n,viewports:r,onViewportActive:s,cullRect:C,effects:S?.filter(K=>K.useInPicking),pass:L,isPicking:!0,shaderModuleProps:U,clearColor:[0,0,0,0],colorMask:15,scissorRect:j});return this._colorEncoderState=null,{decodePickingColor:H&&vQ.bind(null,H),stats:tt}}shouldDrawLayer(t){const{pickable:i,operation:n}=t.props;return i&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,i,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,i,n){const r={...t.props.parameters},{pickable:s,operation:o}=t.props;return!this._colorEncoderState||o.includes("terrain")?r.blend=!1:s&&o.includes("draw")&&(Object.assign(r,mQ),r.blend=!0,r.blendColor=yQ(this._colorEncoderState,t,n)),r}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function yQ(e,t,i){const{byLayer:n,byAlpha:r}=e;let s,o=n.get(t);return o?(o.viewports.push(i),s=o.a):(s=n.size+1,s<=255?(o={a:s,layer:t,viewports:[i]},n.set(t,o),r[s]=o):(Zi.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function vQ(e,t){const i=e.byAlpha[t[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(t)}}const Ud={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},M0=Symbol.for("component"),Vu=Symbol.for("propTypes"),wb=Symbol.for("deprecatedProps"),zd=Symbol.for("asyncPropDefaults"),Kh=Symbol.for("asyncPropOriginal"),Hu=Symbol.for("asyncPropResolved");function P0(e,t=()=>!0){return Array.isArray(e)?PM(e,t,[]):t(e)?[e]:[]}function PM(e,t,i){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?PM(r,t,i):t(r)&&i.push(r)}return i}function _Q({target:e,source:t,start:i=0,count:n=1}){const r=t.length,s=n*r;let o=0;for(let c=i;o<r;o++)e[c++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(i+o,i,i+o),o*=2):(e.copyWithin(i+o,i,i+s-o),o=s);return e}function RM(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}let DM=class{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=RM(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(RM()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}},OM=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof DM?n=e:n=new DM(t,i),this.stats[t]=n),n}};class bQ{constructor(t,i,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(i)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,i){if(t===this._data&&!i)return;this._data=t;const n=++this._loadCount;let r=t;typeof t=="string"&&(r=s1(t)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===n&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(const s of this._subscribers)s.onChange(this.getData())}}class xQ{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:i,forceUpdate:n=!1,persistent:r=!0}){let s=this._resources[t];s?s.setData(i,n):(s=new bQ(t,i,this._context),this._resources[t]=s),s.persistent=r}remove(t){const i=this._resources[t];i&&(i.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){const i=this._consumers[t];if(i){for(const n in i){const r=i[n],s=this._resources[r.resourceId];s&&s.unsubscribe(r)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:i,consumerId:n,requestId:r="default"}){const{_resources:s,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),s[t]||this.add({resourceId:t,data:null,persistent:!1}));const c=s[t];if(this._track(n,r,c,i),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const t in this._resources)this._resources[t].delete()}_track(t,i,n,r){const s=this._consumers,o=s[t]=s[t]||{};let c=o[i];const h=c&&c.resourceId&&this._resources[c.resourceId];h&&(h.unsubscribe(c),this.prune()),n&&(c?(c.onChange=r,c.resourceId=n.id):c={onChange:r,resourceId:n.id},o[i]=c,n.subscribe(c))}_prune(){this._pruneRequest=null;for(const t of Object.keys(this._resources)){const i=this._resources[t];!i.persistent&&!i.inUse()&&(i.delete(),delete this._resources[t])}}}const wQ="layerManager.setLayers",CQ="layerManager.activateViewport";class EQ{constructor(t,i){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{fs(CQ,this,c),c&&(this.context.viewport=c)};const{deck:n,stats:r,viewport:s,timeline:o}=i||{};this.layers=[],this.resourceManager=new xQ({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:rX(t?.info?.shadingLanguage||"glsl"),defaultShaderModules:[pW],renderPass:void 0,stats:r||new OM({id:"deck.gl"}),viewport:s||new au({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new vM,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let i=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(const n of this.layers){const r=n.getNeedsRedraw(t);i=i||r}return i}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(i=>t.find(n=>i.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,i){fs(wQ,this,i,t),this._lastRenderedLayers=t;const n=P0(t,Boolean);for(const r of n)r.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){const t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){const{defaultShaderModules:i}=this.context;i.find(n=>n.name===t.name)||(i.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){const{defaultShaderModules:i}=this.context,n=i.findIndex(r=>r.name===t.name);n>=0&&(i.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,i,n){n.raiseError(i,`${t} of ${n}`)}_updateLayers(t,i){const n={};for(const o of t)n[o.id]?Zi.warn(`Multiple old layers with same id ${o.id}`)():n[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of t)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const r=[];this._updateSublayersRecursively(i,n,r),this._finalizeOldLayers(n);let s=!1;for(const o of r)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=r}_updateSublayersRecursively(t,i,n){for(const r of t){r.context=this.context;const s=i[r.id];s===null&&Zi.warn(`Multiple new layers with same id ${r.id}`)(),i[r.id]=null;let o=null;try{this._debug&&s!==r&&r.validateProps(),s?(this._transferLayerState(s,r),this._updateLayer(r)):this._initializeLayer(r),n.push(r),o=r.isComposite?r.getSubLayers():null}catch(c){this._handleError("matching",c,r)}o&&this._updateSublayersRecursively(o,i,n)}}_finalizeOldLayers(t){for(const i in t){const n=t[i];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Ud.INITIALIZED}catch(i){this._handleError("initialization",i,t)}}_transferLayerState(t,i){i._transferState(t),i.lifecycle=Ud.MATCHED,i!==t&&(t.lifecycle=Ud.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(i){this._handleError("update",i,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=Ud.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Ud.FINALIZED}catch(i){this._handleError("finalization",i,t)}}}function Yr(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Yr(e[n],t[n],i-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const s of n)if(!t.hasOwnProperty(s)||!Yr(e[s],t[s],i-1))return!1;return!0}return!1}class BQ{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(const t in this.controllers){const i=this.controllers[t];i&&i.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(const t in this.controllers){const i=this.controllers[t];i&&i.updateTransition()}}getViewports(t){return t?this._viewports.filter(i=>i.containsPixel(t)):this._viewports}getViews(){const t={};return this.views.forEach(i=>{t[i.id]=i}),t}getView(t){return this.views.find(i=>i.id===t)}getViewState(t){const i=typeof t=="string"?this.getView(t):t,n=i&&this.viewState[i.getViewStateId()]||this.viewState;return i?i.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,i){const n=this.getViewports(),r={x:t[0],y:t[1]};for(let s=n.length-1;s>=0;--s){const o=n[s];if(o.containsPixel(r)){const c=t.slice();return c[0]-=o.x,c[1]-=o.y,o.unproject(c,i)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,i){(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.setNeedsUpdate("Size changed"))}_setViews(t){t=P0(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!Yr(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):Zi.warn("missing `viewState` or `initialViewState`")()}_createController(t,i){const n=i.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:r=>this.getView(t.id)?.makeViewport({viewState:r,width:this.width,height:this.height})})}_updateController(t,i,n,r){const s=t.controller;if(s&&n){const o={...i,...s,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!r||r.constructor!==s.type)&&(r=this._createController(t,o)),r&&r.setProps(o),r}return null}_rebuildViewports(){const{views:t}=this,i=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let r=t.length;r--;){const s=t[r],o=this.getViewState(s),c=s.makeViewport({viewState:o,width:this.width,height:this.height});let h=i[s.id];const A=!!s.controller;A&&!h&&(n=!0),(n||!A)&&h&&(h.finalize(),h=null),this.controllers[s.id]=this._updateController(s,o,c,h),c&&this._viewports.unshift(c)}for(const r in i){const s=i[r];s&&!this.controllers[r]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,i){return t.length!==i.length?!0:t.some((n,r)=>!t[r].equals(i[r]))}}const TQ=/([0-9]+\.?[0-9]*)(%|px)/;function Wu(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":const t=TQ.exec(e);if(t&&t.length>=3){const i=t[2]==="%",n=parseFloat(t[1]);return{position:i?n/100:n,relative:i}}default:throw new Error(`Could not parse position string ${e}`)}}function Ju(e,t){return e.relative?Math.round(e.position*t):e.position}class Gd{constructor(t){const{id:i,x:n=0,y:r=0,width:s="100%",height:o="100%",padding:c=null}=t;this.id=i||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Wu(n),this._y=Wu(r),this._width=Wu(s),this._height=Wu(o),this._padding=c&&{left:Wu(c.left||0),right:Wu(c.right||0),top:Wu(c.top||0),bottom:Wu(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&Yr(this.props,t.props,2)}makeViewport({width:t,height:i,viewState:n}){n=this.filterViewState(n);const r=this.getDimensions({width:t,height:i});if(!r.height||!r.width)return null;const s=this.getViewportType(n);return new s({...n,...this.props,...r})}getViewStateId(){const{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const i={...t};for(const n in this.props.viewState)n!=="id"&&(i[n]=this.props.viewState[n]);return i}return t}getDimensions({width:t,height:i}){const n={x:Ju(this._x,t),y:Ju(this._y,i),width:Ju(this._width,t),height:Ju(this._height,i)};return this._padding&&(n.padding={left:Ju(this._padding.left,t),top:Ju(this._padding.top,i),right:Ju(this._padding.right,t),bottom:Ju(this._padding.bottom,i)}),n}get controller(){const t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}}class R0{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:t,settings:i}=this;this._handle=t.addChannel({delay:t.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const LM=()=>{},Cb={BREAK:1,SNAP_TO_END:2,IGNORE:3},SQ=e=>e,IQ=Cb.BREAK;let MQ=class{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:n,startProps:r,endProps:s,duration:o,easing:c}}=t,h=c(i/o),A=n.interpolateProps(r,s,h);this.propsInTransition=this.getControllerState({...this.props,...A}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new R0(e.timeline),this.onViewStateChange=e.onViewStateChange||LM,this.onStateChange=e.onStateChange||LM}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){const{interruption:r,endProps:s}=this.transition.settings;n={...i,...r===Cb.SNAP_TO_END?s:this.propsInTransition||i}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Cb.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(i),r=t.transitionInterpolator,s=r.getDuration?r.getDuration(e,t):t.transitionDuration;if(s===0)return;const o=r.initializeProps(e,n);this.propsInTransition={};const c={duration:s,easing:t.transitionEasing||SQ,interpolator:r,interruption:t.transitionInterruption||IQ,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}};function $o(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}let PQ=class{constructor(e){const{compare:t,extract:i,required:n}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=n}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!ca(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},n={};for(const r of this._propsToExtract)(r in e||r in t)&&(i[r]=e[r],n[r]=t[r]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];$o(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}};const RQ=["longitude","latitude","zoom","bearing","pitch"],DQ=["longitude","latitude","zoom"];let FM=class extends PQ{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:RQ,required:DQ},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:n,around:r}=this.opts;if(n&&r){const s=n(e),o=n(t),c=s.unproject(r);i.start.around=r,Object.assign(i.end,{around:o.project(c),aroundPosition:c,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const n={};for(const r of this._propsToExtract)n[r]=hc(e[r]||0,t[r]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const r=this.opts.makeViewport({...t,...n});Object.assign(n,r.panByPosition(t.aroundPosition,hc(e.around,t.around,i)))}return n}};const Xu={transitionDuration:0},OQ=300,D0=e=>1-(1-e)*(1-e),jd={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},qh={};class LQ{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new MQ({...t,getControllerState:i=>new this.ControllerState(i),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(const t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;const i=this._eventStartBlocked;switch(t.type){case"panstart":return i?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return i?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return i?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){const{x:i,y:n}=this.props,{offsetCenter:r}=t;return[r.x-i,r.y-n]}isPointInBounds(t,i){const{width:n,height:r}=this.props;if(i&&i.handled)return!1;const s=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=r;return s&&i&&i.stopPropagation(),s}isFunctionKeyPressed(t){const{srcEvent:i}=t;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){const i=setTimeout(()=>{this._eventStartBlocked===i&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=i}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);const{inertia:i}=t;this.inertia=Number.isFinite(i)?i:i===!0?OQ:0;const{scrollZoom:n=!0,dragPan:r=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:c=!0,touchRotate:h=!1,keyboard:A=!0}=t,_=!!this.onViewStateChange;this.toggleEvents(jd.WHEEL,_&&n),this.toggleEvents(jd.PAN,_),this.toggleEvents(jd.PINCH,_&&(c||h)),this.toggleEvents(jd.MULTI_PAN,_&&h),this.toggleEvents(jd.DOUBLE_CLICK,_&&o),this.toggleEvents(jd.KEYBOARD,_&&A),this.scrollZoom=n,this.dragPan=r,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=c,this.touchRotate=h,this.keyboard=A}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,i){this.eventManager&&t.forEach(n=>{this._events[n]!==i&&(this._events[n]=i,i?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,i=null,n={}){const r={...t.getViewportProps(),...i},s=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);const r=this.controllerState[n?"panStart":"rotateStart"]({pos:i});return this._panMove=n,this.updateViewport(r,Xu,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;const i=this.getCenter(t),n=this.controllerState.pan({pos:i});return this.updateViewport(n,Xu,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){const{inertia:i}=this;if(this.dragPan&&i&&t.velocity){const n=this.getCenter(t),r=[n[0]+t.velocityX*i/2,n[1]+t.velocityY*i/2],s=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:D0},{isDragging:!1,isPanning:!0})}else{const n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;const i=this.getCenter(t),n=this.controllerState.rotate({pos:i});return this.updateViewport(n,Xu,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){const{inertia:i}=this;if(this.dragRotate&&i&&t.velocity){const n=this.getCenter(t),r=[n[0]+t.velocityX*i/2,n[1]+t.velocityY*i/2],s=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:D0},{isDragging:!1,isRotating:!0})}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;t.srcEvent.preventDefault();const{speed:n=.01,smooth:r=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=t;let o=2/(1+Math.exp(-Math.abs(s*n)));s<0&&o!==0&&(o=1/o);const c=this.controllerState.zoom({pos:i,scale:o});return this.updateViewport(c,{...this._getTransitionProps({around:i}),transitionDuration:r?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const n=this.controllerState.rotateStart({pos:i});return this.updateViewport(n,Xu,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;const i=this.getCenter(t);i[0]-=t.deltaX;const n=this.controllerState.rotate({pos:i});return this.updateViewport(n,Xu,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;const{inertia:i}=this;if(this.touchRotate&&i&&t.velocityY){const n=this.getCenter(t),r=[n[0],n[1]+=t.velocityY*i/2],s=this.controllerState.rotate({pos:r});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:i,transitionEasing:D0},{isDragging:!1,isRotating:!0}),this.blockEvents(i)}else{const n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const n=this.controllerState.zoomStart({pos:i}).rotateStart({pos:i});return qh._startPinchRotation=t.rotation,qh._lastPinchEvent=t,this.updateViewport(n,Xu,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let i=this.controllerState;if(this.touchZoom){const{scale:n}=t,r=this.getCenter(t);i=i.zoom({pos:r,scale:n})}if(this.touchRotate){const{rotation:n}=t;i=i.rotate({deltaAngleX:qh._startPinchRotation-n})}return this.updateViewport(i,Xu,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),qh._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;const{inertia:i}=this,{_lastPinchEvent:n}=qh;if(this.touchZoom&&i&&n&&t.scale!==n.scale){const r=this.getCenter(t);let s=this.controllerState.rotateEnd();const o=Math.log2(t.scale),c=(o-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),h=Math.pow(2,o+c*i/2);s=s.zoom({pos:r,scale:h}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:r}),transitionDuration:i,transitionEasing:D0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(i)}else{const r=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return qh._startPinchRotation=null,qh._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;const i=this.getCenter(t);if(!this.isPointInBounds(i,t))return!1;const n=this.isFunctionKeyPressed(t),r=this.controllerState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(r,this._getTransitionProps({around:i}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;const i=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:r,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let h;const A={};switch(t.srcEvent.code){case"Minus":h=i?c.zoomOut(n).zoomOut(n):c.zoomOut(n),A.isZooming=!0;break;case"Equal":h=i?c.zoomIn(n).zoomIn(n):c.zoomIn(n),A.isZooming=!0;break;case"ArrowLeft":i?(h=c.rotateLeft(s),A.isRotating=!0):(h=c.moveLeft(r),A.isPanning=!0);break;case"ArrowRight":i?(h=c.rotateRight(s),A.isRotating=!0):(h=c.moveRight(r),A.isPanning=!0);break;case"ArrowUp":i?(h=c.rotateUp(o),A.isRotating=!0):(h=c.moveUp(r),A.isPanning=!0);break;case"ArrowDown":i?(h=c.rotateDown(o),A.isRotating=!0):(h=c.moveDown(r),A.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),A),!0}_getTransitionProps(t){const{transition:i}=this;return!i||!i.transitionInterpolator?Xu:t?{...i,transitionInterpolator:new FM({...t,...i.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:i}}class FQ{constructor(t,i){this._viewportProps=this.applyConstraints(t),this._state=i}getViewportProps(){return this._viewportProps}getState(){return this._state}}const kM=5,kQ=1.2;let NQ=class extends FQ{constructor(e){const{width:t,height:i,latitude:n,longitude:r,zoom:s,bearing:o=0,pitch:c=0,altitude:h=1.5,position:A=[0,0,0],maxZoom:_=20,minZoom:C=0,maxPitch:S=60,minPitch:L=0,startPanLngLat:N,startZoomLngLat:U,startRotatePos:H,startBearing:j,startPitch:tt,startZoom:K,normalize:Q=!0}=e;$o(Number.isFinite(r)),$o(Number.isFinite(n)),$o(Number.isFinite(s)),super({width:t,height:i,latitude:n,longitude:r,zoom:s,bearing:o,pitch:c,altitude:h,maxZoom:_,minZoom:C,maxPitch:S,minPitch:L,normalize:Q,position:A},{startPanLngLat:N,startZoomLngLat:U,startRotatePos:H,startBearing:j,startPitch:tt,startZoom:K}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const n=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(n)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:n,startBearing:r,startPitch:s}=this.getState();if(!n||r===void 0||s===void 0)return this;let o;return e?o=this._getNewRotation(e,n,s,r):o={bearing:r+t,pitch:s+i},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:n,startZoomLngLat:r}=this.getState();if(r||(n=this.getViewportProps().zoom,r=this._unproject(t)||this._unproject(e)),!r)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let c=n+Math.log2(i);c=Wl(c,o,s);const h=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...h.panByPosition(r,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:r}=i;return Math.abs(n-t.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(r-t.longitude)>180&&(i.longitude=r<0?r+360:r-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=Wl(n,i,t);const{maxPitch:r,minPitch:s,pitch:o}=e;e.pitch=Wl(o,s,r);const{normalize:c=!0}=e;return c&&Object.assign(e,jJ(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,n){const r=e[0]-t[0],s=e[1]-t[1],o=e[1],c=t[1],{width:h,height:A}=this.getViewportProps(),_=r/h;let C=0;s>0?Math.abs(A-c)>kM&&(C=s/(c-A)*kQ):s<0&&c>kM&&(C=1-o/c),C=Wl(C,-1,1);const{minPitch:S,maxPitch:L}=this.getViewportProps(),N=n+180*_;let U=i;return C>0?U=i+C*(L-i):C<0&&(U=i-C*(S-i)),{pitch:U,bearing:N}}},UQ=class extends LQ{constructor(){super(...arguments),this.ControllerState=NQ,this.transition={transitionDuration:300,transitionInterpolator:new FM({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};class NM extends Gd{constructor(t={}){super(t)}getViewportType(){return eg}get ControllerType(){return UQ}}NM.displayName="MapView";const zQ=new pM;function GQ(e,t){const i=e.order??1/0,n=t.order??1/0;return i-n}class jQ{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){const i=this._defaultEffects;if(!i.find(n=>n.id===t.id)){const n=i.findIndex(r=>GQ(r,t)>0);n<0?i.push(t):i.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(Yr(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}getEffects(){return this._resolvedEffects}_setEffects(t){const i={};for(const r of this.effects)i[r.id]=r;const n=[];for(const r of t){const s=i[r.id];let o=r;s&&s!==r?s.setProps?(s.setProps(r.props),o=s):s.cleanup(this._context):s||r.setup(this._context),n.push(o),delete i[r.id]}for(const r in i)i[r].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(r=>r instanceof pM)||this._resolvedEffects.push(zQ),this._needsRedraw="effects changed"}finalize(){for(const t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class VQ extends S0{shouldDrawLayer(t){const{operation:i}=t.props;return i.includes("draw")||i.includes("terrain")}}const HQ="deckRenderer.renderLayers";class WQ{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new VQ(t),this.pickLayersPass=new MM(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;const i=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);const r=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);const s=i.render({...n,target:r});n.effects&&this._postRender(n.effects,n),this.renderCount++,fs(HQ,this,s,t)}needsRedraw(t={clearRedrawFlags:!1}){const i=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),i}finalize(){const{renderBuffers:t}=this;for(const i of t)i.delete();t.length=0}_preRender(t,i){this.lastPostProcessEffect=null,i.preRenderStats=i.preRenderStats||{};for(const n of t)i.preRenderStats[n.id]=n.preRender(i),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:t}=this,i=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(n=>{const r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[r]}))});for(const n of t)n.resize(i)}_postRender(t,i){const{renderBuffers:n}=this,r={...i,inputBuffer:n[0],swapBuffer:n[1]};for(const s of t)if(s.postRender){r.target=s.id===this.lastPostProcessEffect?i.target:void 0;const o=s.postRender(r);r.inputBuffer=o,r.swapBuffer=o===n[0]?n[1]:n[0]}}}const JQ={pickedColor:null,pickedObjectIndex:-1};function XQ({pickedColors:e,decodePickingColor:t,deviceX:i,deviceY:n,deviceRadius:r,deviceRect:s}){const{x:o,y:c,width:h,height:A}=s;let _=r*r,C=-1,S=0;for(let L=0;L<A;L++){const N=L+c-n,U=N*N;if(U>_)S+=4*h;else for(let H=0;H<h;H++){if(e[S+3]-1>=0){const j=H+o-i,tt=j*j+U;tt<=_&&(_=tt,C=S)}S+=4}}if(C>=0){const L=e.slice(C,C+4),N=t(L);if(N){const U=Math.floor(C/4/h),H=C/4-U*h;return{...N,pickedColor:L,pickedX:o+H,pickedY:c+U}}Zi.error("Picked non-existent layer. Is picking buffer corrupt?")()}return JQ}function QQ({pickedColors:e,decodePickingColor:t}){const i=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){const r=e.slice(n,n+4),s=r.join(",");if(!i.has(s)){const o=t(r);o?i.set(s,{...o,color:r}):Zi.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function UM({pickInfo:e,viewports:t,pixelRatio:i,x:n,y:r,z:s}){let o=t[0];t.length>1&&(o=qQ(e?.pickedViewports||t,{x:n,y:r}));let c;if(o){const h=[n-o.x,r-o.y];s!==void 0&&(h[2]=s),c=o.unproject(h)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:n,y:r,pixel:[n,r],coordinate:c,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:i}}function KQ(e){const{pickInfo:t,lastPickedInfo:i,mode:n,layers:r}=e,{pickedColor:s,pickedLayer:o,pickedObjectIndex:c}=t,h=o?[o]:[];if(n==="hover"){const C=i.index,S=i.layerId,L=o?o.props.id:null;if(L!==S||c!==C){if(L!==S){const N=r.find(U=>U.props.id===S);N&&h.unshift(N)}i.layerId=L,i.index=c,i.info=null}}const A=UM(e),_=new Map;return _.set(null,A),h.forEach(C=>{let S={...A};C===o&&(S.color=s,S.index=c,S.picked=!0),S=zM({layer:C,info:S,mode:n});const L=S.layer;C===o&&n==="hover"&&(i.info=S),_.set(L.id,S),n==="hover"&&L.updateAutoHighlight(S)}),_}function zM({layer:e,info:t,mode:i}){for(;e&&t;){const n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:i,sourceLayer:n}),e=e.parent}return t}function qQ(e,t){for(let i=e.length-1;i>=0;i--){const n=e[i];if(n.containsPixel(t))return n}return e[0]}class ZQ{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new MM(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:i,layers:n,viewports:r},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,c=s&&s.viewport&&s.viewport.id,h=o?n.find(C=>C.id===o):null,A=c&&r.find(C=>C.id===c)||r[0],_=A&&A.unproject([t-A.x,i-A.y]);return{...s,x:t,y:i,viewport:A,coordinate:_,layer:h}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;const i=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return i.length?i:null}_pickClosestObject({layers:t,views:i,viewports:n,x:r,y:s,radius:o=0,depth:c=1,mode:h="query",unproject3D:A,onViewportActive:_,effects:C}){const S=this.device.canvasContext.cssToDeviceRatio(),L=this._getPickable(t);if(!L||n.length===0)return{result:[],emptyInfo:UM({viewports:n,x:r,y:s,pixelRatio:S})};this._resizeBuffer();const N=this.device.canvasContext.cssToDevicePixels([r,s],!0),U=[N.x+Math.floor(N.width/2),N.y+Math.floor(N.height/2)],H=Math.round(o*S),{width:j,height:tt}=this.pickingFBO,K=this._getPickingRect({deviceX:U[0],deviceY:U[1],deviceRadius:H,deviceWidth:j,deviceHeight:tt}),Q={x:r-o,y:s-o,width:o*2+1,height:o*2+1};let pt;const $=[],zt=new Set;for(let Gt=0;Gt<c;Gt++){let dt;if(K){const Lt=this._drawAndSample({layers:L,views:i,viewports:n,onViewportActive:_,deviceRect:K,cullRect:Q,effects:C,pass:`picking:${h}`});dt=XQ({...Lt,deviceX:U[0],deviceY:U[1],deviceRadius:H,deviceRect:K})}else dt={pickedColor:null,pickedObjectIndex:-1};let lt;if(dt.pickedLayer&&A&&this.depthFBO){const{pickedColors:Lt}=this._drawAndSample({layers:[dt.pickedLayer],views:i,viewports:n,onViewportActive:_,deviceRect:{x:dt.pickedX,y:dt.pickedY,width:1,height:1},cullRect:Q,effects:C,pass:`picking:${h}:z`},!0);Lt[3]&&(lt=Lt[0])}dt.pickedLayer&&Gt+1<c&&(zt.add(dt.pickedLayer),dt.pickedLayer.disablePickingIndex(dt.pickedObjectIndex)),pt=KQ({pickInfo:dt,lastPickedInfo:this.lastPickedInfo,mode:h,layers:L,viewports:n,x:r,y:s,z:lt,pixelRatio:S});for(const Lt of pt.values())Lt.layer&&$.push(Lt);if(!dt.pickedColor)break}for(const Gt of zt)Gt.restorePickingColors();return{result:$,emptyInfo:pt.get(null)}}_pickVisibleObjects({layers:t,views:i,viewports:n,x:r,y:s,width:o=1,height:c=1,mode:h="query",maxObjects:A=null,onViewportActive:_,effects:C}){const S=this._getPickable(t);if(!S||n.length===0)return[];this._resizeBuffer();const L=this.device.canvasContext.cssToDeviceRatio(),N=this.device.canvasContext.cssToDevicePixels([r,s],!0),U=N.x,H=N.y+N.height,j=this.device.canvasContext.cssToDevicePixels([r+o,s+c],!0),tt=j.x+j.width,K=j.y,Q={x:U,y:K,width:tt-U,height:H-K},pt=this._drawAndSample({layers:S,views:i,viewports:n,onViewportActive:_,deviceRect:Q,cullRect:{x:r,y:s,width:o,height:c},effects:C,pass:`picking:${h}`}),$=QQ(pt),zt=new Map,Gt=[],dt=Number.isFinite(A);for(let lt=0;lt<$.length&&!(dt&&Gt.length>=A);lt++){const Lt=$[lt];let J={color:Lt.pickedColor,layer:null,index:Lt.pickedObjectIndex,picked:!0,x:r,y:s,pixelRatio:L};J=zM({layer:Lt.pickedLayer,info:J,mode:h});const ut=J.layer.id;zt.has(ut)||zt.set(ut,new Set);const Et=zt.get(ut),le=J.object??J.index;Et.has(le)||(Et.add(le),Gt.push(J))}return Gt}_drawAndSample({layers:t,views:i,viewports:n,onViewportActive:r,deviceRect:s,cullRect:o,effects:c,pass:h},A=!1){const _=A?this.depthFBO:this.pickingFBO,C={layers:t,layerFilter:this.layerFilter,views:i,viewports:n,onViewportActive:r,pickingFBO:_,deviceRect:s,cullRect:o,effects:c,pass:h,pickZ:A,preRenderStats:{},isPicking:!0};for(const tt of c)tt.useInPicking&&(C.preRenderStats[tt.id]=tt.preRender(C));const{decodePickingColor:S}=this.pickLayersPass.render(C),{x:L,y:N,width:U,height:H}=s,j=new(A?Float32Array:Uint8Array)(U*H*4);return this.device.readPixelsToArrayWebGL(_,{sourceX:L,sourceY:N,sourceWidth:U,sourceHeight:H,target:j}),{pickedColors:j,decodePickingColor:S}}_getPickingRect({deviceX:t,deviceY:i,deviceRadius:n,deviceWidth:r,deviceHeight:s}){const o=Math.max(0,t-n),c=Math.max(0,i-n),h=Math.min(r,t+n+1)-o,A=Math.min(s,i+n+1)-c;return h<=0||A<=0?null:{x:o,y:c,width:h,height:A}}}const YQ={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},$Q="top-left",GM="__root";class tK{constructor({deck:t,parentElement:i}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=i}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!Yr(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(const t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(i=>i.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){const i={};for(const n of this.resolvedWidgets)i[n.id]=n;this.resolvedWidgets.length=0;for(const n of this.defaultWidgets)i[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){const r=i[n.id];r?r.viewId!==n.viewId||r.placement!==n.placement?(this._remove(r),this._add(n)):n!==r&&(r.setProps(n.props),n=r):this._add(n),i[n.id]=null,this.resolvedWidgets.push(n)}for(const n in i){const r=i[n];r&&this._remove(r)}this.widgets=t}_add(t){const{viewId:i=null,placement:n=$Q}=t,r=t.onAdd({deck:this.deck,viewId:i});r&&this._getContainer(i,n).append(r),t._element=r}_remove(t){t.onRemove?.(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,i){const n=t||GM;let r=this.containers[n];r||(r=document.createElement("div"),r.style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",this.parentElement?.append(r),this.containers[n]=r);let s=r.querySelector(`.${i}`);return s||(s=document.createElement("div"),s.className=i,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,YQ[i]),r.append(s)),s}_updateContainers(){const t=this.deck.width,i=this.deck.height;for(const n in this.containers){const r=this.lastViewports[n]||null,s=n===GM||r,o=this.containers[n];s?(o.style.display="block",o.style.left=`${r?r.x:0}px`,o.style.top=`${r?r.y:0}px`,o.style.width=`${r?r.width:t}px`,o.style.height=`${r?r.height:i}px`):o.style.display="none"}}onRedraw({viewports:t,layers:i}){const n=t.reduce((r,s)=>(r[s.id]=s,r),{});for(const r of this.getWidgets()){const{viewId:s}=r;if(s){const o=n[s];o&&(r.onViewportChange&&r.onViewportChange(o),r.onRedraw?.({viewports:[o],layers:i}))}else{if(r.onViewportChange)for(const o of t)r.onViewportChange(o);r.onRedraw?.({viewports:t,layers:i})}}this.lastViewports=n,this._updateContainers()}onHover(t,i){for(const n of this.getWidgets()){const{viewId:r}=n;(!r||r===t.viewport?.id)&&n.onHover?.(t,i)}}onEvent(t,i){const n=ab[i.type];if(n)for(const r of this.getWidgets()){const{viewId:s}=r;(!s||s===t.viewport?.id)&&r[n]?.(t,i)}}}const eK={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class iK{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){const i=document.createElement("div");return i.className="deck-tooltip",Object.assign(i.style,eK),this.deck=t,this.element=i,i}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){const{deck:i}=this,n=i&&i.props.getTooltip;if(!n)return;const r=n(t);this.lastViewport=t.viewport,this.setTooltip(r,t.x,t.y)}setTooltip(t,i,n){const r=this.element;if(r){if(typeof t=="string")r.innerText=t;else if(t)t.text&&(r.innerText=t.text),t.html&&(r.innerHTML=t.html),t.className&&(r.className=t.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${i}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(r.style,t.style)}}}var Vd;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Vd||(Vd={}));const Eb={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ao=(e,t,i)=>t?e.enable(i):e.disable(i),jM=(e,t,i)=>e.hint(i,t),ha=(e,t,i)=>e.pixelStorei(i,t),VM=(e,t,i)=>{const n=i===36006?36009:36008;return e.bindFramebuffer(n,t)},ig=(e,t,i)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[i];e.bindBuffer(n,t)};function Bb(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const nK={3042:Ao,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:Ao,2885:(e,t)=>e.cullFace(t),2929:Ao,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:Ao,35723:jM,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:VM,36010:VM,34964:ig,36662:ig,36663:ig,35053:ig,35055:ig,2886:(e,t)=>e.frontFace(t),33170:jM,2849:(e,t)=>e.lineWidth(t),32823:Ao,32824:"polygonOffset",10752:"polygonOffset",35977:Ao,32926:Ao,32928:Ao,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ao,3088:(e,t)=>e.scissor(...t),2960:Ao,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:Ao,10754:Ao,12288:Ao,12289:Ao,12290:Ao,12291:Ao,12292:Ao,12293:Ao,12294:Ao,12295:Ao,3333:ha,3317:ha,37440:ha,37441:ha,37443:ha,3330:ha,3332:ha,3331:ha,3314:ha,32878:ha,3316:ha,3315:ha,32877:ha,framebuffer:(e,t)=>{const i=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,i)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const i=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...i)},blendFunc:(e,t)=>{const i=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...i)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=Bb(t)?t:[t,t];const[i,n]=t;e.stencilMaskSeparate(1028,i),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=Bb(t)&&t.length===3?[...t,...t]:t;const[i,n,r,s,o,c]=t;e.stencilFuncSeparate(1028,i,n,r),e.stencilFuncSeparate(1029,s,o,c)},stencilOp:(e,t)=>{t=Bb(t)&&t.length===3?[...t,...t]:t;const[i,n,r,s,o,c]=t;e.stencilOpSeparate(1028,i,n,r),e.stencilOpSeparate(1029,s,o,c)},viewport:(e,t)=>e.viewport(...t)};function $r(e,t,i){return t[e]!==void 0?t[e]:i[e]}const rK={blendEquation:(e,t,i)=>e.blendEquationSeparate($r(32777,t,i),$r(34877,t,i)),blendFunc:(e,t,i)=>e.blendFuncSeparate($r(32969,t,i),$r(32968,t,i),$r(32971,t,i),$r(32970,t,i)),polygonOffset:(e,t,i)=>e.polygonOffset($r(32824,t,i),$r(10752,t,i)),sampleCoverage:(e,t,i)=>e.sampleCoverage($r(32938,t,i),$r(32939,t,i)),stencilFuncFront:(e,t,i)=>e.stencilFuncSeparate(1028,$r(2962,t,i),$r(2967,t,i),$r(2963,t,i)),stencilFuncBack:(e,t,i)=>e.stencilFuncSeparate(1029,$r(34816,t,i),$r(36003,t,i),$r(36004,t,i)),stencilOpFront:(e,t,i)=>e.stencilOpSeparate(1028,$r(2964,t,i),$r(2965,t,i),$r(2966,t,i)),stencilOpBack:(e,t,i)=>e.stencilOpSeparate(1029,$r(34817,t,i),$r(34818,t,i),$r(34819,t,i))},HM={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,i)=>e({[t]:i}),hint:(e,t,i)=>e({[t]:i}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,i)=>e({36007:i}),bindTransformFeedback:(e,t,i)=>e({36389:i}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,i)=>{switch(t){case 36160:return e({36006:i,36010:i});case 36009:return e({36006:i});case 36008:return e({36010:i});default:return null}},bindBuffer:(e,t,i)=>{const n={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return n?e({[n]:i}):{valueChanged:!0}},blendColor:(e,t,i,n,r)=>e({32773:new Float32Array([t,i,n,r])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,i)=>e({32777:t,34877:i}),blendFunc:(e,t,i)=>e({32969:t,32968:i,32971:t,32970:i}),blendFuncSeparate:(e,t,i,n,r)=>e({32969:t,32968:i,32971:n,32970:r}),clearColor:(e,t,i,n,r)=>e({3106:new Float32Array([t,i,n,r])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,i,n,r)=>e({3107:[t,i,n,r]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,i)=>e({2928:new Float32Array([t,i])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,i)=>e({32824:t,10752:i}),sampleCoverage:(e,t,i)=>e({32938:t,32939:i}),scissor:(e,t,i,n,r)=>e({3088:new Int32Array([t,i,n,r])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,i)=>e({[t===1028?2968:36005]:i}),stencilFunc:(e,t,i,n)=>e({2962:t,2967:i,2963:n,34816:t,36003:i,36004:n}),stencilFuncSeparate:(e,t,i,n,r)=>e({[t===1028?2962:34816]:i,[t===1028?2967:36003]:n,[t===1028?2963:36004]:r}),stencilOp:(e,t,i,n)=>e({2964:t,2965:i,2966:n,34817:t,34818:i,34819:n}),stencilOpSeparate:(e,t,i,n,r)=>e({[t===1028?2964:34817]:i,[t===1028?2965:34818]:n,[t===1028?2966:34819]:r}),viewport:(e,t,i,n,r)=>e({2978:[t,i,n,r]})},ol=(e,t)=>e.isEnabled(t),WM={3042:ol,2884:ol,2929:ol,3024:ol,32823:ol,32926:ol,32928:ol,3089:ol,2960:ol,35977:ol},oK=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Hd(e,t){if(aK(t))return;const i={};for(const r in t){const s=Number(r),o=nK[r];o&&(typeof o=="string"?i[o]=!0:o(e,t[r],s))}const n=e.state&&e.state.cache;if(n)for(const r in i){const s=rK[r];s(e,t,n)}}function JM(e,t=Eb){if(typeof t=="number"){const r=t,s=WM[r];return s?s(e,r):e.getParameter(r)}const i=Array.isArray(t)?t:Object.keys(t),n={};for(const r of i){const s=WM[r];n[r]=s?s(e,Number(r)):e.getParameter(Number(r))}return n}function sK(e){Hd(e,Eb)}function aK(e){for(const t in e)return!1;return!0}function cK(e,t){if(e===t)return!0;const i=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(i&&n&&e.length===t.length){for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}class Zh{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,i){this.gl=t,this.log=i?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){const t=this.stateStack[this.stateStack.length-1];Hd(this.gl,t),this.stateStack.pop()}trackState(t,i){if(this.cache=i.copyState?JM(t):Object.assign({},Eb),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,uK(t);for(const n in HM){const r=HM[n];lK(t,n,r)}XM(t,"getParameter"),XM(t,"isEnabled")}_updateCache(t){let i=!1,n;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in t){const o=t[s],c=this.cache[s];cK(o,c)||(i=!0,n=c,r&&!(s in r)&&(r[s]=c),this.cache[s]=o)}return{valueChanged:i,oldValue:n}}}function XM(e,t){const i=e[t].bind(e);e[t]=function(n){if(n===void 0||oK.has(n))return i(n);const r=Zh.get(e);return n in r.cache||(r.cache[n]=i(n)),r.enable?r.cache[n]:i(n)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function lK(e,t,i){if(!e[t])return;const n=e[t].bind(e);e[t]=function(...r){const s=Zh.get(e),{valueChanged:o,oldValue:c}=i(s._updateCache,...r);return o&&n(...r),c},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function uK(e){const t=e.useProgram.bind(e);e.useProgram=function(i){const n=Zh.get(e);n.program!==i&&(t(i),n.program=i)}}function hK(e,t,i){let n="";const r={preserveDrawingBuffer:!0,...i};let s=null;if(s||=e.getContext("webgl2",r),r.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!i.failIfMajorPerformanceCaveat&&(r.failIfMajorPerformanceCaveat=!1,s=e.getContext("webgl2",r),s.luma||={},s.luma.softwareRenderer=!0),s||(s=e.getContext("webgl",{}),s&&(s=null,n||="Your browser only supports WebGL1")),!s)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);const{onContextLost:o,onContextRestored:c}=t;return e.addEventListener("webglcontextlost",h=>o(h),!1),e.addEventListener("webglcontextrestored",h=>c(h),!1),s.luma||={},s}function Wd(e,t,i){return i[t]===void 0&&(i[t]=e.getExtension(t)||null),i[t]}function fK(e,t){const i=e.getParameter(7936),n=e.getParameter(7937);Wd(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,s=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:7936),o=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:7937),c=s||i,h=o||n,A=e.getParameter(7938),_=QM(c,h),C=dK(c,h),S=pK(c,h);return{type:"webgl",gpu:_,gpuType:S,gpuBackend:C,vendor:c,renderer:h,version:A,shadingLanguage:"glsl",shadingLanguageVersion:300}}function QM(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function dK(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function pK(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(QM(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function KM(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}const ng="WEBGL_compressed_texture_s3tc",rg="WEBGL_compressed_texture_s3tc_srgb",Jd="EXT_texture_compression_rgtc",Xd="EXT_texture_compression_bptc",AK="WEBGL_compressed_texture_etc",gK="WEBGL_compressed_texture_astc",mK="WEBGL_compressed_texture_etc1",yK="WEBGL_compressed_texture_pvrtc",vK="WEBGL_compressed_texture_atc",qM="EXT_texture_norm16",ZM="EXT_render_snorm",_K="EXT_color_buffer_float",Tb={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[ZM],"norm16-renderable-webgl":[qM],"snorm16-renderable-webgl":[qM,ZM],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[ng,rg,Jd,Xd],"texture-compression-bc5-webgl":[Jd],"texture-compression-bc7-webgl":[Xd],"texture-compression-etc2":[AK],"texture-compression-astc":[gK],"texture-compression-etc1-webgl":[mK],"texture-compression-pvrtc-webgl":[yK],"texture-compression-atc-webgl":[vK]};function bK(e){return e in Tb}function xK(e,t,i){return(Tb[t]||[]).every(n=>Wd(e,n,i))}const Sb={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:_K,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:ng},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:rg},"bc1-rgba-unorm":{gl:33777,x:ng},"bc1-rgba-unorm-srgb":{gl:35916,x:rg},"bc2-rgba-unorm":{gl:33778,x:ng},"bc2-rgba-unorm-srgb":{gl:35918,x:rg},"bc3-rgba-unorm":{gl:33779,x:ng},"bc3-rgba-unorm-srgb":{gl:35919,x:rg},"bc4-r-unorm":{gl:36283,x:Jd},"bc4-r-snorm":{gl:36284,x:Jd},"bc5-rg-unorm":{gl:36285,x:Jd},"bc5-rg-snorm":{gl:36286,x:Jd},"bc6h-rgb-ufloat":{gl:36495,x:Xd},"bc6h-rgb-float":{gl:36494,x:Xd},"bc7-rgba-unorm":{gl:36492,x:Xd},"bc7-rgba-unorm-srgb":{gl:36493,x:Xd},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function wK(e,t,i){let n=t.create;const r=Sb[t.format];return r?.gl===void 0&&(n=!1),r?.x&&(n=n&&!!Wd(e,r.x,i)),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function YM(e){const t=Sb[e],i=BK(e),n=C1(e);return{internalFormat:i,format:t?.dataFormat||EK(n.channels,n.integer,n.normalized,i),type:n.dataType?KM(n.dataType):t?.types?.[0]||5121,compressed:n.compressed||!1}}function CK(e){switch(C1(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}function EK(e,t,i,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!i?36244:6403;case"rg":return t&&!i?33320:33319;case"rgb":return t&&!i?36248:6407;case"rgba":return t&&!i?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function BK(e){const t=Sb[e]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${e}`);return t}const $M={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class TK extends lj{gl;extensions;testedFeatures=new Set;constructor(t,i,n){super([],n),this.gl=t,this.extensions=i,Wd(t,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const t=this.getFeatures();for(const i of t)this.has(i)&&(yield i);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),bK(t)&&xK(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of t)this.has(i)}getFeatures(){return[...Object.keys($M),...Object.keys(Tb)]}getWebGLFeature(t){const i=$M[t];return typeof i=="string"?!!Wd(this.gl,i,this.extensions):!!i}}class SK extends cj{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class og extends s_{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,i){super(t,i);const n=i.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){const n=this.colorAttachments[i];if(n){const r=36064+i;this._attachTextureView(r,n)}}if(this.depthStencilAttachment){const i=CK(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){const i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${MK(i)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,i){const{gl:n}=this.device,{texture:r}=i,s=i.props.baseMipLevel,o=i.props.baseArrayLayer;switch(n.bindTexture(r.glTarget,r.handle),r.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,r.handle,s,o);break;case 34067:const c=IK(o);n.framebufferTexture2D(36160,t,c,r.handle,s);break;case 3553:n.framebufferTexture2D(36160,t,3553,r.handle,s);break;default:throw new Error("Illegal texture type")}n.bindTexture(r.glTarget,null)}}function IK(e){return e<34069?e+34069:e}function MK(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}class PK extends BE{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,i){super(i),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new og(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(i,t);return}}commit(){}}async function tP(e,t){const i=document.getElementsByTagName("head")[0];if(!i)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),new Promise((r,s)=>{n.onload=r,n.onerror=o=>s(new Error(`Unable to load script '${e}': ${o}`)),i.appendChild(n)})}const RK=1;let fa=null,eP=!1;const Ib={debugSpectorJS:$e.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function DK(e){if(!globalThis.SPECTOR)try{await tP(e.debugSpectorJSUrl||Ib.debugSpectorJSUrl)}catch(t){$e.warn(String(t))}}function OK(e){if(e={...Ib,...e},!e.debugSpectorJS)return null;if(!fa&&globalThis.SPECTOR&&!globalThis.luma?.spector){$e.probe(RK,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;fa=new t,globalThis.luma&&(globalThis.luma.spector=fa)}if(!fa)return null;if(eP||(eP=!0,fa.spyCanvases(),fa?.onCaptureStarted.add(t=>$e.info("Spector capture started:",t)()),fa?.onCapture.add(t=>{$e.info("Spector capture complete:",t)(),fa?.getResultUI(),fa?.resultView.display(),fa?.resultView.addCapture(t)})),e.gl){const t=e.gl,i=t.device;fa?.startCapture(e.gl,500),t.device=i,new Promise(n=>setTimeout(n,2e3)).then(n=>{$e.info("Spector capture stopped after 2 seconds")(),fa?.stopCapture()})}return fa}const LK="https://unpkg.com/webgl-debug@2.0.1/index.js";function iP(e){return e.luma=e.luma||{},e.luma}async function FK(){tl()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await tP(LK))}function kK(e,t={}){return t.debugWebGL||t.traceWebGL?UK(e,t):NK(e)}function NK(e){const t=iP(e);return t.realContext?t.realContext:e}function UK(e,t){if(!globalThis.WebGLDebugUtils)return $e.warn("webgl-debug not loaded")(),e;const i=iP(e);if(i.debugContext)return i.debugContext;globalThis.WebGLDebugUtils.init({...Vd,...e});const n=globalThis.WebGLDebugUtils.makeDebugContext(e,zK.bind(null,t),GK.bind(null,t));for(const o in Vd)!(o in n)&&typeof Vd[o]=="number"&&(n[o]=Vd[o]);class r{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,n);const s=Object.create(r);return i.realContext=e,i.debugContext=s,s.debug=!0,s}function nP(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let i=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return i=`${i.slice(0,100)}${i.length>100?"...":""}`,`gl.${e}(${i})`}function zK(e,t,i,n){n=Array.from(n).map(c=>c===void 0?"undefined":c);const r=globalThis.WebGLDebugUtils.glEnumToString(t),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(i,n),o=`${r} in gl.${i}(${s})`;$e.error(o)();debugger}function GK(e,t,i){let n="";$e.level>=1&&(n=nP(t,i),e.traceWebGL&&$e.log(1,n)());for(const r of i)if(r===void 0){n=n||nP(t,i);debugger}}const Mb={};function jK(e="id"){Mb[e]=Mb[e]||1;const t=Mb[e]++;return`${e}-${t}`}class sg extends Cr{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(t,i={}){super(t,i),this.device=t,this.gl=this.device.gl;const n=typeof i=="object"?i.handle:void 0;this.handle=n||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=VK(this.props.usage),this.glUsage=HK(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(t,i=0,n=t.byteLength+i){const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bufferSubData(r,i,t),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,i,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let i=t;t===0&&(i=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,i,t.byteLength)}async readAsync(t=0,i){return this.readSyncWebGL(t,i)}readSyncWebGL(t=0,i){i=i??this.byteLength-t;const n=new Uint8Array(i);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,0,i),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,i),n}}function VK(e){return e&Cr.INDEX?34963:e&Cr.VERTEX?34962:e&Cr.UNIFORM?35345:34962}function HK(e){return e&Cr.INDEX||e&Cr.VERTEX?35044:e&Cr.UNIFORM?35048:35044}function WK(e){const t=e.split(/\r?\n/),i=[];for(const n of t){if(n.length<=1)continue;const r=n.split(":");if(r.length===2){const[C,S]=r;i.push({message:S.trim(),type:rP(C),lineNum:0,linePos:0});continue}const[s,o,c,...h]=r;let A=parseInt(c,10);isNaN(A)&&(A=0);let _=parseInt(o,10);isNaN(_)&&(_=0),i.push({message:h.join(":").trim(),type:rP(s),lineNum:A,linePos:_})}return i}function rP(e){const t=["warning","error","info"],i=e.toLowerCase();return t.includes(i)?i:"info"}class JK extends o_{device;handle;constructor(t,i){switch(super(t,i),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?WK(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:i}=this.device;if(i.shaderSource(this.handle,t),i.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}$e.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),$e.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async n=>await new Promise(r=>setTimeout(r,n));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function XK(e,t,i,n){if(ZK(t))return n(e);const r=e;r.pushState();try{return QK(e,t),Hd(r.gl,i),n(e)}finally{r.popState()}}function QK(e,t){const i=e,{gl:n}=i;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(Yh("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){const r=i.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=Yh("provokingVertex",t.provokingVertex,{first:36429,last:36430});r?.provokingVertexWEBGL(s)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){const r=i.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=Yh("polygonMode",t.polygonMode,{fill:6914,line:6913});r?.polygonModeWEBGL(1028,s),r?.polygonModeWEBGL(1029,s)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(qK("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Pb("depthCompare",t.depthCompare))),t.stencilWriteMask){const r=t.stencilWriteMask;n.stencilMaskSeparate(1028,r),n.stencilMaskSeparate(1029,r)}if(t.stencilReadMask&&$e.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const r=t.stencilReadMask||4294967295,s=Pb("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,s,0,r),n.stencilFuncSeparate(1029,s,0,r)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const r=Rb("stencilPassOperation",t.stencilPassOperation),s=Rb("stencilFailOperation",t.stencilFailOperation),o=Rb("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,s,o,r),n.stencilOpSeparate(1029,s,o,r)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break}if(t.blendColorOperation||t.blendAlphaOperation){const r=oP("blendColorOperation",t.blendColorOperation||"add"),s=oP("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(r,s);const o=O0("blendColorSrcFactor",t.blendColorSrcFactor||"one"),c=O0("blendColorDstFactor",t.blendColorDstFactor||"zero"),h=O0("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),A=O0("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(o,c,h,A)}}function Pb(e,t){return Yh(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Rb(e,t){return Yh(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function oP(e,t){return Yh(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function O0(e,t){return Yh(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function KK(e,t){return`Illegal parameter ${t} for ${e}`}function Yh(e,t,i){if(!(t in i))throw new Error(KK(e,t));return i[t]}function qK(e,t){return t}function ZK(e){let t=!0;for(const i in e){t=!1;break}return t}function sP(e){const t={};return e.addressModeU&&(t[10242]=Db(e.addressModeU)),e.addressModeV&&(t[10243]=Db(e.addressModeV)),e.addressModeW&&(t[32882]=Db(e.addressModeW)),e.magFilter&&(t[10240]=Ob(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=YK(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=Pb("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function Db(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Ob(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function YK(e,t="none"){if(!t)return Ob(e);switch(t){case"none":return Ob(e);case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Lb extends om{device;handle;parameters;constructor(t,i){super(t,i),this.device=t,this.parameters=sP(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[i,n]of Object.entries(t)){const r=Number(i);switch(r){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,r,n);break;default:this.device.gl.samplerParameteri(this.handle,r,n);break}}}}class Qd extends r_{device;gl;handle;texture;constructor(t,i){super(t,{...cr.defaultProps,...i}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const $K="Failed to deduce GL constant from typed array";function tq(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error($K)}}function eq(e,t){const{clamped:i=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return i?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function aP(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function iq(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function L0(e,t,i){if(nq(t))return i(e);const{nocatch:n=!0}=t,r=Zh.get(e);r.push(),Hd(e,t);let s;if(n)s=i(e),r.pop();else try{s=i(e)}finally{r.pop()}return s}function nq(e){for(const t in e)return!1;return!0}function rq(e,t,i){const{dimension:n,width:r,height:s,depth:o=0}=i,{glInternalFormat:c}=i,h=i.glTarget;switch(n){case"2d-array":case"3d":e.texStorage3D(h,t,c,r,s,o);break;default:e.texStorage2D(h,t,c,r,s)}}function cP(e,t,i,n){const{width:r,height:s}=n,{dimension:o,depth:c=0,mipLevel:h=0}=n,{x:A=0,y:_=0,z:C=0}=n,{glFormat:S,glType:L}=n,N=uP(n.glTarget,o,c),U=n.flipY?{37440:!0}:{};L0(e,U,()=>{switch(o){case"2d-array":case"3d":e.bindTexture(N,t),e.texSubImage3D(N,h,A,_,C,r,s,c,S,L,i),e.bindTexture(N,null);break;case"2d":case"cube":e.bindTexture(N,t),e.texSubImage2D(N,h,A,_,r,s,S,L,i),e.bindTexture(N,null);break;default:throw new Error(o)}})}function lP(e,t,i){const{dimension:n,width:r,height:s,depth:o=0,mipLevel:c=0,byteOffset:h=0}=i,{x:A=0,y:_=0,z:C=0}=i,{glFormat:S,glType:L,compressed:N}=i,U=uP(i.glTarget,n,o);switch(n){case"2d-array":case"3d":N?e.compressedTexSubImage3D(U,c,A,_,C,r,s,o,S,t,h):e.texSubImage3D(U,c,A,_,C,r,s,o,S,L,t,h);break;case"2d":case"cube":N?e.compressedTexSubImage2D(U,c,A,_,r,s,S,t,h):e.texSubImage2D(U,c,A,_,r,s,S,L,t,h);break;default:throw new Error(n)}}function oq(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(e)}function uP(e,t,i){return t==="cube"?34069+i:e}function sq(e,t){const{sourceX:i=0,sourceY:n=0,sourceAttachment:r=0}=t||{};let{target:s=null,sourceWidth:o,sourceHeight:c,sourceDepth:h,sourceFormat:A,sourceType:_}=t||{};const{framebuffer:C,deleteFramebuffer:S}=hP(e),{gl:L,handle:N}=C;o||=C.width,c||=C.height;const U=C.colorAttachments[r]?.texture;if(!U)throw new Error(`Invalid framebuffer attachment ${r}`);h=U?.depth||1,A||=U?.glFormat||6408,_||=U?.glType||5121,s=lq(s,_,A,o,c),_=_||tq(s);const H=L.bindFramebuffer(36160,N);return L.readBuffer(36064+r),L.readPixels(i,n,o,c,A,_,s),L.readBuffer(36064),L.bindFramebuffer(36160,H||null),S&&C.destroy(),s}function aq(e,t){const{target:i,sourceX:n=0,sourceY:r=0,sourceFormat:s=6408,targetByteOffset:o=0}=t||{};let{sourceWidth:c,sourceHeight:h,sourceType:A}=t||{};const{framebuffer:_,deleteFramebuffer:C}=hP(e);c=c||_.width,h=h||_.height;const S=_;A=A||5121;let L=i;if(!L){const U=aP(s),H=iq(A),j=o+c*h*U*H;L=S.device.createBuffer({byteLength:j})}const N=e.device.createCommandEncoder();return N.copyTextureToBuffer({sourceTexture:e,width:c,height:h,origin:[n,r],destinationBuffer:L,byteOffset:o}),N.destroy(),C&&_.destroy(),L}function hP(e){return e instanceof s_?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:cq(e),deleteFramebuffer:!0}}function cq(e,t){const{device:i,width:n,height:r,id:s}=e;return i.createFramebuffer({...t,id:`framebuffer-for-${s}`,width:n,height:r,colorAttachments:[e]})}function lq(e,t,i,n,r,s){if(e)return e;t||=5121;const o=eq(t,{clamped:!1}),c=aP(i);return new o(n*r*c)}class ag extends cr{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(t,i){super(t,i);const n={...this.props};n.data=i.data,this.device=t,this.gl=this.device.gl,this.glTarget=oq(this.props.dimension);const r=YM(this.props.format);this.glInternalFormat=r.internalFormat,this.glFormat=r.format,this.glType=r.type,this.compressed=r.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(n),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:i,height:n}=t;if(!i||!n){const r=cr.getTextureDataSize(t.data);i=r?.width||1,n=r?.height||1}if(this.width=i,this.height=n,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Qd(this.device,{...this.props,texture:this}),this.bind(),rq(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Qd(this.device,{...t,texture:this})}setSampler(t={}){let i;t instanceof Lb?(this.sampler=t,i=t.props):(this.sampler=new Lb(this.device,t),i=t);const n=sP(i);this._setSamplerParameters(n)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&($e.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){$e.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const i=cr.getExternalImageSize(t.image),n={...cr.defaultCopyExternalImageOptions,...i,...t},{image:r,depth:s,mipLevel:o,x:c,y:h,z:A,flipY:_}=n;let{width:C,height:S}=n;const{dimension:L,glTarget:N,glFormat:U,glInternalFormat:H,glType:j}=this;if(C=Math.min(C,this.width-c),S=Math.min(S,this.height-h),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return cP(this.device.gl,this.handle,r,{dimension:L,mipLevel:o,x:c,y:h,z:A,width:C,height:S,depth:s,glFormat:U,glType:j,glTarget:N,flipY:_}),{width:n.width,height:n.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,i=0){this.bind();const n=cr.normalizeTextureData(t,this);n.length>1&&this.props.mipmaps!==!1&&$e.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let r=0;r<n.length;r++){const s=n[r];this._setMipLevel(i,r,s)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),lP(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,i=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const n of cr.CubeFaces)this.setTextureCubeFaceData(t[n],n)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,i,n=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&$e.warn(`${this.id} has mipmap and multiple LODs.`)();const r=cr.CubeFaces.indexOf(i);this.setTexture2DData(t,r)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:i,width:n,height:r,pixels:s,data:o,format:c=6408,type:h=5121}=t,{gl:A}=this,_=s||o;this.bind(),_ instanceof Promise?_.then(C=>this.setImageDataForFace(Object.assign({},t,{face:i,data:C,pixels:C}))):this.width||this.height?A.texImage2D(i,0,c,n,r,0,c,h,_):A.texImage2D(i,0,c,c,h,_)}_getImageDataMap(t){for(let i=0;i<cr.CubeFaces.length;++i){const n=cr.CubeFaces[i];t[n]&&(t[34069+i]=t[n],delete t[n])}return t}_setSamplerParameters(t){$e.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[i,n]of Object.entries(t)){const r=Number(i),s=n;switch(r){case 33082:case 33083:this.gl.texParameterf(this.glTarget,r,s);break;case 10241:this.gl.texParameteri(this.glTarget,r,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,r,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,r,s);break;default:this.gl.texParameteri(this.glTarget,r,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,i,n,r=this.glTarget){if(cr.isExternalImage(n)){cP(this.device.gl,this.handle,n,{...this,depth:t,mipLevel:i,glTarget:r,flipY:this.props.flipY});return}if(cr.isTextureLevelData(n)){lP(this.device.gl,n.data,{...this,depth:t,mipLevel:i,glTarget:r});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,null),t}}const uq=[1,2,4,8];class hq extends Bf{device;glParameters;constructor(t,i){super(t,i),this.device=t;let n;if(!i?.parameters?.viewport)if(i?.framebuffer){const{width:r,height:s}=i.framebuffer;n=[0,0,r,s]}else{const[r,s]=t.getCanvasContext().getDrawingBufferSize();n=[0,0,r,s]}if(this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const r=this.props.framebuffer.colorAttachments.map((s,o)=>36064+o);this.device.gl.drawBuffers(r)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const i={...this.glParameters};i.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(i.viewport=t.viewport.slice(0,4),i.depthRange=[t.viewport[4],t.viewport[5]]):i.viewport=t.viewport),t.scissorRect&&(i.scissorTest=!0,i.scissor=t.scissorRect),t.blendConstant&&(i.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(i.colorMask=uq.map(n=>!!(n&t.colorMask))),this.glParameters=i,Hd(this.device.gl,i)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let i=0;this.props.clearColors&&this.props.clearColors.forEach((n,r)=>{n&&this.clearColorBuffer(r,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(i|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=1024,t.clearStencil=this.props.clearStencil),i!==0&&L0(this.device.gl,t,()=>{this.device.gl.clear(i)})}clearColorBuffer(t=0,i=[0,0,0,0]){L0(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,i);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,i);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,i);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function fq(e){return dq.includes(e)}const dq=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],fP={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function dP(e){const t=fP[e];if(!t)throw new Error("uniform");const[i,n,,r]=t;return{format:r,components:n,glType:i}}function pq(e){const t=fP[e];if(!t)throw new Error("attribute");const[,i,,n,r]=t;return{attributeType:n,vertexFormat:r,components:i}}function Aq(e,t){const i={attributes:[],bindings:[]};i.attributes=gq(e,t);const n=vq(e,t);for(const c of n){const h=c.uniforms.map(A=>({name:A.name,format:A.format,byteOffset:A.byteOffset,byteStride:A.byteStride,arrayLength:A.arrayLength}));i.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:h})}const r=yq(e,t);let s=0;for(const c of r)if(fq(c.type)){const{viewDimension:h,sampleType:A}=bq(c.type);i.bindings.push({type:"texture",name:c.name,group:0,location:s,viewDimension:h,sampleType:A}),c.textureUnit=s,s+=1}r.length&&(i.uniforms=r);const o=mq(e,t);return o?.length&&(i.varyings=o),i}function gq(e,t){const i=[],n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){const s=e.getActiveAttrib(t,r);if(!s)throw new Error("activeInfo");const{name:o,type:c}=s,h=e.getAttribLocation(t,o);if(h>=0){const{attributeType:A}=pq(c),_=/instance/i.test(o)?"instance":"vertex";i.push({name:o,location:h,stepMode:_,type:A})}}return i.sort((r,s)=>r.location-s.location),i}function mq(e,t){const i=[],n=e.getProgramParameter(t,35971);for(let r=0;r<n;r++){const s=e.getTransformFeedbackVarying(t,r);if(!s)throw new Error("activeInfo");const{name:o,type:c,size:h}=s,{glType:A,components:_}=dP(c),C={location:r,name:o,type:A,size:h*_};i.push(C)}return i.sort((r,s)=>r.location-s.location),i}function yq(e,t){const i=[],n=e.getProgramParameter(t,35718);for(let r=0;r<n;r++){const s=e.getActiveUniform(t,r);if(!s)throw new Error("activeInfo");const{name:o,size:c,type:h}=s,{name:A,isArray:_}=xq(o);let C=e.getUniformLocation(t,A);const S={location:C,name:A,size:c,type:h,isArray:_};if(i.push(S),S.size>1)for(let L=0;L<S.size;L++){const N=`${A}[${L}]`;C=e.getUniformLocation(t,N);const U={...S,name:N,location:C};i.push(U)}}return i}function vq(e,t){const i=(s,o)=>e.getActiveUniformBlockParameter(t,s,o),n=[],r=e.getProgramParameter(t,35382);for(let s=0;s<r;s++){const o={name:e.getActiveUniformBlockName(t,s)||"",location:i(s,35391),byteLength:i(s,35392),vertex:i(s,35396),fragment:i(s,35398),uniformCount:i(s,35394),uniforms:[]},c=i(s,35395)||[],h=e.getActiveUniforms(t,c,35383),A=e.getActiveUniforms(t,c,35384),_=e.getActiveUniforms(t,c,35387),C=e.getActiveUniforms(t,c,35388);for(let S=0;S<o.uniformCount;++S){const L=e.getActiveUniform(t,c[S]);if(!L)throw new Error("activeInfo");o.uniforms.push({name:L.name,format:dP(h[S]).format,type:h[S],arrayLength:A[S],byteOffset:_[S],byteStride:C[S]})}n.push(o)}return n.sort((s,o)=>s.location-o.location),n}const _q={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function bq(e){const t=_q[e];if(!t)throw new Error("sampler");const[i,n]=t;return{viewDimension:i,sampleType:n}}function xq(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function wq(e,t,i,n){const r=e;let s=n;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(i){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:return e.uniform1iv(t,o);case 35667:return e.uniform2iv(t,o);case 35668:return e.uniform3iv(t,o);case 35669:return e.uniform4iv(t,o);case 35670:return e.uniform1iv(t,o);case 35671:return e.uniform2iv(t,o);case 35672:return e.uniform3iv(t,o);case 35673:return e.uniform4iv(t,o);case 5125:return r.uniform1uiv(t,o,1);case 36294:return r.uniform2uiv(t,o,2);case 36295:return r.uniform3uiv(t,o,3);case 36296:return r.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return r.uniformMatrix2x3fv(t,!1,o);case 35686:return r.uniformMatrix2x4fv(t,!1,o);case 35687:return r.uniformMatrix3x2fv(t,!1,o);case 35688:return r.uniformMatrix3x4fv(t,!1,o);case 35689:return r.uniformMatrix4x2fv(t,!1,o);case 35690:return r.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}function Cq(e){return wM(e)!==null||typeof e=="number"||typeof e=="boolean"}function Eq(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach(i=>{const n=e[i];Cq(n)?t.uniforms[i]=n:t.bindings[i]=n}),t}function Bq(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}function Tq(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(e)}}const pP=4;class Sq extends iA{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(t,i){super(t,i),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:n,bufferMode:r=35981}=i;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,r)),this._linkShaders(),$e.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=Aq(this.device.gl,this.handle),$e.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=Iq(this.introspectedLayout,i.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,i){for(const[n,r]of Object.entries(t)){const s=this.shaderLayout.bindings.find(o=>o.name===n)||this.shaderLayout.bindings.find(o=>o.name===`${n}Uniforms`);if(!s){const o=this.shaderLayout.bindings.map(c=>`"${c.name}"`).join(", ");i?.disableWarnings||$e.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${o}`,r)();continue}switch(r||$e.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(r instanceof sg)&&!(r.buffer instanceof sg))throw new Error("buffer value");break;case"texture":if(!(r instanceof Qd||r instanceof ag||r instanceof og))throw new Error("texture value");break;case"sampler":$e.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(s.type)}this.bindings[n]=r}}draw(t){const{renderPass:i,parameters:n=this.props.parameters,topology:r=this.props.topology,vertexArray:s,vertexCount:o,instanceCount:c,isInstanced:h=!1,firstVertex:A=0,transformFeedback:_}=t,C=Bq(r),S=!!s.indexBuffer,L=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return $e.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return $e.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(i),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const N=i;return XK(this.device,n,N.glParameters,()=>{S&&h?this.device.gl.drawElementsInstanced(C,o||0,L,A,c||0):S?this.device.gl.drawElements(C,o||0,L,A):h?this.device.gl.drawArraysInstanced(C,A,o||0,c||0):this.device.gl.drawArrays(C,A,o||0),_&&_.end()}),s.unbindAfterRender(i),!0}setUniformsWebGL(t){const{bindings:i}=Eq(t);Object.keys(i).forEach(n=>{$e.warn(`Unsupported value "${JSON.stringify(i[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),$e.time(pP,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),$e.timeEnd(pP,`linkProgram for ${this.id}`)(),$e.level,!this.device.features.has("compilation-status-async-webgl")){const n=this._getLinkStatus();this._reportLinkStatus(n);return}$e.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),$e.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}async _reportLinkStatus(t){switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${i}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async n=>await new Promise(r=>setTimeout(r,n));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const i of this.shaderLayout.bindings)!this.bindings[i.name]&&!this.bindings[i.name.replace(/Uniforms$/,"")]&&($e.warn(`Binding ${i.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let i=0,n=0;for(const r of this.shaderLayout.bindings){const s=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${r.name} in ${this.id}`);switch(r.type){case"uniform":const{name:o}=r,c=t.getUniformBlockIndex(this.handle,o);if(c===4294967295)throw new Error(`Invalid uniform block name ${o}`);t.uniformBlockBinding(this.handle,n,c),s instanceof sg?t.bindBufferBase(35345,n,s.handle):t.bindBufferRange(35345,n,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),n+=1;break;case"texture":if(!(s instanceof Qd||s instanceof ag||s instanceof og))throw new Error("texture");let h;if(s instanceof Qd)h=s.texture;else if(s instanceof ag)h=s;else if(s instanceof og&&s.colorAttachments[0]instanceof Qd)$e.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=s.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+i),t.bindTexture(h.glTarget,h.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${r.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:i,location:n,type:r,textureUnit:s}=t,o=this.uniforms[i]??s;o!==void 0&&wq(this.device.gl,n,r,o)}}}function Iq(e,t){const i={...e,attributes:e.attributes.map(n=>({...n}))};for(const n of t?.attributes||[]){const r=i.attributes.find(s=>s.name===n.name);r?(r.type=n.type||r.type,r.stepMode=n.stepMode||r.stepMode):$e.warn(`shader layout attribute ${n.name} not present in shader`)}return i}class Mq extends SE{device;commands=[];constructor(t){super(t,{}),this.device=t}submitCommands(t=this.commands){for(const i of t)switch(i.name){case"copy-buffer-to-buffer":Pq(this.device,i.options);break;case"copy-buffer-to-texture":Rq(this.device,i.options);break;case"copy-texture-to-buffer":Dq(this.device,i.options);break;case"copy-texture-to-texture":Oq(this.device,i.options);break;default:throw new Error(i.name)}}}function Pq(e,t){const i=t.sourceBuffer,n=t.destinationBuffer;e.gl.bindBuffer(36662,i.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function Rq(e,t){throw new Error("Not implemented")}function Dq(e,t){const{sourceTexture:i,mipLevel:n=0,aspect:r="all",width:s=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:c=0,origin:h=[0,0],destinationBuffer:A,byteOffset:_=0,bytesPerRow:C,rowsPerImage:S}=t;if(r!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||c!==0||C||S)throw new Error("not implemented");const{framebuffer:L,destroyFramebuffer:N}=AP(i);let U;try{const H=A,j=s||L.width,tt=o||L.height,K=YM(L.colorAttachments[0].texture.props.format),Q=K.format,pt=K.type;e.gl.bindBuffer(35051,H.handle),U=e.gl.bindFramebuffer(36160,L.handle),e.gl.readPixels(h[0],h[1],j,tt,Q,pt,_)}finally{e.gl.bindBuffer(35051,null),U!==void 0&&e.gl.bindFramebuffer(36160,U),N&&L.destroy()}}function Oq(e,t){const{sourceTexture:i,destinationMipLevel:n=0,origin:r=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=t;let{width:c=t.destinationTexture.width,height:h=t.destinationTexture.height}=t;const{framebuffer:A,destroyFramebuffer:_}=AP(i),[C,S]=r,[L,N,U]=s,H=e.gl.bindFramebuffer(36160,A.handle);let j=null,tt;if(o instanceof ag)j=o,c=Number.isFinite(c)?c:j.width,h=Number.isFinite(h)?h:j.height,j.bind(0),tt=j.glTarget;else throw new Error("invalid destination");switch(tt){case 3553:case 34067:e.gl.copyTexSubImage2D(tt,n,L,N,C,S,c,h);break;case 35866:case 32879:e.gl.copyTexSubImage3D(tt,n,L,N,U,C,S,c,h);break}j&&j.unbind(),e.gl.bindFramebuffer(36160,H),_&&A.destroy()}function AP(e){if(e instanceof cr){const{width:t,height:i,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:i,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class Lq extends TE{device;commandBuffer;constructor(t,i){super(t,i),this.device=t,this.commandBuffer=new Mq(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,i,n){}}function Fq(e){const{target:t,source:i,start:n=0,count:r=1}=e,s=i.length,o=r*s;let c=0;for(let h=n;c<s;c++)t[h++]=i[c];for(;c<o;)c<o-c?(t.copyWithin(n+c,n,n+c),c*=2):(t.copyWithin(n+c,n,n+o-c),c=o);return e.target}class NE extends IE{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return KG()==="Chrome"}constructor(t,i){super(t,i),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const i=t;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(t,i){const n=i;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:r,type:s,stride:o,offset:c,normalized:h,integer:A,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),A?this.device.gl.vertexAttribIPointer(t,r,s,o,c):this.device.gl.vertexAttribPointer(t,r,s,h,o,c),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,i){this._enable(t,!1),this.attributes[t]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const i=this.attributes[t];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(t,i)}}_getAccessor(t){const i=this.attributeInfos[t];if(!i)throw new Error(`Unknown attribute location ${t}`);const n=KM(i.bufferDataType);return{size:i.bufferComponents,type:n,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(t,i=!0){const n=NE.isConstantAttributeZeroSupported(this.device)||t!==0;(i||n)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,i){const n=kq(i),r=n.byteLength*t,s=n.length*t;if(this.buffer&&r!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${r} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),o=o||!Nq(n,this.bufferValue),o){const c=Nj(i.constructor,s);Fq({target:c,source:n,start:0,count:s}),this.buffer.write(c),this.bufferValue=i}return this.buffer}}function kq(e){return Array.isArray(e)?new Float32Array(e):e}function Nq(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}class Uq extends ME{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,i){super(t,i),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(Tq(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in t)this.setBuffer(i,t[i])})}setBuffer(t,i){const n=this._getVaryingIndex(t),{buffer:r,byteLength:s,byteOffset:o}=this._getBufferRange(i);if(n<0){this.unusedBuffers[t]=r,$e.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:r,byteLength:s,byteOffset:o},this.bindOnUse||this._bindBuffer(n,r,o,s)}getBuffer(t){if(gP(t))return this.buffers[t]||null;const i=this._getVaryingIndex(t);return i>=0?this.buffers[i]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let i;return this._bound?i=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof sg)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:i,byteOffset:n=0,byteLength:r=t.buffer.byteLength}=t;return{buffer:i,byteOffset:n,byteLength:r}}_getVaryingIndex(t){if(gP(t))return Number(t);for(const i of this.layout.varyings)if(t===i.name)return i.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:i,byteLength:n,byteOffset:r}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),i,r,n)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,i,n=0,r){const s=i&&i.handle;!s||r===void 0?this.gl.bindBufferBase(35982,t,s):this.gl.bindBufferRange(35982,t,s,n,r)}}function gP(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}class zq extends PE{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,i){if(super(t,i),this.device=t,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((n,r)=>{const s=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):i++>t?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}class Kd extends dh{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(t){super({...t,id:t.id||jK("webgl-device")});const i=dh._getCanvasContextProps(t);if(!i)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let n=i.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new PK(this,i),this.lost=new Promise(h=>{this._resolveContextLost=h});const r={...t.webgl};i.alphaMode==="premultiplied"&&(r.premultipliedAlpha=!0),t.powerPreference!==void 0&&(r.powerPreference=t.powerPreference);const s=this.props._handle||hK(this.canvasContext.canvas,{onContextLost:h=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:h=>console.log("WebGL context restored")},r);if(!s)throw new Error("WebGL context creation failed");if(n=s.device,n){if(t._reuseDevices)return $e.log(1,`Not creating a new Device, instead returning a reference to Device ${n.id} already attached to WebGL context`,n)(),n._reused=!0,n;throw new Error(`WebGL context already attached to device ${n.id}`)}this.handle=s,this.gl=s,this.spectorJS=OK({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=fK(this.gl,this._extensions),this.limits=new SK(this.gl),this.features=new TK(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),i.autoResize!==!1&&this.canvasContext.resize(),new Zh(this.gl,{log:(...h)=>$e.log(1,...h)()}).trackState(this.gl,{copyState:!1});const o=t.debugWebGL||t.debug,c=t.debugWebGL;o&&(this.gl=kK(this.gl,{debugWebGL:o,traceWebGL:c}),$e.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&($e.level=Math.max($e.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const i=this._normalizeBufferProps(t);return new sg(this,i)}createTexture(t){return new ag(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Lb(this,t)}createShader(t){return new JK(this,t)}createFramebuffer(t){return new og(this,t)}createVertexArray(t){return new NE(this,t)}createTransformFeedback(t){return new Uq(this,t)}createQuerySet(t){return new zq(this,t)}createRenderPipeline(t){return new Sq(this,t)}beginRenderPass(t){return new hq(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(t={}){return new Lq(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,i){return sq(t,i)}readPixelsToBufferWebGL(t,i){return aq(t,i)}setParametersWebGL(t){Hd(this.gl,t)}getParametersWebGL(t){return JM(this.gl,t)}withParametersWebGL(t,i){return L0(this.gl,t,i)}resetWebGL(){$e.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),sK(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return wK(this.gl,t,this._extensions)}loseDevice(){let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Zh.get(this.gl).push()}popState(){Zh.get(this.gl).pop()}setSpectorMetadata(t,i){t.__SPECTOR_Metadata=i}getGLKey(t,i){const n=Number(t);for(const r in this.gl)if(this.gl[r]===n)return`GL.${r}`;return i?.emptyIfUnknown?"":String(t)}getGLKeys(t){const i={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[r,s])=>(n[`${r}:${this.getGLKey(r,i)}`]=`${s}:${this.getGLKey(s,i)}`,n),{})}_constants;setConstantAttributeWebGL(t,i){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const r=this._constants[t];switch(r&&Hq(r,i)&&$e.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=i,i.constructor){case Float32Array:Gq(this,t,i);break;case Int32Array:jq(this,t,i);break;case Uint32Array:Vq(this,t,i);break;default:throw new Error("constant")}}getExtension(t){return Wd(this.gl,t,this._extensions),this._extensions}}function Gq(e,t,i){switch(i.length){case 1:e.gl.vertexAttrib1fv(t,i);break;case 2:e.gl.vertexAttrib2fv(t,i);break;case 3:e.gl.vertexAttrib3fv(t,i);break;case 4:e.gl.vertexAttrib4fv(t,i);break}}function jq(e,t,i){e.gl.vertexAttribI4iv(t,i)}function Vq(e,t,i){e.gl.vertexAttribI4uiv(t,i)}function Hq(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}const Wq={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Jq=e=>({drawBuffersWEBGL(t){return e.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Xq=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return e.createVertexArray()},deleteVertexArrayOES(t){return e.deleteVertexArray(t)},isVertexArrayOES(t){return e.isVertexArray(t)},bindVertexArrayOES(t){return e.bindVertexArray(t)}}),Qq=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return e.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return e.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return e.vertexAttribDivisor(...t)}});function Kq(e=!0){const t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(i,n){if(i==="webgl"||i==="experimental-webgl"){const r=this.originalGetContext("webgl2",n);return r instanceof HTMLElement&&qq(r),r}return this.originalGetContext(i,n)}}function qq(e){e.getExtension("EXT_color_buffer_float");const t={...Wq,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Jq(e),OES_vertex_array_object:Xq(e),ANGLE_instanced_arrays:Qq(e)},i=e.getExtension;e.getExtension=function(r){return i.call(e,r)||(r in t?t[r]:null)};const n=e.getSupportedExtensions;e.getSupportedExtensions=function(){return(n.apply(e)||[])?.concat(Object.keys(t))}}const F0=1;class Zq extends pj{type="webgl";constructor(){super(),dh.defaultProps={...dh.defaultProps,...Ib},Kd.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){Kq(t)}async attach(t){if(t instanceof Kd)return t;if(t?.device instanceof dh)return t.device;if(!Yq(t))throw new Error("Invalid WebGL2RenderingContext");return new Kd({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){$e.groupCollapsed(F0,"WebGLDevice created")();const i=[];(t.debugWebGL||t.debug)&&i.push(FK()),t.debugSpectorJS&&i.push(DK(t));const n=await Promise.allSettled(i);for(const o of n)o.status==="rejected"&&$e.error(`Failed to initialize debug libraries ${o.reason}`)();const r=new Kd(t),s=`${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: ${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return $e.probe(F0,s)(),$e.table(F0,r.info)(),$e.groupEnd(F0)(),r}}function Yq(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&Number.isFinite(e._version))}const mP=new Zq;function Qu(){}const $q=({isDragging:e})=>e?"grabbing":"grab",yP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Qu,onWebGLInitialized:Qu,onResize:Qu,onViewStateChange:Qu,onInteractionStateChange:Qu,onBeforeRender:Qu,onAfterRender:Qu,onLoad:Qu,onError:e=>Zi.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:$q,getTooltip:null,debug:!1,drawPickingColors:!1};class Fb{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new OM({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const s=n.offsetCenter;if(!s)return;r.x=s.x,r.y=s.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n},this._onEvent=n=>{const r=ab[n.type],s=n.offsetCenter;if(!r||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:h}=c,A=h&&(h[r]||h.props[r]),_=this.props[r];let C=!1;A&&(C=A.call(h,c,n)),C||(_?.(c,n),this.widgetManager.onEvent(c,n))},this._onPointerDown=n=>{if(this.device?.type==="webgpu")return;const r=n.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...yP,...t},t=this.props,t.viewState&&t.initialViewState&&Zi.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let i=this.device;!i&&t.gl&&(t.gl instanceof WebGLRenderingContext&&Zi.error("WebGL1 context not supported.")(),i=mP.attach(t.gl)),i||(i=E1.createDevice({type:"best-available",_reuseDevices:!0,adapters:[mP],...t.deviceProps,createCanvasContext:{canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(i,t),this.setProps(t),t._typedArrayManagerProps&&kd.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&Zi.removed("onLayerHover","onHover")(),"onLayerClick"in t&&Zi.removed("onLayerClick","onClick")(),t.initialViewState&&!Yr(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);const i=Object.create(this.props);Object.assign(i,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(i),this.layerManager&&(this.viewManager.setProps(i),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(i),this.effectManager.setProps(i),this.deckRenderer.setProps(i),this.deckPicker.setProps(i),this.widgetManager.setProps(i)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let i=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);const n=this.viewManager.needsRedraw(t),r=this.layerManager.needsRedraw(t),s=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return i=i||n||r||s||o,i}redraw(t){if(!this.layerManager)return;let i=this.needsRedraw({clearRedrawFlags:!0});i=t||i,i&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(i):this._drawLayers(i))}get isInitialized(){return this.viewManager!==null}getViews(){return $o(this.viewManager),this.viewManager.views}getViewports(t){return $o(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){const i=this._pick("pickObject","pickObject Time",t).result;return i.length?i[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,i=!1){for(const n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:i})}_removeResources(t){for(const i of t)this.layerManager.resourceManager.remove(i)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,i,n){$o(this.deckPicker);const{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(i).timeStart();const s=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return r.get(i).timeEnd(),s}_createCanvas(t){let i=t.canvas;return typeof i=="string"&&(i=document.getElementById(i),$o(i)),i||(i=document.createElement("canvas"),i.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(i)),Object.assign(i.style,t.style),i}_setCanvasSize(t){if(!this.canvas)return;const{width:i,height:n}=t;if(i||i===0){const r=Number.isFinite(i)?`${i}px`:i;this.canvas.style.width=r}if(n||n===0){const r=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=r}}_updateCanvasSize(){const{canvas:t}=this;if(!t)return;const i=t.clientWidth??t.width,n=t.clientHeight??t.height;(i!==this.width||n!==this.height)&&(this.width=i,this.height=n,this.viewManager?.setProps({width:i,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:n}))}_createAnimationLoop(t,i){const{gl:n,onError:r,useDevicePixels:s}=i;return new LX({device:t,useDevicePixels:s,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:r})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:t}=this.props,i=Array.isArray(t)?t:t?[t]:[new NM({id:"default-view"})];return i.length&&this.props.controller&&(i[0].props.controller=this.props.controller),i}_onContextLost(){const{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:t}=this;if(t.event){const{result:i,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=i.length>0;let r=n,s=!1;for(const o of i)r=o,s=o.layer?.onHover(o,t.event)||s;s||(this.props.onHover?.(r,t.event),this.widgetManager.onHover(r,t.event)),t.event=null}}_updateCursor(){const t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const i=new vM;i.play(),this.animationLoop.attachTimeline(i),this.eventManager=new hJ(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(KI).map(r=>{const[s,o,c,h]=KI[r],A=this.props.eventRecognizerOptions?.[r],_={...o,...A,event:r};return{recognizer:new s(_),recognizeWith:c,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const r in ab)this.eventManager.on(r,this._onEvent);this.viewManager=new BQ({timeline:i,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const n=this.viewManager.getViewports()[0];this.layerManager=new EQ(this.device,{deck:this,stats:this.stats,viewport:n,timeline:i}),this.effectManager=new jQ({deck:this,device:this.device}),this.deckRenderer=new WQ(this.device),this.deckPicker=new ZQ(this.device),this.widgetManager=new tK({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new iK),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,i){const{device:n,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:r});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...i};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:n,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Zi.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){const i=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:i},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){const{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();const i=this.animationLoop.stats;t.get("GPU Time").addTime(i.get("GPU Time").lastTiming),t.get("CPU Time").addTime(i.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:t,stats:i}=this;t.fps=i.get("frameRate").getHz(),t.setPropsTime=i.get("setProps Time").time,t.updateAttributesTime=i.get("Update Attributes").time,t.framesRedrawn=i.get("Redraw Count").count,t.pickTime=i.get("pickObject Time").time+i.get("pickMultipleObjects Time").time+i.get("pickObjects Time").time,t.pickCount=i.get("Pick Count").count,t.gpuTime=i.get("GPU Time").time,t.cpuTime=i.get("CPU Time").time,t.gpuTimePerFrame=i.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=i.get("CPU Time").getAverageTime();const n=E1.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}}Fb.defaultProps=yP,Fb.VERSION=u7;function tZ(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return AS(e)}}const eZ=pS;function k0(e,t,i){const n=i==="webgpu"&&t.type==="uint8"?"unorm8":t.type;return{attribute:e,format:t.size>1?`${n}x${t.size}`:t.type,byteOffset:t.offset||0}}function $h(e){return e.stride||e.size*e.bytesPerElement}function iZ(e,t){return e.type===t.type&&e.size===t.size&&$h(e)===$h(t)&&(e.offset||0)===(t.offset||0)}function kb(e,t){t.offset&&Zi.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const i=$h(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,r=t.elementOffset||0,s=n*i+r*e.bytesPerElement+(e.offset||0);return{...t,offset:s,stride:i}}function nZ(e,t){const i=kb(e,t);return{high:i,low:{...i,offset:i.offset+e.size*4}}}class rZ{constructor(t,i,n){this._buffer=null,this.device=t,this.id=i.id||"",this.size=i.size||1;const r=i.logicalType||i.type,s=r==="float64";let{defaultValue:o}=i;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let c;s?c="float32":!r&&i.isIndexed?c="uint32":c=r||"float32";let h=tZ(r||c);this.doublePrecision=s,s&&i.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...i,defaultType:h,defaultValue:o,logicalType:r,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const t=this.getAccessor();return t.vertexOffset?t.vertexOffset*$h(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),kd.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,i=null){const n={};if(this.state.constant){const r=this.value;if(i){const s=kb(this.getAccessor(),i),o=s.offset/r.BYTES_PER_ELEMENT,c=s.size||this.size;n[t]=r.subarray(o,o+c)}else n[t]=r}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,i=null){const n=this.getAccessor(),r=[],s={name:this.id,byteStride:$h(n),attributes:r};if(this.doublePrecision){const o=nZ(n,i||{});r.push(k0(t,{...n,...o.high},this.device.type),k0(`${t}64Low`,{...n,...o.low},this.device.type))}else if(i){const o=kb(n,i);r.push(k0(t,{...n,...o},this.device.type))}else r.push(k0(t,n,this.device.type));return s}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){const i=Array.from(this.value);t=[i,i]}else{const{value:i,numInstances:n,size:r}=this,s=n*r;if(i&&s&&i.length>=s){const o=new Array(r).fill(1/0),c=new Array(r).fill(-1/0);for(let h=0;h<s;)for(let A=0;A<r;A++){const _=i[h++];_<o[A]&&(o[A]=_),_>c[A]&&(c[A]=_)}t=[o,c]}}return this.state.bounds=t,t}setData(t){const{state:i}=this;let n;ArrayBuffer.isView(t)?n={value:t}:t instanceof Cr?n={buffer:t}:n=t;const r={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)r.type="float32";else{const s=eZ(n.value);r.type=r.normalized?s.replace("int","norm"):s}r.bytesPerElement=n.value.BYTES_PER_ELEMENT,r.stride=$h(r)}if(i.bounds=null,n.constant){let s=n.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!i.constant||!this._areValuesEqual(s,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(n.buffer){const s=n.buffer;i.externalBuffer=s,i.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let s=n.value;i.externalBuffer=null,i.constant=!1,this.value=s;let{buffer:o}=this;const c=$h(r),h=(r.vertexOffset||0)*c;if(this.doublePrecision&&s instanceof Float64Array&&(s=Ab(s,r)),this.settings.isIndexed){const _=this.settings.defaultType;s.constructor!==_&&(s=new _(s))}const A=s.byteLength+h+c*2;(!o||o.byteLength<A)&&(o=this._createBuffer(A)),o.write(s,h)}return this.setAccessor(r),!0}updateSubBuffer(t={}){this.state.bounds=null;const i=this.value,{startOffset:n=0,endOffset:r}=t;this.buffer.write(this.doublePrecision&&i instanceof Float64Array?Ab(i,{size:this.size,startIndex:n,endIndex:r}):i.subarray(n,r),n*i.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,i=!1){const{state:n}=this,r=n.allocatedValue,s=kd.allocate(r,t+1,{size:this.size,type:this.settings.defaultType,copy:i});this.value=s;const{byteOffset:o}=this;let{buffer:c}=this;return(!c||c.byteLength<s.byteLength+o)&&(c=this._createBuffer(s.byteLength+o),i&&r&&c.write(r instanceof Float64Array?Ab(r,this):r,o)),n.allocatedValue=s,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){const{value:i}=t;if(!ArrayBuffer.isView(i))throw new Error(`Attribute ${this.id} value is not TypedArray`);const n=this.settings.defaultType;let r=!1;if(this.doublePrecision&&(r=i.BYTES_PER_ELEMENT<4),r)throw new Error(`Attribute ${this.id} does not support ${i.constructor.name}`);!(i instanceof n)&&this.settings.normalized&&!("normalized"in t)&&Zi.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(i=>(i+128)/255*2-1);case"snorm16":return new Float32Array(t).map(i=>(i+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(i=>i/255);case"unorm16":return new Float32Array(t).map(i=>i/65535);default:return t}}_normalizeValue(t,i,n){const{defaultValue:r,size:s}=this.settings;if(Number.isFinite(t))return i[n]=t,i;if(!t){let o=s;for(;--o>=0;)i[n+o]=r[o];return i}switch(s){case 4:i[n+3]=Number.isFinite(t[3])?t[3]:r[3];case 3:i[n+2]=Number.isFinite(t[2])?t[2]:r[2];case 2:i[n+1]=Number.isFinite(t[1])?t[1]:r[1];case 1:i[n+0]=Number.isFinite(t[0])?t[0]:r[0];break;default:let o=s;for(;--o>=0;)i[n+o]=Number.isFinite(t[o])?t[o]:r[o]}return i}_areValuesEqual(t,i){if(!t||!i)return!1;const{size:n}=this;for(let r=0;r<n;r++)if(t[r]!==i[r])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();const{isIndexed:i,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(i?Cr.INDEX:Cr.VERTEX)|Cr.COPY_DST,indexType:i?n:void 0,byteLength:t}),this._buffer}}const vP=[],_P=[];function sl(e,t=0,i=1/0){let n=vP;const r={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&(_P.length=e.length,n=_P):n=vP,(t>0||Number.isFinite(i))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,i),r.index=t-1),{iterable:n,objectInfo:r}}function bP(e){return e&&e[Symbol.asyncIterator]}function xP(e,t){const{size:i,stride:n,offset:r,startIndices:s,nested:o}=t,c=e.BYTES_PER_ELEMENT,h=n?n/c:i,A=r?r/c:0,_=Math.floor((e.length-A)/h);return(C,{index:S,target:L})=>{if(!s){const j=S*h+A;for(let tt=0;tt<i;tt++)L[tt]=e[j+tt];return L}const N=s[S],U=s[S+1]||_;let H;if(o){H=new Array(U-N);for(let j=N;j<U;j++){const tt=j*h+A;L=new Array(i);for(let K=0;K<i;K++)L[K]=e[tt+K];H[j-N]=L}}else if(h===i)H=e.subarray(N*i+A,U*i+A);else{H=new e.constructor((U-N)*i);let j=0;for(let tt=N;tt<U;tt++){const K=tt*h+A;for(let Q=0;Q<i;Q++)H[j++]=e[K+Q]}}return H}}const oZ=[],N0=[[0,1/0]];function sZ(e,t){if(e===N0||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;const i=[],n=e.length;let r=0;for(let s=0;s<n;s++){const o=e[s];o[1]<t[0]?(i.push(o),r=s+1):o[0]>t[1]?i.push(o):t=[Math.min(o[0],t[0]),Math.max(o[1],t[1])]}return i.splice(r,0,t),i}const aZ={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function wP(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});const i=e.type||"interpolation";return{...aZ[i],...t,...e,type:i}}class CP extends rZ{constructor(t,i){super(t,i,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:N0}),this.constant=!1,this.settings.update=i.update||(i.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){const i=this.state.needsRedraw;return this.state.needsRedraw=i&&!t,i}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var i;(i=this.state).layoutChanged||(i.layoutChanged=!iZ(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){const{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;const{accessor:i}=this.settings,n=this.settings.transition,r=Array.isArray(i)?t[i.find(s=>t[s])]:t[i];return wP(r,n)}setNeedsUpdate(t=this.id,i){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),i){const{startRow:n=0,endRow:r=1/0}=i;this.state.updateRanges=sZ(this.state.updateRanges,[n,r])}else this.state.updateRanges=N0}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=oZ}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){const{state:i,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,i.updateRanges!==N0),!0):!1}updateBuffer({numInstances:t,data:i,props:n,context:r}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:c}}=this;let h=!0;if(o){for(const[A,_]of s)o.call(r,this,{data:i,startRow:A,endRow:_,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[A,_]of s){const C=Number.isFinite(A)?this.getVertexOffset(A):0,S=Number.isFinite(_)?this.getVertexOffset(_):c||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:C,endOffset:S})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(t){return this.device.type==="webgpu"||t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){const{state:i}=this;return t?(this.clearNeedsUpdate(),i.lastExternalBuffer===t||(i.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(i.lastExternalBuffer=null,!1)}setBinaryValue(t,i=null){const{state:n,settings:r}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),r.transform||i!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});const s=t;$o(ArrayBuffer.isView(s.value),`invalid ${r.accessor}`);const o=!!s.size&&s.size!==this.size;return n.binaryAccessor=xP(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:i,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){const{startIndices:i}=this;return(i?t<i.length?i[t]:this.numInstances:t)*this.size}getValue(){const t=this.settings.shaderAttributes,i=super.getValue();if(!t)return i;for(const n in t)Object.assign(i,super.getValue(n,t[n]));return i}getBufferLayout(t){this.state.layoutChanged=!1;const i=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:r}=this.settings;if(r==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=r??"vertex",!i)return n;for(const s in i){const o=super._getBufferLayout(s,i[s]);n.attributes.push(...o.attributes)}return n}_autoUpdater(t,{data:i,startRow:n,endRow:r,props:s,numInstances:o}){if(t.constant&&this.context.device.type!=="webgpu")return;const{settings:c,state:h,value:A,size:_,startIndices:C}=t,{accessor:S,transform:L}=c;let N=h.binaryAccessor||(typeof S=="function"?S:s[S]);typeof N!="function"&&(N=()=>N),$o(typeof N=="function",`accessor "${S}" is not a function`);let U=t.getVertexOffset(n);const{iterable:H,objectInfo:j}=sl(i,n,r);for(const tt of H){j.index++;let K=N(tt,j);if(L&&(K=L.call(this,K)),C){const Q=(j.index<C.length-1?C[j.index+1]:o)-C[j.index];if(K&&Array.isArray(K[0])){let pt=U;for(const $ of K)t._normalizeValue($,A,pt),pt+=_}else K&&K.length>_?A.set(K,U):(t._normalizeValue(K,j.target,0),_Q({target:A,source:j.target,start:U,count:Q}));U+=Q*_}else t._normalizeValue(K,A,U),U+=_}}_validateAttributeUpdaters(){const{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:t}=this,i=Math.min(4,this.size);if(t&&t.length>=i){let n=!0;switch(i){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Nb(e){const{source:t,target:i,start:n=0,size:r,getData:s}=e,o=e.end||i.length,c=t.length,h=o-n;if(c>h){i.set(t.subarray(0,h),n);return}if(i.set(t,n),!s)return;let A=c;for(;A<h;){const _=s(A,t);for(let C=0;C<r;C++)i[n+A]=_[C]||0,A++}}function cZ({source:e,target:t,size:i,getData:n,sourceStartIndices:r,targetStartIndices:s}){if(!r||!s)return Nb({source:e,target:t,size:i,getData:n}),t;let o=0,c=0;const h=n&&((_,C)=>n(_+c,C)),A=Math.min(r.length,s.length);for(let _=1;_<A;_++){const C=r[_]*i,S=s[_]*i;Nb({source:e.subarray(o,C),target:t,start:c,end:S,size:i,getData:h}),o=C,c=S}return c<t.length&&Nb({source:[],target:t,start:c,size:i,getData:h}),t}function lZ(e){const{device:t,settings:i,value:n}=e,r=new CP(t,i);return r.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),r}function EP(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function BP(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function TP(e){e.push(e.shift())}function uZ(e,t){const{doublePrecision:i,settings:n,value:r,size:s}=e,o=i&&r instanceof Float64Array?2:1;let c=0;const{shaderAttributes:h}=e.settings;if(h)for(const A of Object.values(h))c=Math.max(c,A.vertexOffset??0);return(n.noAlloc?r.length:(t+c)*s)*o}function SP({device:e,source:t,target:i}){return(!i||i.byteLength<t.byteLength)&&(i?.destroy(),i=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),i}function IP({device:e,buffer:t,attribute:i,fromLength:n,toLength:r,fromStartIndices:s,getData:o=c=>c}){const c=i.doublePrecision&&i.value instanceof Float64Array?2:1,h=i.size*c,A=i.byteOffset,_=i.settings.bytesPerElement<4?A/i.settings.bytesPerElement*4:A,C=i.startIndices,S=s&&C,L=i.isConstant;if(!S&&t&&n>=r)return t;const N=i.value instanceof Float64Array?Float32Array:i.value.constructor,U=L?i.value:new N(i.getBuffer().readSyncWebGL(A,r*N.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!L){const K=o;o=(Q,pt)=>i.normalizeConstant(K(Q,pt))}const H=L?(K,Q)=>o(U,Q):(K,Q)=>o(U.subarray(K+A,K+A+h),Q),j=t?new Float32Array(t.readSyncWebGL(_,n*4).buffer):new Float32Array(0),tt=new Float32Array(r);return cZ({source:j,target:tt,sourceStartIndices:s,targetStartIndices:C,size:h,getData:H}),(!t||t.byteLength<tt.byteLength+_)&&(t?.destroy(),t=e.createBuffer({byteLength:tt.byteLength+_,usage:35050})),t.write(tt,_),t}class MP{constructor({device:t,attribute:i,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new R0(n),this.attribute=i,this.attributeInTransition=lZ(i),this.currentStartIndices=i.startIndices}get inProgress(){return this.transition.inProgress}start(t,i,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=uZ(this.attribute,i),this.transition.start({...t,duration:n})}update(){const t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const t of this.buffers)t.destroy();this.buffers.length=0}}class hZ extends MP{constructor({device:t,attribute:i,timeline:n}){super({device:t,attribute:i,timeline:n}),this.type="interpolation",this.transform=AZ(t,i)}start(t,i){const n=this.currentLength,r=this.currentStartIndices;if(super.start(t,i,t.duration),t.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;TP(s),s[0]=IP({device:this.device,buffer:s[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:t.enter}),s[1]=SP({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:c}=this,h=c.model;let A=Math.floor(this.currentLength/o.size);RP(o)&&(A/=2),h.setVertexCount(A),o.isConstant?(h.setAttributes({aFrom:s[0]}),h.setConstantAttributes({aTo:o.value})):h.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:t,easing:i}=this.settings,{time:n}=this.transition;let r=n/t;i&&(r=i(r));const{model:s}=this.transform,o={time:r};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const fZ=`uniform interpolationUniforms {
  float time;
} interpolation;
`,PP={name:"interpolation",vs:fZ,uniformTypes:{time:"f32"}},dZ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,pZ=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function RP(e){return e.doublePrecision&&e.value instanceof Float64Array}function AZ(e,t){const i=t.size,n=EP(i),r=BP(i),s=t.getBufferLayout();return RP(t)?new Mf(e,{vs:pZ,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:r,byteOffset:0},{attribute:"aFrom64Low",format:r,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:r,byteOffset:0},{attribute:"aTo64Low",format:r,byteOffset:4*i}]}],modules:[eW,PP],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Mf(e,{vs:dZ,bufferLayout:[{name:"aFrom",format:r},{name:"aTo",format:s.attributes[0].format}],modules:[PP],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}class gZ extends MP{constructor({device:t,attribute:i,timeline:n}){super({device:t,attribute:i,timeline:n}),this.type="spring",this.texture=xZ(t),this.framebuffer=wZ(t,this.texture),this.transform=bZ(t,i)}start(t,i){const n=this.currentLength,r=this.currentStartIndices;super.start(t,i);const{buffers:s,attribute:o}=this;for(let h=0;h<2;h++)s[h]=IP({device:this.device,buffer:s[h],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:r,getData:t.enter});s[2]=SP({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?c.setConstantAttributes({aTo:o.value}):c.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:t,transform:i,framebuffer:n,transition:r}=this,s=this.settings;i.model.setAttributes({aPrev:t[0],aCur:t[1]}),i.transformFeedback.setBuffers({vNext:t[2]});const o={stiffness:s.stiffness,damping:s.damping};i.model.shaderInputs.setProps({spring:o}),i.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),TP(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const mZ=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,yZ={name:"spring",vs:mZ,uniformTypes:{damping:"f32",stiffness:"f32"}},vZ=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,_Z=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function bZ(e,t){const i=EP(t.size),n=BP(t.size);return new Mf(e,{vs:vZ,fs:_Z,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[yZ],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function xZ(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function wZ(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}const CZ={interpolation:hZ,spring:gZ};class EZ{constructor(t,{id:i,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=i,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:i,numInstances:n}){this.numInstances=n||1;for(const r in t){const s=t[r],o=s.getTransitionSetting(i);o&&this._updateAttribute(r,s,o)}for(const r in this.transitions){const s=t[r];(!s||!s.getTransitionSetting(i))&&this._removeTransition(r)}}hasAttribute(t){const i=this.transitions[t];return i&&i.inProgress}getAttributes(){const t={};for(const i in this.transitions){const n=this.transitions[i];n.inProgress&&(t[i]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(const i in this.transitions)this.transitions[i].update()&&(this.needsRedraw=!0);const t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,i,n){const r=this.transitions[t];let s=!r||r.type!==n.type;if(s){r&&this._removeTransition(t);const o=CZ[n.type];o?this.transitions[t]=new o({attribute:i,timeline:this.timeline,device:this.device}):(Zi.error(`unsupported transition type '${n.type}'`)(),s=!1)}(s||i.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}}const DP="attributeManager.invalidate",BZ="attributeManager.updateStart",TZ="attributeManager.updateEnd",SZ="attribute.updateStart",IZ="attribute.allocate",MZ="attribute.updateEnd";class U0{constructor(t,{id:i="attribute-manager",stats:n,timeline:r}={}){this.mergeBoundsMemoized=ZA(bX),this.id=i,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new EZ(t,{id:`${i}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(const t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){const i=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,i&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(const i of t)this.attributes[i]!==void 0&&(this.attributes[i].delete(),delete this.attributes[i])}invalidate(t,i){const n=this._invalidateTrigger(t,i);fs(DP,this,t,n)}invalidateAll(t){for(const i in this.attributes)this.attributes[i].setNeedsUpdate(i,t);fs(DP,this,"all")}update({data:t,numInstances:i,startIndices:n=null,transitions:r,props:s={},buffers:o={},context:c={}}){let h=!1;fs(BZ,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const A in this.attributes){const _=this.attributes[A],C=_.settings.accessor;_.startIndices=n,_.numInstances=i,s[A]&&Zi.removed(`props.${A}`,`data.attributes.${A}`)(),_.setExternalBuffer(o[A])||_.setBinaryValue(typeof C=="string"?o[C]:void 0,t.startIndices)||typeof C=="string"&&!o[C]&&_.setConstantValue(s[C])||_.needsUpdate()&&(h=!0,this._updateAttribute({attribute:_,numInstances:i,data:t,props:s,context:c})),this.needsRedraw=this.needsRedraw||_.needsRedraw()}h&&fs(TZ,this,i),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:i,transitions:r})}updateTransition(){const{attributeTransitionManager:t}=this,i=t.run();return this.needsRedraw=this.needsRedraw||i,i}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){const i=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(i)}getChangedAttributes(t={clearChangedFlags:!1}){const{attributes:i,attributeTransitionManager:n}=this,r={...n.getAttributes()};for(const s in i){const o=i[s];o.needsRedraw(t)&&!n.hasAttribute(s)&&(r[s]=o)}return r}getBufferLayouts(t){return Object.values(this.getAttributes()).map(i=>i.getBufferLayout(t))}_add(t,i){for(const n in t){const r=t[n],s={...r,id:n,size:r.isIndexed&&1||r.size||1,...i};this.attributes[n]=new CP(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const t={};for(const i in this.attributes)this.attributes[i].getUpdateTriggers().forEach(n=>{t[n]||(t[n]=[]),t[n].push(i)});this.updateTriggers=t}_invalidateTrigger(t,i){const{attributes:n,updateTriggers:r}=this,s=r[t];return s&&s.forEach(o=>{const c=n[o];c&&c.setNeedsUpdate(c.id,i)}),s}_updateAttribute(t){const{attribute:i,numInstances:n}=t;if(fs(SZ,i),i.constant){i.setConstantValue(i.value);return}i.allocate(n)&&fs(IZ,i,n),i.updateBuffer(t)&&(this.needsRedraw=!0,fs(MZ,i,n))}}class PZ extends R0{get value(){return this._value}_onUpdate(){const{time:t,settings:{fromValue:i,toValue:n,duration:r,easing:s}}=this,o=s(t/r);this._value=hc(i,n,o)}}const OP=1e-5;function LP(e,t,i,n,r){const s=t-e,o=(i-t)*r,c=-s*n;return o+c+s+t}function RZ(e,t,i,n,r){if(Array.isArray(i)){const s=[];for(let o=0;o<i.length;o++)s[o]=LP(e[o],t[o],i[o],n,r);return s}return LP(e,t,i,n,r)}function FP(e,t){if(Array.isArray(e)){let i=0;for(let n=0;n<e.length;n++){const r=e[n]-t[n];i+=r*r}return Math.sqrt(i)}return Math.abs(e-t)}class DZ extends R0{get value(){return this._currValue}_onUpdate(){const{fromValue:t,toValue:i,damping:n,stiffness:r}=this.settings,{_prevValue:s=t,_currValue:o=t}=this;let c=RZ(s,o,i,n,r);const h=FP(c,i),A=FP(c,o);h<OP&&A<OP&&(c=i,this.end()),this._prevValue=o,this._currValue=c}}const OZ={interpolation:PZ,spring:DZ};class LZ{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,i,n,r){const{transitions:s}=this;if(s.has(t)){const h=s.get(t),{value:A=h.settings.fromValue}=h;i=A,this.remove(t)}if(r=wP(r),!r)return;const o=OZ[r.type];if(!o){Zi.error(`unsupported transition type '${r.type}'`)();return}const c=new o(this.timeline);c.start({...r,fromValue:i,toValue:n}),s.set(t,c)}remove(t){const{transitions:i}=this;i.has(t)&&(i.get(t).cancel(),i.delete(t))}update(){const t={};for(const[i,n]of this.transitions)n.update(),t[i]=n.value,n.inProgress||this.remove(i);return t}clear(){for(const t of this.transitions.keys())this.remove(t)}}function FZ(e){const t=e[Vu];for(const i in t){const n=t[i],{validate:r}=n;if(r&&!r(e[i],n))throw new Error(`Invalid prop ${i}: ${e[i]}`)}}function kZ(e,t){const i=Ub({newProps:e,oldProps:t,propTypes:e[Vu],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=UZ(e,t);let r=!1;return n||(r=zZ(e,t)),{dataChanged:n,propsChanged:i,updateTriggersChanged:r,extensionsChanged:GZ(e,t),transitionsChanged:NZ(e,t)}}function NZ(e,t){if(!e.transitions)return!1;const i={},n=e[Vu];let r=!1;for(const s in e.transitions){const o=n[s],c=o&&o.type;(c==="number"||c==="color"||c==="array")&&zb(e[s],t[s],o)&&(i[s]=!0,r=!0)}return r?i:!1}function Ub({newProps:e,oldProps:t,ignoreProps:i={},propTypes:n={},triggerName:r="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${r} changed shallowly`;if(typeof t!="object"||t===null)return`${r} changed shallowly`;for(const s of Object.keys(e))if(!(s in i)){if(!(s in t))return`${r}.${s} added`;const o=zb(e[s],t[s],n[s]);if(o)return`${r}.${s} ${o}`}for(const s of Object.keys(t))if(!(s in i)){if(!(s in e))return`${r}.${s} dropped`;if(!Object.hasOwnProperty.call(e,s)){const o=zb(e[s],t[s],n[s]);if(o)return`${r}.${s} ${o}`}}return!1}function zb(e,t,i){let n=i&&i.equal;return n&&!n(e,t,i)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function UZ(e,t){if(t===null)return"oldProps is null, initial diff";let i=!1;const{dataComparator:n,_dataDiff:r}=e;return n?n(e.data,t.data)||(i="Data comparator detected a change"):e.data!==t.data&&(i="A new data container was supplied"),i&&r&&(i=r(e.data,t.data)||i),i}function zZ(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&kP(e,t,"all"))return{all:!0};const i={};let n=!1;for(const r in e.updateTriggers)r!=="all"&&kP(e,t,r)&&(i[r]=!0,n=!0);return n?i:!1}function GZ(e,t){if(t===null)return!0;const i=t.extensions,{extensions:n}=e;if(n===i)return!1;if(!i||!n||n.length!==i.length)return!0;for(let r=0;r<n.length;r++)if(!n[r].equals(i[r]))return!0;return!1}function kP(e,t,i){let n=e.updateTriggers[i];n=n??{};let r=t.updateTriggers[i];return r=r??{},Ub({oldProps:r,newProps:n,triggerName:i})}const jZ="count(): argument not an object",VZ="count(): argument not a container";function HZ(e){if(!JZ(e))throw new Error(jZ);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(WZ(e))return Object.keys(e).length;throw new Error(VZ)}function WZ(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function JZ(e){return e!==null&&typeof e=="object"}function NP(e,t){if(!t)return e;const i={...e,...t};if("defines"in t&&(i.defines={...e.defines,...t.defines}),"modules"in t&&(i.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){const n=i.modules.findIndex(r=>r.name==="project32");n>=0&&i.modules.splice(n,1)}if("inject"in t)if(!e.inject)i.inject=t.inject;else{const n={...e.inject};for(const r in t.inject)n[r]=(n[r]||"")+t.inject[r];i.inject=n}return i}const XZ={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Gb={};function QZ(e,t,i,n){if(i instanceof cr)return i;i.constructor&&i.constructor.name!=="Object"&&(i={data:i});let r=null;i.compressed&&(r={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});const s=t.createTexture({...i,sampler:{...XZ,...r,...n},mipmaps:!0});return Gb[s.id]=e,s}function KZ(e,t){!t||!(t instanceof cr)||Gb[t.id]===e&&(t.delete(),delete Gb[t.id])}const qZ={boolean:{validate(e,t){return!0},equal(e,t,i){return!!e==!!t}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||jb(e)&&(e.length===3||e.length===4)},equal(e,t,i){return Yr(e,t,1)}},accessor:{validate(e,t){const i=z0(e);return i==="function"||i===z0(t.value)},equal(e,t,i){return typeof t=="function"?!0:Yr(e,t,1)}},array:{validate(e,t){return t.optional&&!e||jb(e)},equal(e,t,i){const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?Yr(e,t,r):e===t}},object:{equal(e,t,i){if(i.ignore)return!0;const{compare:n}=i,r=Number.isInteger(n)?n:n?1:0;return n?Yr(e,t,r):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,i){return!i.compare&&i.ignore!==!1||e===t}},data:{transform:(e,t,i)=>{if(!e)return e;const{dataTransform:n}=i.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,i)=>{const n=i.context;return!n||!n.device?null:QZ(i.id,n.device,e,{...t.parameters,...i.props.textureParameters})},release:(e,t,i)=>{KZ(i.id,e)}}};function ZZ(e){const t={},i={},n={};for(const[r,s]of Object.entries(e)){const o=s?.deprecatedFor;if(o)n[r]=Array.isArray(o)?o:[o];else{const c=YZ(r,s);t[r]=c,i[r]=c.value}}return{propTypes:t,defaultProps:i,deprecatedProps:n}}function YZ(e,t){switch(z0(t)){case"object":return cg(e,t);case"array":return cg(e,{type:"array",value:t,compare:!1});case"boolean":return cg(e,{type:"boolean",value:t});case"number":return cg(e,{type:"number",value:t});case"function":return cg(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function cg(e,t){return"type"in t?{name:e,...qZ[t.type],...t}:"value"in t?{name:e,type:z0(t.value),...t}:{name:e,type:"object",value:t}}function jb(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function z0(e){return jb(e)?"array":e===null?"null":typeof e}function $Z(e,t){let i;for(let s=t.length-1;s>=0;s--){const o=t[s];"extensions"in o&&(i=o.extensions)}const n=Vb(e.constructor,i),r=Object.create(n);r[M0]=e,r[Kh]={},r[Hu]={};for(let s=0;s<t.length;++s){const o=t[s];for(const c in o)r[c]=o[c]}return Object.freeze(r),r}const tY="_mergedDefaultProps";function Vb(e,t){if(!(e instanceof G0.constructor))return{};let i=tY;if(t)for(const r of t){const s=r.constructor;s&&(i+=`:${s.extensionName||s.name}`)}return UP(e,i)||(e[i]=eY(e,t||[]))}function eY(e,t){if(!e.prototype)return null;const i=Object.getPrototypeOf(e),n=Vb(i),r=UP(e,"defaultProps")||{},s=ZZ(r),o=Object.assign(Object.create(null),n,s.defaultProps),c=Object.assign(Object.create(null),n?.[Vu],s.propTypes),h=Object.assign(Object.create(null),n?.[wb],s.deprecatedProps);for(const A of t){const _=Vb(A.constructor);_&&(Object.assign(o,_),Object.assign(c,_[Vu]),Object.assign(h,_[wb]))}return iY(o,e),rY(o,c),nY(o,h),o[Vu]=c,o[wb]=h,t.length===0&&!Hb(e,"_propTypes")&&(e._propTypes=c),o}function iY(e,t){const i=sY(t);Object.defineProperties(e,{id:{writable:!0,value:i}})}function nY(e,t){for(const i in t)Object.defineProperty(e,i,{enumerable:!1,set(n){const r=`${this.id}: ${i}`;for(const s of t[i])Hb(this,s)||(this[s]=n);Zi.deprecated(r,t[i].join("/"))()}})}function rY(e,t){const i={},n={};for(const r in t){const s=t[r],{name:o,value:c}=s;s.async&&(i[o]=c,n[o]=oY(o))}e[zd]=i,e[Kh]={},Object.defineProperties(e,n)}function oY(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||bP(t)?this[Kh][e]=t:this[Hu][e]=t},get(){if(this[Hu]){if(e in this[Hu])return this[Hu][e]||this[zd][e];if(e in this[Kh]){const t=this[M0]&&this[M0].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[zd][e]}}return this[zd][e]}}}function Hb(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function UP(e,t){return Hb(e,t)&&e[t]}function sY(e){const t=e.componentName;return t||Zi.warn(`${e.name}.componentName not specified`)(),t||e.name}let aY=0;class G0{constructor(...t){this.props=$Z(this,t),this.id=this.props.id,this.count=aY++}clone(t){const{props:i}=this,n={};for(const r in i[zd])r in i[Hu]?n[r]=i[Hu][r]:r in i[Kh]&&(n[r]=i[Kh][r]);return new this.constructor({...i,...n,...t})}}G0.componentName="Component",G0.defaultProps={};const cY=Object.freeze({});class lY{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const t in this.asyncProps){const i=this.asyncProps[t];i&&i.type&&i.type.release&&i.type.release(i.resolvedValue,i.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||cY}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){const i=this.asyncProps[t];return i&&i.resolvedValue}isAsyncPropLoading(t){if(t){const i=this.asyncProps[t];return!!(i&&i.pendingLoadCount>0&&i.pendingLoadCount!==i.resolvedLoadCount)}for(const i in this.asyncProps)if(this.isAsyncPropLoading(i))return!0;return!1}reloadAsyncProp(t,i){this._watchPromise(t,Promise.resolve(i))}setAsyncProps(t){this.component=t[M0]||this.component;const i=t[Hu]||{},n=t[Kh]||t,r=t[zd]||{};for(const s in i){const o=i[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o),i[s]=this.getAsyncProp(s)}for(const s in n){const o=n[s];this._createAsyncPropData(s,r[s]),this._updateAsyncProp(s,o)}}_fetch(t,i){return null}_onResolve(t,i){}_onError(t,i){}_updateAsyncProp(t,i){if(this._didAsyncInputValueChange(t,i)){if(typeof i=="string"&&(i=this._fetch(t,i)),i instanceof Promise){this._watchPromise(t,i);return}if(bP(i)){this._resolveAsyncIterable(t,i);return}this._setPropValue(t,i)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,i){const n=this.asyncProps[t];return i===n.resolvedValue||i===n.lastValue?!1:(n.lastValue=i,!0)}_setPropValue(t,i){this._freezeAsyncOldProps();const n=this.asyncProps[t];n&&(i=this._postProcessValue(n,i),n.resolvedValue=i,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,i,n){const r=this.asyncProps[t];r&&n>=r.resolvedLoadCount&&i!==void 0&&(this._freezeAsyncOldProps(),r.resolvedValue=i,r.resolvedLoadCount=n,this.onAsyncPropUpdated(t,i))}_watchPromise(t,i){const n=this.asyncProps[t];if(n){n.pendingLoadCount++;const r=n.pendingLoadCount;i.then(s=>{this.component&&(s=this._postProcessValue(n,s),this._setAsyncPropValue(t,s,r),this._onResolve(t,s))}).catch(s=>{this._onError(t,s)})}}async _resolveAsyncIterable(t,i){if(t!=="data"){this._setPropValue(t,i);return}const n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;const r=n.pendingLoadCount;let s=[],o=0;for await(const c of i){if(!this.component)return;const{dataTransform:h}=this.component.props;h?s=h(c,s):s=s.concat(c),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(t,s,r)}this._onResolve(t,s)}_postProcessValue(t,i){const n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(i,n,this.component):i}_createAsyncPropData(t,i){if(!this.asyncProps[t]){const n=this.component&&this.component.props[Vu];this.asyncProps[t]={type:n&&n[t],lastValue:null,resolvedValue:i,pendingLoadCount:0,resolvedLoadCount:0}}}}class uY extends lY{constructor({attributeManager:t,layer:i}){super(i),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,i){const n=this.layer,r=n?.props.fetch;return r?r(i,{propName:t,layer:n}):super._fetch(t,i)}_onResolve(t,i){const n=this.layer;if(n){const r=n.props.onDataLoad;t==="data"&&r&&r(i,{propName:t,layer:n})}}_onError(t,i){const n=this.layer;n&&n.raiseError(i,`loading ${t} of ${this.layer}`)}}const hY="layer.changeFlag",fY="layer.initialize",dY="layer.update",pY="layer.finalize",AY="layer.matched",zP=2**24-1,gY=Object.freeze([]),mY=ZA(({oldViewport:e,viewport:t})=>e.equals(t));let Ac=new Uint8ClampedArray(0);const yY={data:{type:"data",value:gY,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:i,loaders:n,loadOptions:r,signal:s})=>{const{resourceManager:o}=i.context;r=r||i.getLoadOptions(),n=n||i.props.loaders,s&&(r={...r,fetch:{...r?.fetch,signal:s}});let c=o.contains(e);return!c&&!r&&(o.add({resourceId:e,data:s1(e,n),persistent:!1}),c=!0),c?o.subscribe({resourceId:e,onChange:h=>i.internalState?.reloadAsyncProp(t,h),consumerId:i.id,requestId:t}):s1(e,n,r)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:$i.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Bo extends G0{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Ud.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){$o(this.internalState);const i=this.internalState.viewport||this.context.viewport,n=yM(t,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[r,s,o]=nM(n,i.pixelProjectionMatrix);return t.length===2?[r,s]:[r,s,o]}unproject(t){return $o(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,i){$o(this.internalState);const n=this.internalState.viewport||this.context.viewport;return TX(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...i})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(const i of this.getModels())i.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:t}=this.props;return t===$i.DEFAULT||t===$i.LNGLAT||t===$i.CARTESIAN}onHover(t,i){return this.props.onHover&&this.props.onHover(t,i)||!1}onClick(t,i){return this.props.onClick&&this.props.onClick(t,i)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,i=[]){return i[0]=t+1&255,i[1]=t+1>>8&255,i[2]=t+1>>8>>8&255,i}decodePickingColor(t){$o(t instanceof Uint8Array);const[i,n,r]=t;return i+n*256+r*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:HZ(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=NP(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const i of this.props.extensions)t=NP(t,i.getShaders.call(this,i));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){const i=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&i)if(Array.isArray(n))for(const r of n)i.invalidateAll(r);else i.invalidateAll();if(i){const{props:r}=t,s=this.internalState.hasPickingBuffer,o=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:c,instancePickingColors:h}=i.attributes,A=c||h;A&&(o&&A.constant&&(A.constant=!1,i.invalidate(A.id)),!A.value&&!o&&(A.constant=!0,A.value=[0,0,0]))}}}finalizeState(t){for(const n of this.getModels())n.destroy();const i=this.getAttributeManager();i&&i.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(const i of this.getModels())i.draw(t.renderPass)}getPickingInfo({info:t,mode:i,sourceLayer:n}){const{index:r}=t;return r>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[r]),t}raiseError(t,i){i&&(t=new Error(`${i}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;const i=this.internalState.viewport;this.internalState.viewport=t,(!i||!mY({oldViewport:i,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){const i=this.getAttributeManager();i&&(t==="all"?i.invalidateAll():i.invalidate(t))}updateAttributes(t){let i=!1;for(const n in t)t[n].layoutChanged()&&(i=!0);for(const n of this.getModels())this._setModelAttributes(n,t,i)}_updateAttributes(){const t=this.getAttributeManager();if(!t)return;const i=this.props,n=this.getNumInstances(),r=this.getStartIndices();t.update({data:i.data,numInstances:n,startIndices:r,props:i,transitions:i.transitions,buffers:i.data.attributes,context:this});const s=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){const{uniformTransitions:t}=this.internalState;if(t.active){const i=t.update(),n=Object.create(this.props);for(const r in i)Object.defineProperty(n,r,{value:i[r]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:i}){if(t.constant)return;const n=Math.floor(Ac.length/4);if(this.internalState.usesPickingColorCache=!0,n<i){i>zP&&Zi.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Ac=kd.allocate(Ac,i,{size:4,copy:!0,maxCount:Math.max(i,zP)});const r=Math.floor(Ac.length/4),s=[0,0,0];for(let o=n;o<r;o++)this.encodePickingColor(o,s),Ac[o*4+0]=s[0],Ac[o*4+1]=s[1],Ac[o*4+2]=s[2],Ac[o*4+3]=0}t.value=Ac.subarray(0,i*4)}_setModelAttributes(t,i,n=!1){if(!Object.keys(i).length)return;if(n){const c=this.getAttributeManager();t.setBufferLayout(c.getBufferLayouts(t)),i=c.getAttributes()}const r=t.userData?.excludeAttributes||{},s={},o={};for(const c in i){if(r[c])continue;const h=i[c].getValue();for(const A in h){const _=h[A];_ instanceof Cr?i[c].settings.isIndexed?t.setIndexBuffer(_):s[A]=_:_&&(o[A]=_)}}t.setAttributes(s),t.setConstantAttributes(o)}disablePickingIndex(t){const i=this.props.data;if(!("attributes"in i)){this._disablePickingIndex(t);return}const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,s=n||r,o=s&&i.attributes&&i.attributes[s.id];if(o&&o.value){const c=o.value,h=this.encodePickingColor(t);for(let A=0;A<i.length;A++){const _=s.getVertexOffset(A);c[_]===h[0]&&c[_+1]===h[1]&&c[_+2]===h[2]&&this._disablePickingIndex(A)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,r=i||n;if(!r)return;const s=r.getVertexOffset(t),o=r.getVertexOffset(t+1);r.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,n=t||i;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==Ac.buffer&&(n.value=Ac.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){$o(!this.internalState),$o(Number.isFinite(this.props.coordinateSystem)),fs(fY,this);const t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new uY({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Zi.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new LZ(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const i of this.props.extensions)i.initializeState.call(this,this.context,i);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){fs(AY,this,this===t);const{state:i,internalState:n}=t;this!==t&&(this.internalState=n,this.state=i,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const t=this.needsUpdate();if(fs(dY,this,t),!t)return;const i=this.props,n=this.context,r=this.internalState,s=n.viewport,o=this._updateUniformTransition();r.propsInTransition=o,n.viewport=r.viewport||s,this.props=o;try{const c=this._getUpdateParams(),h=this.getModels();if(n.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const _ of this.props.extensions)_.updateState.call(this,c,_);this.setNeedsRedraw(),this._updateAttributes();const A=this.getModels()[0]!==h[0];this._postUpdate(c,A)}finally{n.viewport=s,this.props=i,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){fs(pY,this),this.finalizeState(this.context);for(const t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:i=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{i&&this.setShaderModuleProps(i);const{getPolygonOffset:c}=this.props,h=c&&c(n)||[0,0];o.device instanceof Kd&&o.device.setParametersWebGL({polygonOffset:h});for(const A of this.getModels())A.device.type==="webgpu"?A.setParameters({...A.parameters,...r}):A.setParameters(r);if(o.device instanceof Kd)o.device.withParametersWebGL(r,()=>{const A={renderPass:t,shaderModuleProps:i,uniforms:n,parameters:r,context:o};for(const _ of this.props.extensions)_.draw.call(this,A,_);this.draw(A)});else{const A={renderPass:t,shaderModuleProps:i,uniforms:n,parameters:r,context:o};for(const _ of this.props.extensions)_.draw.call(this,A,_);this.draw(A)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;const{changeFlags:i}=this.internalState;for(const r in t)if(t[r]){let s=!1;switch(r){case"dataChanged":const o=t[r],c=i[r];o&&Array.isArray(c)&&(i.dataChanged=Array.isArray(o)?c.concat(o):o,s=!0);default:i[r]||(i[r]=t[r],s=!0)}s&&fs(hY,this,r,t)}const n=!!(i.dataChanged||i.updateTriggersChanged||i.propsChanged||i.extensionsChanged);i.propsOrDataChanged=n,i.somethingChanged=n||i.viewportChanged||i.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,i){const n=kZ(t,i);if(n.updateTriggersChanged)for(const r in n.updateTriggersChanged)n.updateTriggersChanged[r]&&this.invalidateAttribute(r);if(n.transitionsChanged)for(const r in n.transitionsChanged)this.internalState.uniformTransitions.add(r,i[r],t[r],t.transitions?.[r]);return this.setChangeFlags(n)}validateProps(){FZ(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){const i={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(i.highlightColor=n(t)),this.setShaderModuleProps({picking:i}),this.setNeedsRedraw()}_getAttributeManager(){const t=this.context;return new U0(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,i){const{props:n,oldProps:r}=t,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:c,highlightColor:h}=n;if(i||r.autoHighlight!==o||r.highlightedObjectIndex!==c||r.highlightColor!==h){const A={};Array.isArray(h)&&(A.highlightColor=h),(i||r.autoHighlight!==o||c!==r.highlightedObjectIndex)&&(A.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:A})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let i=!1;i=i||this.internalState.needsRedraw&&this.id;const n=this.getAttributeManager(),r=n?n.getNeedsRedraw(t):!1;if(i=i||r,i)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,i}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Bo.defaultProps=yY,Bo.layerName="Layer";const vY="compositeLayer.renderLayers";class To extends Bo{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){const{object:i}=t;return i&&i.__source&&i.__source.parent&&i.__source.parent.id===this.id&&(t.object=i.__source.object,t.index=i.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,i){return i&&i.length}getSubLayerClass(t,i){const{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||i}getSubLayerRow(t,i,n){return t.__source={parent:this,object:i,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){const i={index:-1,data:this.props.data,target:[]};return(n,r)=>n&&n.__source?(i.index=n.__source.index,t(n.__source.object,i)):t(n,r)}return t}getSubLayerProps(t={}){const{opacity:i,pickable:n,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:c,autoHighlight:h,highlightColor:A,coordinateSystem:_,coordinateOrigin:C,wrapLongitude:S,positionFormat:L,modelMatrix:N,extensions:U,fetch:H,operation:j,_subLayerProps:tt}=this.props,K={id:"",updateTriggers:{},opacity:i,pickable:n,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:c,autoHighlight:h,highlightColor:A,coordinateSystem:_,coordinateOrigin:C,wrapLongitude:S,positionFormat:L,modelMatrix:N,extensions:U,fetch:H,operation:j},Q=tt&&t.id&&tt[t.id],pt=Q&&Q.updateTriggers,$=t.id||"sublayer";if(Q){const zt=this.props[Vu],Gt=t.type?t.type._propTypes:{};for(const dt in Q){const lt=Gt[dt]||zt[dt];lt&&lt.type==="accessor"&&(Q[dt]=this.getSubLayerAccessor(Q[dt]))}}Object.assign(K,t,Q),K.id=`${this.props.id}-${$}`,K.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...pt};for(const zt of U){const Gt=zt.getSubLayerProps.call(this,zt);Gt&&Object.assign(K,Gt,{updateTriggers:Object.assign(K.updateTriggers,Gt.updateTriggers)})}return K}_updateAutoHighlight(t){for(const i of this.getSubLayers())i.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,i){let n=this.internalState.subLayers;const r=!n||this.needsUpdate();if(r){const s=this.renderLayers();n=P0(s,Boolean),this.internalState.subLayers=n}fs(vY,this,r,n);for(const s of n)s.parent=this}}To.layerName="CompositeLayer";const j0=Math.PI/180,GP=180/Math.PI,V0=6370972,qd=256;function _Y(){const e=qd/V0,t=Math.PI/180*qd;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}class bY extends au{constructor(t={}){const{longitude:i=0,zoom:n=0,nearZMultiplier:r=.5,farZMultiplier:s=1,resolution:o=10}=t;let{latitude:c=0,height:h,altitude:A=1.5,fovy:_}=t;c=Math.max(Math.min(c,Fd),-Fd),h=h||1,_?A=db(_):_=YA(A);const C=1/Math.PI/Math.cos(c*Math.PI/180),S=Math.pow(2,n)*C,L=t.nearZ??r,N=t.farZ??(A+qd*2*S/h)*s,U=new yn().lookAt({eye:[0,-A,0],up:[0,0,1]});U.rotateX(c*j0),U.rotateZ(-i*j0),U.scale(S/h),super({...t,height:h,viewMatrix:U,longitude:i,latitude:c,zoom:n,distanceScales:_Y(),fovy:_,focalDistance:A,near:L,far:N}),this.scale=S,this.latitude=c,this.longitude=i,this.resolution=o}get projectionMode(){return la.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){const i={targetZ:t.z||0},n=this.unproject([0,this.height/2],i),r=this.unproject([this.width/2,0],i),s=this.unproject([this.width,this.height/2],i),o=this.unproject([this.width/2,this.height],i);return s[0]<this.longitude&&(s[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],s[0],r[0],o[0]),Math.min(n[1],s[1],r[1],o[1]),Math.max(n[0],s[0],r[0],o[0]),Math.max(n[1],s[1],r[1],o[1])]}unproject(t,{topLeft:i=!0,targetZ:n}={}){const[r,s,o]=t,c=i?s:this.height-s,{pixelUnprojectionMatrix:h}=this;let A;if(Number.isFinite(o))A=Wb(h,[r,c,o,1]);else{const L=Wb(h,[r,c,-1,1]),N=Wb(h,[r,c,1,1]),U=((n||0)/V0+1)*qd,H=V1(rI([],L,N)),j=V1(L),tt=V1(N),K=4*((4*j*tt-(H-j-tt)**2)/16)/H,Q=Math.sqrt(j-K),pt=Math.sqrt(Math.max(0,U*U-K)),$=(Q-pt)/Math.sqrt(H);A=VV([],L,N,$)}const[_,C,S]=this.unprojectPosition(A);return Number.isFinite(o)?[_,C,S]:Number.isFinite(n)?[_,C,n]:[_,C]}projectPosition(t){const[i,n,r=0]=t,s=i*j0,o=n*j0,c=Math.cos(o),h=(r/V0+1)*qd;return[Math.sin(s)*c*h,-Math.cos(s)*c*h,Math.sin(o)*h]}unprojectPosition(t){const[i,n,r]=t,s=oI(t),o=Math.asin(r/s),c=Math.atan2(i,-n)*GP,h=o*GP,A=(s/qd-1)*V0;return[c,h,A]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,i){const n=this.unproject(i);return{longitude:t[0]-n[0]+this.longitude,latitude:t[1]-n[1]+this.latitude}}}function Wb(e,t){const i=Rd([],t,e);return Q1(i,i,1/i[3]),i}class H0{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&Yr(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){const{defaultProps:i}=t.constructor,n={updateTriggers:{}};for(const r in i)if(r in this.props){const s=i[r],o=this.props[r];n[r]=o,s&&s.type==="accessor"&&(n.updateTriggers[r]=this.props.updateTriggers[r],typeof o=="function"&&(n[r]=this.getSubLayerAccessor(o)))}return n}initializeState(t,i){}updateState(t,i){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,i){}finalizeState(t,i){}}H0.defaultProps={},H0.extensionName="LayerExtension";class jP{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:i={}}=t;this.typedArrayManager=kd,this.attributes={},this._attributeDefs=i,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);const{data:i,buffers:n={},getGeometry:r,geometryBuffer:s,positionFormat:o,dataChanged:c,normalize:h=!0}=this.opts;if(this.data=i,this.getGeometry=r,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=n,this.normalize=h,s&&($o(i.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),h||(n.vertexPositions=s)),this.geometryBuffer=n.vertexPositions,Array.isArray(c))for(const A of c)this._rebuildGeometry(A);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:i}){this._rebuildGeometry({startRow:t,endRow:i})}getGeometryFromBuffer(t){const i=t.value||t;return ArrayBuffer.isView(i)?xP(i,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,i){const{attributes:n,buffers:r,_attributeDefs:s,typedArrayManager:o}=this;for(const c in s)if(c in r)o.release(n[c]),n[c]=null;else{const h=s[c];h.copy=i,n[c]=o.allocate(n[c],t,h)}}_forEachGeometry(t,i,n){const{data:r,getGeometry:s}=this,{iterable:o,objectInfo:c}=sl(r,i,n);for(const h of o){c.index++;const A=s?s(h,c):null;t(A,c.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:i,vertexStarts:n,instanceCount:r}=this;const{data:s,geometryBuffer:o}=this,{startRow:c=0,endRow:h=1/0}=t||{},A={};if(t||(i=[0],n=[0]),this.normalize||!o)this._forEachGeometry((C,S)=>{const L=C&&this.normalizeGeometry(C);A[S]=L,n[S+1]=n[S]+(L?this.getGeometrySize(L):0)},c,h),r=n[n.length-1];else if(n=s.startIndices,r=n[s.length]||0,ArrayBuffer.isView(o))r=r||o.length/this.positionSize;else if(o instanceof Cr){const C=this.positionSize*4;r=r||o.byteLength/C}else if(o.buffer){const C=o.stride||this.positionSize*4;r=r||o.buffer.byteLength/C}else if(o.value){const C=o.value,S=o.stride/C.BYTES_PER_ELEMENT||this.positionSize;r=r||C.length/S}this._allocate(r,!!t),this.indexStarts=i,this.vertexStarts=n,this.instanceCount=r;const _={};this._forEachGeometry((C,S)=>{const L=A[S]||C;_.vertexStart=n[S],_.indexStart=i[S];const N=S<n.length-1?n[S+1]:r;_.geometrySize=N-n[S],_.geometryIndex=S,this.updateGeometryAttributes(L,_)},c,h),this.vertexCount=i[i.length-1]}}const xY=typeof window<"u"?Te.useLayoutEffect:Te.useEffect;function W0(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}const wY={position:"absolute",zIndex:-1};function VP(e,t){if(typeof e=="function")return e(t);if(Array.isArray(e))return e.map(i=>VP(i,t));if(J0(e)){if(CY(e))return t.style=wY,Te.cloneElement(e,t);if(EY(e))return Te.cloneElement(e,t)}return e}function J0(e){return e&&typeof e=="object"&&"type"in e||!1}function CY(e){return e.props?.mapStyle}function EY(e){const t=e.type;return t&&t.deckGLViewProps}function Jb(e){if(typeof e=="function")return Te.createElement(Gd,{},e);if(Array.isArray(e))return e.map(Jb);if(J0(e)){if(e.type===Te.Fragment)return Jb(e.props.children);if(W0(e.type,Gd))return e}return e}function BY({children:e,layers:t=[],views:i=null}){const n=[],r=[],s={};return Te.Children.forEach(Jb(e),o=>{if(J0(o)){const c=o.type;if(W0(c,Bo)){const h=TY(c,o.props);r.push(h)}else n.push(o);if(W0(c,Gd)&&c!==Gd&&o.props.id){const h=new c(o.props);s[h.id]=h}}else o&&n.push(o)}),Object.keys(s).length>0&&(Array.isArray(i)?i.forEach(o=>{s[o.id]=o}):i&&(s[i.id]=i),i=Object.values(s)),t=r.length>0?[...r,...t]:t,{layers:t,children:n,views:i}}function TY(e,t){const i={},n=e.defaultProps||{};for(const r in t)n[r]!==t[r]&&(i[r]=t[r]);return new e(i)}const SY=Te.createContext();function IY({children:e,deck:t,ContextProvider:i=SY.Provider}){const{viewManager:n}=t||{};if(!n||!n.views.length)return[];const r={},s=n.views[0].id;for(const o of e){let c=s,h=o;J0(o)&&W0(o.type,Gd)&&(c=o.props.id||s,h=o.props.children);const A=n.getViewport(c),_=n.getViewState(c);if(A){_.padding=A.padding;const{x:C,y:S,width:L,height:N}=A;h=VP(h,{x:C,y:S,width:L,height:N,viewport:A,viewState:_}),r[c]||(r[c]={viewport:A,children:[]}),r[c].children.push(h)}}return Object.keys(r).map(o=>{const{viewport:c,children:h}=r[o],{x:A,y:_,width:C,height:S}=c,L={position:"absolute",left:A,top:_,width:C,height:S},N=`view-${o}`,U=Te.createElement("div",{key:N,id:N,style:L},...h),H={deck:t,viewport:c,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:tt=>{tt.viewId=o,t._onViewStateChange(tt)},widgets:[]},j=`view-${o}-context`;return Te.createElement(i,{key:j,value:H},U)})}const MY={mixBlendMode:null};function PY({width:e,height:t,style:i}){const n={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},r={left:0,top:0};if(i)for(const s in i)s in MY?r[s]=i[s]:n[s]=i[s];return{containerStyle:n,canvasStyle:r}}function RY(e){return{get deck(){return e.deck},pickObject:t=>e.deck.pickObject(t),pickMultipleObjects:t=>e.deck.pickMultipleObjects(t),pickObjects:t=>e.deck.pickObjects(t)}}function HP(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}function DY(e,t,i){const n=new t({...i,_customRender:i.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:r=>{e.redrawReason=r;const s=n.getViewports();e.lastRenderedViewports!==s?e.forceUpdate():HP(e)}});return n}function OY(e,t){const[i,n]=Te.useState(0),r=Te.useRef({control:null,version:i,forceUpdate:()=>n(Q=>Q+1)}).current,s=Te.useRef(null),o=Te.useRef(null),c=Te.useMemo(()=>BY(e),[e.layers,e.views,e.children]);let h=!0;const A=Q=>h&&e.viewState?(r.viewStateUpdateRequested=Q,null):(r.viewStateUpdateRequested=null,e.onViewStateChange?.(Q)),_=Q=>{h?r.interactionStateUpdateRequested=Q:(r.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(Q))},C=Te.useMemo(()=>{const Q={widgets:[],...e,style:null,width:"100%",height:"100%",parent:s.current,canvas:o.current,layers:c.layers,views:c.views,onViewStateChange:A,onInteractionStateChange:_};return delete Q._customRender,r.deck&&r.deck.setProps(Q),Q},[e]);Te.useEffect(()=>{const Q=e.Deck||Fb;return r.deck=DY(r,Q,{...C,parent:s.current,canvas:o.current}),()=>r.deck?.finalize()},[]),xY(()=>{HP(r);const{viewStateUpdateRequested:Q,interactionStateUpdateRequested:pt}=r;Q&&A(Q),pt&&_(pt)}),Te.useImperativeHandle(t,()=>RY(r),[]);const S=r.deck&&r.deck.isInitialized?r.deck.getViewports():void 0,{ContextProvider:L,width:N="100%",height:U="100%",id:H,style:j}=e,{containerStyle:tt,canvasStyle:K}=Te.useMemo(()=>PY({width:N,height:U,style:j}),[N,U,j]);if(!r.viewStateUpdateRequested&&r.lastRenderedViewports===S||r.version!==i){r.lastRenderedViewports=S,r.version=i;const Q=IY({children:c.children,deck:r.deck,ContextProvider:L}),pt=Te.createElement("canvas",{key:"canvas",id:H||"deckgl-overlay",ref:o,style:K});r.control=Te.createElement("div",{id:`${H||"deckgl"}-wrapper`,ref:s,style:tt},[pt,Q])}return h=!1,r.control}const LY=Te.forwardRef(OY);function WP(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const JP=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),XP=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);XP&&parseFloat(XP[1]);const QP=globalThis,KP=globalThis.process||{};function FY(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Xb(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||FY()}const qP="4.0.7";function kY(e){try{const t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch{return null}}class NY{constructor(t,i,n="sessionStorage"){this.storage=kY(n),this.id=t,this.config=i,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const i=JSON.stringify(this.config);this.storage.setItem(this.id,i)}}_loadConfiguration(){let t={};if(this.storage){const i=this.storage.getItem(this.id);t=i?JSON.parse(i):{}}return Object.assign(this.config,t),this}}function UY(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function zY(e,t=8){const i=Math.max(t-e.length,0);return`${" ".repeat(i)}${e}`}var X0;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(X0||(X0={}));const GY=10;function ZP(e){return typeof e!="string"?e:(e=e.toUpperCase(),X0[e]||X0.WHITE)}function jY(e,t,i){return!Xb&&typeof e=="string"&&(t&&(e=`\x1B[${ZP(t)}m${e}\x1B[39m`),i&&(e=`\x1B[${ZP(i)+GY}m${e}\x1B[49m`)),e}function VY(e,t=["constructor"]){const i=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(i),r=e;for(const s of n){const o=r[s];typeof o=="function"&&(t.find(c=>s===c)||(r[s]=o.bind(e)))}}function Qb(e,t){if(!e)throw new Error("Assertion failed")}function Zd(){let e;if(Xb()&&QP.performance)e=QP?.performance?.now?.();else if("hrtime"in KP){const t=KP?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}const Yd={debug:Xb()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},HY={enabled:!0,level:0};function $d(){}const YP={},$P={once:!0};class Q0{constructor({id:t}={id:""}){this.VERSION=qP,this._startTs=Zd(),this._deltaTs=Zd(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new NY(`__probe-${this.id}__`,HY),this.timeStamp(`${this.id} started`),VY(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Zd()-this._startTs).toPrecision(10))}getDelta(){return Number((Zd()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,i){this._storage.setConfiguration({[t]:i})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,i){if(!t)throw new Error(i||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Yd.warn,arguments,$P)}error(t){return this._getLogFunction(0,t,Yd.error,arguments)}deprecated(t,i){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${i}\` instead`)}removed(t,i){return this.error(`\`${t}\` has been removed. Use \`${i}\` instead`)}probe(t,i){return this._getLogFunction(t,i,Yd.log,arguments,{time:!0,once:!0})}log(t,i){return this._getLogFunction(t,i,Yd.debug,arguments)}info(t,i){return this._getLogFunction(t,i,console.info,arguments)}once(t,i){return this._getLogFunction(t,i,Yd.debug||Yd.info,arguments,$P)}table(t,i,n){return i?this._getLogFunction(t,i,console.table||$d,n&&[n],{tag:JY(i)}):$d}time(t,i){return this._getLogFunction(t,i,console.time?console.time:console.info)}timeEnd(t,i){return this._getLogFunction(t,i,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,i){return this._getLogFunction(t,i,console.timeStamp||$d)}group(t,i,n={collapsed:!1}){const r=e4({logLevel:t,message:i,opts:n}),{collapsed:s}=n;return r.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,i,n={}){return this.group(t,i,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||$d)}withGroup(t,i,n){this.group(t,i)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=t4(t)}_getLogFunction(t,i,n,r,s){if(this._shouldLog(t)){s=e4({logLevel:t,message:i,args:r,opts:s}),n=n||s.method,Qb(n),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Zd();const o=s.tag||s.message;if(s.once&&o)if(!YP[o])YP[o]=Zd();else return $d;return i=WY(this.id,s.message,s),n.bind(console,i,...s.args)}return $d}}Q0.VERSION=qP;function t4(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Qb(Number.isFinite(t)&&t>=0),t}function e4(e){const{logLevel:t,message:i}=e;e.logLevel=t4(t);const n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==i;);switch(typeof t){case"string":case"function":i!==void 0&&n.unshift(i),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return Qb(r==="string"||r==="object"),Object.assign(e,{args:n},e.opts)}function WY(e,t,i){if(typeof t=="string"){const n=i.time?zY(UY(i.total)):"";t=i.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=jY(t,i.color,i.background)}return t}function JY(e){for(const t in e)for(const i in e[t])return i||"untitled";return"empty"}globalThis.probe={};const i4=new Q0({id:"@probe.gl/log"}),Kb="4.3.3",XY=Kb[0]>="0"&&Kb[0]<="9"?`v${Kb}`:"";function QY(){const e=new Q0({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=XY,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}const KY=QY();function qY(e,t){return n4(e||{},t)}function n4(e,t,i=0){if(i>3)return t;const n={...e};for(const[r,s]of Object.entries(t))s&&typeof s=="object"&&!Array.isArray(s)?n[r]=n4(n[r]||{},t[r],i+1):n[r]=t[r];return n}const ZY="latest";function YY(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const $Y=YY();function Ku(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const tf=typeof process!="object"||String(process)!=="[object process]"||process.browser,t$=typeof window<"u"&&typeof window.orientation<"u",r4=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);r4&&parseFloat(r4[1]);class e${name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,i){this.name=t,this.workerThread=i,this.result=new Promise((n,r)=>{this._resolve=n,this._reject=r})}postMessage(t,i){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:i})}done(t){Ku(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Ku(this.isRunning),this.isRunning=!1,this._reject(t)}}class qb{terminate(){}}const Zb=new Map;function i$(e){Ku(e.source&&!e.url||!e.source&&e.url);let t=Zb.get(e.source||e.url);return t||(e.url&&(t=n$(e.url),Zb.set(e.url,t)),e.source&&(t=o4(e.source),Zb.set(e.source,t))),Ku(t),t}function n$(e){if(!e.startsWith("http"))return e;const t=r$(e);return o4(t)}function o4(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function r$(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function s4(e,t=!0,i){const n=i||new Set;if(e){if(a4(e))n.add(e);else if(a4(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)&&t&&typeof e=="object")for(const r in e)s4(e[r],t,n)}return i===void 0?Array.from(n):[]}function a4(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const Yb=()=>{};class $b{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&tf||typeof qb<"u"&&!tf}constructor(t){const{name:i,source:n,url:r}=t;Ku(n||r),this.name=i,this.source=n,this.url=r,this.onMessage=Yb,this.onError=s=>console.log(s),this.worker=tf?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Yb,this.onError=Yb,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,i){i=i||s4(t),this.worker.postMessage(t,i)}_getErrorFromErrorEvent(t){let i="Failed to load ";return i+=`worker ${this.name} from ${this.url}. `,t.message&&(i+=`${t.message} in `),t.lineno&&(i+=`:${t.lineno}:${t.colno}`),new Error(i)}_createBrowserWorker(){this._loadableURL=i$({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=i=>{i.data?this.onMessage(i.data):this.onError(new Error("No data received"))},t.onerror=i=>{this.onError(this._getErrorFromErrorEvent(i)),this.terminated=!0},t.onmessageerror=i=>console.error(i),t}_createNodeWorker(){let t;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new qb(i,{eval:!1})}else if(this.source)t=new qb(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",i=>{this.onMessage(i)}),t.on("error",i=>{this.onError(i)}),t.on("exit",i=>{}),t}}class o${name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return $b.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,i=(r,s,o)=>r.done(o),n=(r,s)=>r.error(s)){const r=new Promise(s=>(this.jobQueue.push({name:t,onMessage:i,onError:n,onStart:s}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const i=this.jobQueue.shift();if(i){this.onDebug({message:"Starting job",name:i.name,workerThread:t,backlog:this.jobQueue.length});const n=new e$(i.name,t);t.onMessage=r=>i.onMessage(n,r.type,r.payload),t.onError=r=>i.onError(n,r),i.onStart(n);try{await n.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!tf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new $b({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return t$?this.maxMobileConcurrency:this.maxConcurrency}}const s$={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ph{props;workerPools=new Map;static _workerFarm;static isSupported(){return $b.isSupported()}static getWorkerFarm(t={}){return ph._workerFarm=ph._workerFarm||new ph({}),ph._workerFarm.setProps(t),ph._workerFarm}constructor(t){this.props={...s$},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const i of this.workerPools.values())i.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:i,source:n,url:r}=t;let s=this.workerPools.get(i);return s||(s=new o$({name:i,source:n,url:r}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(i,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function a$(e,t={}){const i=t[e.id]||{},n=tf?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=i.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(tf?r=`modules/${e.module}/dist/${n}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let s=e.version;s==="latest"&&(s=ZY);const o=s?`@${s}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${n}`}return Ku(r),r}function c$(e,t=$Y){Ku(e,"no worker provided");const i=e.version;return!(!t||!i)}function l$(e,t){return!ph.isSupported()||!tf&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function u$(e,t,i,n,r){const s=e.id,o=a$(e,i),c=ph.getWorkerFarm(i).getWorkerPool({name:s,url:o});i=JSON.parse(JSON.stringify(i)),n=JSON.parse(JSON.stringify(n||{}));const h=await c.startJob("process-on-worker",h$.bind(null,r));return h.postMessage("process",{input:t,options:i,context:n}),await(await h.result).result}async function h$(e,t,i,n){switch(i){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":const{id:r,input:s,options:o}=n;try{const c=await e(s,o);t.postMessage("done",{id:r,result:c})}catch(c){const h=c instanceof Error?c.message:"unknown error";t.postMessage("error",{id:r,error:h})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}function f$(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let s=0;s<n.length;++s)if(n[s]!==r[s])return!1;return!0}function d$(...e){return p$(e)}function p$(e){const t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=t.reduce((s,o)=>s+o.byteLength,0),n=new Uint8Array(i);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n.buffer}async function A$(e){const t=[];for await(const i of e)t.push(i);return d$(...t)}function c4(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class l4{constructor(t,i){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=i,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=c4(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(c4()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class u4{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,i="count"){return this._getOrCreate({name:t,type:i})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const i of Object.values(this.stats))t(i)}getTable(){const t={};return this.forEach(i=>{t[i.name]={time:i.time||0,count:i.count||0,average:i.getAverageTime()||0,hz:i.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(i=>this._getOrCreate(i))}_getOrCreate(t){const{name:i,type:n}=t;let r=this.stats[i];return r||(t instanceof l4?r=t:r=new l4(i,n),this.stats[i]=r),r}}let g$="";const h4={};function m$(e){for(const t in h4)if(e.startsWith(t)){const i=h4[t];e=e.replace(t,i)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${g$}${e}`),e}function y$(e){return e&&typeof e=="object"&&e.isBuffer}function f4(e){if(y$(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function d4(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function v$(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}const _$=e=>typeof e=="boolean",lg=e=>typeof e=="function",ug=e=>e!==null&&typeof e=="object",p4=e=>ug(e)&&e.constructor==={}.constructor,b$=e=>!!e&&typeof e[Symbol.iterator]=="function",x$=e=>e&&typeof e[Symbol.asyncIterator]=="function",ef=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,nf=e=>typeof Blob<"u"&&e instanceof Blob,w$=e=>e&&typeof e=="object"&&e.isBuffer,C$=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||ug(e)&&lg(e.tee)&&lg(e.cancel)&&lg(e.getReader),E$=e=>ug(e)&&lg(e.read)&&lg(e.pipe)&&_$(e.readable),A4=e=>C$(e)||E$(e);class B$ extends Error{constructor(t,i){super(t),this.reason=i.reason,this.url=i.url,this.response=i.response}reason;url;response}const T$=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,S$=/^([-\w.]+\/[-\w.+]+)/;function g4(e,t){return e.toLowerCase()===t.toLowerCase()}function I$(e){const t=S$.exec(e);return t?t[1]:e}function m4(e){const t=T$.exec(e);return t?t[1]:""}const y4=/\?.*/;function M$(e){const t=e.match(y4);return t&&t[0]}function t2(e){return e.replace(y4,"")}function P$(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function K0(e){return ef(e)?e.url:nf(e)?e.name||"":typeof e=="string"?e:""}function e2(e){if(ef(e)){const t=e,i=t.headers.get("content-type")||"",n=t2(t.url);return I$(i)||m4(n)}return nf(e)?e.type||"":typeof e=="string"?m4(e):""}function R$(e){return ef(e)?e.headers["content-length"]||-1:nf(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function v4(e){if(ef(e))return e;const t={},i=R$(e);i>=0&&(t["content-length"]=String(i));const n=K0(e),r=e2(e);r&&(t["content-type"]=r);const s=await L$(e);s&&(t["x-first-bytes"]=s),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:n}),o}async function D$(e){if(!e.ok)throw await O$(e)}async function O$(e){const t=P$(e.url);let i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;i=i.length>100?`${i.slice(0,100)}...`:i;const n={reason:e.statusText,url:e.url,response:e};try{const r=e.headers.get("Content-Type");n.reason=!e.bodyUsed&&r?.includes("application/json")?await e.json():await e.text()}catch{}return new B$(i,n)}async function L$(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=r=>i(r?.target?.result),n.readAsDataURL(t)})}if(e instanceof ArrayBuffer){const t=e.slice(0,5);return`data:base64,${F$(t)}`}return null}function F$(e){let t="";const i=new Uint8Array(e);for(let n=0;n<i.byteLength;n++)t+=String.fromCharCode(i[n]);return btoa(t)}function k$(e){return!N$(e)&&!U$(e)}function N$(e){return e.startsWith("http:")||e.startsWith("https:")}function U$(e){return e.startsWith("data:")}async function _4(e,t){if(typeof e=="string"){const i=m$(e);return k$(i)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(i,t):await fetch(i,t)}return await v4(e)}const b4=new Q0({id:"loaders.gl"});class z${log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class G${console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const x4={fetch:null,mimeType:void 0,nothrow:!1,log:new G$,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:JP,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},j$={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function w4(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function C4(){const e=w4();return e.globalOptions=e.globalOptions||{...x4},e.globalOptions}function V$(e,t,i,n){return i=i||[],i=Array.isArray(i)?i:[i],H$(e,i),J$(t,e,n)}function H$(e,t){E4(e,null,x4,j$,t);for(const i of t){const n=e&&e[i.id]||{},r=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};E4(n,i.id,r,s,t)}}function E4(e,t,i,n,r){const s=t||"Top level",o=t?`${t}.`:"";for(const c in e){const h=!t&&ug(e[c]),A=c==="baseUri"&&!t,_=c==="workerUrl"&&t;if(!(c in i)&&!A&&!_){if(c in n)b4.warn(`${s} loader option '${o}${c}' no longer supported, use '${n[c]}'`)();else if(!h){const C=W$(c,r);b4.warn(`${s} loader option '${o}${c}' not recognized. ${C}`)()}}}}function W$(e,t){const i=e.toLowerCase();let n="";for(const r of t)for(const s in r.options){if(e===s)return`Did you mean '${r.id}.${s}'?`;const o=s.toLowerCase();(i.startsWith(o)||o.startsWith(i))&&(n=n||`Did you mean '${r.id}.${s}'?`)}return n}function J$(e,t,i){const n={...e.options||{}};return X$(n,i),n.log===null&&(n.log=new z$),B4(n,C4()),B4(n,t),n}function B4(e,t){for(const i in t)if(i in t){const n=t[i];p4(n)&&p4(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i]}}function X$(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function i2(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function n2(e){WP(e,"null loader"),WP(i2(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const T4=()=>{const e=w4();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function hg(e){const t=T4();e=Array.isArray(e)?e:[e];for(const i of e){const n=n2(i);t.find(r=>n===r)||t.unshift(n)}}function Q$(){return T4()}const K$=/\.([^.]+)$/;async function q$(e,t=[],i,n){if(!I4(e))return null;let r=S4(e,t,{...i,nothrow:!0},n);if(r)return r;if(nf(e)&&(e=await e.slice(0,10).arrayBuffer(),r=S4(e,t,i,n)),!r&&!i?.nothrow)throw new Error(M4(e));return r}function S4(e,t=[],i,n){if(!I4(e))return null;if(t&&!Array.isArray(t))return n2(t);let r=[];t&&(r=r.concat(t)),i?.ignoreRegisteredLoaders||r.push(...Q$()),Y$(r);const s=Z$(e,r,i,n);if(!s&&!i?.nothrow)throw new Error(M4(e));return s}function Z$(e,t,i,n){const r=K0(e),s=e2(e),o=t2(r)||n?.url;let c=null,h="";return i?.mimeType&&(c=r2(t,i?.mimeType),h=`match forced by supplied MIME type ${i?.mimeType}`),c=c||$$(t,o),h=h||(c?`matched url ${o}`:""),c=c||r2(t,s),h=h||(c?`matched MIME type ${s}`:""),c=c||ett(t,e),h=h||(c?`matched initial data ${R4(e)}`:""),i?.fallbackMimeType&&(c=c||r2(t,i?.fallbackMimeType),h=h||(c?`matched fallback MIME type ${s}`:"")),h&&KY.log(1,`selectLoader selected ${c?.name}: ${h}.`),c}function I4(e){return!(e instanceof Response&&e.status===204)}function M4(e){const t=K0(e),i=e2(e);let n="No valid loader found (";n+=t?`${d4(t)}, `:"no url provided, ",n+=`MIME type: ${i?`"${i}"`:"not provided"}, `;const r=e?R4(e):"";return n+=r?` first bytes: "${r}"`:"first bytes: not available",n+=")",n}function Y$(e){for(const t of e)n2(t)}function $$(e,t){const i=t&&K$.exec(t),n=i&&i[1];return n?ttt(e,n):null}function ttt(e,t){t=t.toLowerCase();for(const i of e)for(const n of i.extensions)if(n.toLowerCase()===t)return i;return null}function r2(e,t){for(const i of e)if(i.mimeTypes?.some(n=>g4(t,n))||g4(t,`application/x.${i.id}`))return i;return null}function ett(e,t){if(!t)return null;for(const i of e)if(typeof t=="string"){if(itt(t,i))return i}else if(ArrayBuffer.isView(t)){if(P4(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&P4(t,0,i))return i;return null}function itt(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>e.startsWith(i))}function P4(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(n=>ntt(e,t,i,n))}function ntt(e,t,i,n){if(n instanceof ArrayBuffer)return f$(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":const r=o2(e,t,n.length);return n===r;default:return!1}}function R4(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?o2(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?o2(e,0,t):""}function o2(e,t,i){if(e.byteLength<t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}const rtt=256*1024;function*ott(e,t){const i=t?.chunkSize||rtt;let n=0;const r=new TextEncoder;for(;n<e.length;){const s=Math.min(e.length-n,i),o=e.slice(n,n+s);n+=s,yield r.encode(o)}}const stt=256*1024;function*att(e,t={}){const{chunkSize:i=stt}=t;let n=0;for(;n<e.byteLength;){const r=Math.min(e.byteLength-n,i),s=new ArrayBuffer(r),o=new Uint8Array(e,n,r);new Uint8Array(s).set(o),n+=r,yield s}}const ctt=1024*1024;async function*ltt(e,t){const i=t?.chunkSize||ctt;let n=0;for(;n<e.size;){const r=n+i,s=await e.slice(n,r).arrayBuffer();n=r,yield s}}function D4(e,t){return JP?utt(e,t):htt(e)}async function*utt(e,t){const i=e.getReader();let n;try{for(;;){const r=n||i.read();t?._streamReadAhead&&(n=i.read());const{done:s,value:o}=await r;if(s)return;yield f4(o)}}catch{i.releaseLock()}}async function*htt(e,t){for await(const i of e)yield f4(i)}function ftt(e,t){if(typeof e=="string")return ott(e,t);if(e instanceof ArrayBuffer)return att(e,t);if(nf(e))return ltt(e,t);if(A4(e))return D4(e,t);if(ef(e))return D4(e.body,t);throw new Error("makeIterator")}const O4="Cannot convert supplied data type";function dtt(e,t,i){if(t.text&&typeof e=="string")return e;if(w$(e)&&(e=e.buffer),e instanceof ArrayBuffer){const n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+r)),n}throw new Error(O4)}async function ptt(e,t,i){const n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return dtt(e,t);if(nf(e)&&(e=await v4(e)),ef(e)){const r=e;return await D$(r),t.binary?await r.arrayBuffer():await r.text()}if(A4(e)&&(e=ftt(e,i)),b$(e)||x$(e))return A$(e);throw new Error(O4)}function L4(e,t){const i=C4(),n=e||i;return typeof n.fetch=="function"?n.fetch:ug(n.fetch)?r=>_4(r,n.fetch):t?.fetch?t?.fetch:_4}function Att(e,t,i){if(i)return i;const n={fetch:L4(t,e),...e};if(n.url){const r=t2(n.url);n.baseUrl=r,n.queryString=M$(n.url),n.filename=d4(r),n.baseUrl=v$(r)}return Array.isArray(n.loaders)||(n.loaders=null),n}function gtt(e,t){if(e&&!Array.isArray(e))return e;let i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){const n=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...n]:n}return i&&i.length?i:void 0}async function q0(e,t,i,n){t&&!Array.isArray(t)&&!i2(t)&&(n=void 0,i=t,t=void 0),e=await e,i=i||{};const r=K0(e),s=gtt(t,n),o=await q$(e,s,i);return o?(i=V$(i,o,s,r),n=Att({url:r,_parse:q0,loaders:s},i,n||null),await mtt(o,e,i,n)):null}async function mtt(e,t,i,n){if(c$(e),i=qY(e.options,i),ef(t)){const s=t,{ok:o,redirected:c,status:h,statusText:A,type:_,url:C}=s,S=Object.fromEntries(s.headers.entries());n.response={headers:S,ok:o,redirected:c,status:h,statusText:A,type:_,url:C}}t=await ptt(t,e,i);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,i,n);if(l$(e,i))return await u$(e,t,i,n,q0);if(r.parseText&&typeof t=="string")return await r.parseText(t,i,n);if(r.parse)return await r.parse(t,i,n);throw Ku(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}async function tp(e,t,i,n){let r,s;!Array.isArray(t)&&!i2(t)?(r=[],s=t):(r=t,s=i);const o=L4(s);let c=e;return typeof e=="string"&&(c=await o(e)),nf(e)&&(c=await o(e)),Array.isArray(r)?await q0(c,r,s):await q0(c,r,s)}const F4=100;class ytt{schema;options;shape;length=0;rows=null;cursor=0;_headers=[];constructor(t,i){if(this.options=i,this.schema=t,!Array.isArray(t)){this._headers=[];for(const n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,i){Number.isFinite(i)&&(this.cursor=i),this.shape="array-row-table",this.rows=this.rows||new Array(F4),this.rows[this.length]=t,this.length++}addObjectRow(t,i){Number.isFinite(i)&&(this.cursor=i),this.shape="object-row-table",this.rows=this.rows||new Array(F4),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function k4(e,t){if(!e)throw new Error("null row");const i={};if(t)for(let n=0;n<t.length;n++)i[t[n]]=e[n];else for(let n=0;n<e.length;n++){const r=`column-${n}`;i[r]=e[n]}return i}function N4(e,t){if(!e)throw new Error("null row");if(t){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=e[t[n]];return i}return Object.values(e)}function vtt(e){const t=[];for(let i=0;i<e.length;i++){const n=`column-${i}`;t.push(n)}return t}function _tt(e){return Object.keys(e)}const U4=100;class btt{schema;options;length=0;objectRows=null;arrayRows=null;cursor=0;_headers=null;constructor(t,i){if(this.options=i,this.schema=t,t){this._headers=[];for(const n in t)this._headers[t[n].index]=t[n].name}}rowCount(){return this.length}addArrayRow(t,i){switch(Number.isFinite(i)&&(this.cursor=i),this._headers||=vtt(t),this.options.shape){case"object-row-table":const n=k4(t,this._headers);this.addObjectRow(n,i);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(U4),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,i){switch(Number.isFinite(i)&&(this.cursor=i),this._headers||=_tt(t),this.options.shape){case"array-row-table":const n=N4(t,this._headers);this.addArrayRow(n,i);break;case"object-row-table":this.objectRows=this.objectRows||new Array(U4),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const xtt=100;class wtt{schema;length=0;allocated=0;columns={};constructor(t,i){this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let i=0;for(const n in this.columns)this.columns[n][this.length]=t[i++];this.length++}addObjectRow(t){this._reallocateColumns();for(const i in t)this.columns[i][this.length]=t[i];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const i in this.schema){const n=this.schema[i];t[n.name]=this.columns[n.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:xtt,this.columns={};for(const t in this.schema){const i=this.schema[t],n=i.type||Float32Array,r=this.columns[i.index];if(r&&ArrayBuffer.isView(r)){const s=new n(this.allocated);s.set(r),this.columns[i.index]=s}else r?(r.length=this.allocated,this.columns[i.index]=r):this.columns[i.index]=new n(this.allocated)}}}_pruneColumns(){for(const[t,i]of Object.entries(this.columns))this.columns[t]=i.slice(0,this.length)}}const Ctt={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},Ett="TableBatchBuilder";class c_{schema;options;aggregator=null;batchCount=0;bytesUsed=0;isChunkComplete=!1;lastBatchEmittedMs=Date.now();totalLength=0;totalBytes=0;rowBytes=0;static ArrowBatch;constructor(t,i){this.schema=t,this.options={...Ctt,...i}}limitReached(){return!!(this.options?.limit&&this.totalLength>=this.options.limit||this.options?._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const i=this._getTableBatchType();this.aggregator=new i(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const i=this._getTableBatchType();this.aggregator=new i(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t?.bytesUsed&&(this.bytesUsed=t.bytesUsed);const i=this.aggregator.getBatch();return i.count=this.batchCount,i.bytesUsed=this.bytesUsed,Object.assign(i,t),this.batchCount++,this.aggregator=null,i}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return btt;case"columnar-table":return wtt;case"arrow-table":if(!c_.ArrowBatch)throw new Error(Ett);return c_.ArrowBatch;default:return ytt}}}class z4 extends Array{enqueue(t){return this.push(t)}dequeue(){return this.shift()}}class Btt{_values;_settlers;_closed;constructor(){this._values=new z4,this._settlers=new z4,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const i=this._settlers.dequeue();t instanceof Error?i.reject(t):i.resolve({value:t})}else this._values.enqueue(t)}next(){if(this._values.length>0){const t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((t,i)=>{this._settlers.enqueue({resolve:t,reject:i})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const G4="\uFEFF";function Ttt(e,t={},i=Itt){t=t||{};var n=t.dynamicTyping||!1;gc(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=gc(t.transform)?t.transform:!1;var r=new i(t);return r.stream(e)}function Stt(e,t){var i=!1,n=!0,r=",",s=`\r
`,o='"',c=o+o,h=!1,A=null;C();var _=new RegExp(fg(o),"g");if(typeof e=="string"&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return S(null,e,h);if(typeof e[0]=="object")return S(A||Object.keys(e[0]),e,h)}else if(typeof e=="object")return typeof e.data=="string"&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:Object.keys(e.data[0])),!Array.isArray(e.data[0])&&typeof e.data[0]!="object"&&(e.data=[e.data])),S(e.fields||[],e.data||[],h);throw new Error("Unable to serialize unrecognized input");function C(){if(typeof t=="object"){if(typeof t.delimiter=="string"&&!La.BAD_DELIMITERS.filter(function(U){return t.delimiter.indexOf(U)!==-1}).length&&(r=t.delimiter),(typeof t.quotes=="boolean"||Array.isArray(t.quotes))&&(i=t.quotes),(typeof t.skipEmptyLines=="boolean"||typeof t.skipEmptyLines=="string")&&(h=t.skipEmptyLines),typeof t.newline=="string"&&(s=t.newline),typeof t.quoteChar=="string"&&(o=t.quoteChar),typeof t.header=="boolean"&&(n=t.header),Array.isArray(t.columns)){if(t.columns.length===0)throw new Error("Option columns is empty");A=t.columns}t.escapeChar!==void 0&&(c=t.escapeChar+o)}}function S(U,H,j){var tt="";typeof U=="string"&&(U=JSON.parse(U)),typeof H=="string"&&(H=JSON.parse(H));var K=Array.isArray(U)&&U.length>0,Q=!Array.isArray(H[0]);if(K&&n){for(var pt=0;pt<U.length;pt++)pt>0&&(tt+=r),tt+=L(U[pt],pt);H.length>0&&(tt+=s)}for(var $=0;$<H.length;$++){var zt=K?U.length:H[$].length,Gt=!1,dt=K?Object.keys(H[$]).length===0:H[$].length===0;if(j&&!K&&(Gt=j==="greedy"?H[$].join("").trim()==="":H[$].length===1&&H[$][0].length===0),j==="greedy"&&K){for(var lt=[],Lt=0;Lt<zt;Lt++){var J=Q?U[Lt]:Lt;lt.push(H[$][J])}Gt=lt.join("").trim()===""}if(!Gt){for(var ut=0;ut<zt;ut++){ut>0&&!dt&&(tt+=r);var Et=K&&Q?U[ut]:ut;tt+=L(H[$][Et],ut)}$<H.length-1&&(!j||zt>0&&!dt)&&(tt+=s)}}return tt}function L(U,H){if(typeof U>"u"||U===null)return"";if(U.constructor===Date)return JSON.stringify(U).slice(1,25);U=U.toString().replace(_,c);var j=typeof i=="boolean"&&i||Array.isArray(i)&&i[H]||N(U,La.BAD_DELIMITERS)||U.indexOf(r)>-1||U.charAt(0)===" "||U.charAt(U.length-1)===" ";return j?o+U+o:U}function N(U,H){for(var j=0;j<H.length;j++)if(U.indexOf(H[j])>-1)return!0;return!1}}let j4=class{_handle;_config;_finished=!1;_completed=!1;_input=null;_baseIndex=0;_partialLine="";_rowCount=0;_start=0;isFirstChunk=!0;_completeResults={data:[],errors:[],meta:{}};constructor(e){var t={...e};t.chunkSize=parseInt(t.chunkSize),!e.step&&!e.chunk&&(t.chunkSize=null),this._handle=new V4(t),this._handle.streamer=this,this._config=t}parseChunk(e,t){if(this.isFirstChunk&&gc(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(e);i!==void 0&&(e=i)}this.isFirstChunk=!1;var n=this._partialLine+e;this._partialLine="";var r=this._handle.parse(n,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var s=r.meta.cursor;this._finished||(this._partialLine=n.substring(s-this._baseIndex),this._baseIndex=s),r&&r.data&&(this._rowCount+=r.data.length);var o=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(gc(this._config.chunk)&&!t){if(this._config.chunk(r,this._handle),this._handle.paused()||this._handle.aborted())return;r=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(r.data),this._completeResults.errors=this._completeResults.errors.concat(r.errors),this._completeResults.meta=r.meta),!this._completed&&o&&gc(this._config.complete)&&(!r||!r.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),r}}_sendError(e){gc(this._config.error)&&this._config.error(e)}};class Itt extends j4{remaining;constructor(t={}){super(t)}stream(t){return this.remaining=t,this._nextChunk()}_nextChunk(){if(!this._finished){var t=this._config.chunkSize,i=t?this.remaining.substr(0,t):this.remaining;return this.remaining=t?this.remaining.substr(t):"",this._finished=!this.remaining,this.parseChunk(i)}}}const Mtt=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,Ptt=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;class V4{_config;_stepCounter=0;_rowCounter=0;_input;_parser;_paused=!1;_aborted=!1;_delimiterError=!1;_fields=[];_results={data:[],errors:[],meta:{}};constructor(t){if(gc(t.step)){var i=t.step;t.step=n=>{if(this._results=n,this.needsHeaderRow())this.processResults();else{if(this.processResults(),!this._results.data||this._results.data.length===0)return;this._stepCounter+=n.data.length,t.preview&&this._stepCounter>t.preview?this._parser.abort():i(this._results,this)}}}this._config=t}parse(t,i,n){var r=this._config.quoteChar||'"';if(this._config.newline||(this._config.newline=Rtt(t,r)),this._delimiterError=!1,this._config.delimiter)gc(this._config.delimiter)&&(this._config.delimiter=this._config.delimiter(t),this._results.meta.delimiter=this._config.delimiter);else{var s=this.guessDelimiter(t,this._config.newline,this._config.skipEmptyLines,this._config.comments,this._config.delimitersToGuess);s.successful?this._config.delimiter=s.bestDelimiter:(this._delimiterError=!0,this._config.delimiter=La.DefaultDelimiter),this._results.meta.delimiter=this._config.delimiter}var o=H4(this._config);return this._config.preview&&this._config.header&&o.preview++,this._input=t,this._parser=new s2(o),this._results=this._parser.parse(this._input,i,n),this.processResults(),this._paused?{meta:{paused:!0}}:this._results||{meta:{paused:!1}}}paused(){return this._paused}pause(){this._paused=!0,this._parser.abort(),this._input=this._input.substr(this._parser.getCharIndex())}resume(){this._paused=!1,this.streamer.parseChunk(this._input,!0)}aborted(){return this._aborted}abort(){this._aborted=!0,this._parser.abort(),this._results.meta.aborted=!0,gc(this._config.complete)&&this._config.complete(this._results),this._input=""}testEmptyLine(t){return this._config.skipEmptyLines==="greedy"?t.join("").trim()==="":t.length===1&&t[0].length===0}processResults(){if(this._results&&this._delimiterError&&(this.addError("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+La.DefaultDelimiter+"'"),this._delimiterError=!1),this._config.skipEmptyLines)for(var t=0;t<this._results.data.length;t++)this.testEmptyLine(this._results.data[t])&&this._results.data.splice(t--,1);return this.needsHeaderRow()&&this.fillHeaderFields(),this.applyHeaderAndDynamicTypingAndTransformation()}needsHeaderRow(){return this._config.header&&this._fields.length===0}fillHeaderFields(){if(!this._results)return;const t=n=>{gc(this._config.transformHeader)&&(n=this._config.transformHeader(n)),this._fields.push(n)};if(Array.isArray(this._results.data[0])){for(var i=0;this.needsHeaderRow()&&i<this._results.data.length;i++)this._results.data[i].forEach(t);this._results.data.splice(0,1)}else this._results.data.forEach(t)}shouldApplyDynamicTyping(t){return this._config.dynamicTypingFunction&&this._config.dynamicTyping[t]===void 0&&(this._config.dynamicTyping[t]=this._config.dynamicTypingFunction(t)),(this._config.dynamicTyping[t]||this._config.dynamicTyping)===!0}parseDynamic(t,i){return this.shouldApplyDynamicTyping(t)?i==="true"||i==="TRUE"?!0:i==="false"||i==="FALSE"?!1:Mtt.test(i)?parseFloat(i):Ptt.test(i)?new Date(i):i===""?null:i:i}applyHeaderAndDynamicTypingAndTransformation(){if(!this._results||!this._results.data||!this._config.header&&!this._config.dynamicTyping&&!this._config.transform)return this._results;var t=1;return!this._results.data[0]||Array.isArray(this._results.data[0])?(this._results.data=this._results.data.map(this.processRow.bind(this)),t=this._results.data.length):this._results.data=this.processRow(this._results.data,0),this._config.header&&this._results.meta&&(this._results.meta.fields=this._fields),this._rowCounter+=t,this._results}processRow(t,i){var n=this._config.header?{}:[],r;for(r=0;r<t.length;r++){var s=r,o=t[r];this._config.header&&(s=r>=this._fields.length?"__parsed_extra":this._fields[r]),this._config.transform&&(o=this._config.transform(o,s)),o=this.parseDynamic(s,o),s==="__parsed_extra"?(n[s]=n[s]||[],n[s].push(o)):n[s]=o}return this._config.header&&(r>this._fields.length?this.addError("FieldMismatch","TooManyFields","Too many fields: expected "+this._fields.length+" fields but parsed "+r,this._rowCounter+i):r<this._fields.length&&this.addError("FieldMismatch","TooFewFields","Too few fields: expected "+this._fields.length+" fields but parsed "+r,this._rowCounter+i)),n}guessDelimiter(t,i,n,r,s){var o,c,h;s=s||[",","	","|",";",La.RECORD_SEP,La.UNIT_SEP];for(var A=0;A<s.length;A++){var _=s[A],C=0,S=0,L=0;h=void 0;for(var N=new s2({comments:r,delimiter:_,newline:i,preview:10}).parse(t),U=0;U<N.data.length;U++){if(n&&this.testEmptyLine(N.data[U])){L++;continue}var H=N.data[U].length;if(S+=H,typeof h>"u"){h=0;continue}else H>1&&(C+=Math.abs(H-h),h=H)}N.data.length>0&&(S/=N.data.length-L),(typeof c>"u"||C>c)&&S>1.99&&(c=C,o=_)}return this._config.delimiter=o,{successful:!!o,bestDelimiter:o}}addError(t,i,n,r){this._results.errors.push({type:t,code:i,message:n,row:r})}}function Rtt(e,t){e=e.substr(0,1024*1024);var i=new RegExp(fg(t)+"([^]*?)"+fg(t),"gm");e=e.replace(i,"");var n=e.split("\r"),r=e.split(`
`),s=r.length>1&&r[0].length<n[0].length;if(n.length===1||s)return`
`;for(var o=0,c=0;c<n.length;c++)n[c][0]===`
`&&o++;return o>=n.length/2?`\r
`:"\r"}function fg(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function s2(e){e=e||{};var t=e.delimiter,i=e.newline,n=e.comments,r=e.step,s=e.preview,o=e.fastMode,c;e.quoteChar===void 0?c='"':c=e.quoteChar;var h=c;if(e.escapeChar!==void 0&&(h=e.escapeChar),(typeof t!="string"||La.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw new Error("Comment character same as delimiter");n===!0?n="#":(typeof n!="string"||La.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),i!==`
`&&i!=="\r"&&i!==`\r
`&&(i=`
`);var A=0,_=!1;this.parse=function(C,S,L){if(typeof C!="string")throw new Error("Input must be a string");var N=C.length,U=t.length,H=i.length,j=n.length,tt=gc(r);A=0;var K=[],Q=[],pt=[],$=0;if(!C)return se();if(o||o!==!1&&C.indexOf(c)===-1){for(var zt=C.split(i),Gt=0;Gt<zt.length;Gt++){const Me=zt[Gt];if(A+=Me.length,Gt!==zt.length-1)A+=i.length;else if(L)return se();if(!(n&&Me.substr(0,j)===n)){if(tt){if(K=[],Rt(Me.split(t)),de(),_)return se()}else Rt(Me.split(t));if(s&&Gt>=s)return K=K.slice(0,s),se(!0)}}return se()}for(var dt=C.indexOf(t,A),lt=C.indexOf(i,A),Lt=new RegExp(fg(h)+fg(c),"g"),J;;){if(C[A]===c){for(J=A,A++;;){if(J=C.indexOf(c,J+1),J===-1)return L||Q.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:K.length,index:A}),Zt();if(J===N-1){var ut=C.substring(A,J).replace(Lt,c);return Zt(ut)}if(c===h&&C[J+1]===h){J++;continue}if(!(c!==h&&J!==0&&C[J-1]===h)){var Et=lt===-1?dt:Math.min(dt,lt),le=Nt(Et);if(C[J+1+le]===t){if(pt.push(C.substring(A,J).replace(Lt,c)),A=J+1+le+U,dt=C.indexOf(t,A),lt=C.indexOf(i,A),tt&&(de(),_))return se();if(s&&K.length>=s)return se(!0);break}var Ct=Nt(lt);if(C.substr(J+1+Ct,H)===i){if(pt.push(C.substring(A,J).replace(Lt,c)),re(J+1+Ct+H),dt=C.indexOf(t,A),tt&&(de(),_))return se();if(s&&K.length>=s)return se(!0);break}Q.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:K.length,index:A}),J++}}if(tt&&(de(),_))return se();if(s&&K.length>=s)return se(!0);continue}if(n&&pt.length===0&&C.substr(A,j)===n){if(lt===-1)return se();A=lt+H,lt=C.indexOf(i,A),dt=C.indexOf(t,A);continue}if(dt!==-1&&(dt<lt||lt===-1)){pt.push(C.substring(A,dt)),A=dt+U,dt=C.indexOf(t,A);continue}if(lt!==-1){if(pt.push(C.substring(A,lt)),re(lt+H),tt&&(de(),_))return se();if(s&&K.length>=s)return se(!0);continue}break}return Zt();function Rt(Me){K.push(Me),$=A}function Nt(Me){var Se=0;if(Me!==-1){var oe=C.substring(J+1,Me);oe&&oe.trim()===""&&(Se=oe.length)}return Se}function Zt(Me){return L||(typeof Me>"u"&&(Me=C.substr(A)),pt.push(Me),A=N,Rt(pt),tt&&de()),se()}function re(Me){A=Me,Rt(pt),pt=[],lt=C.indexOf(i,A)}function se(Me,Se){var oe=Se||!1;return{data:oe?K[0]:K,errors:Q,meta:{delimiter:t,linebreak:i,aborted:_,truncated:!!Me,cursor:$+(S||0)}}}function de(){r(se(void 0,!0)),K=[],Q=[]}},this.abort=function(){_=!0},this.getCharIndex=function(){return A}}function H4(e){if(typeof e!="object"||e===null)return e;var t=Array.isArray(e)?[]:{};for(var i in e)t[i]=H4(e[i]);return t}function gc(e){return typeof e=="function"}const La={parse:Ttt,unparse:Stt,RECORD_SEP:"",UNIT_SEP:"",BYTE_ORDER_MARK:G4,BAD_DELIMITERS:["\r",`
`,'"',G4],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:s2,ParserHandle:V4,ChunkStreamer:j4},{ChunkStreamer:Dtt}=La;class Ott extends Dtt{textDecoder=new TextDecoder(this._config.encoding);constructor(t={}){super(t)}async stream(t){this._input=t;try{for await(const i of t)this.parseChunk(this.getStringChunk(i));this._finished=!0,this.parseChunk("")}catch(i){this._sendError(i)}}_nextChunk(){}getStringChunk(t){return typeof t=="string"?t:this.textDecoder.decode(t,{stream:!0})}}const Ltt="4.3.3",a2="object-row-table",c2={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:Ltt,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(e,t)=>W4(new TextDecoder().decode(e),t),parseText:(e,t)=>W4(e,t),parseInBatches:Ftt,options:{csv:{shape:a2,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function W4(e,t){const i={...c2.options.csv,...t?.csv},n=ktt(e),r=i.header==="auto"?J4(n):!!i.header,s={...i,header:r,download:!1,transformHeader:r?X4():void 0,error:_=>{throw new Error(_)}},o=La.parse(e,s),c=o.data,h=o.meta.fields||Q4(i.columnPrefix,n.length),A=i.shape||a2;switch(A){case"object-row-table":return{shape:"object-row-table",data:c.map(_=>Array.isArray(_)?k4(_,h):_)};case"array-row-table":return{shape:"array-row-table",data:c.map(_=>Array.isArray(_)?_:N4(_,h))};default:throw new Error(A)}}function Ftt(e,t){t={...t},t.batchSize==="auto"&&(t.batchSize=4e3);const i={...c2.options.csv,...t?.csv},n=new Btt;let r=!0,s=null,o=null,c=null;const h={...i,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(A){let _=A.data;if(i.skipEmptyLines&&_.flat().join("").trim()==="")return;const C=A.meta.cursor;if(r&&!s&&(i.header==="auto"?J4(_):i.header)){s=_.map(X4());return}r&&(r=!1,s||(s=Q4(i.columnPrefix,_.length)),c=Ntt(_,s)),i.optimizeMemoryUsage&&(_=JSON.parse(JSON.stringify(_)));const S=i.shape||a2;o=o||new c_(c,{shape:S,...t});try{o.addRow(_);const L=o&&o.getFullBatch({bytesUsed:C});L&&n.enqueue(L)}catch(L){n.enqueue(L)}},complete(A){try{const _=A.meta.cursor,C=o&&o.getFinalBatch({bytesUsed:_});C&&n.enqueue(C)}catch(_){n.enqueue(_)}n.close()}};return La.parse(e,h,Ott),n}function J4(e){return e&&e.every(t=>typeof t=="string")}function ktt(e){return La.parse(e,{dynamicTyping:!0,preview:1}).data[0]}function X4(){const e=new Set;return t=>{let i=t,n=1;for(;e.has(i);)i=`${t}.${n}`,n++;return e.add(i),i}}function Q4(e,t=0){const i=[];for(let n=0;n<t;n++)i.push(`${e}${n+1}`);return i}function Ntt(e,t){const i=t?{}:[];for(let n=0;n<e.length;n++){const r=t&&t[n]||n;switch(typeof e[n]){case"number":case"boolean":i[r]={name:String(r),index:n,type:Float32Array};break;case"string":default:i[r]={name:String(r),index:n,type:Array}}}return i}const Utt="4.3.3";async function K4(e,t,i,n){return n._parse(e,t,i,n)}function rf(e,t){if(!e)throw new Error("loader assertion failed.")}const q4=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Z4=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Z4&&parseFloat(Z4[1]);function ztt(e){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,e)}function Gtt(e){return globalThis.loaders?.modules?.[e]||null}function jtt(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const Vtt=jtt();function Htt(e,t){if(!e)throw new Error("loaders.gl assertion failed.")}const dg=typeof process!="object"||String(process)!=="[object process]"||process.browser,l2=typeof importScripts=="function",Y4=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Y4&&parseFloat(Y4[1]);const u2={};async function of(e,t=null,i={},n=null){return t&&(e=Wtt(e,t,i,n)),u2[e]=u2[e]||Jtt(e),await u2[e]}function Wtt(e,t,i={},n=null){if(!i.useLocalLibraries&&e.startsWith("http"))return e;n=n||e;const r=i.modules||{};return r[n]?r[n]:dg?i.CDN?(Htt(i.CDN.startsWith("http")),`${i.CDN}/${t}@${Vtt}/dist/libs/${n}`):l2?`../src/libs/${n}`:`modules/${t}/src/libs/${n}`:`modules/${t}/dist/libs/${n}`}async function Jtt(e){if(e.endsWith("wasm"))return await Qtt(e);if(!dg)try{const{requireFromFile:i}=globalThis.loaders||{};return await i?.(e)}catch(i){return console.error(i),null}if(l2)return importScripts(e);const t=await Ktt(e);return Xtt(t,e)}function Xtt(e,t){if(!dg){const{requireFromString:n}=globalThis.loaders||{};return n?.(e,t)}if(l2)return eval.call(globalThis,e),null;const i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e))}catch{i.text=e}return document.body.appendChild(i),null}async function Qtt(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return dg||!t||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await t(e)}async function Ktt(e){const{readFileAsText:t}=globalThis.loaders||{};return dg||!t||e.startsWith("http")?await(await fetch(e)).text():await t(e)}function qtt(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?$4(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?$4(e,0,t):""}function $4(e,t,i){if(e.byteLength<=t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}function Ztt(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${qtt(e)}"`)}}function tR(e,t,i){const n=i!==void 0?new Uint8Array(e).subarray(t,t+i):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}function pg(e,t){return rf(e>=0),rf(t>0),e+(t-1)&-4}function Ytt(e,t,i){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const r=e.byteOffset,s=e.byteLength;n=new Uint8Array(e.buffer||e.arrayBuffer,r,s)}return t.set(n,i),i+pg(n.byteLength,4)}const $tt=globalThis.loaders?.parseImageNode,h2=typeof Image<"u",f2=typeof ImageBitmap<"u",tet=!!$tt,d2=q4?!0:tet;function eet(e){switch(e){case"auto":return f2||h2||d2;case"imagebitmap":return f2;case"image":return h2;case"data":return d2;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function iet(){if(f2)return"imagebitmap";if(h2)return"image";if(d2)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function net(e){const t=ret(e);if(!t)throw new Error("Not an image");return t}function eR(e){switch(net(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function ret(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const oet=/^data:image\/svg\+xml/,set=/\.svg((\?|#).*)?$/;function p2(e){return e&&(oet.test(e)||set.test(e))}function aet(e,t){if(p2(t)){let i=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return iR(e,t)}function iR(e,t){if(p2(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function nR(e,t,i){const n=aet(e,i),r=self.URL||self.webkitURL,s=typeof n!="string"&&r.createObjectURL(n);try{return await cet(s||n,t)}finally{s&&r.revokeObjectURL(s)}}async function cet(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=s=>{const o=s instanceof Error?s.message:"error";r(new Error(o))}}catch(s){r(s)}})}const uet={};let rR=!0;async function het(e,t,i){let n;p2(i)?n=await nR(e,t,i):n=iR(e,i);const r=t&&t.imagebitmap;return await fet(n,r)}async function fet(e,t=null){if((det(t)||!rR)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(i){console.warn(i),rR=!1}return await createImageBitmap(e)}function det(e){for(const t in e||uet)return!1;return!0}function pet(e){return!yet(e,"ftyp",4)||(e[8]&96)===0?null:Aet(e)}function Aet(e){switch(get(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function get(e,t,i){return String.fromCharCode(...e.slice(t,i))}function met(e){return[...e].map(t=>t.charCodeAt(0))}function yet(e,t,i=0){const n=met(t);for(let r=0;r<n.length;++r)if(n[r]!==e[r+i])return!1;return!0}const al=!1,Ag=!0;function A2(e){const t=gg(e);return _et(t)||wet(t)||bet(t)||xet(t)||vet(t)}function vet(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),i=pet(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}function _et(e){const t=gg(e);return t.byteLength>=24&&t.getUint32(0,al)===2303741511?{mimeType:"image/png",width:t.getUint32(16,al),height:t.getUint32(20,al)}:null}function bet(e){const t=gg(e);return t.byteLength>=10&&t.getUint32(0,al)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Ag),height:t.getUint16(8,Ag)}:null}function xet(e){const t=gg(e);return t.byteLength>=14&&t.getUint16(0,al)===16973&&t.getUint32(2,Ag)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Ag),height:t.getUint32(22,Ag)}:null}function wet(e){const t=gg(e);if(!(t.byteLength>=3&&t.getUint16(0,al)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=Cet();let r=2;for(;r+9<t.byteLength;){const s=t.getUint16(r,al);if(n.has(s))return{mimeType:"image/jpeg",height:t.getUint16(r+5,al),width:t.getUint16(r+7,al)};if(!i.has(s))return null;r+=2,r+=t.getUint16(r,al)}return null}function Cet(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function gg(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function Eet(e,t){const{mimeType:i}=A2(e)||{},n=globalThis.loaders?.parseImageNode;return rf(n),await n(e,i)}async function Bet(e,t,i){t=t||{};const n=(t.image||{}).type||"auto",{url:r}=i||{},s=Tet(n);let o;switch(s){case"imagebitmap":o=await het(e,t,r);break;case"image":o=await nR(e,t,r);break;case"data":o=await Eet(e);break;default:rf(!1)}return n==="data"&&(o=eR(o)),o}function Tet(e){switch(e){case"auto":case"data":return iet();default:return eet(e),e}}const Iet=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Met=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Pet={image:{type:"auto",decode:!0}},Ret={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Utt,mimeTypes:Met,extensions:Iet,parse:Bet,tests:[e=>!!A2(new DataView(e))],options:Pet},g2={};function Det(e){if(g2[e]===void 0){const t=q4?Let(e):Oet(e);g2[e]=t}return g2[e]}function Oet(e){const t=["image/png","image/jpeg","image/gif"],i=globalThis.loaders?.imageFormatsNode||t;return!!globalThis.loaders?.parseImageNode&&i.includes(e)}function Let(e){switch(e){case"image/avif":case"image/webp":return Fet(e);default:return!0}}function Fet(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}function Fa(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const oR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sR={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},aR=["SCALAR","VEC2","VEC3","VEC4"],ket=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Net=new Map(ket),Uet={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zet={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Get={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function cR(e){return aR[e-1]||aR[0]}function Z0(e){const t=Net.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function lR(e,t){const i=Get[e.componentType],n=Uet[e.type],r=zet[e.componentType],s=e.count*n,o=e.count*n*r;Fa(o>=0&&o<=t.byteLength);const c=sR[e.componentType],h=oR[e.type];return{ArrayType:i,length:s,byteLength:o,componentByteSize:c,numberOfComponentsInElement:h}}function jet(e,t,i){const n=e.bufferViews[i];Fa(n);const r=n.buffer,s=t[r];Fa(s);const o=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,n.byteLength)}function Vet(e,t,i){const n=typeof i=="number"?e.accessors?.[i]:i;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const r=e.bufferViews?.[n.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:s,byteOffset:o}=t[r.buffer],c=(o||0)+(n.byteOffset||0)+(r.byteOffset||0),{ArrayType:h,length:A,componentByteSize:_,numberOfComponentsInElement:C}=lR(n,r),S=_*C,L=r.byteStride||S;if(typeof r.byteStride>"u"||r.byteStride===S)return new h(s,c,A);const N=new h(A);for(let U=0;U<n.count;U++){const H=new h(s,c+U*L,C);N.set(H,U*C)}return N}function Het(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let No=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Het(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof t=="string"||typeof i=="string"}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return t?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(t=>t===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,i=this.gltf.buffers[t];Fa(i);const n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return Vet(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(i,n,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){const n=e.extensions||{};n[t]=i}removeObjectExtension(e,t){const i=e?.extensions||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(t)||n.push(t)}delete i[t]}addExtension(e,t={}){return Fa(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return Fa(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:i,material:n,mode:r=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(i){const o=this._addIndices(i);s.primitives[0].indices=o}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const i=A2(e),n=t||i?.mimeType,r={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e,t=0,i=this.byteLength){const n=e.byteLength;Fa(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:t,byteOffset:i,byteLength:n};return this.byteLength+=pg(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:cR(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:Z0(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,t=new ArrayBuffer(e),i=new Uint8Array(t);let n=0;for(const r of this.sourceBuffers||[])n=Ytt(r,i,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let i=!0;for(;i;){const n=e.indexOf(t);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){const t={};for(const i in e){const n=e[i],r=this._getGltfAttributeName(i),s=this.addBinaryBuffer(n.value,n);t[r]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const n=e.subarray(0,t);for(const r of n)i.min.push(r),i.max.push(r);for(let r=t;r<e.length;r+=t)for(let s=0;s<t;s++)i.min[0+s]=Math.min(i.min[0+s],e[r+s]),i.max[0+s]=Math.max(i.max[0+s],e[r+s]);return i}};function uR(e){return(e%1+1)%1}const hR={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Wet={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},fR={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function m2(e,t){return fR[t]*hR[e]}function Y0(e,t,i,n){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),s=$0(r,"SCALAR",i,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function $0(e,t,i,n=1){const r=hR[t],s=Wet[i],o=fR[i],c=n*r,h=c*o;let A=e.buffer,_=e.byteOffset;return _%o!==0&&(A=new Uint8Array(A).slice(_,_+h).buffer,_=0),new s(A,_,c)}function y2(e,t,i){const n=`TEXCOORD_${t.texCoord||0}`,r=i.attributes[n],s=e.getTypedArrayForAccessor(r),o=e.gltf.json,c=t.index,h=o.textures?.[c]?.source;if(typeof h<"u"){const A=o.images?.[h]?.mimeType,_=e.gltf.images?.[h];if(_&&typeof _.width<"u"){const C=[];for(let S=0;S<s.length;S+=2){const L=Jet(_,A,s,S,t.channels);C.push(L)}return C}}return[]}function dR(e,t,i,n,r){if(!i?.length)return;const s=[];for(const _ of i){let C=n.findIndex(S=>S===_);C===-1&&(C=n.push(_)-1),s.push(C)}const o=new Uint32Array(s),c=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,h=e.addBufferView(o,c,0),A=e.addAccessor(h,{size:1,componentType:Z0(o),count:o.length});r.attributes[t]=A}function Jet(e,t,i,n,r=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[n],c=i[n+1];let h=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(h=4);const A=Xet(o,c,e,h);let _=0;for(const C of r){const S=typeof C=="number"?Object.values(s)[C]:s[C],L=A+S.offset,N=eR(e);if(N.data.length<=L)throw new Error(`${N.data.length} <= ${L}`);const U=N.data[L];_|=U<<S.shift}return _}function Xet(e,t,i,n=1){const r=i.width,s=uR(e)*(r-1),o=Math.round(s),c=i.height,h=uR(t)*(c-1),A=Math.round(h),_=i.components?i.components:n;return(A*r+o)*_}function pR(e,t,i,n,r){const s=[];for(let o=0;o<t;o++){const c=i[o],h=i[o+1]-i[o];if(h+c>n)break;const A=c/r,_=h/r;s.push(e.slice(A,A+_))}return s}function AR(e,t,i){const n=[];for(let r=0;r<t;r++){const s=r*i;n.push(e.slice(s,s+i))}return n}function gR(e,t,i,n){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],s=new TextDecoder("utf8");let o=0;for(let c=0;c<e;c++){const h=n[c+1]-n[c];if(h+o<=t.length){const A=t.subarray(o,h+o),_=s.decode(A);r.push(_),o+=h}}return r}return[]}const ep="EXT_mesh_features",Qet=ep;async function Ket(e,t){const i=new No(e);Zet(i,t)}function qet(e,t){const i=new No(e);return $et(i),i.createBinaryChunk(),i.gltf}function Zet(e,t){const i=e.gltf.json;if(i.meshes)for(const n of i.meshes)for(const r of n.primitives)Yet(e,r,t)}function Yet(e,t,i){if(!i?.gltf?.loadBuffers)return;const n=t.extensions?.[ep]?.featureIds;if(n)for(const r of n){let s;if(typeof r.attribute<"u"){const o=`_FEATURE_ID_${r.attribute}`,c=t.attributes[o];s=e.getTypedArrayForAccessor(c)}else typeof r.texture<"u"&&i?.gltf?.loadImages?s=y2(e,r.texture,t):s=[];r.data=s}}function $et(e,t){const i=e.gltf.json.meshes;if(i)for(const n of i)for(const r of n.primitives)eit(e,r)}function tit(e,t,i,n){t.extensions||(t.extensions={});let r=t.extensions[ep];r||(r={featureIds:[]},t.extensions[ep]=r);const{featureIds:s}=r,o={featureCount:i.length,propertyTable:n,data:i};s.push(o),e.addObjectExtension(t,ep,r)}function eit(e,t){const i=t.extensions?.[ep];if(!i)return;const n=i.featureIds;n.forEach((r,s)=>{if(r.data){const{accessorKey:o,index:c}=iit(t.attributes),h=new Uint32Array(r.data);n[s]={featureCount:h.length,propertyTable:r.propertyTable,attribute:c},e.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const A=e.addBufferView(h),_=e.addAccessor(A,{size:1,componentType:Z0(h),count:h.length});t.attributes[o]=_}})}function iit(e){const t="_FEATURE_ID_",i=Object.keys(e).filter(r=>r.indexOf(t)===0);let n=-1;for(const r of i){const s=Number(r.substring(t.length));s>n&&(n=s)}return n++,{accessorKey:`${t}${n}`,index:n}}const nit=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:tit,decode:Ket,encode:qet,name:Qet},Symbol.toStringTag,{value:"Module"})),ip="EXT_structural_metadata",rit=ip;async function oit(e,t){const i=new No(e);ait(i,t)}function sit(e,t){const i=new No(e);return wit(i),i.createBinaryChunk(),i.gltf}function ait(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(ip);i&&(t.gltf?.loadImages&&cit(e,i),lit(e,i))}function cit(e,t){const i=t.propertyTextures,n=e.gltf.json;if(i&&n.meshes)for(const r of n.meshes)for(const s of r.primitives)hit(e,i,s,t)}function lit(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.propertyTables;if(n&&r)for(const s in n){const o=uit(r,s);o&&dit(e,i,o)}}function uit(e,t){for(const i of e)if(i.class===t)return i;return null}function hit(e,t,i,n){if(!t)return;const r=i.extensions?.[ip]?.propertyTextures;if(r)for(const s of r){const o=t[s];fit(e,o,i,n)}}function fit(e,t,i,n){if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const r=t.class;for(const s in t.properties){const o=`${r}_${s}`,c=t.properties?.[s];if(!c)continue;c.data||(c.data=[]);const h=c.data,A=y2(e,c,i);A!==null&&(dR(e,o,A,h,i),c.data=h,n.dataAttributeNames.push(o))}}function dit(e,t,i){const n=t.classes?.[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const s in n.properties){const o=n.properties[s],c=i.properties?.[s];if(c){const h=pit(e,t,o,r,c);c.data=h}}}function pit(e,t,i,n,r){let s=[];const o=r.values,c=e.getTypedArrayForBufferView(o),h=Ait(e,i,r,n),A=git(e,r,n);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=mit(i,n,c,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{s=gR(n,c,h,A);break}case"ENUM":{s=yit(t,i,n,c,h);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function Ait(e,t,i,n){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?Y0(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",n):null}function git(e,t,i){return typeof t.stringOffsets<"u"?Y0(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}function mit(e,t,i,n){const r=e.array,s=e.count,o=m2(e.type,e.componentType),c=i.byteLength/o;let h;return e.componentType?h=$0(i,e.type,e.componentType,c):h=i,r?n?pR(h,t,n,i.length,o):s?AR(h,t,s):[]:h}function yit(e,t,i,n,r){const s=t.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=e.enums?.[s];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const c=o.valueType||"UINT16",h=m2(t.type,c),A=n.byteLength/h;let _=$0(n,t.type,c,A);if(_||(_=n),t.array){if(r)return vit({valuesData:_,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:h,enumEntry:o});const C=t.count;return C?_it(_,i,C,o):[]}return v2(_,0,i,o)}function vit(e){const{valuesData:t,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r,elementSize:s,enumEntry:o}=e,c=[];for(let h=0;h<i;h++){const A=n[h],_=n[h+1]-n[h];if(_+A>r)break;const C=A/s,S=_/s,L=v2(t,C,S,o);c.push(L)}return c}function _it(e,t,i,n){const r=[];for(let s=0;s<t;s++){const o=i*s,c=v2(e,o,i,n);r.push(c)}return r}function v2(e,t,i,n){const r=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+s],c=bit(n,o);c?r.push(c.name):r.push("")}return r}function bit(e,t){for(const i of e.values)if(i.value===t)return i;return null}const xit="schemaClassId";function wit(e,t){const i=e.getExtension(ip);if(i&&i.propertyTables)for(const n of i.propertyTables){const r=n.class,s=i.schema?.classes?.[r];n.properties&&s&&Cit(n,s,e)}}function Cit(e,t,i){for(const n in e.properties){const r=e.properties[n].data;if(r){const s=t.properties[n];if(s){const o=Sit(r,s,i);e.properties[n]=o}}}}function Eit(e,t,i=xit){let n=e.getExtension(ip);n||(n=e.addExtension(ip)),n.schema=Bit(t,i,n.schema);const r=Tit(t,i,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(r)-1}function Bit(e,t,i){const n=i??{id:"schema_id"},r={properties:{}};for(const s of e){const o={type:s.elementType,componentType:s.componentType};r.properties[s.name]=o}return n.classes={},n.classes[t]=r,n}function Tit(e,t,i){const n={class:t,count:0};let r=0;const s=i.classes?.[t];for(const o of e){if(r===0&&(r=o.values.length),r!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");s?.properties[o.name]&&(n.properties||(n.properties={}),n.properties[o.name]={values:0,data:o.values})}return n.count=r,n}function Sit(e,t,i){const n={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:s}=Pit(e);n.stringOffsets=_2(s,i),n.values=_2(r,i)}else if(t.type==="SCALAR"&&t.componentType){const r=Mit(e,t.componentType);n.values=_2(r,i)}return n}const Iit={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Mit(e,t){const i=[];for(const r of e)i.push(Number(r));const n=Iit[t];if(!n)throw new Error("Illegal component type");return new n(i)}function Pit(e){const t=new TextEncoder,i=[];let n=0;for(const h of e){const A=t.encode(h);n+=A.length,i.push(A)}const r=new Uint8Array(n),s=[];let o=0;for(const h of i)r.set(h,o),s.push(o),o+=h.length;s.push(o);const c=new Uint32Array(s);return{stringData:r,stringOffsets:c}}function _2(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const Rit=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:Eit,decode:oit,encode:sit,name:rit},Symbol.toStringTag,{value:"Module"})),mR="EXT_feature_metadata",Dit=mR;async function Oit(e,t){const i=new No(e);Lit(i,t)}function Lit(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(mR);i&&(t.gltf?.loadImages&&Fit(e,i),kit(e,i))}function Fit(e,t){const i=t.schema;if(!i)return;const n=i.classes,{featureTextures:r}=t;if(n&&r)for(const s in n){const o=n[s],c=Uit(r,s);c&&Git(e,c,o)}}function kit(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.featureTables;if(n&&r)for(const s in n){const o=Nit(r,s);o&&zit(e,i,o)}}function Nit(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function Uit(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function zit(e,t,i){if(!i.class)return;const n=t.classes?.[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const s in n.properties){const o=n.properties[s],c=i.properties?.[s];if(c){const h=jit(e,t,o,r,c);c.data=h}}}function Git(e,t,i){const n=t.class;for(const r in i.properties){const s=t?.properties?.[r];if(s){const o=Xit(e,s,n);s.data=o}}}function jit(e,t,i,n,r){let s=[];const o=r.bufferView,c=e.getTypedArrayForBufferView(o),h=Vit(e,i,r,n),A=Hit(e,i,r,n);return i.type==="STRING"||i.componentType==="STRING"?s=gR(n,c,h,A):Wit(i)&&(s=Jit(i,n,c,h)),s}function Vit(e,t,i,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?Y0(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",n):null}function Hit(e,t,i,n){return typeof i.stringOffsetBufferView<"u"?Y0(e,i.stringOffsetBufferView,i.offsetType||"UINT32",n):null}function Wit(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function Jit(e,t,i,n){const r=e.type==="ARRAY",s=e.componentCount,o="SCALAR",c=e.componentType||e.type,h=m2(o,c),A=i.byteLength/h,_=$0(i,o,c,A);return r?n?pR(_,t,n,i.length,h):s?AR(_,t,s):[]:_}function Xit(e,t,i){const n=e.gltf.json;if(!n.meshes)return[];const r=[];for(const s of n.meshes)for(const o of s.primitives)Qit(e,i,t,r,o);return r}function Qit(e,t,i,n,r){const s={channels:i.channels,...i.texture},o=y2(e,s,r);o&&dR(e,t,o,n,r)}const Kit=Object.freeze(Object.defineProperty({__proto__:null,decode:Oit,name:Dit},Symbol.toStringTag,{value:"Module"})),qit="4.3.3",Zit="4.3.3",ty={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let yR;async function vR(e){return ztt(e.modules),Gtt("basis")||(yR||=Yit(e),await yR)}async function Yit(e){let t=null,i=null;return[t,i]=await Promise.all([await of(ty.TRANSCODER,"textures",e),await of(ty.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await $it(t,i)}function $it(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,initializeBasis:o}=r;o(),n({BasisFile:s})})})}let b2;async function _R(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(b2=b2||tnt(e),await b2)}async function tnt(e){let t=null,i=null;return[t,i]=await Promise.all([await of(ty.ENCODER,"textures",e),await of(ty.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await ent(t,i)}function ent(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,KTX2File:o,initializeBasis:c,BasisEncoder:h}=r;c(),n({BasisFile:s,KTX2File:o,BasisEncoder:h})})})}const np={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},int=["","WEBKIT_","MOZ_"],bR={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let ey=null;function nnt(e){if(!ey){e=e||rnt()||void 0,ey=new Set;for(const t of int)for(const i in bR)if(e&&e.getExtension(`${t}${i}`)){const n=bR[i];ey.add(n)}}return ey}function rnt(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const da=[171,75,84,88,32,50,48,187,13,10,26,10];function ont(e){const t=new Uint8Array(e);return!(t.byteLength<da.length||t[0]!==da[0]||t[1]!==da[1]||t[2]!==da[2]||t[3]!==da[3]||t[4]!==da[4]||t[5]!==da[5]||t[6]!==da[6]||t[7]!==da[7]||t[8]!==da[8]||t[9]!==da[9]||t[10]!==da[10]||t[11]!==da[11])}const snt={etc1:{basisFormat:0,compressed:!0,format:np.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:np.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:np.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:np.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:np.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:np.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function ant(e,t){if(t.basis.containerFormat==="auto"){if(ont(e)){const n=await _R(t);return xR(n.KTX2File,e,t)}const{BasisFile:i}=await vR(t);return x2(i,e,t)}switch(t.basis.module){case"encoder":const i=await _R(t);switch(t.basis.containerFormat){case"ktx2":return xR(i.KTX2File,e,t);case"basis":default:return x2(i.BasisFile,e,t)}case"transcoder":default:const{BasisFile:n}=await vR(t);return x2(n,e,t)}}function x2(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const r=n.getNumImages(),s=[];for(let o=0;o<r;o++){const c=n.getNumLevels(o),h=[];for(let A=0;A<c;A++)h.push(cnt(n,o,A,i));s.push(h)}return s}finally{n.close(),n.delete()}}function cnt(e,t,i,n){const r=e.getImageWidth(t,i),s=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:c,format:h,basisFormat:A}=wR(n,o),_=e.getImageTranscodedSizeInBytes(t,i,A),C=new Uint8Array(_);if(!e.transcodeImage(C,t,i,A,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:C,compressed:c,format:h,hasAlpha:o}}function xR(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=n.getLevels(),s=[];for(let o=0;o<r;o++)s.push(lnt(n,o,i));return[s]}finally{n.close(),n.delete()}}function lnt(e,t,i){const{alphaFlag:n,height:r,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:c,basisFormat:h}=wR(i,n),A=e.getImageTranscodedSizeInBytes(t,0,0,h),_=new Uint8Array(A);if(!e.transcodeImage(_,t,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:_,compressed:o,levelSize:A,hasAlpha:n,format:c}}function wR(e,t){let i=e&&e.basis&&e.basis.format;return i==="auto"&&(i=CR()),typeof i=="object"&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),snt[i]}function CR(){const e=nnt();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const unt={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:Zit,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},hnt={...unt,parse:ant},rp=!0,ER=1735152710,w2=12,iy=8,fnt=1313821514,dnt=5130562,pnt=0,Ant=0,gnt=1;function mnt(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function ynt(e,t=0,i={}){const n=new DataView(e),{magic:r=ER}=i,s=n.getUint32(t,!1);return s===r||s===ER}function vnt(e,t,i=0,n={}){const r=new DataView(t),s=mnt(r,i+0),o=r.getUint32(i+4,rp),c=r.getUint32(i+8,rp);switch(Object.assign(e,{header:{byteOffset:i,byteLength:c,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=w2,e.version){case 1:return _nt(e,r,i);case 2:return bnt(e,r,i,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function _nt(e,t,i){rf(e.header.byteLength>w2+iy);const n=t.getUint32(i+0,rp),r=t.getUint32(i+4,rp);return i+=iy,rf(r===pnt),C2(e,t,i,n),i+=n,i+=E2(e,t,i,e.header.byteLength),i}function bnt(e,t,i,n){return rf(e.header.byteLength>w2+iy),xnt(e,t,i,n),i+e.header.byteLength}function xnt(e,t,i,n){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,rp),s=t.getUint32(i+4,rp);switch(i+=iy,s){case fnt:C2(e,t,i,r);break;case dnt:E2(e,t,i,r);break;case Ant:n.strict||C2(e,t,i,r);break;case gnt:n.strict||E2(e,t,i,r);break}i+=pg(r,4)}return i}function C2(e,t,i,n){const r=new Uint8Array(t.buffer,i,n),s=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(s),pg(n,4)}function E2(e,t,i,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:t.buffer}),pg(n,4)}function BR(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}const wnt="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Cnt="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Ent=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Bnt=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Tnt={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Snt={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Int(e,t,i,n,r,s="NONE"){const o=await Mnt();Dnt(o,o.exports[Snt[r]],e,t,i,n,o.exports[Tnt[s||"NONE"]])}let B2;async function Mnt(){return B2||(B2=Pnt()),B2}async function Pnt(){let e=wnt;WebAssembly.validate(Ent)&&(e=Cnt,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(Rnt(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function Rnt(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?Bnt[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}function Dnt(e,t,i,n,r,s,o){const c=e.exports.sbrk,h=n+3&-4,A=c(h*r),_=c(s.length),C=new Uint8Array(e.exports.memory.buffer);C.set(s,_);const S=t(A,n,r,_,s.length);if(S===0&&o&&o(A,h,r),i.set(C.subarray(A,A+n*r)),c(A-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const ny="EXT_meshopt_compression",Ont=ny;async function Lnt(e,t){const i=new No(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const n=[];for(const r of e.json.bufferViews||[])n.push(Fnt(i,r));await Promise.all(n),i.removeExtension(ny)}async function Fnt(e,t){const i=e.getObjectExtension(t,ny);if(i){const{byteOffset:n=0,byteLength:r=0,byteStride:s,count:o,mode:c,filter:h="NONE",buffer:A}=i,_=e.gltf.buffers[A],C=new Uint8Array(_.arrayBuffer,_.byteOffset+n,r),S=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await Int(S,o,s,C,c,h),e.removeObjectExtension(t,ny)}}const knt=Object.freeze(Object.defineProperty({__proto__:null,decode:Lnt,name:Ont},Symbol.toStringTag,{value:"Module"})),op="EXT_texture_webp",Nnt=op;function Unt(e,t){const i=new No(e);if(!Det("image/webp")){if(i.getRequiredExtensions().includes(op))throw new Error(`gltf: Required extension ${op} not supported by browser`);return}const{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,op);s&&(r.source=s.source),i.removeObjectExtension(r,op)}i.removeExtension(op)}const znt=Object.freeze(Object.defineProperty({__proto__:null,name:Nnt,preprocess:Unt},Symbol.toStringTag,{value:"Module"})),ry="KHR_texture_basisu",Gnt=ry;function jnt(e,t){const i=new No(e),{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,ry);s&&(r.source=s.source,i.removeObjectExtension(r,ry))}i.removeExtension(ry)}const Vnt=Object.freeze(Object.defineProperty({__proto__:null,name:Gnt,preprocess:jnt},Symbol.toStringTag,{value:"Module"})),Hnt="4.3.3",Wnt={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Hnt,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Jnt(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Xnt(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;const c=e.POSITION?e.POSITION.value:[],h=c&&c.length;for(let A=0;A<h;A+=3){const _=c[A],C=c[A+1],S=c[A+2];t=_<t?_:t,i=C<i?C:i,n=S<n?S:n,r=_>r?_:r,s=C>s?C:s,o=S>o?S:o}return[[t,i,n],[r,s,o]]}function Qnt(e,t,i){const n=Jnt(t.value),r=i||Knt(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:r}}function Knt(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}function qnt(e,t,i){const n=SR(t.metadata),r=[],s=Znt(t.attributes);for(const o in e){const c=e[o],h=TR(o,c,s[o]);r.push(h)}if(i){const o=TR("indices",i);r.push(o)}return{fields:r,metadata:n}}function Znt(e){const t={};for(const i in e){const n=e[i];t[n.name||"undefined"]=n}return t}function TR(e,t,i){const n=i?SR(i.metadata):void 0;return Qnt(e,t,n)}function SR(e){Object.entries(e);const t={};for(const i in e)t[`${i}.string`]=JSON.stringify(e[i]);return t}const IR={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ynt={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},$nt=4;let trt=class{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const n=this.decoder.GetEncodedGeometryType(i),r=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let s;switch(n){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(i,r);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(i,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!r.ptr){const _=`DRACO decompression failed: ${s.error_msg()}`;throw new Error(_)}const o=this._getDracoLoaderData(r,n,t),c=this._getMeshData(r,o,t),h=Xnt(c.attributes),A=qnt(c.attributes,o,c.indices);return{loader:"draco",loaderData:o,header:{vertexCount:r.num_points(),boundingBox:h},...c,schema:A}}finally{this.draco.destroy(i),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,i){const n=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:r}}_getDracoAttributes(e,t){const i={};for(let n=0;n<e.num_attributes();n++){const r=this.decoder.GetAttribute(e,n),s=this._getAttributeMetadata(e,n);i[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:n,metadata:s};const o=this._getQuantizationTransform(r,t);o&&(i[r.unique_id()].quantization_transform=o);const c=this._getOctahedronTransform(r,t);c&&(i[r.unique_id()].octahedron_transform=c)}return i}_getMeshData(e,t,i){const n=this._getMeshAttributes(t,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,t,i){const n={};for(const r of Object.values(e.attributes)){const s=this._deduceAttributeName(r,i);r.name=s;const o=this._getAttributeValues(t,r);if(o){const{value:c,size:h}=o;n[s]={value:c,size:h,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}}return n}_getTriangleListIndices(e){const t=e.num_faces()*3,i=t*$nt,n=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,n),new Uint32Array(this.draco.HEAPF32.buffer,n,t).slice()}finally{this.draco._free(n)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),nrt(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const i=Ynt[t.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const n=t.num_components,r=e.num_points()*n,s=r*i.BYTES_PER_ELEMENT,o=ert(this.draco,i);let c;const h=this.draco._malloc(s);try{const A=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,A,o,s,h),c=new i(this.draco.HEAPF32.buffer,h,r).slice()}finally{this.draco._free(h)}return{value:c,size:n}}_deduceAttributeName(e,t){const i=e.unique_id;for(const[s,o]of Object.entries(t.extraAttributes||{}))if(o===i)return s;const n=e.attribute_type;for(const s in IR)if(this.draco[s]===n)return IR[s];const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){const r=this.metadataQuerier.GetEntryName(e,n);t[r]=this._getDracoMetadataField(e,r)}return t}_getDracoMetadataField(e,t){const i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);const n=irt(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:i=[]}=e,n=[...t,...i];for(const r of n)this.decoder.SkipAttributeTransform(this.draco[r])}_getQuantizationTransform(e,t){const{quantizedAttributes:i=[]}=t,n=e.attribute_type();if(i.map(r=>this.decoder[r]).includes(n)){const r=new this.draco.AttributeQuantizationTransform;try{if(r.InitFromAttribute(e))return{quantization_bits:r.quantization_bits(),range:r.range(),min_values:new Float32Array([1,2,3]).map(s=>r.min_value(s))}}finally{this.draco.destroy(r)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:i=[]}=t,n=e.attribute_type();if(i.map(r=>this.decoder[r]).includes(n)){const r=new this.draco.AttributeQuantizationTransform;try{if(r.InitFromAttribute(e))return{quantization_bits:r.quantization_bits()}}finally{this.draco.destroy(r)}}return null}};function ert(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function irt(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}function nrt(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}const rrt="1.5.6",ort="1.4.1",T2=`https://www.gstatic.com/draco/versioned/decoders/${rrt}`,zs={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},S2={[zs.DECODER]:`${T2}/${zs.DECODER}`,[zs.DECODER_WASM]:`${T2}/${zs.DECODER_WASM}`,[zs.FALLBACK_DECODER]:`${T2}/${zs.FALLBACK_DECODER}`,[zs.ENCODER]:`https://raw.githubusercontent.com/google/draco/${ort}/javascript/${zs.ENCODER}`};let I2;async function srt(e){const t=e.modules||{};return t.draco3d?I2||=t.draco3d.createDecoderModule({}).then(i=>({draco:i})):I2||=art(e),await I2}async function art(e){let t,i;switch(e.draco&&e.draco.decoderType){case"js":t=await of(S2[zs.FALLBACK_DECODER],"draco",e,zs.FALLBACK_DECODER);break;case"wasm":default:[t,i]=await Promise.all([await of(S2[zs.DECODER],"draco",e,zs.DECODER),await of(S2[zs.DECODER_WASM],"draco",e,zs.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await crt(t,i)}function crt(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e({...i,onModuleLoaded:r=>n({draco:r})})})}const lrt={...Wnt,parse:urt};async function urt(e,t){const{draco:i}=await srt(t),n=new trt(i);try{return n.parseSync(e,t?.draco)}finally{n.destroy()}}function hrt(e){const t={};for(const i in e){const n=e[i];if(i!=="indices"){const r=MR(n);t[i]=r}}return t}function MR(e){const{buffer:t,size:i,count:n}=frt(e);return{value:t,size:i,byteOffset:0,count:n,type:cR(i),componentType:Z0(t)}}function frt(e){let t=e,i=1,n=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=drt(t,Float32Array)),n=t.length/i),{buffer:t,size:i,count:n}}function drt(e,t,i=!1){return e?Array.isArray(e)?new t(e):i&&!(e instanceof t)?new t(e):e:null}const qu="KHR_draco_mesh_compression",prt=qu;function Art(e,t,i){const n=new No(e);for(const r of PR(n))n.getObjectExtension(r,qu)}async function grt(e,t,i){if(!t?.gltf?.decompressMeshes)return;const n=new No(e),r=[];for(const s of PR(n))n.getObjectExtension(s,qu)&&r.push(yrt(n,s,t,i));await Promise.all(r),n.removeExtension(qu)}function mrt(e,t={}){const i=new No(e);for(const n of i.json.meshes||[])vrt(n),i.addRequiredExtension(qu)}async function yrt(e,t,i,n){const r=e.getObjectExtension(t,qu);if(!r)return;const s=e.getTypedArrayForBufferView(r.bufferView),o=tR(s.buffer,s.byteOffset),c={...i};delete c["3d-tiles"];const h=await K4(o,lrt,c,n),A=hrt(h.attributes);for(const[_,C]of Object.entries(A))if(_ in t.attributes){const S=t.attributes[_],L=e.getAccessor(S);L?.min&&L?.max&&(C.min=L.min,C.max=L.max)}t.attributes=A,h.indices&&(t.indices=MR(h.indices)),e.removeObjectExtension(t,qu),_rt(t)}function vrt(e,t,i=4,n,r){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=n.DracoWriter.encodeSync({attributes:e}),o=r?.parseSync?.({attributes:e}),c=n._addFauxAttributes(o.attributes),h=n.addBufferView(s);return{primitives:[{attributes:c,mode:i,extensions:{[qu]:{bufferView:h,attributes:c}}}]}}function _rt(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*PR(e){for(const t of e.json.meshes||[])for(const i of t.primitives)yield i}const brt=Object.freeze(Object.defineProperty({__proto__:null,decode:grt,encode:mrt,name:prt,preprocess:Art},Symbol.toStringTag,{value:"Module"})),oy="KHR_texture_transform",xrt=oy,sy=new fe,wrt=new gr,Crt=new gr;async function Ert(e,t){if(!new No(e).hasExtension(oy)||!t.gltf?.loadBuffers)return;const i=e.json.materials||[];for(let n=0;n<i.length;n++)Brt(n,e)}function Brt(e,t){const i=t.json.materials?.[e],n=[i?.pbrMetallicRoughness?.baseColorTexture,i?.emissiveTexture,i?.normalTexture,i?.occlusionTexture,i?.pbrMetallicRoughness?.metallicRoughnessTexture],r=[];for(const s of n)s&&s?.extensions?.[oy]&&Trt(t,e,s,r)}function Trt(e,t,i,n){const r=Srt(i,n);if(!r)return;const s=e.json.meshes||[];for(const o of s)for(const c of o.primitives){const h=c.material;Number.isFinite(h)&&t===h&&Irt(e,c,r)}}function Srt(e,t){const i=e.extensions?.[oy],{texCoord:n=0}=e,{texCoord:r=n}=i;if(t.findIndex(([s,o])=>s===n&&o===r)===-1){const s=Rrt(i);return n!==r&&(e.texCoord=r),t.push([n,r]),{originalTexCoord:n,texCoord:r,matrix:s}}return null}function Irt(e,t,i){const{originalTexCoord:n,texCoord:r,matrix:s}=i,o=t.attributes[`TEXCOORD_${n}`];if(Number.isFinite(o)){const c=e.json.accessors?.[o];if(c&&c.bufferView){const h=e.json.bufferViews?.[c.bufferView];if(h){const{arrayBuffer:A,byteOffset:_}=e.buffers[h.buffer],C=(_||0)+(c.byteOffset||0)+(h.byteOffset||0),{ArrayType:S,length:L}=lR(c,h),N=sR[c.componentType],U=oR[c.type],H=h.byteStride||N*U,j=new Float32Array(L);for(let tt=0;tt<c.count;tt++){const K=new S(A,C+tt*H,2);sy.set(K[0],K[1],1),sy.transformByMatrix3(s),j.set([sy[0],sy[1]],tt*U)}n===r?Mrt(c,h,e.buffers,j):Prt(r,c,t,e,j)}}}}function Mrt(e,t,i,n){e.componentType=5126,i.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function Prt(e,t,i,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=n.json.accessors;o&&(o.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}function Rrt(e){const{offset:t=[0,0],rotation:i=0,scale:n=[1,1]}=e,r=new gr().set(1,0,0,0,1,0,t[0],t[1],1),s=wrt.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=Crt.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}const Drt=Object.freeze(Object.defineProperty({__proto__:null,decode:Ert,name:xrt},Symbol.toStringTag,{value:"Module"})),sf="KHR_lights_punctual",Ort=sf;async function Lrt(e){const t=new No(e),{json:i}=t,n=t.getExtension(sf);n&&(t.json.lights=n.lights,t.removeExtension(sf));for(const r of i.nodes||[]){const s=t.getObjectExtension(r,sf);s&&(r.light=s.light),t.removeObjectExtension(r,sf)}}async function Frt(e){const t=new No(e),{json:i}=t;if(i.lights){const n=t.addExtension(sf);Fa(!n.lights),n.lights=i.lights,delete i.lights}if(t.json.lights){for(const n of t.json.lights){const r=n.node;t.addObjectExtension(r,sf,n)}delete t.json.lights}}const krt=Object.freeze(Object.defineProperty({__proto__:null,decode:Lrt,encode:Frt,name:Ort},Symbol.toStringTag,{value:"Module"})),mg="KHR_materials_unlit",Nrt=mg;async function Urt(e){const t=new No(e),{json:i}=t;for(const n of i.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,mg);t.removeExtension(mg)}function zrt(e){const t=new No(e),{json:i}=t;if(t.materials)for(const n of i.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,mg,{}),t.addExtension(mg))}const Grt=Object.freeze(Object.defineProperty({__proto__:null,decode:Urt,encode:zrt,name:Nrt},Symbol.toStringTag,{value:"Module"})),yg="KHR_techniques_webgl",jrt=yg;async function Vrt(e){const t=new No(e),{json:i}=t,n=t.getExtension(yg);if(n){const r=Wrt(n,t);for(const s of i.materials||[]){const o=t.getObjectExtension(s,yg);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=Jrt(s.technique,t)),t.removeObjectExtension(s,yg)}t.removeExtension(yg)}}async function Hrt(e,t){}function Wrt(e,t){const{programs:i=[],shaders:n=[],techniques:r=[]}=e,s=new TextDecoder;return n.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(o=>{o.fragmentShader=n[o.fragmentShader],o.vertexShader=n[o.vertexShader]}),r.forEach(o=>{o.program=i[o.program]}),r}function Jrt(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in i)&&(i[n]=e.uniforms[n].value)}),Object.keys(i).forEach(n=>{typeof i[n]=="object"&&i[n].index!==void 0&&(i[n].texture=t.getTexture(i[n].index))}),i}const Xrt=Object.freeze(Object.defineProperty({__proto__:null,decode:Vrt,encode:Hrt,name:jrt},Symbol.toStringTag,{value:"Module"})),RR=[Rit,nit,knt,znt,Vnt,brt,krt,Grt,Xrt,Drt,Kit];function Qrt(e,t={},i){const n=RR.filter(r=>DR(r.name,t));for(const r of n)r.preprocess?.(e,t,i)}async function Krt(e,t={},i){const n=RR.filter(r=>DR(r.name,t));for(const r of n)await r.decode?.(e,t,i)}function DR(e,t){const i=t?.gltf?.excludeExtensions||{};return!(e in i&&!i[e])}const M2="KHR_binary_glTF";function qrt(e){const t=new No(e),{json:i}=t;for(const n of i.images||[]){const r=t.getObjectExtension(n,M2);r&&Object.assign(n,r),t.removeObjectExtension(n,M2)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(M2)}const OR={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Zrt={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let Yrt=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),qrt(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in OR)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(const n in i){const r=i[n];r.id=r.id||n;const s=e[t].length;e[t].push(r),this.idToIndexMap[t][n]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in OR)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:i,indices:n,material:r}=t;for(const s in i)i[s]=this._convertIdToIndex(i[s],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const i of e[t])for(const n in i){const r=i[n],s=this._convertIdToIndex(r,n);i[n]=s}}_convertIdToIndex(e,t){const i=Zrt[t];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,n=e.textures.findIndex(r=>r.id===i);n!==-1&&(t.pbrMetallicRoughness.baseColorTexture={index:n})}}};function $rt(e,t={}){return new Yrt().normalize(e,t)}async function tot(e,t,i=0,n,r){return eot(e,t,i,n),$rt(e,{normalize:n?.gltf?.normalize}),Qrt(e,n,r),n?.gltf?.loadBuffers&&e.json.buffers&&await iot(e,n,r),n?.gltf?.loadImages&&await not(e,n,r),await Krt(e,n,r),e}function eot(e,t,i,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!ynt(t,i,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=Ztt(t);else if(t instanceof ArrayBuffer){const o={};i=vnt(o,t,i,n.glb),Fa(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else Fa(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function iot(e,t,i){const n=e.json.buffers||[];for(let r=0;r<n.length;++r){const s=n[r];if(s.uri){const{fetch:o}=i;Fa(o);const c=BR(s.uri,t),h=await(await i?.fetch?.(c))?.arrayBuffer?.();e.buffers[r]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete s.uri}else e.buffers[r]===null&&(e.buffers[r]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function not(e,t,i){const n=rot(e),r=e.json.images||[],s=[];for(const o of n)s.push(oot(e,r[o],o,t,i));return await Promise.all(s)}function rot(e){const t=new Set,i=e.json.textures||[];for(const n of i)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function oot(e,t,i,n,r){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const c=BR(t.uri,n),{fetch:h}=r;s=await(await h(c)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const c=jet(e.json,e.buffers,t.bufferView);s=tR(c.buffer,c.byteOffset,c.byteLength)}Fa(s,"glTF image has no data");let o=await K4(s,[Ret,hnt],{...n,mimeType:t.mimeType,basis:n.basis||{format:CR()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}const P2={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:qit,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:sot,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function sot(e,t={},i){t={...P2.options,...t},t.gltf={...P2.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await tot({},e,n,t,i)}var As=1e-6,sp=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function aot(){var e=new sp(4);return sp!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function cot(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function lot(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3];return e[0]=i[0]*n+i[4]*r+i[8]*s+i[12]*o,e[1]=i[1]*n+i[5]*r+i[9]*s+i[13]*o,e[2]=i[2]*n+i[6]*r+i[10]*s+i[14]*o,e[3]=i[3]*n+i[7]*r+i[11]*s+i[15]*o,e}(function(){var e=aot();return function(t,i,n,r,s,o){var c,h;for(i||(i=4),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,c=n;c<h;c+=i)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],s(e,e,o),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}})();function ay(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ap(e,t){const i=lot([],t,e);return cot(i,i,1/i[3]),i}function LR(e,t){const i=e%t;return i<0?t+i:i}function uot(e,t,i){return i*t+(1-i)*e}function R2(e,t,i){return e<t?t:e>i?i:e}function hot(e){return Math.log(e)*Math.LOG2E}const D2=Math.log2||hot;function fot(e,t){var i=t[0],n=t[1],r=t[2],s=t[3],o=t[4],c=t[5],h=t[6],A=t[7],_=t[8],C=t[9],S=t[10],L=t[11],N=t[12],U=t[13],H=t[14],j=t[15],tt=i*c-n*o,K=i*h-r*o,Q=i*A-s*o,pt=n*h-r*c,$=n*A-s*c,zt=r*A-s*h,Gt=_*U-C*N,dt=_*H-S*N,lt=_*j-L*N,Lt=C*H-S*U,J=C*j-L*U,ut=S*j-L*H,Et=tt*ut-K*J+Q*Lt+pt*lt-$*dt+zt*Gt;return Et?(Et=1/Et,e[0]=(c*ut-h*J+A*Lt)*Et,e[1]=(r*J-n*ut-s*Lt)*Et,e[2]=(U*zt-H*$+j*pt)*Et,e[3]=(S*$-C*zt-L*pt)*Et,e[4]=(h*lt-o*ut-A*dt)*Et,e[5]=(i*ut-r*lt+s*dt)*Et,e[6]=(H*Q-N*zt-j*K)*Et,e[7]=(_*zt-S*Q+L*K)*Et,e[8]=(o*J-c*lt+A*Gt)*Et,e[9]=(n*lt-i*J-s*Gt)*Et,e[10]=(N*$-U*Q+j*tt)*Et,e[11]=(C*Q-_*$-L*tt)*Et,e[12]=(c*dt-o*Lt-h*Gt)*Et,e[13]=(i*Lt-n*dt+r*Gt)*Et,e[14]=(U*K-N*pt-H*tt)*Et,e[15]=(_*pt-C*K+S*tt)*Et,e):null}function O2(e,t,i){var n=t[0],r=t[1],s=t[2],o=t[3],c=t[4],h=t[5],A=t[6],_=t[7],C=t[8],S=t[9],L=t[10],N=t[11],U=t[12],H=t[13],j=t[14],tt=t[15],K=i[0],Q=i[1],pt=i[2],$=i[3];return e[0]=K*n+Q*c+pt*C+$*U,e[1]=K*r+Q*h+pt*S+$*H,e[2]=K*s+Q*A+pt*L+$*j,e[3]=K*o+Q*_+pt*N+$*tt,K=i[4],Q=i[5],pt=i[6],$=i[7],e[4]=K*n+Q*c+pt*C+$*U,e[5]=K*r+Q*h+pt*S+$*H,e[6]=K*s+Q*A+pt*L+$*j,e[7]=K*o+Q*_+pt*N+$*tt,K=i[8],Q=i[9],pt=i[10],$=i[11],e[8]=K*n+Q*c+pt*C+$*U,e[9]=K*r+Q*h+pt*S+$*H,e[10]=K*s+Q*A+pt*L+$*j,e[11]=K*o+Q*_+pt*N+$*tt,K=i[12],Q=i[13],pt=i[14],$=i[15],e[12]=K*n+Q*c+pt*C+$*U,e[13]=K*r+Q*h+pt*S+$*H,e[14]=K*s+Q*A+pt*L+$*j,e[15]=K*o+Q*_+pt*N+$*tt,e}function L2(e,t,i){var n=i[0],r=i[1],s=i[2],o,c,h,A,_,C,S,L,N,U,H,j;return t===e?(e[12]=t[0]*n+t[4]*r+t[8]*s+t[12],e[13]=t[1]*n+t[5]*r+t[9]*s+t[13],e[14]=t[2]*n+t[6]*r+t[10]*s+t[14],e[15]=t[3]*n+t[7]*r+t[11]*s+t[15]):(o=t[0],c=t[1],h=t[2],A=t[3],_=t[4],C=t[5],S=t[6],L=t[7],N=t[8],U=t[9],H=t[10],j=t[11],e[0]=o,e[1]=c,e[2]=h,e[3]=A,e[4]=_,e[5]=C,e[6]=S,e[7]=L,e[8]=N,e[9]=U,e[10]=H,e[11]=j,e[12]=o*n+_*r+N*s+t[12],e[13]=c*n+C*r+U*s+t[13],e[14]=h*n+S*r+H*s+t[14],e[15]=A*n+L*r+j*s+t[15]),e}function FR(e,t,i){var n=i[0],r=i[1],s=i[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function dot(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[4],o=t[5],c=t[6],h=t[7],A=t[8],_=t[9],C=t[10],S=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*r+A*n,e[5]=o*r+_*n,e[6]=c*r+C*n,e[7]=h*r+S*n,e[8]=A*r-s*n,e[9]=_*r-o*n,e[10]=C*r-c*n,e[11]=S*r-h*n,e}function pot(e,t,i){var n=Math.sin(i),r=Math.cos(i),s=t[0],o=t[1],c=t[2],h=t[3],A=t[4],_=t[5],C=t[6],S=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*r+A*n,e[1]=o*r+_*n,e[2]=c*r+C*n,e[3]=h*r+S*n,e[4]=A*r-s*n,e[5]=_*r-o*n,e[6]=C*r-c*n,e[7]=S*r-h*n,e}function Aot(e,t,i,n,r){var s=1/Math.tan(t/2),o;return e[0]=s/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(o=1/(n-r),e[10]=(r+n)*o,e[14]=2*r*n*o):(e[10]=-1,e[14]=-2*n),e}var got=Aot;function kR(e,t){var i=e[0],n=e[1],r=e[2],s=e[3],o=e[4],c=e[5],h=e[6],A=e[7],_=e[8],C=e[9],S=e[10],L=e[11],N=e[12],U=e[13],H=e[14],j=e[15],tt=t[0],K=t[1],Q=t[2],pt=t[3],$=t[4],zt=t[5],Gt=t[6],dt=t[7],lt=t[8],Lt=t[9],J=t[10],ut=t[11],Et=t[12],le=t[13],Ct=t[14],Rt=t[15];return Math.abs(i-tt)<=As*Math.max(1,Math.abs(i),Math.abs(tt))&&Math.abs(n-K)<=As*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(r-Q)<=As*Math.max(1,Math.abs(r),Math.abs(Q))&&Math.abs(s-pt)<=As*Math.max(1,Math.abs(s),Math.abs(pt))&&Math.abs(o-$)<=As*Math.max(1,Math.abs(o),Math.abs($))&&Math.abs(c-zt)<=As*Math.max(1,Math.abs(c),Math.abs(zt))&&Math.abs(h-Gt)<=As*Math.max(1,Math.abs(h),Math.abs(Gt))&&Math.abs(A-dt)<=As*Math.max(1,Math.abs(A),Math.abs(dt))&&Math.abs(_-lt)<=As*Math.max(1,Math.abs(_),Math.abs(lt))&&Math.abs(C-Lt)<=As*Math.max(1,Math.abs(C),Math.abs(Lt))&&Math.abs(S-J)<=As*Math.max(1,Math.abs(S),Math.abs(J))&&Math.abs(L-ut)<=As*Math.max(1,Math.abs(L),Math.abs(ut))&&Math.abs(N-Et)<=As*Math.max(1,Math.abs(N),Math.abs(Et))&&Math.abs(U-le)<=As*Math.max(1,Math.abs(U),Math.abs(le))&&Math.abs(H-Ct)<=As*Math.max(1,Math.abs(H),Math.abs(Ct))&&Math.abs(j-Rt)<=As*Math.max(1,Math.abs(j),Math.abs(Rt))}function mot(){var e=new sp(2);return sp!=Float32Array&&(e[0]=0,e[1]=0),e}function F2(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function yot(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function vot(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function _ot(e){var t=e[0],i=e[1];return Math.hypot(t,i)}function bot(e,t){return e[0]=-t[0],e[1]=-t[1],e}function NR(e,t,i,n){var r=t[0],s=t[1];return e[0]=r+n*(i[0]-r),e[1]=s+n*(i[1]-s),e}var xot=yot;(function(){var e=mot();return function(t,i,n,r,s,o){var c,h;for(i||(i=2),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,c=n;c<h;c+=i)e[0]=t[c],e[1]=t[c+1],s(e,e,o),t[c]=e[0],t[c+1]=e[1];return t}})();function wot(){var e=new sp(3);return sp!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Cot(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function Eot(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function Bot(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}var Tot=Eot;(function(){var e=wot();return function(t,i,n,r,s,o){var c,h;for(i||(i=3),n||(n=0),r?h=Math.min(r*i+n,t.length):h=t.length,c=n;c<h;c+=i)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],s(e,e,o),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}})();function Zu(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}const mc=Math.PI,UR=mc/4,cl=mc/180,k2=180/mc,vg=512,zR=4003e4,cy=85.051129,GR=1.5;function N2(e){return Math.pow(2,e)}function Sot(e){return D2(e)}function Yu(e){const[t,i]=e;Zu(Number.isFinite(t)),Zu(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");const n=t*cl,r=i*cl,s=vg*(n+mc)/(2*mc),o=vg*(mc+Math.log(Math.tan(UR+r*.5)))/(2*mc);return[s,o]}function $u(e){const[t,i]=e,n=t/vg*(2*mc)-mc,r=2*(Math.atan(Math.exp(i/vg*(2*mc)-mc))-UR);return[n*k2,r*k2]}function Iot(e){const{latitude:t,longitude:i,highPrecision:n=!1}=e;Zu(Number.isFinite(t)&&Number.isFinite(i));const r=vg,s=Math.cos(t*cl),o=r/360,c=o/s,h=r/zR/s,A={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[o,c,h],degreesPerUnit:[1/o,1/c,1/h]};if(n){const _=cl*Math.tan(t*cl)/s,C=o*_/2,S=r/zR*_,L=S/c*h;A.unitsPerDegree2=[0,C,S],A.unitsPerMeter2=[L,0,L]}return A}function Mot(e){const{height:t,pitch:i,bearing:n,altitude:r,scale:s,center:o}=e,c=ay();L2(c,c,[0,0,-r]),dot(c,c,-i*cl),pot(c,c,n*cl);const h=s/t;return FR(c,c,[h,h,h]),o&&L2(c,c,Bot([],o)),c}function Pot(e){const{width:t,height:i,altitude:n,pitch:r=0,offset:s,center:o,scale:c,nearZMultiplier:h=1,farZMultiplier:A=1}=e;let{fovy:_=ly(GR)}=e;n!==void 0&&(_=ly(n));const C=_*cl,S=r*cl,L=jR(_);let N=L;o&&(N+=o[2]*c/Math.cos(S)/i);const U=C*(.5+(s?s[1]:0)/i),H=Math.sin(U)*N/Math.sin(R2(Math.PI/2-S-U,.01,Math.PI-.01)),j=Math.sin(S)*H+N,tt=N*10,K=Math.min(j*A,tt);return{fov:C,aspect:t/i,focalDistance:L,near:h,far:K}}function Rot(e){const{fov:t,aspect:i,near:n,far:r}=Pot(e);return got([],t,i,n,r)}function ly(e){return 2*Math.atan(.5/e)*k2}function jR(e){return .5/Math.tan(.5*e*cl)}function Dot(e,t){const[i,n,r=0]=e;return Zu(Number.isFinite(i)&&Number.isFinite(n)&&Number.isFinite(r)),ap(t,[i,n,r,1])}function VR(e,t,i=0){const[n,r,s]=e;if(Zu(Number.isFinite(n)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s))return ap(t,[n,r,s,1]);const o=ap(t,[n,r,0,1]),c=ap(t,[n,r,1,1]),h=o[2],A=c[2],_=h===A?0:((i||0)-h)/(A-h);return NR([],o,c,_)}function Oot(e){const{width:t,height:i,bounds:n,minExtent:r=0,maxZoom:s=24,offset:o=[0,0]}=e,[[c,h],[A,_]]=n,C=Lot(e.padding),S=Yu([c,R2(_,-cy,cy)]),L=Yu([A,R2(h,-cy,cy)]),N=[Math.max(Math.abs(L[0]-S[0]),r),Math.max(Math.abs(L[1]-S[1]),r)],U=[t-C.left-C.right-Math.abs(o[0])*2,i-C.top-C.bottom-Math.abs(o[1])*2];Zu(U[0]>0&&U[1]>0);const H=U[0]/N[0],j=U[1]/N[1],tt=(C.right-C.left)/2/H,K=(C.top-C.bottom)/2/j,Q=[(L[0]+S[0])/2+tt,(L[1]+S[1])/2+K],pt=$u(Q),$=Math.min(s,D2(Math.abs(Math.min(H,j))));return Zu(Number.isFinite($)),{longitude:pt[0],latitude:pt[1],zoom:$}}function Lot(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(Zu(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}const HR=Math.PI/180;function Fot(e,t=0){const{width:i,height:n,unproject:r}=e,s={targetZ:t},o=r([0,n],s),c=r([i,n],s);let h,A;const _=e.fovy?.5*e.fovy*HR:Math.atan(.5/e.altitude),C=(90-e.pitch)*HR;return _>C-.01?(h=WR(e,0,t),A=WR(e,i,t)):(h=r([0,0],s),A=r([i,0],s)),[o,c,A,h]}function WR(e,t,i){const{pixelUnprojectionMatrix:n}=e,r=ap(n,[t,0,1,1]),s=ap(n,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-r[2])/(s[2]-r[2]),c=NR([],r,s,o),h=$u(c);return h.push(i),h}class ml{constructor(t={width:1,height:1}){Ci(this,"latitude",void 0),Ci(this,"longitude",void 0),Ci(this,"zoom",void 0),Ci(this,"pitch",void 0),Ci(this,"bearing",void 0),Ci(this,"altitude",void 0),Ci(this,"fovy",void 0),Ci(this,"meterOffset",void 0),Ci(this,"center",void 0),Ci(this,"width",void 0),Ci(this,"height",void 0),Ci(this,"scale",void 0),Ci(this,"distanceScales",void 0),Ci(this,"viewMatrix",void 0),Ci(this,"projectionMatrix",void 0),Ci(this,"viewProjectionMatrix",void 0),Ci(this,"pixelProjectionMatrix",void 0),Ci(this,"pixelUnprojectionMatrix",void 0),Ci(this,"equals",j=>j instanceof ml?j.width===this.width&&j.height===this.height&&kR(j.projectionMatrix,this.projectionMatrix)&&kR(j.viewMatrix,this.viewMatrix):!1),Ci(this,"project",(j,tt={})=>{const{topLeft:K=!0}=tt,Q=this.projectPosition(j),pt=Dot(Q,this.pixelProjectionMatrix),[$,zt]=pt,Gt=K?zt:this.height-zt;return j.length===2?[$,Gt]:[$,Gt,pt[2]]}),Ci(this,"unproject",(j,tt={})=>{const{topLeft:K=!0,targetZ:Q=void 0}=tt,[pt,$,zt]=j,Gt=K?$:this.height-$,dt=Q&&Q*this.distanceScales.unitsPerMeter[2],lt=VR([pt,Gt,zt],this.pixelUnprojectionMatrix,dt),[Lt,J,ut]=this.unprojectPosition(lt);return Number.isFinite(zt)?[Lt,J,ut]:Number.isFinite(Q)?[Lt,J,Q]:[Lt,J]}),Ci(this,"projectPosition",j=>{const[tt,K]=Yu(j),Q=(j[2]||0)*this.distanceScales.unitsPerMeter[2];return[tt,K,Q]}),Ci(this,"unprojectPosition",j=>{const[tt,K]=$u(j),Q=(j[2]||0)*this.distanceScales.metersPerUnit[2];return[tt,K,Q]});let{width:i,height:n,altitude:r=null,fovy:s=null}=t;const{latitude:o=0,longitude:c=0,zoom:h=0,pitch:A=0,bearing:_=0,position:C=null,nearZMultiplier:S=.02,farZMultiplier:L=1.01}=t;i=i||1,n=n||1,s===null&&r===null?(r=GR,s=ly(r)):s===null?s=ly(r):r===null&&(r=jR(s));const N=N2(h);r=Math.max(.75,r);const U=Iot({longitude:c,latitude:o}),H=Yu([c,o]);H.push(0),C&&Cot(H,H,Tot([],C,U.unitsPerMeter)),this.projectionMatrix=Rot({width:i,height:n,scale:N,center:H,pitch:A,fovy:s,nearZMultiplier:S,farZMultiplier:L}),this.viewMatrix=Mot({height:n,scale:N,center:H,pitch:A,bearing:_,altitude:r}),this.width=i,this.height=n,this.scale=N,this.latitude=o,this.longitude=c,this.zoom=h,this.pitch=A,this.bearing=_,this.altitude=r,this.fovy=s,this.center=H,this.meterOffset=C||[0,0,0],this.distanceScales=U,this._initMatrices(),Object.freeze(this)}_initMatrices(){const{width:t,height:i,projectionMatrix:n,viewMatrix:r}=this,s=ay();O2(s,s,n),O2(s,s,r),this.viewProjectionMatrix=s;const o=ay();FR(o,o,[t/2,-i/2,1]),L2(o,o,[1,-1,0]),O2(o,o,s);const c=fot(ay(),o);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=c}projectFlat(t){return Yu(t)}unprojectFlat(t){return $u(t)}getMapCenterByLngLatPosition({lngLat:t,pos:i}){const n=VR(i,this.pixelUnprojectionMatrix),r=Yu(t),s=F2([],r,bot([],n)),o=F2([],this.center,s);return $u(o)}fitBounds(t,i={}){const{width:n,height:r}=this,{longitude:s,latitude:o,zoom:c}=Oot(Object.assign({width:n,height:r,bounds:t},i));return new ml({width:n,height:r,longitude:s,latitude:o,zoom:c})}getBounds(t){const i=this.getBoundingRegion(t),n=Math.min(...i.map(c=>c[0])),r=Math.max(...i.map(c=>c[0])),s=Math.min(...i.map(c=>c[1])),o=Math.max(...i.map(c=>c[1]));return[[n,s],[r,o]]}getBoundingRegion(t={}){return Fot(this,t.z||0)}getLocationAtPoint({lngLat:t,pos:i}){return this.getMapCenterByLngLatPosition({lngLat:t,pos:i})}}const JR=512;function kot(e){const{width:t,height:i,pitch:n=0}=e;let{longitude:r,latitude:s,zoom:o,bearing:c=0}=e;(r<-180||r>180)&&(r=LR(r+180,360)-180),(c<-180||c>180)&&(c=LR(c+180,360)-180);const h=D2(i/JR);if(o<=h)o=h,s=0;else{const A=i/2/Math.pow(2,o),_=$u([0,A])[1];if(s<_)s=_;else{const C=$u([0,JR-A])[1];s>C&&(s=C)}}return{width:t,height:i,longitude:r,latitude:s,zoom:o,pitch:n,bearing:c}}const XR=.01,Not=["longitude","latitude","zoom"],QR={curve:1.414,speed:1.2};function Uot(e,t,i,n){const{startZoom:r,startCenterXY:s,uDelta:o,w0:c,u1:h,S:A,rho:_,rho2:C,r0:S}=KR(e,t,n);if(h<XR){const Q={};for(const pt of Not){const $=e[pt],zt=t[pt];Q[pt]=uot($,zt,i)}return Q}const L=i*A,N=Math.cosh(S)/Math.cosh(S+_*L),U=c*((Math.cosh(S)*Math.tanh(S+_*L)-Math.sinh(S))/C)/h,H=1/N,j=r+Sot(H),tt=vot([],o,U);F2(tt,tt,s);const K=$u(tt);return{longitude:K[0],latitude:K[1],zoom:j}}function zot(e,t,i){const n={...QR,...i},{screenSpeed:r,speed:s,maxDuration:o}=n,{S:c,rho:h}=KR(e,t,n),A=1e3*c;let _;return Number.isFinite(r)?_=A/(r/h):_=A/s,Number.isFinite(o)&&_>o?0:_}function KR(e,t,i){i=Object.assign({},QR,i);const n=i.curve,r=e.zoom,s=[e.longitude,e.latitude],o=N2(r),c=t.zoom,h=[t.longitude,t.latitude],A=N2(c-r),_=Yu(s),C=Yu(h),S=xot([],C,_),L=Math.max(e.width,e.height),N=L/A,U=_ot(S)*o,H=Math.max(U,XR),j=n*n,tt=(N*N-L*L+j*j*H*H)/(2*L*j*H),K=(N*N-L*L-j*j*H*H)/(2*N*j*H),Q=Math.log(Math.sqrt(tt*tt+1)-tt),pt=Math.log(Math.sqrt(K*K+1)-K),$=(pt-Q)/n;return{startZoom:r,startCenterXY:_,uDelta:S,w0:L,u1:U,S:$,rho:n,rho2:j,r0:Q,r1:pt}}var Ql=typeof document<"u"?document:{};function qR(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function uy(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?qR(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qR(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}function ZR(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=Got(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,c;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,c=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw c}}}}function Got(e,t){if(e){if(typeof e=="string")return YR(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return YR(e,t)}}function YR(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var jot=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function U2(e){if(!e)return null;if(typeof e=="string")return e;e.toJS&&(e=e.toJS());var t={},i=ZR(e.layers),n;try{for(i.s();!(n=i.n()).done;){var r=n.value;t[r.id]=r}}catch(o){i.e(o)}finally{i.f()}var s=e.layers.map(function(o){var c=t[o.ref],h=null;if("interactive"in o&&(h=uy({},o),delete h.interactive),c){h=h||uy({},o),delete h.ref;var A=ZR(jot),_;try{for(A.s();!(_=A.n()).done;){var C=_.value;C in c&&(h[C]=c[C])}}catch(S){A.e(S)}finally{A.f()}}return h||o});return uy(uy({},e),{},{layers:s})}function Vot(){}function Hot(e){e&&console.error(e.error)}var $R={container:Ae.object,gl:Ae.object,mapboxApiAccessToken:Ae.string,mapboxApiUrl:Ae.string,attributionControl:Ae.bool,preserveDrawingBuffer:Ae.bool,reuseMaps:Ae.bool,transformRequest:Ae.func,mapOptions:Ae.object,mapStyle:Ae.oneOfType([Ae.string,Ae.object]),preventStyleDiffing:Ae.bool,visible:Ae.bool,asyncRender:Ae.bool,onLoad:Ae.func,onError:Ae.func,width:Ae.number,height:Ae.number,viewState:Ae.object,longitude:Ae.number,latitude:Ae.number,zoom:Ae.number,bearing:Ae.number,pitch:Ae.number,altitude:Ae.number},hy={container:Ql.body,mapboxApiAccessToken:Wot(),mapboxApiUrl:"https://api.mapbox.com",preserveDrawingBuffer:!1,attributionControl:!0,reuseMaps:!1,mapOptions:{},mapStyle:"mapbox://styles/mapbox/light-v8",preventStyleDiffing:!1,visible:!0,asyncRender:!1,onLoad:Vot,onError:Hot,width:0,height:0,longitude:0,latitude:0,zoom:0,bearing:0,pitch:0,altitude:1.5};function Wot(){var e=null;if(typeof window<"u"&&window.location){var t=window.location.search.match(/access_token=([^&\/]*)/);e=t&&t[1]}return!e&&typeof process<"u"&&(e=e||process.env.MapboxAccessToken||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN),e||"no-token"}function tD(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"component";e.debug&&Ae.checkPropTypes($R,e,"prop",t)}var af=function(){function e(t){var i=this;if(Fu(this,e),Ci(this,"props",hy),Ci(this,"width",0),Ci(this,"height",0),Ci(this,"_fireLoadEvent",function(){i.props.onLoad({type:"load",target:i._map})}),Ci(this,"_handleError",function(n){i.props.onError(n)}),!t.mapboxgl)throw new Error("Mapbox not available");this.mapboxgl=t.mapboxgl,e.initialized||(e.initialized=!0,this._checkStyleSheet(this.mapboxgl.version)),this._initialize(t)}return Lu(e,[{key:"finalize",value:function(){return this._destroy(),this}},{key:"setProps",value:function(t){return this._update(this.props,t),this}},{key:"redraw",value:function(){var t=this._map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}},{key:"getMap",value:function(){return this._map}},{key:"_reuse",value:function(t){this._map=e.savedMap;var i=this._map.getContainer(),n=t.container;for(n.classList.add("mapboxgl-map");i.childNodes.length>0;)n.appendChild(i.childNodes[0]);this._map._container=n,e.savedMap=null,t.mapStyle&&this._map.setStyle(U2(t.mapStyle),{diff:!1}),this._map.isStyleLoaded()?this._fireLoadEvent():this._map.once("styledata",this._fireLoadEvent)}},{key:"_create",value:function(t){if(t.reuseMaps&&e.savedMap)this._reuse(t);else{if(t.gl){var i=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(){return HTMLCanvasElement.prototype.getContext=i,t.gl}}var n={container:t.container,center:[0,0],zoom:8,pitch:0,bearing:0,maxZoom:24,style:U2(t.mapStyle),interactive:!1,trackResize:!1,attributionControl:t.attributionControl,preserveDrawingBuffer:t.preserveDrawingBuffer};t.transformRequest&&(n.transformRequest=t.transformRequest),this._map=new this.mapboxgl.Map(Object.assign({},n,t.mapOptions)),this._map.once("load",this._fireLoadEvent),this._map.on("error",this._handleError)}return this}},{key:"_destroy",value:function(){this._map&&(this.props.reuseMaps&&!e.savedMap?(e.savedMap=this._map,this._map.off("load",this._fireLoadEvent),this._map.off("error",this._handleError),this._map.off("styledata",this._fireLoadEvent)):this._map.remove(),this._map=null)}},{key:"_initialize",value:function(t){var i=this;t=Object.assign({},hy,t),tD(t,"Mapbox"),this.mapboxgl.accessToken=t.mapboxApiAccessToken||hy.mapboxApiAccessToken,this.mapboxgl.baseApiUrl=t.mapboxApiUrl,this._create(t);var n=t,r=n.container;Object.defineProperty(r,"offsetWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(r,"clientWidth",{configurable:!0,get:function(){return i.width}}),Object.defineProperty(r,"offsetHeight",{configurable:!0,get:function(){return i.height}}),Object.defineProperty(r,"clientHeight",{configurable:!0,get:function(){return i.height}});var s=this._map.getCanvas();s&&(s.style.outline="none"),this._updateMapViewport({},t),this._updateMapSize({},t),this.props=t}},{key:"_update",value:function(t,i){if(this._map){i=Object.assign({},this.props,i),tD(i,"Mapbox");var n=this._updateMapViewport(t,i),r=this._updateMapSize(t,i);this._updateMapStyle(t,i),!i.asyncRender&&(n||r)&&this.redraw(),this.props=i}}},{key:"_updateMapStyle",value:function(t,i){var n=t.mapStyle!==i.mapStyle;n&&this._map.setStyle(U2(i.mapStyle),{diff:!i.preventStyleDiffing})}},{key:"_updateMapSize",value:function(t,i){var n=t.width!==i.width||t.height!==i.height;return n&&(this.width=i.width,this.height=i.height,this._map.resize()),n}},{key:"_updateMapViewport",value:function(t,i){var n=this._getViewState(t),r=this._getViewState(i),s=r.latitude!==n.latitude||r.longitude!==n.longitude||r.zoom!==n.zoom||r.pitch!==n.pitch||r.bearing!==n.bearing||r.altitude!==n.altitude;return s&&(this._map.jumpTo(this._viewStateToMapboxProps(r)),r.altitude!==n.altitude&&(this._map.transform.altitude=r.altitude)),s}},{key:"_getViewState",value:function(t){var i=t.viewState||t,n=i.longitude,r=i.latitude,s=i.zoom,o=i.pitch,c=o===void 0?0:o,h=i.bearing,A=h===void 0?0:h,_=i.altitude,C=_===void 0?1.5:_;return{longitude:n,latitude:r,zoom:s,pitch:c,bearing:A,altitude:C}}},{key:"_checkStyleSheet",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"0.47.0";if(!(typeof Ql>"u"))try{var i=Ql.createElement("div");i.className="mapboxgl-map",i.style.display="none",Ql.body.appendChild(i);var n=window.getComputedStyle(i).position!=="static";if(!n){var r=Ql.createElement("link");r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.setAttribute("href","https://api.tiles.mapbox.com/mapbox-gl-js/v".concat(t,"/mapbox-gl.css")),Ql.head.appendChild(r)}}catch{}}},{key:"_viewStateToMapboxProps",value:function(t){return{center:[t.longitude,t.latitude],zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}}}]),e}();Ci(af,"initialized",!1),Ci(af,"propTypes",$R),Ci(af,"defaultProps",hy),Ci(af,"savedMap",null);var z2={exports:{}},Jot=z2.exports,eD;function Xot(){return eD||(eD=1,function(e,t){(function(i,n){e.exports=n()})(Jot,function(){var i,n,r;function s(o,c){if(!i)i=c;else if(!n)n=c;else{var h="var sharedChunk = {}; ("+i+")(sharedChunk); ("+n+")(sharedChunk);",A={};i(A),r=c(A),typeof window<"u"&&(r.workerUrl=window.URL.createObjectURL(new Blob([h],{type:"text/javascript"})))}}return s(["exports"],function(o){function c(a,u){return a(u={exports:{}},u.exports),u.exports}var h=A;function A(a,u,p,x){this.cx=3*a,this.bx=3*(p-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(x-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=x,this.p2x=p,this.p2y=x}A.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},A.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},A.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},A.prototype.solveCurveX=function(a,u){var p,x,B,I,D;for(u===void 0&&(u=1e-6),B=a,D=0;D<8;D++){if(I=this.sampleCurveX(B)-a,Math.abs(I)<u)return B;var k=this.sampleCurveDerivativeX(B);if(Math.abs(k)<1e-6)break;B-=I/k}if((B=a)<(p=0))return p;if(B>(x=1))return x;for(;p<x;){if(I=this.sampleCurveX(B),Math.abs(I-a)<u)return B;a>I?p=B:x=B,B=.5*(x-p)+p}return B},A.prototype.solve=function(a,u){return this.sampleCurveY(this.solveCurveX(a,u))};var _=C;function C(a,u){this.x=a,this.y=u}C.prototype={clone:function(){return new C(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,u){return this.clone()._rotateAround(a,u)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var u=a.x-this.x,p=a.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,u){return Math.atan2(this.x*u-this.y*a,this.x*a+this.y*u)},_matMult:function(a){var u=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=u,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var u=Math.cos(a),p=Math.sin(a),x=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=x,this},_rotateAround:function(a,u){var p=Math.cos(a),x=Math.sin(a),B=u.y+x*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-x*(this.y-u.y),this.y=B,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},C.convert=function(a){return a instanceof C?a:Array.isArray(a)?new C(a[0],a[1]):a};var S=typeof self<"u"?self:{},L=Math.pow(2,53)-1;function N(a,u,p,x){var B=new h(a,u,p,x);return function(I){return B.solve(I)}}var U=N(.25,.1,.25,1);function H(a,u,p){return Math.min(p,Math.max(u,a))}function j(a,u,p){var x=p-u,B=((a-u)%x+x)%x+u;return B===u?p:B}function tt(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,B=u;x<B.length;x+=1){var I=B[x];for(var D in I)a[D]=I[D]}return a}var K=1;function Q(){return K++}function pt(){return function a(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function $(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function zt(a,u){a.forEach(function(p){u[p]&&(u[p]=u[p].bind(u))})}function Gt(a,u){return a.indexOf(u,a.length-u.length)!==-1}function dt(a,u,p){var x={};for(var B in a)x[B]=u.call(p||this,a[B],B,a);return x}function lt(a,u,p){var x={};for(var B in a)u.call(p||this,a[B],B,a)&&(x[B]=a[B]);return x}function Lt(a){return Array.isArray(a)?a.map(Lt):typeof a=="object"&&a?dt(a,Lt):a}var J={};function ut(a){J[a]||(typeof console<"u"&&console.warn(a),J[a]=!0)}function Et(a,u,p){return(p.y-a.y)*(u.x-a.x)>(u.y-a.y)*(p.x-a.x)}function le(a){for(var u=0,p=0,x=a.length,B=x-1,I=void 0,D=void 0;p<x;B=p++)u+=((D=a[B]).x-(I=a[p]).x)*(I.y+D.y);return u}function Ct(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rt(a){var u={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(x,B,I,D){var k=I||D;return u[B]=!k||k.toLowerCase(),""}),u["max-age"]){var p=parseInt(u["max-age"],10);isNaN(p)?delete u["max-age"]:u["max-age"]=p}return u}var Nt=null;function Zt(a){if(Nt==null){var u=a.navigator?a.navigator.userAgent:null;Nt=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Nt}function re(a){try{var u=S[a];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch{return!1}}var se,de,Me,Se,oe=S.performance&&S.performance.now?S.performance.now.bind(S.performance):Date.now.bind(Date),Ai=S.requestAnimationFrame||S.mozRequestAnimationFrame||S.webkitRequestAnimationFrame||S.msRequestAnimationFrame,Ke=S.cancelAnimationFrame||S.mozCancelAnimationFrame||S.webkitCancelAnimationFrame||S.msCancelAnimationFrame,qe={now:oe,frame:function(a){var u=Ai(a);return{cancel:function(){return Ke(u)}}},getImageData:function(a,u){u===void 0&&(u=0);var p=S.document.createElement("canvas"),x=p.getContext("2d");if(!x)throw new Error("failed to create canvas 2d context");return p.width=a.width,p.height=a.height,x.drawImage(a,0,0,a.width,a.height),x.getImageData(-u,-u,a.width+2*u,a.height+2*u)},resolveURL:function(a){return se||(se=S.document.createElement("a")),se.href=a,se.href},hardwareConcurrency:S.navigator&&S.navigator.hardwareConcurrency||4,get devicePixelRatio(){return S.devicePixelRatio},get prefersReducedMotion(){return!!S.matchMedia&&(de==null&&(de=S.matchMedia("(prefers-reduced-motion: reduce)")),de.matches)}},Ve={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},di={supported:!1,testSupport:function(a){!cn&&Se&&(Ri?bi(a):Me=a)}},cn=!1,Ri=!1;function bi(a){var u=a.createTexture();a.bindTexture(a.TEXTURE_2D,u);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Se),a.isContextLost())return;di.supported=!0}catch{}a.deleteTexture(u),cn=!0}S.document&&((Se=S.document.createElement("img")).onload=function(){Me&&bi(Me),Me=null,Ri=!0},Se.onerror=function(){cn=!0,Me=null},Se.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Vn="01",yi=function(a,u){this._transformRequestFn=a,this._customAccessToken=u,this._createSkuToken()};function vi(a){return a.indexOf("mapbox:")===0}yi.prototype._createSkuToken=function(){var a=function(){for(var u="",p=0;p<10;p++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Vn,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},yi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},yi.prototype.transformRequest=function(a,u){return this._transformRequestFn&&this._transformRequestFn(a,u)||{url:a}},yi.prototype.normalizeStyleURL=function(a,u){if(!vi(a))return a;var p=Yn(a);return p.path="/styles/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},yi.prototype.normalizeGlyphsURL=function(a,u){if(!vi(a))return a;var p=Yn(a);return p.path="/fonts/v1"+p.path,this._makeAPIURL(p,this._customAccessToken||u)},yi.prototype.normalizeSourceURL=function(a,u){if(!vi(a))return a;var p=Yn(a);return p.path="/v4/"+p.authority+".json",p.params.push("secure"),this._makeAPIURL(p,this._customAccessToken||u)},yi.prototype.normalizeSpriteURL=function(a,u,p,x){var B=Yn(a);return vi(a)?(B.path="/styles/v1"+B.path+"/sprite"+u+p,this._makeAPIURL(B,this._customAccessToken||x)):(B.path+=""+u+p,mn(B))},yi.prototype.normalizeTileURL=function(a,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!vi(a))return a;var p=Yn(a);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,(qe.devicePixelRatio>=2||u===512?"@2x":"")+(di.supported?".webp":"$1")),p.path=p.path.replace(/^.+\/v4\//,"/"),p.path="/v4"+p.path;var x=this._customAccessToken||function(B){for(var I=0,D=B;I<D.length;I+=1){var k=D[I].match(/^access_token=(.*)$/);if(k)return k[1]}return null}(p.params)||Ve.ACCESS_TOKEN;return Ve.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&p.params.push("sku="+this._skuToken),this._makeAPIURL(p,x)},yi.prototype.canonicalizeTileURL=function(a,u){var p=Yn(a);if(!p.path.match(/(^\/v4\/)/)||!p.path.match(/\.[\w]+$/))return a;var x="mapbox://tiles/";x+=p.path.replace("/v4/","");var B=p.params;return u&&(B=B.filter(function(I){return!I.match(/^access_token=/)})),B.length&&(x+="?"+B.join("&")),x},yi.prototype.canonicalizeTileset=function(a,u){for(var p=!!u&&vi(u),x=[],B=0,I=a.tiles||[];B<I.length;B+=1){var D=I[B];Di(D)?x.push(this.canonicalizeTileURL(D,p)):x.push(D)}return x},yi.prototype._makeAPIURL=function(a,u){var p="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",x=Yn(Ve.API_URL);if(a.protocol=x.protocol,a.authority=x.authority,a.protocol==="http"){var B=a.params.indexOf("secure");B>=0&&a.params.splice(B,1)}if(x.path!=="/"&&(a.path=""+x.path+a.path),!Ve.REQUIRE_ACCESS_TOKEN)return mn(a);if(!(u=u||Ve.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+p);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+p);return a.params=a.params.filter(function(I){return I.indexOf("access_token")===-1}),a.params.push("access_token="+u),mn(a)};var un=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Di(a){return un.test(a)}var lr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Yn(a){var u=a.match(lr);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function mn(a){var u=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+u}function ir(a){if(!a)return null;var u=a.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(S.atob(u[1]).split("").map(function(p){return"%"+("00"+p.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Hn=function(a){this.type=a,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Hn.prototype.getStorageKey=function(a){var u,p=ir(Ve.ACCESS_TOKEN);return u=p&&p.u?S.btoa(encodeURIComponent(p.u).replace(/%([0-9A-F]{2})/g,function(x,B){return String.fromCharCode(+("0x"+B))})):Ve.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+u:"mapbox.eventData:"+u},Hn.prototype.fetchEventData=function(){var a=re("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{var x=S.localStorage.getItem(u);x&&(this.eventData=JSON.parse(x));var B=S.localStorage.getItem(p);B&&(this.anonId=B)}catch{ut("Unable to read from LocalStorage")}},Hn.prototype.saveEventData=function(){var a=re("localStorage"),u=this.getStorageKey(),p=this.getStorageKey("uuid");if(a)try{S.localStorage.setItem(p,this.anonId),Object.keys(this.eventData).length>=1&&S.localStorage.setItem(u,JSON.stringify(this.eventData))}catch{ut("Unable to write to LocalStorage")}},Hn.prototype.processRequests=function(a){},Hn.prototype.postEvent=function(a,u,p,x){var B=this;if(Ve.EVENTS_URL){var I=Yn(Ve.EVENTS_URL);I.params.push("access_token="+(x||Ve.ACCESS_TOKEN||""));var D={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Vn,userId:this.anonId},k=u?tt(D,u):D,G={url:mn(I),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=ce(G,function(X){B.pendingRequest=null,p(X),B.saveEventData(),B.processRequests(x)})}},Hn.prototype.queueRequest=function(a,u){this.queue.push(a),this.processRequests(u)};var Tn,$n,Ge=function(a){function u(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(p,x,B,I){this.skuToken=B;var D=!(!I&&!Ve.ACCESS_TOKEN),k=Array.isArray(p)&&p.some(function(G){return vi(G)||Di(G)});Ve.EVENTS_URL&&D&&k&&this.queueRequest({id:x,timestamp:Date.now()},I)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){var B=this.queue.shift(),I=B.id,D=B.timestamp;I&&this.success[I]||(this.anonId||this.fetchEventData(),$(this.anonId)||(this.anonId=pt()),this.postEvent(D,{skuToken:this.skuToken},function(k){k||I&&(x.success[I]=!0)},p))}},u}(Hn),gi=new(function(a){function u(p){a.call(this,"appUserTurnstile"),this._customAccessToken=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(p,x){Ve.EVENTS_URL&&Ve.ACCESS_TOKEN&&Array.isArray(p)&&p.some(function(B){return vi(B)||Di(B)})&&this.queueRequest(Date.now(),x)},u.prototype.processRequests=function(p){var x=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var B=ir(Ve.ACCESS_TOKEN),I=B?B.u:Ve.ACCESS_TOKEN,D=I!==this.eventData.tokenU;$(this.anonId)||(this.anonId=pt(),D=!0);var k=this.queue.shift();if(this.eventData.lastSuccess){var G=new Date(this.eventData.lastSuccess),X=new Date(k),Y=(k-this.eventData.lastSuccess)/864e5;D=D||Y>=1||Y<-1||G.getDate()!==X.getDate()}else D=!0;if(!D)return this.processRequests();this.postEvent(k,{"enabled.telemetry":!1},function(rt){rt||(x.eventData.lastSuccess=k,x.eventData.tokenU=I)},p)}},u}(Hn)),Mi=gi.postTurnstileEvent.bind(gi),rn=new Ge,yr=rn.postMapLoadEvent.bind(rn),St=500,ke=50;function Je(){S.caches&&!Tn&&(Tn=S.caches.open("mapbox-tiles"))}function li(a){var u=a.indexOf("?");return u<0?a:a.slice(0,u)}var Yt,Re=1/0;function gt(){return Yt==null&&(Yt=S.OffscreenCanvas&&new S.OffscreenCanvas(1,1).getContext("2d")&&typeof S.createImageBitmap=="function"),Yt}var ze={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ze);var we=function(a){function u(p,x,B){x===401&&Di(B)&&(p+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,p),this.status=x,this.url=B,this.name=this.constructor.name,this.message=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),V=Ct()?function(){return self.worker&&self.worker.referrer}:function(){return(S.location.protocol==="blob:"?S.parent:S).location.href},ve,Be,xt=function(a,u){if(!(/^file:/.test(p=a.url)||/^file:/.test(V())&&!/^\w+:/.test(p))){if(S.fetch&&S.Request&&S.AbortController&&S.Request.prototype.hasOwnProperty("signal"))return function(x,B){var I,D=new S.AbortController,k=new S.Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,referrer:V(),signal:D.signal}),G=!1,X=!1,Y=(I=k.url).indexOf("sku=")>0&&Di(I);x.type==="json"&&k.headers.set("Accept","application/json");var rt=function(yt,Ft,kt){if(!X){if(yt&&yt.message!=="SecurityError"&&ut(yt),Ft&&kt)return ht(Ft);var Ht=Date.now();S.fetch(k).then(function(jt){if(jt.ok){var qt=Y?jt.clone():null;return ht(jt,qt,Ht)}return B(new we(jt.statusText,jt.status,x.url))}).catch(function(jt){jt.code!==20&&B(new Error(jt.message))})}},ht=function(yt,Ft,kt){(x.type==="arrayBuffer"?yt.arrayBuffer():x.type==="json"?yt.json():yt.text()).then(function(Ht){X||(Ft&&kt&&function(jt,qt,ae){if(Je(),Tn){var ge={status:qt.status,statusText:qt.statusText,headers:new S.Headers};qt.headers.forEach(function(De,We){return ge.headers.set(We,De)});var ye=Rt(qt.headers.get("Cache-Control")||"");ye["no-store"]||(ye["max-age"]&&ge.headers.set("Expires",new Date(ae+1e3*ye["max-age"]).toUTCString()),new Date(ge.headers.get("Expires")).getTime()-ae<42e4||function(De,We){if($n===void 0)try{new Response(new ReadableStream),$n=!0}catch{$n=!1}$n?We(De.body):De.blob().then(We)}(qt,function(De){var We=new S.Response(De,ge);Je(),Tn&&Tn.then(function(Ze){return Ze.put(li(jt.url),We)}).catch(function(Ze){return ut(Ze.message)})}))}}(k,Ft,kt),G=!0,B(null,Ht,yt.headers.get("Cache-Control"),yt.headers.get("Expires")))}).catch(function(Ht){X||B(new Error(Ht.message))})};return Y?function(yt,Ft){if(Je(),!Tn)return Ft(null);var kt=li(yt.url);Tn.then(function(Ht){Ht.match(kt).then(function(jt){var qt=function(ae){if(!ae)return!1;var ge=new Date(ae.headers.get("Expires")||0),ye=Rt(ae.headers.get("Cache-Control")||"");return ge>Date.now()&&!ye["no-cache"]}(jt);Ht.delete(kt),qt&&Ht.put(kt,jt.clone()),Ft(null,jt,qt)}).catch(Ft)}).catch(Ft)}(k,rt):rt(null,null),{cancel:function(){X=!0,G||D.abort()}}}(a,u);if(Ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,u,void 0,!0)}var p;return function(x,B){var I=new S.XMLHttpRequest;for(var D in I.open(x.method||"GET",x.url,!0),x.type==="arrayBuffer"&&(I.responseType="arraybuffer"),x.headers)I.setRequestHeader(D,x.headers[D]);return x.type==="json"&&(I.responseType="text",I.setRequestHeader("Accept","application/json")),I.withCredentials=x.credentials==="include",I.onerror=function(){B(new Error(I.statusText))},I.onload=function(){if((I.status>=200&&I.status<300||I.status===0)&&I.response!==null){var k=I.response;if(x.type==="json")try{k=JSON.parse(I.response)}catch(G){return B(G)}B(null,k,I.getResponseHeader("Cache-Control"),I.getResponseHeader("Expires"))}else B(new we(I.statusText,I.status,x.url))},I.send(x.body),{cancel:function(){return I.abort()}}}(a,u)},Xt=function(a,u){return xt(tt(a,{type:"arrayBuffer"}),u)},ce=function(a,u){return xt(tt(a,{method:"POST"}),u)},q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ve=[],Be=0;var nt=function(a,u){if(di.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Be>=Ve.MAX_PARALLEL_IMAGE_REQUESTS){var p={requestParameters:a,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return ve.push(p),p}Be++;var x=!1,B=function(){if(!x)for(x=!0,Be--;ve.length&&Be<Ve.MAX_PARALLEL_IMAGE_REQUESTS;){var D=ve.shift();D.cancelled||(D.cancel=nt(D.requestParameters,D.callback).cancel)}},I=Xt(a,function(D,k,G,X){B(),D?u(D):k&&(gt()?function(Y,rt){var ht=new S.Blob([new Uint8Array(Y)],{type:"image/png"});S.createImageBitmap(ht).then(function(yt){rt(null,yt)}).catch(function(yt){rt(new Error("Could not load image because of "+yt.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(k,u):function(Y,rt,ht,yt){var Ft=new S.Image,kt=S.URL;Ft.onload=function(){rt(null,Ft),kt.revokeObjectURL(Ft.src),Ft.onload=null,S.requestAnimationFrame(function(){Ft.src=q})},Ft.onerror=function(){return rt(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ht=new S.Blob([new Uint8Array(Y)],{type:"image/png"});Ft.cacheControl=ht,Ft.expires=yt,Ft.src=Y.byteLength?kt.createObjectURL(Ht):q}(k,u,G,X))});return{cancel:function(){I.cancel(),B()}}};function at(a,u,p){p[a]&&p[a].indexOf(u)!==-1||(p[a]=p[a]||[],p[a].push(u))}function vt(a,u,p){if(p&&p[a]){var x=p[a].indexOf(u);x!==-1&&p[a].splice(x,1)}}var Ot=function(a,u){u===void 0&&(u={}),tt(this,u),this.type=a},ft=function(a){function u(p,x){x===void 0&&(x={}),a.call(this,"error",tt({error:p},x))}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ot),_t=function(){};_t.prototype.on=function(a,u){return this._listeners=this._listeners||{},at(a,u,this._listeners),this},_t.prototype.off=function(a,u){return vt(a,u,this._listeners),vt(a,u,this._oneTimeListeners),this},_t.prototype.once=function(a,u){return this._oneTimeListeners=this._oneTimeListeners||{},at(a,u,this._oneTimeListeners),this},_t.prototype.fire=function(a,u){typeof a=="string"&&(a=new Ot(a,u||{}));var p=a.type;if(this.listens(p)){a.target=this;for(var x=0,B=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];x<B.length;x+=1)B[x].call(this,a);for(var I=0,D=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];I<D.length;I+=1){var k=D[I];vt(p,k,this._oneTimeListeners),k.call(this,a)}var G=this._eventedParent;G&&(tt(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),G.fire(a))}else a instanceof ft&&console.error(a.error);return this},_t.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},_t.prototype.setEventedParent=function(a,u){return this._eventedParent=a,this._eventedParentData=u,this};var st={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},wt=function(a,u,p,x){this.message=(a?a+": ":"")+p,x&&(this.identifier=x),u!=null&&u.__line__&&(this.line=u.__line__)};function g(a){var u=a.value;return u?[new wt(a.key,u,"constants have been deprecated as of v8")]:[]}function ct(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];for(var x=0,B=u;x<B.length;x+=1){var I=B[x];for(var D in I)a[D]=I[D]}return a}function Ce(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Kt(a){if(Array.isArray(a))return a.map(Kt);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var u={};for(var p in a)u[p]=Kt(a[p]);return u}return Ce(a)}var Ee=function(a){function u(p,x){a.call(this,x),this.message=x,this.key=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Error),Pe=function(a,u){u===void 0&&(u=[]),this.parent=a,this.bindings={};for(var p=0,x=u;p<x.length;p+=1){var B=x[p];this.bindings[B[0]]=B[1]}};Pe.prototype.concat=function(a){return new Pe(this,a)},Pe.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},Pe.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Le={kind:"null"},he={kind:"number"},Fe={kind:"string"},Ie={kind:"boolean"},je={kind:"color"},Ni={kind:"object"},ti={kind:"value"},tn={kind:"collator"},ln={kind:"formatted"},Ji={kind:"resolvedImage"};function Xi(a,u){return{kind:"array",itemType:a,N:u}}function Gi(a){if(a.kind==="array"){var u=Gi(a.itemType);return typeof a.N=="number"?"array<"+u+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+u+">"}return a.kind}var vr=[Le,he,Fe,Ie,je,ln,Ni,Xi(ti),Ji];function Qi(a,u){if(u.kind==="error")return null;if(a.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Qi(a.itemType,u.itemType))&&(typeof a.N!="number"||a.N===u.N))return null}else{if(a.kind===u.kind)return null;if(a.kind==="value"){for(var p=0,x=vr;p<x.length;p+=1)if(!Qi(x[p],u))return null}}return"Expected "+Gi(a)+" but found "+Gi(u)+" instead."}function mi(a,u){return u.some(function(p){return p.kind===a.kind})}function Bt(a,u){return u.some(function(p){return p==="null"?a===null:p==="array"?Array.isArray(a):p==="object"?a&&!Array.isArray(a)&&typeof a=="object":p===typeof a})}var Qe=c(function(a,u){var p={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function x(k){return(k=Math.round(k))<0?0:k>255?255:k}function B(k){return x(k[k.length-1]==="%"?parseFloat(k)/100*255:parseInt(k))}function I(k){return(G=k[k.length-1]==="%"?parseFloat(k)/100:parseFloat(k))<0?0:G>1?1:G;var G}function D(k,G,X){return X<0?X+=1:X>1&&(X-=1),6*X<1?k+(G-k)*X*6:2*X<1?G:3*X<2?k+(G-k)*(2/3-X)*6:k}try{u.parseCSSColor=function(k){var G,X=k.replace(/ /g,"").toLowerCase();if(X in p)return p[X].slice();if(X[0]==="#")return X.length===4?(G=parseInt(X.substr(1),16))>=0&&G<=4095?[(3840&G)>>4|(3840&G)>>8,240&G|(240&G)>>4,15&G|(15&G)<<4,1]:null:X.length===7&&(G=parseInt(X.substr(1),16))>=0&&G<=16777215?[(16711680&G)>>16,(65280&G)>>8,255&G,1]:null;var Y=X.indexOf("("),rt=X.indexOf(")");if(Y!==-1&&rt+1===X.length){var ht=X.substr(0,Y),yt=X.substr(Y+1,rt-(Y+1)).split(","),Ft=1;switch(ht){case"rgba":if(yt.length!==4)return null;Ft=I(yt.pop());case"rgb":return yt.length!==3?null:[B(yt[0]),B(yt[1]),B(yt[2]),Ft];case"hsla":if(yt.length!==4)return null;Ft=I(yt.pop());case"hsl":if(yt.length!==3)return null;var kt=(parseFloat(yt[0])%360+360)%360/360,Ht=I(yt[1]),jt=I(yt[2]),qt=jt<=.5?jt*(Ht+1):jt+Ht-jt*Ht,ae=2*jt-qt;return[x(255*D(ae,qt,kt+1/3)),x(255*D(ae,qt,kt)),x(255*D(ae,qt,kt-1/3)),Ft];default:return null}}return null}}catch{}}).parseCSSColor,en=function(a,u,p,x){x===void 0&&(x=1),this.r=a,this.g=u,this.b=p,this.a=x};en.parse=function(a){if(a){if(a instanceof en)return a;if(typeof a=="string"){var u=Qe(a);if(u)return new en(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},en.prototype.toString=function(){var a=this.toArray(),u=a[1],p=a[2],x=a[3];return"rgba("+Math.round(a[0])+","+Math.round(u)+","+Math.round(p)+","+x+")"},en.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},en.black=new en(0,0,0,1),en.white=new en(1,1,1,1),en.transparent=new en(0,0,0,0),en.red=new en(1,0,0,1);var Hr=function(a,u,p){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Hr.prototype.compare=function(a,u){return this.collator.compare(a,u)},Hr.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var va=function(a,u,p,x,B){this.text=a,this.image=u,this.scale=p,this.fontStack=x,this.textColor=B},ur=function(a){this.sections=a};ur.fromString=function(a){return new ur([new va(a,null,null,null,null)])},ur.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ur.factory=function(a){return a instanceof ur?a:ur.fromString(a)},ur.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ur.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];if(x.image)a.push(["image",x.image.name]);else{a.push(x.text);var B={};x.fontStack&&(B["text-font"]=["literal",x.fontStack.split(",")]),x.scale&&(B["font-scale"]=x.scale),x.textColor&&(B["text-color"]=["rgba"].concat(x.textColor.toArray())),a.push(B)}}return a};var Wn=function(a){this.name=a.name,this.available=a.available};function Tt(a,u,p,x){return typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof p=="number"&&p>=0&&p<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:"Invalid rgba value ["+[a,u,p,x].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof x=="number"?[a,u,p,x]:[a,u,p]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ws(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof en||a instanceof Hr||a instanceof ur||a instanceof Wn)return!0;if(Array.isArray(a)){for(var u=0,p=a;u<p.length;u+=1)if(!Ws(p[u]))return!1;return!0}if(typeof a=="object"){for(var x in a)if(!Ws(a[x]))return!1;return!0}return!1}function Jn(a){if(a===null)return Le;if(typeof a=="string")return Fe;if(typeof a=="boolean")return Ie;if(typeof a=="number")return he;if(a instanceof en)return je;if(a instanceof Hr)return tn;if(a instanceof ur)return ln;if(a instanceof Wn)return Ji;if(Array.isArray(a)){for(var u,p=a.length,x=0,B=a;x<B.length;x+=1){var I=Jn(B[x]);if(u){if(u===I)continue;u=ti;break}u=I}return Xi(u||ti,p)}return Ni}function Js(a){var u=typeof a;return a===null?"":u==="string"||u==="number"||u==="boolean"?String(a):a instanceof en||a instanceof ur||a instanceof Wn?a.toString():JSON.stringify(a)}Wn.prototype.toString=function(){return this.name},Wn.fromString=function(a){return a?new Wn({name:a,available:!1}):null},Wn.prototype.serialize=function(){return["image",this.name]};var Fr=function(a,u){this.type=a,this.value=u};Fr.parse=function(a,u){if(a.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!Ws(a[1]))return u.error("invalid value");var p=a[1],x=Jn(p),B=u.expectedType;return x.kind!=="array"||x.N!==0||!B||B.kind!=="array"||typeof B.N=="number"&&B.N!==0||(x=B),new Fr(x,p)},Fr.prototype.evaluate=function(){return this.value},Fr.prototype.eachChild=function(){},Fr.prototype.outputDefined=function(){return!0},Fr.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof en?["rgba"].concat(this.value.toArray()):this.value instanceof ur?this.value.serialize():this.value};var hr=function(a){this.name="ExpressionEvaluationError",this.message=a};hr.prototype.toJSON=function(){return this.message};var Mr={string:Fe,number:he,boolean:Ie,object:Ni},Rn=function(a,u){this.type=a,this.args=u};Rn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p,x=1,B=a[0];if(B==="array"){var I,D;if(a.length>2){var k=a[1];if(typeof k!="string"||!(k in Mr)||k==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);I=Mr[k],x++}else I=ti;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);D=a[2],x++}p=Xi(I,D)}else p=Mr[B];for(var G=[];x<a.length;x++){var X=u.parse(a[x],x,ti);if(!X)return null;G.push(X)}return new Rn(p,G)},Rn.prototype.evaluate=function(a){for(var u=0;u<this.args.length;u++){var p=this.args[u].evaluate(a);if(!Qi(this.type,Jn(p)))return p;if(u===this.args.length-1)throw new hr("Expected value to be of type "+Gi(this.type)+", but found "+Gi(Jn(p))+" instead.")}return null},Rn.prototype.eachChild=function(a){this.args.forEach(a)},Rn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Rn.prototype.serialize=function(){var a=this.type,u=[a.kind];if(a.kind==="array"){var p=a.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){u.push(p.kind);var x=a.N;(typeof x=="number"||this.args.length>1)&&u.push(x)}}return u.concat(this.args.map(function(B){return B.serialize()}))};var mo=function(a){this.type=ln,this.sections=a};mo.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[1];if(!Array.isArray(p)&&typeof p=="object")return u.error("First argument must be an image or text section.");for(var x=[],B=!1,I=1;I<=a.length-1;++I){var D=a[I];if(B&&typeof D=="object"&&!Array.isArray(D)){B=!1;var k=null;if(D["font-scale"]&&!(k=u.parse(D["font-scale"],1,he)))return null;var G=null;if(D["text-font"]&&!(G=u.parse(D["text-font"],1,Xi(Fe))))return null;var X=null;if(D["text-color"]&&!(X=u.parse(D["text-color"],1,je)))return null;var Y=x[x.length-1];Y.scale=k,Y.font=G,Y.textColor=X}else{var rt=u.parse(a[I],1,ti);if(!rt)return null;var ht=rt.type.kind;if(ht!=="string"&&ht!=="value"&&ht!=="null"&&ht!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");B=!0,x.push({content:rt,scale:null,font:null,textColor:null})}}return new mo(x)},mo.prototype.evaluate=function(a){return new ur(this.sections.map(function(u){var p=u.content.evaluate(a);return Jn(p)===Ji?new va("",p,null,null,null):new va(Js(p),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))},mo.prototype.eachChild=function(a){for(var u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a(x.content),x.scale&&a(x.scale),x.font&&a(x.font),x.textColor&&a(x.textColor)}},mo.prototype.outputDefined=function(){return!1},mo.prototype.serialize=function(){for(var a=["format"],u=0,p=this.sections;u<p.length;u+=1){var x=p[u];a.push(x.content.serialize());var B={};x.scale&&(B["font-scale"]=x.scale.serialize()),x.font&&(B["text-font"]=x.font.serialize()),x.textColor&&(B["text-color"]=x.textColor.serialize()),a.push(B)}return a};var Wr=function(a){this.type=Ji,this.input=a};Wr.parse=function(a,u){if(a.length!==2)return u.error("Expected two arguments.");var p=u.parse(a[1],1,Fe);return p?new Wr(p):u.error("No image name provided.")},Wr.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=Wn.fromString(u);return p&&a.availableImages&&(p.available=a.availableImages.indexOf(u)>-1),p},Wr.prototype.eachChild=function(a){a(this.input)},Wr.prototype.outputDefined=function(){return!1},Wr.prototype.serialize=function(){return["image",this.input.serialize()]};var Go={"to-boolean":Ie,"to-color":je,"to-number":he,"to-string":Fe},Sn=function(a,u){this.type=a,this.args=u};Sn.parse=function(a,u){if(a.length<2)return u.error("Expected at least one argument.");var p=a[0];if((p==="to-boolean"||p==="to-string")&&a.length!==2)return u.error("Expected one argument.");for(var x=Go[p],B=[],I=1;I<a.length;I++){var D=u.parse(a[I],I,ti);if(!D)return null;B.push(D)}return new Sn(x,B)},Sn.prototype.evaluate=function(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){for(var u,p,x=0,B=this.args;x<B.length;x+=1){if(p=null,(u=B[x].evaluate(a))instanceof en)return u;if(typeof u=="string"){var I=a.parseColor(u);if(I)return I}else if(Array.isArray(u)&&!(p=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Tt(u[0],u[1],u[2],u[3])))return new en(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new hr(p||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var D=null,k=0,G=this.args;k<G.length;k+=1){if((D=G[k].evaluate(a))===null)return 0;var X=Number(D);if(!isNaN(X))return X}throw new hr("Could not convert "+JSON.stringify(D)+" to number.")}return this.type.kind==="formatted"?ur.fromString(Js(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Wn.fromString(Js(this.args[0].evaluate(a))):Js(this.args[0].evaluate(a))},Sn.prototype.eachChild=function(a){this.args.forEach(a)},Sn.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Sn.prototype.serialize=function(){if(this.type.kind==="formatted")return new mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wr(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(u){a.push(u.serialize())}),a};var _l=["Unknown","Point","LineString","Polygon"],At=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};At.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},At.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?_l[this.feature.type]:this.feature.type:null},At.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},At.prototype.canonicalID=function(){return this.canonical},At.prototype.properties=function(){return this.feature&&this.feature.properties||{}},At.prototype.parseColor=function(a){var u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=en.parse(a)),u};var Mt=function(a,u,p,x){this.name=a,this.type=u,this._evaluate=p,this.args=x};Mt.prototype.evaluate=function(a){return this._evaluate(a,this.args)},Mt.prototype.eachChild=function(a){this.args.forEach(a)},Mt.prototype.outputDefined=function(){return!1},Mt.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},Mt.parse=function(a,u){var p,x=a[0],B=Mt.definitions[x];if(!B)return u.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0);for(var I=Array.isArray(B)?B[0]:B.type,D=Array.isArray(B)?[[B[1],B[2]]]:B.overloads,k=D.filter(function(Bi){var ri=Bi[0];return!Array.isArray(ri)||ri.length===a.length-1}),G=null,X=0,Y=k;X<Y.length;X+=1){var rt=Y[X],ht=rt[0],yt=rt[1];G=new _r(u.registry,u.path,null,u.scope);for(var Ft=[],kt=!1,Ht=1;Ht<a.length;Ht++){var jt=a[Ht],qt=Array.isArray(ht)?ht[Ht-1]:ht.type,ae=G.parse(jt,1+Ft.length,qt);if(!ae){kt=!0;break}Ft.push(ae)}if(!kt)if(Array.isArray(ht)&&ht.length!==Ft.length)G.error("Expected "+ht.length+" arguments, but found "+Ft.length+" instead.");else{for(var ge=0;ge<Ft.length;ge++){var ye=Array.isArray(ht)?ht[ge]:ht.type,De=Ft[ge];G.concat(ge+1).checkSubtype(ye,De.type)}if(G.errors.length===0)return new Mt(x,I,yt,Ft)}}if(k.length===1)(p=u.errors).push.apply(p,G.errors);else{for(var We=(k.length?k:D).map(function(Bi){var ri;return ri=Bi[0],Array.isArray(ri)?"("+ri.map(Gi).join(", ")+")":"("+Gi(ri.type)+"...)"}).join(" | "),Ze=[],_i=1;_i<a.length;_i++){var ni=u.parse(a[_i],1+Ze.length);if(!ni)return null;Ze.push(Gi(ni.type))}u.error("Expected arguments of type "+We+", but found ("+Ze.join(", ")+") instead.")}return null},Mt.register=function(a,u){for(var p in Mt.definitions=u,u)a[p]=Mt};var Wt=function(a,u,p){this.type=tn,this.locale=p,this.caseSensitive=a,this.diacriticSensitive=u};function be(a,u){a[0]=Math.min(a[0],u[0]),a[1]=Math.min(a[1],u[1]),a[2]=Math.max(a[2],u[0]),a[3]=Math.max(a[3],u[1])}function He(a,u){return!(a[0]<=u[0]||a[2]>=u[2]||a[1]<=u[1]||a[3]>=u[3])}function ji(a,u){var p=(180+a[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,B=Math.pow(2,u.z);return[Math.round(p*B*8192),Math.round(x*B*8192)]}function Ii(a,u,p){return u[1]>a[1]!=p[1]>a[1]&&a[0]<(p[0]-u[0])*(a[1]-u[1])/(p[1]-u[1])+u[0]}function Ln(a,u){for(var p,x,B,I,D,k,G,X=!1,Y=0,rt=u.length;Y<rt;Y++)for(var ht=u[Y],yt=0,Ft=ht.length;yt<Ft-1;yt++){if((I=(p=a)[0]-(x=ht[yt])[0])*(G=p[1]-(B=ht[yt+1])[1])-(k=p[0]-B[0])*(D=p[1]-x[1])==0&&I*k<=0&&D*G<=0)return!1;Ii(a,ht[yt],ht[yt+1])&&(X=!X)}return X}function So(a,u){for(var p=0;p<u.length;p++)if(Ln(a,u[p]))return!0;return!1}function lo(a,u,p,x){var B=x[0]-p[0],I=x[1]-p[1],D=(a[0]-p[0])*I-B*(a[1]-p[1]),k=(u[0]-p[0])*I-B*(u[1]-p[1]);return D>0&&k<0||D<0&&k>0}function is(a,u,p){for(var x=0,B=p;x<B.length;x+=1)for(var I=B[x],D=0;D<I.length-1;++D)if((rt=[(Y=I[D+1])[0]-(X=I[D])[0],Y[1]-X[1]])[0]*(ht=[(G=u)[0]-(k=a)[0],G[1]-k[1]])[1]-rt[1]*ht[0]!=0&&lo(k,G,X,Y)&&lo(X,Y,k,G))return!0;var k,G,X,Y,rt,ht;return!1}function Pf(a,u){for(var p=0;p<a.length;++p)if(!Ln(a[p],u))return!1;for(var x=0;x<a.length-1;++x)if(is(a[x],a[x+1],u))return!1;return!0}function Ah(a,u){for(var p=0;p<u.length;p++)if(Pf(a,u[p]))return!0;return!1}function _a(a,u,p){for(var x=[],B=0;B<a.length;B++){for(var I=[],D=0;D<a[B].length;D++){var k=ji(a[B][D],p);be(u,k),I.push(k)}x.push(I)}return x}function bl(a,u,p){for(var x=[],B=0;B<a.length;B++){var I=_a(a[B],u,p);x.push(I)}return x}function xl(a,u,p,x){if(a[0]<p[0]||a[0]>p[2]){var B=.5*x,I=a[0]-p[0]>B?-x:p[0]-a[0]>B?x:0;I===0&&(I=a[0]-p[2]>B?-x:p[2]-a[0]>B?x:0),a[0]+=I}be(u,a)}function Rf(a,u,p,x){for(var B=8192*Math.pow(2,x.z),I=[8192*x.x,8192*x.y],D=[],k=0,G=a;k<G.length;k+=1)for(var X=0,Y=G[k];X<Y.length;X+=1){var rt=Y[X],ht=[rt.x+I[0],rt.y+I[1]];xl(ht,u,p,B),D.push(ht)}return D}function wl(a,u,p,x){for(var B,I=8192*Math.pow(2,x.z),D=[8192*x.x,8192*x.y],k=[],G=0,X=a;G<X.length;G+=1){for(var Y=[],rt=0,ht=X[G];rt<ht.length;rt+=1){var yt=ht[rt],Ft=[yt.x+D[0],yt.y+D[1]];be(u,Ft),Y.push(Ft)}k.push(Y)}if(u[2]-u[0]<=I/2){(B=u)[0]=B[1]=1/0,B[2]=B[3]=-1/0;for(var kt=0,Ht=k;kt<Ht.length;kt+=1)for(var jt=0,qt=Ht[kt];jt<qt.length;jt+=1)xl(qt[jt],u,p,I)}return k}Wt.parse=function(a,u){if(a.length!==2)return u.error("Expected one argument.");var p=a[1];if(typeof p!="object"||Array.isArray(p))return u.error("Collator options argument must be an object.");var x=u.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Ie);if(!x)return null;var B=u.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Ie);if(!B)return null;var I=null;return p.locale&&!(I=u.parse(p.locale,1,Fe))?null:new Wt(x,B,I)},Wt.prototype.evaluate=function(a){return new Hr(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},Wt.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},Wt.prototype.outputDefined=function(){return!1},Wt.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var jo=function(a,u){this.type=Ie,this.geojson=a,this.geometries=u};function Xs(a){if(a instanceof Mt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof jo)return!1;var u=!0;return a.eachChild(function(p){u&&!Xs(p)&&(u=!1)}),u}function ba(a){if(a instanceof Mt&&a.name==="feature-state")return!1;var u=!0;return a.eachChild(function(p){u&&!ba(p)&&(u=!1)}),u}function Ja(a,u){if(a instanceof Mt&&u.indexOf(a.name)>=0)return!1;var p=!0;return a.eachChild(function(x){p&&!Ja(x,u)&&(p=!1)}),p}jo.parse=function(a,u){if(a.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(Ws(a[1])){var p=a[1];if(p.type==="FeatureCollection")for(var x=0;x<p.features.length;++x){var B=p.features[x].geometry.type;if(B==="Polygon"||B==="MultiPolygon")return new jo(p,p.features[x].geometry)}else if(p.type==="Feature"){var I=p.geometry.type;if(I==="Polygon"||I==="MultiPolygon")return new jo(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new jo(p,p)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},jo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,p){var x=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(p.type==="Polygon"){var D=_a(p.coordinates,B,I),k=Rf(u.geometry(),x,B,I);if(!He(x,B))return!1;for(var G=0,X=k;G<X.length;G+=1)if(!Ln(X[G],D))return!1}if(p.type==="MultiPolygon"){var Y=bl(p.coordinates,B,I),rt=Rf(u.geometry(),x,B,I);if(!He(x,B))return!1;for(var ht=0,yt=rt;ht<yt.length;ht+=1)if(!So(yt[ht],Y))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,p){var x=[1/0,1/0,-1/0,-1/0],B=[1/0,1/0,-1/0,-1/0],I=u.canonicalID();if(p.type==="Polygon"){var D=_a(p.coordinates,B,I),k=wl(u.geometry(),x,B,I);if(!He(x,B))return!1;for(var G=0,X=k;G<X.length;G+=1)if(!Pf(X[G],D))return!1}if(p.type==="MultiPolygon"){var Y=bl(p.coordinates,B,I),rt=wl(u.geometry(),x,B,I);if(!He(x,B))return!1;for(var ht=0,yt=rt;ht<yt.length;ht+=1)if(!Ah(yt[ht],Y))return!1}return!0}(a,this.geometries)}return!1},jo.prototype.eachChild=function(){},jo.prototype.outputDefined=function(){return!0},jo.prototype.serialize=function(){return["within",this.geojson]};var xa=function(a,u){this.type=u.type,this.name=a,this.boundExpression=u};xa.parse=function(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var p=a[1];return u.scope.has(p)?new xa(p,u.scope.get(p)):u.error('Unknown variable "'+p+'". Make sure "'+p+'" has been bound in an enclosing "let" expression before using it.',1)},xa.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},xa.prototype.eachChild=function(){},xa.prototype.outputDefined=function(){return!1},xa.prototype.serialize=function(){return["var",this.name]};var _r=function(a,u,p,x,B){u===void 0&&(u=[]),x===void 0&&(x=new Pe),B===void 0&&(B=[]),this.registry=a,this.path=u,this.key=u.map(function(I){return"["+I+"]"}).join(""),this.scope=x,this.errors=B,this.expectedType=p};function Rs(a,u){for(var p,x=a.length-1,B=0,I=x,D=0;B<=I;)if((p=a[D=Math.floor((B+I)/2)])<=u){if(D===x||u<a[D+1])return D;B=D+1}else{if(!(p>u))throw new hr("Input is not a number.");I=D-1}return 0}_r.prototype.parse=function(a,u,p,x,B){return B===void 0&&(B={}),u?this.concat(u,p,x)._parse(a,B):this._parse(a,B)},_r.prototype._parse=function(a,u){function p(X,Y,rt){return rt==="assert"?new Rn(Y,[X]):rt==="coerce"?new Sn(Y,[X]):X}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var x=a[0];if(typeof x!="string")return this.error("Expression name must be a string, but found "+typeof x+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var B=this.registry[x];if(B){var I=B.parse(a,this);if(!I)return null;if(this.expectedType){var D=this.expectedType,k=I.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||k.kind!=="value")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string"){if(this.checkSubtype(D,k))return null}else I=p(I,D,u.typeAnnotation||"coerce");else I=p(I,D,u.typeAnnotation||"assert")}if(!(I instanceof Fr)&&I.type.kind!=="resolvedImage"&&function X(Y){if(Y instanceof xa)return X(Y.boundExpression);if(Y instanceof Mt&&Y.name==="error"||Y instanceof Wt||Y instanceof jo)return!1;var rt=Y instanceof Sn||Y instanceof Rn,ht=!0;return Y.eachChild(function(yt){ht=rt?ht&&X(yt):ht&&yt instanceof Fr}),!!ht&&Xs(Y)&&Ja(Y,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(I)){var G=new At;try{I=new Fr(I.type,I.evaluate(G))}catch(X){return this.error(X.message),null}}return I}return this.error('Unknown expression "'+x+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},_r.prototype.concat=function(a,u,p){var x=typeof a=="number"?this.path.concat(a):this.path,B=p?this.scope.concat(p):this.scope;return new _r(this.registry,x,u||null,B,this.errors)},_r.prototype.error=function(a){for(var u=[],p=arguments.length-1;p-- >0;)u[p]=arguments[p+1];var x=""+this.key+u.map(function(B){return"["+B+"]"}).join("");this.errors.push(new Ee(x,a))},_r.prototype.checkSubtype=function(a,u){var p=Qi(a,u);return p&&this.error(p),p};var Gn=function(a,u,p){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(var x=0,B=p;x<B.length;x+=1){var I=B[x],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function fr(a,u,p){return a*(1-p)+u*p}Gn.parse=function(a,u){if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");var p=u.parse(a[1],1,he);if(!p)return null;var x=[],B=null;u.expectedType&&u.expectedType.kind!=="value"&&(B=u.expectedType);for(var I=1;I<a.length;I+=2){var D=I===1?-1/0:a[I],k=a[I+1],G=I,X=I+1;if(typeof D!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(x.length&&x[x.length-1][0]>=D)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',G);var Y=u.parse(k,X,B);if(!Y)return null;B=B||Y.type,x.push([D,Y])}return new Gn(B,p,x)},Gn.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var B=u.length;return x>=u[B-1]?p[B-1].evaluate(a):p[Rs(u,x)].evaluate(a)},Gn.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},Gn.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Gn.prototype.serialize=function(){for(var a=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&a.push(this.labels[u]),a.push(this.outputs[u].serialize());return a};var Xa=Object.freeze({__proto__:null,number:fr,color:function(a,u,p){return new en(fr(a.r,u.r,p),fr(a.g,u.g,p),fr(a.b,u.b,p),fr(a.a,u.a,p))},array:function(a,u,p){return a.map(function(x,B){return fr(x,u[B],p)})}}),Cl=6/29*3*(6/29),oA=Math.PI/180,sA=180/Math.PI;function gh(a){return a>.008856451679035631?Math.pow(a,1/3):a/Cl+4/29}function cu(a){return a>6/29?a*a*a:Cl*(a-4/29)}function Mc(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Qs(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function mh(a){var u=Qs(a.r),p=Qs(a.g),x=Qs(a.b),B=gh((.4124564*u+.3575761*p+.1804375*x)/.95047),I=gh((.2126729*u+.7151522*p+.072175*x)/1);return{l:116*I-16,a:500*(B-I),b:200*(I-gh((.0193339*u+.119192*p+.9503041*x)/1.08883)),alpha:a.a}}function yh(a){var u=(a.l+16)/116,p=isNaN(a.a)?u:u+a.a/500,x=isNaN(a.b)?u:u-a.b/200;return u=1*cu(u),p=.95047*cu(p),x=1.08883*cu(x),new en(Mc(3.2404542*p-1.5371385*u-.4985314*x),Mc(-.969266*p+1.8760108*u+.041556*x),Mc(.0556434*p-.2040259*u+1.0572252*x),a.alpha)}function lu(a,u,p){var x=u-a;return a+p*(x>180||x<-180?x-360*Math.round(x/360):x)}var xs={forward:mh,reverse:yh,interpolate:function(a,u,p){return{l:fr(a.l,u.l,p),a:fr(a.a,u.a,p),b:fr(a.b,u.b,p),alpha:fr(a.alpha,u.alpha,p)}}},ns={forward:function(a){var u=mh(a),p=u.l,x=u.a,B=u.b,I=Math.atan2(B,x)*sA;return{h:I<0?I+360:I,c:Math.sqrt(x*x+B*B),l:p,alpha:a.a}},reverse:function(a){var u=a.h*oA,p=a.c;return yh({l:a.l,a:Math.cos(u)*p,b:Math.sin(u)*p,alpha:a.alpha})},interpolate:function(a,u,p){return{h:lu(a.h,u.h,p),c:fr(a.c,u.c,p),l:fr(a.l,u.l,p),alpha:fr(a.alpha,u.alpha,p)}}},vh=Object.freeze({__proto__:null,lab:xs,hcl:ns}),zr=function(a,u,p,x,B){this.type=a,this.operator=u,this.interpolation=p,this.input=x,this.labels=[],this.outputs=[];for(var I=0,D=B;I<D.length;I+=1){var k=D[I],G=k[1];this.labels.push(k[0]),this.outputs.push(G)}};function El(a,u,p,x){var B=x-p,I=a-p;return B===0?0:u===1?I/B:(Math.pow(u,I)-1)/(Math.pow(u,B)-1)}zr.interpolationFactor=function(a,u,p,x){var B=0;if(a.name==="exponential")B=El(u,a.base,p,x);else if(a.name==="linear")B=El(u,1,p,x);else if(a.name==="cubic-bezier"){var I=a.controlPoints;B=new h(I[0],I[1],I[2],I[3]).solve(El(u,1,p,x))}return B},zr.parse=function(a,u){var p=a[0],x=a[1],B=a[2],I=a.slice(3);if(!Array.isArray(x)||x.length===0)return u.error("Expected an interpolation type expression.",1);if(x[0]==="linear")x={name:"linear"};else if(x[0]==="exponential"){var D=x[1];if(typeof D!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);x={name:"exponential",base:D}}else{if(x[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(x[0]),1,0);var k=x.slice(1);if(k.length!==4||k.some(function(Ht){return typeof Ht!="number"||Ht<0||Ht>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);x={name:"cubic-bezier",controlPoints:k}}if(a.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(B=u.parse(B,2,he)))return null;var G=[],X=null;p==="interpolate-hcl"||p==="interpolate-lab"?X=je:u.expectedType&&u.expectedType.kind!=="value"&&(X=u.expectedType);for(var Y=0;Y<I.length;Y+=2){var rt=I[Y],ht=I[Y+1],yt=Y+3,Ft=Y+4;if(typeof rt!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',yt);if(G.length&&G[G.length-1][0]>=rt)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',yt);var kt=u.parse(ht,Ft,X);if(!kt)return null;X=X||kt.type,G.push([rt,kt])}return X.kind==="number"||X.kind==="color"||X.kind==="array"&&X.itemType.kind==="number"&&typeof X.N=="number"?new zr(X,p,x,B,G):u.error("Type "+Gi(X)+" is not interpolatable.")},zr.prototype.evaluate=function(a){var u=this.labels,p=this.outputs;if(u.length===1)return p[0].evaluate(a);var x=this.input.evaluate(a);if(x<=u[0])return p[0].evaluate(a);var B=u.length;if(x>=u[B-1])return p[B-1].evaluate(a);var I=Rs(u,x),D=zr.interpolationFactor(this.interpolation,x,u[I],u[I+1]),k=p[I].evaluate(a),G=p[I+1].evaluate(a);return this.operator==="interpolate"?Xa[this.type.kind.toLowerCase()](k,G,D):this.operator==="interpolate-hcl"?ns.reverse(ns.interpolate(ns.forward(k),ns.forward(G),D)):xs.reverse(xs.interpolate(xs.forward(k),xs.forward(G),D))},zr.prototype.eachChild=function(a){a(this.input);for(var u=0,p=this.outputs;u<p.length;u+=1)a(p[u])},zr.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},zr.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,a,this.input.serialize()],p=0;p<this.labels.length;p++)u.push(this.labels[p],this.outputs[p].serialize());return u};var wa=function(a,u){this.type=a,this.args=u};wa.parse=function(a,u){if(a.length<2)return u.error("Expectected at least one argument.");var p=null,x=u.expectedType;x&&x.kind!=="value"&&(p=x);for(var B=[],I=0,D=a.slice(1);I<D.length;I+=1){var k=u.parse(D[I],1+B.length,p,void 0,{typeAnnotation:"omit"});if(!k)return null;p=p||k.type,B.push(k)}var G=x&&B.some(function(X){return Qi(x,X.type)});return new wa(G?ti:p,B)},wa.prototype.evaluate=function(a){for(var u,p=null,x=0,B=0,I=this.args;B<I.length&&(x++,(p=I[B].evaluate(a))&&p instanceof Wn&&!p.available&&(u||(u=p.name),p=null,x===this.args.length&&(p=u)),p===null);B+=1);return p},wa.prototype.eachChild=function(a){this.args.forEach(a)},wa.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},wa.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ca=function(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u};Ca.prototype.evaluate=function(a){return this.result.evaluate(a)},Ca.prototype.eachChild=function(a){for(var u=0,p=this.bindings;u<p.length;u+=1)a(p[u][1]);a(this.result)},Ca.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var p=[],x=1;x<a.length-1;x+=2){var B=a[x];if(typeof B!="string")return u.error("Expected string, but found "+typeof B+" instead.",x);if(/[^a-zA-Z0-9_]/.test(B))return u.error("Variable names must contain only alphanumeric characters or '_'.",x);var I=u.parse(a[x+1],x+1);if(!I)return null;p.push([B,I])}var D=u.parse(a[a.length-1],a.length-1,u.expectedType,p);return D?new Ca(p,D):null},Ca.prototype.outputDefined=function(){return this.result.outputDefined()},Ca.prototype.serialize=function(){for(var a=["let"],u=0,p=this.bindings;u<p.length;u+=1){var x=p[u];a.push(x[0],x[1].serialize())}return a.push(this.result.serialize()),a};var Ea=function(a,u,p){this.type=a,this.index=u,this.input=p};Ea.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,he),x=u.parse(a[2],2,Xi(u.expectedType||ti));return p&&x?new Ea(x.type.itemType,p,x):null},Ea.prototype.evaluate=function(a){var u=this.index.evaluate(a),p=this.input.evaluate(a);if(u<0)throw new hr("Array index out of bounds: "+u+" < 0.");if(u>=p.length)throw new hr("Array index out of bounds: "+u+" > "+(p.length-1)+".");if(u!==Math.floor(u))throw new hr("Array index must be an integer, but found "+u+" instead.");return p[u]},Ea.prototype.eachChild=function(a){a(this.index),a(this.input)},Ea.prototype.outputDefined=function(){return!1},Ea.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Qa=function(a,u){this.type=Ie,this.needle=a,this.haystack=u};Qa.parse=function(a,u){if(a.length!==3)return u.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ti),x=u.parse(a[2],2,ti);return p&&x?mi(p.type,[Ie,Fe,he,Le,ti])?new Qa(p,x):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Gi(p.type)+" instead"):null},Qa.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!p)return!1;if(!Bt(u,["boolean","string","number","null"]))throw new hr("Expected first argument to be of type boolean, string, number or null, but found "+Gi(Jn(u))+" instead.");if(!Bt(p,["string","array"]))throw new hr("Expected second argument to be of type array or string, but found "+Gi(Jn(p))+" instead.");return p.indexOf(u)>=0},Qa.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},Qa.prototype.outputDefined=function(){return!0},Qa.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Ba=function(a,u,p){this.type=he,this.needle=a,this.haystack=u,this.fromIndex=p};Ba.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ti),x=u.parse(a[2],2,ti);if(!p||!x)return null;if(!mi(p.type,[Ie,Fe,he,Le,ti]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Gi(p.type)+" instead");if(a.length===4){var B=u.parse(a[3],3,he);return B?new Ba(p,x,B):null}return new Ba(p,x)},Ba.prototype.evaluate=function(a){var u=this.needle.evaluate(a),p=this.haystack.evaluate(a);if(!Bt(u,["boolean","string","number","null"]))throw new hr("Expected first argument to be of type boolean, string, number or null, but found "+Gi(Jn(u))+" instead.");if(!Bt(p,["string","array"]))throw new hr("Expected second argument to be of type array or string, but found "+Gi(Jn(p))+" instead.");if(this.fromIndex){var x=this.fromIndex.evaluate(a);return p.indexOf(u,x)}return p.indexOf(u)},Ba.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},Ba.prototype.outputDefined=function(){return!1},Ba.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ka=function(a,u,p,x,B,I){this.inputType=a,this.type=u,this.input=p,this.cases=x,this.outputs=B,this.otherwise=I};Ka.parse=function(a,u){if(a.length<5)return u.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return u.error("Expected an even number of arguments.");var p,x;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var B={},I=[],D=2;D<a.length-1;D+=2){var k=a[D],G=a[D+1];Array.isArray(k)||(k=[k]);var X=u.concat(D);if(k.length===0)return X.error("Expected at least one branch label.");for(var Y=0,rt=k;Y<rt.length;Y+=1){var ht=rt[Y];if(typeof ht!="number"&&typeof ht!="string")return X.error("Branch labels must be numbers or strings.");if(typeof ht=="number"&&Math.abs(ht)>Number.MAX_SAFE_INTEGER)return X.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ht=="number"&&Math.floor(ht)!==ht)return X.error("Numeric branch labels must be integer values.");if(p){if(X.checkSubtype(p,Jn(ht)))return null}else p=Jn(ht);if(B[String(ht)]!==void 0)return X.error("Branch labels must be unique.");B[String(ht)]=I.length}var yt=u.parse(G,D,x);if(!yt)return null;x=x||yt.type,I.push(yt)}var Ft=u.parse(a[1],1,ti);if(!Ft)return null;var kt=u.parse(a[a.length-1],a.length-1,x);return kt?Ft.type.kind!=="value"&&u.concat(1).checkSubtype(p,Ft.type)?null:new Ka(p,x,Ft,B,I,kt):null},Ka.prototype.evaluate=function(a){var u=this.input.evaluate(a);return(Jn(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)},Ka.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},Ka.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},Ka.prototype.serialize=function(){for(var a=this,u=["match",this.input.serialize()],p=[],x={},B=0,I=Object.keys(this.cases).sort();B<I.length;B+=1){var D=I[B];(rt=x[this.cases[D]])===void 0?(x[this.cases[D]]=p.length,p.push([this.cases[D],[D]])):p[rt][1].push(D)}for(var k=function(yt){return a.inputType.kind==="number"?Number(yt):yt},G=0,X=p;G<X.length;G+=1){var Y=X[G],rt=Y[0],ht=Y[1];u.push(ht.length===1?k(ht[0]):ht.map(k)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var qa=function(a,u,p){this.type=a,this.branches=u,this.otherwise=p};qa.parse=function(a,u){if(a.length<4)return u.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return u.error("Expected an odd number of arguments.");var p;u.expectedType&&u.expectedType.kind!=="value"&&(p=u.expectedType);for(var x=[],B=1;B<a.length-1;B+=2){var I=u.parse(a[B],B,Ie);if(!I)return null;var D=u.parse(a[B+1],B+1,p);if(!D)return null;x.push([I,D]),p=p||D.type}var k=u.parse(a[a.length-1],a.length-1,p);return k?new qa(p,x,k):null},qa.prototype.evaluate=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],B=x[1];if(x[0].evaluate(a))return B.evaluate(a)}return this.otherwise.evaluate(a)},qa.prototype.eachChild=function(a){for(var u=0,p=this.branches;u<p.length;u+=1){var x=p[u],B=x[1];a(x[0]),a(B)}a(this.otherwise)},qa.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},qa.prototype.serialize=function(){var a=["case"];return this.eachChild(function(u){a.push(u.serialize())}),a};var Ta=function(a,u,p,x){this.type=a,this.input=u,this.beginIndex=p,this.endIndex=x};function Df(a,u){return a==="=="||a==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function Of(a,u,p,x){return x.compare(u,p)===0}function In(a,u,p){var x=a!=="=="&&a!=="!=";return function(){function B(I,D,k){this.type=Ie,this.lhs=I,this.rhs=D,this.collator=k,this.hasUntypedArgument=I.type.kind==="value"||D.type.kind==="value"}return B.parse=function(I,D){if(I.length!==3&&I.length!==4)return D.error("Expected two or three arguments.");var k=I[0],G=D.parse(I[1],1,ti);if(!G)return null;if(!Df(k,G.type))return D.concat(1).error('"'+k+`" comparisons are not supported for type '`+Gi(G.type)+"'.");var X=D.parse(I[2],2,ti);if(!X)return null;if(!Df(k,X.type))return D.concat(2).error('"'+k+`" comparisons are not supported for type '`+Gi(X.type)+"'.");if(G.type.kind!==X.type.kind&&G.type.kind!=="value"&&X.type.kind!=="value")return D.error("Cannot compare types '"+Gi(G.type)+"' and '"+Gi(X.type)+"'.");x&&(G.type.kind==="value"&&X.type.kind!=="value"?G=new Rn(X.type,[G]):G.type.kind!=="value"&&X.type.kind==="value"&&(X=new Rn(G.type,[X])));var Y=null;if(I.length===4){if(G.type.kind!=="string"&&X.type.kind!=="string"&&G.type.kind!=="value"&&X.type.kind!=="value")return D.error("Cannot use collator to compare non-string types.");if(!(Y=D.parse(I[3],3,tn)))return null}return new B(G,X,Y)},B.prototype.evaluate=function(I){var D=this.lhs.evaluate(I),k=this.rhs.evaluate(I);if(x&&this.hasUntypedArgument){var G=Jn(D),X=Jn(k);if(G.kind!==X.kind||G.kind!=="string"&&G.kind!=="number")throw new hr('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+G.kind+", "+X.kind+") instead.")}if(this.collator&&!x&&this.hasUntypedArgument){var Y=Jn(D),rt=Jn(k);if(Y.kind!=="string"||rt.kind!=="string")return u(I,D,k)}return this.collator?p(I,D,k,this.collator.evaluate(I)):u(I,D,k)},B.prototype.eachChild=function(I){I(this.lhs),I(this.rhs),this.collator&&I(this.collator)},B.prototype.outputDefined=function(){return!0},B.prototype.serialize=function(){var I=[a];return this.eachChild(function(D){I.push(D.serialize())}),I},B}()}Ta.parse=function(a,u){if(a.length<=2||a.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1,ti),x=u.parse(a[2],2,he);if(!p||!x)return null;if(!mi(p.type,[Xi(ti),Fe,ti]))return u.error("Expected first argument to be of type array or string, but found "+Gi(p.type)+" instead");if(a.length===4){var B=u.parse(a[3],3,he);return B?new Ta(p.type,p,x,B):null}return new Ta(p.type,p,x)},Ta.prototype.evaluate=function(a){var u=this.input.evaluate(a),p=this.beginIndex.evaluate(a);if(!Bt(u,["string","array"]))throw new hr("Expected first argument to be of type array or string, but found "+Gi(Jn(u))+" instead.");if(this.endIndex){var x=this.endIndex.evaluate(a);return u.slice(p,x)}return u.slice(p)},Ta.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},Ta.prototype.outputDefined=function(){return!1},Ta.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var uu=In("==",function(a,u,p){return u===p},Of),hu=In("!=",function(a,u,p){return u!==p},function(a,u,p,x){return!Of(0,u,p,x)}),Lf=In("<",function(a,u,p){return u<p},function(a,u,p,x){return x.compare(u,p)<0}),Ff=In(">",function(a,u,p){return u>p},function(a,u,p,x){return x.compare(u,p)>0}),Pc=In("<=",function(a,u,p){return u<=p},function(a,u,p,x){return x.compare(u,p)<=0}),kf=In(">=",function(a,u,p){return u>=p},function(a,u,p,x){return x.compare(u,p)>=0}),Ks=function(a,u,p,x,B){this.type=Fe,this.number=a,this.locale=u,this.currency=p,this.minFractionDigits=x,this.maxFractionDigits=B};Ks.parse=function(a,u){if(a.length!==3)return u.error("Expected two arguments.");var p=u.parse(a[1],1,he);if(!p)return null;var x=a[2];if(typeof x!="object"||Array.isArray(x))return u.error("NumberFormat options argument must be an object.");var B=null;if(x.locale&&!(B=u.parse(x.locale,1,Fe)))return null;var I=null;if(x.currency&&!(I=u.parse(x.currency,1,Fe)))return null;var D=null;if(x["min-fraction-digits"]&&!(D=u.parse(x["min-fraction-digits"],1,he)))return null;var k=null;return x["max-fraction-digits"]&&!(k=u.parse(x["max-fraction-digits"],1,he))?null:new Ks(p,B,I,D,k)},Ks.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Ks.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Ks.prototype.outputDefined=function(){return!1},Ks.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var qs=function(a){this.type=he,this.input=a};qs.parse=function(a,u){if(a.length!==2)return u.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var p=u.parse(a[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Gi(p.type)+" instead."):new qs(p):null},qs.prototype.evaluate=function(a){var u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new hr("Expected value to be of type string or array, but found "+Gi(Jn(u))+" instead.")},qs.prototype.eachChild=function(a){a(this.input)},qs.prototype.outputDefined=function(){return!1},qs.prototype.serialize=function(){var a=["length"];return this.eachChild(function(u){a.push(u.serialize())}),a};var rs={"==":uu,"!=":hu,">":Ff,"<":Lf,">=":kf,"<=":Pc,array:Rn,at:Ea,boolean:Rn,case:qa,coalesce:wa,collator:Wt,format:mo,image:Wr,in:Qa,"index-of":Ba,interpolate:zr,"interpolate-hcl":zr,"interpolate-lab":zr,length:qs,let:Ca,literal:Fr,match:Ka,number:Rn,"number-format":Ks,object:Rn,slice:Ta,step:Gn,string:Rn,"to-boolean":Sn,"to-color":Sn,"to-number":Sn,"to-string":Sn,var:xa,within:jo};function Nf(a,u){var p=u[0],x=u[1],B=u[2],I=u[3];p=p.evaluate(a),x=x.evaluate(a),B=B.evaluate(a);var D=I?I.evaluate(a):1,k=Tt(p,x,B,D);if(k)throw new hr(k);return new en(p/255*D,x/255*D,B/255*D,D)}function fu(a,u){return a in u}function du(a,u){var p=u[a];return p===void 0?null:p}function Za(a){return{type:a}}function _h(a){return{result:"success",value:a}}function Zs(a){return{result:"error",value:a}}function Ys(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Bl(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Dn(a){return!!a.expression&&a.expression.interpolated}function Fn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function pu(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function aA(a){return a}function Rc(a,u,p){return a!==void 0?a:u!==void 0?u:p!==void 0?p:void 0}function Uf(a,u,p,x,B){return Rc(typeof p===B?x[p]:void 0,a.default,u.default)}function cA(a,u,p){if(Fn(p)!=="number")return Rc(a.default,u.default);var x=a.stops.length;if(x===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[x-1][0])return a.stops[x-1][1];var B=Rs(a.stops.map(function(I){return I[0]}),p);return a.stops[B][1]}function zf(a,u,p){var x=a.base!==void 0?a.base:1;if(Fn(p)!=="number")return Rc(a.default,u.default);var B=a.stops.length;if(B===1||p<=a.stops[0][0])return a.stops[0][1];if(p>=a.stops[B-1][0])return a.stops[B-1][1];var I=Rs(a.stops.map(function(rt){return rt[0]}),p),D=function(rt,ht,yt,Ft){var kt=Ft-yt,Ht=rt-yt;return kt===0?0:ht===1?Ht/kt:(Math.pow(ht,Ht)-1)/(Math.pow(ht,kt)-1)}(p,x,a.stops[I][0],a.stops[I+1][0]),k=a.stops[I][1],G=a.stops[I+1][1],X=Xa[u.type]||aA;if(a.colorSpace&&a.colorSpace!=="rgb"){var Y=vh[a.colorSpace];X=function(rt,ht){return Y.reverse(Y.interpolate(Y.forward(rt),Y.forward(ht),D))}}return typeof k.evaluate=="function"?{evaluate:function(){for(var rt=[],ht=arguments.length;ht--;)rt[ht]=arguments[ht];var yt=k.evaluate.apply(void 0,rt),Ft=G.evaluate.apply(void 0,rt);if(yt!==void 0&&Ft!==void 0)return X(yt,Ft,D)}}:X(k,G,D)}function eo(a,u,p){return u.type==="color"?p=en.parse(p):u.type==="formatted"?p=ur.fromString(p.toString()):u.type==="resolvedImage"?p=Wn.fromString(p.toString()):Fn(p)===u.type||u.type==="enum"&&u.values[p]||(p=void 0),Rc(p,a.default,u.default)}Mt.register(rs,{error:[{kind:"error"},[Fe],function(a,u){throw new hr(u[0].evaluate(a))}],typeof:[Fe,[ti],function(a,u){return Gi(Jn(u[0].evaluate(a)))}],"to-rgba":[Xi(he,4),[je],function(a,u){return u[0].evaluate(a).toArray()}],rgb:[je,[he,he,he],Nf],rgba:[je,[he,he,he,he],Nf],has:{type:Ie,overloads:[[[Fe],function(a,u){return fu(u[0].evaluate(a),a.properties())}],[[Fe,Ni],function(a,u){var p=u[1];return fu(u[0].evaluate(a),p.evaluate(a))}]]},get:{type:ti,overloads:[[[Fe],function(a,u){return du(u[0].evaluate(a),a.properties())}],[[Fe,Ni],function(a,u){var p=u[1];return du(u[0].evaluate(a),p.evaluate(a))}]]},"feature-state":[ti,[Fe],function(a,u){return du(u[0].evaluate(a),a.featureState||{})}],properties:[Ni,[],function(a){return a.properties()}],"geometry-type":[Fe,[],function(a){return a.geometryType()}],id:[ti,[],function(a){return a.id()}],zoom:[he,[],function(a){return a.globals.zoom}],"heatmap-density":[he,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[he,[],function(a){return a.globals.lineProgress||0}],accumulated:[ti,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[he,Za(he),function(a,u){for(var p=0,x=0,B=u;x<B.length;x+=1)p+=B[x].evaluate(a);return p}],"*":[he,Za(he),function(a,u){for(var p=1,x=0,B=u;x<B.length;x+=1)p*=B[x].evaluate(a);return p}],"-":{type:he,overloads:[[[he,he],function(a,u){var p=u[1];return u[0].evaluate(a)-p.evaluate(a)}],[[he],function(a,u){return-u[0].evaluate(a)}]]},"/":[he,[he,he],function(a,u){var p=u[1];return u[0].evaluate(a)/p.evaluate(a)}],"%":[he,[he,he],function(a,u){var p=u[1];return u[0].evaluate(a)%p.evaluate(a)}],ln2:[he,[],function(){return Math.LN2}],pi:[he,[],function(){return Math.PI}],e:[he,[],function(){return Math.E}],"^":[he,[he,he],function(a,u){var p=u[1];return Math.pow(u[0].evaluate(a),p.evaluate(a))}],sqrt:[he,[he],function(a,u){return Math.sqrt(u[0].evaluate(a))}],log10:[he,[he],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN10}],ln:[he,[he],function(a,u){return Math.log(u[0].evaluate(a))}],log2:[he,[he],function(a,u){return Math.log(u[0].evaluate(a))/Math.LN2}],sin:[he,[he],function(a,u){return Math.sin(u[0].evaluate(a))}],cos:[he,[he],function(a,u){return Math.cos(u[0].evaluate(a))}],tan:[he,[he],function(a,u){return Math.tan(u[0].evaluate(a))}],asin:[he,[he],function(a,u){return Math.asin(u[0].evaluate(a))}],acos:[he,[he],function(a,u){return Math.acos(u[0].evaluate(a))}],atan:[he,[he],function(a,u){return Math.atan(u[0].evaluate(a))}],min:[he,Za(he),function(a,u){return Math.min.apply(Math,u.map(function(p){return p.evaluate(a)}))}],max:[he,Za(he),function(a,u){return Math.max.apply(Math,u.map(function(p){return p.evaluate(a)}))}],abs:[he,[he],function(a,u){return Math.abs(u[0].evaluate(a))}],round:[he,[he],function(a,u){var p=u[0].evaluate(a);return p<0?-Math.round(-p):Math.round(p)}],floor:[he,[he],function(a,u){return Math.floor(u[0].evaluate(a))}],ceil:[he,[he],function(a,u){return Math.ceil(u[0].evaluate(a))}],"filter-==":[Ie,[Fe,ti],function(a,u){var p=u[0],x=u[1];return a.properties()[p.value]===x.value}],"filter-id-==":[Ie,[ti],function(a,u){var p=u[0];return a.id()===p.value}],"filter-type-==":[Ie,[Fe],function(a,u){var p=u[0];return a.geometryType()===p.value}],"filter-<":[Ie,[Fe,ti],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B<I}],"filter-id-<":[Ie,[ti],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x<B}],"filter->":[Ie,[Fe,ti],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B>I}],"filter-id->":[Ie,[ti],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x>B}],"filter-<=":[Ie,[Fe,ti],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B<=I}],"filter-id-<=":[Ie,[ti],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x<=B}],"filter->=":[Ie,[Fe,ti],function(a,u){var p=u[0],x=u[1],B=a.properties()[p.value],I=x.value;return typeof B==typeof I&&B>=I}],"filter-id->=":[Ie,[ti],function(a,u){var p=u[0],x=a.id(),B=p.value;return typeof x==typeof B&&x>=B}],"filter-has":[Ie,[ti],function(a,u){return u[0].value in a.properties()}],"filter-has-id":[Ie,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[Ie,[Xi(Fe)],function(a,u){return u[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[Ie,[Xi(ti)],function(a,u){return u[0].value.indexOf(a.id())>=0}],"filter-in-small":[Ie,[Fe,Xi(ti)],function(a,u){var p=u[0];return u[1].value.indexOf(a.properties()[p.value])>=0}],"filter-in-large":[Ie,[Fe,Xi(ti)],function(a,u){var p=u[0],x=u[1];return function(B,I,D,k){for(;D<=k;){var G=D+k>>1;if(I[G]===B)return!0;I[G]>B?k=G-1:D=G+1}return!1}(a.properties()[p.value],x.value,0,x.value.length-1)}],all:{type:Ie,overloads:[[[Ie,Ie],function(a,u){var p=u[1];return u[0].evaluate(a)&&p.evaluate(a)}],[Za(Ie),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(!x[p].evaluate(a))return!1;return!0}]]},any:{type:Ie,overloads:[[[Ie,Ie],function(a,u){var p=u[1];return u[0].evaluate(a)||p.evaluate(a)}],[Za(Ie),function(a,u){for(var p=0,x=u;p<x.length;p+=1)if(x[p].evaluate(a))return!0;return!1}]]},"!":[Ie,[Ie],function(a,u){return!u[0].evaluate(a)}],"is-supported-script":[Ie,[Fe],function(a,u){var p=a.globals&&a.globals.isSupportedScript;return!p||p(u[0].evaluate(a))}],upcase:[Fe,[Fe],function(a,u){return u[0].evaluate(a).toUpperCase()}],downcase:[Fe,[Fe],function(a,u){return u[0].evaluate(a).toLowerCase()}],concat:[Fe,Za(ti),function(a,u){return u.map(function(p){return Js(p.evaluate(a))}).join("")}],"resolved-locale":[Fe,[tn],function(a,u){return u[0].evaluate(a).resolvedLocale()}]});var Sa=function(a,u){this.expression=a,this._warningHistory={},this._evaluator=new At,this._defaultValue=u?function(p){return p.type==="color"&&pu(p.default)?new en(0,0,0,0):p.type==="color"?en.parse(p.default)||null:p.default===void 0?null:p.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function ws(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in rs}function Au(a,u){var p=new _r(rs,[],u?function(B){var I={color:je,string:Fe,number:he,enum:Fe,boolean:Ie,formatted:ln,resolvedImage:Ji};return B.type==="array"?Xi(I[B.value]||ti,B.length):I[B.type]}(u):void 0),x=p.parse(a,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return x?_h(new Sa(x,u)):Zs(p.errors)}Sa.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=p,this._evaluator.canonical=x,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=I,this.expression.evaluate(this._evaluator)},Sa.prototype.evaluate=function(a,u,p,x,B,I){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=p||null,this._evaluator.canonical=x,this._evaluator.availableImages=B||null,this._evaluator.formattedSection=I||null;try{var D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new hr("Expected value to be one of "+Object.keys(this._enumValues).map(function(k){return JSON.stringify(k)}).join(", ")+", but found "+JSON.stringify(D)+" instead.");return D}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(k.message)),this._defaultValue}};var Ya=function(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!ba(u.expression)};Ya.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,B,I)},Ya.prototype.evaluate=function(a,u,p,x,B,I){return this._styleExpression.evaluate(a,u,p,x,B,I)};var Dc=function(a,u,p,x){this.kind=a,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!ba(u.expression),this.interpolationType=x};function Vo(a,u){if((a=Au(a,u)).result==="error")return a;var p=a.value.expression,x=Xs(p);if(!x&&!Ys(u))return Zs([new Ee("","data expressions not supported")]);var B=Ja(p,["zoom"]);if(!B&&!Bl(u))return Zs([new Ee("","zoom expressions not supported")]);var I=function D(k){var G=null;if(k instanceof Ca)G=D(k.result);else if(k instanceof wa)for(var X=0,Y=k.args;X<Y.length&&!(G=D(Y[X]));X+=1);else(k instanceof Gn||k instanceof zr)&&k.input instanceof Mt&&k.input.name==="zoom"&&(G=k);return G instanceof Ee||k.eachChild(function(rt){var ht=D(rt);ht instanceof Ee?G=ht:!G&&ht?G=new Ee("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):G&&ht&&G!==ht&&(G=new Ee("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),G}(p);return I||B?I instanceof Ee?Zs([I]):I instanceof zr&&!Dn(u)?Zs([new Ee("",'"interpolate" expressions cannot be used with this property')]):_h(I?new Dc(x?"camera":"composite",a.value,I.labels,I instanceof zr?I.interpolation:void 0):new Ya(x?"constant":"source",a.value)):Zs([new Ee("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Dc.prototype.evaluateWithoutErrorHandling=function(a,u,p,x,B,I){return this._styleExpression.evaluateWithoutErrorHandling(a,u,p,x,B,I)},Dc.prototype.evaluate=function(a,u,p,x,B,I){return this._styleExpression.evaluate(a,u,p,x,B,I)},Dc.prototype.interpolationFactor=function(a,u,p){return this.interpolationType?zr.interpolationFactor(this.interpolationType,a,u,p):0};var $a=function(a,u){this._parameters=a,this._specification=u,ct(this,function p(x,B){var I,D,k,G=B.type==="color",X=x.stops&&typeof x.stops[0][0]=="object",Y=X||!(X||x.property!==void 0),rt=x.type||(Dn(B)?"exponential":"interval");if(G&&((x=ct({},x)).stops&&(x.stops=x.stops.map(function(ni){return[ni[0],en.parse(ni[1])]})),x.default=en.parse(x.default?x.default:B.default)),x.colorSpace&&x.colorSpace!=="rgb"&&!vh[x.colorSpace])throw new Error("Unknown color space: "+x.colorSpace);if(rt==="exponential")I=zf;else if(rt==="interval")I=cA;else if(rt==="categorical"){I=Uf,D=Object.create(null);for(var ht=0,yt=x.stops;ht<yt.length;ht+=1){var Ft=yt[ht];D[Ft[0]]=Ft[1]}k=typeof x.stops[0][0]}else{if(rt!=="identity")throw new Error('Unknown function type "'+rt+'"');I=eo}if(X){for(var kt={},Ht=[],jt=0;jt<x.stops.length;jt++){var qt=x.stops[jt],ae=qt[0].zoom;kt[ae]===void 0&&(kt[ae]={zoom:ae,type:x.type,property:x.property,default:x.default,stops:[]},Ht.push(ae)),kt[ae].stops.push([qt[0].value,qt[1]])}for(var ge=[],ye=0,De=Ht;ye<De.length;ye+=1){var We=De[ye];ge.push([kt[We].zoom,p(kt[We],B)])}var Ze={name:"linear"};return{kind:"composite",interpolationType:Ze,interpolationFactor:zr.interpolationFactor.bind(void 0,Ze),zoomStops:ge.map(function(ni){return ni[0]}),evaluate:function(ni,Bi){var ri=ni.zoom;return zf({stops:ge,base:x.base},B,ri).evaluate(ri,Bi)}}}if(Y){var _i=rt==="exponential"?{name:"exponential",base:x.base!==void 0?x.base:1}:null;return{kind:"camera",interpolationType:_i,interpolationFactor:zr.interpolationFactor.bind(void 0,_i),zoomStops:x.stops.map(function(ni){return ni[0]}),evaluate:function(ni){return I(x,B,ni.zoom,D,k)}}}return{kind:"source",evaluate:function(ni,Bi){var ri=Bi&&Bi.properties?Bi.properties[x.property]:void 0;return ri===void 0?Rc(x.default,B.default):I(x,B,ri,D,k)}}}(this._parameters,this._specification))};function Ho(a){var u=a.key,p=a.value,x=a.valueSpec||{},B=a.objectElementValidators||{},I=a.style,D=a.styleSpec,k=[],G=Fn(p);if(G!=="object")return[new wt(u,p,"object expected, "+G+" found")];for(var X in p){var Y=X.split(".")[0],rt=x[Y]||x["*"],ht=void 0;if(B[Y])ht=B[Y];else if(x[Y])ht=hn;else if(B["*"])ht=B["*"];else{if(!x["*"]){k.push(new wt(u,p[X],'unknown property "'+X+'"'));continue}ht=hn}k=k.concat(ht({key:(u&&u+".")+X,value:p[X],valueSpec:rt,style:I,styleSpec:D,object:p,objectKey:X},p))}for(var yt in x)B[yt]||x[yt].required&&x[yt].default===void 0&&p[yt]===void 0&&k.push(new wt(u,p,'missing required property "'+yt+'"'));return k}function tc(a){var u=a.value,p=a.valueSpec,x=a.style,B=a.styleSpec,I=a.key,D=a.arrayElementValidator||hn;if(Fn(u)!=="array")return[new wt(I,u,"array expected, "+Fn(u)+" found")];if(p.length&&u.length!==p.length)return[new wt(I,u,"array length "+p.length+" expected, length "+u.length+" found")];if(p["min-length"]&&u.length<p["min-length"])return[new wt(I,u,"array length at least "+p["min-length"]+" expected, length "+u.length+" found")];var k={type:p.value,values:p.values};B.$version<7&&(k.function=p.function),Fn(p.value)==="object"&&(k=p.value);for(var G=[],X=0;X<u.length;X++)G=G.concat(D({array:u,arrayIndex:X,value:u[X],valueSpec:k,style:x,styleSpec:B,key:I+"["+X+"]"}));return G}function Oc(a){var u=a.key,p=a.value,x=a.valueSpec,B=Fn(p);return B==="number"&&p!=p&&(B="NaN"),B!=="number"?[new wt(u,p,"number expected, "+B+" found")]:"minimum"in x&&p<x.minimum?[new wt(u,p,p+" is less than the minimum value "+x.minimum)]:"maximum"in x&&p>x.maximum?[new wt(u,p,p+" is greater than the maximum value "+x.maximum)]:[]}function Lc(a){var u,p,x,B=a.valueSpec,I=Ce(a.value.type),D={},k=I!=="categorical"&&a.value.property===void 0,G=!k,X=Fn(a.value.stops)==="array"&&Fn(a.value.stops[0])==="array"&&Fn(a.value.stops[0][0])==="object",Y=Ho({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(yt){if(I==="identity")return[new wt(yt.key,yt.value,'identity function may not have a "stops" property')];var Ft=[],kt=yt.value;return Ft=Ft.concat(tc({key:yt.key,value:kt,valueSpec:yt.valueSpec,style:yt.style,styleSpec:yt.styleSpec,arrayElementValidator:rt})),Fn(kt)==="array"&&kt.length===0&&Ft.push(new wt(yt.key,kt,"array must have at least one stop")),Ft},default:function(yt){return hn({key:yt.key,value:yt.value,valueSpec:B,style:yt.style,styleSpec:yt.styleSpec})}}});return I==="identity"&&k&&Y.push(new wt(a.key,a.value,'missing required property "property"')),I==="identity"||a.value.stops||Y.push(new wt(a.key,a.value,'missing required property "stops"')),I==="exponential"&&a.valueSpec.expression&&!Dn(a.valueSpec)&&Y.push(new wt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(G&&!Ys(a.valueSpec)?Y.push(new wt(a.key,a.value,"property functions not supported")):k&&!Bl(a.valueSpec)&&Y.push(new wt(a.key,a.value,"zoom functions not supported"))),I!=="categorical"&&!X||a.value.property!==void 0||Y.push(new wt(a.key,a.value,'"property" property is required')),Y;function rt(yt){var Ft=[],kt=yt.value,Ht=yt.key;if(Fn(kt)!=="array")return[new wt(Ht,kt,"array expected, "+Fn(kt)+" found")];if(kt.length!==2)return[new wt(Ht,kt,"array length 2 expected, length "+kt.length+" found")];if(X){if(Fn(kt[0])!=="object")return[new wt(Ht,kt,"object expected, "+Fn(kt[0])+" found")];if(kt[0].zoom===void 0)return[new wt(Ht,kt,"object stop key must have zoom")];if(kt[0].value===void 0)return[new wt(Ht,kt,"object stop key must have value")];if(x&&x>Ce(kt[0].zoom))return[new wt(Ht,kt[0].zoom,"stop zoom values must appear in ascending order")];Ce(kt[0].zoom)!==x&&(x=Ce(kt[0].zoom),p=void 0,D={}),Ft=Ft.concat(Ho({key:Ht+"[0]",value:kt[0],valueSpec:{zoom:{}},style:yt.style,styleSpec:yt.styleSpec,objectElementValidators:{zoom:Oc,value:ht}}))}else Ft=Ft.concat(ht({key:Ht+"[0]",value:kt[0],style:yt.style,styleSpec:yt.styleSpec},kt));return ws(Kt(kt[1]))?Ft.concat([new wt(Ht+"[1]",kt[1],"expressions are not allowed in function stops.")]):Ft.concat(hn({key:Ht+"[1]",value:kt[1],valueSpec:B,style:yt.style,styleSpec:yt.styleSpec}))}function ht(yt,Ft){var kt=Fn(yt.value),Ht=Ce(yt.value),jt=yt.value!==null?yt.value:Ft;if(u){if(kt!==u)return[new wt(yt.key,jt,kt+" stop domain type must match previous stop domain type "+u)]}else u=kt;if(kt!=="number"&&kt!=="string"&&kt!=="boolean")return[new wt(yt.key,jt,"stop domain value must be a number, string, or boolean")];if(kt!=="number"&&I!=="categorical"){var qt="number expected, "+kt+" found";return Ys(B)&&I===void 0&&(qt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new wt(yt.key,jt,qt)]}return I!=="categorical"||kt!=="number"||isFinite(Ht)&&Math.floor(Ht)===Ht?I!=="categorical"&&kt==="number"&&p!==void 0&&Ht<p?[new wt(yt.key,jt,"stop domain values must appear in ascending order")]:(p=Ht,I==="categorical"&&Ht in D?[new wt(yt.key,jt,"stop domain values must be unique")]:(D[Ht]=!0,[])):[new wt(yt.key,jt,"integer expected, found "+Ht)]}}function ec(a){var u=(a.expressionContext==="property"?Vo:Au)(Kt(a.value),a.valueSpec);if(u.result==="error")return u.value.map(function(x){return new wt(""+a.key+x.key,a.value,x.message)});var p=u.value.expression||u.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!p.outputDefined())return[new wt(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!ba(p))return[new wt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!ba(p))return[new wt(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Ja(p,["zoom","feature-state"]))return[new wt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Xs(p))return[new wt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fc(a){var u=a.key,p=a.value,x=a.valueSpec,B=[];return Array.isArray(x.values)?x.values.indexOf(Ce(p))===-1&&B.push(new wt(u,p,"expected one of ["+x.values.join(", ")+"], "+JSON.stringify(p)+" found")):Object.keys(x.values).indexOf(Ce(p))===-1&&B.push(new wt(u,p,"expected one of ["+Object.keys(x.values).join(", ")+"], "+JSON.stringify(p)+" found")),B}function gu(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var u=0,p=a.slice(1);u<p.length;u+=1){var x=p[u];if(!gu(x)&&typeof x!="boolean")return!1}return!0;default:return!0}}$a.deserialize=function(a){return new $a(a._parameters,a._specification)},$a.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Tl={type:"boolean",default:!1};function mu(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};gu(a)||(a=Sl(a));var u=Au(a,Tl);if(u.result==="error")throw new Error(u.value.map(function(p){return p.key+": "+p.message}).join(", "));return{filter:function(p,x,B){return u.value.evaluate(p,x,{},B)},needGeometry:function p(x){if(!Array.isArray(x))return!1;if(x[0]==="within")return!0;for(var B=1;B<x.length;B++)if(p(x[B]))return!0;return!1}(a)}}function lA(a,u){return a<u?-1:a>u?1:0}function Sl(a){if(!a)return!0;var u,p=a[0];return a.length<=1?p!=="any":p==="=="?yu(a[1],a[2],"=="):p==="!="?vu(yu(a[1],a[2],"==")):p==="<"||p===">"||p==="<="||p===">="?yu(a[1],a[2],p):p==="any"?(u=a.slice(1),["any"].concat(u.map(Sl))):p==="all"?["all"].concat(a.slice(1).map(Sl)):p==="none"?["all"].concat(a.slice(1).map(Sl).map(vu)):p==="in"?kc(a[1],a.slice(2)):p==="!in"?vu(kc(a[1],a.slice(2))):p==="has"?ic(a[1]):p==="!has"?vu(ic(a[1])):p!=="within"||a}function yu(a,u,p){switch(a){case"$type":return["filter-type-"+p,u];case"$id":return["filter-id-"+p,u];default:return["filter-"+p,a,u]}}function kc(a,u){if(u.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(p){return typeof p!=typeof u[0]})?["filter-in-large",a,["literal",u.sort(lA)]]:["filter-in-small",a,["literal",u]]}}function ic(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function vu(a){return["!",a]}function nc(a){return gu(Kt(a.value))?ec(ct({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(p){var x=p.value,B=p.key;if(Fn(x)!=="array")return[new wt(B,x,"array expected, "+Fn(x)+" found")];var I,D=p.styleSpec,k=[];if(x.length<1)return[new wt(B,x,"filter array must have at least 1 element")];switch(k=k.concat(Fc({key:B+"[0]",value:x[0],valueSpec:D.filter_operator,style:p.style,styleSpec:p.styleSpec})),Ce(x[0])){case"<":case"<=":case">":case">=":x.length>=2&&Ce(x[1])==="$type"&&k.push(new wt(B,x,'"$type" cannot be use with operator "'+x[0]+'"'));case"==":case"!=":x.length!==3&&k.push(new wt(B,x,'filter array for operator "'+x[0]+'" must have 3 elements'));case"in":case"!in":x.length>=2&&(I=Fn(x[1]))!=="string"&&k.push(new wt(B+"[1]",x[1],"string expected, "+I+" found"));for(var G=2;G<x.length;G++)I=Fn(x[G]),Ce(x[1])==="$type"?k=k.concat(Fc({key:B+"["+G+"]",value:x[G],valueSpec:D.geometry_type,style:p.style,styleSpec:p.styleSpec})):I!=="string"&&I!=="number"&&I!=="boolean"&&k.push(new wt(B+"["+G+"]",x[G],"string, number, or boolean expected, "+I+" found"));break;case"any":case"all":case"none":for(var X=1;X<x.length;X++)k=k.concat(u({key:B+"["+X+"]",value:x[X],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":I=Fn(x[1]),x.length!==2?k.push(new wt(B,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="string"&&k.push(new wt(B+"[1]",x[1],"string expected, "+I+" found"));break;case"within":I=Fn(x[1]),x.length!==2?k.push(new wt(B,x,'filter array for "'+x[0]+'" operator must have 2 elements')):I!=="object"&&k.push(new wt(B+"[1]",x[1],"object expected, "+I+" found"))}return k}(a)}function bh(a,u){var p=a.key,x=a.style,B=a.styleSpec,I=a.value,D=a.objectKey,k=B[u+"_"+a.layerType];if(!k)return[];var G=D.match(/^(.*)-transition$/);if(u==="paint"&&G&&k[G[1]]&&k[G[1]].transition)return hn({key:p,value:I,valueSpec:B.transition,style:x,styleSpec:B});var X,Y=a.valueSpec||k[D];if(!Y)return[new wt(p,I,'unknown property "'+D+'"')];if(Fn(I)==="string"&&Ys(Y)&&!Y.tokens&&(X=/^{([^}]+)}$/.exec(I)))return[new wt(p,I,'"'+D+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(X[1])+" }`.")];var rt=[];return a.layerType==="symbol"&&(D==="text-field"&&x&&!x.glyphs&&rt.push(new wt(p,I,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&pu(Kt(I))&&Ce(I.type)==="identity"&&rt.push(new wt(p,I,'"text-font" does not support identity functions'))),rt.concat(hn({key:a.key,value:I,valueSpec:Y,style:x,styleSpec:B,expressionContext:"property",propertyType:u,propertyKey:D}))}function xh(a){return bh(a,"paint")}function Il(a){return bh(a,"layout")}function Gf(a){var u=[],p=a.value,x=a.key,B=a.style,I=a.styleSpec;p.type||p.ref||u.push(new wt(x,p,'either "type" or "ref" is required'));var D,k=Ce(p.type),G=Ce(p.ref);if(p.id)for(var X=Ce(p.id),Y=0;Y<a.arrayIndex;Y++){var rt=B.layers[Y];Ce(rt.id)===X&&u.push(new wt(x,p.id,'duplicate layer id "'+p.id+'", previously used at line '+rt.id.__line__))}if("ref"in p)["type","source","source-layer","filter","layout"].forEach(function(Ft){Ft in p&&u.push(new wt(x,p[Ft],'"'+Ft+'" is prohibited for ref layers'))}),B.layers.forEach(function(Ft){Ce(Ft.id)===G&&(D=Ft)}),D?D.ref?u.push(new wt(x,p.ref,"ref cannot reference another ref layer")):k=Ce(D.type):u.push(new wt(x,p.ref,'ref layer "'+G+'" not found'));else if(k!=="background")if(p.source){var ht=B.sources&&B.sources[p.source],yt=ht&&Ce(ht.type);ht?yt==="vector"&&k==="raster"?u.push(new wt(x,p.source,'layer "'+p.id+'" requires a raster source')):yt==="raster"&&k!=="raster"?u.push(new wt(x,p.source,'layer "'+p.id+'" requires a vector source')):yt!=="vector"||p["source-layer"]?yt==="raster-dem"&&k!=="hillshade"?u.push(new wt(x,p.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!p.paint||!p.paint["line-gradient"]||yt==="geojson"&&ht.lineMetrics||u.push(new wt(x,p,'layer "'+p.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new wt(x,p,'layer "'+p.id+'" must specify a "source-layer"')):u.push(new wt(x,p.source,'source "'+p.source+'" not found'))}else u.push(new wt(x,p,'missing required property "source"'));return u=u.concat(Ho({key:x,value:p,valueSpec:I.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return hn({key:x+".type",value:p.type,valueSpec:I.layer.type,style:a.style,styleSpec:a.styleSpec,object:p,objectKey:"type"})},filter:nc,layout:function(Ft){return Ho({layer:p,key:Ft.key,value:Ft.value,style:Ft.style,styleSpec:Ft.styleSpec,objectElementValidators:{"*":function(kt){return Il(ct({layerType:k},kt))}}})},paint:function(Ft){return Ho({layer:p,key:Ft.key,value:Ft.value,style:Ft.style,styleSpec:Ft.styleSpec,objectElementValidators:{"*":function(kt){return xh(ct({layerType:k},kt))}}})}}}))}function rc(a){var u=a.value,p=a.key,x=Fn(u);return x!=="string"?[new wt(p,u,"string expected, "+x+" found")]:[]}var Xn={promoteId:function(a){var u=a.key,p=a.value;if(Fn(p)==="string")return rc({key:u,value:p});var x=[];for(var B in p)x.push.apply(x,rc({key:u+"."+B,value:p[B]}));return x}};function _u(a){var u=a.value,p=a.key,x=a.styleSpec,B=a.style;if(!u.type)return[new wt(p,u,'"type" is required')];var I,D=Ce(u.type);switch(D){case"vector":case"raster":case"raster-dem":return Ho({key:p,value:u,valueSpec:x["source_"+D.replace("-","_")],style:a.style,styleSpec:x,objectElementValidators:Xn});case"geojson":if(I=Ho({key:p,value:u,valueSpec:x.source_geojson,style:B,styleSpec:x,objectElementValidators:Xn}),u.cluster)for(var k in u.clusterProperties){var G=u.clusterProperties[k],X=G[0],Y=typeof X=="string"?[X,["accumulated"],["get",k]]:X;I.push.apply(I,ec({key:p+"."+k+".map",value:G[1],expressionContext:"cluster-map"})),I.push.apply(I,ec({key:p+"."+k+".reduce",value:Y,expressionContext:"cluster-reduce"}))}return I;case"video":return Ho({key:p,value:u,valueSpec:x.source_video,style:B,styleSpec:x});case"image":return Ho({key:p,value:u,valueSpec:x.source_image,style:B,styleSpec:x});case"canvas":return[new wt(p,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fc({key:p+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function $s(a){var u=a.value,p=a.styleSpec,x=p.light,B=a.style,I=[],D=Fn(u);if(u===void 0)return I;if(D!=="object")return I.concat([new wt("light",u,"object expected, "+D+" found")]);for(var k in u){var G=k.match(/^(.*)-transition$/);I=I.concat(G&&x[G[1]]&&x[G[1]].transition?hn({key:k,value:u[k],valueSpec:p.transition,style:B,styleSpec:p}):x[k]?hn({key:k,value:u[k],valueSpec:x[k],style:B,styleSpec:p}):[new wt(k,u[k],'unknown property "'+k+'"')])}return I}var ta={"*":function(){return[]},array:tc,boolean:function(a){var u=a.value,p=a.key,x=Fn(u);return x!=="boolean"?[new wt(p,u,"boolean expected, "+x+" found")]:[]},number:Oc,color:function(a){var u=a.key,p=a.value,x=Fn(p);return x!=="string"?[new wt(u,p,"color expected, "+x+" found")]:Qe(p)===null?[new wt(u,p,'color expected, "'+p+'" found')]:[]},constants:g,enum:Fc,filter:nc,function:Lc,layer:Gf,object:Ho,source:_u,light:$s,string:rc,formatted:function(a){return rc(a).length===0?[]:ec(a)},resolvedImage:function(a){return rc(a).length===0?[]:ec(a)}};function hn(a){var u=a.value,p=a.valueSpec,x=a.styleSpec;return p.expression&&pu(Ce(u))?Lc(a):p.expression&&ws(Kt(u))?ec(a):p.type&&ta[p.type]?ta[p.type](a):Ho(ct({},a,{valueSpec:p.type?x[p.type]:p}))}function kn(a){var u=a.value,p=a.key,x=rc(a);return x.length||(u.indexOf("{fontstack}")===-1&&x.push(new wt(p,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&x.push(new wt(p,u,'"glyphs" url must include a "{range}" token'))),x}function Wo(a,u){u===void 0&&(u=st);var p=[];return p=p.concat(hn({key:"",value:a,valueSpec:u.$root,styleSpec:u,style:a,objectElementValidators:{glyphs:kn,"*":function(){return[]}}})),a.constants&&(p=p.concat(g({key:"constants",value:a.constants}))),Ml(p)}function Ml(a){return[].concat(a).sort(function(u,p){return u.line-p.line})}function Nc(a){return function(){for(var u=[],p=arguments.length;p--;)u[p]=arguments[p];return Ml(a.apply(this,u))}}Wo.source=Nc(_u),Wo.light=Nc($s),Wo.layer=Nc(Gf),Wo.filter=Nc(nc),Wo.paintProperty=Nc(xh),Wo.layoutProperty=Nc(Il);var Pl=Wo,uA=Pl.light,hA=Pl.paintProperty,Uc=Pl.layoutProperty;function Rl(a,u){var p=!1;if(u&&u.length)for(var x=0,B=u;x<B.length;x+=1)a.fire(new ft(new Error(B[x].message))),p=!0;return p}var Ds=Nn;function Nn(a,u,p){var x=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var B=new Int32Array(this.arrayBuffer);a=B[0],this.d=(u=B[1])+2*(p=B[2]);for(var I=0;I<this.d*this.d;I++){var D=B[3+I],k=B[3+I+1];x.push(D===k?null:B.subarray(D,k))}var G=B[3+x.length+1];this.keys=B.subarray(B[3+x.length],G),this.bboxes=B.subarray(G),this.insert=this._insertReadonly}else{this.d=u+2*p;for(var X=0;X<this.d*this.d;X++)x.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=p,this.scale=u/a,this.uid=0;var Y=p/u*a;this.min=-Y,this.max=a+Y}Nn.prototype.insert=function(a,u,p,x,B){this._forEachCell(u,p,x,B,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(B)},Nn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Nn.prototype._insertCell=function(a,u,p,x,B,I){this.cells[B].push(I)},Nn.prototype.query=function(a,u,p,x,B){var I=this.min,D=this.max;if(a<=I&&u<=I&&D<=p&&D<=x&&!B)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(a,u,p,x,this._queryCell,k,{},B),k},Nn.prototype._queryCell=function(a,u,p,x,B,I,D,k){var G=this.cells[B];if(G!==null)for(var X=this.keys,Y=this.bboxes,rt=0;rt<G.length;rt++){var ht=G[rt];if(D[ht]===void 0){var yt=4*ht;(k?k(Y[yt+0],Y[yt+1],Y[yt+2],Y[yt+3]):a<=Y[yt+2]&&u<=Y[yt+3]&&p>=Y[yt+0]&&x>=Y[yt+1])?(D[ht]=!0,I.push(X[ht])):D[ht]=!1}}},Nn.prototype._forEachCell=function(a,u,p,x,B,I,D,k){for(var G=this._convertToCellCoord(a),X=this._convertToCellCoord(u),Y=this._convertToCellCoord(p),rt=this._convertToCellCoord(x),ht=G;ht<=Y;ht++)for(var yt=X;yt<=rt;yt++){var Ft=this.d*yt+ht;if((!k||k(this._convertFromCellCoord(ht),this._convertFromCellCoord(yt),this._convertFromCellCoord(ht+1),this._convertFromCellCoord(yt+1)))&&B.call(this,a,u,p,x,Ft,I,D,k))return}},Nn.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Nn.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Nn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=3+this.cells.length+1+1,p=0,x=0;x<this.cells.length;x++)p+=this.cells[x].length;var B=new Int32Array(u+p+this.keys.length+this.bboxes.length);B[0]=this.extent,B[1]=this.n,B[2]=this.padding;for(var I=u,D=0;D<a.length;D++){var k=a[D];B[3+D]=I,B.set(k,I),I+=k.length}return B[3+a.length]=I,B.set(this.keys,I),B[3+a.length+1]=I+=this.keys.length,B.set(this.bboxes,I),I+=this.bboxes.length,B.buffer};var zc=S.ImageData,jf=S.ImageBitmap,Er={};function si(a,u,p){p===void 0&&(p={}),Object.defineProperty(u,"_classRegistryKey",{value:a,writeable:!1}),Er[a]={klass:u,omit:p.omit||[],shallow:p.shallow||[]}}for(var Io in si("Object",Object),Ds.serialize=function(a,u){var p=a.toArrayBuffer();return u&&u.push(p),{buffer:p}},Ds.deserialize=function(a){return new Ds(a.buffer)},si("Grid",Ds),si("Color",en),si("Error",Error),si("ResolvedImage",Wn),si("StylePropertyFunction",$a),si("StyleExpression",Sa,{omit:["_evaluator"]}),si("ZoomDependentExpression",Dc),si("ZoomConstantExpression",Ya),si("CompoundExpression",Mt,{omit:["_evaluate"]}),rs)rs[Io]._classRegistryKey||si("Expression_"+Io,rs[Io]);function bu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Jo(a){return jf&&a instanceof jf}function os(a,u){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(bu(a)||Jo(a))return u&&u.push(a),a;if(ArrayBuffer.isView(a)){var p=a;return u&&u.push(p.buffer),p}if(a instanceof zc)return u&&u.push(a.data.buffer),a;if(Array.isArray(a)){for(var x=[],B=0,I=a;B<I.length;B+=1)x.push(os(I[B],u));return x}if(typeof a=="object"){var D=a.constructor,k=D._classRegistryKey;if(!k)throw new Error("can't serialize object of unregistered class");var G=D.serialize?D.serialize(a,u):{};if(!D.serialize){for(var X in a)if(a.hasOwnProperty(X)&&!(Er[k].omit.indexOf(X)>=0)){var Y=a[X];G[X]=Er[k].shallow.indexOf(X)>=0?Y:os(Y,u)}a instanceof Error&&(G.message=a.message)}if(G.$name)throw new Error("$name property is reserved for worker serialization logic.");return k!=="Object"&&(G.$name=k),G}throw new Error("can't serialize object of type "+typeof a)}function yo(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||bu(a)||Jo(a)||ArrayBuffer.isView(a)||a instanceof zc)return a;if(Array.isArray(a))return a.map(yo);if(typeof a=="object"){var u=a.$name||"Object",p=Er[u].klass;if(!p)throw new Error("can't deserialize unregistered class "+u);if(p.deserialize)return p.deserialize(a);for(var x=Object.create(p.prototype),B=0,I=Object.keys(a);B<I.length;B+=1){var D=I[B];if(D!=="$name"){var k=a[D];x[D]=Er[u].shallow.indexOf(D)>=0?k:yo(k)}}return x}throw new Error("can't deserialize object of type "+typeof a)}var wh=function(){this.first=!0};wh.prototype.update=function(a,u){var p=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=p,!0))};var Ye={"Latin-1 Supplement":function(a){return a>=128&&a<=255},Arabic:function(a){return a>=1536&&a<=1791},"Arabic Supplement":function(a){return a>=1872&&a<=1919},"Arabic Extended-A":function(a){return a>=2208&&a<=2303},"Hangul Jamo":function(a){return a>=4352&&a<=4607},"Unified Canadian Aboriginal Syllabics":function(a){return a>=5120&&a<=5759},Khmer:function(a){return a>=6016&&a<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(a){return a>=6320&&a<=6399},"General Punctuation":function(a){return a>=8192&&a<=8303},"Letterlike Symbols":function(a){return a>=8448&&a<=8527},"Number Forms":function(a){return a>=8528&&a<=8591},"Miscellaneous Technical":function(a){return a>=8960&&a<=9215},"Control Pictures":function(a){return a>=9216&&a<=9279},"Optical Character Recognition":function(a){return a>=9280&&a<=9311},"Enclosed Alphanumerics":function(a){return a>=9312&&a<=9471},"Geometric Shapes":function(a){return a>=9632&&a<=9727},"Miscellaneous Symbols":function(a){return a>=9728&&a<=9983},"Miscellaneous Symbols and Arrows":function(a){return a>=11008&&a<=11263},"CJK Radicals Supplement":function(a){return a>=11904&&a<=12031},"Kangxi Radicals":function(a){return a>=12032&&a<=12255},"Ideographic Description Characters":function(a){return a>=12272&&a<=12287},"CJK Symbols and Punctuation":function(a){return a>=12288&&a<=12351},Hiragana:function(a){return a>=12352&&a<=12447},Katakana:function(a){return a>=12448&&a<=12543},Bopomofo:function(a){return a>=12544&&a<=12591},"Hangul Compatibility Jamo":function(a){return a>=12592&&a<=12687},Kanbun:function(a){return a>=12688&&a<=12703},"Bopomofo Extended":function(a){return a>=12704&&a<=12735},"CJK Strokes":function(a){return a>=12736&&a<=12783},"Katakana Phonetic Extensions":function(a){return a>=12784&&a<=12799},"Enclosed CJK Letters and Months":function(a){return a>=12800&&a<=13055},"CJK Compatibility":function(a){return a>=13056&&a<=13311},"CJK Unified Ideographs Extension A":function(a){return a>=13312&&a<=19903},"Yijing Hexagram Symbols":function(a){return a>=19904&&a<=19967},"CJK Unified Ideographs":function(a){return a>=19968&&a<=40959},"Yi Syllables":function(a){return a>=40960&&a<=42127},"Yi Radicals":function(a){return a>=42128&&a<=42191},"Hangul Jamo Extended-A":function(a){return a>=43360&&a<=43391},"Hangul Syllables":function(a){return a>=44032&&a<=55215},"Hangul Jamo Extended-B":function(a){return a>=55216&&a<=55295},"Private Use Area":function(a){return a>=57344&&a<=63743},"CJK Compatibility Ideographs":function(a){return a>=63744&&a<=64255},"Arabic Presentation Forms-A":function(a){return a>=64336&&a<=65023},"Vertical Forms":function(a){return a>=65040&&a<=65055},"CJK Compatibility Forms":function(a){return a>=65072&&a<=65103},"Small Form Variants":function(a){return a>=65104&&a<=65135},"Arabic Presentation Forms-B":function(a){return a>=65136&&a<=65279},"Halfwidth and Fullwidth Forms":function(a){return a>=65280&&a<=65519}};function Ch(a){for(var u=0,p=a;u<p.length;u+=1)if(xu(p[u].charCodeAt(0)))return!0;return!1}function xu(a){return!(a!==746&&a!==747&&(a<4352||!(Ye["Bopomofo Extended"](a)||Ye.Bopomofo(a)||Ye["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ye["CJK Compatibility Ideographs"](a)||Ye["CJK Compatibility"](a)||Ye["CJK Radicals Supplement"](a)||Ye["CJK Strokes"](a)||!(!Ye["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ye["CJK Unified Ideographs Extension A"](a)||Ye["CJK Unified Ideographs"](a)||Ye["Enclosed CJK Letters and Months"](a)||Ye["Hangul Compatibility Jamo"](a)||Ye["Hangul Jamo Extended-A"](a)||Ye["Hangul Jamo Extended-B"](a)||Ye["Hangul Jamo"](a)||Ye["Hangul Syllables"](a)||Ye.Hiragana(a)||Ye["Ideographic Description Characters"](a)||Ye.Kanbun(a)||Ye["Kangxi Radicals"](a)||Ye["Katakana Phonetic Extensions"](a)||Ye.Katakana(a)&&a!==12540||!(!Ye["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ye["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ye["Unified Canadian Aboriginal Syllabics"](a)||Ye["Unified Canadian Aboriginal Syllabics Extended"](a)||Ye["Vertical Forms"](a)||Ye["Yijing Hexagram Symbols"](a)||Ye["Yi Syllables"](a)||Ye["Yi Radicals"](a))))}function Eh(a){return!(xu(a)||function(u){return!!(Ye["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||Ye["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||Ye["Letterlike Symbols"](u)||Ye["Number Forms"](u)||Ye["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||Ye["Control Pictures"](u)&&u!==9251||Ye["Optical Character Recognition"](u)||Ye["Enclosed Alphanumerics"](u)||Ye["Geometric Shapes"](u)||Ye["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||Ye["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||Ye["CJK Symbols and Punctuation"](u)||Ye.Katakana(u)||Ye["Private Use Area"](u)||Ye["CJK Compatibility Forms"](u)||Ye["Small Form Variants"](u)||Ye["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(a))}function ss(a){return a>=1424&&a<=2303||Ye["Arabic Presentation Forms-A"](a)||Ye["Arabic Presentation Forms-B"](a)}function Mo(a,u){return!(!u&&ss(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ye.Khmer(a))}function wu(a){for(var u=0,p=a;u<p.length;u+=1)if(ss(p[u].charCodeAt(0)))return!0;return!1}var Cu=null,Po="unavailable",ea=null,Bh=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(Po="error"),Cu&&Cu(a)};function Gc(){Br.fire(new Ot("pluginStateChange",{pluginStatus:Po,pluginURL:ea}))}var Br=new _t,Th=function(){return Po},Cs=function(){if(Po!=="deferred"||!ea)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Po="loading",Gc(),ea&&Xt({url:ea},function(a){a?Bh(a):(Po="loaded",Gc())})},io={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Po==="loaded"||io.applyArabicShaping!=null},isLoading:function(){return Po==="loading"},setState:function(a){Po=a.pluginStatus,ea=a.pluginURL},isParsed:function(){return io.applyArabicShaping!=null&&io.processBidirectionalText!=null&&io.processStyledBidirectionalText!=null},getPluginURL:function(){return ea}},Vi=function(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wh,this.transition={})};Vi.prototype.isSupportedScript=function(a){return function(u,p){for(var x=0,B=u;x<B.length;x+=1)if(!Mo(B[x].charCodeAt(0),p))return!1;return!0}(a,io.isLoaded())},Vi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Vi.prototype.getCrossfadeParameters=function(){var a=this.zoom,u=a-Math.floor(a),p=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*u}};var Os=function(a,u){this.property=a,this.value=u,this.expression=function(p,x){if(pu(p))return new $a(p,x);if(ws(p)){var B=Vo(p,x);if(B.result==="error")throw new Error(B.value.map(function(D){return D.key+": "+D.message}).join(", "));return B.value}var I=p;return typeof p=="string"&&x.type==="color"&&(I=en.parse(p)),{kind:"constant",evaluate:function(){return I}}}(u===void 0?a.specification.default:u,a.specification)};Os.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Os.prototype.possiblyEvaluate=function(a,u,p){return this.property.possiblyEvaluate(this,a,u,p)};var as=function(a){this.property=a,this.value=new Os(a,void 0)};as.prototype.transitioned=function(a,u){return new Ia(this.property,this.value,u,tt({},a.transition,this.transition),a.now)},as.prototype.untransitioned=function(){return new Ia(this.property,this.value,null,{},0)};var Jr=function(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)};Jr.prototype.getValue=function(a){return Lt(this._values[a].value.value)},Jr.prototype.setValue=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new as(this._values[a].property)),this._values[a].value=new Os(this._values[a].property,u===null?void 0:Lt(u))},Jr.prototype.getTransition=function(a){return Lt(this._values[a].transition)},Jr.prototype.setTransition=function(a,u){this._values.hasOwnProperty(a)||(this._values[a]=new as(this._values[a].property)),this._values[a].transition=Lt(u)||void 0},Jr.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],B=this.getValue(x);B!==void 0&&(a[x]=B);var I=this.getTransition(x);I!==void 0&&(a[x+"-transition"]=I)}return a},Jr.prototype.transitioned=function(a,u){for(var p=new ia(this._properties),x=0,B=Object.keys(this._values);x<B.length;x+=1){var I=B[x];p._values[I]=this._values[I].transitioned(a,u._values[I])}return p},Jr.prototype.untransitioned=function(){for(var a=new ia(this._properties),u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u];a._values[x]=this._values[x].untransitioned()}return a};var Ia=function(a,u,p,x,B){this.property=a,this.value=u,this.begin=B+x.delay||0,this.end=this.begin+x.duration||0,a.specification.transition&&(x.delay||x.duration)&&(this.prior=p)};Ia.prototype.possiblyEvaluate=function(a,u,p){var x=a.now||0,B=this.value.possiblyEvaluate(a,u,p),I=this.prior;if(I){if(x>this.end)return this.prior=null,B;if(this.value.isDataDriven())return this.prior=null,B;if(x<this.begin)return I.possiblyEvaluate(a,u,p);var D=(x-this.begin)/(this.end-this.begin);return this.property.interpolate(I.possiblyEvaluate(a,u,p),B,function(k){if(k<=0)return 0;if(k>=1)return 1;var G=k*k,X=G*k;return 4*(k<.5?X:3*(k-G)+X-.75)}(D))}return B};var ia=function(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)};ia.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Dl(this._properties),B=0,I=Object.keys(this._values);B<I.length;B+=1){var D=I[B];x._values[D]=this._values[D].possiblyEvaluate(a,u,p)}return x},ia.prototype.hasTransition=function(){for(var a=0,u=Object.keys(this._values);a<u.length;a+=1)if(this._values[u[a]].prior)return!0;return!1};var cs=function(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)};cs.prototype.getValue=function(a){return Lt(this._values[a].value)},cs.prototype.setValue=function(a,u){this._values[a]=new Os(this._values[a].property,u===null?void 0:Lt(u))},cs.prototype.serialize=function(){for(var a={},u=0,p=Object.keys(this._values);u<p.length;u+=1){var x=p[u],B=this.getValue(x);B!==void 0&&(a[x]=B)}return a},cs.prototype.possiblyEvaluate=function(a,u,p){for(var x=new Dl(this._properties),B=0,I=Object.keys(this._values);B<I.length;B+=1){var D=I[B];x._values[D]=this._values[D].possiblyEvaluate(a,u,p)}return x};var no=function(a,u,p){this.property=a,this.value=u,this.parameters=p};no.prototype.isConstant=function(){return this.value.kind==="constant"},no.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},no.prototype.evaluate=function(a,u,p,x){return this.property.evaluate(this.value,this.parameters,a,u,p,x)};var Dl=function(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)};Dl.prototype.get=function(a){return this._values[a]};var xi=function(a){this.specification=a};xi.prototype.possiblyEvaluate=function(a,u){return a.expression.evaluate(u)},xi.prototype.interpolate=function(a,u,p){var x=Xa[this.specification.type];return x?x(a,u,p):a};var ui=function(a,u){this.specification=a,this.overrides=u};ui.prototype.possiblyEvaluate=function(a,u,p,x){return new no(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},p,x)}:a.expression,u)},ui.prototype.interpolate=function(a,u,p){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new no(this,{kind:"constant",value:void 0},a.parameters);var x=Xa[this.specification.type];return x?new no(this,{kind:"constant",value:x(a.value.value,u.value.value,p)},a.parameters):a},ui.prototype.evaluate=function(a,u,p,x,B,I){return a.kind==="constant"?a.value:a.evaluate(u,p,x,B,I)};var Eu=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x,B,I){if(p.value===void 0)return new no(this,{kind:"constant",value:void 0},x);if(p.expression.kind==="constant"){var D=p.expression.evaluate(x,null,{},B,I),k=p.property.specification.type==="resolvedImage"&&typeof D!="string"?D.name:D,G=this._calculate(k,k,k,x);return new no(this,{kind:"constant",value:G},x)}if(p.expression.kind==="camera"){var X=this._calculate(p.expression.evaluate({zoom:x.zoom-1}),p.expression.evaluate({zoom:x.zoom}),p.expression.evaluate({zoom:x.zoom+1}),x);return new no(this,{kind:"constant",value:X},x)}return new no(this,p.expression,x)},u.prototype.evaluate=function(p,x,B,I,D,k){if(p.kind==="source"){var G=p.evaluate(x,B,I,D,k);return this._calculate(G,G,G,x)}return p.kind==="composite"?this._calculate(p.evaluate({zoom:Math.floor(x.zoom)-1},B,I),p.evaluate({zoom:Math.floor(x.zoom)},B,I),p.evaluate({zoom:Math.floor(x.zoom)+1},B,I),x):p.value},u.prototype._calculate=function(p,x,B,I){return I.zoom>I.zoomHistory.lastIntegerZoom?{from:p,to:x}:{from:B,to:x}},u.prototype.interpolate=function(p){return p},u}(ui),uo=function(a){this.specification=a};uo.prototype.possiblyEvaluate=function(a,u,p,x){if(a.value!==void 0){if(a.expression.kind==="constant"){var B=a.expression.evaluate(u,null,{},p,x);return this._calculate(B,B,B,u)}return this._calculate(a.expression.evaluate(new Vi(Math.floor(u.zoom-1),u)),a.expression.evaluate(new Vi(Math.floor(u.zoom),u)),a.expression.evaluate(new Vi(Math.floor(u.zoom+1),u)),u)}},uo.prototype._calculate=function(a,u,p,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:p,to:u}},uo.prototype.interpolate=function(a){return a};var Xr=function(a){this.specification=a};Xr.prototype.possiblyEvaluate=function(a,u,p,x){return!!a.expression.evaluate(u,null,{},p,x)},Xr.prototype.interpolate=function(){return!1};var Qn=function(a){for(var u in this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],a){var p=a[u];p.specification.overridable&&this.overridableProperties.push(u);var x=this.defaultPropertyValues[u]=new Os(p,void 0),B=this.defaultTransitionablePropertyValues[u]=new as(p);this.defaultTransitioningPropertyValues[u]=B.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=x.possiblyEvaluate({})}};si("DataDrivenProperty",ui),si("DataConstantProperty",xi),si("CrossFadedDataDrivenProperty",Eu),si("CrossFadedProperty",uo),si("ColorRampProperty",Xr);var Ui=function(a){function u(p,x){if(a.call(this),this.id=p.id,this.type=p.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},p.type!=="custom"&&(this.metadata=(p=p).metadata,this.minzoom=p.minzoom,this.maxzoom=p.maxzoom,p.type!=="background"&&(this.source=p.source,this.sourceLayer=p["source-layer"],this.filter=p.filter),x.layout&&(this._unevaluatedLayout=new cs(x.layout)),x.paint)){for(var B in this._transitionablePaint=new Jr(x.paint),p.paint)this.setPaintProperty(B,p.paint[B],{validate:!1});for(var I in p.layout)this.setLayoutProperty(I,p.layout[I],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Dl(x.paint)}}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(p){return p==="visibility"?this.visibility:this._unevaluatedLayout.getValue(p)},u.prototype.setLayoutProperty=function(p,x,B){B===void 0&&(B={}),x!=null&&this._validate(Uc,"layers."+this.id+".layout."+p,p,x,B)||(p!=="visibility"?this._unevaluatedLayout.setValue(p,x):this.visibility=x)},u.prototype.getPaintProperty=function(p){return Gt(p,"-transition")?this._transitionablePaint.getTransition(p.slice(0,-11)):this._transitionablePaint.getValue(p)},u.prototype.setPaintProperty=function(p,x,B){if(B===void 0&&(B={}),x!=null&&this._validate(hA,"layers."+this.id+".paint."+p,p,x,B))return!1;if(Gt(p,"-transition"))return this._transitionablePaint.setTransition(p.slice(0,-11),x||void 0),!1;var I=this._transitionablePaint._values[p],D=I.property.specification["property-type"]==="cross-faded-data-driven",k=I.value.isDataDriven(),G=I.value;this._transitionablePaint.setValue(p,x),this._handleSpecialPaintPropertyUpdate(p);var X=this._transitionablePaint._values[p].value;return X.isDataDriven()||k||D||this._handleOverridablePaintPropertyUpdate(p,G,X)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,B){return!1},u.prototype.isHidden=function(p){return!!(this.minzoom&&p<this.minzoom)||!!(this.maxzoom&&p>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(p){this._transitioningPaint=this._transitionablePaint.transitioned(p,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(p,x){p.getCrossfadeParameters&&(this._crossfadeParameters=p.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(p,void 0,x)),this.paint=this._transitioningPaint.possiblyEvaluate(p,void 0,x)},u.prototype.serialize=function(){var p={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(p.layout=p.layout||{},p.layout.visibility=this.visibility),lt(p,function(x,B){return!(x===void 0||B==="layout"&&!Object.keys(x).length||B==="paint"&&!Object.keys(x).length)})},u.prototype._validate=function(p,x,B,I,D){return D===void 0&&(D={}),(!D||D.validate!==!1)&&Rl(this,p.call(Pl,{key:x,layerType:this.type,objectKey:B,value:I,styleSpec:st,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var p in this.paint._values){var x=this.paint.get(p);if(x instanceof no&&Ys(x.property.specification)&&(x.value.kind==="source"||x.value.kind==="composite")&&x.value.isStateDependent)return!0}return!1},u}(_t),ls={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},An=function(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ki=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function kr(a,u){u===void 0&&(u=1);var p=0,x=0;return{members:a.map(function(B){var I=ls[B.type].BYTES_PER_ELEMENT,D=p=Bu(p,Math.max(u,I)),k=B.components||1;return x=Math.max(x,I),p+=I*k,{name:B.name,type:B.type,components:k,offset:D}}),size:Bu(p,Math.max(x,u)),alignment:u}}function Bu(a,u){return Math.ceil(a/u)*u}Ki.serialize=function(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},Ki.deserialize=function(a){var u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},Ki.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ki.prototype.clear=function(){this.length=0},Ki.prototype.resize=function(a){this.reserve(a),this.length=a},Ki.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},Ki.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Xo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.int16[I+0]=x,this.int16[I+1]=B,p},u}(Ki);Xo.prototype.bytesPerElement=4,si("StructArrayLayout2i4",Xo);var Sh=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var D=this.length;return this.resize(D+1),this.emplace(D,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,D){var k=4*p;return this.int16[k+0]=x,this.int16[k+1]=B,this.int16[k+2]=I,this.int16[k+3]=D,p},u}(Ki);Sh.prototype.bytesPerElement=8,si("StructArrayLayout4i8",Sh);var dr=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k){var G=this.length;return this.resize(G+1),this.emplace(G,p,x,B,I,D,k)},u.prototype.emplace=function(p,x,B,I,D,k,G){var X=6*p;return this.int16[X+0]=x,this.int16[X+1]=B,this.int16[X+2]=I,this.int16[X+3]=D,this.int16[X+4]=k,this.int16[X+5]=G,p},u}(Ki);dr.prototype.bytesPerElement=12,si("StructArrayLayout2i4i12",dr);var ro=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k){var G=this.length;return this.resize(G+1),this.emplace(G,p,x,B,I,D,k)},u.prototype.emplace=function(p,x,B,I,D,k,G){var X=4*p,Y=8*p;return this.int16[X+0]=x,this.int16[X+1]=B,this.uint8[Y+4]=I,this.uint8[Y+5]=D,this.uint8[Y+6]=k,this.uint8[Y+7]=G,p},u}(Ki);ro.prototype.bytesPerElement=8,si("StructArrayLayout2i4ub8",ro);var Es=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.float32[I+0]=x,this.float32[I+1]=B,p},u}(Ki);Es.prototype.bytesPerElement=8,si("StructArrayLayout2f8",Es);var Bs=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,G,X,Y,rt){var ht=this.length;return this.resize(ht+1),this.emplace(ht,p,x,B,I,D,k,G,X,Y,rt)},u.prototype.emplace=function(p,x,B,I,D,k,G,X,Y,rt,ht){var yt=10*p;return this.uint16[yt+0]=x,this.uint16[yt+1]=B,this.uint16[yt+2]=I,this.uint16[yt+3]=D,this.uint16[yt+4]=k,this.uint16[yt+5]=G,this.uint16[yt+6]=X,this.uint16[yt+7]=Y,this.uint16[yt+8]=rt,this.uint16[yt+9]=ht,p},u}(Ki);Bs.prototype.bytesPerElement=20,si("StructArrayLayout10ui20",Bs);var Xe=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,G,X,Y,rt,ht,yt){var Ft=this.length;return this.resize(Ft+1),this.emplace(Ft,p,x,B,I,D,k,G,X,Y,rt,ht,yt)},u.prototype.emplace=function(p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft){var kt=12*p;return this.int16[kt+0]=x,this.int16[kt+1]=B,this.int16[kt+2]=I,this.int16[kt+3]=D,this.uint16[kt+4]=k,this.uint16[kt+5]=G,this.uint16[kt+6]=X,this.uint16[kt+7]=Y,this.int16[kt+8]=rt,this.int16[kt+9]=ht,this.int16[kt+10]=yt,this.int16[kt+11]=Ft,p},u}(Ki);Xe.prototype.bytesPerElement=24,si("StructArrayLayout4i4ui4i24",Xe);var ei=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=3*p;return this.float32[D+0]=x,this.float32[D+1]=B,this.float32[D+2]=I,p},u}(Ki);ei.prototype.bytesPerElement=12,si("StructArrayLayout3f12",ei);var jc=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint32[1*p+0]=x,p},u}(Ki);jc.prototype.bytesPerElement=4,si("StructArrayLayout1ul4",jc);var Ol=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,G,X,Y){var rt=this.length;return this.resize(rt+1),this.emplace(rt,p,x,B,I,D,k,G,X,Y)},u.prototype.emplace=function(p,x,B,I,D,k,G,X,Y,rt){var ht=10*p,yt=5*p;return this.int16[ht+0]=x,this.int16[ht+1]=B,this.int16[ht+2]=I,this.int16[ht+3]=D,this.int16[ht+4]=k,this.int16[ht+5]=G,this.uint32[yt+3]=X,this.uint16[ht+8]=Y,this.uint16[ht+9]=rt,p},u}(Ki);Ol.prototype.bytesPerElement=20,si("StructArrayLayout6i1ul2ui20",Ol);var na=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k){var G=this.length;return this.resize(G+1),this.emplace(G,p,x,B,I,D,k)},u.prototype.emplace=function(p,x,B,I,D,k,G){var X=6*p;return this.int16[X+0]=x,this.int16[X+1]=B,this.int16[X+2]=I,this.int16[X+3]=D,this.int16[X+4]=k,this.int16[X+5]=G,p},u}(Ki);na.prototype.bytesPerElement=12,si("StructArrayLayout2i2i2i12",na);var Ls=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D){var k=this.length;return this.resize(k+1),this.emplace(k,p,x,B,I,D)},u.prototype.emplace=function(p,x,B,I,D,k){var G=4*p,X=8*p;return this.float32[G+0]=x,this.float32[G+1]=B,this.float32[G+2]=I,this.int16[X+6]=D,this.int16[X+7]=k,p},u}(Ki);Ls.prototype.bytesPerElement=16,si("StructArrayLayout2f1f2i16",Ls);var ra=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var D=this.length;return this.resize(D+1),this.emplace(D,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,D){var k=12*p,G=3*p;return this.uint8[k+0]=x,this.uint8[k+1]=B,this.float32[G+1]=I,this.float32[G+2]=D,p},u}(Ki);ra.prototype.bytesPerElement=12,si("StructArrayLayout2ub2f12",ra);var oa=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=3*p;return this.uint16[D+0]=x,this.uint16[D+1]=B,this.uint16[D+2]=I,p},u}(Ki);oa.prototype.bytesPerElement=6,si("StructArrayLayout3ui6",oa);var vo=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt,Ht,jt,qt){var ae=this.length;return this.resize(ae+1),this.emplace(ae,p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt,Ht,jt,qt)},u.prototype.emplace=function(p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt,Ht,jt,qt,ae){var ge=24*p,ye=12*p,De=48*p;return this.int16[ge+0]=x,this.int16[ge+1]=B,this.uint16[ge+2]=I,this.uint16[ge+3]=D,this.uint32[ye+2]=k,this.uint32[ye+3]=G,this.uint32[ye+4]=X,this.uint16[ge+10]=Y,this.uint16[ge+11]=rt,this.uint16[ge+12]=ht,this.float32[ye+7]=yt,this.float32[ye+8]=Ft,this.uint8[De+36]=kt,this.uint8[De+37]=Ht,this.uint8[De+38]=jt,this.uint32[ye+10]=qt,this.int16[ge+22]=ae,p},u}(Ki);vo.prototype.bytesPerElement=48,si("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vo);var v=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt,Ht,jt,qt,ae,ge,ye,De,We,Ze,_i,ni,Bi,ri,on){var Li=this.length;return this.resize(Li+1),this.emplace(Li,p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt,Ht,jt,qt,ae,ge,ye,De,We,Ze,_i,ni,Bi,ri,on)},u.prototype.emplace=function(p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt,Ht,jt,qt,ae,ge,ye,De,We,Ze,_i,ni,Bi,ri,on,Li){var fi=34*p,fn=17*p;return this.int16[fi+0]=x,this.int16[fi+1]=B,this.int16[fi+2]=I,this.int16[fi+3]=D,this.int16[fi+4]=k,this.int16[fi+5]=G,this.int16[fi+6]=X,this.int16[fi+7]=Y,this.uint16[fi+8]=rt,this.uint16[fi+9]=ht,this.uint16[fi+10]=yt,this.uint16[fi+11]=Ft,this.uint16[fi+12]=kt,this.uint16[fi+13]=Ht,this.uint16[fi+14]=jt,this.uint16[fi+15]=qt,this.uint16[fi+16]=ae,this.uint16[fi+17]=ge,this.uint16[fi+18]=ye,this.uint16[fi+19]=De,this.uint16[fi+20]=We,this.uint16[fi+21]=Ze,this.uint16[fi+22]=_i,this.uint32[fn+12]=ni,this.float32[fn+13]=Bi,this.float32[fn+14]=ri,this.float32[fn+15]=on,this.float32[fn+16]=Li,p},u}(Ki);v.prototype.bytesPerElement=68,si("StructArrayLayout8i15ui1ul4f68",v);var y=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.float32[1*p+0]=x,p},u}(Ki);y.prototype.bytesPerElement=4,si("StructArrayLayout1f4",y);var b=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=3*p;return this.int16[D+0]=x,this.int16[D+1]=B,this.int16[D+2]=I,p},u}(Ki);b.prototype.bytesPerElement=6,si("StructArrayLayout3i6",b);var w=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B){var I=this.length;return this.resize(I+1),this.emplace(I,p,x,B)},u.prototype.emplace=function(p,x,B,I){var D=4*p;return this.uint32[2*p+0]=x,this.uint16[D+2]=B,this.uint16[D+3]=I,p},u}(Ki);w.prototype.bytesPerElement=8,si("StructArrayLayout1ul2ui8",w);var T=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x){var B=this.length;return this.resize(B+1),this.emplace(B,p,x)},u.prototype.emplace=function(p,x,B){var I=2*p;return this.uint16[I+0]=x,this.uint16[I+1]=B,p},u}(Ki);T.prototype.bytesPerElement=4,si("StructArrayLayout2ui4",T);var M=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p){var x=this.length;return this.resize(x+1),this.emplace(x,p)},u.prototype.emplace=function(p,x){return this.uint16[1*p+0]=x,p},u}(Ki);M.prototype.bytesPerElement=2,si("StructArrayLayout1ui2",M);var O=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(p,x,B,I){var D=this.length;return this.resize(D+1),this.emplace(D,p,x,B,I)},u.prototype.emplace=function(p,x,B,I,D){var k=4*p;return this.float32[k+0]=x,this.float32[k+1]=B,this.float32[k+2]=I,this.float32[k+3]=D,p},u}(Ki);O.prototype.bytesPerElement=16,si("StructArrayLayout4f16",O);var l=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return p.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},p.x1.get=function(){return this._structArray.int16[this._pos2+2]},p.y1.get=function(){return this._structArray.int16[this._pos2+3]},p.x2.get=function(){return this._structArray.int16[this._pos2+4]},p.y2.get=function(){return this._structArray.int16[this._pos2+5]},p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.anchorPoint.get=function(){return new _(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,p),u}(An);l.prototype.size=20;var d=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new l(this,p)},u}(Ol);si("CollisionBoxArray",d);var f=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},p.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},p.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},p.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},p.segment.get=function(){return this._structArray.uint16[this._pos2+10]},p.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},p.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},p.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},p.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},p.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},p.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},p.placedOrientation.set=function(x){this._structArray.uint8[this._pos1+37]=x},p.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},p.hidden.set=function(x){this._structArray.uint8[this._pos1+38]=x},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+10]=x},p.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,p),u}(An);f.prototype.size=48;var m=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new f(this,p)},u}(vo);si("PlacedSymbolArray",m);var E=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return p.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},p.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},p.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},p.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},p.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},p.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},p.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},p.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},p.key.get=function(){return this._structArray.uint16[this._pos2+8]},p.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},p.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},p.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},p.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},p.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},p.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},p.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},p.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},p.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},p.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},p.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},p.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},p.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},p.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},p.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},p.crossTileID.set=function(x){this._structArray.uint32[this._pos4+12]=x},p.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},p.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},p.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},p.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,p),u}(An);E.prototype.size=68;var P=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new E(this,p)},u}(v);si("SymbolInstanceArray",P);var R=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getoffsetX=function(p){return this.float32[1*p+0]},u}(y);si("GlyphOffsetArray",R);var F=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.getx=function(p){return this.int16[3*p+0]},u.prototype.gety=function(p){return this.int16[3*p+1]},u.prototype.gettileUnitDistanceFromAnchor=function(p){return this.int16[3*p+2]},u}(b);si("SymbolLineVertexArray",F);var z=function(a){function u(){a.apply(this,arguments)}a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u;var p={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return p.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},p.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},p.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,p),u}(An);z.prototype.size=8;var W=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.get=function(p){return new z(this,p)},u}(w);si("FeatureIndexArray",W);var et=kr([{name:"a_pos",components:2,type:"Int16"}],4).members,Z=function(a){a===void 0&&(a=[]),this.segments=a};function it(a,u){return 256*(a=H(Math.floor(a),0,255))+H(Math.floor(u),0,255)}Z.prototype.prepareSegment=function(a,u,p,x){var B=this.segments[this.segments.length-1];return a>Z.MAX_VERTEX_ARRAY_LENGTH&&ut("Max vertices per segment is "+Z.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!B||B.vertexLength+a>Z.MAX_VERTEX_ARRAY_LENGTH||B.sortKey!==x)&&(B={vertexOffset:u.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},x!==void 0&&(B.sortKey=x),this.segments.push(B)),B},Z.prototype.get=function(){return this.segments},Z.prototype.destroy=function(){for(var a=0,u=this.segments;a<u.length;a+=1){var p=u[a];for(var x in p.vaos)p.vaos[x].destroy()}},Z.simpleSegment=function(a,u,p,x){return new Z([{vertexOffset:a,primitiveOffset:u,vertexLength:p,primitiveLength:x,vaos:{},sortKey:0}])},Z.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,si("SegmentVector",Z);var ot=kr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),bt=c(function(a){a.exports=function(u,p){var x,B,I,D,k,G,X,Y;for(B=u.length-(x=3&u.length),I=p,k=3432918353,G=461845907,Y=0;Y<B;)X=255&u.charCodeAt(Y)|(255&u.charCodeAt(++Y))<<8|(255&u.charCodeAt(++Y))<<16|(255&u.charCodeAt(++Y))<<24,++Y,I=27492+(65535&(D=5*(65535&(I=(I^=X=(65535&(X=(X=(65535&X)*k+(((X>>>16)*k&65535)<<16)&4294967295)<<15|X>>>17))*G+(((X>>>16)*G&65535)<<16)&4294967295)<<13|I>>>19))+((5*(I>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(X=0,x){case 3:X^=(255&u.charCodeAt(Y+2))<<16;case 2:X^=(255&u.charCodeAt(Y+1))<<8;case 1:I^=X=(65535&(X=(X=(65535&(X^=255&u.charCodeAt(Y)))*k+(((X>>>16)*k&65535)<<16)&4294967295)<<15|X>>>17))*G+(((X>>>16)*G&65535)<<16)&4294967295}return I^=u.length,I=2246822507*(65535&(I^=I>>>16))+((2246822507*(I>>>16)&65535)<<16)&4294967295,I=3266489909*(65535&(I^=I>>>13))+((3266489909*(I>>>16)&65535)<<16)&4294967295,(I^=I>>>16)>>>0}}),Pt=c(function(a){a.exports=function(u,p){for(var x,B=u.length,I=p^B,D=0;B>=4;)x=1540483477*(65535&(x=255&u.charCodeAt(D)|(255&u.charCodeAt(++D))<<8|(255&u.charCodeAt(++D))<<16|(255&u.charCodeAt(++D))<<24))+((1540483477*(x>>>16)&65535)<<16),I=1540483477*(65535&I)+((1540483477*(I>>>16)&65535)<<16)^(x=1540483477*(65535&(x^=x>>>24))+((1540483477*(x>>>16)&65535)<<16)),B-=4,++D;switch(B){case 3:I^=(255&u.charCodeAt(D+2))<<16;case 2:I^=(255&u.charCodeAt(D+1))<<8;case 1:I=1540483477*(65535&(I^=255&u.charCodeAt(D)))+((1540483477*(I>>>16)&65535)<<16)}return I=1540483477*(65535&(I^=I>>>13))+((1540483477*(I>>>16)&65535)<<16),(I^=I>>>15)>>>0}}),mt=bt,It=Pt;mt.murmur3=bt,mt.murmur2=It;var Vt=function(){this.ids=[],this.positions=[],this.indexed=!1};Vt.prototype.add=function(a,u,p,x){this.ids.push(te(a)),this.positions.push(u,p,x)},Vt.prototype.getPositions=function(a){for(var u=te(a),p=0,x=this.ids.length-1;p<x;){var B=p+x>>1;this.ids[B]>=u?x=B:p=B+1}for(var I=[];this.ids[p]===u;)I.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return I},Vt.serialize=function(a,u){var p=new Float64Array(a.ids),x=new Uint32Array(a.positions);return function B(I,D,k,G){for(;k<G;){for(var X=I[k+G>>1],Y=k-1,rt=G+1;;){do Y++;while(I[Y]<X);do rt--;while(I[rt]>X);if(Y>=rt)break;Qt(I,Y,rt),Qt(D,3*Y,3*rt),Qt(D,3*Y+1,3*rt+1),Qt(D,3*Y+2,3*rt+2)}rt-k<G-rt?(B(I,D,k,rt),k=rt+1):(B(I,D,rt+1,G),G=rt)}}(p,x,0,p.length-1),u&&u.push(p.buffer,x.buffer),{ids:p,positions:x}},Vt.deserialize=function(a){var u=new Vt;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u};var Jt=Math.pow(2,53)-1;function te(a){var u=+a;return!isNaN(u)&&u<=Jt?u:mt(String(a))}function Qt(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}si("FeaturePositionMap",Vt);var $t=function(a,u){this.gl=a.gl,this.location=u},pe=function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1i(this.location,p))},u}($t),Oe=function(a){function u(p,x){a.call(this,p,x),this.current=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){this.current!==p&&(this.current=p,this.gl.uniform1f(this.location,p))},u}($t),xe=function(a){function u(p,x){a.call(this,p,x),this.current=[0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]||(this.current=p,this.gl.uniform2f(this.location,p[0],p[1]))},u}($t),Ue=function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]||(this.current=p,this.gl.uniform3f(this.location,p[0],p[1],p[2]))},u}($t),oi=function(a){function u(p,x){a.call(this,p,x),this.current=[0,0,0,0]}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p[0]===this.current[0]&&p[1]===this.current[1]&&p[2]===this.current[2]&&p[3]===this.current[3]||(this.current=p,this.gl.uniform4f(this.location,p[0],p[1],p[2],p[3]))},u}($t),Ei=function(a){function u(p,x){a.call(this,p,x),this.current=en.transparent}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){p.r===this.current.r&&p.g===this.current.g&&p.b===this.current.b&&p.a===this.current.a||(this.current=p,this.gl.uniform4f(this.location,p.r,p.g,p.b,p.a))},u}($t),Si=new Float32Array(16),xn=function(a){function u(p,x){a.call(this,p,x),this.current=Si}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.set=function(p){if(p[12]!==this.current[12]||p[0]!==this.current[0])return this.current=p,void this.gl.uniformMatrix4fv(this.location,!1,p);for(var x=1;x<16;x++)if(p[x]!==this.current[x]){this.current=p,this.gl.uniformMatrix4fv(this.location,!1,p);break}},u}($t);function ai(a){return[it(255*a.r,255*a.g),it(255*a.b,255*a.a)]}var Wi=function(a,u,p){this.value=a,this.uniformNames=u.map(function(x){return"u_"+x}),this.type=p};Wi.prototype.setUniform=function(a,u,p){a.set(p.constantOr(this.value))},Wi.prototype.getBinding=function(a,u,p){return this.type==="color"?new Ei(a,u):new Oe(a,u)};var nn=function(a,u){this.uniformNames=u.map(function(p){return"u_"+p}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};nn.prototype.setConstantPatternPositions=function(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr},nn.prototype.setUniform=function(a,u,p,x){var B=x==="u_pattern_to"?this.patternTo:x==="u_pattern_from"?this.patternFrom:x==="u_pixel_ratio_to"?this.pixelRatioTo:x==="u_pixel_ratio_from"?this.pixelRatioFrom:null;B&&a.set(B)},nn.prototype.getBinding=function(a,u,p){return p.substr(0,9)==="u_pattern"?new oi(a,u):new Oe(a,u)};var Hi=function(a,u,p,x){this.expression=a,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(function(B){return{name:"a_"+B,type:"Float32",components:p==="color"?2:1,offset:0}}),this.paintVertexArray=new x};Hi.prototype.populatePaintArray=function(a,u,p,x,B){var I=this.paintVertexArray.length,D=this.expression.evaluate(new Vi(0),u,{},x,[],B);this.paintVertexArray.resize(a),this._setPaintValue(I,a,D)},Hi.prototype.updatePaintArray=function(a,u,p,x){var B=this.expression.evaluate({zoom:0},p,x);this._setPaintValue(a,u,B)},Hi.prototype._setPaintValue=function(a,u,p){if(this.type==="color")for(var x=ai(p),B=a;B<u;B++)this.paintVertexArray.emplace(B,x[0],x[1]);else{for(var I=a;I<u;I++)this.paintVertexArray.emplace(I,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}},Hi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Hi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var zi=function(a,u,p,x,B,I){this.expression=a,this.uniformNames=u.map(function(D){return"u_"+D+"_t"}),this.type=p,this.useIntegerZoom=x,this.zoom=B,this.maxValue=0,this.paintVertexAttributes=u.map(function(D){return{name:"a_"+D,type:"Float32",components:p==="color"?4:2,offset:0}}),this.paintVertexArray=new I};zi.prototype.populatePaintArray=function(a,u,p,x,B){var I=this.expression.evaluate(new Vi(this.zoom),u,{},x,[],B),D=this.expression.evaluate(new Vi(this.zoom+1),u,{},x,[],B),k=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(k,a,I,D)},zi.prototype.updatePaintArray=function(a,u,p,x){var B=this.expression.evaluate({zoom:this.zoom},p,x),I=this.expression.evaluate({zoom:this.zoom+1},p,x);this._setPaintValue(a,u,B,I)},zi.prototype._setPaintValue=function(a,u,p,x){if(this.type==="color")for(var B=ai(p),I=ai(x),D=a;D<u;D++)this.paintVertexArray.emplace(D,B[0],B[1],I[0],I[1]);else{for(var k=a;k<u;k++)this.paintVertexArray.emplace(k,p,x);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(x))}},zi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},zi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},zi.prototype.setUniform=function(a,u){var p=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,x=H(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);a.set(x)},zi.prototype.getBinding=function(a,u,p){return new Oe(a,u)};var Yi=function(a,u,p,x,B,I){this.expression=a,this.type=u,this.useIntegerZoom=p,this.zoom=x,this.layerId=I,this.zoomInPaintVertexArray=new B,this.zoomOutPaintVertexArray=new B};Yi.prototype.populatePaintArray=function(a,u,p){var x=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(x,a,u.patterns&&u.patterns[this.layerId],p)},Yi.prototype.updatePaintArray=function(a,u,p,x,B){this._setPaintValues(a,u,p.patterns&&p.patterns[this.layerId],B)},Yi.prototype._setPaintValues=function(a,u,p,x){if(x&&p){var B=x[p.min],I=x[p.mid],D=x[p.max];if(B&&I&&D)for(var k=a;k<u;k++)this.zoomInPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],B.tl[0],B.tl[1],B.br[0],B.br[1],I.pixelRatio,B.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,I.tl[0],I.tl[1],I.br[0],I.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],I.pixelRatio,D.pixelRatio)}},Yi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,ot.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,ot.members,this.expression.isStateDependent))},Yi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Fi=function(a,u,p){this.binders={},this._buffers=[];var x=[];for(var B in a.paint._values)if(p(B)){var I=a.paint.get(B);if(I instanceof no&&Ys(I.property.specification)){var D=Qr(B,a.type),k=I.value,G=I.property.specification.type,X=I.property.useIntegerZoom,Y=I.property.specification["property-type"],rt=Y==="cross-faded"||Y==="cross-faded-data-driven";if(k.kind==="constant")this.binders[B]=rt?new nn(k.value,D):new Wi(k.value,D,G),x.push("/u_"+B);else if(k.kind==="source"||rt){var ht=Tr(B,G,"source");this.binders[B]=rt?new Yi(k,G,X,u,ht,a.id):new Hi(k,D,G,ht),x.push("/a_"+B)}else{var yt=Tr(B,G,"composite");this.binders[B]=new zi(k,D,G,X,u,yt),x.push("/z_"+B)}}}this.cacheKey=x.sort().join("")};Fi.prototype.getMaxValue=function(a){var u=this.binders[a];return u instanceof Hi||u instanceof zi?u.maxValue:0},Fi.prototype.populatePaintArrays=function(a,u,p,x,B){for(var I in this.binders){var D=this.binders[I];(D instanceof Hi||D instanceof zi||D instanceof Yi)&&D.populatePaintArray(a,u,p,x,B)}},Fi.prototype.setConstantPatternPositions=function(a,u){for(var p in this.binders){var x=this.binders[p];x instanceof nn&&x.setConstantPatternPositions(a,u)}},Fi.prototype.updatePaintArrays=function(a,u,p,x,B){var I=!1;for(var D in a)for(var k=0,G=u.getPositions(D);k<G.length;k+=1){var X=G[k],Y=p.feature(X.index);for(var rt in this.binders){var ht=this.binders[rt];if((ht instanceof Hi||ht instanceof zi||ht instanceof Yi)&&ht.expression.isStateDependent===!0){var yt=x.paint.get(rt);ht.expression=yt.value,ht.updatePaintArray(X.start,X.end,Y,a[D],B),I=!0}}}return I},Fi.prototype.defines=function(){var a=[];for(var u in this.binders){var p=this.binders[u];(p instanceof Wi||p instanceof nn)&&a.push.apply(a,p.uniformNames.map(function(x){return"#define HAS_UNIFORM_"+x}))}return a},Fi.prototype.getBinderAttributes=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof Hi||p instanceof zi)for(var x=0;x<p.paintVertexAttributes.length;x++)a.push(p.paintVertexAttributes[x].name);else if(p instanceof Yi)for(var B=0;B<ot.members.length;B++)a.push(ot.members[B].name)}return a},Fi.prototype.getBinderUniforms=function(){var a=[];for(var u in this.binders){var p=this.binders[u];if(p instanceof Wi||p instanceof nn||p instanceof zi)for(var x=0,B=p.uniformNames;x<B.length;x+=1)a.push(B[x])}return a},Fi.prototype.getPaintVertexBuffers=function(){return this._buffers},Fi.prototype.getUniforms=function(a,u){var p=[];for(var x in this.binders){var B=this.binders[x];if(B instanceof Wi||B instanceof nn||B instanceof zi)for(var I=0,D=B.uniformNames;I<D.length;I+=1){var k=D[I];if(u[k]){var G=B.getBinding(a,u[k],k);p.push({name:k,property:x,binding:G})}}}return p},Fi.prototype.setUniforms=function(a,u,p,x){for(var B=0,I=u;B<I.length;B+=1){var D=I[B],k=D.name,G=D.property;this.binders[G].setUniform(D.binding,x,p.get(G),k)}},Fi.prototype.updatePaintBuffers=function(a){for(var u in this._buffers=[],this.binders){var p=this.binders[u];if(a&&p instanceof Yi){var x=a.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;x&&this._buffers.push(x)}else(p instanceof Hi||p instanceof zi)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}},Fi.prototype.upload=function(a){for(var u in this.binders){var p=this.binders[u];(p instanceof Hi||p instanceof zi||p instanceof Yi)&&p.upload(a)}this.updatePaintBuffers()},Fi.prototype.destroy=function(){for(var a in this.binders){var u=this.binders[a];(u instanceof Hi||u instanceof zi||u instanceof Yi)&&u.destroy()}};var Oi=function(a,u,p){p===void 0&&(p=function(){return!0}),this.programConfigurations={};for(var x=0,B=a;x<B.length;x+=1){var I=B[x];this.programConfigurations[I.id]=new Fi(I,u,p)}this.needsUpload=!1,this._featureMap=new Vt,this._bufferOffset=0};function Qr(a,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(u+"-","").replace(/-/g,"_")]}function Tr(a,u,p){var x={color:{source:Es,composite:O},number:{source:y,composite:Es}},B=function(I){return{"line-pattern":{source:Bs,composite:Bs},"fill-pattern":{source:Bs,composite:Bs},"fill-extrusion-pattern":{source:Bs,composite:Bs}}[I]}(a);return B&&B[p]||x[u][p]}Oi.prototype.populatePaintArrays=function(a,u,p,x,B,I){for(var D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(a,u,x,B,I);u.id!==void 0&&this._featureMap.add(u.id,p,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Oi.prototype.updatePaintArrays=function(a,u,p,x){for(var B=0,I=p;B<I.length;B+=1){var D=I[B];this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(a,this._featureMap,u,D,x)||this.needsUpload}},Oi.prototype.get=function(a){return this.programConfigurations[a]},Oi.prototype.upload=function(a){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}},Oi.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},si("ConstantBinder",Wi),si("CrossFadedConstantBinder",nn),si("SourceExpressionBinder",Hi),si("CrossFadedCompositeBinder",Yi),si("CompositeExpressionBinder",zi),si("ProgramConfiguration",Fi,{omit:["_buffers"]}),si("ProgramConfigurationSet",Oi);var _o=Math.pow(2,14)-1,oo=-_o-1;function br(a){for(var u=8192/a.extent,p=a.loadGeometry(),x=0;x<p.length;x++)for(var B=p[x],I=0;I<B.length;I++){var D=B[I],k=Math.round(D.x*u),G=Math.round(D.y*u);D.x=H(k,oo,_o),D.y=H(G,oo,_o),(k<D.x||k>D.x+1||G<D.y||G>D.y+1)&&ut("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return p}function Pr(a,u){return{type:a.type,id:a.id,properties:a.properties,geometry:u?br(a):[]}}function us(a,u,p,x,B){a.emplaceBack(2*u+(x+1)/2,2*p+(B+1)/2)}var Ro=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Xo,this.indexArray=new oa,this.segments=new Z,this.programConfigurations=new Oi(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Vc(a,u){for(var p=0;p<a.length;p++)if(Ma(u,a[p]))return!0;for(var x=0;x<u.length;x++)if(Ma(a,u[x]))return!0;return!!Ih(a,u)}function Qo(a,u,p){return!!Ma(a,u)||!!Hc(u,a,p)}function sa(a,u){if(a.length===1)return Mh(u,a[0]);for(var p=0;p<u.length;p++)for(var x=u[p],B=0;B<x.length;B++)if(Ma(a,x[B]))return!0;for(var I=0;I<a.length;I++)if(Mh(u,a[I]))return!0;for(var D=0;D<u.length;D++)if(Ih(a,u[D]))return!0;return!1}function Fs(a,u,p){if(a.length>1){if(Ih(a,u))return!0;for(var x=0;x<u.length;x++)if(Hc(u[x],a,p))return!0}for(var B=0;B<a.length;B++)if(Hc(a[B],u,p))return!0;return!1}function Ih(a,u){if(a.length===0||u.length===0)return!1;for(var p=0;p<a.length-1;p++)for(var x=a[p],B=a[p+1],I=0;I<u.length-1;I++)if(Tu(x,B,u[I],u[I+1]))return!0;return!1}function Tu(a,u,p,x){return Et(a,p,x)!==Et(u,p,x)&&Et(a,u,p)!==Et(a,u,x)}function Hc(a,u,p){var x=p*p;if(u.length===1)return a.distSqr(u[0])<x;for(var B=1;B<u.length;B++)if(Su(a,u[B-1],u[B])<x)return!0;return!1}function Su(a,u,p){var x=u.distSqr(p);if(x===0)return a.distSqr(u);var B=((a.x-u.x)*(p.x-u.x)+(a.y-u.y)*(p.y-u.y))/x;return a.distSqr(B<0?u:B>1?p:p.sub(u)._mult(B)._add(u))}function Mh(a,u){for(var p,x,B,I=!1,D=0;D<a.length;D++)for(var k=0,G=(p=a[D]).length-1;k<p.length;G=k++)(x=p[k]).y>u.y!=(B=p[G]).y>u.y&&u.x<(B.x-x.x)*(u.y-x.y)/(B.y-x.y)+x.x&&(I=!I);return I}function Ma(a,u){for(var p=!1,x=0,B=a.length-1;x<a.length;B=x++){var I=a[x],D=a[B];I.y>u.y!=D.y>u.y&&u.x<(D.x-I.x)*(u.y-I.y)/(D.y-I.y)+I.x&&(p=!p)}return p}function Ph(a,u,p){var x=p[0],B=p[2];if(a.x<x.x&&u.x<x.x||a.x>B.x&&u.x>B.x||a.y<x.y&&u.y<x.y||a.y>B.y&&u.y>B.y)return!1;var I=Et(a,u,p[0]);return I!==Et(a,u,p[1])||I!==Et(a,u,p[2])||I!==Et(a,u,p[3])}function Pa(a,u,p){var x=u.paint.get(a).value;return x.kind==="constant"?x.value:p.programConfigurations.get(u.id).getMaxValue(a)}function Kr(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function oc(a,u,p,x,B){if(!u[0]&&!u[1])return a;var I=_.convert(u)._mult(B);p==="viewport"&&I._rotate(-x);for(var D=[],k=0;k<a.length;k++)D.push(a[k].sub(I));return D}Ro.prototype.populate=function(a,u,p){var x=this.layers[0],B=[],I=null;x.type==="circle"&&(I=x.layout.get("circle-sort-key"));for(var D=0,k=a;D<k.length;D+=1){var G=k[D],X=G.feature,Y=G.id,rt=G.index,ht=G.sourceLayerIndex,yt=this.layers[0]._featureFilter.needGeometry,Ft=Pr(X,yt);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),Ft,p)){var kt=I?I.evaluate(Ft,{},p):void 0,Ht={id:Y,properties:X.properties,type:X.type,sourceLayerIndex:ht,index:rt,geometry:yt?Ft.geometry:br(X),patterns:{},sortKey:kt};B.push(Ht)}}I&&B.sort(function(Ze,_i){return Ze.sortKey-_i.sortKey});for(var jt=0,qt=B;jt<qt.length;jt+=1){var ae=qt[jt],ge=ae.geometry,ye=ae.index,De=ae.sourceLayerIndex,We=a[ye].feature;this.addFeature(ae,ge,ye,p),u.featureIndex.insert(We,ge,ye,De,this.index)}},Ro.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},Ro.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ro.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ro.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,et),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},Ro.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ro.prototype.addFeature=function(a,u,p,x){for(var B=0,I=u;B<I.length;B+=1)for(var D=0,k=I[B];D<k.length;D+=1){var G=k[D],X=G.x,Y=G.y;if(!(X<0||X>=8192||Y<0||Y>=8192)){var rt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ht=rt.vertexLength;us(this.layoutVertexArray,X,Y,-1,-1),us(this.layoutVertexArray,X,Y,1,-1),us(this.layoutVertexArray,X,Y,1,1),us(this.layoutVertexArray,X,Y,-1,1),this.indexArray.emplaceBack(ht,ht+1,ht+2),this.indexArray.emplaceBack(ht,ht+3,ht+2),rt.vertexLength+=4,rt.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,{},x)},si("CircleBucket",Ro,{omit:["layers"]});var Wc=new Qn({"circle-sort-key":new ui(st.layout_circle["circle-sort-key"])}),Ll={paint:new Qn({"circle-radius":new ui(st.paint_circle["circle-radius"]),"circle-color":new ui(st.paint_circle["circle-color"]),"circle-blur":new ui(st.paint_circle["circle-blur"]),"circle-opacity":new ui(st.paint_circle["circle-opacity"]),"circle-translate":new xi(st.paint_circle["circle-translate"]),"circle-translate-anchor":new xi(st.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xi(st.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xi(st.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ui(st.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ui(st.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ui(st.paint_circle["circle-stroke-opacity"])}),layout:Wc},Bn=typeof Float32Array<"u"?Float32Array:Array;function Ts(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ko(a,u,p){var x=u[0],B=u[1],I=u[2],D=u[3],k=u[4],G=u[5],X=u[6],Y=u[7],rt=u[8],ht=u[9],yt=u[10],Ft=u[11],kt=u[12],Ht=u[13],jt=u[14],qt=u[15],ae=p[0],ge=p[1],ye=p[2],De=p[3];return a[0]=ae*x+ge*k+ye*rt+De*kt,a[1]=ae*B+ge*G+ye*ht+De*Ht,a[2]=ae*I+ge*X+ye*yt+De*jt,a[3]=ae*D+ge*Y+ye*Ft+De*qt,a[4]=(ae=p[4])*x+(ge=p[5])*k+(ye=p[6])*rt+(De=p[7])*kt,a[5]=ae*B+ge*G+ye*ht+De*Ht,a[6]=ae*I+ge*X+ye*yt+De*jt,a[7]=ae*D+ge*Y+ye*Ft+De*qt,a[8]=(ae=p[8])*x+(ge=p[9])*k+(ye=p[10])*rt+(De=p[11])*kt,a[9]=ae*B+ge*G+ye*ht+De*Ht,a[10]=ae*I+ge*X+ye*yt+De*jt,a[11]=ae*D+ge*Y+ye*Ft+De*qt,a[12]=(ae=p[12])*x+(ge=p[13])*k+(ye=p[14])*rt+(De=p[15])*kt,a[13]=ae*B+ge*G+ye*ht+De*Ht,a[14]=ae*I+ge*X+ye*yt+De*jt,a[15]=ae*D+ge*Y+ye*Ft+De*qt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,u=0,p=arguments.length;p--;)u+=a[p]*a[p];return Math.sqrt(u)});var Fl,l_=Ko;function Vf(a,u,p){var x=u[0],B=u[1],I=u[2],D=u[3];return a[0]=p[0]*x+p[4]*B+p[8]*I+p[12]*D,a[1]=p[1]*x+p[5]*B+p[9]*I+p[13]*D,a[2]=p[2]*x+p[6]*B+p[10]*I+p[14]*D,a[3]=p[3]*x+p[7]*B+p[11]*I+p[15]*D,a}Fl=new Bn(3),Bn!=Float32Array&&(Fl[0]=0,Fl[1]=0,Fl[2]=0),function(){var a=new Bn(4);Bn!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var u_=(function(){var a=new Bn(2);Bn!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function u(p){a.call(this,p,Ll)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new Ro(p)},u.prototype.queryRadius=function(p){var x=p;return Pa("circle-radius",this,x)+Pa("circle-stroke-width",this,x)+Kr(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,G,X){for(var Y=oc(p,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,G),rt=this.paint.get("circle-radius").evaluate(x,B)+this.paint.get("circle-stroke-width").evaluate(x,B),ht=this.paint.get("circle-pitch-alignment")==="map",yt=ht?Y:function(We,Ze){return We.map(function(_i){return Rh(_i,Ze)})}(Y,X),Ft=ht?rt*G:rt,kt=0,Ht=I;kt<Ht.length;kt+=1)for(var jt=0,qt=Ht[kt];jt<qt.length;jt+=1){var ae=qt[jt],ge=ht?ae:Rh(ae,X),ye=Ft,De=Vf([],[ae.x,ae.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ye*=De[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ye*=k.cameraToCenterDistance/De[3]),Qo(yt,ge,ye))return!0}return!1},u}(Ui));function Rh(a,u){var p=Vf([],[a.x,a.y,0,1],u);return new _(p[0]/p[3],p[1]/p[3])}var sm=function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ro);function Iu(a,u,p,x){var B=u.width,I=u.height;if(x){if(x instanceof Uint8ClampedArray)x=new Uint8Array(x.buffer);else if(x.length!==B*I*p)throw new RangeError("mismatched image size")}else x=new Uint8Array(B*I*p);return a.width=B,a.height=I,a.data=x,a}function Hf(a,u,p){var x=u.width,B=u.height;if(x!==a.width||B!==a.height){var I=Iu({},{width:x,height:B},p);h_(a,I,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,x),height:Math.min(a.height,B)},p),a.width=x,a.height=B,a.data=I.data}}function h_(a,u,p,x,B,I){if(B.width===0||B.height===0)return u;if(B.width>a.width||B.height>a.height||p.x>a.width-B.width||p.y>a.height-B.height)throw new RangeError("out of range source coordinates for image copy");if(B.width>u.width||B.height>u.height||x.x>u.width-B.width||x.y>u.height-B.height)throw new RangeError("out of range destination coordinates for image copy");for(var D=a.data,k=u.data,G=0;G<B.height;G++)for(var X=((p.y+G)*a.width+p.x)*I,Y=((x.y+G)*u.width+x.x)*I,rt=0;rt<B.width*I;rt++)k[Y+rt]=D[X+rt];return u}si("HeatmapBucket",sm,{omit:["layers"]});var Dh=function(a,u){Iu(this,a,1,u)};Dh.prototype.resize=function(a){Hf(this,a,1)},Dh.prototype.clone=function(){return new Dh({width:this.width,height:this.height},new Uint8Array(this.data))},Dh.copy=function(a,u,p,x,B){h_(a,u,p,x,B,1)};var hs=function(a,u){Iu(this,a,4,u)};hs.prototype.resize=function(a){Hf(this,a,4)},hs.prototype.replace=function(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},hs.prototype.clone=function(){return new hs({width:this.width,height:this.height},new Uint8Array(this.data))},hs.copy=function(a,u,p,x,B){h_(a,u,p,x,B,4)},si("AlphaImage",Dh),si("RGBAImage",hs);var T9={paint:new Qn({"heatmap-radius":new ui(st.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ui(st.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xi(st.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Xr(st.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xi(st.paint_heatmap["heatmap-opacity"])})};function KE(a){var u={},p=a.resolution||256,x=a.clips?a.clips.length:1,B=a.image||new hs({width:p,height:x}),I=function(Ft,kt,Ht){u[a.evaluationKey]=Ht;var jt=a.expression.evaluate(u);B.data[Ft+kt+0]=Math.floor(255*jt.r/jt.a),B.data[Ft+kt+1]=Math.floor(255*jt.g/jt.a),B.data[Ft+kt+2]=Math.floor(255*jt.b/jt.a),B.data[Ft+kt+3]=Math.floor(255*jt.a)};if(a.clips)for(var D=0,k=0;D<x;++D,k+=4*p)for(var G=0,X=0;G<p;G++,X+=4){var Y=G/(p-1),rt=a.clips[D];I(k,X,rt.start*(1-Y)+rt.end*Y)}else for(var ht=0,yt=0;ht<p;ht++,yt+=4)I(0,yt,ht/(p-1));return B}var S9=function(a){function u(p){a.call(this,p,T9),this._updateColorRamp()}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new sm(p)},u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=KE({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(Ui),I9={paint:new Qn({"hillshade-illumination-direction":new xi(st.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xi(st.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xi(st.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xi(st.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xi(st.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xi(st.paint_hillshade["hillshade-accent-color"])})},M9=function(a){function u(p){a.call(this,p,I9)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(Ui),P9=kr([{name:"a_pos",components:2,type:"Int16"}],4).members,f_=am,R9=am;function am(a,u,p){p=p||2;var x,B,I,D,k,G,X,Y=u&&u.length,rt=Y?u[0]*p:a.length,ht=qE(a,0,rt,p,!0),yt=[];if(!ht||ht.next===ht.prev)return yt;if(Y&&(ht=function(kt,Ht,jt,qt){var ae,ge,ye,De=[];for(ae=0,ge=Ht.length;ae<ge;ae++)(ye=qE(kt,Ht[ae]*qt,ae<ge-1?Ht[ae+1]*qt:kt.length,qt,!1))===ye.next&&(ye.steiner=!0),De.push(z9(ye));for(De.sort(k9),ae=0;ae<De.length;ae++)N9(De[ae],jt),jt=Mu(jt,jt.next);return jt}(a,u,ht,p)),a.length>80*p){x=I=a[0],B=D=a[1];for(var Ft=p;Ft<rt;Ft+=p)(k=a[Ft])<x&&(x=k),(G=a[Ft+1])<B&&(B=G),k>I&&(I=k),G>D&&(D=G);X=(X=Math.max(I-x,D-B))!==0?1/X:0}return fA(ht,yt,p,x,B,X),yt}function qE(a,u,p,x,B){var I,D;if(B===A_(a,u,p,x)>0)for(I=u;I<p;I+=x)D=$E(I,a[I],a[I+1],D);else for(I=p-x;I>=u;I-=x)D=$E(I,a[I],a[I+1],D);return D&&cm(D,D.next)&&(pA(D),D=D.next),D}function Mu(a,u){if(!a)return a;u||(u=a);var p,x=a;do if(p=!1,x.steiner||!cm(x,x.next)&&Gr(x.prev,x,x.next)!==0)x=x.next;else{if(pA(x),(x=u=x.prev)===x.next)break;p=!0}while(p||x!==u);return u}function fA(a,u,p,x,B,I,D){if(a){!D&&I&&function(Y,rt,ht,yt){var Ft=Y;do Ft.z===null&&(Ft.z=d_(Ft.x,Ft.y,rt,ht,yt)),Ft.prevZ=Ft.prev,Ft.nextZ=Ft.next,Ft=Ft.next;while(Ft!==Y);Ft.prevZ.nextZ=null,Ft.prevZ=null,function(kt){var Ht,jt,qt,ae,ge,ye,De,We,Ze=1;do{for(jt=kt,kt=null,ge=null,ye=0;jt;){for(ye++,qt=jt,De=0,Ht=0;Ht<Ze&&(De++,qt=qt.nextZ);Ht++);for(We=Ze;De>0||We>0&&qt;)De!==0&&(We===0||!qt||jt.z<=qt.z)?(ae=jt,jt=jt.nextZ,De--):(ae=qt,qt=qt.nextZ,We--),ge?ge.nextZ=ae:kt=ae,ae.prevZ=ge,ge=ae;jt=qt}ge.nextZ=null,Ze*=2}while(ye>1)}(Ft)}(a,x,B,I);for(var k,G,X=a;a.prev!==a.next;)if(k=a.prev,G=a.next,I?O9(a,x,B,I):D9(a))u.push(k.i/p),u.push(a.i/p),u.push(G.i/p),pA(a),a=G.next,X=G.next;else if((a=G)===X){D?D===1?fA(a=L9(Mu(a),u,p),u,p,x,B,I,2):D===2&&F9(a,u,p,x,B,I):fA(Mu(a),u,p,x,B,I,1);break}}}function D9(a){var u=a.prev,p=a,x=a.next;if(Gr(u,p,x)>=0)return!1;for(var B=a.next.next;B!==a.prev;){if(Wf(u.x,u.y,p.x,p.y,x.x,x.y,B.x,B.y)&&Gr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function O9(a,u,p,x){var B=a.prev,I=a,D=a.next;if(Gr(B,I,D)>=0)return!1;for(var k=B.x>I.x?B.x>D.x?B.x:D.x:I.x>D.x?I.x:D.x,G=B.y>I.y?B.y>D.y?B.y:D.y:I.y>D.y?I.y:D.y,X=d_(B.x<I.x?B.x<D.x?B.x:D.x:I.x<D.x?I.x:D.x,B.y<I.y?B.y<D.y?B.y:D.y:I.y<D.y?I.y:D.y,u,p,x),Y=d_(k,G,u,p,x),rt=a.prevZ,ht=a.nextZ;rt&&rt.z>=X&&ht&&ht.z<=Y;){if(rt!==a.prev&&rt!==a.next&&Wf(B.x,B.y,I.x,I.y,D.x,D.y,rt.x,rt.y)&&Gr(rt.prev,rt,rt.next)>=0||(rt=rt.prevZ,ht!==a.prev&&ht!==a.next&&Wf(B.x,B.y,I.x,I.y,D.x,D.y,ht.x,ht.y)&&Gr(ht.prev,ht,ht.next)>=0))return!1;ht=ht.nextZ}for(;rt&&rt.z>=X;){if(rt!==a.prev&&rt!==a.next&&Wf(B.x,B.y,I.x,I.y,D.x,D.y,rt.x,rt.y)&&Gr(rt.prev,rt,rt.next)>=0)return!1;rt=rt.prevZ}for(;ht&&ht.z<=Y;){if(ht!==a.prev&&ht!==a.next&&Wf(B.x,B.y,I.x,I.y,D.x,D.y,ht.x,ht.y)&&Gr(ht.prev,ht,ht.next)>=0)return!1;ht=ht.nextZ}return!0}function L9(a,u,p){var x=a;do{var B=x.prev,I=x.next.next;!cm(B,I)&&ZE(B,x,x.next,I)&&dA(B,I)&&dA(I,B)&&(u.push(B.i/p),u.push(x.i/p),u.push(I.i/p),pA(x),pA(x.next),x=a=I),x=x.next}while(x!==a);return Mu(x)}function F9(a,u,p,x,B,I){var D=a;do{for(var k=D.next.next;k!==D.prev;){if(D.i!==k.i&&G9(D,k)){var G=YE(D,k);return D=Mu(D,D.next),G=Mu(G,G.next),fA(D,u,p,x,B,I),void fA(G,u,p,x,B,I)}k=k.next}D=D.next}while(D!==a)}function k9(a,u){return a.x-u.x}function N9(a,u){if(u=function(x,B){var I,D=B,k=x.x,G=x.y,X=-1/0;do{if(G<=D.y&&G>=D.next.y&&D.next.y!==D.y){var Y=D.x+(G-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(Y<=k&&Y>X){if(X=Y,Y===k){if(G===D.y)return D;if(G===D.next.y)return D.next}I=D.x<D.next.x?D:D.next}}D=D.next}while(D!==B);if(!I)return null;if(k===X)return I;var rt,ht=I,yt=I.x,Ft=I.y,kt=1/0;D=I;do k>=D.x&&D.x>=yt&&k!==D.x&&Wf(G<Ft?k:X,G,yt,Ft,G<Ft?X:k,G,D.x,D.y)&&(rt=Math.abs(G-D.y)/(k-D.x),dA(D,x)&&(rt<kt||rt===kt&&(D.x>I.x||D.x===I.x&&U9(I,D)))&&(I=D,kt=rt)),D=D.next;while(D!==ht);return I}(a,u)){var p=YE(u,a);Mu(u,u.next),Mu(p,p.next)}}function U9(a,u){return Gr(a.prev,a,u.prev)<0&&Gr(u.next,a,a.next)<0}function d_(a,u,p,x,B){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-p)*B)|a<<8))|a<<4))|a<<2))|a<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-x)*B)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function z9(a){var u=a,p=a;do(u.x<p.x||u.x===p.x&&u.y<p.y)&&(p=u),u=u.next;while(u!==a);return p}function Wf(a,u,p,x,B,I,D,k){return(B-D)*(u-k)-(a-D)*(I-k)>=0&&(a-D)*(x-k)-(p-D)*(u-k)>=0&&(p-D)*(I-k)-(B-D)*(x-k)>=0}function G9(a,u){return a.next.i!==u.i&&a.prev.i!==u.i&&!function(p,x){var B=p;do{if(B.i!==p.i&&B.next.i!==p.i&&B.i!==x.i&&B.next.i!==x.i&&ZE(B,B.next,p,x))return!0;B=B.next}while(B!==p);return!1}(a,u)&&(dA(a,u)&&dA(u,a)&&function(p,x){var B=p,I=!1,D=(p.x+x.x)/2,k=(p.y+x.y)/2;do B.y>k!=B.next.y>k&&B.next.y!==B.y&&D<(B.next.x-B.x)*(k-B.y)/(B.next.y-B.y)+B.x&&(I=!I),B=B.next;while(B!==p);return I}(a,u)&&(Gr(a.prev,a,u.prev)||Gr(a,u.prev,u))||cm(a,u)&&Gr(a.prev,a,a.next)>0&&Gr(u.prev,u,u.next)>0)}function Gr(a,u,p){return(u.y-a.y)*(p.x-u.x)-(u.x-a.x)*(p.y-u.y)}function cm(a,u){return a.x===u.x&&a.y===u.y}function ZE(a,u,p,x){var B=um(Gr(a,u,p)),I=um(Gr(a,u,x)),D=um(Gr(p,x,a)),k=um(Gr(p,x,u));return B!==I&&D!==k||!(B!==0||!lm(a,p,u))||!(I!==0||!lm(a,x,u))||!(D!==0||!lm(p,a,x))||!(k!==0||!lm(p,u,x))}function lm(a,u,p){return u.x<=Math.max(a.x,p.x)&&u.x>=Math.min(a.x,p.x)&&u.y<=Math.max(a.y,p.y)&&u.y>=Math.min(a.y,p.y)}function um(a){return a>0?1:a<0?-1:0}function dA(a,u){return Gr(a.prev,a,a.next)<0?Gr(a,u,a.next)>=0&&Gr(a,a.prev,u)>=0:Gr(a,u,a.prev)<0||Gr(a,a.next,u)<0}function YE(a,u){var p=new p_(a.i,a.x,a.y),x=new p_(u.i,u.x,u.y),B=a.next,I=u.prev;return a.next=u,u.prev=a,p.next=B,B.prev=p,x.next=p,p.prev=x,I.next=x,x.prev=I,x}function $E(a,u,p,x){var B=new p_(a,u,p);return x?(B.next=x.next,B.prev=x,x.next.prev=B,x.next=B):(B.prev=B,B.next=B),B}function pA(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function p_(a,u,p){this.i=a,this.x=u,this.y=p,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A_(a,u,p,x){for(var B=0,I=u,D=p-x;I<p;I+=x)B+=(a[D]-a[I])*(a[I+1]+a[D+1]),D=I;return B}function j9(a,u,p,x,B){(function I(D,k,G,X,Y){for(;X>G;){if(X-G>600){var rt=X-G+1,ht=k-G+1,yt=Math.log(rt),Ft=.5*Math.exp(2*yt/3),kt=.5*Math.sqrt(yt*Ft*(rt-Ft)/rt)*(ht-rt/2<0?-1:1);I(D,k,Math.max(G,Math.floor(k-ht*Ft/rt+kt)),Math.min(X,Math.floor(k+(rt-ht)*Ft/rt+kt)),Y)}var Ht=D[k],jt=G,qt=X;for(AA(D,G,k),Y(D[X],Ht)>0&&AA(D,G,X);jt<qt;){for(AA(D,jt,qt),jt++,qt--;Y(D[jt],Ht)<0;)jt++;for(;Y(D[qt],Ht)>0;)qt--}Y(D[G],Ht)===0?AA(D,G,qt):AA(D,++qt,X),qt<=k&&(G=qt+1),k<=qt&&(X=qt-1)}})(a,u,p,x||a.length-1,B||V9)}function AA(a,u,p){var x=a[u];a[u]=a[p],a[p]=x}function V9(a,u){return a<u?-1:a>u?1:0}function g_(a,u){var p=a.length;if(p<=1)return[a];for(var x,B,I=[],D=0;D<p;D++){var k=le(a[D]);k!==0&&(a[D].area=Math.abs(k),B===void 0&&(B=k<0),B===k<0?(x&&I.push(x),x=[a[D]]):x.push(a[D]))}if(x&&I.push(x),u>1)for(var G=0;G<I.length;G++)I[G].length<=u||(j9(I[G],u,1,I[G].length-1,H9),I[G]=I[G].slice(0,u));return I}function H9(a,u){return u.area-a.area}function m_(a,u,p){for(var x=p.patternDependencies,B=!1,I=0,D=u;I<D.length;I+=1){var k=D[I].paint.get(a+"-pattern");k.isConstant()||(B=!0);var G=k.constantOr(null);G&&(B=!0,x[G.to]=!0,x[G.from]=!0)}return B}function y_(a,u,p,x,B){for(var I=B.patternDependencies,D=0,k=u;D<k.length;D+=1){var G=k[D],X=G.paint.get(a+"-pattern").value;if(X.kind!=="constant"){var Y=X.evaluate({zoom:x-1},p,{},B.availableImages),rt=X.evaluate({zoom:x},p,{},B.availableImages),ht=X.evaluate({zoom:x+1},p,{},B.availableImages);rt=rt&&rt.name?rt.name:rt,ht=ht&&ht.name?ht.name:ht,I[Y=Y&&Y.name?Y.name:Y]=!0,I[rt]=!0,I[ht]=!0,p.patterns[G.id]={min:Y,mid:rt,max:ht}}}return p}am.deviation=function(a,u,p,x){var B=u&&u.length,I=Math.abs(A_(a,0,B?u[0]*p:a.length,p));if(B)for(var D=0,k=u.length;D<k;D++)I-=Math.abs(A_(a,u[D]*p,D<k-1?u[D+1]*p:a.length,p));var G=0;for(D=0;D<x.length;D+=3){var X=x[D]*p,Y=x[D+1]*p,rt=x[D+2]*p;G+=Math.abs((a[X]-a[rt])*(a[Y+1]-a[X+1])-(a[X]-a[Y])*(a[rt+1]-a[X+1]))}return I===0&&G===0?0:Math.abs((G-I)/I)},am.flatten=function(a){for(var u=a[0][0].length,p={vertices:[],holes:[],dimensions:u},x=0,B=0;B<a.length;B++){for(var I=0;I<a[B].length;I++)for(var D=0;D<u;D++)p.vertices.push(a[B][I][D]);B>0&&p.holes.push(x+=a[B-1].length)}return p},f_.default=R9;var sc=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xo,this.indexArray=new oa,this.indexArray2=new T,this.programConfigurations=new Oi(a.layers,a.zoom),this.segments=new Z,this.segments2=new Z,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};sc.prototype.populate=function(a,u,p){this.hasPattern=m_("fill",this.layers,u);for(var x=this.layers[0].layout.get("fill-sort-key"),B=[],I=0,D=a;I<D.length;I+=1){var k=D[I],G=k.feature,X=k.id,Y=k.index,rt=k.sourceLayerIndex,ht=this.layers[0]._featureFilter.needGeometry,yt=Pr(G,ht);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),yt,p)){var Ft=x?x.evaluate(yt,{},p,u.availableImages):void 0,kt={id:X,properties:G.properties,type:G.type,sourceLayerIndex:rt,index:Y,geometry:ht?yt.geometry:br(G),patterns:{},sortKey:Ft};B.push(kt)}}x&&B.sort(function(We,Ze){return We.sortKey-Ze.sortKey});for(var Ht=0,jt=B;Ht<jt.length;Ht+=1){var qt=jt[Ht],ae=qt.geometry,ge=qt.index,ye=qt.sourceLayerIndex;if(this.hasPattern){var De=y_("fill",this.layers,qt,this.zoom,u);this.patternFeatures.push(De)}else this.addFeature(qt,ae,ge,p,{});u.featureIndex.insert(a[ge].feature,ae,ge,ye,this.index)}},sc.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},sc.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.patternFeatures;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},sc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},sc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},sc.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,P9),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},sc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},sc.prototype.addFeature=function(a,u,p,x,B){for(var I=0,D=g_(u,500);I<D.length;I+=1){for(var k=D[I],G=0,X=0,Y=k;X<Y.length;X+=1)G+=Y[X].length;for(var rt=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray),ht=rt.vertexLength,yt=[],Ft=[],kt=0,Ht=k;kt<Ht.length;kt+=1){var jt=Ht[kt];if(jt.length!==0){jt!==k[0]&&Ft.push(yt.length/2);var qt=this.segments2.prepareSegment(jt.length,this.layoutVertexArray,this.indexArray2),ae=qt.vertexLength;this.layoutVertexArray.emplaceBack(jt[0].x,jt[0].y),this.indexArray2.emplaceBack(ae+jt.length-1,ae),yt.push(jt[0].x),yt.push(jt[0].y);for(var ge=1;ge<jt.length;ge++)this.layoutVertexArray.emplaceBack(jt[ge].x,jt[ge].y),this.indexArray2.emplaceBack(ae+ge-1,ae+ge),yt.push(jt[ge].x),yt.push(jt[ge].y);qt.vertexLength+=jt.length,qt.primitiveLength+=jt.length}}for(var ye=f_(yt,Ft),De=0;De<ye.length;De+=3)this.indexArray.emplaceBack(ht+ye[De],ht+ye[De+1],ht+ye[De+2]);rt.vertexLength+=G,rt.primitiveLength+=ye.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},si("FillBucket",sc,{omit:["layers","patternFeatures"]});var W9=new Qn({"fill-sort-key":new ui(st.layout_fill["fill-sort-key"])}),J9={paint:new Qn({"fill-antialias":new xi(st.paint_fill["fill-antialias"]),"fill-opacity":new ui(st.paint_fill["fill-opacity"]),"fill-color":new ui(st.paint_fill["fill-color"]),"fill-outline-color":new ui(st.paint_fill["fill-outline-color"]),"fill-translate":new xi(st.paint_fill["fill-translate"]),"fill-translate-anchor":new xi(st.paint_fill["fill-translate-anchor"]),"fill-pattern":new Eu(st.paint_fill["fill-pattern"])}),layout:W9},X9=function(a){function u(p){a.call(this,p,J9)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x);var B=this.paint._values["fill-outline-color"];B.value.kind==="constant"&&B.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(p){return new sc(p)},u.prototype.queryRadius=function(){return Kr(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,G){return sa(oc(p,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,G),I)},u.prototype.isTileClipped=function(){return!0},u}(Ui),Q9=kr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,t3=Jf;function Jf(a,u,p,x,B){this.properties={},this.extent=p,this.type=0,this._pbf=a,this._geometry=-1,this._keys=x,this._values=B,a.readFields(K9,this,u)}function K9(a,u,p){a==1?u.id=p.readVarint():a==2?function(x,B){for(var I=x.readVarint()+x.pos;x.pos<I;){var D=B._keys[x.readVarint()],k=B._values[x.readVarint()];B.properties[D]=k}}(p,u):a==3?u.type=p.readVarint():a==4&&(u._geometry=p.pos)}function q9(a){for(var u,p,x=0,B=0,I=a.length,D=I-1;B<I;D=B++)x+=((p=a[D]).x-(u=a[B]).x)*(u.y+p.y);return x}Jf.types=["Unknown","Point","LineString","Polygon"],Jf.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var u,p=a.readVarint()+a.pos,x=1,B=0,I=0,D=0,k=[];a.pos<p;){if(B<=0){var G=a.readVarint();x=7&G,B=G>>3}if(B--,x===1||x===2)I+=a.readSVarint(),D+=a.readSVarint(),x===1&&(u&&k.push(u),u=[]),u.push(new _(I,D));else{if(x!==7)throw new Error("unknown command "+x);u&&u.push(u[0].clone())}}return u&&k.push(u),k},Jf.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var u=a.readVarint()+a.pos,p=1,x=0,B=0,I=0,D=1/0,k=-1/0,G=1/0,X=-1/0;a.pos<u;){if(x<=0){var Y=a.readVarint();p=7&Y,x=Y>>3}if(x--,p===1||p===2)(B+=a.readSVarint())<D&&(D=B),B>k&&(k=B),(I+=a.readSVarint())<G&&(G=I),I>X&&(X=I);else if(p!==7)throw new Error("unknown command "+p)}return[D,G,k,X]},Jf.prototype.toGeoJSON=function(a,u,p){var x,B,I=this.extent*Math.pow(2,p),D=this.extent*a,k=this.extent*u,G=this.loadGeometry(),X=Jf.types[this.type];function Y(yt){for(var Ft=0;Ft<yt.length;Ft++){var kt=yt[Ft];yt[Ft]=[360*(kt.x+D)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(kt.y+k)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var rt=[];for(x=0;x<G.length;x++)rt[x]=G[x][0];Y(G=rt);break;case 2:for(x=0;x<G.length;x++)Y(G[x]);break;case 3:for(G=function(yt){var Ft=yt.length;if(Ft<=1)return[yt];for(var kt,Ht,jt=[],qt=0;qt<Ft;qt++){var ae=q9(yt[qt]);ae!==0&&(Ht===void 0&&(Ht=ae<0),Ht===ae<0?(kt&&jt.push(kt),kt=[yt[qt]]):kt.push(yt[qt]))}return kt&&jt.push(kt),jt}(G),x=0;x<G.length;x++)for(B=0;B<G[x].length;B++)Y(G[x][B])}G.length===1?G=G[0]:X="Multi"+X;var ht={type:"Feature",geometry:{type:X,coordinates:G},properties:this.properties};return"id"in this&&(ht.id=this.id),ht};var e3=i3;function i3(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Z9,this,u),this.length=this._features.length}function Z9(a,u,p){a===15?u.version=p.readVarint():a===1?u.name=p.readString():a===5?u.extent=p.readVarint():a===2?u._features.push(p.pos):a===3?u._keys.push(p.readString()):a===4&&u._values.push(function(x){for(var B=null,I=x.readVarint()+x.pos;x.pos<I;){var D=x.readVarint()>>3;B=D===1?x.readString():D===2?x.readFloat():D===3?x.readDouble():D===4?x.readVarint64():D===5?x.readVarint():D===6?x.readSVarint():D===7?x.readBoolean():null}return B}(p))}function Y9(a,u,p){if(a===3){var x=new e3(p,p.readVarint()+p.pos);x.length&&(u[x.name]=x)}}i3.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new t3(this._pbf,u,this.extent,this._keys,this._values)};var Xf={VectorTile:function(a,u){this.layers=a.readFields(Y9,{},u)},VectorTileFeature:t3,VectorTileLayer:e3},$9=Xf.VectorTileFeature.types,v_=Math.pow(2,13);function gA(a,u,p,x,B,I,D,k){a.emplaceBack(u,p,2*Math.floor(x*v_)+D,B*v_*2,I*v_*2,Math.round(k))}var ac=function(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new dr,this.indexArray=new oa,this.programConfigurations=new Oi(a.layers,a.zoom),this.segments=new Z,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function tN(a,u){return a.x===u.x&&(a.x<0||a.x>8192)||a.y===u.y&&(a.y<0||a.y>8192)}ac.prototype.populate=function(a,u,p){this.features=[],this.hasPattern=m_("fill-extrusion",this.layers,u);for(var x=0,B=a;x<B.length;x+=1){var I=B[x],D=I.feature,k=I.id,G=I.index,X=I.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,rt=Pr(D,Y);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),rt,p)){var ht={id:k,sourceLayerIndex:X,index:G,geometry:Y?rt.geometry:br(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(y_("fill-extrusion",this.layers,ht,this.zoom,u)):this.addFeature(ht,ht.geometry,G,p,{}),u.featureIndex.insert(D,ht.geometry,G,X,this.index,!0)}}},ac.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.features;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},ac.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},ac.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ac.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ac.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Q9),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ac.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ac.prototype.addFeature=function(a,u,p,x,B){for(var I=0,D=g_(u,500);I<D.length;I+=1){for(var k=D[I],G=0,X=0,Y=k;X<Y.length;X+=1)G+=Y[X].length;for(var rt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ht=0,yt=k;ht<yt.length;ht+=1){var Ft=yt[ht];if(Ft.length!==0&&!((fn=Ft).every(function(qi){return qi.x<0})||fn.every(function(qi){return qi.x>8192})||fn.every(function(qi){return qi.y<0})||fn.every(function(qi){return qi.y>8192})))for(var kt=0,Ht=0;Ht<Ft.length;Ht++){var jt=Ft[Ht];if(Ht>=1){var qt=Ft[Ht-1];if(!tN(jt,qt)){rt.vertexLength+4>Z.MAX_VERTEX_ARRAY_LENGTH&&(rt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var ae=jt.sub(qt)._perp()._unit(),ge=qt.dist(jt);kt+ge>32768&&(kt=0),gA(this.layoutVertexArray,jt.x,jt.y,ae.x,ae.y,0,0,kt),gA(this.layoutVertexArray,jt.x,jt.y,ae.x,ae.y,0,1,kt),gA(this.layoutVertexArray,qt.x,qt.y,ae.x,ae.y,0,0,kt+=ge),gA(this.layoutVertexArray,qt.x,qt.y,ae.x,ae.y,0,1,kt);var ye=rt.vertexLength;this.indexArray.emplaceBack(ye,ye+2,ye+1),this.indexArray.emplaceBack(ye+1,ye+2,ye+3),rt.vertexLength+=4,rt.primitiveLength+=2}}}}if(rt.vertexLength+G>Z.MAX_VERTEX_ARRAY_LENGTH&&(rt=this.segments.prepareSegment(G,this.layoutVertexArray,this.indexArray)),$9[a.type]==="Polygon"){for(var De=[],We=[],Ze=rt.vertexLength,_i=0,ni=k;_i<ni.length;_i+=1){var Bi=ni[_i];if(Bi.length!==0){Bi!==k[0]&&We.push(De.length/2);for(var ri=0;ri<Bi.length;ri++){var on=Bi[ri];gA(this.layoutVertexArray,on.x,on.y,0,0,1,1,0),De.push(on.x),De.push(on.y)}}}for(var Li=f_(De,We),fi=0;fi<Li.length;fi+=3)this.indexArray.emplaceBack(Ze+Li[fi],Ze+Li[fi+2],Ze+Li[fi+1]);rt.primitiveLength+=Li.length/3,rt.vertexLength+=G}}var fn;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},si("FillExtrusionBucket",ac,{omit:["layers","features"]});var eN={paint:new Qn({"fill-extrusion-opacity":new xi(st["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ui(st["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xi(st["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xi(st["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Eu(st["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ui(st["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ui(st["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new xi(st["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},iN=function(a){function u(p){a.call(this,p,eN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.createBucket=function(p){return new ac(p)},u.prototype.queryRadius=function(){return Kr(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,G,X){var Y=oc(p,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,G),rt=this.paint.get("fill-extrusion-height").evaluate(x,B),ht=this.paint.get("fill-extrusion-base").evaluate(x,B),yt=function(kt,Ht,jt,qt){for(var ae=[],ge=0,ye=kt;ge<ye.length;ge+=1){var De=ye[ge],We=[De.x,De.y,0,1];Vf(We,We,Ht),ae.push(new _(We[0]/We[3],We[1]/We[3]))}return ae}(Y,X),Ft=function(kt,Ht,jt,qt){for(var ae=[],ge=[],ye=qt[8]*Ht,De=qt[9]*Ht,We=qt[10]*Ht,Ze=qt[11]*Ht,_i=qt[8]*jt,ni=qt[9]*jt,Bi=qt[10]*jt,ri=qt[11]*jt,on=0,Li=kt;on<Li.length;on+=1){for(var fi=[],fn=[],qi=0,bn=Li[on];qi<bn.length;qi+=1){var Ti=bn[qi],Cn=Ti.x,rr=Ti.y,Sr=qt[0]*Cn+qt[4]*rr+qt[12],xr=qt[1]*Cn+qt[5]*rr+qt[13],or=qt[2]*Cn+qt[6]*rr+qt[14],Ir=qt[3]*Cn+qt[7]*rr+qt[15],qr=or+We,Zr=Ir+Ze,Oo=Sr+_i,ao=xr+ni,Lo=or+Bi,Rr=Ir+ri,co=new _((Sr+ye)/Zr,(xr+De)/Zr);co.z=qr/Zr,fi.push(co);var gn=new _(Oo/Rr,ao/Rr);gn.z=Lo/Rr,fn.push(gn)}ae.push(fi),ge.push(fn)}return[ae,ge]}(I,ht,rt,X);return function(kt,Ht,jt){var qt=1/0;sa(jt,Ht)&&(qt=n3(jt,Ht[0]));for(var ae=0;ae<Ht.length;ae++)for(var ge=Ht[ae],ye=kt[ae],De=0;De<ge.length-1;De++){var We=ge[De],Ze=[We,ge[De+1],ye[De+1],ye[De],We];Vc(jt,Ze)&&(qt=Math.min(qt,n3(jt,Ze)))}return qt!==1/0&&qt}(Ft[0],Ft[1],yt)},u}(Ui);function mA(a,u){return a.x*u.x+a.y*u.y}function n3(a,u){if(a.length===1){for(var p,x=0,B=u[x++];!p||B.equals(p);)if(!(p=u[x++]))return 1/0;for(;x<u.length;x++){var I=u[x],D=a[0],k=p.sub(B),G=I.sub(B),X=D.sub(B),Y=mA(k,k),rt=mA(k,G),ht=mA(G,G),yt=mA(X,k),Ft=mA(X,G),kt=Y*ht-rt*rt,Ht=(ht*yt-rt*Ft)/kt,jt=(Y*Ft-rt*yt)/kt,qt=B.z*(1-Ht-jt)+p.z*Ht+I.z*jt;if(isFinite(qt))return qt}return 1/0}for(var ae=1/0,ge=0,ye=u;ge<ye.length;ge+=1)ae=Math.min(ae,ye[ge].z);return ae}var nN=kr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,rN=kr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,oN=Xf.VectorTileFeature.types,sN=Math.cos(Math.PI/180*37.5),r3=Math.pow(2,14)/.5,qo=function(a){var u=this;this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(p){u.gradients[p.id]={}}),this.layoutVertexArray=new ro,this.layoutVertexArray2=new Es,this.indexArray=new oa,this.programConfigurations=new Oi(a.layers,a.zoom),this.segments=new Z,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};qo.prototype.populate=function(a,u,p){this.hasPattern=m_("line",this.layers,u);for(var x=this.layers[0].layout.get("line-sort-key"),B=[],I=0,D=a;I<D.length;I+=1){var k=D[I],G=k.feature,X=k.id,Y=k.index,rt=k.sourceLayerIndex,ht=this.layers[0]._featureFilter.needGeometry,yt=Pr(G,ht);if(this.layers[0]._featureFilter.filter(new Vi(this.zoom),yt,p)){var Ft=x?x.evaluate(yt,{},p):void 0,kt={id:X,properties:G.properties,type:G.type,sourceLayerIndex:rt,index:Y,geometry:ht?yt.geometry:br(G),patterns:{},sortKey:Ft};B.push(kt)}}x&&B.sort(function(We,Ze){return We.sortKey-Ze.sortKey});for(var Ht=0,jt=B;Ht<jt.length;Ht+=1){var qt=jt[Ht],ae=qt.geometry,ge=qt.index,ye=qt.sourceLayerIndex;if(this.hasPattern){var De=y_("line",this.layers,qt,this.zoom,u);this.patternFeatures.push(De)}else this.addFeature(qt,ae,ge,p,{});u.featureIndex.insert(a[ge].feature,ae,ge,ye,this.index)}},qo.prototype.update=function(a,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,p)},qo.prototype.addFeatures=function(a,u,p){for(var x=0,B=this.patternFeatures;x<B.length;x+=1){var I=B[x];this.addFeature(I,I.geometry,I.index,u,p)}},qo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},qo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},qo.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,rN)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,nN),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},qo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},qo.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},qo.prototype.addFeature=function(a,u,p,x,B){var I=this.layers[0].layout,D=I.get("line-join").evaluate(a,{}),k=I.get("line-cap"),G=I.get("line-miter-limit"),X=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var Y=0,rt=u;Y<rt.length;Y+=1)this.addLine(rt[Y],a,D,k,G,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,B,x)},qo.prototype.addLine=function(a,u,p,x,B,I){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var D=0;D<a.length-1;D++)this.totalDistance+=a[D].dist(a[D+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var k=oN[u.type]==="Polygon",G=a.length;G>=2&&a[G-1].equals(a[G-2]);)G--;for(var X=0;X<G-1&&a[X].equals(a[X+1]);)X++;if(!(G<(k?3:2))){p==="bevel"&&(B=1.05);var Y,rt=this.overscaling<=16?122880/(512*this.overscaling):0,ht=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray),yt=void 0,Ft=void 0,kt=void 0,Ht=void 0;this.e1=this.e2=-1,k&&(Ht=a[X].sub(Y=a[G-2])._unit()._perp());for(var jt=X;jt<G;jt++)if(!(Ft=jt===G-1?k?a[X+1]:void 0:a[jt+1])||!a[jt].equals(Ft)){Ht&&(kt=Ht),Y&&(yt=Y),Y=a[jt],Ht=Ft?Ft.sub(Y)._unit()._perp():kt;var qt=(kt=kt||Ht).add(Ht);qt.x===0&&qt.y===0||qt._unit();var ae=kt.x*Ht.x+kt.y*Ht.y,ge=qt.x*Ht.x+qt.y*Ht.y,ye=ge!==0?1/ge:1/0,De=2*Math.sqrt(2-2*ge),We=ge<sN&&yt&&Ft,Ze=kt.x*Ht.y-kt.y*Ht.x>0;if(We&&jt>X){var _i=Y.dist(yt);if(_i>2*rt){var ni=Y.sub(Y.sub(yt)._mult(rt/_i)._round());this.updateDistance(yt,ni),this.addCurrentVertex(ni,kt,0,0,ht),yt=ni}}var Bi=yt&&Ft,ri=Bi?p:k?"butt":x;if(Bi&&ri==="round"&&(ye<I?ri="miter":ye<=2&&(ri="fakeround")),ri==="miter"&&ye>B&&(ri="bevel"),ri==="bevel"&&(ye>2&&(ri="flipbevel"),ye<B&&(ri="miter")),yt&&this.updateDistance(yt,Y),ri==="miter")qt._mult(ye),this.addCurrentVertex(Y,qt,0,0,ht);else if(ri==="flipbevel"){if(ye>100)qt=Ht.mult(-1);else{var on=ye*kt.add(Ht).mag()/kt.sub(Ht).mag();qt._perp()._mult(on*(Ze?-1:1))}this.addCurrentVertex(Y,qt,0,0,ht),this.addCurrentVertex(Y,qt.mult(-1),0,0,ht)}else if(ri==="bevel"||ri==="fakeround"){var Li=-Math.sqrt(ye*ye-1),fi=Ze?Li:0,fn=Ze?0:Li;if(yt&&this.addCurrentVertex(Y,kt,fi,fn,ht),ri==="fakeround")for(var qi=Math.round(180*De/Math.PI/20),bn=1;bn<qi;bn++){var Ti=bn/qi;if(Ti!==.5){var Cn=Ti-.5;Ti+=Ti*Cn*(Ti-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*Cn*Cn+(.848013+ae*(.215638*ae-1.06021)))}var rr=Ht.sub(kt)._mult(Ti)._add(kt)._unit()._mult(Ze?-1:1);this.addHalfVertex(Y,rr.x,rr.y,!1,Ze,0,ht)}Ft&&this.addCurrentVertex(Y,Ht,-fi,-fn,ht)}else if(ri==="butt")this.addCurrentVertex(Y,qt,0,0,ht);else if(ri==="square"){var Sr=yt?1:-1;this.addCurrentVertex(Y,qt,Sr,Sr,ht)}else ri==="round"&&(yt&&(this.addCurrentVertex(Y,kt,0,0,ht),this.addCurrentVertex(Y,kt,1,1,ht,!0)),Ft&&(this.addCurrentVertex(Y,Ht,-1,-1,ht,!0),this.addCurrentVertex(Y,Ht,0,0,ht)));if(We&&jt<G-1){var xr=Y.dist(Ft);if(xr>2*rt){var or=Y.add(Ft.sub(Y)._mult(rt/xr)._round());this.updateDistance(Y,or),this.addCurrentVertex(or,Ht,0,0,ht),Y=or}}}}},qo.prototype.addCurrentVertex=function(a,u,p,x,B,I){I===void 0&&(I=!1);var D=u.y*x-u.x,k=-u.y-u.x*x;this.addHalfVertex(a,u.x+u.y*p,u.y-u.x*p,I,!1,p,B),this.addHalfVertex(a,D,k,I,!0,-x,B),this.distance>r3/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,u,p,x,B,I))},qo.prototype.addHalfVertex=function(a,u,p,x,B,I,D){var k=.5*(this.lineClips?this.scaledDistance*(r3-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(x?1:0),(a.y<<1)+(B?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var G=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,G),D.primitiveLength++),B?this.e2=G:this.e1=G},qo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},qo.prototype.updateDistance=function(a,u){this.distance+=a.dist(u),this.updateScaledDistance()},si("LineBucket",qo,{omit:["layers","patternFeatures"]});var aN=new Qn({"line-cap":new xi(st.layout_line["line-cap"]),"line-join":new ui(st.layout_line["line-join"]),"line-miter-limit":new xi(st.layout_line["line-miter-limit"]),"line-round-limit":new xi(st.layout_line["line-round-limit"]),"line-sort-key":new ui(st.layout_line["line-sort-key"])}),o3={paint:new Qn({"line-opacity":new ui(st.paint_line["line-opacity"]),"line-color":new ui(st.paint_line["line-color"]),"line-translate":new xi(st.paint_line["line-translate"]),"line-translate-anchor":new xi(st.paint_line["line-translate-anchor"]),"line-width":new ui(st.paint_line["line-width"]),"line-gap-width":new ui(st.paint_line["line-gap-width"]),"line-offset":new ui(st.paint_line["line-offset"]),"line-blur":new ui(st.paint_line["line-blur"]),"line-dasharray":new uo(st.paint_line["line-dasharray"]),"line-pattern":new Eu(st.paint_line["line-pattern"]),"line-gradient":new Xr(st.paint_line["line-gradient"])}),layout:aN},s3=new(function(a){function u(){a.apply(this,arguments)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(p,x){return x=new Vi(Math.floor(x.zoom),{now:x.now,fadeDuration:x.fadeDuration,zoomHistory:x.zoomHistory,transition:x.transition}),a.prototype.possiblyEvaluate.call(this,p,x)},u.prototype.evaluate=function(p,x,B,I){return x=tt({},x,{zoom:Math.floor(x.zoom)}),a.prototype.evaluate.call(this,p,x,B,I)},u}(ui))(o3.paint.properties["line-width"].specification);s3.useIntegerZoom=!0;var cN=function(a){function u(p){a.call(this,p,o3),this.gradientVersion=0}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(p){p==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Gn,this.gradientVersion=(this.gradientVersion+1)%L)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(p,x){a.prototype.recalculate.call(this,p,x),this.paint._values["line-floorwidth"]=s3.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,p)},u.prototype.createBucket=function(p){return new qo(p)},u.prototype.queryRadius=function(p){var x=p,B=a3(Pa("line-width",this,x),Pa("line-gap-width",this,x)),I=Pa("line-offset",this,x);return B/2+Math.abs(I)+Kr(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(p,x,B,I,D,k,G){var X=oc(p,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,G),Y=G/2*a3(this.paint.get("line-width").evaluate(x,B),this.paint.get("line-gap-width").evaluate(x,B)),rt=this.paint.get("line-offset").evaluate(x,B);return rt&&(I=function(ht,yt){for(var Ft=[],kt=new _(0,0),Ht=0;Ht<ht.length;Ht++){for(var jt=ht[Ht],qt=[],ae=0;ae<jt.length;ae++){var ge=jt[ae],ye=jt[ae+1],De=ae===0?kt:ge.sub(jt[ae-1])._unit()._perp(),We=ae===jt.length-1?kt:ye.sub(ge)._unit()._perp(),Ze=De._add(We)._unit();Ze._mult(1/(Ze.x*We.x+Ze.y*We.y)),qt.push(Ze._mult(yt)._add(ge))}Ft.push(qt)}return Ft}(I,rt*G)),function(ht,yt,Ft){for(var kt=0;kt<yt.length;kt++){var Ht=yt[kt];if(ht.length>=3){for(var jt=0;jt<Ht.length;jt++)if(Ma(ht,Ht[jt]))return!0}if(Fs(ht,Ht,Ft))return!0}return!1}(X,I,Y)},u.prototype.isTileClipped=function(){return!0},u}(Ui);function a3(a,u){return u>0?u+2*a:a}var lN=kr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),uN=kr([{name:"a_projected_pos",components:3,type:"Float32"}],4),hN=(kr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),kr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),c3=(kr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),kr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),fN=kr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function dN(a,u,p){return a.sections.forEach(function(x){x.text=function(B,I,D){var k=I.layout.get("text-transform").evaluate(D,{});return k==="uppercase"?B=B.toLocaleUpperCase():k==="lowercase"&&(B=B.toLocaleLowerCase()),io.applyArabicShaping&&(B=io.applyArabicShaping(B)),B}(x.text,u,p)}),a}kr([{name:"triangle",components:3,type:"Uint16"}]),kr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),kr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),kr([{type:"Float32",name:"offsetX"}]),kr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var yA={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},l3=function(a,u,p,x,B){var I,D,k=8*B-x-1,G=(1<<k)-1,X=G>>1,Y=-7,rt=B-1,ht=-1,yt=a[u+rt];for(rt+=ht,I=yt&(1<<-Y)-1,yt>>=-Y,Y+=k;Y>0;I=256*I+a[u+rt],rt+=ht,Y-=8);for(D=I&(1<<-Y)-1,I>>=-Y,Y+=x;Y>0;D=256*D+a[u+rt],rt+=ht,Y-=8);if(I===0)I=1-X;else{if(I===G)return D?NaN:1/0*(yt?-1:1);D+=Math.pow(2,x),I-=X}return(yt?-1:1)*D*Math.pow(2,I-x)},u3=function(a,u,p,x,B,I){var D,k,G,X=8*I-B-1,Y=(1<<X)-1,rt=Y>>1,ht=B===23?Math.pow(2,-24)-Math.pow(2,-77):0,yt=0,Ft=1,kt=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(k=isNaN(u)?1:0,D=Y):(D=Math.floor(Math.log(u)/Math.LN2),u*(G=Math.pow(2,-D))<1&&(D--,G*=2),(u+=D+rt>=1?ht/G:ht*Math.pow(2,1-rt))*G>=2&&(D++,G/=2),D+rt>=Y?(k=0,D=Y):D+rt>=1?(k=(u*G-1)*Math.pow(2,B),D+=rt):(k=u*Math.pow(2,rt-1)*Math.pow(2,B),D=0));B>=8;a[p+yt]=255&k,yt+=Ft,k/=256,B-=8);for(D=D<<B|k,X+=B;X>0;a[p+yt]=255&D,yt+=Ft,D/=256,X-=8);a[p+yt-Ft]|=128*kt},hm=Kn;function Kn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}Kn.Varint=0,Kn.Fixed64=1,Kn.Bytes=2,Kn.Fixed32=5;var h3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function kl(a){return a.type===Kn.Bytes?a.readVarint()+a.pos:a.pos+1}function pN(a,u,p){return p?4294967296*u+(a>>>0):4294967296*(u>>>0)+(a>>>0)}function f3(a,u,p){var x=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));p.realloc(x);for(var B=p.pos-1;B>=a;B--)p.buf[B+x]=p.buf[B]}function AN(a,u){for(var p=0;p<a.length;p++)u.writeVarint(a[p])}function gN(a,u){for(var p=0;p<a.length;p++)u.writeSVarint(a[p])}function mN(a,u){for(var p=0;p<a.length;p++)u.writeFloat(a[p])}function yN(a,u){for(var p=0;p<a.length;p++)u.writeDouble(a[p])}function vN(a,u){for(var p=0;p<a.length;p++)u.writeBoolean(a[p])}function _N(a,u){for(var p=0;p<a.length;p++)u.writeFixed32(a[p])}function bN(a,u){for(var p=0;p<a.length;p++)u.writeSFixed32(a[p])}function xN(a,u){for(var p=0;p<a.length;p++)u.writeFixed64(a[p])}function wN(a,u){for(var p=0;p<a.length;p++)u.writeSFixed64(a[p])}function fm(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+16777216*a[u+3]}function Qf(a,u,p){a[p]=u,a[p+1]=u>>>8,a[p+2]=u>>>16,a[p+3]=u>>>24}function d3(a,u){return(a[u]|a[u+1]<<8|a[u+2]<<16)+(a[u+3]<<24)}function CN(a,u,p){a===1&&p.readMessage(EN,u)}function EN(a,u,p){if(a===3){var x=p.readMessage(BN,{}),B=x.width,I=x.height,D=x.left,k=x.top,G=x.advance;u.push({id:x.id,bitmap:new Dh({width:B+6,height:I+6},x.bitmap),metrics:{width:B,height:I,left:D,top:k,advance:G}})}}function BN(a,u,p){a===1?u.id=p.readVarint():a===2?u.bitmap=p.readBytes():a===3?u.width=p.readVarint():a===4?u.height=p.readVarint():a===5?u.left=p.readSVarint():a===6?u.top=p.readSVarint():a===7&&(u.advance=p.readVarint())}function p3(a){for(var u=0,p=0,x=0,B=a;x<B.length;x+=1){var I=B[x];u+=I.w*I.h,p=Math.max(p,I.w)}a.sort(function(kt,Ht){return Ht.h-kt.h});for(var D=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),p),h:1/0}],k=0,G=0,X=0,Y=a;X<Y.length;X+=1)for(var rt=Y[X],ht=D.length-1;ht>=0;ht--){var yt=D[ht];if(!(rt.w>yt.w||rt.h>yt.h)){if(rt.x=yt.x,rt.y=yt.y,G=Math.max(G,rt.y+rt.h),k=Math.max(k,rt.x+rt.w),rt.w===yt.w&&rt.h===yt.h){var Ft=D.pop();ht<D.length&&(D[ht]=Ft)}else rt.h===yt.h?(yt.x+=rt.w,yt.w-=rt.w):rt.w===yt.w?(yt.y+=rt.h,yt.h-=rt.h):(D.push({x:yt.x+rt.w,y:yt.y,w:yt.w-rt.w,h:rt.h}),yt.y+=rt.h,yt.h-=rt.h);break}}return{w:k,h:G,fill:u/(k*G)||0}}Kn.prototype={destroy:function(){this.buf=null},readFields:function(a,u,p){for(p=p||this.length;this.pos<p;){var x=this.readVarint(),B=x>>3,I=this.pos;this.type=7&x,a(B,u,this),this.pos===I&&this.skip(x)}return u},readMessage:function(a,u){return this.readFields(a,u,this.readVarint()+this.pos)},readFixed32:function(){var a=fm(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=d3(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=fm(this.buf,this.pos)+4294967296*fm(this.buf,this.pos+4);return this.pos+=8,a},readSFixed64:function(){var a=fm(this.buf,this.pos)+4294967296*d3(this.buf,this.pos+4);return this.pos+=8,a},readFloat:function(){var a=l3(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=l3(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var u,p,x=this.buf;return u=127&(p=x[this.pos++]),p<128?u:(u|=(127&(p=x[this.pos++]))<<7,p<128?u:(u|=(127&(p=x[this.pos++]))<<14,p<128?u:(u|=(127&(p=x[this.pos++]))<<21,p<128?u:function(B,I,D){var k,G,X=D.buf;if(k=(112&(G=X[D.pos++]))>>4,G<128||(k|=(127&(G=X[D.pos++]))<<3,G<128)||(k|=(127&(G=X[D.pos++]))<<10,G<128)||(k|=(127&(G=X[D.pos++]))<<17,G<128)||(k|=(127&(G=X[D.pos++]))<<24,G<128)||(k|=(1&(G=X[D.pos++]))<<31,G<128))return pN(B,k,I);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(p=x[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,u=this.pos;return this.pos=a,a-u>=12&&h3?function(p,x,B){return h3.decode(p.subarray(x,B))}(this.buf,u,a):function(p,x,B){for(var I="",D=x;D<B;){var k,G,X,Y=p[D],rt=null,ht=Y>239?4:Y>223?3:Y>191?2:1;if(D+ht>B)break;ht===1?Y<128&&(rt=Y):ht===2?(192&(k=p[D+1]))==128&&(rt=(31&Y)<<6|63&k)<=127&&(rt=null):ht===3?(G=p[D+2],(192&(k=p[D+1]))==128&&(192&G)==128&&((rt=(15&Y)<<12|(63&k)<<6|63&G)<=2047||rt>=55296&&rt<=57343)&&(rt=null)):ht===4&&(G=p[D+2],X=p[D+3],(192&(k=p[D+1]))==128&&(192&G)==128&&(192&X)==128&&((rt=(15&Y)<<18|(63&k)<<12|(63&G)<<6|63&X)<=65535||rt>=1114112)&&(rt=null)),rt===null?(rt=65533,ht=1):rt>65535&&(rt-=65536,I+=String.fromCharCode(rt>>>10&1023|55296),rt=56320|1023&rt),I+=String.fromCharCode(rt),D+=ht}return I}(this.buf,u,a)},readBytes:function(){var a=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,a);return this.pos=a,u},readPackedVarint:function(a,u){if(this.type!==Kn.Bytes)return a.push(this.readVarint(u));var p=kl(this);for(a=a||[];this.pos<p;)a.push(this.readVarint(u));return a},readPackedSVarint:function(a){if(this.type!==Kn.Bytes)return a.push(this.readSVarint());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==Kn.Bytes)return a.push(this.readBoolean());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==Kn.Bytes)return a.push(this.readFloat());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==Kn.Bytes)return a.push(this.readDouble());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==Kn.Bytes)return a.push(this.readFixed32());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==Kn.Bytes)return a.push(this.readSFixed32());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==Kn.Bytes)return a.push(this.readFixed64());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==Kn.Bytes)return a.push(this.readSFixed64());var u=kl(this);for(a=a||[];this.pos<u;)a.push(this.readSFixed64());return a},skip:function(a){var u=7&a;if(u===Kn.Varint)for(;this.buf[this.pos++]>127;);else if(u===Kn.Bytes)this.pos=this.readVarint()+this.pos;else if(u===Kn.Fixed32)this.pos+=4;else{if(u!==Kn.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(a,u){this.writeVarint(a<<3|u)},realloc:function(a){for(var u=this.length||16;u<this.pos+a;)u*=2;if(u!==this.length){var p=new Uint8Array(u);p.set(this.buf),this.buf=p,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Qf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Qf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Qf(this.buf,-1&a,this.pos),Qf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Qf(this.buf,-1&a,this.pos),Qf(this.buf,Math.floor(a*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(u,p){var x,B;if(u>=0?(x=u%4294967296|0,B=u/4294967296|0):(B=~(-u/4294967296),4294967295^(x=~(-u%4294967296))?x=x+1|0:(x=0,B=B+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),function(I,D,k){k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,I>>>=7,k.buf[k.pos++]=127&I|128,k.buf[k.pos]=127&(I>>>=7)}(x,0,p),function(I,D){var k=(7&I)<<4;D.buf[D.pos++]|=k|((I>>>=3)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I|((I>>>=7)?128:0),I&&(D.buf[D.pos++]=127&I)))))}(B,p)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var u=this.pos;this.pos=function(x,B,I){for(var D,k,G=0;G<B.length;G++){if((D=B.charCodeAt(G))>55295&&D<57344){if(!k){D>56319||G+1===B.length?(x[I++]=239,x[I++]=191,x[I++]=189):k=D;continue}if(D<56320){x[I++]=239,x[I++]=191,x[I++]=189,k=D;continue}D=k-55296<<10|D-56320|65536,k=null}else k&&(x[I++]=239,x[I++]=191,x[I++]=189,k=null);D<128?x[I++]=D:(D<2048?x[I++]=D>>6|192:(D<65536?x[I++]=D>>12|224:(x[I++]=D>>18|240,x[I++]=D>>12&63|128),x[I++]=D>>6&63|128),x[I++]=63&D|128)}return I}(this.buf,a,this.pos);var p=this.pos-u;p>=128&&f3(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeFloat:function(a){this.realloc(4),u3(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),u3(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var u=a.length;this.writeVarint(u),this.realloc(u);for(var p=0;p<u;p++)this.buf[this.pos++]=a[p]},writeRawMessage:function(a,u){this.pos++;var p=this.pos;a(u,this);var x=this.pos-p;x>=128&&f3(p,x,this),this.pos=p-1,this.writeVarint(x),this.pos+=x},writeMessage:function(a,u,p){this.writeTag(a,Kn.Bytes),this.writeRawMessage(u,p)},writePackedVarint:function(a,u){u.length&&this.writeMessage(a,AN,u)},writePackedSVarint:function(a,u){u.length&&this.writeMessage(a,gN,u)},writePackedBoolean:function(a,u){u.length&&this.writeMessage(a,vN,u)},writePackedFloat:function(a,u){u.length&&this.writeMessage(a,mN,u)},writePackedDouble:function(a,u){u.length&&this.writeMessage(a,yN,u)},writePackedFixed32:function(a,u){u.length&&this.writeMessage(a,_N,u)},writePackedSFixed32:function(a,u){u.length&&this.writeMessage(a,bN,u)},writePackedFixed64:function(a,u){u.length&&this.writeMessage(a,xN,u)},writePackedSFixed64:function(a,u){u.length&&this.writeMessage(a,wN,u)},writeBytesField:function(a,u){this.writeTag(a,Kn.Bytes),this.writeBytes(u)},writeFixed32Field:function(a,u){this.writeTag(a,Kn.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(a,u){this.writeTag(a,Kn.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(a,u){this.writeTag(a,Kn.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(a,u){this.writeTag(a,Kn.Fixed64),this.writeSFixed64(u)},writeVarintField:function(a,u){this.writeTag(a,Kn.Varint),this.writeVarint(u)},writeSVarintField:function(a,u){this.writeTag(a,Kn.Varint),this.writeSVarint(u)},writeStringField:function(a,u){this.writeTag(a,Kn.Bytes),this.writeString(u)},writeFloatField:function(a,u){this.writeTag(a,Kn.Fixed32),this.writeFloat(u)},writeDoubleField:function(a,u){this.writeTag(a,Kn.Fixed64),this.writeDouble(u)},writeBooleanField:function(a,u){this.writeVarintField(a,!!u)}};var dm=function(a,u){var p=u.pixelRatio,x=u.version,B=u.stretchX,I=u.stretchY,D=u.content;this.paddedRect=a,this.pixelRatio=p,this.stretchX=B,this.stretchY=I,this.content=D,this.version=x},vA={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};vA.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},vA.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},vA.tlbr.get=function(){return this.tl.concat(this.br)},vA.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(dm.prototype,vA);var _A=function(a,u){var p={},x={};this.haveRenderCallbacks=[];var B=[];this.addImages(a,p,B),this.addImages(u,x,B);var I=p3(B),D=new hs({width:I.w||1,height:I.h||1});for(var k in a){var G=a[k],X=p[k].paddedRect;hs.copy(G.data,D,{x:0,y:0},{x:X.x+1,y:X.y+1},G.data)}for(var Y in u){var rt=u[Y],ht=x[Y].paddedRect,yt=ht.x+1,Ft=ht.y+1,kt=rt.data.width,Ht=rt.data.height;hs.copy(rt.data,D,{x:0,y:0},{x:yt,y:Ft},rt.data),hs.copy(rt.data,D,{x:0,y:Ht-1},{x:yt,y:Ft-1},{width:kt,height:1}),hs.copy(rt.data,D,{x:0,y:0},{x:yt,y:Ft+Ht},{width:kt,height:1}),hs.copy(rt.data,D,{x:kt-1,y:0},{x:yt-1,y:Ft},{width:1,height:Ht}),hs.copy(rt.data,D,{x:0,y:0},{x:yt+kt,y:Ft},{width:1,height:Ht})}this.image=D,this.iconPositions=p,this.patternPositions=x};_A.prototype.addImages=function(a,u,p){for(var x in a){var B=a[x],I={x:0,y:0,w:B.data.width+2,h:B.data.height+2};p.push(I),u[x]=new dm(I,B),B.hasRenderCallback&&this.haveRenderCallbacks.push(x)}},_A.prototype.patchUpdatedImages=function(a,u){for(var p in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[p],a.getImage(p),u),this.patchUpdatedImage(this.patternPositions[p],a.getImage(p),u)},_A.prototype.patchUpdatedImage=function(a,u,p){if(a&&u&&a.version!==u.version){a.version=u.version;var x=a.tl;p.update(u.data,void 0,{x:x[0],y:x[1]})}},si("ImagePosition",dm),si("ImageAtlas",_A);var ks={horizontal:1,vertical:2,horizontalOnly:3},Kf=function(){this.scale=1,this.fontStack="",this.imageName=null};Kf.forText=function(a,u){var p=new Kf;return p.scale=a||1,p.fontStack=u,p},Kf.forImage=function(a){var u=new Kf;return u.imageName=a,u};var Do=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function pm(a,u,p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt){var Ht,jt=Do.fromFeature(a,B);rt===ks.vertical&&jt.verticalizePunctuation();var qt=io.processBidirectionalText,ae=io.processStyledBidirectionalText;if(qt&&jt.sections.length===1){Ht=[];for(var ge=0,ye=qt(jt.toString(),__(jt,X,I,u,x,yt,Ft));ge<ye.length;ge+=1){var De=ye[ge],We=new Do;We.text=De,We.sections=jt.sections;for(var Ze=0;Ze<De.length;Ze++)We.sectionIndex.push(0);Ht.push(We)}}else if(ae){Ht=[];for(var _i=0,ni=ae(jt.text,jt.sectionIndex,__(jt,X,I,u,x,yt,Ft));_i<ni.length;_i+=1){var Bi=ni[_i],ri=new Do;ri.text=Bi[0],ri.sectionIndex=Bi[1],ri.sections=jt.sections,Ht.push(ri)}}else Ht=function(fi,fn){for(var qi=[],bn=fi.text,Ti=0,Cn=0,rr=fn;Cn<rr.length;Cn+=1){var Sr=rr[Cn];qi.push(fi.substring(Ti,Sr)),Ti=Sr}return Ti<bn.length&&qi.push(fi.substring(Ti,bn.length)),qi}(jt,__(jt,X,I,u,x,yt,Ft));var on=[],Li={positionedLines:on,text:jt.toString(),top:Y[1],bottom:Y[1],left:Y[0],right:Y[0],writingMode:rt,iconsInText:!1,verticalizable:!1};return function(fi,fn,qi,bn,Ti,Cn,rr,Sr,xr,or,Ir,qr){for(var Zr=0,Oo=-17,ao=0,Lo=0,Rr=Sr==="right"?1:Sr==="left"?0:.5,co=0,gn=0,Un=Ti;gn<Un.length;gn+=1){var Mn=Un[gn];Mn.trim();var wn=Mn.getMaxScale(),Zo=24*(wn-1),bo={positionedGlyphs:[],lineOffset:0};fi.positionedLines[co]=bo;var tr=bo.positionedGlyphs,Nr=0;if(Mn.length()){for(var xo=0;xo<Mn.length();xo++){var En=Mn.getSection(xo),Jc=Mn.getSectionIndex(xo),Ns=Mn.getCharCode(xo),Xc=0,Dr=null,Qc=null,Ra=null,nd=24,kh=!(xr===ks.horizontal||!Ir&&!xu(Ns)||Ir&&(Am[Ns]||(Gl=Ns,Ye.Arabic(Gl)||Ye["Arabic Supplement"](Gl)||Ye["Arabic Extended-A"](Gl)||Ye["Arabic Presentation Forms-A"](Gl)||Ye["Arabic Presentation Forms-B"](Gl))));if(En.imageName){var rd=bn[En.imageName];if(!rd)continue;Ra=En.imageName,fi.iconsInText=fi.iconsInText||!0,Qc=rd.paddedRect;var zl=rd.displaySize;En.scale=24*En.scale/qr,Xc=Zo+(24-zl[1]*En.scale),nd=(Dr={width:zl[0],height:zl[1],left:1,top:-3,advance:kh?zl[1]:zl[0]}).advance;var od=kh?zl[0]*En.scale-24*wn:zl[1]*En.scale-24*wn;od>0&&od>Nr&&(Nr=od)}else{var Cm=qi[En.fontStack],sd=Cm&&Cm[Ns];if(sd&&sd.rect)Qc=sd.rect,Dr=sd.metrics;else{var wA=fn[En.fontStack],Em=wA&&wA[Ns];if(!Em)continue;Dr=Em.metrics}Xc=24*(wn-En.scale)}kh?(fi.verticalizable=!0,tr.push({glyph:Ns,imageName:Ra,x:Zr,y:Oo+Xc,vertical:kh,scale:En.scale,fontStack:En.fontStack,sectionIndex:Jc,metrics:Dr,rect:Qc}),Zr+=nd*En.scale+or):(tr.push({glyph:Ns,imageName:Ra,x:Zr,y:Oo+Xc,vertical:kh,scale:En.scale,fontStack:En.fontStack,sectionIndex:Jc,metrics:Dr,rect:Qc}),Zr+=Dr.advance*En.scale+or)}tr.length!==0&&(ao=Math.max(Zr-or,ao),SN(tr,0,tr.length-1,Rr,Nr)),Zr=0;var Bm=Cn*wn+Nr;bo.lineOffset=Math.max(Nr,Zo),Oo+=Bm,Lo=Math.max(Bm,Lo),++co}else Oo+=Cn,++co}var Gl,CA=Oo- -17,ad=b_(rr),Ru=ad.horizontalAlign,cd=ad.verticalAlign;(function(Tm,Sm,EA,BA,Im,TA,SA,IA,Mm){var ld,Pm=(Sm-EA)*Im;ld=TA!==SA?-IA*BA- -17:(-BA*Mm+.5)*SA;for(var ud=0,MA=Tm;ud<MA.length;ud+=1)for(var Nh=0,PA=MA[ud].positionedGlyphs;Nh<PA.length;Nh+=1){var hd=PA[Nh];hd.x+=Pm,hd.y+=ld}})(fi.positionedLines,Rr,Ru,cd,ao,Lo,Cn,CA,Ti.length),fi.top+=-cd*CA,fi.bottom=fi.top+CA,fi.left+=-Ru*ao,fi.right=fi.left+ao}(Li,u,p,x,Ht,D,k,G,rt,X,ht,kt),!function(fi){for(var fn=0,qi=fi;fn<qi.length;fn+=1)if(qi[fn].positionedGlyphs.length!==0)return!1;return!0}(on)&&Li}Do.fromFeature=function(a,u){for(var p=new Do,x=0;x<a.sections.length;x++){var B=a.sections[x];B.image?p.addImageSection(B):p.addTextSection(B,u)}return p},Do.prototype.length=function(){return this.text.length},Do.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Do.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Do.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Do.prototype.verticalizePunctuation=function(){this.text=function(a){for(var u="",p=0;p<a.length;p++){var x=a.charCodeAt(p+1)||null,B=a.charCodeAt(p-1)||null;u+=x&&Eh(x)&&!yA[a[p+1]]||B&&Eh(B)&&!yA[a[p-1]]||!yA[a[p]]?a[p]:yA[a[p]]}return u}(this.text)},Do.prototype.trim=function(){for(var a=0,u=0;u<this.text.length&&Am[this.text.charCodeAt(u)];u++)a++;for(var p=this.text.length,x=this.text.length-1;x>=0&&x>=a&&Am[this.text.charCodeAt(x)];x--)p--;this.text=this.text.substring(a,p),this.sectionIndex=this.sectionIndex.slice(a,p)},Do.prototype.substring=function(a,u){var p=new Do;return p.text=this.text.substring(a,u),p.sectionIndex=this.sectionIndex.slice(a,u),p.sections=this.sections,p},Do.prototype.toString=function(){return this.text},Do.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(u,p){return Math.max(u,a.sections[p].scale)},0)},Do.prototype.addTextSection=function(a,u){this.text+=a.text,this.sections.push(Kf.forText(a.scale,a.fontStack||u));for(var p=this.sections.length-1,x=0;x<a.text.length;++x)this.sectionIndex.push(p)},Do.prototype.addImageSection=function(a){var u=a.image?a.image.name:"";if(u.length!==0){var p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Kf.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ut("Reached maximum number of images 6401")}else ut("Can't add FormattedSection with an empty image.")},Do.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Am={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ss={};function A3(a,u,p,x,B,I){if(u.imageName){var D=x[u.imageName];return D?D.displaySize[0]*u.scale*24/I+B:0}var k=p[u.fontStack],G=k&&k[a];return G?G.metrics.advance*u.scale+B:0}function g3(a,u,p,x){var B=Math.pow(a-u,2);return x?a<u?B/2:2*B:B+Math.abs(p)*p}function TN(a,u,p){var x=0;return a===10&&(x-=1e4),p&&(x+=150),a!==40&&a!==65288||(x+=50),u!==41&&u!==65289||(x+=50),x}function m3(a,u,p,x,B,I){for(var D=null,k=g3(u,p,B,I),G=0,X=x;G<X.length;G+=1){var Y=X[G],rt=g3(u-Y.x,p,B,I)+Y.badness;rt<=k&&(D=Y,k=rt)}return{index:a,x:u,priorBreak:D,badness:k}}function __(a,u,p,x,B,I,D){if(I!=="point")return[];if(!a)return[];for(var k,G=[],X=function(Ht,jt,qt,ae,ge,ye){for(var De=0,We=0;We<Ht.length();We++){var Ze=Ht.getSection(We);De+=A3(Ht.getCharCode(We),Ze,ae,ge,jt,ye)}return De/Math.max(1,Math.ceil(De/qt))}(a,u,p,x,B,D),Y=a.text.indexOf("\u200B")>=0,rt=0,ht=0;ht<a.length();ht++){var yt=a.getSection(ht),Ft=a.getCharCode(ht);if(Am[Ft]||(rt+=A3(Ft,yt,x,B,u,D)),ht<a.length()-1){var kt=!((k=Ft)<11904||!(Ye["Bopomofo Extended"](k)||Ye.Bopomofo(k)||Ye["CJK Compatibility Forms"](k)||Ye["CJK Compatibility Ideographs"](k)||Ye["CJK Compatibility"](k)||Ye["CJK Radicals Supplement"](k)||Ye["CJK Strokes"](k)||Ye["CJK Symbols and Punctuation"](k)||Ye["CJK Unified Ideographs Extension A"](k)||Ye["CJK Unified Ideographs"](k)||Ye["Enclosed CJK Letters and Months"](k)||Ye["Halfwidth and Fullwidth Forms"](k)||Ye.Hiragana(k)||Ye["Ideographic Description Characters"](k)||Ye["Kangxi Radicals"](k)||Ye["Katakana Phonetic Extensions"](k)||Ye.Katakana(k)||Ye["Vertical Forms"](k)||Ye["Yi Radicals"](k)||Ye["Yi Syllables"](k)));(Ss[Ft]||kt||yt.imageName)&&G.push(m3(ht+1,rt,X,G,TN(Ft,a.getCharCode(ht+1),kt&&Y),!1))}}return function Ht(jt){return jt?Ht(jt.priorBreak).concat(jt.index):[]}(m3(a.length(),rt,X,G,0,!0))}function b_(a){var u=.5,p=.5;switch(a){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":p=1;break;case"top":case"top-right":case"top-left":p=0}return{horizontalAlign:u,verticalAlign:p}}function SN(a,u,p,x,B){if(x||B)for(var I=a[p],D=(a[p].x+I.metrics.advance*I.scale)*x,k=u;k<=p;k++)a[k].x-=D,a[k].y+=B}function y3(a,u,p,x,B,I){var D,k=a.image;if(k.content){var G=k.content,X=k.pixelRatio||1;D=[G[0]/X,G[1]/X,k.displaySize[0]-G[2]/X,k.displaySize[1]-G[3]/X]}var Y,rt,ht,yt,Ft=u.left*I,kt=u.right*I;p==="width"||p==="both"?(yt=B[0]+Ft-x[3],rt=B[0]+kt+x[1]):rt=(yt=B[0]+(Ft+kt-k.displaySize[0])/2)+k.displaySize[0];var Ht=u.top*I,jt=u.bottom*I;return p==="height"||p==="both"?(Y=B[1]+Ht-x[0],ht=B[1]+jt+x[2]):ht=(Y=B[1]+(Ht+jt-k.displaySize[1])/2)+k.displaySize[1],{image:k,top:Y,right:rt,bottom:ht,left:yt,collisionPadding:D}}Ss[10]=!0,Ss[32]=!0,Ss[38]=!0,Ss[40]=!0,Ss[41]=!0,Ss[43]=!0,Ss[45]=!0,Ss[47]=!0,Ss[173]=!0,Ss[183]=!0,Ss[8203]=!0,Ss[8208]=!0,Ss[8211]=!0,Ss[8231]=!0;var qf=function(a){function u(p,x,B,I){a.call(this,p,x),this.angle=B,I!==void 0&&(this.segment=I)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(_);function x_(a,u){var p=u.expression;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Vi(a+1))};if(p.kind==="source")return{kind:"source"};for(var x=p.zoomStops,B=p.interpolationType,I=0;I<x.length&&x[I]<=a;)I++;for(var D=I=Math.max(0,I-1);D<x.length&&x[D]<a+1;)D++;D=Math.min(x.length-1,D);var k=x[I],G=x[D];return p.kind==="composite"?{kind:"composite",minZoom:k,maxZoom:G,interpolationType:B}:{kind:"camera",minZoom:k,maxZoom:G,minSize:p.evaluate(new Vi(k)),maxSize:p.evaluate(new Vi(G)),interpolationType:B}}function v3(a,u,p){var x=u.uSize,B=p.lowerSize;return a.kind==="source"?B/128:a.kind==="composite"?fr(B/128,p.upperSize/128,u.uSizeT):x}function _3(a,u){var p=0,x=0;if(a.kind==="constant")x=a.layoutSize;else if(a.kind!=="source"){var B=a.interpolationType,I=B?H(zr.interpolationFactor(B,u,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?x=fr(a.minSize,a.maxSize,I):p=I}return{uSizeT:p,uSize:x}}si("Anchor",qf);var IN=Object.freeze({__proto__:null,getSizeData:x_,evaluateSizeForFeature:v3,evaluateSizeForZoom:_3,SIZE_PACK_FACTOR:128});function b3(a,u,p,x,B){if(u.segment===void 0)return!0;for(var I=u,D=u.segment+1,k=0;k>-p/2;){if(--D<0)return!1;k-=a[D].dist(I),I=a[D]}k+=a[D].dist(a[D+1]),D++;for(var G=[],X=0;k<p/2;){var Y=a[D],rt=a[D+1];if(!rt)return!1;var ht=a[D-1].angleTo(Y)-Y.angleTo(rt);for(ht=Math.abs((ht+3*Math.PI)%(2*Math.PI)-Math.PI),G.push({distance:k,angleDelta:ht}),X+=ht;k-G[0].distance>x;)X-=G.shift().angleDelta;if(X>B)return!1;D++,k+=Y.dist(rt)}return!0}function x3(a){for(var u=0,p=0;p<a.length-1;p++)u+=a[p].dist(a[p+1]);return u}function w3(a,u,p){return a?.6*u*p:0}function C3(a,u){return Math.max(a?a.right-a.left:0,u?u.right-u.left:0)}function MN(a,u,p,x,B,I){for(var D=w3(p,B,I),k=C3(p,x)*I,G=0,X=x3(a)/2,Y=0;Y<a.length-1;Y++){var rt=a[Y],ht=a[Y+1],yt=rt.dist(ht);if(G+yt>X){var Ft=(X-G)/yt,kt=fr(rt.x,ht.x,Ft),Ht=fr(rt.y,ht.y,Ft),jt=new qf(kt,Ht,ht.angleTo(rt),Y);return jt._round(),!D||b3(a,jt,k,D,u)?jt:void 0}G+=yt}}function PN(a,u,p,x,B,I,D,k,G){var X=w3(x,I,D),Y=C3(x,B),rt=Y*D,ht=a[0].x===0||a[0].x===G||a[0].y===0||a[0].y===G;return u-rt<u/4&&(u=rt+u/4),function yt(Ft,kt,Ht,jt,qt,ae,ge,ye,De){for(var We=ae/2,Ze=x3(Ft),_i=0,ni=kt-Ht,Bi=[],ri=0;ri<Ft.length-1;ri++){for(var on=Ft[ri],Li=Ft[ri+1],fi=on.dist(Li),fn=Li.angleTo(on);ni+Ht<_i+fi;){var qi=((ni+=Ht)-_i)/fi,bn=fr(on.x,Li.x,qi),Ti=fr(on.y,Li.y,qi);if(bn>=0&&bn<De&&Ti>=0&&Ti<De&&ni-We>=0&&ni+We<=Ze){var Cn=new qf(bn,Ti,fn,ri);Cn._round(),jt&&!b3(Ft,Cn,ae,jt,qt)||Bi.push(Cn)}}_i+=fi}return ye||Bi.length||ge||(Bi=yt(Ft,_i/2,Ht,jt,qt,ae,ge,!0,De)),Bi}(a,ht?u/2*k%u:(Y/2+2*I)*D*k%u,u,X,p,rt,ht,!1,G)}function E3(a,u,p,x,B){for(var I=[],D=0;D<a.length;D++)for(var k=a[D],G=void 0,X=0;X<k.length-1;X++){var Y=k[X],rt=k[X+1];Y.x<u&&rt.x<u||(Y.x<u?Y=new _(u,Y.y+(u-Y.x)/(rt.x-Y.x)*(rt.y-Y.y))._round():rt.x<u&&(rt=new _(u,Y.y+(u-Y.x)/(rt.x-Y.x)*(rt.y-Y.y))._round()),Y.y<p&&rt.y<p||(Y.y<p?Y=new _(Y.x+(p-Y.y)/(rt.y-Y.y)*(rt.x-Y.x),p)._round():rt.y<p&&(rt=new _(Y.x+(p-Y.y)/(rt.y-Y.y)*(rt.x-Y.x),p)._round()),Y.x>=x&&rt.x>=x||(Y.x>=x?Y=new _(x,Y.y+(x-Y.x)/(rt.x-Y.x)*(rt.y-Y.y))._round():rt.x>=x&&(rt=new _(x,Y.y+(x-Y.x)/(rt.x-Y.x)*(rt.y-Y.y))._round()),Y.y>=B&&rt.y>=B||(Y.y>=B?Y=new _(Y.x+(B-Y.y)/(rt.y-Y.y)*(rt.x-Y.x),B)._round():rt.y>=B&&(rt=new _(Y.x+(B-Y.y)/(rt.y-Y.y)*(rt.x-Y.x),B)._round()),G&&Y.equals(G[G.length-1])||I.push(G=[Y]),G.push(rt)))))}return I}function B3(a,u,p,x){var B=[],I=a.image,D=I.pixelRatio,k=I.paddedRect.w-2,G=I.paddedRect.h-2,X=a.right-a.left,Y=a.bottom-a.top,rt=I.stretchX||[[0,k]],ht=I.stretchY||[[0,G]],yt=function(bn,Ti){return bn+Ti[1]-Ti[0]},Ft=rt.reduce(yt,0),kt=ht.reduce(yt,0),Ht=k-Ft,jt=G-kt,qt=0,ae=Ft,ge=0,ye=kt,De=0,We=Ht,Ze=0,_i=jt;if(I.content&&x){var ni=I.content;qt=gm(rt,0,ni[0]),ge=gm(ht,0,ni[1]),ae=gm(rt,ni[0],ni[2]),ye=gm(ht,ni[1],ni[3]),De=ni[0]-qt,Ze=ni[1]-ge,We=ni[2]-ni[0]-ae,_i=ni[3]-ni[1]-ye}var Bi=function(bn,Ti,Cn,rr){var Sr=mm(bn.stretch-qt,ae,X,a.left),xr=ym(bn.fixed-De,We,bn.stretch,Ft),or=mm(Ti.stretch-ge,ye,Y,a.top),Ir=ym(Ti.fixed-Ze,_i,Ti.stretch,kt),qr=mm(Cn.stretch-qt,ae,X,a.left),Zr=ym(Cn.fixed-De,We,Cn.stretch,Ft),Oo=mm(rr.stretch-ge,ye,Y,a.top),ao=ym(rr.fixed-Ze,_i,rr.stretch,kt),Lo=new _(Sr,or),Rr=new _(qr,or),co=new _(qr,Oo),gn=new _(Sr,Oo),Un=new _(xr/D,Ir/D),Mn=new _(Zr/D,ao/D),wn=u*Math.PI/180;if(wn){var Zo=Math.sin(wn),bo=Math.cos(wn),tr=[bo,-Zo,Zo,bo];Lo._matMult(tr),Rr._matMult(tr),gn._matMult(tr),co._matMult(tr)}var Nr=bn.stretch+bn.fixed,xo=Ti.stretch+Ti.fixed;return{tl:Lo,tr:Rr,bl:gn,br:co,tex:{x:I.paddedRect.x+1+Nr,y:I.paddedRect.y+1+xo,w:Cn.stretch+Cn.fixed-Nr,h:rr.stretch+rr.fixed-xo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Un,pixelOffsetBR:Mn,minFontScaleX:We/D/X,minFontScaleY:_i/D/Y,isSDF:p}};if(x&&(I.stretchX||I.stretchY))for(var ri=T3(rt,Ht,Ft),on=T3(ht,jt,kt),Li=0;Li<ri.length-1;Li++)for(var fi=ri[Li],fn=ri[Li+1],qi=0;qi<on.length-1;qi++)B.push(Bi(fi,on[qi],fn,on[qi+1]));else B.push(Bi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:k+1},{fixed:0,stretch:G+1}));return B}function gm(a,u,p){for(var x=0,B=0,I=a;B<I.length;B+=1){var D=I[B];x+=Math.max(u,Math.min(p,D[1]))-Math.max(u,Math.min(p,D[0]))}return x}function T3(a,u,p){for(var x=[{fixed:-1,stretch:0}],B=0,I=a;B<I.length;B+=1){var D=I[B],k=D[0],G=D[1],X=x[x.length-1];x.push({fixed:k-X.stretch,stretch:X.stretch}),x.push({fixed:k-X.stretch,stretch:X.stretch+(G-k)})}return x.push({fixed:u+1,stretch:p}),x}function mm(a,u,p,x){return a/u*p+x}function ym(a,u,p,x){return a-u*p/x}var vm=function(a,u,p,x,B,I,D,k,G,X){if(this.boxStartIndex=a.length,G){var Y=I.top,rt=I.bottom,ht=I.collisionPadding;ht&&(Y-=ht[1],rt+=ht[3]);var yt=rt-Y;yt>0&&(yt=Math.max(10,yt),this.circleDiameter=yt)}else{var Ft=I.top*D-k,kt=I.bottom*D+k,Ht=I.left*D-k,jt=I.right*D+k,qt=I.collisionPadding;if(qt&&(Ht-=qt[0]*D,Ft-=qt[1]*D,jt+=qt[2]*D,kt+=qt[3]*D),X){var ae=new _(Ht,Ft),ge=new _(jt,Ft),ye=new _(Ht,kt),De=new _(jt,kt),We=X*Math.PI/180;ae._rotate(We),ge._rotate(We),ye._rotate(We),De._rotate(We),Ht=Math.min(ae.x,ge.x,ye.x,De.x),jt=Math.max(ae.x,ge.x,ye.x,De.x),Ft=Math.min(ae.y,ge.y,ye.y,De.y),kt=Math.max(ae.y,ge.y,ye.y,De.y)}a.emplaceBack(u.x,u.y,Ht,Ft,jt,kt,p,x,B)}this.boxEndIndex=a.length},Zf=function(a,u){if(a===void 0&&(a=[]),u===void 0&&(u=RN),this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function RN(a,u){return a<u?-1:a>u?1:0}function DN(a,u,p){p===void 0&&(p=!1);for(var x=1/0,B=1/0,I=-1/0,D=-1/0,k=a[0],G=0;G<k.length;G++){var X=k[G];(!G||X.x<x)&&(x=X.x),(!G||X.y<B)&&(B=X.y),(!G||X.x>I)&&(I=X.x),(!G||X.y>D)&&(D=X.y)}var Y=Math.min(I-x,D-B),rt=Y/2,ht=new Zf([],ON);if(Y===0)return new _(x,B);for(var yt=x;yt<I;yt+=Y)for(var Ft=B;Ft<D;Ft+=Y)ht.push(new Yf(yt+rt,Ft+rt,rt,a));for(var kt=function(qt){for(var ae=0,ge=0,ye=0,De=qt[0],We=0,Ze=De.length,_i=Ze-1;We<Ze;_i=We++){var ni=De[We],Bi=De[_i],ri=ni.x*Bi.y-Bi.x*ni.y;ge+=(ni.x+Bi.x)*ri,ye+=(ni.y+Bi.y)*ri,ae+=3*ri}return new Yf(ge/ae,ye/ae,0,qt)}(a),Ht=ht.length;ht.length;){var jt=ht.pop();(jt.d>kt.d||!kt.d)&&(kt=jt,p&&console.log("found best %d after %d probes",Math.round(1e4*jt.d)/1e4,Ht)),jt.max-kt.d<=u||(ht.push(new Yf(jt.p.x-(rt=jt.h/2),jt.p.y-rt,rt,a)),ht.push(new Yf(jt.p.x+rt,jt.p.y-rt,rt,a)),ht.push(new Yf(jt.p.x-rt,jt.p.y+rt,rt,a)),ht.push(new Yf(jt.p.x+rt,jt.p.y+rt,rt,a)),Ht+=4)}return p&&(console.log("num probes: "+Ht),console.log("best distance: "+kt.d)),kt.p}function ON(a,u){return u.max-a.max}function Yf(a,u,p,x){this.p=new _(a,u),this.h=p,this.d=function(B,I){for(var D=!1,k=1/0,G=0;G<I.length;G++)for(var X=I[G],Y=0,rt=X.length,ht=rt-1;Y<rt;ht=Y++){var yt=X[Y],Ft=X[ht];yt.y>B.y!=Ft.y>B.y&&B.x<(Ft.x-yt.x)*(B.y-yt.y)/(Ft.y-yt.y)+yt.x&&(D=!D),k=Math.min(k,Su(B,yt,Ft))}return(D?1:-1)*Math.sqrt(k)}(this.p,x),this.max=this.d+this.h*Math.SQRT2}Zf.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},Zf.prototype.pop=function(){if(this.length!==0){var a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}},Zf.prototype.peek=function(){return this.data[0]},Zf.prototype._up=function(a){for(var u=this.data,p=this.compare,x=u[a];a>0;){var B=a-1>>1,I=u[B];if(p(x,I)>=0)break;u[a]=I,a=B}u[a]=x},Zf.prototype._down=function(a){for(var u=this.data,p=this.compare,x=this.length>>1,B=u[a];a<x;){var I=1+(a<<1),D=u[I],k=I+1;if(k<this.length&&p(u[k],D)<0&&(I=k,D=u[k]),p(D,B)>=0)break;u[a]=D,a=I}u[a]=B};var w_=Number.POSITIVE_INFINITY;function S3(a,u){return u[1]!==w_?function(p,x,B){var I=0,D=0;switch(x=Math.abs(x),B=Math.abs(B),p){case"top-right":case"top-left":case"top":D=B-7;break;case"bottom-right":case"bottom-left":case"bottom":D=7-B}switch(p){case"top-right":case"bottom-right":case"right":I=-x;break;case"top-left":case"bottom-left":case"left":I=x}return[I,D]}(a,u[0],u[1]):function(p,x){var B=0,I=0;x<0&&(x=0);var D=x/Math.sqrt(2);switch(p){case"top-right":case"top-left":I=D-7;break;case"bottom-right":case"bottom-left":I=7-D;break;case"bottom":I=7-x;break;case"top":I=x-7}switch(p){case"top-right":case"bottom-right":B=-D;break;case"top-left":case"bottom-left":B=D;break;case"left":B=x;break;case"right":B=-x}return[B,I]}(a,u[0])}function C_(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function I3(a,u,p,x,B,I,D,k,G,X,Y,rt,ht,yt,Ft){var kt=function(ge,ye,De,We,Ze,_i,ni,Bi){for(var ri=We.layout.get("text-rotate").evaluate(_i,{})*Math.PI/180,on=[],Li=0,fi=ye.positionedLines;Li<fi.length;Li+=1)for(var fn=fi[Li],qi=0,bn=fn.positionedGlyphs;qi<bn.length;qi+=1){var Ti=bn[qi];if(Ti.rect){var Cn=Ti.rect||{},rr=4,Sr=!0,xr=1,or=0,Ir=(Ze||Bi)&&Ti.vertical,qr=Ti.metrics.advance*Ti.scale/2;if(Bi&&ye.verticalizable&&(or=fn.lineOffset/2-(Ti.imageName?-(24-Ti.metrics.width*Ti.scale)/2:24*(Ti.scale-1))),Ti.imageName){var Zr=ni[Ti.imageName];Sr=Zr.sdf,rr=1/(xr=Zr.pixelRatio)}var Oo=Ze?[Ti.x+qr,Ti.y]:[0,0],ao=Ze?[0,0]:[Ti.x+qr+De[0],Ti.y+De[1]-or],Lo=[0,0];Ir&&(Lo=ao,ao=[0,0]);var Rr=(Ti.metrics.left-rr)*Ti.scale-qr+ao[0],co=(-Ti.metrics.top-rr)*Ti.scale+ao[1],gn=Rr+Cn.w*Ti.scale/xr,Un=co+Cn.h*Ti.scale/xr,Mn=new _(Rr,co),wn=new _(gn,co),Zo=new _(Rr,Un),bo=new _(gn,Un);if(Ir){var tr=new _(-qr,qr- -17),Nr=-Math.PI/2,xo=12-qr,En=new _(22-xo,-(Ti.imageName?xo:0)),Jc=new(Function.prototype.bind.apply(_,[null].concat(Lo)));Mn._rotateAround(Nr,tr)._add(En)._add(Jc),wn._rotateAround(Nr,tr)._add(En)._add(Jc),Zo._rotateAround(Nr,tr)._add(En)._add(Jc),bo._rotateAround(Nr,tr)._add(En)._add(Jc)}if(ri){var Ns=Math.sin(ri),Xc=Math.cos(ri),Dr=[Xc,-Ns,Ns,Xc];Mn._matMult(Dr),wn._matMult(Dr),Zo._matMult(Dr),bo._matMult(Dr)}var Qc=new _(0,0),Ra=new _(0,0);on.push({tl:Mn,tr:wn,bl:Zo,br:bo,tex:Cn,writingMode:ye.writingMode,glyphOffset:Oo,sectionIndex:Ti.sectionIndex,isSDF:Sr,pixelOffsetTL:Qc,pixelOffsetBR:Ra,minFontScaleX:0,minFontScaleY:0})}}return on}(0,p,k,B,I,D,x,a.allowVerticalPlacement),Ht=a.textSizeData,jt=null;Ht.kind==="source"?(jt=[128*B.layout.get("text-size").evaluate(D,{})])[0]>32640&&ut(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ht.kind==="composite"&&((jt=[128*yt.compositeTextSizes[0].evaluate(D,{},Ft),128*yt.compositeTextSizes[1].evaluate(D,{},Ft)])[0]>32640||jt[1]>32640)&&ut(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,kt,jt,k,I,D,X,u,G.lineStartIndex,G.lineLength,ht,Ft);for(var qt=0,ae=Y;qt<ae.length;qt+=1)rt[ae[qt]]=a.text.placedSymbolArray.length-1;return 4*kt.length}function M3(a){for(var u in a)return a[u];return null}function LN(a,u,p,x){var B=a.compareText;if(u in B){for(var I=B[u],D=I.length-1;D>=0;D--)if(x.dist(I[D])<p)return!0}else B[u]=[];return B[u].push(x),!1}var FN=Xf.VectorTileFeature.types,kN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _m(a,u,p,x,B,I,D,k,G,X,Y,rt,ht){var yt=k?Math.min(32640,Math.round(k[0])):0,Ft=k?Math.min(32640,Math.round(k[1])):0;a.emplaceBack(u,p,Math.round(32*x),Math.round(32*B),I,D,(yt<<1)+(G?1:0),Ft,16*X,16*Y,256*rt,256*ht)}function E_(a,u,p){a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p),a.emplaceBack(u.x,u.y,p)}function NN(a){for(var u=0,p=a.sections;u<p.length;u+=1)if(wu(p[u].text))return!0;return!1}var $f=function(a){this.layoutVertexArray=new Xe,this.indexArray=new oa,this.programConfigurations=a,this.segments=new Z,this.dynamicLayoutVertexArray=new ei,this.opacityVertexArray=new jc,this.placedSymbolArray=new m};$f.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},$f.prototype.upload=function(a,u,p,x){this.isEmpty()||(p&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,lN.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,uN.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,kN,!0),this.opacityVertexBuffer.itemSize=1),(p||x)&&this.programConfigurations.upload(a))},$f.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},si("SymbolBuffers",$f);var bA=function(a,u,p){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new p,this.segments=new Z,this.collisionVertexArray=new ra};bA.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,hN.members,!0)},bA.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},si("CollisionBuffers",bA);var On=function(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(function(I){return I.id}),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ts([]),this.placementViewportMatrix=Ts([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=x_(this.zoom,u["text-size"]),this.iconSizeData=x_(this.zoom,u["icon-size"]);var p=this.layers[0].layout,x=p.get("symbol-sort-key"),B=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=B!=="viewport-y"&&x.constantOr(1)!==void 0,this.sortFeaturesByY=(B==="viewport-y"||B==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(function(I){return ks[I]})),this.stateDependentLayerIds=this.layers.filter(function(I){return I.isStateDependent()}).map(function(I){return I.id}),this.sourceID=a.sourceID};On.prototype.createArrays=function(){this.text=new $f(new Oi(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new $f(new Oi(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new R,this.lineVertexArray=new F,this.symbolInstances=new P},On.prototype.calculateGlyphDependencies=function(a,u,p,x,B){for(var I=0;I<a.length;I++)if(u[a.charCodeAt(I)]=!0,(p||x)&&B){var D=yA[a.charAt(I)];D&&(u[D.charCodeAt(0)]=!0)}},On.prototype.populate=function(a,u,p){var x=this.layers[0],B=x.layout,I=B.get("text-font"),D=B.get("text-field"),k=B.get("icon-image"),G=(D.value.kind!=="constant"||D.value.value instanceof ur&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),X=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,Y=B.get("symbol-sort-key");if(this.features=[],G||X){for(var rt=u.iconDependencies,ht=u.glyphDependencies,yt=u.availableImages,Ft=new Vi(this.zoom),kt=0,Ht=a;kt<Ht.length;kt+=1){var jt=Ht[kt],qt=jt.feature,ae=jt.id,ge=jt.index,ye=jt.sourceLayerIndex,De=x._featureFilter.needGeometry,We=Pr(qt,De);if(x._featureFilter.filter(Ft,We,p)){De||(We.geometry=br(qt));var Ze=void 0;if(G){var _i=x.getValueAndResolveTokens("text-field",We,p,yt),ni=ur.factory(_i);NN(ni)&&(this.hasRTLText=!0),(!this.hasRTLText||Th()==="unavailable"||this.hasRTLText&&io.isParsed())&&(Ze=dN(ni,x,We))}var Bi=void 0;if(X){var ri=x.getValueAndResolveTokens("icon-image",We,p,yt);Bi=ri instanceof Wn?ri:Wn.fromString(ri)}if(Ze||Bi){var on=this.sortFeaturesByKey?Y.evaluate(We,{},p):void 0;if(this.features.push({id:ae,text:Ze,icon:Bi,index:ge,sourceLayerIndex:ye,geometry:We.geometry,properties:qt.properties,type:FN[qt.type],sortKey:on}),Bi&&(rt[Bi.name]=!0),Ze){var Li=I.evaluate(We,{},p).join(","),fi=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ks.vertical)>=0;for(var fn=0,qi=Ze.sections;fn<qi.length;fn+=1){var bn=qi[fn];if(bn.image)rt[bn.image.name]=!0;else{var Ti=Ch(Ze.toString()),Cn=bn.fontStack||Li,rr=ht[Cn]=ht[Cn]||{};this.calculateGlyphDependencies(bn.text,rr,fi,this.allowVerticalPlacement,Ti)}}}}}}B.get("symbol-placement")==="line"&&(this.features=function(Sr){var xr={},or={},Ir=[],qr=0;function Zr(tr){Ir.push(Sr[tr]),qr++}function Oo(tr,Nr,xo){var En=or[tr];return delete or[tr],or[Nr]=En,Ir[En].geometry[0].pop(),Ir[En].geometry[0]=Ir[En].geometry[0].concat(xo[0]),En}function ao(tr,Nr,xo){var En=xr[Nr];return delete xr[Nr],xr[tr]=En,Ir[En].geometry[0].shift(),Ir[En].geometry[0]=xo[0].concat(Ir[En].geometry[0]),En}function Lo(tr,Nr,xo){var En=xo?Nr[0][Nr[0].length-1]:Nr[0][0];return tr+":"+En.x+":"+En.y}for(var Rr=0;Rr<Sr.length;Rr++){var co=Sr[Rr],gn=co.geometry,Un=co.text?co.text.toString():null;if(Un){var Mn=Lo(Un,gn),wn=Lo(Un,gn,!0);if(Mn in or&&wn in xr&&or[Mn]!==xr[wn]){var Zo=ao(Mn,wn,gn),bo=Oo(Mn,wn,Ir[Zo].geometry);delete xr[Mn],delete or[wn],or[Lo(Un,Ir[bo].geometry,!0)]=bo,Ir[Zo].geometry=null}else Mn in or?Oo(Mn,wn,gn):wn in xr?ao(Mn,wn,gn):(Zr(Rr),xr[Mn]=qr-1,or[wn]=qr-1)}else Zr(Rr)}return Ir.filter(function(tr){return tr.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Sr,xr){return Sr.sortKey-xr.sortKey})}},On.prototype.update=function(a,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,p),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,p))},On.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},On.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},On.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},On.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},On.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},On.prototype.addToLineVertexArray=function(a,u){var p=this.lineVertexArray.length;if(a.segment!==void 0){for(var x=a.dist(u[a.segment+1]),B=a.dist(u[a.segment]),I={},D=a.segment+1;D<u.length;D++)I[D]={x:u[D].x,y:u[D].y,tileUnitDistanceFromAnchor:x},D<u.length-1&&(x+=u[D+1].dist(u[D]));for(var k=a.segment||0;k>=0;k--)I[k]={x:u[k].x,y:u[k].y,tileUnitDistanceFromAnchor:B},k>0&&(B+=u[k-1].dist(u[k]));for(var G=0;G<u.length;G++){var X=I[G];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}},On.prototype.addSymbols=function(a,u,p,x,B,I,D,k,G,X,Y,rt){for(var ht=a.indexArray,yt=a.layoutVertexArray,Ft=a.segments.prepareSegment(4*u.length,yt,ht,this.canOverlap?I.sortKey:void 0),kt=this.glyphOffsetArray.length,Ht=Ft.vertexLength,jt=this.allowVerticalPlacement&&D===ks.vertical?Math.PI/2:0,qt=I.text&&I.text.sections,ae=0;ae<u.length;ae++){var ge=u[ae],ye=ge.tl,De=ge.tr,We=ge.bl,Ze=ge.br,_i=ge.tex,ni=ge.pixelOffsetTL,Bi=ge.pixelOffsetBR,ri=ge.minFontScaleX,on=ge.minFontScaleY,Li=ge.glyphOffset,fi=ge.isSDF,fn=ge.sectionIndex,qi=Ft.vertexLength,bn=Li[1];_m(yt,k.x,k.y,ye.x,bn+ye.y,_i.x,_i.y,p,fi,ni.x,ni.y,ri,on),_m(yt,k.x,k.y,De.x,bn+De.y,_i.x+_i.w,_i.y,p,fi,Bi.x,ni.y,ri,on),_m(yt,k.x,k.y,We.x,bn+We.y,_i.x,_i.y+_i.h,p,fi,ni.x,Bi.y,ri,on),_m(yt,k.x,k.y,Ze.x,bn+Ze.y,_i.x+_i.w,_i.y+_i.h,p,fi,Bi.x,Bi.y,ri,on),E_(a.dynamicLayoutVertexArray,k,jt),ht.emplaceBack(qi,qi+1,qi+2),ht.emplaceBack(qi+1,qi+2,qi+3),Ft.vertexLength+=4,Ft.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Li[0]),ae!==u.length-1&&fn===u[ae+1].sectionIndex||a.programConfigurations.populatePaintArrays(yt.length,I,I.index,{},rt,qt&&qt[fn])}a.placedSymbolArray.emplaceBack(k.x,k.y,kt,this.glyphOffsetArray.length-kt,Ht,G,X,k.segment,p?p[0]:0,p?p[1]:0,x[0],x[1],D,0,!1,0,Y)},On.prototype._addCollisionDebugVertex=function(a,u,p,x,B,I){return u.emplaceBack(0,0),a.emplaceBack(p.x,p.y,x,B,Math.round(I.x),Math.round(I.y))},On.prototype.addCollisionDebugVertices=function(a,u,p,x,B,I,D){var k=B.segments.prepareSegment(4,B.layoutVertexArray,B.indexArray),G=k.vertexLength,X=B.layoutVertexArray,Y=B.collisionVertexArray,rt=D.anchorX,ht=D.anchorY;this._addCollisionDebugVertex(X,Y,I,rt,ht,new _(a,u)),this._addCollisionDebugVertex(X,Y,I,rt,ht,new _(p,u)),this._addCollisionDebugVertex(X,Y,I,rt,ht,new _(p,x)),this._addCollisionDebugVertex(X,Y,I,rt,ht,new _(a,x)),k.vertexLength+=4;var yt=B.indexArray;yt.emplaceBack(G,G+1),yt.emplaceBack(G+1,G+2),yt.emplaceBack(G+2,G+3),yt.emplaceBack(G+3,G),k.primitiveLength+=4},On.prototype.addDebugCollisionBoxes=function(a,u,p,x){for(var B=a;B<u;B++){var I=this.collisionBoxArray.get(B);this.addCollisionDebugVertices(I.x1,I.y1,I.x2,I.y2,x?this.textCollisionBox:this.iconCollisionBox,I.anchorPoint,p)}},On.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bA(na,c3.members,T),this.iconCollisionBox=new bA(na,c3.members,T);for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},On.prototype._deserializeCollisionBoxesForSymbol=function(a,u,p,x,B,I,D,k,G){for(var X={},Y=u;Y<p;Y++){var rt=a.get(Y);X.textBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},X.textFeatureIndex=rt.featureIndex;break}for(var ht=x;ht<B;ht++){var yt=a.get(ht);X.verticalTextBox={x1:yt.x1,y1:yt.y1,x2:yt.x2,y2:yt.y2,anchorPointX:yt.anchorPointX,anchorPointY:yt.anchorPointY},X.verticalTextFeatureIndex=yt.featureIndex;break}for(var Ft=I;Ft<D;Ft++){var kt=a.get(Ft);X.iconBox={x1:kt.x1,y1:kt.y1,x2:kt.x2,y2:kt.y2,anchorPointX:kt.anchorPointX,anchorPointY:kt.anchorPointY},X.iconFeatureIndex=kt.featureIndex;break}for(var Ht=k;Ht<G;Ht++){var jt=a.get(Ht);X.verticalIconBox={x1:jt.x1,y1:jt.y1,x2:jt.x2,y2:jt.y2,anchorPointX:jt.anchorPointX,anchorPointY:jt.anchorPointY},X.verticalIconFeatureIndex=jt.featureIndex;break}return X},On.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var p=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}},On.prototype.hasTextData=function(){return this.text.segments.get().length>0},On.prototype.hasIconData=function(){return this.icon.segments.get().length>0},On.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},On.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},On.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},On.prototype.addIndicesForPlacedSymbol=function(a,u){for(var p=a.placedSymbolArray.get(u),x=p.vertexStartIndex+4*p.numGlyphs,B=p.vertexStartIndex;B<x;B+=4)a.indexArray.emplaceBack(B,B+1,B+2),a.indexArray.emplaceBack(B+1,B+2,B+3)},On.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(a),p=Math.cos(a),x=[],B=[],I=[],D=0;D<this.symbolInstances.length;++D){I.push(D);var k=this.symbolInstances.get(D);x.push(0|Math.round(u*k.anchorX+p*k.anchorY)),B.push(k.featureIndex)}return I.sort(function(G,X){return x[G]-x[X]||B[X]-B[G]}),I},On.prototype.addToSortKeyRanges=function(a,u){var p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===u?p.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})},On.prototype.sortFeatures=function(a){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var p=0,x=this.symbolInstanceIndexes;p<x.length;p+=1){var B=this.symbolInstances.get(x[p]);this.featureSortOrder.push(B.featureIndex),[B.rightJustifiedTextSymbolIndex,B.centerJustifiedTextSymbolIndex,B.leftJustifiedTextSymbolIndex].forEach(function(I,D,k){I>=0&&k.indexOf(I)===D&&u.addIndicesForPlacedSymbol(u.text,I)}),B.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,B.verticalPlacedTextSymbolIndex),B.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,B.placedIconSymbolIndex),B.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,B.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},si("SymbolBucket",On,{omit:["layers","collisionBoxArray","features","compareText"]}),On.MAX_GLYPHS=65535,On.addDynamicAttributes=E_;var UN=new Qn({"symbol-placement":new xi(st.layout_symbol["symbol-placement"]),"symbol-spacing":new xi(st.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xi(st.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ui(st.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xi(st.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new xi(st.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xi(st.layout_symbol["icon-ignore-placement"]),"icon-optional":new xi(st.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xi(st.layout_symbol["icon-rotation-alignment"]),"icon-size":new ui(st.layout_symbol["icon-size"]),"icon-text-fit":new xi(st.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new xi(st.layout_symbol["icon-text-fit-padding"]),"icon-image":new ui(st.layout_symbol["icon-image"]),"icon-rotate":new ui(st.layout_symbol["icon-rotate"]),"icon-padding":new xi(st.layout_symbol["icon-padding"]),"icon-keep-upright":new xi(st.layout_symbol["icon-keep-upright"]),"icon-offset":new ui(st.layout_symbol["icon-offset"]),"icon-anchor":new ui(st.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xi(st.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xi(st.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xi(st.layout_symbol["text-rotation-alignment"]),"text-field":new ui(st.layout_symbol["text-field"]),"text-font":new ui(st.layout_symbol["text-font"]),"text-size":new ui(st.layout_symbol["text-size"]),"text-max-width":new ui(st.layout_symbol["text-max-width"]),"text-line-height":new xi(st.layout_symbol["text-line-height"]),"text-letter-spacing":new ui(st.layout_symbol["text-letter-spacing"]),"text-justify":new ui(st.layout_symbol["text-justify"]),"text-radial-offset":new ui(st.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xi(st.layout_symbol["text-variable-anchor"]),"text-anchor":new ui(st.layout_symbol["text-anchor"]),"text-max-angle":new xi(st.layout_symbol["text-max-angle"]),"text-writing-mode":new xi(st.layout_symbol["text-writing-mode"]),"text-rotate":new ui(st.layout_symbol["text-rotate"]),"text-padding":new xi(st.layout_symbol["text-padding"]),"text-keep-upright":new xi(st.layout_symbol["text-keep-upright"]),"text-transform":new ui(st.layout_symbol["text-transform"]),"text-offset":new ui(st.layout_symbol["text-offset"]),"text-allow-overlap":new xi(st.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xi(st.layout_symbol["text-ignore-placement"]),"text-optional":new xi(st.layout_symbol["text-optional"])}),B_={paint:new Qn({"icon-opacity":new ui(st.paint_symbol["icon-opacity"]),"icon-color":new ui(st.paint_symbol["icon-color"]),"icon-halo-color":new ui(st.paint_symbol["icon-halo-color"]),"icon-halo-width":new ui(st.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ui(st.paint_symbol["icon-halo-blur"]),"icon-translate":new xi(st.paint_symbol["icon-translate"]),"icon-translate-anchor":new xi(st.paint_symbol["icon-translate-anchor"]),"text-opacity":new ui(st.paint_symbol["text-opacity"]),"text-color":new ui(st.paint_symbol["text-color"],{runtimeType:je,getOverride:function(a){return a.textColor},hasOverride:function(a){return!!a.textColor}}),"text-halo-color":new ui(st.paint_symbol["text-halo-color"]),"text-halo-width":new ui(st.paint_symbol["text-halo-width"]),"text-halo-blur":new ui(st.paint_symbol["text-halo-blur"]),"text-translate":new xi(st.paint_symbol["text-translate"]),"text-translate-anchor":new xi(st.paint_symbol["text-translate-anchor"])}),layout:UN},td=function(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Le,this.defaultValue=a};td.prototype.evaluate=function(a){if(a.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},td.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},td.prototype.outputDefined=function(){return!1},td.prototype.serialize=function(){return null},si("FormatSectionOverride",td,{omit:["defaultValue"]});var zN=function(a){function u(p){a.call(this,p,B_)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.recalculate=function(p,x){if(a.prototype.recalculate.call(this,p,x),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var B=this.layout.get("text-writing-mode");if(B){for(var I=[],D=0,k=B;D<k.length;D+=1){var G=k[D];I.indexOf(G)<0&&I.push(G)}this.layout._values["text-writing-mode"]=I}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(p,x,B,I){var D=this.layout.get(p).evaluate(x,{},B,I),k=this._unevaluatedLayout._values[p];return k.isDataDriven()||ws(k.value)||!D?D:function(G,X){return X.replace(/{([^{}]+)}/g,function(Y,rt){return rt in G?String(G[rt]):""})}(x.properties,D)},u.prototype.createBucket=function(p){return new On(p)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var p=0,x=B_.paint.overridableProperties;p<x.length;p+=1){var B=x[p];if(u.hasPaintOverride(this.layout,B)){var I,D=this.paint.get(B),k=new td(D),G=new Sa(k,D.property.specification);I=D.value.kind==="constant"||D.value.kind==="source"?new Ya("source",G):new Dc("composite",G,D.value.zoomStops,D.value._interpolationType),this.paint._values[B]=new no(D.property,I,D.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(p,x,B){return!(!this.layout||x.isDataDriven()||B.isDataDriven())&&u.hasPaintOverride(this.layout,p)},u.hasPaintOverride=function(p,x){var B=p.get("text-field"),I=B_.paint.properties[x],D=!1,k=function(Y){for(var rt=0,ht=Y;rt<ht.length;rt+=1)if(I.overrides&&I.overrides.hasOverride(ht[rt]))return void(D=!0)};if(B.value.kind==="constant"&&B.value.value instanceof ur)k(B.value.value.sections);else if(B.value.kind==="source"){var G=function(Y){D||(Y instanceof Fr&&Jn(Y.value)===ln?k(Y.value.sections):Y instanceof mo?k(Y.sections):Y.eachChild(G))},X=B.value;X._styleExpression&&G(X._styleExpression.expression)}return D},u}(Ui),GN={paint:new Qn({"background-color":new xi(st.paint_background["background-color"]),"background-pattern":new uo(st.paint_background["background-pattern"]),"background-opacity":new xi(st.paint_background["background-opacity"])})},jN=function(a){function u(p){a.call(this,p,GN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ui),VN={paint:new Qn({"raster-opacity":new xi(st.paint_raster["raster-opacity"]),"raster-hue-rotate":new xi(st.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xi(st.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xi(st.paint_raster["raster-brightness-max"]),"raster-saturation":new xi(st.paint_raster["raster-saturation"]),"raster-contrast":new xi(st.paint_raster["raster-contrast"]),"raster-resampling":new xi(st.paint_raster["raster-resampling"]),"raster-fade-duration":new xi(st.paint_raster["raster-fade-duration"])})},HN=function(a){function u(p){a.call(this,p,VN)}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u}(Ui),WN=function(a){function u(p){a.call(this,p,{}),this.implementation=p}return a&&(u.__proto__=a),(u.prototype=Object.create(a&&a.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(p){this.implementation.onAdd&&this.implementation.onAdd(p,p.painter.context.gl)},u.prototype.onRemove=function(p){this.implementation.onRemove&&this.implementation.onRemove(p,p.painter.context.gl)},u}(Ui),JN={circle:u_,heatmap:S9,hillshade:M9,fill:X9,"fill-extrusion":iN,line:cN,symbol:zN,background:jN,raster:HN},P3=S.HTMLImageElement,R3=S.HTMLCanvasElement,D3=S.HTMLVideoElement,O3=S.ImageData,bm=S.ImageBitmap,Oh=function(a,u,p,x){this.context=a,this.format=p,this.texture=a.gl.createTexture(),this.update(u,x)};Oh.prototype.update=function(a,u,p){var x=a.width,B=a.height,I=!(this.size&&this.size[0]===x&&this.size[1]===B||p),D=this.context,k=D.gl;if(this.useMipmap=!!(u&&u.useMipmap),k.bindTexture(k.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===k.RGBA&&(!u||u.premultiply!==!1)),I)this.size=[x,B],a instanceof P3||a instanceof R3||a instanceof D3||a instanceof O3||bm&&a instanceof bm?k.texImage2D(k.TEXTURE_2D,0,this.format,this.format,k.UNSIGNED_BYTE,a):k.texImage2D(k.TEXTURE_2D,0,this.format,x,B,0,this.format,k.UNSIGNED_BYTE,a.data);else{var G=p||{x:0,y:0},X=G.x,Y=G.y;a instanceof P3||a instanceof R3||a instanceof D3||a instanceof O3||bm&&a instanceof bm?k.texSubImage2D(k.TEXTURE_2D,0,X,Y,k.RGBA,k.UNSIGNED_BYTE,a):k.texSubImage2D(k.TEXTURE_2D,0,X,Y,x,B,k.RGBA,k.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&k.generateMipmap(k.TEXTURE_2D)},Oh.prototype.bind=function(a,u,p){var x=this.context.gl;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||a),this.filter=a),u!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,u),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrap=u)},Oh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Oh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var T_=function(a){var u=this;this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};T_.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},T_.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ed=function(a,u,p){this.target=a,this.parent=u,this.mapId=p,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},zt(["receive","process"],this),this.invoker=new T_(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ct()?a:S};function L3(a,u,p){var x=2*Math.PI*6378137/256/Math.pow(2,p);return[a*x-2*Math.PI*6378137/2,u*x-2*Math.PI*6378137/2]}ed.prototype.send=function(a,u,p,x,B){var I=this;B===void 0&&(B=!1);var D=Math.round(1e18*Math.random()).toString(36).substring(0,10);p&&(this.callbacks[D]=p);var k=Zt(this.globalScope)?void 0:[];return this.target.postMessage({id:D,type:a,hasCallback:!!p,targetMapId:x,mustQueue:B,sourceMapId:this.mapId,data:os(u,k)},k),{cancel:function(){p&&delete I.callbacks[D],I.target.postMessage({id:D,type:"<cancel>",targetMapId:x,sourceMapId:I.mapId})}}},ed.prototype.receive=function(a){var u=a.data,p=u.id;if(p&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[p];var x=this.cancelCallbacks[p];delete this.cancelCallbacks[p],x&&x()}else Ct()||u.mustQueue?(this.tasks[p]=u,this.taskQueue.push(p),this.invoker.trigger()):this.processTask(p,u)},ed.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),u=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(a,u)}},ed.prototype.processTask=function(a,u){var p=this;if(u.type==="<response>"){var x=this.callbacks[a];delete this.callbacks[a],x&&(u.error?x(yo(u.error)):x(null,yo(u.data)))}else{var B=!1,I=Zt(this.globalScope)?void 0:[],D=u.hasCallback?function(Y,rt){B=!0,delete p.cancelCallbacks[a],p.target.postMessage({id:a,type:"<response>",sourceMapId:p.mapId,error:Y?os(Y):null,data:os(rt,I)},I)}:function(Y){B=!0},k=null,G=yo(u.data);if(this.parent[u.type])k=this.parent[u.type](u.sourceMapId,G,D);else if(this.parent.getWorkerSource){var X=u.type.split(".");k=this.parent.getWorkerSource(u.sourceMapId,X[0],G.source)[X[1]](G,D)}else D(new Error("Could not find function "+u.type));!B&&k&&k.cancel&&(this.cancelCallbacks[a]=k.cancel)}},ed.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var jr=function(a,u){a&&(u?this.setSouthWest(a).setNorthEast(u):a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))};jr.prototype.setNorthEast=function(a){return this._ne=a instanceof nr?new nr(a.lng,a.lat):nr.convert(a),this},jr.prototype.setSouthWest=function(a){return this._sw=a instanceof nr?new nr(a.lng,a.lat):nr.convert(a),this},jr.prototype.extend=function(a){var u,p,x=this._sw,B=this._ne;if(a instanceof nr)u=a,p=a;else{if(!(a instanceof jr))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(jr.convert(a)):this.extend(nr.convert(a)):this;if(p=a._ne,!(u=a._sw)||!p)return this}return x||B?(x.lng=Math.min(u.lng,x.lng),x.lat=Math.min(u.lat,x.lat),B.lng=Math.max(p.lng,B.lng),B.lat=Math.max(p.lat,B.lat)):(this._sw=new nr(u.lng,u.lat),this._ne=new nr(p.lng,p.lat)),this},jr.prototype.getCenter=function(){return new nr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},jr.prototype.getSouthWest=function(){return this._sw},jr.prototype.getNorthEast=function(){return this._ne},jr.prototype.getNorthWest=function(){return new nr(this.getWest(),this.getNorth())},jr.prototype.getSouthEast=function(){return new nr(this.getEast(),this.getSouth())},jr.prototype.getWest=function(){return this._sw.lng},jr.prototype.getSouth=function(){return this._sw.lat},jr.prototype.getEast=function(){return this._ne.lng},jr.prototype.getNorth=function(){return this._ne.lat},jr.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},jr.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},jr.prototype.isEmpty=function(){return!(this._sw&&this._ne)},jr.prototype.contains=function(a){var u=nr.convert(a),p=u.lng,x=u.lat,B=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(B=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=x&&x<=this._ne.lat&&B},jr.convert=function(a){return!a||a instanceof jr?a:new jr(a)};var nr=function(a,u){if(isNaN(a)||isNaN(u))throw new Error("Invalid LngLat object: ("+a+", "+u+")");if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};nr.prototype.wrap=function(){return new nr(j(this.lng,-180,180),this.lat)},nr.prototype.toArray=function(){return[this.lng,this.lat]},nr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},nr.prototype.distanceTo=function(a){var u=Math.PI/180,p=this.lat*u,x=a.lat*u,B=Math.sin(p)*Math.sin(x)+Math.cos(p)*Math.cos(x)*Math.cos((a.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(B,1))},nr.prototype.toBounds=function(a){a===void 0&&(a=0);var u=360*a/40075017,p=u/Math.cos(Math.PI/180*this.lat);return new jr(new nr(this.lng-p,this.lat-u),new nr(this.lng+p,this.lat+u))},nr.convert=function(a){if(a instanceof nr)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new nr(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new nr(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var F3=2*Math.PI*63710088e-1;function k3(a){return F3*Math.cos(a*Math.PI/180)}function N3(a){return(180+a)/360}function U3(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function z3(a,u){return a/k3(u)}function S_(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var Lh=function(a,u,p){p===void 0&&(p=0),this.x=+a,this.y=+u,this.z=+p};Lh.fromLngLat=function(a,u){u===void 0&&(u=0);var p=nr.convert(a);return new Lh(N3(p.lng),U3(p.lat),z3(u,p.lat))},Lh.prototype.toLngLat=function(){return new nr(360*this.x-180,S_(this.y))},Lh.prototype.toAltitude=function(){return this.z*k3(S_(this.y))},Lh.prototype.meterInMercatorCoordinateUnits=function(){return 1/F3*(a=S_(this.y),1/Math.cos(a*Math.PI/180));var a};var Fh=function(a,u,p){this.z=a,this.x=u,this.y=p,this.key=xA(0,a,a,u,p)};Fh.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Fh.prototype.url=function(a,u){var p,x,B,I,D,k=(x=this.y,B=this.z,I=L3(256*(p=this.x),256*(x=Math.pow(2,B)-x-1),B),D=L3(256*(p+1),256*(x+1),B),I[0]+","+I[1]+","+D[0]+","+D[1]),G=function(X,Y,rt){for(var ht,yt="",Ft=X;Ft>0;Ft--)yt+=(Y&(ht=1<<Ft-1)?1:0)+(rt&ht?2:0);return yt}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",G).replace("{bbox-epsg-3857}",k)},Fh.prototype.getTilePoint=function(a){var u=Math.pow(2,this.z);return new _(8192*(a.x*u-this.x),8192*(a.y*u-this.y))},Fh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var G3=function(a,u){this.wrap=a,this.canonical=u,this.key=xA(a,u.z,u.z,u.x,u.y)},Vr=function(a,u,p,x,B){this.overscaledZ=a,this.wrap=u,this.canonical=new Fh(p,+x,+B),this.key=xA(u,a,p,x,B)};function xA(a,u,p,x,B){(a*=2)<0&&(a=-1*a-1);var I=1<<p;return(I*I*a+I*B+x).toString(36)+p.toString(36)+u.toString(36)}Vr.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},Vr.prototype.scaledTo=function(a){var u=this.canonical.z-a;return a>this.canonical.z?new Vr(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vr(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)},Vr.prototype.calculateScaledKey=function(a,u){var p=this.canonical.z-a;return a>this.canonical.z?xA(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):xA(this.wrap*+u,a,a,this.canonical.x>>p,this.canonical.y>>p)},Vr.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u},Vr.prototype.children=function(a){if(this.overscaledZ>=a)return[new Vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,p=2*this.canonical.x,x=2*this.canonical.y;return[new Vr(u,this.wrap,u,p,x),new Vr(u,this.wrap,u,p+1,x),new Vr(u,this.wrap,u,p,x+1),new Vr(u,this.wrap,u,p+1,x+1)]},Vr.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},Vr.prototype.wrapped=function(){return new Vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Vr.prototype.unwrapTo=function(a){return new Vr(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},Vr.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Vr.prototype.toUnwrapped=function(){return new G3(this.wrap,this.canonical)},Vr.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Vr.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new Lh(a.x-this.wrap,a.y))},si("CanonicalTileID",Fh),si("OverscaledTileID",Vr,{omit:["posMatrix"]});var Nl=function(a,u,p){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return ut('"'+p+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var x=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=p||"mapbox";for(var B=0;B<x;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(x,B)]=this.data[this._idx(x-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,x)]=this.data[this._idx(B,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)]};Nl.prototype.get=function(a,u){var p=new Uint8Array(this.data.buffer),x=4*this._idx(a,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[x],p[x+1],p[x+2])},Nl.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Nl.prototype._idx=function(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)},Nl.prototype._unpackMapbox=function(a,u,p){return(256*a*256+256*u+p)/10-1e4},Nl.prototype._unpackTerrarium=function(a,u,p){return 256*a+u+p/256-32768},Nl.prototype.getPixels=function(){return new hs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Nl.prototype.backfillBorder=function(a,u,p){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var x=u*this.dim,B=u*this.dim+this.dim,I=p*this.dim,D=p*this.dim+this.dim;switch(u){case-1:x=B-1;break;case 1:B=x+1}switch(p){case-1:I=D-1;break;case 1:D=I+1}for(var k=-u*this.dim,G=-p*this.dim,X=I;X<D;X++)for(var Y=x;Y<B;Y++)this.data[this._idx(Y,X)]=a.data[this._idx(Y+k,X+G)]},si("DEMData",Nl);var xm=function(a){this._stringToNumber={},this._numberToString=[];for(var u=0;u<a.length;u++){var p=a[u];this._stringToNumber[p]=u,this._numberToString[u]=p}};xm.prototype.encode=function(a){return this._stringToNumber[a]},xm.prototype.decode=function(a){return this._numberToString[a]};var wm=function(a,u,p,x,B){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=p,a._y=x,this.properties=a.properties,this.id=B},I_={geometry:{configurable:!0}};I_.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},I_.geometry.set=function(a){this._geometry=a},wm.prototype.toJSON=function(){var a={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a},Object.defineProperties(wm.prototype,I_);var id=function(){this.state={},this.stateChanges={},this.deletedStates={}};id.prototype.updateState=function(a,u,p){var x=String(u);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][x]=this.stateChanges[a][x]||{},tt(this.stateChanges[a][x],p),this.deletedStates[a]===null)for(var B in this.deletedStates[a]={},this.state[a])B!==x&&(this.deletedStates[a][B]=null);else if(this.deletedStates[a]&&this.deletedStates[a][x]===null)for(var I in this.deletedStates[a][x]={},this.state[a][x])p[I]||(this.deletedStates[a][x][I]=null);else for(var D in p)this.deletedStates[a]&&this.deletedStates[a][x]&&this.deletedStates[a][x][D]===null&&delete this.deletedStates[a][x][D]},id.prototype.removeFeatureState=function(a,u,p){if(this.deletedStates[a]!==null){var x=String(u);if(this.deletedStates[a]=this.deletedStates[a]||{},p&&u!==void 0)this.deletedStates[a][x]!==null&&(this.deletedStates[a][x]=this.deletedStates[a][x]||{},this.deletedStates[a][x][p]=null);else if(u!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][x])for(p in this.deletedStates[a][x]={},this.stateChanges[a][x])this.deletedStates[a][x][p]=null;else this.deletedStates[a][x]=null;else this.deletedStates[a]=null}},id.prototype.getState=function(a,u){var p=String(u),x=tt({},(this.state[a]||{})[p],(this.stateChanges[a]||{})[p]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var B=this.deletedStates[a][u];if(B===null)return{};for(var I in B)delete x[I]}return x},id.prototype.initializeTileState=function(a,u){a.setFeatureState(this.state,u)},id.prototype.coalesceChanges=function(a,u){var p={};for(var x in this.stateChanges){this.state[x]=this.state[x]||{};var B={};for(var I in this.stateChanges[x])this.state[x][I]||(this.state[x][I]={}),tt(this.state[x][I],this.stateChanges[x][I]),B[I]=this.state[x][I];p[x]=B}for(var D in this.deletedStates){this.state[D]=this.state[D]||{};var k={};if(this.deletedStates[D]===null)for(var G in this.state[D])k[G]={},this.state[D][G]={};else for(var X in this.deletedStates[D]){if(this.deletedStates[D][X]===null)this.state[D][X]={};else for(var Y=0,rt=Object.keys(this.deletedStates[D][X]);Y<rt.length;Y+=1)delete this.state[D][X][rt[Y]];k[X]=this.state[D][X]}p[D]=p[D]||{},tt(p[D],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(var ht in a)a[ht].setFeatureState(p,u)};var Ul=function(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Ds(8192,16,0),this.grid3D=new Ds(8192,16,0),this.featureIndexArray=new W,this.promoteId=u};function j3(a,u,p,x,B){return dt(a,function(I,D){var k=u instanceof Dl?u.get(D):null;return k&&k.evaluate?k.evaluate(p,x,B):k})}function V3(a){for(var u=1/0,p=1/0,x=-1/0,B=-1/0,I=0,D=a;I<D.length;I+=1){var k=D[I];u=Math.min(u,k.x),p=Math.min(p,k.y),x=Math.max(x,k.x),B=Math.max(B,k.y)}return{minX:u,minY:p,maxX:x,maxY:B}}function XN(a,u){return u-a}Ul.prototype.insert=function(a,u,p,x,B,I){var D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,x,B);for(var k=I?this.grid3D:this.grid,G=0;G<u.length;G++){for(var X=u[G],Y=[1/0,1/0,-1/0,-1/0],rt=0;rt<X.length;rt++){var ht=X[rt];Y[0]=Math.min(Y[0],ht.x),Y[1]=Math.min(Y[1],ht.y),Y[2]=Math.max(Y[2],ht.x),Y[3]=Math.max(Y[3],ht.y)}Y[0]<8192&&Y[1]<8192&&Y[2]>=0&&Y[3]>=0&&k.insert(D,Y[0],Y[1],Y[2],Y[3])}},Ul.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Xf.VectorTile(new hm(this.rawTileData)).layers,this.sourceLayerCoder=new xm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ul.prototype.query=function(a,u,p,x){var B=this;this.loadVTLayers();for(var I=a.params||{},D=8192/a.tileSize/a.scale,k=mu(I.filter),G=a.queryGeometry,X=a.queryPadding*D,Y=V3(G),rt=this.grid.query(Y.minX-X,Y.minY-X,Y.maxX+X,Y.maxY+X),ht=V3(a.cameraQueryGeometry),yt=this.grid3D.query(ht.minX-X,ht.minY-X,ht.maxX+X,ht.maxY+X,function(ge,ye,De,We){return function(Ze,_i,ni,Bi,ri){for(var on=0,Li=Ze;on<Li.length;on+=1){var fi=Li[on];if(_i<=fi.x&&ni<=fi.y&&Bi>=fi.x&&ri>=fi.y)return!0}var fn=[new _(_i,ni),new _(_i,ri),new _(Bi,ri),new _(Bi,ni)];if(Ze.length>2){for(var qi=0,bn=fn;qi<bn.length;qi+=1)if(Ma(Ze,bn[qi]))return!0}for(var Ti=0;Ti<Ze.length-1;Ti++)if(Ph(Ze[Ti],Ze[Ti+1],fn))return!0;return!1}(a.cameraQueryGeometry,ge-X,ye-X,De+X,We+X)}),Ft=0,kt=yt;Ft<kt.length;Ft+=1)rt.push(kt[Ft]);rt.sort(XN);for(var Ht,jt={},qt=function(ge){var ye=rt[ge];if(ye!==Ht){Ht=ye;var De=B.featureIndexArray.get(ye),We=null;B.loadMatchingFeature(jt,De.bucketIndex,De.sourceLayerIndex,De.featureIndex,k,I.layers,I.availableImages,u,p,x,function(Ze,_i,ni){return We||(We=br(Ze)),_i.queryIntersectsFeature(G,Ze,ni,We,B.z,a.transform,D,a.pixelPosMatrix)})}},ae=0;ae<rt.length;ae++)qt(ae);return jt},Ul.prototype.loadMatchingFeature=function(a,u,p,x,B,I,D,k,G,X,Y){var rt=this.bucketLayerIDs[u];if(!I||function(Ze,_i){for(var ni=0;ni<Ze.length;ni++)if(_i.indexOf(Ze[ni])>=0)return!0;return!1}(I,rt)){var ht=this.sourceLayerCoder.decode(p),yt=this.vtLayers[ht].feature(x);if(B.needGeometry){var Ft=Pr(yt,!0);if(!B.filter(new Vi(this.tileID.overscaledZ),Ft,this.tileID.canonical))return}else if(!B.filter(new Vi(this.tileID.overscaledZ),yt))return;for(var kt=this.getId(yt,ht),Ht=0;Ht<rt.length;Ht++){var jt=rt[Ht];if(!(I&&I.indexOf(jt)<0)){var qt=k[jt];if(qt){var ae={};kt!==void 0&&X&&(ae=X.getState(qt.sourceLayer||"_geojsonTileLayer",kt));var ge=tt({},G[jt]);ge.paint=j3(ge.paint,qt.paint,yt,ae,D),ge.layout=j3(ge.layout,qt.layout,yt,ae,D);var ye=!Y||Y(yt,qt,ae);if(ye){var De=new wm(yt,this.z,this.x,this.y,kt);De.layer=ge;var We=a[jt];We===void 0&&(We=a[jt]=[]),We.push({featureIndex:x,feature:De,intersectionZ:ye})}}}}}},Ul.prototype.lookupSymbolFeatures=function(a,u,p,x,B,I,D,k){var G={};this.loadVTLayers();for(var X=mu(B),Y=0,rt=a;Y<rt.length;Y+=1)this.loadMatchingFeature(G,p,x,rt[Y],X,I,D,k,u);return G},Ul.prototype.hasLayer=function(a){for(var u=0,p=this.bucketLayerIDs;u<p.length;u+=1)for(var x=0,B=p[u];x<B.length;x+=1)if(a===B[x])return!0;return!1},Ul.prototype.getId=function(a,u){var p=a.id;return this.promoteId&&typeof(p=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(p=Number(p)),p},si("FeatureIndex",Ul,{omit:["rawTileData","sourceLayerCoder"]});var so=function(a,u){this.tileID=a,this.uid=Q(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};so.prototype.registerFadeDuration=function(a){var u=a+this.timeAdded;u<qe.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},so.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},so.prototype.loadVectorData=function(a,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var x in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(X,Y){var rt={};if(!Y)return rt;for(var ht=function(){var kt=Ft[yt],Ht=kt.layerIds.map(function(ae){return Y.getLayer(ae)}).filter(Boolean);if(Ht.length!==0){kt.layers=Ht,kt.stateDependentLayerIds&&(kt.stateDependentLayers=kt.stateDependentLayerIds.map(function(ae){return Ht.filter(function(ge){return ge.id===ae})[0]}));for(var jt=0,qt=Ht;jt<qt.length;jt+=1)rt[qt[jt].id]=kt}},yt=0,Ft=X;yt<Ft.length;yt+=1)ht();return rt}(a.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var B=this.buckets[x];if(B instanceof On){if(this.hasSymbolBuckets=!0,!p)break;B.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var I in this.buckets){var D=this.buckets[I];if(D instanceof On&&D.hasRTLText){this.hasRTLText=!0,io.isLoading()||io.isLoaded()||Th()!=="deferred"||Cs();break}}for(var k in this.queryPadding=0,this.buckets){var G=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(k).queryRadius(G))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new d},so.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},so.prototype.getBucket=function(a){return this.buckets[a.id]},so.prototype.upload=function(a){for(var u in this.buckets){var p=this.buckets[u];p.uploadPending()&&p.upload(a)}var x=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Oh(a,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Oh(a,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)},so.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},so.prototype.queryRenderedFeatures=function(a,u,p,x,B,I,D,k,G,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:B,scale:I,tileSize:this.tileSize,pixelPosMatrix:X,transform:k,params:D,queryPadding:this.queryPadding*G},a,u,p):{}},so.prototype.querySourceFeatures=function(a,u){var p=this.latestFeatureIndex;if(p&&p.rawTileData){var x=p.loadVTLayers(),B=u?u.sourceLayer:"",I=x._geojsonTileLayer||x[B];if(I)for(var D=mu(u&&u.filter),k=this.tileID.canonical,G=k.z,X=k.x,Y=k.y,rt={z:G,x:X,y:Y},ht=0;ht<I.length;ht++){var yt=I.feature(ht);if(D.needGeometry){var Ft=Pr(yt,!0);if(!D.filter(new Vi(this.tileID.overscaledZ),Ft,this.tileID.canonical))continue}else if(!D.filter(new Vi(this.tileID.overscaledZ),yt))continue;var kt=p.getId(yt,B),Ht=new wm(yt,G,X,Y,kt);Ht.tile=rt,a.push(Ht)}}},so.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},so.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},so.prototype.setExpiryData=function(a){var u=this.expirationTime;if(a.cacheControl){var p=Rt(a.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var x=Date.now(),B=!1;if(this.expirationTime>x)B=!1;else if(u)if(this.expirationTime<u)B=!0;else{var I=this.expirationTime-u;I?this.expirationTime=x+Math.max(I,3e4):B=!0}else B=!0;B?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},so.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},so.prototype.setFeatureState=function(a,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var p=this.latestFeatureIndex.loadVTLayers();for(var x in this.buckets)if(u.style.hasLayer(x)){var B=this.buckets[x],I=B.layers[0].sourceLayer||"_geojsonTileLayer",D=p[I],k=a[I];if(D&&k&&Object.keys(k).length!==0){B.update(k,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});var G=u&&u.style&&u.style.getLayer(x);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(B)))}}}},so.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},so.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<qe.now()},so.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},so.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=qe.now()+a},so.prototype.setDependencies=function(a,u){for(var p={},x=0,B=u;x<B.length;x+=1)p[B[x]]=!0;this.dependencies[a]=p},so.prototype.hasDependency=function(a,u){for(var p=0,x=a;p<x.length;p+=1){var B=this.dependencies[x[p]];if(B){for(var I=0,D=u;I<D.length;I+=1)if(B[D[I]])return!0}}return!1};var Pu=S.performance,H3=function(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},Pu.mark(this._marks.start)};H3.prototype.finish=function(){Pu.mark(this._marks.end);var a=Pu.getEntriesByName(this._marks.measure);return a.length===0&&(Pu.measure(this._marks.measure,this._marks.start,this._marks.end),a=Pu.getEntriesByName(this._marks.measure),Pu.clearMarks(this._marks.start),Pu.clearMarks(this._marks.end),Pu.clearMeasures(this._marks.measure)),a},o.Actor=ed,o.AlphaImage=Dh,o.CanonicalTileID=Fh,o.CollisionBoxArray=d,o.Color=en,o.DEMData=Nl,o.DataConstantProperty=xi,o.DictionaryCoder=xm,o.EXTENT=8192,o.ErrorEvent=ft,o.EvaluationParameters=Vi,o.Event=Ot,o.Evented=_t,o.FeatureIndex=Ul,o.FillBucket=sc,o.FillExtrusionBucket=ac,o.ImageAtlas=_A,o.ImagePosition=dm,o.LineBucket=qo,o.LngLat=nr,o.LngLatBounds=jr,o.MercatorCoordinate=Lh,o.ONE_EM=24,o.OverscaledTileID=Vr,o.Point=_,o.Point$1=_,o.Properties=Qn,o.Protobuf=hm,o.RGBAImage=hs,o.RequestManager=yi,o.RequestPerformance=H3,o.ResourceType=ze,o.SegmentVector=Z,o.SourceFeatureState=id,o.StructArrayLayout1ui2=M,o.StructArrayLayout2f1f2i16=Ls,o.StructArrayLayout2i4=Xo,o.StructArrayLayout3ui6=oa,o.StructArrayLayout4i8=Sh,o.SymbolBucket=On,o.Texture=Oh,o.Tile=so,o.Transitionable=Jr,o.Uniform1f=Oe,o.Uniform1i=pe,o.Uniform2f=xe,o.Uniform3f=Ue,o.Uniform4f=oi,o.UniformColor=Ei,o.UniformMatrix4f=xn,o.UnwrappedTileID=G3,o.ValidationError=wt,o.WritingMode=ks,o.ZoomHistory=wh,o.add=function(a,u,p){return a[0]=u[0]+p[0],a[1]=u[1]+p[1],a[2]=u[2]+p[2],a},o.addDynamicAttributes=E_,o.asyncAll=function(a,u,p){if(!a.length)return p(null,[]);var x=a.length,B=new Array(a.length),I=null;a.forEach(function(D,k){u(D,function(G,X){G&&(I=G),B[k]=X,--x==0&&p(I,B)})})},o.bezier=N,o.bindAll=zt,o.browser=qe,o.cacheEntryPossiblyAdded=function(a){++Re>ke&&(a.getActor().send("enforceCacheSizeLimit",St),Re=0)},o.clamp=H,o.clearTileCache=function(a){var u=S.caches.delete("mapbox-tiles");a&&u.catch(a).then(function(){return a()})},o.clipLine=E3,o.clone=function(a){var u=new Bn(16);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u},o.clone$1=Lt,o.clone$2=function(a){var u=new Bn(3);return u[0]=a[0],u[1]=a[1],u[2]=a[2],u},o.collisionCircleLayout=fN,o.config=Ve,o.create=function(){var a=new Bn(16);return Bn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},o.create$1=function(){var a=new Bn(9);return Bn!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},o.create$2=function(){var a=new Bn(4);return Bn!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.createCommonjsModule=c,o.createExpression=Au,o.createLayout=kr,o.createStyleLayer=function(a){return a.type==="custom"?new WN(a):new JN[a.type](a)},o.cross=function(a,u,p){var x=u[0],B=u[1],I=u[2],D=p[0],k=p[1],G=p[2];return a[0]=B*G-I*k,a[1]=I*D-x*G,a[2]=x*k-B*D,a},o.deepEqual=function a(u,p){if(Array.isArray(u)){if(!Array.isArray(p)||u.length!==p.length)return!1;for(var x=0;x<u.length;x++)if(!a(u[x],p[x]))return!1;return!0}if(typeof u=="object"&&u!==null&&p!==null){if(typeof p!="object"||Object.keys(u).length!==Object.keys(p).length)return!1;for(var B in u)if(!a(u[B],p[B]))return!1;return!0}return u===p},o.dot=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]},o.dot$1=function(a,u){return a[0]*u[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]},o.ease=U,o.emitValidationErrors=Rl,o.endsWith=Gt,o.enforceCacheSizeLimit=function(a){Je(),Tn&&Tn.then(function(u){u.keys().then(function(p){for(var x=0;x<p.length-a;x++)u.delete(p[x])})})},o.evaluateSizeForFeature=v3,o.evaluateSizeForZoom=_3,o.evaluateVariableOffset=S3,o.evented=Br,o.extend=tt,o.featureFilter=mu,o.filterObject=lt,o.fromRotation=function(a,u){var p=Math.sin(u),x=Math.cos(u);return a[0]=x,a[1]=p,a[2]=0,a[3]=-p,a[4]=x,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.getAnchorAlignment=b_,o.getAnchorJustification=C_,o.getArrayBuffer=Xt,o.getImage=nt,o.getJSON=function(a,u){return xt(tt(a,{type:"json"}),u)},o.getRTLTextPluginStatus=Th,o.getReferrer=V,o.getVideo=function(a,u){var p,x,B=S.document.createElement("video");B.muted=!0,B.onloadstart=function(){u(null,B)};for(var I=0;I<a.length;I++){var D=S.document.createElement("source");p=a[I],x=void 0,(x=S.document.createElement("a")).href=p,(x.protocol!==S.document.location.protocol||x.host!==S.document.location.host)&&(B.crossOrigin="Anonymous"),D.src=a[I],B.appendChild(D)}return{cancel:function(){}}},o.identity=Ts,o.invert=function(a,u){var p=u[0],x=u[1],B=u[2],I=u[3],D=u[4],k=u[5],G=u[6],X=u[7],Y=u[8],rt=u[9],ht=u[10],yt=u[11],Ft=u[12],kt=u[13],Ht=u[14],jt=u[15],qt=p*k-x*D,ae=p*G-B*D,ge=p*X-I*D,ye=x*G-B*k,De=x*X-I*k,We=B*X-I*G,Ze=Y*kt-rt*Ft,_i=Y*Ht-ht*Ft,ni=Y*jt-yt*Ft,Bi=rt*Ht-ht*kt,ri=rt*jt-yt*kt,on=ht*jt-yt*Ht,Li=qt*on-ae*ri+ge*Bi+ye*ni-De*_i+We*Ze;return Li?(a[0]=(k*on-G*ri+X*Bi)*(Li=1/Li),a[1]=(B*ri-x*on-I*Bi)*Li,a[2]=(kt*We-Ht*De+jt*ye)*Li,a[3]=(ht*De-rt*We-yt*ye)*Li,a[4]=(G*ni-D*on-X*_i)*Li,a[5]=(p*on-B*ni+I*_i)*Li,a[6]=(Ht*ge-Ft*We-jt*ae)*Li,a[7]=(Y*We-ht*ge+yt*ae)*Li,a[8]=(D*ri-k*ni+X*Ze)*Li,a[9]=(x*ni-p*ri-I*Ze)*Li,a[10]=(Ft*De-kt*ge+jt*qt)*Li,a[11]=(rt*ge-Y*De-yt*qt)*Li,a[12]=(k*_i-D*Bi-G*Ze)*Li,a[13]=(p*Bi-x*_i+B*Ze)*Li,a[14]=(kt*ae-Ft*ye-Ht*qt)*Li,a[15]=(Y*ye-rt*ae+ht*qt)*Li,a):null},o.isChar=Ye,o.isMapboxURL=vi,o.keysDifference=function(a,u){var p=[];for(var x in a)x in u||p.push(x);return p},o.makeRequest=xt,o.mapObject=dt,o.mercatorXfromLng=N3,o.mercatorYfromLat=U3,o.mercatorZfromAltitude=z3,o.mul=l_,o.multiply=Ko,o.mvt=Xf,o.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},o.normalize=function(a,u){var p=u[0],x=u[1],B=u[2],I=p*p+x*x+B*B;return I>0&&(I=1/Math.sqrt(I)),a[0]=u[0]*I,a[1]=u[1]*I,a[2]=u[2]*I,a},o.number=fr,o.offscreenCanvasSupported=gt,o.ortho=function(a,u,p,x,B,I,D){var k=1/(u-p),G=1/(x-B),X=1/(I-D);return a[0]=-2*k,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*G,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*X,a[11]=0,a[12]=(u+p)*k,a[13]=(B+x)*G,a[14]=(D+I)*X,a[15]=1,a},o.parseGlyphPBF=function(a){return new hm(a).readFields(CN,[])},o.pbf=hm,o.performSymbolLayout=function(a,u,p,x,B,I,D){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var k=a.layers[0].layout,G=a.layers[0]._unevaluatedLayout._values,X={};if(a.textSizeData.kind==="composite"){var Y=a.textSizeData,rt=Y.maxZoom;X.compositeTextSizes=[G["text-size"].possiblyEvaluate(new Vi(Y.minZoom),D),G["text-size"].possiblyEvaluate(new Vi(rt),D)]}if(a.iconSizeData.kind==="composite"){var ht=a.iconSizeData,yt=ht.maxZoom;X.compositeIconSizes=[G["icon-size"].possiblyEvaluate(new Vi(ht.minZoom),D),G["icon-size"].possiblyEvaluate(new Vi(yt),D)]}X.layoutTextSize=G["text-size"].possiblyEvaluate(new Vi(a.zoom+1),D),X.layoutIconSize=G["icon-size"].possiblyEvaluate(new Vi(a.zoom+1),D),X.textMaxSize=G["text-size"].possiblyEvaluate(new Vi(18));for(var Ft=24*k.get("text-line-height"),kt=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Ht=k.get("text-keep-upright"),jt=k.get("text-size"),qt=function(){var ye=ge[ae],De=k.get("text-font").evaluate(ye,{},D).join(","),We=jt.evaluate(ye,{},D),Ze=X.layoutTextSize.evaluate(ye,{},D),_i=X.layoutIconSize.evaluate(ye,{},D),ni={horizontal:{},vertical:void 0},Bi=ye.text,ri=[0,0];if(Bi){var on=Bi.toString(),Li=24*k.get("text-letter-spacing").evaluate(ye,{},D),fi=function(gn){for(var Un=0,Mn=gn;Un<Mn.length;Un+=1)if(wn=Mn[Un].charCodeAt(0),Ye.Arabic(wn)||Ye["Arabic Supplement"](wn)||Ye["Arabic Extended-A"](wn)||Ye["Arabic Presentation Forms-A"](wn)||Ye["Arabic Presentation Forms-B"](wn))return!1;var wn;return!0}(on)?Li:0,fn=k.get("text-anchor").evaluate(ye,{},D),qi=k.get("text-variable-anchor");if(!qi){var bn=k.get("text-radial-offset").evaluate(ye,{},D);ri=bn?S3(fn,[24*bn,w_]):k.get("text-offset").evaluate(ye,{},D).map(function(gn){return 24*gn})}var Ti=kt?"center":k.get("text-justify").evaluate(ye,{},D),Cn=k.get("symbol-placement"),rr=Cn==="point"?24*k.get("text-max-width").evaluate(ye,{},D):0,Sr=function(){a.allowVerticalPlacement&&Ch(on)&&(ni.vertical=pm(Bi,u,p,B,De,rr,Ft,fn,"left",fi,ri,ks.vertical,!0,Cn,Ze,We))};if(!kt&&qi){for(var xr=Ti==="auto"?qi.map(function(gn){return C_(gn)}):[Ti],or=!1,Ir=0;Ir<xr.length;Ir++){var qr=xr[Ir];if(!ni.horizontal[qr])if(or)ni.horizontal[qr]=ni.horizontal[0];else{var Zr=pm(Bi,u,p,B,De,rr,Ft,"center",qr,fi,ri,ks.horizontal,!1,Cn,Ze,We);Zr&&(ni.horizontal[qr]=Zr,or=Zr.positionedLines.length===1)}}Sr()}else{Ti==="auto"&&(Ti=C_(fn));var Oo=pm(Bi,u,p,B,De,rr,Ft,fn,Ti,fi,ri,ks.horizontal,!1,Cn,Ze,We);Oo&&(ni.horizontal[Ti]=Oo),Sr(),Ch(on)&&kt&&Ht&&(ni.vertical=pm(Bi,u,p,B,De,rr,Ft,fn,Ti,fi,ri,ks.vertical,!1,Cn,Ze,We))}}var ao=void 0,Lo=!1;if(ye.icon&&ye.icon.name){var Rr=x[ye.icon.name];Rr&&(ao=function(gn,Un,Mn){var wn=b_(Mn),Zo=Un[0]-gn.displaySize[0]*wn.horizontalAlign,bo=Un[1]-gn.displaySize[1]*wn.verticalAlign;return{image:gn,top:bo,bottom:bo+gn.displaySize[1],left:Zo,right:Zo+gn.displaySize[0]}}(B[ye.icon.name],k.get("icon-offset").evaluate(ye,{},D),k.get("icon-anchor").evaluate(ye,{},D)),Lo=Rr.sdf,a.sdfIcons===void 0?a.sdfIcons=Rr.sdf:a.sdfIcons!==Rr.sdf&&ut("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Rr.pixelRatio!==a.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var co=M3(ni.horizontal)||ni.vertical;a.iconsInText=!!co&&co.iconsInText,(co||ao)&&function(gn,Un,Mn,wn,Zo,bo,tr,Nr,xo,En,Jc){var Ns=bo.textMaxSize.evaluate(Un,{});Ns===void 0&&(Ns=tr);var Xc,Dr=gn.layers[0].layout,Qc=Dr.get("icon-offset").evaluate(Un,{},Jc),Ra=M3(Mn.horizontal),nd=tr/24,kh=gn.tilePixelRatio*nd,rd=gn.tilePixelRatio*Ns/24,zl=gn.tilePixelRatio*Nr,od=gn.tilePixelRatio*Dr.get("symbol-spacing"),Cm=Dr.get("text-padding")*gn.tilePixelRatio,sd=Dr.get("icon-padding")*gn.tilePixelRatio,wA=Dr.get("text-max-angle")/180*Math.PI,Em=Dr.get("text-rotation-alignment")==="map"&&Dr.get("symbol-placement")!=="point",Bm=Dr.get("icon-rotation-alignment")==="map"&&Dr.get("symbol-placement")!=="point",Gl=Dr.get("symbol-placement"),CA=od/2,ad=Dr.get("icon-text-fit");wn&&ad!=="none"&&(gn.allowVerticalPlacement&&Mn.vertical&&(Xc=y3(wn,Mn.vertical,ad,Dr.get("icon-text-fit-padding"),Qc,nd)),Ra&&(wn=y3(wn,Ra,ad,Dr.get("icon-text-fit-padding"),Qc,nd)));var Ru=function(QN,RA){RA.x<0||RA.x>=8192||RA.y<0||RA.y>=8192||function(Or,cc,KN,Du,D_,X3,Rm,Kc,Dm,DA,Om,Lm,O_,Q3,OA,K3,q3,Z3,Y3,$3,Us,Fm,tB,qc,qN){var eB,Uh,fd,dd,pd,Ad=Or.addToLineVertexArray(cc,KN),iB=0,nB=0,rB=0,oB=0,L_=-1,F_=-1,jl={},sB=mt(""),k_=0,N_=0;if(Kc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(k_=(eB=Kc.layout.get("text-offset").evaluate(Us,{},qc).map(function(FA){return 24*FA}))[0],N_=eB[1]):(k_=24*Kc.layout.get("text-radial-offset").evaluate(Us,{},qc),N_=w_),Or.allowVerticalPlacement&&Du.vertical){var aB=Kc.layout.get("text-rotate").evaluate(Us,{},qc)+90;dd=new vm(Dm,cc,DA,Om,Lm,Du.vertical,O_,Q3,OA,aB),Rm&&(pd=new vm(Dm,cc,DA,Om,Lm,Rm,q3,Z3,OA,aB))}if(D_){var U_=Kc.layout.get("icon-rotate").evaluate(Us,{}),cB=Kc.layout.get("icon-text-fit")!=="none",lB=B3(D_,U_,tB,cB),z_=Rm?B3(Rm,U_,tB,cB):void 0;fd=new vm(Dm,cc,DA,Om,Lm,D_,q3,Z3,!1,U_),iB=4*lB.length;var uB=Or.iconSizeData,LA=null;uB.kind==="source"?(LA=[128*Kc.layout.get("icon-size").evaluate(Us,{})])[0]>32640&&ut(Or.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):uB.kind==="composite"&&((LA=[128*Fm.compositeIconSizes[0].evaluate(Us,{},qc),128*Fm.compositeIconSizes[1].evaluate(Us,{},qc)])[0]>32640||LA[1]>32640)&&ut(Or.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Or.addSymbols(Or.icon,lB,LA,$3,Y3,Us,!1,cc,Ad.lineStartIndex,Ad.lineLength,-1,qc),L_=Or.icon.placedSymbolArray.length-1,z_&&(nB=4*z_.length,Or.addSymbols(Or.icon,z_,LA,$3,Y3,Us,ks.vertical,cc,Ad.lineStartIndex,Ad.lineLength,-1,qc),F_=Or.icon.placedSymbolArray.length-1)}for(var hB in Du.horizontal){var km=Du.horizontal[hB];if(!Uh){sB=mt(km.text);var ZN=Kc.layout.get("text-rotate").evaluate(Us,{},qc);Uh=new vm(Dm,cc,DA,Om,Lm,km,O_,Q3,OA,ZN)}var fB=km.positionedLines.length===1;if(rB+=I3(Or,cc,km,X3,Kc,OA,Us,K3,Ad,Du.vertical?ks.horizontal:ks.horizontalOnly,fB?Object.keys(Du.horizontal):[hB],jl,L_,Fm,qc),fB)break}Du.vertical&&(oB+=I3(Or,cc,Du.vertical,X3,Kc,OA,Us,K3,Ad,ks.vertical,["vertical"],jl,F_,Fm,qc));var YN=Uh?Uh.boxStartIndex:Or.collisionBoxArray.length,$N=Uh?Uh.boxEndIndex:Or.collisionBoxArray.length,tU=dd?dd.boxStartIndex:Or.collisionBoxArray.length,eU=dd?dd.boxEndIndex:Or.collisionBoxArray.length,iU=fd?fd.boxStartIndex:Or.collisionBoxArray.length,nU=fd?fd.boxEndIndex:Or.collisionBoxArray.length,rU=pd?pd.boxStartIndex:Or.collisionBoxArray.length,oU=pd?pd.boxEndIndex:Or.collisionBoxArray.length,Zc=-1,Nm=function(FA,pB){return FA&&FA.circleDiameter?Math.max(FA.circleDiameter,pB):pB};Zc=Nm(Uh,Zc),Zc=Nm(dd,Zc),Zc=Nm(fd,Zc);var dB=(Zc=Nm(pd,Zc))>-1?1:0;dB&&(Zc*=qN/24),Or.glyphOffsetArray.length>=On.MAX_GLYPHS&&ut("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Us.sortKey!==void 0&&Or.addToSortKeyRanges(Or.symbolInstances.length,Us.sortKey),Or.symbolInstances.emplaceBack(cc.x,cc.y,jl.right>=0?jl.right:-1,jl.center>=0?jl.center:-1,jl.left>=0?jl.left:-1,jl.vertical||-1,L_,F_,sB,YN,$N,tU,eU,iU,nU,rU,oU,DA,rB,oB,iB,nB,dB,0,O_,k_,N_,Zc)}(gn,RA,QN,Mn,wn,Zo,Xc,gn.layers[0],gn.collisionBoxArray,Un.index,Un.sourceLayerIndex,gn.index,kh,Cm,Em,xo,zl,sd,Bm,Qc,Un,bo,En,Jc,tr)};if(Gl==="line")for(var cd=0,Tm=E3(Un.geometry,0,0,8192,8192);cd<Tm.length;cd+=1)for(var Sm=Tm[cd],EA=0,BA=PN(Sm,od,wA,Mn.vertical||Ra,wn,24,rd,gn.overscaling,8192);EA<BA.length;EA+=1){var Im=BA[EA];Ra&&LN(gn,Ra.text,CA,Im)||Ru(Sm,Im)}else if(Gl==="line-center")for(var TA=0,SA=Un.geometry;TA<SA.length;TA+=1){var IA=SA[TA];if(IA.length>1){var Mm=MN(IA,wA,Mn.vertical||Ra,wn,24,rd);Mm&&Ru(IA,Mm)}}else if(Un.type==="Polygon")for(var ld=0,Pm=g_(Un.geometry,0);ld<Pm.length;ld+=1){var ud=Pm[ld],MA=DN(ud,16);Ru(ud[0],new qf(MA.x,MA.y,0))}else if(Un.type==="LineString")for(var Nh=0,PA=Un.geometry;Nh<PA.length;Nh+=1){var hd=PA[Nh];Ru(hd,new qf(hd[0].x,hd[0].y,0))}else if(Un.type==="Point")for(var M_=0,W3=Un.geometry;M_<W3.length;M_+=1)for(var P_=0,J3=W3[M_];P_<J3.length;P_+=1){var R_=J3[P_];Ru([R_],new qf(R_.x,R_.y,0))}}(a,ye,ni,ao,x,X,Ze,_i,ri,Lo,D)},ae=0,ge=a.features;ae<ge.length;ae+=1)qt();I&&a.generateCollisionDebugBuffers()},o.perspective=function(a,u,p,x,B){var I,D=1/Math.tan(u/2);return a[0]=D/p,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,B!=null&&B!==1/0?(a[10]=(B+x)*(I=1/(x-B)),a[14]=2*B*x*I):(a[10]=-1,a[14]=-2*x),a},o.pick=function(a,u){for(var p={},x=0;x<u.length;x++){var B=u[x];B in a&&(p[B]=a[B])}return p},o.plugin=io,o.polygonIntersectsPolygon=Vc,o.postMapLoadEvent=yr,o.postTurnstileEvent=Mi,o.potpack=p3,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=si,o.registerForPluginStateChange=function(a){return a({pluginStatus:Po,pluginURL:ea}),Br.on("pluginStateChange",a),a},o.renderColorRamp=KE,o.rotate=function(a,u,p){var x=u[0],B=u[1],I=u[2],D=u[3],k=Math.sin(p),G=Math.cos(p);return a[0]=x*G+I*k,a[1]=B*G+D*k,a[2]=x*-k+I*G,a[3]=B*-k+D*G,a},o.rotateX=function(a,u,p){var x=Math.sin(p),B=Math.cos(p),I=u[4],D=u[5],k=u[6],G=u[7],X=u[8],Y=u[9],rt=u[10],ht=u[11];return u!==a&&(a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[4]=I*B+X*x,a[5]=D*B+Y*x,a[6]=k*B+rt*x,a[7]=G*B+ht*x,a[8]=X*B-I*x,a[9]=Y*B-D*x,a[10]=rt*B-k*x,a[11]=ht*B-G*x,a},o.rotateZ=function(a,u,p){var x=Math.sin(p),B=Math.cos(p),I=u[0],D=u[1],k=u[2],G=u[3],X=u[4],Y=u[5],rt=u[6],ht=u[7];return u!==a&&(a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15]),a[0]=I*B+X*x,a[1]=D*B+Y*x,a[2]=k*B+rt*x,a[3]=G*B+ht*x,a[4]=X*B-I*x,a[5]=Y*B-D*x,a[6]=rt*B-k*x,a[7]=ht*B-G*x,a},o.scale=function(a,u,p){var x=p[0],B=p[1],I=p[2];return a[0]=u[0]*x,a[1]=u[1]*x,a[2]=u[2]*x,a[3]=u[3]*x,a[4]=u[4]*B,a[5]=u[5]*B,a[6]=u[6]*B,a[7]=u[7]*B,a[8]=u[8]*I,a[9]=u[9]*I,a[10]=u[10]*I,a[11]=u[11]*I,a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a},o.scale$1=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a[3]=u[3]*p,a},o.scale$2=function(a,u,p){return a[0]=u[0]*p,a[1]=u[1]*p,a[2]=u[2]*p,a},o.setCacheLimits=function(a,u){St=a,ke=u},o.setRTLTextPlugin=function(a,u,p){if(p===void 0&&(p=!1),Po==="deferred"||Po==="loading"||Po==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ea=qe.resolveURL(a),Po="deferred",Cu=u,Gc(),p||Cs()},o.sphericalToCartesian=function(a){var u=a[0],p=a[1],x=a[2];return p+=90,p*=Math.PI/180,x*=Math.PI/180,{x:u*Math.cos(p)*Math.sin(x),y:u*Math.sin(p)*Math.sin(x),z:u*Math.cos(x)}},o.sqrLen=function(a){var u=a[0],p=a[1];return u*u+p*p},o.styleSpec=st,o.sub=function(a,u,p){return a[0]=u[0]-p[0],a[1]=u[1]-p[1],a[2]=u[2]-p[2],a},o.symbolSize=IN,o.transformMat3=function(a,u,p){var x=u[0],B=u[1],I=u[2];return a[0]=x*p[0]+B*p[3]+I*p[6],a[1]=x*p[1]+B*p[4]+I*p[7],a[2]=x*p[2]+B*p[5]+I*p[8],a},o.transformMat4=Vf,o.translate=function(a,u,p){var x,B,I,D,k,G,X,Y,rt,ht,yt,Ft,kt=p[0],Ht=p[1],jt=p[2];return u===a?(a[12]=u[0]*kt+u[4]*Ht+u[8]*jt+u[12],a[13]=u[1]*kt+u[5]*Ht+u[9]*jt+u[13],a[14]=u[2]*kt+u[6]*Ht+u[10]*jt+u[14],a[15]=u[3]*kt+u[7]*Ht+u[11]*jt+u[15]):(B=u[1],I=u[2],D=u[3],k=u[4],G=u[5],X=u[6],Y=u[7],rt=u[8],ht=u[9],yt=u[10],Ft=u[11],a[0]=x=u[0],a[1]=B,a[2]=I,a[3]=D,a[4]=k,a[5]=G,a[6]=X,a[7]=Y,a[8]=rt,a[9]=ht,a[10]=yt,a[11]=Ft,a[12]=x*kt+k*Ht+rt*jt+u[12],a[13]=B*kt+G*Ht+ht*jt+u[13],a[14]=I*kt+X*Ht+yt*jt+u[14],a[15]=D*kt+Y*Ht+Ft*jt+u[15]),a},o.triggerPluginCompletionEvent=Bh,o.uniqueId=Q,o.validateCustomStyleLayer=function(a){var u=[],p=a.id;return p===void 0&&u.push({message:"layers."+p+': missing required property "id"'}),a.render===void 0&&u.push({message:"layers."+p+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&u.push({message:"layers."+p+': property "renderingMode" must be either "2d" or "3d"'}),u},o.validateLight=uA,o.validateStyle=Pl,o.values=function(a){var u=[];for(var p in a)u.push(a[p]);return u},o.vectorTile=Xf,o.version="1.13.3",o.warnOnce=ut,o.webpSupported=di,o.window=S,o.wrap=j}),s(["./shared"],function(o){function c(q){var nt=typeof q;if(nt==="number"||nt==="boolean"||nt==="string"||q==null)return JSON.stringify(q);if(Array.isArray(q)){for(var at="[",vt=0,Ot=q;vt<Ot.length;vt+=1)at+=c(Ot[vt])+",";return at+"]"}for(var ft=Object.keys(q).sort(),_t="{",st=0;st<ft.length;st++)_t+=JSON.stringify(ft[st])+":"+c(q[ft[st]])+",";return _t+"}"}function h(q){for(var nt="",at=0,vt=o.refProperties;at<vt.length;at+=1)nt+="/"+c(q[vt[at]]);return nt}var A=function(q){this.keyCache={},q&&this.replace(q)};A.prototype.replace=function(q){this._layerConfigs={},this._layers={},this.update(q,[])},A.prototype.update=function(q,nt){for(var at=this,vt=0,Ot=q;vt<Ot.length;vt+=1){var ft=Ot[vt];this._layerConfigs[ft.id]=ft;var _t=this._layers[ft.id]=o.createStyleLayer(ft);_t._featureFilter=o.featureFilter(_t.filter),this.keyCache[ft.id]&&delete this.keyCache[ft.id]}for(var st=0,wt=nt;st<wt.length;st+=1){var g=wt[st];delete this.keyCache[g],delete this._layerConfigs[g],delete this._layers[g]}this.familiesBySource={};for(var ct=0,Ce=function(Ie,je){for(var Ni={},ti=0;ti<Ie.length;ti++){var tn=je&&je[Ie[ti].id]||h(Ie[ti]);je&&(je[Ie[ti].id]=tn);var ln=Ni[tn];ln||(ln=Ni[tn]=[]),ln.push(Ie[ti])}var Ji=[];for(var Xi in Ni)Ji.push(Ni[Xi]);return Ji}(o.values(this._layerConfigs),this.keyCache);ct<Ce.length;ct+=1){var Kt=Ce[ct].map(function(Ie){return at._layers[Ie.id]}),Ee=Kt[0];if(Ee.visibility!=="none"){var Pe=Ee.source||"",Le=this.familiesBySource[Pe];Le||(Le=this.familiesBySource[Pe]={});var he=Ee.sourceLayer||"_geojsonTileLayer",Fe=Le[he];Fe||(Fe=Le[he]=[]),Fe.push(Kt)}}};var _=function(q){var nt={},at=[];for(var vt in q){var Ot=q[vt],ft=nt[vt]={};for(var _t in Ot){var st=Ot[+_t];if(st&&st.bitmap.width!==0&&st.bitmap.height!==0){var wt={x:0,y:0,w:st.bitmap.width+2,h:st.bitmap.height+2};at.push(wt),ft[_t]={rect:wt,metrics:st.metrics}}}}var g=o.potpack(at),ct=new o.AlphaImage({width:g.w||1,height:g.h||1});for(var Ce in q){var Kt=q[Ce];for(var Ee in Kt){var Pe=Kt[+Ee];if(Pe&&Pe.bitmap.width!==0&&Pe.bitmap.height!==0){var Le=nt[Ce][Ee].rect;o.AlphaImage.copy(Pe.bitmap,ct,{x:0,y:0},{x:Le.x+1,y:Le.y+1},Pe.bitmap)}}}this.image=ct,this.positions=nt};o.register("GlyphAtlas",_);var C=function(q){this.tileID=new o.OverscaledTileID(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.uid=q.uid,this.zoom=q.zoom,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.collectResourceTiming,this.returnDependencies=!!q.returnDependencies,this.promoteId=q.promoteId};function S(q,nt,at){for(var vt=new o.EvaluationParameters(nt),Ot=0,ft=q;Ot<ft.length;Ot+=1)ft[Ot].recalculate(vt,at)}function L(q,nt){var at=o.getArrayBuffer(q.request,function(vt,Ot,ft,_t){vt?nt(vt):Ot&&nt(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(Ot)),rawData:Ot,cacheControl:ft,expires:_t})});return function(){at.cancel(),nt()}}C.prototype.parse=function(q,nt,at,vt,Ot){var ft=this;this.status="parsing",this.data=q,this.collisionBoxArray=new o.CollisionBoxArray;var _t=new o.DictionaryCoder(Object.keys(q.layers).sort()),st=new o.FeatureIndex(this.tileID,this.promoteId);st.bucketLayerIDs=[];var wt,g,ct,Ce,Kt={},Ee={featureIndex:st,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:at},Pe=nt.familiesBySource[this.source];for(var Le in Pe){var he=q.layers[Le];if(he){he.version===1&&o.warnOnce('Vector tile source "'+this.source+'" layer "'+Le+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Fe=_t.encode(Le),Ie=[],je=0;je<he.length;je++){var Ni=he.feature(je),ti=st.getId(Ni,Le);Ie.push({feature:Ni,id:ti,index:je,sourceLayerIndex:Fe})}for(var tn=0,ln=Pe[Le];tn<ln.length;tn+=1){var Ji=ln[tn],Xi=Ji[0];Xi.minzoom&&this.zoom<Math.floor(Xi.minzoom)||Xi.maxzoom&&this.zoom>=Xi.maxzoom||Xi.visibility!=="none"&&(S(Ji,this.zoom,at),(Kt[Xi.id]=Xi.createBucket({index:st.bucketLayerIDs.length,layers:Ji,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fe,sourceID:this.source})).populate(Ie,Ee,this.tileID.canonical),st.bucketLayerIDs.push(Ji.map(function(Bt){return Bt.id})))}}}var Gi=o.mapObject(Ee.glyphDependencies,function(Bt){return Object.keys(Bt).map(Number)});Object.keys(Gi).length?vt.send("getGlyphs",{uid:this.uid,stacks:Gi},function(Bt,Qe){wt||(wt=Bt,g=Qe,mi.call(ft))}):g={};var vr=Object.keys(Ee.iconDependencies);vr.length?vt.send("getImages",{icons:vr,source:this.source,tileID:this.tileID,type:"icons"},function(Bt,Qe){wt||(wt=Bt,ct=Qe,mi.call(ft))}):ct={};var Qi=Object.keys(Ee.patternDependencies);function mi(){if(wt)return Ot(wt);if(g&&ct&&Ce){var Bt=new _(g),Qe=new o.ImageAtlas(ct,Ce);for(var en in Kt){var Hr=Kt[en];Hr instanceof o.SymbolBucket?(S(Hr.layers,this.zoom,at),o.performSymbolLayout(Hr,g,Bt.positions,ct,Qe.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Hr.hasPattern&&(Hr instanceof o.LineBucket||Hr instanceof o.FillBucket||Hr instanceof o.FillExtrusionBucket)&&(S(Hr.layers,this.zoom,at),Hr.addFeatures(Ee,this.tileID.canonical,Qe.patternPositions))}this.status="done",Ot(null,{buckets:o.values(Kt).filter(function(va){return!va.isEmpty()}),featureIndex:st,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bt.image,imageAtlas:Qe,glyphMap:this.returnDependencies?g:null,iconMap:this.returnDependencies?ct:null,glyphPositions:this.returnDependencies?Bt.positions:null})}}Qi.length?vt.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"patterns"},function(Bt,Qe){wt||(wt=Bt,Ce=Qe,mi.call(ft))}):Ce={},mi.call(this)};var N=function(q,nt,at,vt){this.actor=q,this.layerIndex=nt,this.availableImages=at,this.loadVectorData=vt||L,this.loading={},this.loaded={}};N.prototype.loadTile=function(q,nt){var at=this,vt=q.uid;this.loading||(this.loading={});var Ot=!!(q&&q.request&&q.request.collectResourceTiming)&&new o.RequestPerformance(q.request),ft=this.loading[vt]=new C(q);ft.abort=this.loadVectorData(q,function(_t,st){if(delete at.loading[vt],_t||!st)return ft.status="done",at.loaded[vt]=ft,nt(_t);var wt=st.rawData,g={};st.expires&&(g.expires=st.expires),st.cacheControl&&(g.cacheControl=st.cacheControl);var ct={};if(Ot){var Ce=Ot.finish();Ce&&(ct.resourceTiming=JSON.parse(JSON.stringify(Ce)))}ft.vectorTile=st.vectorTile,ft.parse(st.vectorTile,at.layerIndex,at.availableImages,at.actor,function(Kt,Ee){if(Kt||!Ee)return nt(Kt);nt(null,o.extend({rawTileData:wt.slice(0)},Ee,g,ct))}),at.loaded=at.loaded||{},at.loaded[vt]=ft})},N.prototype.reloadTile=function(q,nt){var at=this,vt=this.loaded,Ot=q.uid,ft=this;if(vt&&vt[Ot]){var _t=vt[Ot];_t.showCollisionBoxes=q.showCollisionBoxes;var st=function(wt,g){var ct=_t.reloadCallback;ct&&(delete _t.reloadCallback,_t.parse(_t.vectorTile,ft.layerIndex,at.availableImages,ft.actor,ct)),nt(wt,g)};_t.status==="parsing"?_t.reloadCallback=st:_t.status==="done"&&(_t.vectorTile?_t.parse(_t.vectorTile,this.layerIndex,this.availableImages,this.actor,st):st())}},N.prototype.abortTile=function(q,nt){var at=this.loading,vt=q.uid;at&&at[vt]&&at[vt].abort&&(at[vt].abort(),delete at[vt]),nt()},N.prototype.removeTile=function(q,nt){var at=this.loaded,vt=q.uid;at&&at[vt]&&delete at[vt],nt()};var U=o.window.ImageBitmap,H=function(){this.loaded={}};function j(q,nt){if(q.length!==0){tt(q[0],nt);for(var at=1;at<q.length;at++)tt(q[at],!nt)}}function tt(q,nt){for(var at=0,vt=0,Ot=0,ft=q.length,_t=ft-1;Ot<ft;_t=Ot++){var st=(q[Ot][0]-q[_t][0])*(q[_t][1]+q[Ot][1]),wt=at+st;vt+=Math.abs(at)>=Math.abs(st)?at-wt+st:st-wt+at,at=wt}at+vt>=0!=!!nt&&q.reverse()}H.prototype.loadTile=function(q,nt){var at=q.uid,vt=q.encoding,Ot=q.rawImageData,ft=U&&Ot instanceof U?this.getImageData(Ot):Ot,_t=new o.DEMData(at,ft,vt);this.loaded=this.loaded||{},this.loaded[at]=_t,nt(null,_t)},H.prototype.getImageData=function(q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);var nt=this.offscreenCanvasContext.getImageData(-1,-1,q.width+2,q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:nt.width,height:nt.height},nt.data)},H.prototype.removeTile=function(q){var nt=this.loaded,at=q.uid;nt&&nt[at]&&delete nt[at]};var K=o.vectorTile.VectorTileFeature.prototype.toGeoJSON,Q=function(q){this._feature=q,this.extent=o.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))};Q.prototype.loadGeometry=function(){if(this._feature.type===1){for(var q=[],nt=0,at=this._feature.geometry;nt<at.length;nt+=1){var vt=at[nt];q.push([new o.Point$1(vt[0],vt[1])])}return q}for(var Ot=[],ft=0,_t=this._feature.geometry;ft<_t.length;ft+=1){for(var st=[],wt=0,g=_t[ft];wt<g.length;wt+=1){var ct=g[wt];st.push(new o.Point$1(ct[0],ct[1]))}Ot.push(st)}return Ot},Q.prototype.toGeoJSON=function(q,nt,at){return K.call(this,q,nt,at)};var pt=function(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=q.length,this._features=q};pt.prototype.feature=function(q){return new Q(this._features[q])};var $=o.vectorTile.VectorTileFeature,zt=Gt;function Gt(q,nt){this.options=nt||{},this.features=q,this.length=q.length}function dt(q,nt){this.id=typeof q.id=="number"?q.id:void 0,this.type=q.type,this.rawGeometry=q.type===1?[q.geometry]:q.geometry,this.properties=q.tags,this.extent=nt||4096}Gt.prototype.feature=function(q){return new dt(this.features[q],this.options.extent)},dt.prototype.loadGeometry=function(){var q=this.rawGeometry;this.geometry=[];for(var nt=0;nt<q.length;nt++){for(var at=q[nt],vt=[],Ot=0;Ot<at.length;Ot++)vt.push(new o.Point$1(at[Ot][0],at[Ot][1]));this.geometry.push(vt)}return this.geometry},dt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var q=this.geometry,nt=1/0,at=-1/0,vt=1/0,Ot=-1/0,ft=0;ft<q.length;ft++)for(var _t=q[ft],st=0;st<_t.length;st++){var wt=_t[st];nt=Math.min(nt,wt.x),at=Math.max(at,wt.x),vt=Math.min(vt,wt.y),Ot=Math.max(Ot,wt.y)}return[nt,vt,at,Ot]},dt.prototype.toGeoJSON=$.prototype.toGeoJSON;var lt=J,Lt=zt;function J(q){var nt=new o.pbf;return function(at,vt){for(var Ot in at.layers)vt.writeMessage(3,ut,at.layers[Ot])}(q,nt),nt.finish()}function ut(q,nt){var at;nt.writeVarintField(15,q.version||1),nt.writeStringField(1,q.name||""),nt.writeVarintField(5,q.extent||4096);var vt={keys:[],values:[],keycache:{},valuecache:{}};for(at=0;at<q.length;at++)vt.feature=q.feature(at),nt.writeMessage(2,Et,vt);var Ot=vt.keys;for(at=0;at<Ot.length;at++)nt.writeStringField(3,Ot[at]);var ft=vt.values;for(at=0;at<ft.length;at++)nt.writeMessage(4,Zt,ft[at])}function Et(q,nt){var at=q.feature;at.id!==void 0&&nt.writeVarintField(1,at.id),nt.writeMessage(2,le,q),nt.writeVarintField(3,at.type),nt.writeMessage(4,Nt,at)}function le(q,nt){var at=q.feature,vt=q.keys,Ot=q.values,ft=q.keycache,_t=q.valuecache;for(var st in at.properties){var wt=ft[st];wt===void 0&&(vt.push(st),ft[st]=wt=vt.length-1),nt.writeVarint(wt);var g=at.properties[st],ct=typeof g;ct!=="string"&&ct!=="boolean"&&ct!=="number"&&(g=JSON.stringify(g));var Ce=ct+":"+g,Kt=_t[Ce];Kt===void 0&&(Ot.push(g),_t[Ce]=Kt=Ot.length-1),nt.writeVarint(Kt)}}function Ct(q,nt){return(nt<<3)+(7&q)}function Rt(q){return q<<1^q>>31}function Nt(q,nt){for(var at=q.loadGeometry(),vt=q.type,Ot=0,ft=0,_t=at.length,st=0;st<_t;st++){var wt=at[st],g=1;vt===1&&(g=wt.length),nt.writeVarint(Ct(1,g));for(var ct=vt===3?wt.length-1:wt.length,Ce=0;Ce<ct;Ce++){Ce===1&&vt!==1&&nt.writeVarint(Ct(2,ct-1));var Kt=wt[Ce].x-Ot,Ee=wt[Ce].y-ft;nt.writeVarint(Rt(Kt)),nt.writeVarint(Rt(Ee)),Ot+=Kt,ft+=Ee}vt===3&&nt.writeVarint(Ct(7,1))}}function Zt(q,nt){var at=typeof q;at==="string"?nt.writeStringField(1,q):at==="boolean"?nt.writeBooleanField(7,q):at==="number"&&(q%1!=0?nt.writeDoubleField(3,q):q<0?nt.writeSVarintField(6,q):nt.writeVarintField(5,q))}function re(q,nt,at,vt){se(q,at,vt),se(nt,2*at,2*vt),se(nt,2*at+1,2*vt+1)}function se(q,nt,at){var vt=q[nt];q[nt]=q[at],q[at]=vt}function de(q,nt,at,vt){var Ot=q-at,ft=nt-vt;return Ot*Ot+ft*ft}lt.fromVectorTileJs=J,lt.fromGeojsonVt=function(q,nt){nt=nt||{};var at={};for(var vt in q)at[vt]=new zt(q[vt].features,nt),at[vt].name=vt,at[vt].version=nt.version,at[vt].extent=nt.extent;return J({layers:at})},lt.GeoJSONWrapper=Lt;var Me=function(q){return q[0]},Se=function(q){return q[1]},oe=function(q,nt,at,vt,Ot){nt===void 0&&(nt=Me),at===void 0&&(at=Se),vt===void 0&&(vt=64),Ot===void 0&&(Ot=Float64Array),this.nodeSize=vt,this.points=q;for(var ft=q.length<65536?Uint16Array:Uint32Array,_t=this.ids=new ft(q.length),st=this.coords=new Ot(2*q.length),wt=0;wt<q.length;wt++)_t[wt]=wt,st[2*wt]=nt(q[wt]),st[2*wt+1]=at(q[wt]);(function g(ct,Ce,Kt,Ee,Pe,Le){if(!(Pe-Ee<=Kt)){var he=Ee+Pe>>1;(function Fe(Ie,je,Ni,ti,tn,ln){for(;tn>ti;){if(tn-ti>600){var Ji=tn-ti+1,Xi=Ni-ti+1,Gi=Math.log(Ji),vr=.5*Math.exp(2*Gi/3),Qi=.5*Math.sqrt(Gi*vr*(Ji-vr)/Ji)*(Xi-Ji/2<0?-1:1);Fe(Ie,je,Ni,Math.max(ti,Math.floor(Ni-Xi*vr/Ji+Qi)),Math.min(tn,Math.floor(Ni+(Ji-Xi)*vr/Ji+Qi)),ln)}var mi=je[2*Ni+ln],Bt=ti,Qe=tn;for(re(Ie,je,ti,Ni),je[2*tn+ln]>mi&&re(Ie,je,ti,tn);Bt<Qe;){for(re(Ie,je,Bt,Qe),Bt++,Qe--;je[2*Bt+ln]<mi;)Bt++;for(;je[2*Qe+ln]>mi;)Qe--}je[2*ti+ln]===mi?re(Ie,je,ti,Qe):re(Ie,je,++Qe,tn),Qe<=Ni&&(ti=Qe+1),Ni<=Qe&&(tn=Qe-1)}})(ct,Ce,he,Ee,Pe,Le%2),g(ct,Ce,Kt,Ee,he-1,Le+1),g(ct,Ce,Kt,he+1,Pe,Le+1)}})(_t,st,vt,0,_t.length-1,0)};oe.prototype.range=function(q,nt,at,vt){return function(Ot,ft,_t,st,wt,g,ct){for(var Ce,Kt,Ee=[0,Ot.length-1,0],Pe=[];Ee.length;){var Le=Ee.pop(),he=Ee.pop(),Fe=Ee.pop();if(he-Fe<=ct)for(var Ie=Fe;Ie<=he;Ie++)Kt=ft[2*Ie+1],(Ce=ft[2*Ie])>=_t&&Ce<=wt&&Kt>=st&&Kt<=g&&Pe.push(Ot[Ie]);else{var je=Math.floor((Fe+he)/2);Kt=ft[2*je+1],(Ce=ft[2*je])>=_t&&Ce<=wt&&Kt>=st&&Kt<=g&&Pe.push(Ot[je]);var Ni=(Le+1)%2;(Le===0?_t<=Ce:st<=Kt)&&(Ee.push(Fe),Ee.push(je-1),Ee.push(Ni)),(Le===0?wt>=Ce:g>=Kt)&&(Ee.push(je+1),Ee.push(he),Ee.push(Ni))}}return Pe}(this.ids,this.coords,q,nt,at,vt,this.nodeSize)},oe.prototype.within=function(q,nt,at){return function(vt,Ot,ft,_t,st,wt){for(var g=[0,vt.length-1,0],ct=[],Ce=st*st;g.length;){var Kt=g.pop(),Ee=g.pop(),Pe=g.pop();if(Ee-Pe<=wt)for(var Le=Pe;Le<=Ee;Le++)de(Ot[2*Le],Ot[2*Le+1],ft,_t)<=Ce&&ct.push(vt[Le]);else{var he=Math.floor((Pe+Ee)/2),Fe=Ot[2*he],Ie=Ot[2*he+1];de(Fe,Ie,ft,_t)<=Ce&&ct.push(vt[he]);var je=(Kt+1)%2;(Kt===0?ft-st<=Fe:_t-st<=Ie)&&(g.push(Pe),g.push(he-1),g.push(je)),(Kt===0?ft+st>=Fe:_t+st>=Ie)&&(g.push(he+1),g.push(Ee),g.push(je))}}return ct}(this.ids,this.coords,q,nt,at,this.nodeSize)};var Ai={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(q){return q}},Ke=function(q){this.options=Vn(Object.create(Ai),q),this.trees=new Array(this.options.maxZoom+1)};function qe(q,nt,at,vt,Ot){return{x:q,y:nt,zoom:1/0,id:at,parentId:-1,numPoints:vt,properties:Ot}}function Ve(q,nt){var at=q.geometry.coordinates,vt=at[1];return{x:Ri(at[0]),y:bi(vt),zoom:1/0,index:nt,parentId:-1}}function di(q){return{type:"Feature",id:q.id,properties:cn(q),geometry:{type:"Point",coordinates:[(vt=q.x,360*(vt-.5)),(nt=q.y,at=(180-360*nt)*Math.PI/180,360*Math.atan(Math.exp(at))/Math.PI-90)]}};var nt,at,vt}function cn(q){var nt=q.numPoints,at=nt>=1e4?Math.round(nt/1e3)+"k":nt>=1e3?Math.round(nt/100)/10+"k":nt;return Vn(Vn({},q.properties),{cluster:!0,cluster_id:q.id,point_count:nt,point_count_abbreviated:at})}function Ri(q){return q/360+.5}function bi(q){var nt=Math.sin(q*Math.PI/180),at=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return at<0?0:at>1?1:at}function Vn(q,nt){for(var at in nt)q[at]=nt[at];return q}function yi(q){return q.x}function vi(q){return q.y}function un(q,nt,at,vt,Ot,ft){var _t=Ot-at,st=ft-vt;if(_t!==0||st!==0){var wt=((q-at)*_t+(nt-vt)*st)/(_t*_t+st*st);wt>1?(at=Ot,vt=ft):wt>0&&(at+=_t*wt,vt+=st*wt)}return(_t=q-at)*_t+(st=nt-vt)*st}function Di(q,nt,at,vt){var Ot={id:q===void 0?null:q,type:nt,geometry:at,tags:vt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ft){var _t=ft.geometry,st=ft.type;if(st==="Point"||st==="MultiPoint"||st==="LineString")lr(ft,_t);else if(st==="Polygon"||st==="MultiLineString")for(var wt=0;wt<_t.length;wt++)lr(ft,_t[wt]);else if(st==="MultiPolygon")for(wt=0;wt<_t.length;wt++)for(var g=0;g<_t[wt].length;g++)lr(ft,_t[wt][g])}(Ot),Ot}function lr(q,nt){for(var at=0;at<nt.length;at+=3)q.minX=Math.min(q.minX,nt[at]),q.minY=Math.min(q.minY,nt[at+1]),q.maxX=Math.max(q.maxX,nt[at]),q.maxY=Math.max(q.maxY,nt[at+1])}function Yn(q,nt,at,vt){if(nt.geometry){var Ot=nt.geometry.coordinates,ft=nt.geometry.type,_t=Math.pow(at.tolerance/((1<<at.maxZoom)*at.extent),2),st=[],wt=nt.id;if(at.promoteId?wt=nt.properties[at.promoteId]:at.generateId&&(wt=vt||0),ft==="Point")mn(Ot,st);else if(ft==="MultiPoint")for(var g=0;g<Ot.length;g++)mn(Ot[g],st);else if(ft==="LineString")ir(Ot,st,_t,!1);else if(ft==="MultiLineString"){if(at.lineMetrics){for(g=0;g<Ot.length;g++)ir(Ot[g],st=[],_t,!1),q.push(Di(wt,"LineString",st,nt.properties));return}Hn(Ot,st,_t,!1)}else if(ft==="Polygon")Hn(Ot,st,_t,!0);else{if(ft!=="MultiPolygon"){if(ft==="GeometryCollection"){for(g=0;g<nt.geometry.geometries.length;g++)Yn(q,{id:wt,geometry:nt.geometry.geometries[g],properties:nt.properties},at,vt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(g=0;g<Ot.length;g++){var ct=[];Hn(Ot[g],ct,_t,!0),st.push(ct)}}q.push(Di(wt,ft,st,nt.properties))}}function mn(q,nt){nt.push(Tn(q[0])),nt.push($n(q[1])),nt.push(0)}function ir(q,nt,at,vt){for(var Ot,ft,_t=0,st=0;st<q.length;st++){var wt=Tn(q[st][0]),g=$n(q[st][1]);nt.push(wt),nt.push(g),nt.push(0),st>0&&(_t+=vt?(Ot*g-wt*ft)/2:Math.sqrt(Math.pow(wt-Ot,2)+Math.pow(g-ft,2))),Ot=wt,ft=g}var ct=nt.length-3;nt[2]=1,function Ce(Kt,Ee,Pe,Le){for(var he,Fe=Le,Ie=Pe-Ee>>1,je=Pe-Ee,Ni=Kt[Ee],ti=Kt[Ee+1],tn=Kt[Pe],ln=Kt[Pe+1],Ji=Ee+3;Ji<Pe;Ji+=3){var Xi=un(Kt[Ji],Kt[Ji+1],Ni,ti,tn,ln);if(Xi>Fe)he=Ji,Fe=Xi;else if(Xi===Fe){var Gi=Math.abs(Ji-Ie);Gi<je&&(he=Ji,je=Gi)}}Fe>Le&&(he-Ee>3&&Ce(Kt,Ee,he,Le),Kt[he+2]=Fe,Pe-he>3&&Ce(Kt,he,Pe,Le))}(nt,0,ct,at),nt[ct+2]=1,nt.size=Math.abs(_t),nt.start=0,nt.end=nt.size}function Hn(q,nt,at,vt){for(var Ot=0;Ot<q.length;Ot++){var ft=[];ir(q[Ot],ft,at,vt),nt.push(ft)}}function Tn(q){return q/360+.5}function $n(q){var nt=Math.sin(q*Math.PI/180),at=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return at<0?0:at>1?1:at}function Ge(q,nt,at,vt,Ot,ft,_t,st){if(vt/=nt,ft>=(at/=nt)&&_t<vt)return q;if(_t<at||ft>=vt)return null;for(var wt=[],g=0;g<q.length;g++){var ct=q[g],Ce=ct.geometry,Kt=ct.type,Ee=Ot===0?ct.minX:ct.minY,Pe=Ot===0?ct.maxX:ct.maxY;if(Ee>=at&&Pe<vt)wt.push(ct);else if(!(Pe<at||Ee>=vt)){var Le=[];if(Kt==="Point"||Kt==="MultiPoint")gi(Ce,Le,at,vt,Ot);else if(Kt==="LineString")Mi(Ce,Le,at,vt,Ot,!1,st.lineMetrics);else if(Kt==="MultiLineString")yr(Ce,Le,at,vt,Ot,!1);else if(Kt==="Polygon")yr(Ce,Le,at,vt,Ot,!0);else if(Kt==="MultiPolygon")for(var he=0;he<Ce.length;he++){var Fe=[];yr(Ce[he],Fe,at,vt,Ot,!0),Fe.length&&Le.push(Fe)}if(Le.length){if(st.lineMetrics&&Kt==="LineString"){for(he=0;he<Le.length;he++)wt.push(Di(ct.id,Kt,Le[he],ct.tags));continue}Kt!=="LineString"&&Kt!=="MultiLineString"||(Le.length===1?(Kt="LineString",Le=Le[0]):Kt="MultiLineString"),Kt!=="Point"&&Kt!=="MultiPoint"||(Kt=Le.length===3?"Point":"MultiPoint"),wt.push(Di(ct.id,Kt,Le,ct.tags))}}}return wt.length?wt:null}function gi(q,nt,at,vt,Ot){for(var ft=0;ft<q.length;ft+=3){var _t=q[ft+Ot];_t>=at&&_t<=vt&&(nt.push(q[ft]),nt.push(q[ft+1]),nt.push(q[ft+2]))}}function Mi(q,nt,at,vt,Ot,ft,_t){for(var st,wt,g=rn(q),ct=Ot===0?ke:Je,Ce=q.start,Kt=0;Kt<q.length-3;Kt+=3){var Ee=q[Kt],Pe=q[Kt+1],Le=q[Kt+2],he=q[Kt+3],Fe=q[Kt+4],Ie=Ot===0?Ee:Pe,je=Ot===0?he:Fe,Ni=!1;_t&&(st=Math.sqrt(Math.pow(Ee-he,2)+Math.pow(Pe-Fe,2))),Ie<at?je>at&&(wt=ct(g,Ee,Pe,he,Fe,at),_t&&(g.start=Ce+st*wt)):Ie>vt?je<vt&&(wt=ct(g,Ee,Pe,he,Fe,vt),_t&&(g.start=Ce+st*wt)):St(g,Ee,Pe,Le),je<at&&Ie>=at&&(wt=ct(g,Ee,Pe,he,Fe,at),Ni=!0),je>vt&&Ie<=vt&&(wt=ct(g,Ee,Pe,he,Fe,vt),Ni=!0),!ft&&Ni&&(_t&&(g.end=Ce+st*wt),nt.push(g),g=rn(q)),_t&&(Ce+=st)}var ti=q.length-3;Ee=q[ti],Pe=q[ti+1],Le=q[ti+2],(Ie=Ot===0?Ee:Pe)>=at&&Ie<=vt&&St(g,Ee,Pe,Le),ti=g.length-3,ft&&ti>=3&&(g[ti]!==g[0]||g[ti+1]!==g[1])&&St(g,g[0],g[1],g[2]),g.length&&nt.push(g)}function rn(q){var nt=[];return nt.size=q.size,nt.start=q.start,nt.end=q.end,nt}function yr(q,nt,at,vt,Ot,ft){for(var _t=0;_t<q.length;_t++)Mi(q[_t],nt,at,vt,Ot,ft,!1)}function St(q,nt,at,vt){q.push(nt),q.push(at),q.push(vt)}function ke(q,nt,at,vt,Ot,ft){var _t=(ft-nt)/(vt-nt);return q.push(ft),q.push(at+(Ot-at)*_t),q.push(1),_t}function Je(q,nt,at,vt,Ot,ft){var _t=(ft-at)/(Ot-at);return q.push(nt+(vt-nt)*_t),q.push(ft),q.push(1),_t}function li(q,nt){for(var at=[],vt=0;vt<q.length;vt++){var Ot,ft=q[vt],_t=ft.type;if(_t==="Point"||_t==="MultiPoint"||_t==="LineString")Ot=Yt(ft.geometry,nt);else if(_t==="MultiLineString"||_t==="Polygon"){Ot=[];for(var st=0;st<ft.geometry.length;st++)Ot.push(Yt(ft.geometry[st],nt))}else if(_t==="MultiPolygon")for(Ot=[],st=0;st<ft.geometry.length;st++){for(var wt=[],g=0;g<ft.geometry[st].length;g++)wt.push(Yt(ft.geometry[st][g],nt));Ot.push(wt)}at.push(Di(ft.id,_t,Ot,ft.tags))}return at}function Yt(q,nt){var at=[];at.size=q.size,q.start!==void 0&&(at.start=q.start,at.end=q.end);for(var vt=0;vt<q.length;vt+=3)at.push(q[vt]+nt,q[vt+1],q[vt+2]);return at}function Re(q,nt){if(q.transformed)return q;var at,vt,Ot,ft=1<<q.z,_t=q.x,st=q.y;for(at=0;at<q.features.length;at++){var wt=q.features[at],g=wt.geometry,ct=wt.type;if(wt.geometry=[],ct===1)for(vt=0;vt<g.length;vt+=2)wt.geometry.push(gt(g[vt],g[vt+1],nt,ft,_t,st));else for(vt=0;vt<g.length;vt++){var Ce=[];for(Ot=0;Ot<g[vt].length;Ot+=2)Ce.push(gt(g[vt][Ot],g[vt][Ot+1],nt,ft,_t,st));wt.geometry.push(Ce)}}return q.transformed=!0,q}function gt(q,nt,at,vt,Ot,ft){return[Math.round(at*(q*vt-Ot)),Math.round(at*(nt*vt-ft))]}function ze(q,nt,at,vt,Ot){for(var ft=nt===Ot.maxZoom?0:Ot.tolerance/((1<<nt)*Ot.extent),_t={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:at,y:vt,z:nt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},st=0;st<q.length;st++){_t.numFeatures++,we(_t,q[st],ft,Ot);var wt=q[st].minX,g=q[st].minY,ct=q[st].maxX,Ce=q[st].maxY;wt<_t.minX&&(_t.minX=wt),g<_t.minY&&(_t.minY=g),ct>_t.maxX&&(_t.maxX=ct),Ce>_t.maxY&&(_t.maxY=Ce)}return _t}function we(q,nt,at,vt){var Ot=nt.geometry,ft=nt.type,_t=[];if(ft==="Point"||ft==="MultiPoint")for(var st=0;st<Ot.length;st+=3)_t.push(Ot[st]),_t.push(Ot[st+1]),q.numPoints++,q.numSimplified++;else if(ft==="LineString")V(_t,Ot,q,at,!1,!1);else if(ft==="MultiLineString"||ft==="Polygon")for(st=0;st<Ot.length;st++)V(_t,Ot[st],q,at,ft==="Polygon",st===0);else if(ft==="MultiPolygon")for(var wt=0;wt<Ot.length;wt++){var g=Ot[wt];for(st=0;st<g.length;st++)V(_t,g[st],q,at,!0,st===0)}if(_t.length){var ct=nt.tags||null;if(ft==="LineString"&&vt.lineMetrics){for(var Ce in ct={},nt.tags)ct[Ce]=nt.tags[Ce];ct.mapbox_clip_start=Ot.start/Ot.size,ct.mapbox_clip_end=Ot.end/Ot.size}var Kt={geometry:_t,type:ft==="Polygon"||ft==="MultiPolygon"?3:ft==="LineString"||ft==="MultiLineString"?2:1,tags:ct};nt.id!==null&&(Kt.id=nt.id),q.features.push(Kt)}}function V(q,nt,at,vt,Ot,ft){var _t=vt*vt;if(vt>0&&nt.size<(Ot?_t:vt))at.numPoints+=nt.length/3;else{for(var st=[],wt=0;wt<nt.length;wt+=3)(vt===0||nt[wt+2]>_t)&&(at.numSimplified++,st.push(nt[wt]),st.push(nt[wt+1])),at.numPoints++;Ot&&function(g,ct){for(var Ce=0,Kt=0,Ee=g.length,Pe=Ee-2;Kt<Ee;Pe=Kt,Kt+=2)Ce+=(g[Kt]-g[Pe])*(g[Kt+1]+g[Pe+1]);if(Ce>0===ct)for(Kt=0,Ee=g.length;Kt<Ee/2;Kt+=2){var Le=g[Kt],he=g[Kt+1];g[Kt]=g[Ee-2-Kt],g[Kt+1]=g[Ee-1-Kt],g[Ee-2-Kt]=Le,g[Ee-1-Kt]=he}}(st,ft),q.push(st)}}function ve(q,nt){var at=(nt=this.options=function(Ot,ft){for(var _t in ft)Ot[_t]=ft[_t];return Ot}(Object.create(this.options),nt)).debug;if(at&&console.time("preprocess data"),nt.maxZoom<0||nt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(nt.promoteId&&nt.generateId)throw new Error("promoteId and generateId cannot be used together.");var vt=function(Ot,ft){var _t=[];if(Ot.type==="FeatureCollection")for(var st=0;st<Ot.features.length;st++)Yn(_t,Ot.features[st],ft,st);else Yn(_t,Ot.type==="Feature"?Ot:{geometry:Ot},ft);return _t}(q,nt);this.tiles={},this.tileCoords=[],at&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",nt.indexMaxZoom,nt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(vt=function(Ot,ft){var _t=ft.buffer/ft.extent,st=Ot,wt=Ge(Ot,1,-1-_t,_t,0,-1,2,ft),g=Ge(Ot,1,1-_t,2+_t,0,-1,2,ft);return(wt||g)&&(st=Ge(Ot,1,-_t,1+_t,0,-1,2,ft)||[],wt&&(st=li(wt,1).concat(st)),g&&(st=st.concat(li(g,-1)))),st}(vt,nt)).length&&this.splitTile(vt,0,0,0),at&&(vt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Be(q,nt,at){return 32*((1<<q)*at+nt)+q}function xt(q,nt){var at=q.tileID.canonical;if(!this._geoJSONIndex)return nt(null,null);var vt=this._geoJSONIndex.getTile(at.z,at.x,at.y);if(!vt)return nt(null,null);var Ot=new pt(vt.features),ft=lt(Ot);ft.byteOffset===0&&ft.byteLength===ft.buffer.byteLength||(ft=new Uint8Array(ft)),nt(null,{vectorTile:Ot,rawData:ft.buffer})}Ke.prototype.load=function(q){var nt=this.options,at=nt.log,vt=nt.minZoom,Ot=nt.maxZoom,ft=nt.nodeSize;at&&console.time("total time");var _t="prepare "+q.length+" points";at&&console.time(_t),this.points=q;for(var st=[],wt=0;wt<q.length;wt++)q[wt].geometry&&st.push(Ve(q[wt],wt));this.trees[Ot+1]=new oe(st,yi,vi,ft,Float32Array),at&&console.timeEnd(_t);for(var g=Ot;g>=vt;g--){var ct=+Date.now();st=this._cluster(st,g),this.trees[g]=new oe(st,yi,vi,ft,Float32Array),at&&console.log("z%d: %d clusters in %dms",g,st.length,+Date.now()-ct)}return at&&console.timeEnd("total time"),this},Ke.prototype.getClusters=function(q,nt){var at=((q[0]+180)%360+360)%360-180,vt=Math.max(-90,Math.min(90,q[1])),Ot=q[2]===180?180:((q[2]+180)%360+360)%360-180,ft=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)at=-180,Ot=180;else if(at>Ot){var _t=this.getClusters([at,vt,180,ft],nt),st=this.getClusters([-180,vt,Ot,ft],nt);return _t.concat(st)}for(var wt=this.trees[this._limitZoom(nt)],g=[],ct=0,Ce=wt.range(Ri(at),bi(ft),Ri(Ot),bi(vt));ct<Ce.length;ct+=1){var Kt=wt.points[Ce[ct]];g.push(Kt.numPoints?di(Kt):this.points[Kt.index])}return g},Ke.prototype.getChildren=function(q){var nt=this._getOriginId(q),at=this._getOriginZoom(q),vt="No cluster with the specified id.",Ot=this.trees[at];if(!Ot)throw new Error(vt);var ft=Ot.points[nt];if(!ft)throw new Error(vt);for(var _t=this.options.radius/(this.options.extent*Math.pow(2,at-1)),st=[],wt=0,g=Ot.within(ft.x,ft.y,_t);wt<g.length;wt+=1){var ct=Ot.points[g[wt]];ct.parentId===q&&st.push(ct.numPoints?di(ct):this.points[ct.index])}if(st.length===0)throw new Error(vt);return st},Ke.prototype.getLeaves=function(q,nt,at){var vt=[];return this._appendLeaves(vt,q,nt=nt||10,at=at||0,0),vt},Ke.prototype.getTile=function(q,nt,at){var vt=this.trees[this._limitZoom(q)],Ot=Math.pow(2,q),ft=this.options,_t=ft.radius/ft.extent,st=(at-_t)/Ot,wt=(at+1+_t)/Ot,g={features:[]};return this._addTileFeatures(vt.range((nt-_t)/Ot,st,(nt+1+_t)/Ot,wt),vt.points,nt,at,Ot,g),nt===0&&this._addTileFeatures(vt.range(1-_t/Ot,st,1,wt),vt.points,Ot,at,Ot,g),nt===Ot-1&&this._addTileFeatures(vt.range(0,st,_t/Ot,wt),vt.points,-1,at,Ot,g),g.features.length?g:null},Ke.prototype.getClusterExpansionZoom=function(q){for(var nt=this._getOriginZoom(q)-1;nt<=this.options.maxZoom;){var at=this.getChildren(q);if(nt++,at.length!==1)break;q=at[0].properties.cluster_id}return nt},Ke.prototype._appendLeaves=function(q,nt,at,vt,Ot){for(var ft=0,_t=this.getChildren(nt);ft<_t.length;ft+=1){var st=_t[ft],wt=st.properties;if(wt&&wt.cluster?Ot+wt.point_count<=vt?Ot+=wt.point_count:Ot=this._appendLeaves(q,wt.cluster_id,at,vt,Ot):Ot<vt?Ot++:q.push(st),q.length===at)break}return Ot},Ke.prototype._addTileFeatures=function(q,nt,at,vt,Ot,ft){for(var _t=0,st=q;_t<st.length;_t+=1){var wt=nt[st[_t]],g=wt.numPoints,ct={type:1,geometry:[[Math.round(this.options.extent*(wt.x*Ot-at)),Math.round(this.options.extent*(wt.y*Ot-vt))]],tags:g?cn(wt):this.points[wt.index].properties},Ce=void 0;g?Ce=wt.id:this.options.generateId?Ce=wt.index:this.points[wt.index].id&&(Ce=this.points[wt.index].id),Ce!==void 0&&(ct.id=Ce),ft.features.push(ct)}},Ke.prototype._limitZoom=function(q){return Math.max(this.options.minZoom,Math.min(+q,this.options.maxZoom+1))},Ke.prototype._cluster=function(q,nt){for(var at=[],vt=this.options,Ot=vt.reduce,ft=vt.minPoints,_t=vt.radius/(vt.extent*Math.pow(2,nt)),st=0;st<q.length;st++){var wt=q[st];if(!(wt.zoom<=nt)){wt.zoom=nt;for(var g=this.trees[nt+1],ct=g.within(wt.x,wt.y,_t),Ce=wt.numPoints||1,Kt=Ce,Ee=0,Pe=ct;Ee<Pe.length;Ee+=1){var Le=g.points[Pe[Ee]];Le.zoom>nt&&(Kt+=Le.numPoints||1)}if(Kt>=ft){for(var he=wt.x*Ce,Fe=wt.y*Ce,Ie=Ot&&Ce>1?this._map(wt,!0):null,je=(st<<5)+(nt+1)+this.points.length,Ni=0,ti=ct;Ni<ti.length;Ni+=1){var tn=g.points[ti[Ni]];if(!(tn.zoom<=nt)){tn.zoom=nt;var ln=tn.numPoints||1;he+=tn.x*ln,Fe+=tn.y*ln,tn.parentId=je,Ot&&(Ie||(Ie=this._map(wt,!0)),Ot(Ie,this._map(tn)))}}wt.parentId=je,at.push(qe(he/Kt,Fe/Kt,je,Kt,Ie))}else if(at.push(wt),Kt>1)for(var Ji=0,Xi=ct;Ji<Xi.length;Ji+=1){var Gi=g.points[Xi[Ji]];Gi.zoom<=nt||(Gi.zoom=nt,at.push(Gi))}}}return at},Ke.prototype._getOriginId=function(q){return q-this.points.length>>5},Ke.prototype._getOriginZoom=function(q){return(q-this.points.length)%32},Ke.prototype._map=function(q,nt){if(q.numPoints)return nt?Vn({},q.properties):q.properties;var at=this.points[q.index].properties,vt=this.options.map(at);return nt&&vt===at?Vn({},vt):vt},ve.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ve.prototype.splitTile=function(q,nt,at,vt,Ot,ft,_t){for(var st=[q,nt,at,vt],wt=this.options,g=wt.debug;st.length;){vt=st.pop(),at=st.pop(),nt=st.pop(),q=st.pop();var ct=1<<nt,Ce=Be(nt,at,vt),Kt=this.tiles[Ce];if(!Kt&&(g>1&&console.time("creation"),Kt=this.tiles[Ce]=ze(q,nt,at,vt,wt),this.tileCoords.push({z:nt,x:at,y:vt}),g)){g>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",nt,at,vt,Kt.numFeatures,Kt.numPoints,Kt.numSimplified),console.timeEnd("creation"));var Ee="z"+nt;this.stats[Ee]=(this.stats[Ee]||0)+1,this.total++}if(Kt.source=q,Ot){if(nt===wt.maxZoom||nt===Ot)continue;var Pe=1<<Ot-nt;if(at!==Math.floor(ft/Pe)||vt!==Math.floor(_t/Pe))continue}else if(nt===wt.indexMaxZoom||Kt.numPoints<=wt.indexMaxPoints)continue;if(Kt.source=null,q.length!==0){g>1&&console.time("clipping");var Le,he,Fe,Ie,je,Ni,ti=.5*wt.buffer/wt.extent,tn=.5-ti,ln=.5+ti,Ji=1+ti;Le=he=Fe=Ie=null,je=Ge(q,ct,at-ti,at+ln,0,Kt.minX,Kt.maxX,wt),Ni=Ge(q,ct,at+tn,at+Ji,0,Kt.minX,Kt.maxX,wt),q=null,je&&(Le=Ge(je,ct,vt-ti,vt+ln,1,Kt.minY,Kt.maxY,wt),he=Ge(je,ct,vt+tn,vt+Ji,1,Kt.minY,Kt.maxY,wt),je=null),Ni&&(Fe=Ge(Ni,ct,vt-ti,vt+ln,1,Kt.minY,Kt.maxY,wt),Ie=Ge(Ni,ct,vt+tn,vt+Ji,1,Kt.minY,Kt.maxY,wt),Ni=null),g>1&&console.timeEnd("clipping"),st.push(Le||[],nt+1,2*at,2*vt),st.push(he||[],nt+1,2*at,2*vt+1),st.push(Fe||[],nt+1,2*at+1,2*vt),st.push(Ie||[],nt+1,2*at+1,2*vt+1)}}},ve.prototype.getTile=function(q,nt,at){var vt=this.options,Ot=vt.extent,ft=vt.debug;if(q<0||q>24)return null;var _t=1<<q,st=Be(q,nt=(nt%_t+_t)%_t,at);if(this.tiles[st])return Re(this.tiles[st],Ot);ft>1&&console.log("drilling down to z%d-%d-%d",q,nt,at);for(var wt,g=q,ct=nt,Ce=at;!wt&&g>0;)g--,ct=Math.floor(ct/2),Ce=Math.floor(Ce/2),wt=this.tiles[Be(g,ct,Ce)];return wt&&wt.source?(ft>1&&console.log("found parent tile z%d-%d-%d",g,ct,Ce),ft>1&&console.time("drilling down"),this.splitTile(wt.source,g,ct,Ce,q,nt,at),ft>1&&console.timeEnd("drilling down"),this.tiles[st]?Re(this.tiles[st],Ot):null):null};var Xt=function(q){function nt(at,vt,Ot,ft){q.call(this,at,vt,Ot,xt),ft&&(this.loadGeoJSON=ft)}return q&&(nt.__proto__=q),(nt.prototype=Object.create(q&&q.prototype)).constructor=nt,nt.prototype.loadData=function(at,vt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=vt,this._pendingLoadDataParams=at,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},nt.prototype._loadData=function(){var at=this;if(this._pendingCallback&&this._pendingLoadDataParams){var vt=this._pendingCallback,Ot=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ft=!!(Ot&&Ot.request&&Ot.request.collectResourceTiming)&&new o.RequestPerformance(Ot.request);this.loadGeoJSON(Ot,function(_t,st){if(_t||!st)return vt(_t);if(typeof st!="object")return vt(new Error("Input data given to '"+Ot.source+"' is not a valid GeoJSON object."));(function Kt(Ee,Pe){var Le,he=Ee&&Ee.type;if(he==="FeatureCollection")for(Le=0;Le<Ee.features.length;Le++)Kt(Ee.features[Le],Pe);else if(he==="GeometryCollection")for(Le=0;Le<Ee.geometries.length;Le++)Kt(Ee.geometries[Le],Pe);else if(he==="Feature")Kt(Ee.geometry,Pe);else if(he==="Polygon")j(Ee.coordinates,Pe);else if(he==="MultiPolygon")for(Le=0;Le<Ee.coordinates.length;Le++)j(Ee.coordinates[Le],Pe);return Ee})(st,!0);try{if(Ot.filter){var wt=o.createExpression(Ot.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(wt.result==="error")throw new Error(wt.value.map(function(Kt){return Kt.key+": "+Kt.message}).join(", "));var g=st.features.filter(function(Kt){return wt.value.evaluate({zoom:0},Kt)});st={type:"FeatureCollection",features:g}}at._geoJSONIndex=Ot.cluster?new Ke(function(Kt){var Ee=Kt.superclusterOptions,Pe=Kt.clusterProperties;if(!Pe||!Ee)return Ee;for(var Le={},he={},Fe={accumulated:null,zoom:0},Ie={properties:null},je=Object.keys(Pe),Ni=0,ti=je;Ni<ti.length;Ni+=1){var tn=ti[Ni],ln=Pe[tn],Ji=ln[0],Xi=o.createExpression(ln[1]),Gi=o.createExpression(typeof Ji=="string"?[Ji,["accumulated"],["get",tn]]:Ji);Le[tn]=Xi.value,he[tn]=Gi.value}return Ee.map=function(vr){Ie.properties=vr;for(var Qi={},mi=0,Bt=je;mi<Bt.length;mi+=1){var Qe=Bt[mi];Qi[Qe]=Le[Qe].evaluate(Fe,Ie)}return Qi},Ee.reduce=function(vr,Qi){Ie.properties=Qi;for(var mi=0,Bt=je;mi<Bt.length;mi+=1){var Qe=Bt[mi];Fe.accumulated=vr[Qe],vr[Qe]=he[Qe].evaluate(Fe,Ie)}},Ee}(Ot)).load(st.features):function(Kt,Ee){return new ve(Kt,Ee)}(st,Ot.geojsonVtOptions)}catch(Kt){return vt(Kt)}at.loaded={};var ct={};if(ft){var Ce=ft.finish();Ce&&(ct.resourceTiming={},ct.resourceTiming[Ot.source]=JSON.parse(JSON.stringify(Ce)))}vt(null,ct)})}},nt.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},nt.prototype.reloadTile=function(at,vt){var Ot=this.loaded;return Ot&&Ot[at.uid]?q.prototype.reloadTile.call(this,at,vt):this.loadTile(at,vt)},nt.prototype.loadGeoJSON=function(at,vt){if(at.request)o.getJSON(at.request,vt);else{if(typeof at.data!="string")return vt(new Error("Input data given to '"+at.source+"' is not a valid GeoJSON object."));try{return vt(null,JSON.parse(at.data))}catch{return vt(new Error("Input data given to '"+at.source+"' is not a valid GeoJSON object."))}}},nt.prototype.removeSource=function(at,vt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),vt()},nt.prototype.getClusterExpansionZoom=function(at,vt){try{vt(null,this._geoJSONIndex.getClusterExpansionZoom(at.clusterId))}catch(Ot){vt(Ot)}},nt.prototype.getClusterChildren=function(at,vt){try{vt(null,this._geoJSONIndex.getChildren(at.clusterId))}catch(Ot){vt(Ot)}},nt.prototype.getClusterLeaves=function(at,vt){try{vt(null,this._geoJSONIndex.getLeaves(at.clusterId,at.limit,at.offset))}catch(Ot){vt(Ot)}},nt}(N),ce=function(q){var nt=this;this.self=q,this.actor=new o.Actor(q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:N,geojson:Xt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(at,vt){if(nt.workerSourceTypes[at])throw new Error('Worker source with name "'+at+'" already registered.');nt.workerSourceTypes[at]=vt},this.self.registerRTLTextPlugin=function(at){if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=at.applyArabicShaping,o.plugin.processBidirectionalText=at.processBidirectionalText,o.plugin.processStyledBidirectionalText=at.processStyledBidirectionalText}};return ce.prototype.setReferrer=function(q,nt){this.referrer=nt},ce.prototype.setImages=function(q,nt,at){for(var vt in this.availableImages[q]=nt,this.workerSources[q]){var Ot=this.workerSources[q][vt];for(var ft in Ot)Ot[ft].availableImages=nt}at()},ce.prototype.setLayers=function(q,nt,at){this.getLayerIndex(q).replace(nt),at()},ce.prototype.updateLayers=function(q,nt,at){this.getLayerIndex(q).update(nt.layers,nt.removedIds),at()},ce.prototype.loadTile=function(q,nt,at){this.getWorkerSource(q,nt.type,nt.source).loadTile(nt,at)},ce.prototype.loadDEMTile=function(q,nt,at){this.getDEMWorkerSource(q,nt.source).loadTile(nt,at)},ce.prototype.reloadTile=function(q,nt,at){this.getWorkerSource(q,nt.type,nt.source).reloadTile(nt,at)},ce.prototype.abortTile=function(q,nt,at){this.getWorkerSource(q,nt.type,nt.source).abortTile(nt,at)},ce.prototype.removeTile=function(q,nt,at){this.getWorkerSource(q,nt.type,nt.source).removeTile(nt,at)},ce.prototype.removeDEMTile=function(q,nt){this.getDEMWorkerSource(q,nt.source).removeTile(nt)},ce.prototype.removeSource=function(q,nt,at){if(this.workerSources[q]&&this.workerSources[q][nt.type]&&this.workerSources[q][nt.type][nt.source]){var vt=this.workerSources[q][nt.type][nt.source];delete this.workerSources[q][nt.type][nt.source],vt.removeSource!==void 0?vt.removeSource(nt,at):at()}},ce.prototype.loadWorkerSource=function(q,nt,at){try{this.self.importScripts(nt.url),at()}catch(vt){at(vt.toString())}},ce.prototype.syncRTLPluginState=function(q,nt,at){try{o.plugin.setState(nt);var vt=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&vt!=null){this.self.importScripts(vt);var Ot=o.plugin.isParsed();at(Ot?void 0:new Error("RTL Text Plugin failed to import scripts from "+vt),Ot)}}catch(ft){at(ft.toString())}},ce.prototype.getAvailableImages=function(q){var nt=this.availableImages[q];return nt||(nt=[]),nt},ce.prototype.getLayerIndex=function(q){var nt=this.layerIndexes[q];return nt||(nt=this.layerIndexes[q]=new A),nt},ce.prototype.getWorkerSource=function(q,nt,at){var vt=this;return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][nt]||(this.workerSources[q][nt]={}),this.workerSources[q][nt][at]||(this.workerSources[q][nt][at]=new this.workerSourceTypes[nt]({send:function(Ot,ft,_t){vt.actor.send(Ot,ft,_t,q)}},this.getLayerIndex(q),this.getAvailableImages(q))),this.workerSources[q][nt][at]},ce.prototype.getDEMWorkerSource=function(q,nt){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][nt]||(this.demWorkerSources[q][nt]=new H),this.demWorkerSources[q][nt]},ce.prototype.enforceCacheSizeLimit=function(q,nt){o.enforceCacheSizeLimit(nt)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ce(self)),ce}),s(["./shared"],function(o){var c=o.createCommonjsModule(function(l){function d(E){return!f(E)}function f(E){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,F,z=new Blob([""],{type:"text/javascript"}),W=URL.createObjectURL(z);try{F=new Worker(W),R=!0}catch{R=!1}return F&&F.terminate(),URL.revokeObjectURL(W),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var F=R.getContext("2d");if(!F)return!1;var z=F.getImageData(0,0,1,1);return z&&z.width===R.width}()?(m[P=E&&E.failIfMajorPerformanceCaveat]===void 0&&(m[P]=function(R){var F=function(W){var et=document.createElement("canvas"),Z=Object.create(d.webGLContextAttributes);return Z.failIfMajorPerformanceCaveat=W,et.probablySupportsContext?et.probablySupportsContext("webgl",Z)||et.probablySupportsContext("experimental-webgl",Z):et.supportsContext?et.supportsContext("webgl",Z)||et.supportsContext("experimental-webgl",Z):et.getContext("webgl",Z)||et.getContext("experimental-webgl",Z)}(R);if(!F)return!1;var z=F.createShader(F.VERTEX_SHADER);return!(!z||F.isContextLost())&&(F.shaderSource(z,"void main() {}"),F.compileShader(z),F.getShaderParameter(z,F.COMPILE_STATUS)===!0)}(P)),m[P]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var P}l.exports?l.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=f);var m={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),h={create:function(l,d,f){var m=o.window.document.createElement(l);return d!==void 0&&(m.className=d),f&&f.appendChild(m),m},createNS:function(l,d){return o.window.document.createElementNS(l,d)}},A=o.window.document&&o.window.document.documentElement.style;function _(l){if(!A)return l[0];for(var d=0;d<l.length;d++)if(l[d]in A)return l[d];return l[0]}var C,S=_(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);h.disableDrag=function(){A&&S&&(C=A[S],A[S]="none")},h.enableDrag=function(){A&&S&&(A[S]=C)};var L=_(["transform","WebkitTransform"]);h.setTransform=function(l,d){l.style[L]=d};var N=!1;try{var U=Object.defineProperty({},"passive",{get:function(){N=!0}});o.window.addEventListener("test",U,U),o.window.removeEventListener("test",U,U)}catch{N=!1}h.addEventListener=function(l,d,f,m){m===void 0&&(m={}),l.addEventListener(d,f,"passive"in m&&N?m:m.capture)},h.removeEventListener=function(l,d,f,m){m===void 0&&(m={}),l.removeEventListener(d,f,"passive"in m&&N?m:m.capture)};var H=function(l){l.preventDefault(),l.stopPropagation(),o.window.removeEventListener("click",H,!0)};function j(l){var d=l.userImage;return!!(d&&d.render&&d.render())&&(l.data.replace(new Uint8Array(d.data.buffer)),!0)}h.suppressClick=function(){o.window.addEventListener("click",H,!0),o.window.setTimeout(function(){o.window.removeEventListener("click",H,!0)},0)},h.mousePos=function(l,d){var f=l.getBoundingClientRect();return new o.Point(d.clientX-f.left-l.clientLeft,d.clientY-f.top-l.clientTop)},h.touchPos=function(l,d){for(var f=l.getBoundingClientRect(),m=[],E=0;E<d.length;E++)m.push(new o.Point(d[E].clientX-f.left-l.clientLeft,d[E].clientY-f.top-l.clientTop));return m},h.mouseButton=function(l){return o.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},h.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var tt=function(l){function d(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var m=0,E=this.requestors;m<E.length;m+=1){var P=E[m];this._notify(P.ids,P.callback)}this.requestors=[]}},d.prototype.getImage=function(f){return this.images[f]},d.prototype.addImage=function(f,m){this._validate(f,m)&&(this.images[f]=m)},d.prototype._validate=function(f,m){var E=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new o.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new o.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),E=!1),this._validateContent(m.content,m)||(this.fire(new o.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),E=!1),E},d.prototype._validateStretch=function(f,m){if(!f)return!0;for(var E=0,P=0,R=f;P<R.length;P+=1){var F=R[P];if(F[0]<E||F[1]<F[0]||m<F[1])return!1;E=F[1]}return!0},d.prototype._validateContent=function(f,m){return!(f&&(f.length!==4||f[0]<0||m.data.width<f[0]||f[1]<0||m.data.height<f[1]||f[2]<0||m.data.width<f[2]||f[3]<0||m.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},d.prototype.updateImage=function(f,m){m.version=this.images[f].version+1,this.images[f]=m,this.updatedImages[f]=!0},d.prototype.removeImage=function(f){var m=this.images[f];delete this.images[f],delete this.patterns[f],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(f,m){var E=!0;if(!this.isLoaded())for(var P=0,R=f;P<R.length;P+=1)this.images[R[P]]||(E=!1);this.isLoaded()||E?this._notify(f,m):this.requestors.push({ids:f,callback:m})},d.prototype._notify=function(f,m){for(var E={},P=0,R=f;P<R.length;P+=1){var F=R[P];this.images[F]||this.fire(new o.Event("styleimagemissing",{id:F}));var z=this.images[F];z?E[F]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:!!(z.userImage&&z.userImage.render)}:o.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,E)},d.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},d.prototype.getPattern=function(f){var m=this.patterns[f],E=this.getImage(f);if(!E)return null;if(m&&m.position.version===E.version)return m.position;if(m)m.position.version=E.version;else{var P={w:E.data.width+2,h:E.data.height+2,x:0,y:0},R=new o.ImagePosition(P,E);this.patterns[f]={bin:P,position:R}}return this._updatePatternAtlas(),this.patterns[f].position},d.prototype.bind=function(f){var m=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(f,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var f=[];for(var m in this.patterns)f.push(this.patterns[m].bin);var E=o.potpack(f),P=E.w,R=E.h,F=this.atlasImage;for(var z in F.resize({width:P||1,height:R||1}),this.patterns){var W=this.patterns[z].bin,et=W.x+1,Z=W.y+1,it=this.images[z].data,ot=it.width,bt=it.height;o.RGBAImage.copy(it,F,{x:0,y:0},{x:et,y:Z},{width:ot,height:bt}),o.RGBAImage.copy(it,F,{x:0,y:bt-1},{x:et,y:Z-1},{width:ot,height:1}),o.RGBAImage.copy(it,F,{x:0,y:0},{x:et,y:Z+bt},{width:ot,height:1}),o.RGBAImage.copy(it,F,{x:ot-1,y:0},{x:et-1,y:Z},{width:1,height:bt}),o.RGBAImage.copy(it,F,{x:0,y:0},{x:et+ot,y:Z},{width:1,height:bt})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(f){for(var m=0,E=f;m<E.length;m+=1){var P=E[m];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var R=this.images[P];j(R)&&this.updateImage(P,R)}}},d}(o.Evented),K=$,Q=$,pt=1e20;function $(l,d,f,m,E,P){this.fontSize=l||24,this.buffer=d===void 0?3:d,this.cutoff=m||.25,this.fontFamily=E||"sans-serif",this.fontWeight=P||"normal",this.radius=f||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function zt(l,d,f,m,E,P,R){for(var F=0;F<d;F++){for(var z=0;z<f;z++)m[z]=l[z*d+F];for(Gt(m,E,P,R,f),z=0;z<f;z++)l[z*d+F]=E[z]}for(z=0;z<f;z++){for(F=0;F<d;F++)m[F]=l[z*d+F];for(Gt(m,E,P,R,d),F=0;F<d;F++)l[z*d+F]=Math.sqrt(E[F])}}function Gt(l,d,f,m,E){f[0]=0,m[0]=-pt,m[1]=+pt;for(var P=1,R=0;P<E;P++){for(var F=(l[P]+P*P-(l[f[R]]+f[R]*f[R]))/(2*P-2*f[R]);F<=m[R];)R--,F=(l[P]+P*P-(l[f[R]]+f[R]*f[R]))/(2*P-2*f[R]);f[++R]=P,m[R]=F,m[R+1]=+pt}for(P=0,R=0;P<E;P++){for(;m[R+1]<P;)R++;d[P]=(P-f[R])*(P-f[R])+l[f[R]]}}$.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var E=d.data[4*m+3]/255;this.gridOuter[m]=E===1?0:E===0?pt:Math.pow(Math.max(0,.5-E),2),this.gridInner[m]=E===1?pt:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(zt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),zt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)f[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return f},K.default=Q;var dt=function(l,d){this.requestManager=l,this.localIdeographFontFamily=d,this.entries={}};dt.prototype.setURL=function(l){this.url=l},dt.prototype.getGlyphs=function(l,d){var f=this,m=[];for(var E in l)for(var P=0,R=l[E];P<R.length;P+=1)m.push({stack:E,id:R[P]});o.asyncAll(m,function(F,z){var W=F.stack,et=F.id,Z=f.entries[W];Z||(Z=f.entries[W]={glyphs:{},requests:{},ranges:{}});var it=Z.glyphs[et];if(it===void 0){if(it=f._tinySDF(Z,W,et))return Z.glyphs[et]=it,void z(null,{stack:W,id:et,glyph:it});var ot=Math.floor(et/256);if(256*ot>65535)z(new Error("glyphs > 65535 not supported"));else if(Z.ranges[ot])z(null,{stack:W,id:et,glyph:it});else{var bt=Z.requests[ot];bt||(bt=Z.requests[ot]=[],dt.loadGlyphRange(W,ot,f.url,f.requestManager,function(Pt,mt){if(mt){for(var It in mt)f._doesCharSupportLocalGlyph(+It)||(Z.glyphs[+It]=mt[+It]);Z.ranges[ot]=!0}for(var Vt=0,Jt=bt;Vt<Jt.length;Vt+=1)(0,Jt[Vt])(Pt,mt);delete Z.requests[ot]})),bt.push(function(Pt,mt){Pt?z(Pt):mt&&z(null,{stack:W,id:et,glyph:mt[et]||null})})}}else z(null,{stack:W,id:et,glyph:it})},function(F,z){if(F)d(F);else if(z){for(var W={},et=0,Z=z;et<Z.length;et+=1){var it=Z[et],ot=it.stack,bt=it.id,Pt=it.glyph;(W[ot]||(W[ot]={}))[bt]=Pt&&{id:Pt.id,bitmap:Pt.bitmap.clone(),metrics:Pt.metrics}}d(null,W)}})},dt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(o.isChar["CJK Unified Ideographs"](l)||o.isChar["Hangul Syllables"](l)||o.isChar.Hiragana(l)||o.isChar.Katakana(l))},dt.prototype._tinySDF=function(l,d,f){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(f)){var E=l.tinySDF;if(!E){var P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),E=l.tinySDF=new dt.TinySDF(24,3,8,.25,m,P)}return{id:f,bitmap:new o.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},dt.loadGlyphRange=function(l,d,f,m,E){var P=256*d,R=P+255,F=m.transformRequest(m.normalizeGlyphsURL(f).replace("{fontstack}",l).replace("{range}",P+"-"+R),o.ResourceType.Glyphs);o.getArrayBuffer(F,function(z,W){if(z)E(z);else if(W){for(var et={},Z=0,it=o.parseGlyphPBF(W);Z<it.length;Z+=1){var ot=it[Z];et[ot.id]=ot}E(null,et)}})},dt.TinySDF=K;var lt=function(){this.specification=o.styleSpec.light.position};lt.prototype.possiblyEvaluate=function(l,d){return o.sphericalToCartesian(l.expression.evaluate(d))},lt.prototype.interpolate=function(l,d,f){return{x:o.number(l.x,d.x,f),y:o.number(l.y,d.y,f),z:o.number(l.z,d.z,f)}};var Lt=new o.Properties({anchor:new o.DataConstantProperty(o.styleSpec.light.anchor),position:new lt,color:new o.DataConstantProperty(o.styleSpec.light.color),intensity:new o.DataConstantProperty(o.styleSpec.light.intensity)}),J=function(l){function d(f){l.call(this),this._transitionable=new o.Transitionable(Lt),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(f,m){if(m===void 0&&(m={}),!this._validate(o.validateLight,f,m))for(var E in f){var P=f[E];o.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-11),P):this._transitionable.setValue(E,P)}},d.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},d.prototype._validate=function(f,m,E){return(!E||E.validate!==!1)&&o.emitValidationErrors(this,f.call(o.validateStyle,o.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:o.styleSpec})))},d}(o.Evented),ut=function(l,d){this.width=l,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ut.prototype.getDash=function(l,d){var f=l.join(",")+String(d);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(l,d)),this.dashEntry[f]},ut.prototype.getDashRanges=function(l,d,f){var m=[],E=l.length%2==1?-l[l.length-1]*f:0,P=l[0]*f,R=!0;m.push({left:E,right:P,isDash:R,zeroLength:l[0]===0});for(var F=l[0],z=1;z<l.length;z++){var W=l[z];m.push({left:E=F*f,right:P=(F+=W)*f,isDash:R=!R,zeroLength:W===0})}return m},ut.prototype.addRoundDash=function(l,d,f){for(var m=d/2,E=-f;E<=f;E++)for(var P=this.width*(this.nextRow+f+E),R=0,F=l[R],z=0;z<this.width;z++){z/F.right>1&&(F=l[++R]);var W=Math.abs(z-F.left),et=Math.abs(z-F.right),Z=Math.min(W,et),it=void 0,ot=E/f*(m+1);if(F.isDash){var bt=m-Math.abs(ot);it=Math.sqrt(Z*Z+bt*bt)}else it=m-Math.sqrt(Z*Z+ot*ot);this.data[P+z]=Math.max(0,Math.min(255,it+128))}},ut.prototype.addRegularDash=function(l){for(var d=l.length-1;d>=0;--d){var f=l[d],m=l[d+1];f.zeroLength?l.splice(d,1):m&&m.isDash===f.isDash&&(m.left=f.left,l.splice(d,1))}var E=l[0],P=l[l.length-1];E.isDash===P.isDash&&(E.left=P.left-this.width,P.right=E.right+this.width);for(var R=this.width*this.nextRow,F=0,z=l[F],W=0;W<this.width;W++){W/z.right>1&&(z=l[++F]);var et=Math.abs(W-z.left),Z=Math.abs(W-z.right),it=Math.min(et,Z);this.data[R+W]=Math.max(0,Math.min(255,(z.isDash?it:-it)+128))}},ut.prototype.addDash=function(l,d){var f=d?7:0,m=2*f+1;if(this.nextRow+m>this.height)return o.warnOnce("LineAtlas out of space"),null;for(var E=0,P=0;P<l.length;P++)E+=l[P];if(E!==0){var R=this.width/E,F=this.getDashRanges(l,this.width,R);d?this.addRoundDash(F,R,f):this.addRegularDash(F)}var z={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:E};return this.nextRow+=m,this.dirty=!0,z},ut.prototype.bind=function(l){var d=l.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Et=function l(d,f){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=o.uniqueId();for(var m=this.workerPool.acquire(this.id),E=0;E<m.length;E++){var P=new l.Actor(m[E],f,this.id);P.name="Worker "+E,this.actors.push(P)}};function le(l,d,f){var m=function(E,P){if(E)return f(E);if(P){var R=o.pick(o.extend(P,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(R.vectorLayers=P.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(F){return F.id})),R.tiles=d.canonicalizeTileset(R,l.url),f(null,R)}};return l.url?o.getJSON(d.transformRequest(d.normalizeSourceURL(l.url),o.ResourceType.Source),m):o.browser.frame(function(){return m(null,l)})}Et.prototype.broadcast=function(l,d,f){o.asyncAll(this.actors,function(m,E){m.send(l,d,E)},f=f||function(){})},Et.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Et.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Et.Actor=o.Actor;var Ct=function(l,d,f){this.bounds=o.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=f||24};Ct.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Ct.prototype.contains=function(l){var d=Math.pow(2,l.z),f=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*d),m=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*d),E=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*d),P=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=f&&l.x<E&&l.y>=m&&l.y<P};var Rt=function(l){function d(f,m,E,P){if(l.call(this),this.id=f,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(m,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=le(this._options,this.map._requestManager,function(m,E){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new o.ErrorEvent(m)):E&&(o.extend(f,E),E.bounds&&(f.tileBounds=new Ct(E.bounds,f.minzoom,f.maxzoom)),o.postTurnstileEvent(E.tiles,f.map._requestManager._customAccessToken),o.postMapLoadEvent(E.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(f){var m=this;return this.setSourceProperty(function(){m._options.tiles=f}),this},d.prototype.setUrl=function(f){var m=this;return this.setSourceProperty(function(){m.url=f,m._options.url=f}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return o.extend({},this._options)},d.prototype.loadTile=function(f,m){var E=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(E,o.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(F,z){return delete f.request,f.aborted?m(null):F&&F.status!==404?m(F):(z&&z.resourceTiming&&(f.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&f.setExpiryData(z),f.loadVectorData(z,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=m:f.request=f.actor.send("reloadTile",P,R.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",P,R.bind(this)))},d.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(o.Evented),Nt=function(l){function d(f,m,E,P){l.call(this),this.id=f,this.dispatcher=E,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},m),o.extend(this,o.pick(m,["url","scheme","tileSize"]))}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=le(this._options,this.map._requestManager,function(m,E){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new o.ErrorEvent(m)):E&&(o.extend(f,E),E.bounds&&(f.tileBounds=new Ct(E.bounds,f.minzoom,f.maxzoom)),o.postTurnstileEvent(E.tiles),o.postMapLoadEvent(E.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return o.extend({},this._options)},d.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},d.prototype.loadTile=function(f,m){var E=this,P=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=o.getImage(this.map._requestManager.transformRequest(P,o.ResourceType.Tile),function(R,F){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(R)f.state="errored",m(R);else if(F){E.map._refreshExpiredTiles&&f.setExpiryData(F),delete F.cacheControl,delete F.expires;var z=E.map.painter.context,W=z.gl;f.texture=E.map.painter.getTileTexture(F.width),f.texture?f.texture.update(F,{useMipmap:!0}):(f.texture=new o.Texture(z,F,W.RGBA,{useMipmap:!0}),f.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),z.extTextureFilterAnisotropic&&W.texParameterf(W.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax)),f.state="loaded",o.cacheEntryPossiblyAdded(E.dispatcher),m(null)}})},d.prototype.abortTile=function(f,m){f.request&&(f.request.cancel(),delete f.request),m()},d.prototype.unloadTile=function(f,m){f.texture&&this.map.painter.saveTileTexture(f.texture),m()},d.prototype.hasTransition=function(){return!1},d}(o.Evented),Zt=function(l){function d(f,m,E,P){l.call(this,f,m,E,P),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(f,m){var E=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(R,F){R&&(f.state="errored",m(R)),F&&(f.dem=F,f.needsHillshadePrepare=!0,f.state="loaded",m(null))}f.request=o.getImage(this.map._requestManager.transformRequest(E,o.ResourceType.Tile),(function(R,F){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(R)f.state="errored",m(R);else if(F){this.map._refreshExpiredTiles&&f.setExpiryData(F),delete F.cacheControl,delete F.expires;var z=o.window.ImageBitmap&&F instanceof o.window.ImageBitmap&&o.offscreenCanvasSupported()?F:o.browser.getImageData(F,1),W={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:z,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",W,P.bind(this)))}}).bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},d.prototype._getNeighboringTiles=function(f){var m=f.canonical,E=Math.pow(2,m.z),P=(m.x-1+E)%E,R=m.x===0?f.wrap-1:f.wrap,F=(m.x+1+E)%E,z=m.x+1===E?f.wrap+1:f.wrap,W={};return W[new o.OverscaledTileID(f.overscaledZ,R,m.z,P,m.y).key]={backfilled:!1},W[new o.OverscaledTileID(f.overscaledZ,z,m.z,F,m.y).key]={backfilled:!1},m.y>0&&(W[new o.OverscaledTileID(f.overscaledZ,R,m.z,P,m.y-1).key]={backfilled:!1},W[new o.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},W[new o.OverscaledTileID(f.overscaledZ,z,m.z,F,m.y-1).key]={backfilled:!1}),m.y+1<E&&(W[new o.OverscaledTileID(f.overscaledZ,R,m.z,P,m.y+1).key]={backfilled:!1},W[new o.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},W[new o.OverscaledTileID(f.overscaledZ,z,m.z,F,m.y+1).key]={backfilled:!1}),W},d.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},d}(Nt),re=function(l){function d(f,m,E,P){l.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(P),this._data=m.data,this._options=o.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var R=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*R,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*R,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:o.EXTENT,radius:(m.clusterRadius||50)*R,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var f=this;this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)f.fire(new o.ErrorEvent(m));else{var E={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(E.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new o.Event("data",E))}})},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setData=function(f){var m=this;return this._data=f,this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)m.fire(new o.ErrorEvent(E));else{var P={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(P.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new o.Event("data",P))}}),this},d.prototype.getClusterExpansionZoom=function(f,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},m),this},d.prototype.getClusterChildren=function(f,m){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},m),this},d.prototype.getClusterLeaves=function(f,m,E,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:m,offset:E},P),this},d.prototype._updateWorkerData=function(f){var m=this;this._loaded=!1;var E=o.extend({},this.workerOptions),P=this._data;typeof P=="string"?(E.request=this.map._requestManager.transformRequest(o.browser.resolveURL(P),o.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(P),this.actor.send(this.type+".loadData",E,function(R,F){m._removed||F&&F.abandoned||(m._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[m.id]&&(m._resourceTiming=F.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:E.source},null),f(R))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(f,m){var E=this,P=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(P,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,F){return delete f.request,f.unloadVectorData(),f.aborted?m(null):R?m(R):(f.loadVectorData(F,E.map.painter,P==="reloadTile"),m(null))})},d.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},d.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return o.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(o.Evented),se=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),de=function(l){function d(f,m,E,P){l.call(this),this.id=f,this.dispatcher=E,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=m}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(f,m){var E=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),function(P,R){E._loaded=!0,P?E.fire(new o.ErrorEvent(P)):R&&(E.image=R,f&&(E.coordinates=f),m&&m(),E._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(f){var m=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){m.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(f){this.map=f,this.load()},d.prototype.setCoordinates=function(f){var m=this;this.coordinates=f;var E=f.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var F=1/0,z=1/0,W=-1/0,et=-1/0,Z=0,it=R;Z<it.length;Z+=1){var ot=it[Z];F=Math.min(F,ot.x),z=Math.min(z,ot.y),W=Math.max(W,ot.x),et=Math.max(et,ot.y)}var bt=Math.max(W-F,et-z),Pt=Math.max(0,Math.floor(-Math.log(bt)/Math.LN2)),mt=Math.pow(2,Pt);return new o.CanonicalTileID(Pt,Math.floor((F+W)/2*mt),Math.floor((z+et)/2*mt))}(E),this.minzoom=this.maxzoom=this.tileID.z;var P=E.map(function(R){return m.tileID.getTilePoint(R)._round()});return this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,m=f.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,se.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(f,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[E];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.loadTile=function(f,m){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},m(null)):(f.state="errored",m(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(o.Evented),Me=function(l){function d(f,m,E,P){l.call(this,f,m,E,P),this.roundZoom=!0,this.type="video",this.options=m}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){var f=this;this._loaded=!1;var m=this.options;this.urls=[];for(var E=0,P=m.urls;E<P.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(P[E],o.ResourceType.Source).url);o.getVideo(this.urls,function(R,F){f._loaded=!0,R?f.fire(new o.ErrorEvent(R)):F&&(f.video=F,f.video.loop=!0,f.video.setAttribute("playsinline",""),f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(f){if(this.video){var m=this.video.seekable;f<m.start(0)||f>m.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=f}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,m=f.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,se.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(f,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[E];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(de),Se=function(l){function d(f,m,E,P){l.call(this,f,m,E,P),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(F){return typeof F!="number"})})||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,E=m.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,se.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(m,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[P];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var f=0,m=[this.canvas.width,this.canvas.height];f<m.length;f+=1){var E=m[f];if(isNaN(E)||E<=0)return!0}return!1},d}(de),oe={vector:Rt,raster:Nt,"raster-dem":Zt,geojson:re,video:Me,image:de,canvas:Se};function Ai(l,d){var f=o.identity([]);return o.translate(f,f,[1,1,0]),o.scale(f,f,[.5*l.width,.5*l.height,1]),o.multiply(f,f,l.calculatePosMatrix(d.toUnwrapped()))}function Ke(l,d,f,m,E,P){var R=function(Pt,mt,It){if(Pt)for(var Vt=0,Jt=Pt;Vt<Jt.length;Vt+=1){var te=mt[Jt[Vt]];if(te&&te.source===It&&te.type==="fill-extrusion")return!0}else for(var Qt in mt){var $t=mt[Qt];if($t.source===It&&$t.type==="fill-extrusion")return!0}return!1}(E&&E.layers,d,l.id),F=P.maxPitchScaleFactor(),z=l.tilesIn(m,F,R);z.sort(qe);for(var W=[],et=0,Z=z;et<Z.length;et+=1){var it=Z[et];W.push({wrappedTileID:it.tileID.wrapped().key,queryResults:it.tile.queryRenderedFeatures(d,f,l._state,it.queryGeometry,it.cameraQueryGeometry,it.scale,E,P,F,Ai(l.transform,it.tileID))})}var ot=function(Pt){for(var mt={},It={},Vt=0,Jt=Pt;Vt<Jt.length;Vt+=1){var te=Jt[Vt],Qt=te.queryResults,$t=te.wrappedTileID,pe=It[$t]=It[$t]||{};for(var Oe in Qt)for(var xe=Qt[Oe],Ue=pe[Oe]=pe[Oe]||{},oi=mt[Oe]=mt[Oe]||[],Ei=0,Si=xe;Ei<Si.length;Ei+=1){var xn=Si[Ei];Ue[xn.featureIndex]||(Ue[xn.featureIndex]=!0,oi.push(xn))}}return mt}(W);for(var bt in ot)ot[bt].forEach(function(Pt){var mt=Pt.feature,It=l.getFeatureState(mt.layer["source-layer"],mt.id);mt.source=mt.layer.source,mt.layer["source-layer"]&&(mt.sourceLayer=mt.layer["source-layer"]),mt.state=It});return ot}function qe(l,d){var f=l.tileID,m=d.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}var Ve=function(l,d){this.max=l,this.onRemove=d,this.reset()};Ve.prototype.reset=function(){for(var l in this.data)for(var d=0,f=this.data[l];d<f.length;d+=1){var m=f[d];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},Ve.prototype.add=function(l,d,f){var m=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var P={value:d,timeout:void 0};if(f!==void 0&&(P.timeout=setTimeout(function(){m.remove(l,P)},f)),this.data[E].push(P),this.order.push(E),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},Ve.prototype.has=function(l){return l.wrapped().key in this.data},Ve.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Ve.prototype._getAndRemoveByKey=function(l){var d=this.data[l].shift();return d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),d.value},Ve.prototype.getByKey=function(l){var d=this.data[l];return d?d[0].value:null},Ve.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Ve.prototype.remove=function(l,d){if(!this.has(l))return this;var f=l.wrapped().key,m=d===void 0?0:this.data[f].indexOf(d),E=this.data[f][m];return this.data[f].splice(m,1),E.timeout&&clearTimeout(E.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(E.value),this.order.splice(this.order.indexOf(f),1),this},Ve.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Ve.prototype.filter=function(l){var d=[];for(var f in this.data)for(var m=0,E=this.data[f];m<E.length;m+=1){var P=E[m];l(P.value)||d.push(P)}for(var R=0,F=d;R<F.length;R+=1){var z=F[R];this.remove(z.value.tileID,z)}};var di=function(l,d,f){this.context=l;var m=l.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};di.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},di.prototype.updateData=function(l){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},di.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var cn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ri=function(l,d,f,m){this.length=d.length,this.attributes=f,this.itemSize=d.bytesPerElement,this.dynamicDraw=m,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer};Ri.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ri.prototype.updateData=function(l){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)},Ri.prototype.enableAttributes=function(l,d){for(var f=0;f<this.attributes.length;f++){var m=d.attributes[this.attributes[f].name];m!==void 0&&l.enableVertexAttribArray(m)}},Ri.prototype.setVertexAttribPointers=function(l,d,f){for(var m=0;m<this.attributes.length;m++){var E=this.attributes[m],P=d.attributes[E.name];P!==void 0&&l.vertexAttribPointer(P,E.components,l[cn[E.type]],!1,this.itemSize,E.offset+this.itemSize*(f||0))}},Ri.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var bi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};bi.prototype.get=function(){return this.current},bi.prototype.set=function(l){},bi.prototype.getDefault=function(){return this.default},bi.prototype.setDefault=function(){this.set(this.default)};var Vn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return o.Color.transparent},d.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},d}(bi),yi=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},d}(bi),vi=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},d}(bi),un=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},d}(bi),Di=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},d}(bi),lr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},d}(bi),Yn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(f){var m=this.current;(f.func!==m.func||f.ref!==m.ref||f.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},d}(bi),mn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},d}(bi),ir=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=f,this.dirty=!1}},d}(bi),Hn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},d}(bi),Tn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=f,this.dirty=!1}},d}(bi),$n=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},d}(bi),Ge=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.BLEND):m.disable(m.BLEND),this.current=f,this.dirty=!1}},d}(bi),gi=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},d}(bi),Mi=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return o.Color.transparent},d.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},d}(bi),rn=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},d}(bi),yr=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=f,this.dirty=!1}},d}(bi),St=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},d}(bi),ke=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},d}(bi),Je=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},d}(bi),li=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},d}(bi),Yt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},d.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},d}(bi),Re=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},d}(bi),gt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},d}(bi),ze=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,f),this.current=f,this.dirty=!1}},d}(bi),we=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},d}(bi),V=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},d}(bi),ve=function(l){function d(f){l.call(this,f),this.vao=f.extVertexArrayObject}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},d}(bi),Be=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},d}(bi),xt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},d}(bi),Xt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},d}(bi),ce=function(l){function d(f,m){l.call(this,f),this.context=f,this.parent=m}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(bi),q=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},d}(ce),nt=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},d}(ce),at=function(l,d,f,m){this.context=l,this.width=d,this.height=f;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new q(l,E),m&&(this.depthAttachment=new nt(l,E))};at.prototype.destroy=function(){var l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){var f=this.depthAttachment.get();f&&l.deleteRenderbuffer(f)}l.deleteFramebuffer(this.framebuffer)};var vt=function(l,d,f){this.func=l,this.mask=d,this.range=f};vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);var Ot=function(l,d,f,m,E,P){this.test=l,this.ref=d,this.mask=f,this.fail=m,this.depthFail=E,this.pass=P};Ot.disabled=new Ot({func:519,mask:0},0,0,7680,7680,7680);var ft=function(l,d,f){this.blendFunction=l,this.blendColor=d,this.mask=f};ft.disabled=new ft(ft.Replace=[1,0],o.Color.transparent,[!1,!1,!1,!1]),ft.unblended=new ft(ft.Replace,o.Color.transparent,[!0,!0,!0,!0]),ft.alphaBlended=new ft([1,771],o.Color.transparent,[!0,!0,!0,!0]);var _t=function(l,d,f){this.enable=l,this.mode=d,this.frontFace=f};_t.disabled=new _t(!1,1029,2305),_t.backCCW=new _t(!0,1029,2305);var st=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Vn(this),this.clearDepth=new yi(this),this.clearStencil=new vi(this),this.colorMask=new un(this),this.depthMask=new Di(this),this.stencilMask=new lr(this),this.stencilFunc=new Yn(this),this.stencilOp=new mn(this),this.stencilTest=new ir(this),this.depthRange=new Hn(this),this.depthTest=new Tn(this),this.depthFunc=new $n(this),this.blend=new Ge(this),this.blendFunc=new gi(this),this.blendColor=new Mi(this),this.blendEquation=new rn(this),this.cullFace=new yr(this),this.cullFaceSide=new St(this),this.frontFace=new ke(this),this.program=new Je(this),this.activeTexture=new li(this),this.viewport=new Yt(this),this.bindFramebuffer=new Re(this),this.bindRenderbuffer=new gt(this),this.bindTexture=new ze(this),this.bindVertexBuffer=new we(this),this.bindElementBuffer=new V(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ve(this),this.pixelStoreUnpack=new Be(this),this.pixelStoreUnpackPremultiplyAlpha=new xt(this),this.pixelStoreUnpackFlipY=new Xt(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};st.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},st.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},st.prototype.createIndexBuffer=function(l,d){return new di(this,l,d)},st.prototype.createVertexBuffer=function(l,d,f){return new Ri(this,l,d,f)},st.prototype.createRenderbuffer=function(l,d,f){var m=this.gl,E=m.createRenderbuffer();return this.bindRenderbuffer.set(E),m.renderbufferStorage(m.RENDERBUFFER,l,d,f),this.bindRenderbuffer.set(null),E},st.prototype.createFramebuffer=function(l,d,f){return new at(this,l,d,f)},st.prototype.clear=function(l){var d=l.color,f=l.depth,m=this.gl,E=0;d&&(E|=m.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(E|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m.clear(E)},st.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},st.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},st.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},st.prototype.setColorMode=function(l){o.deepEqual(l.blendFunction,ft.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},st.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var wt=function(l){function d(f,m,E){var P=this;l.call(this),this.id=f,this.dispatcher=E,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=function(R,F,z,W){var et=new oe[F.type](R,F,z,W);if(et.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+et.id);return o.bindAll(["load","abort","unload","serialize","prepare"],et),et}(f,m,E,this),this._tiles={},this._cache=new Ve(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new o.SourceFeatureState}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},d.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var m=this._tiles[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(f,m){return this._source.loadTile(f,m)},d.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},d.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(f){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[m];E.upload(f),E.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return o.values(this._tiles).map(function(f){return f.tileID}).sort(g).map(function(f){return f.key})},d.prototype.getRenderableIds=function(f){var m=this,E=[];for(var P in this._tiles)this._isIdRenderable(P,f)&&E.push(this._tiles[P]);return f?E.sort(function(R,F){var z=R.tileID,W=F.tileID,et=new o.Point(z.canonical.x,z.canonical.y)._rotate(m.transform.angle),Z=new o.Point(W.canonical.x,W.canonical.y)._rotate(m.transform.angle);return z.overscaledZ-W.overscaledZ||Z.y-et.y||Z.x-et.x}).map(function(R){return R.tileID.key}):E.map(function(R){return R.tileID}).sort(g).map(function(R){return R.key})},d.prototype.hasRenderableParent=function(f){var m=this.findLoadedParent(f,0);return!!m&&this._isIdRenderable(m.tileID.key)},d.prototype._isIdRenderable=function(f,m){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(m||!this._tiles[f].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},d.prototype._reloadTile=function(f,m){var E=this._tiles[f];E&&(E.state!=="loading"&&(E.state=m),this._loadTile(E,this._tileLoaded.bind(this,E,f,m)))},d.prototype._tileLoaded=function(f,m,E,P){if(P)return f.state="errored",void(P.status!==404?this._source.fire(new o.ErrorEvent(P,{tile:f})):this.update(this.transform));f.timeAdded=o.browser.now(),E==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(m,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new o.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},d.prototype._backfillDEM=function(f){for(var m=this.getRenderableIds(),E=0;E<m.length;E++){var P=m[E];if(f.neighboringTiles&&f.neighboringTiles[P]){var R=this.getTileByID(P);F(f,R),F(R,f)}}function F(z,W){z.needsHillshadePrepare=!0;var et=W.tileID.canonical.x-z.tileID.canonical.x,Z=W.tileID.canonical.y-z.tileID.canonical.y,it=Math.pow(2,z.tileID.canonical.z),ot=W.tileID.key;et===0&&Z===0||Math.abs(Z)>1||(Math.abs(et)>1&&(Math.abs(et+it)===1?et+=it:Math.abs(et-it)===1&&(et-=it)),W.dem&&z.dem&&(z.dem.backfillBorder(W.dem,et,Z),z.neighboringTiles&&z.neighboringTiles[ot]&&(z.neighboringTiles[ot].backfilled=!0)))}},d.prototype.getTile=function(f){return this.getTileByID(f.key)},d.prototype.getTileByID=function(f){return this._tiles[f]},d.prototype._retainLoadedChildren=function(f,m,E,P){for(var R in this._tiles){var F=this._tiles[R];if(!(P[R]||!F.hasData()||F.tileID.overscaledZ<=m||F.tileID.overscaledZ>E)){for(var z=F.tileID;F&&F.tileID.overscaledZ>m+1;){var W=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[W.key])&&F.hasData()&&(z=W)}for(var et=z;et.overscaledZ>m;)if(f[(et=et.scaledTo(et.overscaledZ-1)).key]){P[z.key]=z;break}}}},d.prototype.findLoadedParent=function(f,m){if(f.key in this._loadedParentTiles){var E=this._loadedParentTiles[f.key];return E&&E.tileID.overscaledZ>=m?E:null}for(var P=f.overscaledZ-1;P>=m;P--){var R=f.scaledTo(P),F=this._getLoadedTile(R);if(F)return F}},d.prototype._getLoadedTile=function(f){var m=this._tiles[f.key];return m&&m.hasData()?m:this._cache.getByKey(f.wrapped().key)},d.prototype.updateCacheSize=function(f){var m=Math.ceil(f.width/this._source.tileSize)+1,E=Math.ceil(f.height/this._source.tileSize)+1,P=Math.floor(m*E*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(R)},d.prototype.handleWrapJump=function(f){var m=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,m){var E={};for(var P in this._tiles){var R=this._tiles[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+m),E[R.tileID.key]=R}for(var F in this._tiles=E,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var z in this._tiles)this._setTileReloadTimer(z,this._tiles[z])}},d.prototype.update=function(f){var m=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(pe){return new o.OverscaledTileID(pe.canonical.z,pe.wrap,pe.canonical.z,pe.canonical.x,pe.canonical.y)}):(E=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(pe){return m._source.hasTile(pe)}))):E=[];var P=f.coveringZoomLevel(this._source),R=Math.max(P-d.maxOverzooming,this._source.minzoom),F=Math.max(P+d.maxUnderzooming,this._source.minzoom),z=this._updateRetainedTiles(E,P);if(ct(this._source.type)){for(var W={},et={},Z=0,it=Object.keys(z);Z<it.length;Z+=1){var ot=it[Z],bt=z[ot],Pt=this._tiles[ot];if(Pt&&!(Pt.fadeEndTime&&Pt.fadeEndTime<=o.browser.now())){var mt=this.findLoadedParent(bt,R);mt&&(this._addTile(mt.tileID),W[mt.tileID.key]=mt.tileID),et[ot]=bt}}for(var It in this._retainLoadedChildren(et,P,F,z),W)z[It]||(this._coveredTiles[It]=!0,z[It]=W[It])}for(var Vt in z)this._tiles[Vt].clearFadeHold();for(var Jt=0,te=o.keysDifference(this._tiles,z);Jt<te.length;Jt+=1){var Qt=te[Jt],$t=this._tiles[Qt];$t.hasSymbolBuckets&&!$t.holdingForFade()?$t.setHoldDuration(this.map._fadeDuration):$t.hasSymbolBuckets&&!$t.symbolFadeFinished()||this._removeTile(Qt)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},d.prototype._updateRetainedTiles=function(f,m){for(var E={},P={},R=Math.max(m-d.maxOverzooming,this._source.minzoom),F=Math.max(m+d.maxUnderzooming,this._source.minzoom),z={},W=0,et=f;W<et.length;W+=1){var Z=et[W],it=this._addTile(Z);E[Z.key]=Z,it.hasData()||m<this._source.maxzoom&&(z[Z.key]=Z)}this._retainLoadedChildren(z,m,F,E);for(var ot=0,bt=f;ot<bt.length;ot+=1){var Pt=bt[ot],mt=this._tiles[Pt.key];if(!mt.hasData()){if(m+1>this._source.maxzoom){var It=Pt.children(this._source.maxzoom)[0],Vt=this.getTile(It);if(Vt&&Vt.hasData()){E[It.key]=It;continue}}else{var Jt=Pt.children(this._source.maxzoom);if(E[Jt[0].key]&&E[Jt[1].key]&&E[Jt[2].key]&&E[Jt[3].key])continue}for(var te=mt.wasRequested(),Qt=Pt.overscaledZ-1;Qt>=R;--Qt){var $t=Pt.scaledTo(Qt);if(P[$t.key]||(P[$t.key]=!0,!(mt=this.getTile($t))&&te&&(mt=this._addTile($t)),mt&&(E[$t.key]=$t,te=mt.wasRequested(),mt.hasData())))break}}}return E},d.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var m=[],E=void 0,P=this._tiles[f].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){E=this._loadedParentTiles[P.key];break}m.push(P.key);var R=P.scaledTo(P.overscaledZ-1);if(E=this._getLoadedTile(R))break;P=R}for(var F=0,z=m;F<z.length;F+=1)this._loadedParentTiles[z[F]]=E}},d.prototype._addTile=function(f){var m=this._tiles[f.key];if(m)return m;(m=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,m),m.tileID=f,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,m)));var E=!!m;return E||(m=new o.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,f.key,m.state))),m?(m.uses++,this._tiles[f.key]=m,E||this._source.fire(new o.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},d.prototype._setTileReloadTimer=function(f,m){var E=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var P=m.getExpiryTimeout();P&&(this._timers[f]=setTimeout(function(){E._reloadTile(f,"expired"),delete E._timers[f]},P))},d.prototype._removeTile=function(f){var m=this._tiles[f];m&&(m.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},d.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},d.prototype.tilesIn=function(f,m,E){var P=this,R=[],F=this.transform;if(!F)return R;for(var z=E?F.getCameraQueryGeometry(f):f,W=f.map(function(Qt){return F.pointCoordinate(Qt)}),et=z.map(function(Qt){return F.pointCoordinate(Qt)}),Z=this.getIds(),it=1/0,ot=1/0,bt=-1/0,Pt=-1/0,mt=0,It=et;mt<It.length;mt+=1){var Vt=It[mt];it=Math.min(it,Vt.x),ot=Math.min(ot,Vt.y),bt=Math.max(bt,Vt.x),Pt=Math.max(Pt,Vt.y)}for(var Jt=function(Qt){var $t=P._tiles[Z[Qt]];if(!$t.holdingForFade()){var pe=$t.tileID,Oe=Math.pow(2,F.zoom-$t.tileID.overscaledZ),xe=m*$t.queryPadding*o.EXTENT/$t.tileSize/Oe,Ue=[pe.getTilePoint(new o.MercatorCoordinate(it,ot)),pe.getTilePoint(new o.MercatorCoordinate(bt,Pt))];if(Ue[0].x-xe<o.EXTENT&&Ue[0].y-xe<o.EXTENT&&Ue[1].x+xe>=0&&Ue[1].y+xe>=0){var oi=W.map(function(Si){return pe.getTilePoint(Si)}),Ei=et.map(function(Si){return pe.getTilePoint(Si)});R.push({tile:$t,tileID:pe,queryGeometry:oi,cameraQueryGeometry:Ei,scale:Oe})}}},te=0;te<Z.length;te++)Jt(te);return R},d.prototype.getVisibleCoordinates=function(f){for(var m=this,E=this.getRenderableIds(f).map(function(z){return m._tiles[z].tileID}),P=0,R=E;P<R.length;P+=1){var F=R[P];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return E},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ct(this._source.type))for(var f in this._tiles){var m=this._tiles[f];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=o.browser.now())return!0}return!1},d.prototype.setFeatureState=function(f,m,E){this._state.updateState(f=f||"_geojsonTileLayer",m,E)},d.prototype.removeFeatureState=function(f,m,E){this._state.removeFeatureState(f=f||"_geojsonTileLayer",m,E)},d.prototype.getFeatureState=function(f,m){return this._state.getState(f=f||"_geojsonTileLayer",m)},d.prototype.setDependencies=function(f,m,E){var P=this._tiles[f];P&&P.setDependencies(m,E)},d.prototype.reloadTilesForDependencies=function(f,m){for(var E in this._tiles)this._tiles[E].hasDependency(f,m)&&this._reloadTile(E,"reloading");this._cache.filter(function(P){return!P.hasDependency(f,m)})},d}(o.Evented);function g(l,d){var f=Math.abs(2*l.wrap)-+(l.wrap<0),m=Math.abs(2*d.wrap)-+(d.wrap<0);return l.overscaledZ-d.overscaledZ||m-f||d.canonical.y-l.canonical.y||d.canonical.x-l.canonical.x}function ct(l){return l==="raster"||l==="image"||l==="video"}function Ce(){return new o.window.Worker(O.workerUrl)}wt.maxOverzooming=10,wt.maxUnderzooming=3;var Kt="mapboxgl_preloaded_worker_pool",Ee=function(){this.active={}};Ee.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<Ee.workerCount;)this.workers.push(new Ce);return this.active[l]=!0,this.workers.slice()},Ee.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Ee.prototype.isPreloaded=function(){return!!this.active[Kt]},Ee.prototype.numActive=function(){return Object.keys(this.active).length};var Pe,Le=Math.floor(o.browser.hardwareConcurrency/2);function he(){return Pe||(Pe=new Ee),Pe}function Fe(l,d){var f={};for(var m in l)m!=="ref"&&(f[m]=l[m]);return o.refProperties.forEach(function(E){E in d&&(f[E]=d[E])}),f}function Ie(l){l=l.slice();for(var d=Object.create(null),f=0;f<l.length;f++)d[l[f].id]=l[f];for(var m=0;m<l.length;m++)"ref"in l[m]&&(l[m]=Fe(l[m],d[l[m].ref]));return l}Ee.workerCount=Math.max(Math.min(Le,6),1);var je={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ni(l,d,f){f.push({command:je.addSource,args:[l,d[l]]})}function ti(l,d,f){d.push({command:je.removeSource,args:[l]}),f[l]=!0}function tn(l,d,f,m){ti(l,f,m),Ni(l,d,f)}function ln(l,d,f){var m;for(m in l[f])if(l[f].hasOwnProperty(m)&&m!=="data"&&!o.deepEqual(l[f][m],d[f][m]))return!1;for(m in d[f])if(d[f].hasOwnProperty(m)&&m!=="data"&&!o.deepEqual(l[f][m],d[f][m]))return!1;return!0}function Ji(l,d,f,m,E,P){var R;for(R in d=d||{},l=l||{})l.hasOwnProperty(R)&&(o.deepEqual(l[R],d[R])||f.push({command:P,args:[m,R,d[R],E]}));for(R in d)d.hasOwnProperty(R)&&!l.hasOwnProperty(R)&&(o.deepEqual(l[R],d[R])||f.push({command:P,args:[m,R,d[R],E]}))}function Xi(l){return l.id}function Gi(l,d){return l[d.id]=d,l}var vr=function(l,d){this.reset(l,d)};vr.prototype.reset=function(l,d){this.points=l||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},vr.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=o.clamp(l,0,1);for(var d=1,f=this._distances[d],m=l*this.paddedLength+this.padding;f<m&&d<this._distances.length;)f=this._distances[++d];var E=d-1,P=this._distances[E],R=f-P,F=R>0?(m-P)/R:0;return this.points[E].mult(1-F).add(this.points[d].mult(F))};var Qi=function(l,d,f){var m=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/f),this.yCellCount=Math.ceil(d/f);for(var P=0;P<this.xCellCount*this.yCellCount;P++)m.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0};function mi(l,d,f,m,E){var P=o.create();return d?(o.scale(P,P,[1/E,1/E,1]),f||o.rotateZ(P,P,m.angle)):o.multiply(P,m.labelPlaneMatrix,l),P}function Bt(l,d,f,m,E){if(d){var P=o.clone(l);return o.scale(P,P,[E,E,1]),f||o.rotateZ(P,P,-m.angle),P}return m.glCoordMatrix}function Qe(l,d){var f=[l.x,l.y,0,1];hr(f,f,d);var m=f[3];return{point:new o.Point(f[0]/m,f[1]/m),signedDistanceFromCamera:m}}function en(l,d){return .5+l/d*.5}function Hr(l,d){var f=l[0]/l[3],m=l[1]/l[3];return f>=-d[0]&&f<=d[0]&&m>=-d[1]&&m<=d[1]}function va(l,d,f,m,E,P,R,F){var z=m?l.textSizeData:l.iconSizeData,W=o.evaluateSizeForZoom(z,f.transform.zoom),et=[256/f.width*2+1,256/f.height*2+1],Z=m?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Z.clear();for(var it=l.lineVertexArray,ot=m?l.text.placedSymbolArray:l.icon.placedSymbolArray,bt=f.transform.width/f.transform.height,Pt=!1,mt=0;mt<ot.length;mt++){var It=ot.get(mt);if(It.hidden||It.writingMode===o.WritingMode.vertical&&!Pt)Fr(It.numGlyphs,Z);else{Pt=!1;var Vt=[It.anchorX,It.anchorY,0,1];if(o.transformMat4(Vt,Vt,d),Hr(Vt,et)){var Jt=en(f.transform.cameraToCenterDistance,Vt[3]),te=o.evaluateSizeForFeature(z,W,It),Qt=R?te/Jt:te*Jt,$t=new o.Point(It.anchorX,It.anchorY),pe=Qe($t,E).point,Oe={},xe=Tt(It,Qt,!1,F,d,E,P,l.glyphOffsetArray,it,Z,pe,$t,Oe,bt);Pt=xe.useVertical,(xe.notEnoughRoom||Pt||xe.needsFlipping&&Tt(It,Qt,!0,F,d,E,P,l.glyphOffsetArray,it,Z,pe,$t,Oe,bt).notEnoughRoom)&&Fr(It.numGlyphs,Z)}else Fr(It.numGlyphs,Z)}}m?l.text.dynamicLayoutVertexBuffer.updateData(Z):l.icon.dynamicLayoutVertexBuffer.updateData(Z)}function ur(l,d,f,m,E,P,R,F,z,W,et){var Z=F.glyphStartIndex+F.numGlyphs,it=F.lineStartIndex,ot=F.lineStartIndex+F.lineLength,bt=d.getoffsetX(F.glyphStartIndex),Pt=d.getoffsetX(Z-1),mt=Jn(l*bt,f,m,E,P,R,F.segment,it,ot,z,W,et);if(!mt)return null;var It=Jn(l*Pt,f,m,E,P,R,F.segment,it,ot,z,W,et);return It?{first:mt,last:It}:null}function Wn(l,d,f,m){return l===o.WritingMode.horizontal&&Math.abs(f.y-d.y)>Math.abs(f.x-d.x)*m?{useVertical:!0}:(l===o.WritingMode.vertical?d.y<f.y:d.x>f.x)?{needsFlipping:!0}:null}function Tt(l,d,f,m,E,P,R,F,z,W,et,Z,it,ot){var bt,Pt=d/24,mt=l.lineOffsetX*Pt,It=l.lineOffsetY*Pt;if(l.numGlyphs>1){var Vt=l.glyphStartIndex+l.numGlyphs,Jt=l.lineStartIndex,te=l.lineStartIndex+l.lineLength,Qt=ur(Pt,F,mt,It,f,et,Z,l,z,P,it);if(!Qt)return{notEnoughRoom:!0};var $t=Qe(Qt.first.point,R).point,pe=Qe(Qt.last.point,R).point;if(m&&!f){var Oe=Wn(l.writingMode,$t,pe,ot);if(Oe)return Oe}bt=[Qt.first];for(var xe=l.glyphStartIndex+1;xe<Vt-1;xe++)bt.push(Jn(Pt*F.getoffsetX(xe),mt,It,f,et,Z,l.segment,Jt,te,z,P,it));bt.push(Qt.last)}else{if(m&&!f){var Ue=Qe(Z,E).point,oi=l.lineStartIndex+l.segment+1,Ei=new o.Point(z.getx(oi),z.gety(oi)),Si=Qe(Ei,E),xn=Si.signedDistanceFromCamera>0?Si.point:Ws(Z,Ei,Ue,1,E),ai=Wn(l.writingMode,Ue,xn,ot);if(ai)return ai}var Wi=Jn(Pt*F.getoffsetX(l.glyphStartIndex),mt,It,f,et,Z,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,z,P,it);if(!Wi)return{notEnoughRoom:!0};bt=[Wi]}for(var nn=0,Hi=bt;nn<Hi.length;nn+=1){var zi=Hi[nn];o.addDynamicAttributes(W,zi.point,zi.angle)}return{}}function Ws(l,d,f,m,E){var P=Qe(l.add(l.sub(d)._unit()),E).point,R=f.sub(P);return f.add(R._mult(m/R.mag()))}function Jn(l,d,f,m,E,P,R,F,z,W,et,Z){var it=m?l-d:l+d,ot=it>0?1:-1,bt=0;m&&(ot*=-1,bt=Math.PI),ot<0&&(bt+=Math.PI);for(var Pt=ot>0?F+R:F+R+1,mt=E,It=E,Vt=0,Jt=0,te=Math.abs(it),Qt=[];Vt+Jt<=te;){if((Pt+=ot)<F||Pt>=z)return null;if(It=mt,Qt.push(mt),(mt=Z[Pt])===void 0){var $t=new o.Point(W.getx(Pt),W.gety(Pt)),pe=Qe($t,et);if(pe.signedDistanceFromCamera>0)mt=Z[Pt]=pe.point;else{var Oe=Pt-ot;mt=Ws(Vt===0?P:new o.Point(W.getx(Oe),W.gety(Oe)),$t,It,te-Vt+1,et)}}Vt+=Jt,Jt=It.dist(mt)}var xe=(te-Vt)/Jt,Ue=mt.sub(It),oi=Ue.mult(xe)._add(It);oi._add(Ue._unit()._perp()._mult(f*ot));var Ei=bt+Math.atan2(mt.y-It.y,mt.x-It.x);return Qt.push(oi),{point:oi,angle:Ei,path:Qt}}Qi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qi.prototype.insert=function(l,d,f,m,E){this._forEachCell(d,f,m,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(E)},Qi.prototype.insertCircle=function(l,d,f,m){this._forEachCell(d-m,f-m,d+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(f),this.circles.push(m)},Qi.prototype._insertBoxCell=function(l,d,f,m,E,P){this.boxCells[E].push(P)},Qi.prototype._insertCircleCell=function(l,d,f,m,E,P){this.circleCells[E].push(P)},Qi.prototype._query=function(l,d,f,m,E,P){if(f<0||l>this.width||m<0||d>this.height)return!E&&[];var R=[];if(l<=0&&d<=0&&this.width<=f&&this.height<=m){if(E)return!0;for(var F=0;F<this.boxKeys.length;F++)R.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var z=0;z<this.circleKeys.length;z++){var W=this.circles[3*z],et=this.circles[3*z+1],Z=this.circles[3*z+2];R.push({key:this.circleKeys[z],x1:W-Z,y1:et-Z,x2:W+Z,y2:et+Z})}return P?R.filter(P):R}return this._forEachCell(l,d,f,m,this._queryCell,R,{hitTest:E,seenUids:{box:{},circle:{}}},P),E?R.length>0:R},Qi.prototype._queryCircle=function(l,d,f,m,E){var P=l-f,R=l+f,F=d-f,z=d+f;if(R<0||P>this.width||z<0||F>this.height)return!m&&[];var W=[];return this._forEachCell(P,F,R,z,this._queryCellCircle,W,{hitTest:m,circle:{x:l,y:d,radius:f},seenUids:{box:{},circle:{}}},E),m?W.length>0:W},Qi.prototype.query=function(l,d,f,m,E){return this._query(l,d,f,m,!1,E)},Qi.prototype.hitTest=function(l,d,f,m,E){return this._query(l,d,f,m,!0,E)},Qi.prototype.hitTestCircle=function(l,d,f,m){return this._queryCircle(l,d,f,!0,m)},Qi.prototype._queryCell=function(l,d,f,m,E,P,R,F){var z=R.seenUids,W=this.boxCells[E];if(W!==null)for(var et=this.bboxes,Z=0,it=W;Z<it.length;Z+=1){var ot=it[Z];if(!z.box[ot]){z.box[ot]=!0;var bt=4*ot;if(l<=et[bt+2]&&d<=et[bt+3]&&f>=et[bt+0]&&m>=et[bt+1]&&(!F||F(this.boxKeys[ot]))){if(R.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[ot],x1:et[bt],y1:et[bt+1],x2:et[bt+2],y2:et[bt+3]})}}}var Pt=this.circleCells[E];if(Pt!==null)for(var mt=this.circles,It=0,Vt=Pt;It<Vt.length;It+=1){var Jt=Vt[It];if(!z.circle[Jt]){z.circle[Jt]=!0;var te=3*Jt;if(this._circleAndRectCollide(mt[te],mt[te+1],mt[te+2],l,d,f,m)&&(!F||F(this.circleKeys[Jt]))){if(R.hitTest)return P.push(!0),!0;var Qt=mt[te],$t=mt[te+1],pe=mt[te+2];P.push({key:this.circleKeys[Jt],x1:Qt-pe,y1:$t-pe,x2:Qt+pe,y2:$t+pe})}}}},Qi.prototype._queryCellCircle=function(l,d,f,m,E,P,R,F){var z=R.circle,W=R.seenUids,et=this.boxCells[E];if(et!==null)for(var Z=this.bboxes,it=0,ot=et;it<ot.length;it+=1){var bt=ot[it];if(!W.box[bt]){W.box[bt]=!0;var Pt=4*bt;if(this._circleAndRectCollide(z.x,z.y,z.radius,Z[Pt+0],Z[Pt+1],Z[Pt+2],Z[Pt+3])&&(!F||F(this.boxKeys[bt])))return P.push(!0),!0}}var mt=this.circleCells[E];if(mt!==null)for(var It=this.circles,Vt=0,Jt=mt;Vt<Jt.length;Vt+=1){var te=Jt[Vt];if(!W.circle[te]){W.circle[te]=!0;var Qt=3*te;if(this._circlesCollide(It[Qt],It[Qt+1],It[Qt+2],z.x,z.y,z.radius)&&(!F||F(this.circleKeys[te])))return P.push(!0),!0}}},Qi.prototype._forEachCell=function(l,d,f,m,E,P,R,F){for(var z=this._convertToXCellCoord(l),W=this._convertToYCellCoord(d),et=this._convertToXCellCoord(f),Z=this._convertToYCellCoord(m),it=z;it<=et;it++)for(var ot=W;ot<=Z;ot++)if(E.call(this,l,d,f,m,this.xCellCount*ot+it,P,R,F))return},Qi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Qi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Qi.prototype._circlesCollide=function(l,d,f,m,E,P){var R=m-l,F=E-d,z=f+P;return z*z>R*R+F*F},Qi.prototype._circleAndRectCollide=function(l,d,f,m,E,P,R){var F=(P-m)/2,z=Math.abs(l-(m+F));if(z>F+f)return!1;var W=(R-E)/2,et=Math.abs(d-(E+W));if(et>W+f)return!1;if(z<=F||et<=W)return!0;var Z=z-F,it=et-W;return Z*Z+it*it<=f*f};var Js=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Fr(l,d){for(var f=0;f<l;f++){var m=d.length;d.resize(m+4),d.float32.set(Js,3*m)}}function hr(l,d,f){var m=d[0],E=d[1];return l[0]=f[0]*m+f[4]*E+f[12],l[1]=f[1]*m+f[5]*E+f[13],l[3]=f[3]*m+f[7]*E+f[15],l}var Mr=function(l,d,f){d===void 0&&(d=new Qi(l.width+200,l.height+200,25)),f===void 0&&(f=new Qi(l.width+200,l.height+200,25)),this.transform=l,this.grid=d,this.ignoredGrid=f,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Rn(l,d,f){return d*(o.EXTENT/(l.tileSize*Math.pow(2,f-l.tileID.overscaledZ)))}Mr.prototype.placeCollisionBox=function(l,d,f,m,E){var P=this.projectAndGetPerspectiveRatio(m,l.anchorPointX,l.anchorPointY),R=f*P.perspectiveRatio,F=l.x1*R+P.point.x,z=l.y1*R+P.point.y,W=l.x2*R+P.point.x,et=l.y2*R+P.point.y;return!this.isInsideGrid(F,z,W,et)||!d&&this.grid.hitTest(F,z,W,et,E)?{box:[],offscreen:!1}:{box:[F,z,W,et],offscreen:this.isOffscreen(F,z,W,et)}},Mr.prototype.placeCollisionCircles=function(l,d,f,m,E,P,R,F,z,W,et,Z,it){var ot=[],bt=new o.Point(d.anchorX,d.anchorY),Pt=Qe(bt,P),mt=en(this.transform.cameraToCenterDistance,Pt.signedDistanceFromCamera),It=(W?E/mt:E*mt)/o.ONE_EM,Vt=Qe(bt,R).point,Jt=ur(It,m,d.lineOffsetX*It,d.lineOffsetY*It,!1,Vt,bt,d,f,R,{}),te=!1,Qt=!1,$t=!0;if(Jt){for(var pe=.5*Z*mt+it,Oe=new o.Point(-100,-100),xe=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Ue=new vr,oi=Jt.first,Ei=Jt.last,Si=[],xn=oi.path.length-1;xn>=1;xn--)Si.push(oi.path[xn]);for(var ai=1;ai<Ei.path.length;ai++)Si.push(Ei.path[ai]);var Wi=2.5*pe;if(F){var nn=Si.map(function(Fs){return Qe(Fs,F)});Si=nn.some(function(Fs){return Fs.signedDistanceFromCamera<=0})?[]:nn.map(function(Fs){return Fs.point})}var Hi=[];if(Si.length>0){for(var zi=Si[0].clone(),Yi=Si[0].clone(),Fi=1;Fi<Si.length;Fi++)zi.x=Math.min(zi.x,Si[Fi].x),zi.y=Math.min(zi.y,Si[Fi].y),Yi.x=Math.max(Yi.x,Si[Fi].x),Yi.y=Math.max(Yi.y,Si[Fi].y);Hi=zi.x>=Oe.x&&Yi.x<=xe.x&&zi.y>=Oe.y&&Yi.y<=xe.y?[Si]:Yi.x<Oe.x||zi.x>xe.x||Yi.y<Oe.y||zi.y>xe.y?[]:o.clipLine([Si],Oe.x,Oe.y,xe.x,xe.y)}for(var Oi=0,Qr=Hi;Oi<Qr.length;Oi+=1){var Tr;Ue.reset(Qr[Oi],.25*pe),Tr=Ue.length<=.5*pe?1:Math.ceil(Ue.paddedLength/Wi)+1;for(var _o=0;_o<Tr;_o++){var oo=_o/Math.max(Tr-1,1),br=Ue.lerp(oo),Pr=br.x+100,us=br.y+100;ot.push(Pr,us,pe,0);var Ro=Pr-pe,Vc=us-pe,Qo=Pr+pe,sa=us+pe;if($t=$t&&this.isOffscreen(Ro,Vc,Qo,sa),Qt=Qt||this.isInsideGrid(Ro,Vc,Qo,sa),!l&&this.grid.hitTestCircle(Pr,us,pe,et)&&(te=!0,!z))return{circles:[],offscreen:!1,collisionDetected:te}}}}return{circles:!z&&te||!Qt?[]:ot,offscreen:$t,collisionDetected:te}},Mr.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],f=1/0,m=1/0,E=-1/0,P=-1/0,R=0,F=l;R<F.length;R+=1){var z=F[R],W=new o.Point(z.x+100,z.y+100);f=Math.min(f,W.x),m=Math.min(m,W.y),E=Math.max(E,W.x),P=Math.max(P,W.y),d.push(W)}for(var et={},Z={},it=0,ot=this.grid.query(f,m,E,P).concat(this.ignoredGrid.query(f,m,E,P));it<ot.length;it+=1){var bt=ot[it],Pt=bt.key;if(et[Pt.bucketInstanceId]===void 0&&(et[Pt.bucketInstanceId]={}),!et[Pt.bucketInstanceId][Pt.featureIndex]){var mt=[new o.Point(bt.x1,bt.y1),new o.Point(bt.x2,bt.y1),new o.Point(bt.x2,bt.y2),new o.Point(bt.x1,bt.y2)];o.polygonIntersectsPolygon(d,mt)&&(et[Pt.bucketInstanceId][Pt.featureIndex]=!0,Z[Pt.bucketInstanceId]===void 0&&(Z[Pt.bucketInstanceId]=[]),Z[Pt.bucketInstanceId].push(Pt.featureIndex))}}return Z},Mr.prototype.insertCollisionBox=function(l,d,f,m,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:m,collisionGroupID:E},l[0],l[1],l[2],l[3])},Mr.prototype.insertCollisionCircles=function(l,d,f,m,E){for(var P=d?this.ignoredGrid:this.grid,R={bucketInstanceId:f,featureIndex:m,collisionGroupID:E},F=0;F<l.length;F+=4)P.insertCircle(R,l[F],l[F+1],l[F+2])},Mr.prototype.projectAndGetPerspectiveRatio=function(l,d,f){var m=[d,f,0,1];return hr(m,m,l),{point:new o.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},Mr.prototype.isOffscreen=function(l,d,f,m){return f<100||l>=this.screenRightBoundary||m<100||d>this.screenBottomBoundary},Mr.prototype.isInsideGrid=function(l,d,f,m){return f>=0&&l<this.gridRightBoundary&&m>=0&&d<this.gridBottomBoundary},Mr.prototype.getViewportMatrix=function(){var l=o.identity([]);return o.translate(l,l,[-100,-100,0]),l};var mo=function(l,d,f,m){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):m&&f?1:0,this.placed=f};mo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Wr=function(l,d,f,m,E){this.text=new mo(l?l.text:null,d,f,E),this.icon=new mo(l?l.icon:null,d,m,E)};Wr.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Go=function(l,d,f){this.text=l,this.icon=d,this.skipFade=f},Sn=function(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]},_l=function(l,d,f,m,E){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=E},At=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function Mt(l,d,f,m,E){var P=o.getAnchorAlignment(l),R=-(P.horizontalAlign-.5)*d,F=-(P.verticalAlign-.5)*f,z=o.evaluateVariableOffset(l,m);return new o.Point(R+z[0]*E,F+z[1]*E)}function Wt(l,d,f,m,E,P){var R=l.x1,F=l.x2,z=l.y1,W=l.y2,et=l.anchorPointX,Z=l.anchorPointY,it=new o.Point(d,f);return m&&it._rotate(E?P:-P),{x1:R+it.x,y1:z+it.y,x2:F+it.x,y2:W+it.y,anchorPointX:et,anchorPointY:Z}}At.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:function(f){return f.collisionGroupID===d}}}return this.collisionGroups[l]};var be=function(l,d,f,m){this.transform=l.clone(),this.collisionIndex=new Mr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new At(f),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function He(l,d,f,m,E){l.emplaceBack(d?1:0,f?1:0,m||0,E||0),l.emplaceBack(d?1:0,f?1:0,m||0,E||0),l.emplaceBack(d?1:0,f?1:0,m||0,E||0),l.emplaceBack(d?1:0,f?1:0,m||0,E||0)}be.prototype.getBucketParts=function(l,d,f,m){var E=f.getBucket(d),P=f.latestFeatureIndex;if(E&&P&&d.id===E.layerIds[0]){var R=f.collisionBoxArray,F=E.layers[0].layout,z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),W=f.tileSize/o.EXTENT,et=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),Z=F.get("text-pitch-alignment")==="map",it=F.get("text-rotation-alignment")==="map",ot=Rn(f,1,this.transform.zoom),bt=mi(et,Z,it,this.transform,ot),Pt=null;if(Z){var mt=Bt(et,Z,it,this.transform,ot);Pt=o.multiply([],this.transform.labelPlaneMatrix,mt)}this.retainedQueryData[E.bucketInstanceId]=new _l(E.bucketInstanceId,P,E.sourceLayerIndex,E.index,f.tileID);var It={bucket:E,layout:F,posMatrix:et,textLabelPlaneMatrix:bt,labelToScreenMatrix:Pt,scale:z,textPixelRatio:W,holdingForFade:f.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(m)for(var Vt=0,Jt=E.sortKeyRanges;Vt<Jt.length;Vt+=1){var te=Jt[Vt];l.push({sortKey:te.sortKey,symbolInstanceStart:te.symbolInstanceStart,symbolInstanceEnd:te.symbolInstanceEnd,parameters:It})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:It})}},be.prototype.attemptAnchorPlacement=function(l,d,f,m,E,P,R,F,z,W,et,Z,it,ot,bt){var Pt,mt=[Z.textOffset0,Z.textOffset1],It=Mt(l,f,m,mt,E),Vt=this.collisionIndex.placeCollisionBox(Wt(d,It.x,It.y,P,R,this.transform.angle),et,F,z,W.predicate);if(!bt||this.collisionIndex.placeCollisionBox(Wt(bt,It.x,It.y,P,R,this.transform.angle),et,F,z,W.predicate).box.length!==0)return Vt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(Pt=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),this.variableOffsets[Z.crossTileID]={textOffset:mt,width:f,height:m,anchor:l,textBoxScale:E,prevAnchor:Pt},this.markUsedJustification(it,l,Z,ot),it.allowVerticalPlacement&&(this.markUsedOrientation(it,ot,Z),this.placedOrientations[Z.crossTileID]=ot),{shift:It,placedGlyphBoxes:Vt}):void 0},be.prototype.placeLayerBucketPart=function(l,d,f){var m=this,E=l.parameters,P=E.bucket,R=E.layout,F=E.posMatrix,z=E.textLabelPlaneMatrix,W=E.labelToScreenMatrix,et=E.textPixelRatio,Z=E.holdingForFade,it=E.collisionBoxArray,ot=E.partiallyEvaluatedTextSize,bt=E.collisionGroup,Pt=R.get("text-optional"),mt=R.get("icon-optional"),It=R.get("text-allow-overlap"),Vt=R.get("icon-allow-overlap"),Jt=R.get("text-rotation-alignment")==="map",te=R.get("text-pitch-alignment")==="map",Qt=R.get("icon-text-fit")!=="none",$t=R.get("symbol-z-order")==="viewport-y",pe=It&&(Vt||!P.hasIconData()||mt),Oe=Vt&&(It||!P.hasTextData()||Pt);!P.collisionArrays&&it&&P.deserializeCollisionBoxes(it);var xe=function(ai,Wi){if(!d[ai.crossTileID])if(Z)m.placements[ai.crossTileID]=new Go(!1,!1,!1);else{var nn,Hi=!1,zi=!1,Yi=!0,Fi=null,Oi={box:null,offscreen:null},Qr={box:null,offscreen:null},Tr=null,_o=null,oo=0,br=0,Pr=0;Wi.textFeatureIndex?oo=Wi.textFeatureIndex:ai.useRuntimeCollisionCircles&&(oo=ai.featureIndex),Wi.verticalTextFeatureIndex&&(br=Wi.verticalTextFeatureIndex);var us=Wi.textBox;if(us){var Ro=function(Bn){var Ts=o.WritingMode.horizontal;if(P.allowVerticalPlacement&&!Bn&&m.prevPlacement){var Ko=m.prevPlacement.placedOrientations[ai.crossTileID];Ko&&(m.placedOrientations[ai.crossTileID]=Ko,m.markUsedOrientation(P,Ts=Ko,ai))}return Ts},Vc=function(Bn,Ts){if(P.allowVerticalPlacement&&ai.numVerticalGlyphVertices>0&&Wi.verticalTextBox)for(var Ko=0,Fl=P.writingModes;Ko<Fl.length&&(Fl[Ko]===o.WritingMode.vertical?(Oi=Ts(),Qr=Oi):Oi=Bn(),!(Oi&&Oi.box&&Oi.box.length));Ko+=1);else Oi=Bn()};if(R.get("text-variable-anchor")){var Qo=R.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[ai.crossTileID]){var sa=m.prevPlacement.variableOffsets[ai.crossTileID];Qo.indexOf(sa.anchor)>0&&(Qo=Qo.filter(function(Bn){return Bn!==sa.anchor})).unshift(sa.anchor)}var Fs=function(Bn,Ts,Ko){for(var Fl=Bn.x2-Bn.x1,l_=Bn.y2-Bn.y1,Vf=ai.textBoxScale,u_=Qt&&!Vt?Ts:null,Rh={box:[],offscreen:!1},sm=It?2*Qo.length:Qo.length,Iu=0;Iu<sm;++Iu){var Hf=m.attemptAnchorPlacement(Qo[Iu%Qo.length],Bn,Fl,l_,Vf,Jt,te,et,F,bt,Iu>=Qo.length,ai,P,Ko,u_);if(Hf&&(Rh=Hf.placedGlyphBoxes)&&Rh.box&&Rh.box.length){Hi=!0,Fi=Hf.shift;break}}return Rh};Vc(function(){return Fs(us,Wi.iconBox,o.WritingMode.horizontal)},function(){var Bn=Wi.verticalTextBox;return P.allowVerticalPlacement&&!(Oi&&Oi.box&&Oi.box.length)&&ai.numVerticalGlyphVertices>0&&Bn?Fs(Bn,Wi.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),Oi&&(Hi=Oi.box,Yi=Oi.offscreen);var Ih=Ro(Oi&&Oi.box);if(!Hi&&m.prevPlacement){var Tu=m.prevPlacement.variableOffsets[ai.crossTileID];Tu&&(m.variableOffsets[ai.crossTileID]=Tu,m.markUsedJustification(P,Tu.anchor,ai,Ih))}}else{var Hc=function(Bn,Ts){var Ko=m.collisionIndex.placeCollisionBox(Bn,It,et,F,bt.predicate);return Ko&&Ko.box&&Ko.box.length&&(m.markUsedOrientation(P,Ts,ai),m.placedOrientations[ai.crossTileID]=Ts),Ko};Vc(function(){return Hc(us,o.WritingMode.horizontal)},function(){var Bn=Wi.verticalTextBox;return P.allowVerticalPlacement&&ai.numVerticalGlyphVertices>0&&Bn?Hc(Bn,o.WritingMode.vertical):{box:null,offscreen:null}}),Ro(Oi&&Oi.box&&Oi.box.length)}}if(Hi=(nn=Oi)&&nn.box&&nn.box.length>0,Yi=nn&&nn.offscreen,ai.useRuntimeCollisionCircles){var Su=P.text.placedSymbolArray.get(ai.centerJustifiedTextSymbolIndex),Mh=o.evaluateSizeForFeature(P.textSizeData,ot,Su),Ma=R.get("text-padding");Tr=m.collisionIndex.placeCollisionCircles(It,Su,P.lineVertexArray,P.glyphOffsetArray,Mh,F,z,W,f,te,bt.predicate,ai.collisionCircleDiameter,Ma),Hi=It||Tr.circles.length>0&&!Tr.collisionDetected,Yi=Yi&&Tr.offscreen}if(Wi.iconFeatureIndex&&(Pr=Wi.iconFeatureIndex),Wi.iconBox){var Ph=function(Bn){var Ts=Qt&&Fi?Wt(Bn,Fi.x,Fi.y,Jt,te,m.transform.angle):Bn;return m.collisionIndex.placeCollisionBox(Ts,Vt,et,F,bt.predicate)};zi=Qr&&Qr.box&&Qr.box.length&&Wi.verticalIconBox?(_o=Ph(Wi.verticalIconBox)).box.length>0:(_o=Ph(Wi.iconBox)).box.length>0,Yi=Yi&&_o.offscreen}var Pa=Pt||ai.numHorizontalGlyphVertices===0&&ai.numVerticalGlyphVertices===0,Kr=mt||ai.numIconVertices===0;if(Pa||Kr?Kr?Pa||(zi=zi&&Hi):Hi=zi&&Hi:zi=Hi=zi&&Hi,Hi&&nn&&nn.box&&m.collisionIndex.insertCollisionBox(nn.box,R.get("text-ignore-placement"),P.bucketInstanceId,Qr&&Qr.box&&br?br:oo,bt.ID),zi&&_o&&m.collisionIndex.insertCollisionBox(_o.box,R.get("icon-ignore-placement"),P.bucketInstanceId,Pr,bt.ID),Tr&&(Hi&&m.collisionIndex.insertCollisionCircles(Tr.circles,R.get("text-ignore-placement"),P.bucketInstanceId,oo,bt.ID),f)){var oc=P.bucketInstanceId,Wc=m.collisionCircleArrays[oc];Wc===void 0&&(Wc=m.collisionCircleArrays[oc]=new Sn);for(var Ll=0;Ll<Tr.circles.length;Ll+=4)Wc.circles.push(Tr.circles[Ll+0]),Wc.circles.push(Tr.circles[Ll+1]),Wc.circles.push(Tr.circles[Ll+2]),Wc.circles.push(Tr.collisionDetected?1:0)}m.placements[ai.crossTileID]=new Go(Hi||pe,zi||Oe,Yi||P.justReloaded),d[ai.crossTileID]=!0}};if($t)for(var Ue=P.getSortedSymbolIndexes(this.transform.angle),oi=Ue.length-1;oi>=0;--oi){var Ei=Ue[oi];xe(P.symbolInstances.get(Ei),P.collisionArrays[Ei])}else for(var Si=l.symbolInstanceStart;Si<l.symbolInstanceEnd;Si++)xe(P.symbolInstances.get(Si),P.collisionArrays[Si]);if(f&&P.bucketInstanceId in this.collisionCircleArrays){var xn=this.collisionCircleArrays[P.bucketInstanceId];o.invert(xn.invProjMatrix,F),xn.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},be.prototype.markUsedJustification=function(l,d,f,m){var E;E=m===o.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(d)];for(var P=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];P<R.length;P+=1){var F=R[P];F>=0&&(l.text.placedSymbolArray.get(F).crossTileID=E>=0&&F!==E?0:f.crossTileID)}},be.prototype.markUsedOrientation=function(l,d,f){for(var m=d===o.WritingMode.horizontal||d===o.WritingMode.horizontalOnly?d:0,E=d===o.WritingMode.vertical?d:0,P=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];P<R.length;P+=1)l.text.placedSymbolArray.get(R[P]).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=E)},be.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,f=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var m=d?d.symbolFadeChange(l):1,E=d?d.opacities:{},P=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(var F in this.placements){var z=this.placements[F],W=E[F];W?(this.opacities[F]=new Wr(W,m,z.text,z.icon),f=f||z.text!==W.text.placed||z.icon!==W.icon.placed):(this.opacities[F]=new Wr(null,m,z.text,z.icon,z.skipFade),f=f||z.text||z.icon)}for(var et in E){var Z=E[et];if(!this.opacities[et]){var it=new Wr(Z,m,!1,!1);it.isHidden()||(this.opacities[et]=it,f=f||Z.text.placed||Z.icon.placed)}}for(var ot in P)this.variableOffsets[ot]||!this.opacities[ot]||this.opacities[ot].isHidden()||(this.variableOffsets[ot]=P[ot]);for(var bt in R)this.placedOrientations[bt]||!this.opacities[bt]||this.opacities[bt].isHidden()||(this.placedOrientations[bt]=R[bt]);f?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)},be.prototype.updateLayerOpacities=function(l,d){for(var f={},m=0,E=d;m<E.length;m+=1){var P=E[m],R=P.getBucket(l);R&&P.latestFeatureIndex&&l.id===R.layerIds[0]&&this.updateBucketOpacities(R,f,P.collisionBoxArray)}},be.prototype.updateBucketOpacities=function(l,d,f){var m=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,P=new Wr(null,0,!1,!1,!0),R=E.get("text-allow-overlap"),F=E.get("icon-allow-overlap"),z=E.get("text-variable-anchor"),W=E.get("text-rotation-alignment")==="map",et=E.get("text-pitch-alignment")==="map",Z=E.get("icon-text-fit")!=="none",it=new Wr(null,0,R&&(F||!l.hasIconData()||E.get("icon-optional")),F&&(R||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&f&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(f);for(var ot=function(It,Vt,Jt){for(var te=0;te<Vt/4;te++)It.opacityVertexArray.emplaceBack(Jt)},bt=function(It){var Vt=l.symbolInstances.get(It),Jt=Vt.numHorizontalGlyphVertices,te=Vt.numVerticalGlyphVertices,Qt=Vt.crossTileID,$t=m.opacities[Qt];d[Qt]?$t=P:$t||(m.opacities[Qt]=$t=it),d[Qt]=!0;var pe=Vt.numIconVertices>0,Oe=m.placedOrientations[Vt.crossTileID],xe=Oe===o.WritingMode.vertical,Ue=Oe===o.WritingMode.horizontal||Oe===o.WritingMode.horizontalOnly;if(Jt>0||te>0){var oi=Ah($t.text);ot(l.text,Jt,xe?_a:oi),ot(l.text,te,Ue?_a:oi);var Ei=$t.text.isHidden();[Vt.rightJustifiedTextSymbolIndex,Vt.centerJustifiedTextSymbolIndex,Vt.leftJustifiedTextSymbolIndex].forEach(function(Oi){Oi>=0&&(l.text.placedSymbolArray.get(Oi).hidden=Ei||xe?1:0)}),Vt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Vt.verticalPlacedTextSymbolIndex).hidden=Ei||Ue?1:0);var Si=m.variableOffsets[Vt.crossTileID];Si&&m.markUsedJustification(l,Si.anchor,Vt,Oe);var xn=m.placedOrientations[Vt.crossTileID];xn&&(m.markUsedJustification(l,"left",Vt,xn),m.markUsedOrientation(l,xn,Vt))}if(pe){var ai=Ah($t.icon),Wi=!(Z&&Vt.verticalPlacedIconSymbolIndex&&xe);Vt.placedIconSymbolIndex>=0&&(ot(l.icon,Vt.numIconVertices,Wi?ai:_a),l.icon.placedSymbolArray.get(Vt.placedIconSymbolIndex).hidden=$t.icon.isHidden()),Vt.verticalPlacedIconSymbolIndex>=0&&(ot(l.icon,Vt.numVerticalIconVertices,Wi?_a:ai),l.icon.placedSymbolArray.get(Vt.verticalPlacedIconSymbolIndex).hidden=$t.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var nn=l.collisionArrays[It];if(nn){var Hi=new o.Point(0,0);if(nn.textBox||nn.verticalTextBox){var zi=!0;if(z){var Yi=m.variableOffsets[Qt];Yi?(Hi=Mt(Yi.anchor,Yi.width,Yi.height,Yi.textOffset,Yi.textBoxScale),W&&Hi._rotate(et?m.transform.angle:-m.transform.angle)):zi=!1}nn.textBox&&He(l.textCollisionBox.collisionVertexArray,$t.text.placed,!zi||xe,Hi.x,Hi.y),nn.verticalTextBox&&He(l.textCollisionBox.collisionVertexArray,$t.text.placed,!zi||Ue,Hi.x,Hi.y)}var Fi=!!(!Ue&&nn.verticalIconBox);nn.iconBox&&He(l.iconCollisionBox.collisionVertexArray,$t.icon.placed,Fi,Z?Hi.x:0,Z?Hi.y:0),nn.verticalIconBox&&He(l.iconCollisionBox.collisionVertexArray,$t.icon.placed,!Fi,Z?Hi.x:0,Z?Hi.y:0)}}},Pt=0;Pt<l.symbolInstances.length;Pt++)bt(Pt);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var mt=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=mt.invProjMatrix,l.placementViewportMatrix=mt.viewportMatrix,l.collisionCircleArray=mt.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},be.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},be.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},be.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},be.prototype.stillRecent=function(l,d){var f=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*f>l},be.prototype.setStale=function(){this.stale=!0};var ji=Math.pow(2,25),Ii=Math.pow(2,24),Ln=Math.pow(2,17),So=Math.pow(2,16),lo=Math.pow(2,9),is=Math.pow(2,8),Pf=Math.pow(2,1);function Ah(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var d=l.placed?1:0,f=Math.floor(127*l.opacity);return f*ji+d*Ii+f*Ln+d*So+f*lo+d*is+f*Pf+d}var _a=0,bl=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};bl.prototype.continuePlacement=function(l,d,f,m,E){for(var P=this._bucketParts;this._currentTileIndex<l.length;)if(d.getBucketParts(P,m,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(R,F){return R.sortKey-F.sortKey}));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,E())return!0;return!1};var xl=function(l,d,f,m,E,P,R){this.placement=new be(l,E,P,R),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=m,this._done=!1};xl.prototype.isDone=function(){return this._done},xl.prototype.continuePlacement=function(l,d,f){for(var m=this,E=o.browser.now(),P=function(){var z=o.browser.now()-E;return!m._forceFullPlacement&&z>2};this._currentPlacementIndex>=0;){var R=d[l[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=F)&&(!R.maxzoom||R.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new bl(R)),this._inProgressLayer.continuePlacement(f[R.source],this.placement,this._showCollisionBoxes,R,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},xl.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Rf=512/o.EXTENT/2,wl=function(l,d,f){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var m=0;m<d.length;m++){var E=d.get(m),P=E.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};wl.prototype.getScaledCoordinates=function(l,d){var f=Rf/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*o.EXTENT+l.anchorX)*f),y:Math.floor((d.canonical.y*o.EXTENT+l.anchorY)*f)}},wl.prototype.findMatches=function(l,d,f){for(var m=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),E=0;E<l.length;E++){var P=l.get(E);if(!P.crossTileID){var R=this.indexedSymbolInstances[P.key];if(R)for(var F=this.getScaledCoordinates(P,d),z=0,W=R;z<W.length;z+=1){var et=W[z];if(Math.abs(et.coord.x-F.x)<=m&&Math.abs(et.coord.y-F.y)<=m&&!f[et.crossTileID]){f[et.crossTileID]=!0,P.crossTileID=et.crossTileID;break}}}}};var jo=function(){this.maxCrossTileID=0};jo.prototype.generate=function(){return++this.maxCrossTileID};var Xs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Xs.prototype.handleWrapJump=function(l){var d=Math.round((l-this.lng)/360);if(d!==0)for(var f in this.indexes){var m=this.indexes[f],E={};for(var P in m){var R=m[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),E[R.tileID.key]=R}this.indexes[f]=E}this.lng=l},Xs.prototype.addBucket=function(l,d,f){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var m=0;m<d.symbolInstances.length;m++)d.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var P in this.indexes){var R=this.indexes[P];if(Number(P)>l.overscaledZ)for(var F in R){var z=R[F];z.tileID.isChildOf(l)&&z.findMatches(d.symbolInstances,l,E)}else{var W=R[l.scaledTo(Number(P)).key];W&&W.findMatches(d.symbolInstances,l,E)}}for(var et=0;et<d.symbolInstances.length;et++){var Z=d.symbolInstances.get(et);Z.crossTileID||(Z.crossTileID=f.generate(),E[Z.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new wl(l,d.symbolInstances,d.bucketInstanceId),!0},Xs.prototype.removeBucketCrossTileIDs=function(l,d){for(var f in d.indexedSymbolInstances)for(var m=0,E=d.indexedSymbolInstances[f];m<E.length;m+=1)delete this.usedCrossTileIDs[l][E[m].crossTileID]},Xs.prototype.removeStaleBuckets=function(l){var d=!1;for(var f in this.indexes){var m=this.indexes[f];for(var E in m)l[m[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[E]),delete m[E],d=!0)}return d};var ba=function(){this.layerIndexes={},this.crossTileIDs=new jo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ba.prototype.addLayer=function(l,d,f){var m=this.layerIndexes[l.id];m===void 0&&(m=this.layerIndexes[l.id]=new Xs);var E=!1,P={};m.handleWrapJump(f);for(var R=0,F=d;R<F.length;R+=1){var z=F[R],W=z.getBucket(l);W&&l.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(z.tileID,W,this.crossTileIDs)&&(E=!0),P[W.bucketInstanceId]=!0)}return m.removeStaleBuckets(P)&&(E=!0),E},ba.prototype.pruneUnusedLayers=function(l){var d={};for(var f in l.forEach(function(m){d[m]=!0}),this.layerIndexes)d[f]||delete this.layerIndexes[f]};var Ja=function(l,d){return o.emitValidationErrors(l,d&&d.filter(function(f){return f.identifier!=="source.canvas"}))},xa=o.pick(je,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),_r=o.pick(je,["setCenter","setZoom","setBearing","setPitch"]),Rs=function(){var l={},d=o.styleSpec.$version;for(var f in o.styleSpec.$root){var m,E=o.styleSpec.$root[f];E.required&&(m=f==="version"?d:E.type==="array"?[]:{})!=null&&(l[f]=m)}return l}(),Gn=function(l){function d(f,m){var E=this;m===void 0&&(m={}),l.call(this),this.map=f,this.dispatcher=new Et(he(),this),this.imageManager=new tt,this.imageManager.setEventedParent(this),this.glyphManager=new dt(f._requestManager,m.localIdeographFontFamily),this.lineAtlas=new ut(256,512),this.crossTileSymbolIndex=new ba,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());var P=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(R){P.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(F,z){if(o.triggerPluginCompletionEvent(F),z&&z.every(function(et){return et}))for(var W in P.sourceCaches)P.sourceCaches[W].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var F=E.sourceCaches[R.sourceId];if(F){var z=F.getSource();if(z&&z.vectorLayerIds)for(var W in E._layers){var et=E._layers[W];et.source===z.id&&E._validateLayer(et)}}}})}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.loadURL=function(f,m){var E=this;m===void 0&&(m={}),this.fire(new o.Event("dataloading",{dataType:"style"}));var P=typeof m.validate=="boolean"?m.validate:!o.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,m.accessToken);var R=this.map._requestManager.transformRequest(f,o.ResourceType.Style);this._request=o.getJSON(R,function(F,z){E._request=null,F?E.fire(new o.ErrorEvent(F)):z&&E._load(z,P)})},d.prototype.loadJSON=function(f,m){var E=this;m===void 0&&(m={}),this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(function(){E._request=null,E._load(f,m.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(Rs,!1)},d.prototype._load=function(f,m){if(!m||!Ja(this,o.validateStyle(f))){for(var E in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(E,f.sources[E],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var P=Ie(this.stylesheet.layers);this._order=P.map(function(W){return W.id}),this._layers={},this._serializedLayers={};for(var R=0,F=P;R<F.length;R+=1){var z=F[R];(z=o.createStyleLayer(z)).setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new J(this.stylesheet.light),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}},d.prototype._loadSprite=function(f){var m=this;this._spriteRequest=function(E,P,R){var F,z,W,et=o.browser.devicePixelRatio>1?"@2x":"",Z=o.getJSON(P.transformRequest(P.normalizeSpriteURL(E,et,".json"),o.ResourceType.SpriteJSON),function(bt,Pt){Z=null,W||(W=bt,F=Pt,ot())}),it=o.getImage(P.transformRequest(P.normalizeSpriteURL(E,et,".png"),o.ResourceType.SpriteImage),function(bt,Pt){it=null,W||(W=bt,z=Pt,ot())});function ot(){if(W)R(W);else if(F&&z){var bt=o.browser.getImageData(z),Pt={};for(var mt in F){var It=F[mt],Vt=It.width,Jt=It.height,te=It.x,Qt=It.y,$t=It.sdf,pe=It.pixelRatio,Oe=It.stretchX,xe=It.stretchY,Ue=It.content,oi=new o.RGBAImage({width:Vt,height:Jt});o.RGBAImage.copy(bt,oi,{x:te,y:Qt},{x:0,y:0},{width:Vt,height:Jt}),Pt[mt]={data:oi,pixelRatio:pe,sdf:$t,stretchX:Oe,stretchY:xe,content:Ue}}R(null,Pt)}}return{cancel:function(){Z&&(Z.cancel(),Z=null),it&&(it.cancel(),it=null)}}}(f,this.map._requestManager,function(E,P){if(m._spriteRequest=null,E)m.fire(new o.ErrorEvent(E));else if(P)for(var R in P)m.imageManager.addImage(R,P[R]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new o.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(f){var m=this.sourceCaches[f.source];if(m){var E=f.sourceLayer;if(E){var P=m.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(E)===-1)&&this.fire(new o.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+P.id+'" as specified by style layer "'+f.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(f){for(var m=[],E=0,P=f;E<P.length;E+=1){var R=this._layers[P[E]];R.type!=="custom"&&m.push(R.serialize())}return m},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(f){if(this._loaded){var m=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var R in(E.length||P.length)&&this._updateWorkerLayers(E,P),this._updatedSources){var F=this._updatedSources[R];F==="reload"?this._reloadSource(R):F==="clear"&&this._clearSource(R)}for(var z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[z].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var W={};for(var et in this.sourceCaches){var Z=this.sourceCaches[et];W[et]=Z.used,Z.used=!1}for(var it=0,ot=this._order;it<ot.length;it+=1){var bt=this._layers[ot[it]];bt.recalculate(f,this._availableImages),!bt.isHidden(f.zoom)&&bt.source&&(this.sourceCaches[bt.source].used=!0)}for(var Pt in W){var mt=this.sourceCaches[Pt];W[Pt]!==mt.used&&mt.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Pt}))}this.light.recalculate(f),this.z=f.zoom,m&&this.fire(new o.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},d.prototype._updateWorkerLayers=function(f,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:m})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(f){var m=this;if(this._checkLoaded(),Ja(this,o.validateStyle(f)))return!1;(f=o.clone$1(f)).layers=Ie(f.layers);var E=function(R,F){if(!R)return[{command:je.setStyle,args:[F]}];var z=[];try{if(!o.deepEqual(R.version,F.version))return[{command:je.setStyle,args:[F]}];o.deepEqual(R.center,F.center)||z.push({command:je.setCenter,args:[F.center]}),o.deepEqual(R.zoom,F.zoom)||z.push({command:je.setZoom,args:[F.zoom]}),o.deepEqual(R.bearing,F.bearing)||z.push({command:je.setBearing,args:[F.bearing]}),o.deepEqual(R.pitch,F.pitch)||z.push({command:je.setPitch,args:[F.pitch]}),o.deepEqual(R.sprite,F.sprite)||z.push({command:je.setSprite,args:[F.sprite]}),o.deepEqual(R.glyphs,F.glyphs)||z.push({command:je.setGlyphs,args:[F.glyphs]}),o.deepEqual(R.transition,F.transition)||z.push({command:je.setTransition,args:[F.transition]}),o.deepEqual(R.light,F.light)||z.push({command:je.setLight,args:[F.light]});var W={},et=[];(function(it,ot,bt,Pt){var mt;for(mt in ot=ot||{},it=it||{})it.hasOwnProperty(mt)&&(ot.hasOwnProperty(mt)||ti(mt,bt,Pt));for(mt in ot)ot.hasOwnProperty(mt)&&(it.hasOwnProperty(mt)?o.deepEqual(it[mt],ot[mt])||(it[mt].type==="geojson"&&ot[mt].type==="geojson"&&ln(it,ot,mt)?bt.push({command:je.setGeoJSONSourceData,args:[mt,ot[mt].data]}):tn(mt,ot,bt,Pt)):Ni(mt,ot,bt))})(R.sources,F.sources,et,W);var Z=[];R.layers&&R.layers.forEach(function(it){W[it.source]?z.push({command:je.removeLayer,args:[it.id]}):Z.push(it)}),z=z.concat(et),function(it,ot,bt){ot=ot||[];var Pt,mt,It,Vt,Jt,te,Qt,$t=(it=it||[]).map(Xi),pe=ot.map(Xi),Oe=it.reduce(Gi,{}),xe=ot.reduce(Gi,{}),Ue=$t.slice(),oi=Object.create(null);for(Pt=0,mt=0;Pt<$t.length;Pt++)xe.hasOwnProperty(It=$t[Pt])?mt++:(bt.push({command:je.removeLayer,args:[It]}),Ue.splice(Ue.indexOf(It,mt),1));for(Pt=0,mt=0;Pt<pe.length;Pt++)Ue[Ue.length-1-Pt]!==(It=pe[pe.length-1-Pt])&&(Oe.hasOwnProperty(It)?(bt.push({command:je.removeLayer,args:[It]}),Ue.splice(Ue.lastIndexOf(It,Ue.length-mt),1)):mt++,bt.push({command:je.addLayer,args:[xe[It],te=Ue[Ue.length-Pt]]}),Ue.splice(Ue.length-Pt,0,It),oi[It]=!0);for(Pt=0;Pt<pe.length;Pt++)if(Vt=Oe[It=pe[Pt]],Jt=xe[It],!oi[It]&&!o.deepEqual(Vt,Jt))if(o.deepEqual(Vt.source,Jt.source)&&o.deepEqual(Vt["source-layer"],Jt["source-layer"])&&o.deepEqual(Vt.type,Jt.type)){for(Qt in Ji(Vt.layout,Jt.layout,bt,It,null,je.setLayoutProperty),Ji(Vt.paint,Jt.paint,bt,It,null,je.setPaintProperty),o.deepEqual(Vt.filter,Jt.filter)||bt.push({command:je.setFilter,args:[It,Jt.filter]}),o.deepEqual(Vt.minzoom,Jt.minzoom)&&o.deepEqual(Vt.maxzoom,Jt.maxzoom)||bt.push({command:je.setLayerZoomRange,args:[It,Jt.minzoom,Jt.maxzoom]}),Vt)Vt.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Ji(Vt[Qt],Jt[Qt],bt,It,Qt.slice(6),je.setPaintProperty):o.deepEqual(Vt[Qt],Jt[Qt])||bt.push({command:je.setLayerProperty,args:[It,Qt,Jt[Qt]]}));for(Qt in Jt)Jt.hasOwnProperty(Qt)&&!Vt.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Ji(Vt[Qt],Jt[Qt],bt,It,Qt.slice(6),je.setPaintProperty):o.deepEqual(Vt[Qt],Jt[Qt])||bt.push({command:je.setLayerProperty,args:[It,Qt,Jt[Qt]]}))}else bt.push({command:je.removeLayer,args:[It]}),te=Ue[Ue.lastIndexOf(It)+1],bt.push({command:je.addLayer,args:[Jt,te]})}(Z,F.layers,z)}catch(it){console.warn("Unable to compute style diff:",it),z=[{command:je.setStyle,args:[F]}]}return z}(this.serialize(),f).filter(function(R){return!(R.command in _r)});if(E.length===0)return!1;var P=E.filter(function(R){return!(R.command in xa)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(R){return R.command}).join(", ")+".");return E.forEach(function(R){R.command!=="setTransition"&&m[R.command].apply(m,R.args)}),this.stylesheet=f,!0},d.prototype.addImage=function(f,m){if(this.getImage(f))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,m),this._afterImageUpdated(f)},d.prototype.updateImage=function(f,m){this.imageManager.updateImage(f,m)},d.prototype.getImage=function(f){return this.imageManager.getImage(f)},d.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},d.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(f,m,E){var P=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(o.validateStyle.source,"sources."+f,m,null,E))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var R=this.sourceCaches[f]=new wt(f,m,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:R.serialize(),sourceId:f}}),R.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===f)return this.fire(new o.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+m+'" is using it.')));var E=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],E.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(f,m){this._checkLoaded(),this.sourceCaches[f].getSource().setData(m),this._changed=!0},d.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},d.prototype.addLayer=function(f,m,E){E===void 0&&(E={}),this._checkLoaded();var P=f.id;if(this.getLayer(P))this.fire(new o.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var R;if(f.type==="custom"){if(Ja(this,o.validateCustomStyleLayer(f)))return;R=o.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(P,f.source),f=o.clone$1(f),f=o.extend(f,{source:P})),this._validate(o.validateStyle.layer,"layers."+P,f,{arrayIndex:-1},E))return;R=o.createStyleLayer(f),this._validateLayer(R),R.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[R.id]=R.serialize()}var F=m?this._order.indexOf(m):this._order.length;if(m&&F===-1)this.fire(new o.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(F,0,P),this._layerOrderChanged=!0,this._layers[P]=R,this._removedLayers[P]&&R.source&&R.type!=="custom"){var z=this._removedLayers[P];delete this._removedLayers[P],z.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},d.prototype.moveLayer=function(f,m){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==m){var E=this._order.indexOf(f);this._order.splice(E,1);var P=m?this._order.indexOf(m):this._order.length;m&&P===-1?this.fire(new o.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(P,0,f),this._layerOrderChanged=!0)}}else this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(f){this._checkLoaded();var m=this._layers[f];if(m){m.setEventedParent(null);var E=this._order.indexOf(f);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=m,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],m.onRemove&&m.onRemove(this.map)}else this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(f){return this._layers[f]},d.prototype.hasLayer=function(f){return f in this._layers},d.prototype.setLayerZoomRange=function(f,m,E){this._checkLoaded();var P=this.getLayer(f);P?P.minzoom===m&&P.maxzoom===E||(m!=null&&(P.minzoom=m),E!=null&&(P.maxzoom=E),this._updateLayer(P)):this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(f,m,E){E===void 0&&(E={}),this._checkLoaded();var P=this.getLayer(f);if(P){if(!o.deepEqual(P.filter,m))return m==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(o.validateStyle.filter,"layers."+P.id+".filter",m,null,E)||(P.filter=o.clone$1(m),this._updateLayer(P)))}else this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(f){return o.clone$1(this.getLayer(f).filter)},d.prototype.setLayoutProperty=function(f,m,E,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(f);R?o.deepEqual(R.getLayoutProperty(m),E)||(R.setLayoutProperty(m,E,P),this._updateLayer(R)):this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(f,m){var E=this.getLayer(f);if(E)return E.getLayoutProperty(m);this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(f,m,E,P){P===void 0&&(P={}),this._checkLoaded();var R=this.getLayer(f);R?o.deepEqual(R.getPaintProperty(m),E)||(R.setPaintProperty(m,E,P)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new o.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(f,m){return this.getLayer(f).getPaintProperty(m)},d.prototype.setFeatureState=function(f,m){this._checkLoaded();var E=f.source,P=f.sourceLayer,R=this.sourceCaches[E];if(R!==void 0){var F=R.getSource().type;F==="geojson"&&P?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||P?(f.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(P,f.id,m)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(f,m){this._checkLoaded();var E=f.source,P=this.sourceCaches[E];if(P!==void 0){var R=P.getSource().type,F=R==="vector"?f.sourceLayer:void 0;R!=="vector"||F?m&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(F,f.id,m):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(f){this._checkLoaded();var m=f.source,E=f.sourceLayer,P=this.sourceCaches[m];if(P!==void 0){if(P.getSource().type!=="vector"||E)return f.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(E,f.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},d.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(f){for(var m=this,E=function(Oe){return m._layers[Oe].type==="fill-extrusion"},P={},R=[],F=this._order.length-1;F>=0;F--){var z=this._order[F];if(E(z)){P[z]=F;for(var W=0,et=f;W<et.length;W+=1){var Z=et[W][z];if(Z)for(var it=0,ot=Z;it<ot.length;it+=1)R.push(ot[it])}}}R.sort(function(Oe,xe){return xe.intersectionZ-Oe.intersectionZ});for(var bt=[],Pt=this._order.length-1;Pt>=0;Pt--){var mt=this._order[Pt];if(E(mt))for(var It=R.length-1;It>=0;It--){var Vt=R[It].feature;if(P[Vt.layer.id]<Pt)break;bt.push(Vt),R.pop()}else for(var Jt=0,te=f;Jt<te.length;Jt+=1){var Qt=te[Jt][mt];if(Qt)for(var $t=0,pe=Qt;$t<pe.length;$t+=1)bt.push(pe[$t].feature)}}return bt},d.prototype.queryRenderedFeatures=function(f,m,E){m&&m.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var P={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,F=m.layers;R<F.length;R+=1){var z=F[R],W=this._layers[z];if(!W)return this.fire(new o.ErrorEvent(new Error("The layer '"+z+"' does not exist in the map's style and cannot be queried for features."))),[];P[W.source]=!0}}var et=[];for(var Z in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!P[Z]||et.push(Ke(this.sourceCaches[Z],this._layers,this._serializedLayers,f,m,E));return this.placement&&et.push(function(it,ot,bt,Pt,mt,It,Vt){for(var Jt={},te=It.queryRenderedSymbols(Pt),Qt=[],$t=0,pe=Object.keys(te).map(Number);$t<pe.length;$t+=1)Qt.push(Vt[pe[$t]]);Qt.sort(qe);for(var Oe=function(){var Si=Ue[xe],xn=Si.featureIndex.lookupSymbolFeatures(te[Si.bucketInstanceId],ot,Si.bucketIndex,Si.sourceLayerIndex,mt.filter,mt.layers,mt.availableImages,it);for(var ai in xn){var Wi=Jt[ai]=Jt[ai]||[],nn=xn[ai];nn.sort(function(Yi,Fi){var Oi=Si.featureSortOrder;if(Oi){var Qr=Oi.indexOf(Yi.featureIndex);return Oi.indexOf(Fi.featureIndex)-Qr}return Fi.featureIndex-Yi.featureIndex});for(var Hi=0,zi=nn;Hi<zi.length;Hi+=1)Wi.push(zi[Hi])}},xe=0,Ue=Qt;xe<Ue.length;xe+=1)Oe();var oi=function(Si){Jt[Si].forEach(function(xn){var ai=xn.feature,Wi=bt[it[Si].source].getFeatureState(ai.layer["source-layer"],ai.id);ai.source=ai.layer.source,ai.layer["source-layer"]&&(ai.sourceLayer=ai.layer["source-layer"]),ai.state=Wi})};for(var Ei in Jt)oi(Ei);return Jt}(this._layers,this._serializedLayers,this.sourceCaches,f,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(et)},d.prototype.querySourceFeatures=function(f,m){m&&m.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var E=this.sourceCaches[f];return E?function(P,R){for(var F=P.getRenderableIds().map(function(ot){return P.getTileByID(ot)}),z=[],W={},et=0;et<F.length;et++){var Z=F[et],it=Z.tileID.canonical.key;W[it]||(W[it]=!0,Z.querySourceFeatures(z,R))}return z}(E,m):[]},d.prototype.addSourceType=function(f,m,E){return d.getSourceType(f)?E(new Error('A source type called "'+f+'" already exists.')):(d.setSourceType(f,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:m.workerSourceURL},E):E(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(f,m){m===void 0&&(m={}),this._checkLoaded();var E=this.light.getLight(),P=!1;for(var R in f)if(!o.deepEqual(f[R],E[R])){P=!0;break}if(P){var F={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,m),this.light.updateTransitions(F)}},d.prototype._validate=function(f,m,E,P,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Ja(this,f.call(o.validateStyle,o.extend({key:m,style:this.serialize(),value:E,styleSpec:o.styleSpec},P)))},d.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},d.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},d.prototype._updateSources=function(f){for(var m in this.sourceCaches)this.sourceCaches[m].update(f)},d.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},d.prototype._updatePlacement=function(f,m,E,P,R){R===void 0&&(R=!1);for(var F=!1,z=!1,W={},et=0,Z=this._order;et<Z.length;et+=1){var it=this._layers[Z[et]];if(it.type==="symbol"){if(!W[it.source]){var ot=this.sourceCaches[it.source];W[it.source]=ot.getRenderableIds(!0).map(function(Vt){return ot.getTileByID(Vt)}).sort(function(Vt,Jt){return Jt.tileID.overscaledZ-Vt.tileID.overscaledZ||(Vt.tileID.isLessThan(Jt.tileID)?-1:1)})}var bt=this.crossTileSymbolIndex.addLayer(it,W[it.source],f.center.lng);F=F||bt}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),f.zoom))&&(this.pauseablePlacement=new xl(f,this._order,R,m,E,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),z=!0),F&&this.pauseablePlacement.placement.setStale()),z||F)for(var Pt=0,mt=this._order;Pt<mt.length;Pt+=1){var It=this._layers[mt[Pt]];It.type==="symbol"&&this.placement.updateLayerOpacities(It,W[It.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},d.prototype.getImages=function(f,m,E){this.imageManager.getImages(m.icons,E),this._updateTilesForChangedImages();var P=this.sourceCaches[m.source];P&&P.setDependencies(m.tileID.key,m.type,m.icons)},d.prototype.getGlyphs=function(f,m,E){this.glyphManager.getGlyphs(m.stacks,E)},d.prototype.getResource=function(f,m,E){return o.makeRequest(m,E)},d}(o.Evented);Gn.getSourceType=function(l){return oe[l]},Gn.setSourceType=function(l,d){oe[l]=d},Gn.registerForPluginStateChange=o.registerForPluginStateChange;var fr=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),Xa=In(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Cl=In(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),oA=In(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),sA=In(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),gh=In("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),cu=In(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Mc=In(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Qs=In("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),mh=In("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),yh=In("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),lu=In(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),xs=In(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ns=In(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),vh=In(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),zr=In(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),El=In(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),wa=In(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ca=In(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ea=In(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Qa=In(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Ba=In(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ka=In(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),qa=In(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ta=In(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Df=In(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Of=In(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function In(l,d){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=d.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=P?P.concat(E):E,F={};return{fragmentSource:l=l.replace(f,function(z,W,et,Z,it){return F[it]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_`+it+`
varying `+et+" "+Z+" "+it+`;
#else
uniform `+et+" "+Z+" u_"+it+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+it+`
    `+et+" "+Z+" "+it+" = u_"+it+`;
#endif
`}),vertexSource:d=d.replace(f,function(z,W,et,Z,it){var ot=Z==="float"?"vec2":"vec4",bt=it.match(/color/)?"color":ot;return F[it]?W==="define"?`
#ifndef HAS_UNIFORM_u_`+it+`
uniform lowp float u_`+it+`_t;
attribute `+et+" "+ot+" a_"+it+`;
varying `+et+" "+Z+" "+it+`;
#else
uniform `+et+" "+Z+" u_"+it+`;
#endif
`:bt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+it+`
    `+it+" = a_"+it+`;
#else
    `+et+" "+Z+" "+it+" = u_"+it+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+it+`
    `+it+" = unpack_mix_"+bt+"(a_"+it+", u_"+it+`_t);
#else
    `+et+" "+Z+" "+it+" = u_"+it+`;
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_`+it+`
uniform lowp float u_`+it+`_t;
attribute `+et+" "+ot+" a_"+it+`;
#else
uniform `+et+" "+Z+" u_"+it+`;
#endif
`:bt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+it+`
    `+et+" "+Z+" "+it+" = a_"+it+`;
#else
    `+et+" "+Z+" "+it+" = u_"+it+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+it+`
    `+et+" "+Z+" "+it+" = unpack_mix_"+bt+"(a_"+it+", u_"+it+`_t);
#else
    `+et+" "+Z+" "+it+" = u_"+it+`;
#endif
`}),staticAttributes:m,staticUniforms:R}}var uu=Object.freeze({__proto__:null,prelude:Xa,background:Cl,backgroundPattern:oA,circle:sA,clippingMask:gh,heatmap:cu,heatmapTexture:Mc,collisionBox:Qs,collisionCircle:mh,debug:yh,fill:lu,fillOutline:xs,fillOutlinePattern:ns,fillPattern:vh,fillExtrusion:zr,fillExtrusionPattern:El,hillshadePrepare:wa,hillshade:Ca,line:Ea,lineGradient:Qa,linePattern:Ba,lineSDF:Ka,raster:qa,symbolIcon:Ta,symbolSDF:Df,symbolTextAndIcon:Of}),hu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Lf(l){for(var d=[],f=0;f<l.length;f++)if(l[f]!==null){var m=l[f].split(" ");d.push(m.pop())}return d}hu.prototype.bind=function(l,d,f,m,E,P,R,F){this.context=l;for(var z=this.boundPaintVertexBuffers.length!==m.length,W=0;!z&&W<m.length;W++)this.boundPaintVertexBuffers[W]!==m[W]&&(z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===f&&!z&&this.boundIndexBuffer===E&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===F?(l.bindVertexArrayOES.set(this.vao),R&&R.bind(),E&&E.dynamicDraw&&E.bind(),F&&F.bind()):this.freshBind(d,f,m,E,P,R,F)},hu.prototype.freshBind=function(l,d,f,m,E,P,R){var F,z=l.numAttributes,W=this.context,et=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R;else{F=W.currentNumAttributes||0;for(var Z=z;Z<F;Z++)et.disableVertexAttribArray(Z)}d.enableAttributes(et,l);for(var it=0,ot=f;it<ot.length;it+=1)ot[it].enableAttributes(et,l);P&&P.enableAttributes(et,l),R&&R.enableAttributes(et,l),d.bind(),d.setVertexAttribPointers(et,l,E);for(var bt=0,Pt=f;bt<Pt.length;bt+=1){var mt=Pt[bt];mt.bind(),mt.setVertexAttribPointers(et,l,E)}P&&(P.bind(),P.setVertexAttribPointers(et,l,E)),m&&m.bind(),R&&(R.bind(),R.setVertexAttribPointers(et,l,E)),W.currentNumAttributes=z},hu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ff=function(l,d,f,m,E,P){var R=l.gl;this.program=R.createProgram();for(var F=Lf(f.staticAttributes),z=m?m.getBinderAttributes():[],W=F.concat(z),et=f.staticUniforms?Lf(f.staticUniforms):[],Z=m?m.getBinderUniforms():[],it=[],ot=0,bt=et.concat(Z);ot<bt.length;ot+=1){var Pt=bt[ot];it.indexOf(Pt)<0&&it.push(Pt)}var mt=m?m.defines():[];P&&mt.push("#define OVERDRAW_INSPECTOR;");var It=mt.concat(Xa.fragmentSource,f.fragmentSource).join(`
`),Vt=mt.concat(Xa.vertexSource,f.vertexSource).join(`
`),Jt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Jt,It),R.compileShader(Jt),R.attachShader(this.program,Jt);var te=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(te,Vt),R.compileShader(te),R.attachShader(this.program,te),this.attributes={};var Qt={};this.numAttributes=W.length;for(var $t=0;$t<this.numAttributes;$t++)W[$t]&&(R.bindAttribLocation(this.program,$t,W[$t]),this.attributes[W[$t]]=$t);R.linkProgram(this.program),R.deleteShader(te),R.deleteShader(Jt);for(var pe=0;pe<it.length;pe++){var Oe=it[pe];if(Oe&&!Qt[Oe]){var xe=R.getUniformLocation(this.program,Oe);xe&&(Qt[Oe]=xe)}}this.fixedUniforms=E(l,Qt),this.binderUniforms=m?m.getUniforms(l,Qt):[]}}};function Pc(l,d,f){var m=1/Rn(f,1,d.transform.tileZoom),E=Math.pow(2,f.tileID.overscaledZ),P=f.tileSize*Math.pow(2,d.transform.tileZoom)/E,R=P*(f.tileID.canonical.x+f.tileID.wrap*E),F=P*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[R>>16,F>>16],u_pixel_coord_lower:[65535&R,65535&F]}}Ff.prototype.draw=function(l,d,f,m,E,P,R,F,z,W,et,Z,it,ot,bt,Pt){var mt,It=l.gl;if(!this.failedToCreate){for(var Vt in l.program.set(this.program),l.setDepthMode(f),l.setStencilMode(m),l.setColorMode(E),l.setCullFace(P),this.fixedUniforms)this.fixedUniforms[Vt].set(R[Vt]);ot&&ot.setUniforms(l,this.binderUniforms,Z,{zoom:it});for(var Jt=(mt={},mt[It.LINES]=2,mt[It.TRIANGLES]=3,mt[It.LINE_STRIP]=1,mt)[d],te=0,Qt=et.get();te<Qt.length;te+=1){var $t=Qt[te],pe=$t.vaos||($t.vaos={});(pe[F]||(pe[F]=new hu)).bind(l,this,z,ot?ot.getPaintVertexBuffers():[],W,$t.vertexOffset,bt,Pt),It.drawElements(d,$t.primitiveLength*Jt,It.UNSIGNED_SHORT,$t.primitiveOffset*Jt*2)}}};var kf=function(l,d,f,m){var E=d.style.light,P=E.properties.get("position"),R=[P.x,P.y,P.z],F=o.create$1();E.properties.get("anchor")==="viewport"&&o.fromRotation(F,-d.transform.angle),o.transformMat3(R,R,F);var z=E.properties.get("color");return{u_matrix:l,u_lightpos:R,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+f,u_opacity:m}},Ks=function(l,d,f,m,E,P,R){return o.extend(kf(l,d,f,m),Pc(P,d,R),{u_height_factor:-Math.pow(2,E.overscaledZ)/R.tileSize/8})},qs=function(l){return{u_matrix:l}},rs=function(l,d,f,m){return o.extend(qs(l),Pc(f,d,m))},Nf=function(l,d){return{u_matrix:l,u_world:d}},fu=function(l,d,f,m,E){return o.extend(rs(l,d,f,m),{u_world:E})},du=function(l,d,f,m){var E,P,R=l.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var F=Rn(f,1,R.zoom);E=!0,P=[F,F]}else E=!1,P=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(d.posMatrix,f,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:o.browser.devicePixelRatio,u_extrude_scale:P}},Za=function(l,d,f){var m=Rn(f,1,d.zoom),E=Math.pow(2,d.zoom-f.tileID.overscaledZ),P=f.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:d.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[d.pixelsToGLUnits[0]/(m*E),d.pixelsToGLUnits[1]/(m*E)],u_overscale_factor:P}},_h=function(l,d,f){return{u_matrix:l,u_inv_matrix:d,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},Zs=function(l,d,f){return f===void 0&&(f=1),{u_matrix:l,u_color:d,u_overlay:0,u_overlay_scale:f}},Ys=function(l){return{u_matrix:l}},Bl=function(l,d,f,m){return{u_matrix:l,u_extrude_scale:Rn(d,1,f),u_intensity:m}},Dn=function(l,d,f){var m=l.transform;return{u_matrix:Uf(l,d,f),u_ratio:1/Rn(d,1,m.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Fn=function(l,d,f,m){return o.extend(Dn(l,d,f),{u_image:0,u_image_height:m})},pu=function(l,d,f,m){var E=l.transform,P=Rc(d,E);return{u_matrix:Uf(l,d,f),u_texsize:d.imageAtlasTexture.size,u_ratio:1/Rn(d,1,E.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},aA=function(l,d,f,m,E){var P=l.lineAtlas,R=Rc(d,l.transform),F=f.layout.get("line-cap")==="round",z=P.getDash(m.from,F),W=P.getDash(m.to,F),et=z.width*E.fromScale,Z=W.width*E.toScale;return o.extend(Dn(l,d,f),{u_patternscale_a:[R/et,-z.height/2],u_patternscale_b:[R/Z,-W.height/2],u_sdfgamma:P.width/(256*Math.min(et,Z)*o.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:z.y,u_tex_y_b:W.y,u_mix:E.t})};function Rc(l,d){return 1/Rn(l,1,d.tileZoom)}function Uf(l,d,f){return l.translatePosMatrix(d.tileID.posMatrix,d,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var cA=function(l,d,f,m,E){return{u_matrix:l,u_tl_parent:d,u_scale_parent:f,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(R=E.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(P=E.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:zf(E.paint.get("raster-hue-rotate"))};var P,R};function zf(l){l*=Math.PI/180;var d=Math.sin(l),f=Math.cos(l);return[(2*f+1)/3,(-Math.sqrt(3)*d-f+1)/3,(Math.sqrt(3)*d-f+1)/3]}var eo,Sa=function(l,d,f,m,E,P,R,F,z,W){var et=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:d?d.uSizeT:0,u_size:d?d.uSize:0,u_camera_to_center_distance:et.cameraToCenterDistance,u_pitch:et.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:et.width/et.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:R,u_coord_matrix:F,u_is_text:+z,u_pitch_with_map:+m,u_texsize:W,u_texture:0}},ws=function(l,d,f,m,E,P,R,F,z,W,et){var Z=E.transform;return o.extend(Sa(l,d,f,m,E,P,R,F,z,W),{u_gamma_scale:m?Math.cos(Z._pitch)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:o.browser.devicePixelRatio,u_is_halo:1})},Au=function(l,d,f,m,E,P,R,F,z,W){return o.extend(ws(l,d,f,m,E,P,R,F,!0,z),{u_texsize_icon:W,u_texture_icon:1})},Ya=function(l,d,f){return{u_matrix:l,u_opacity:d,u_color:f}},Dc=function(l,d,f,m,E,P){return o.extend(function(R,F,z,W){var et=z.imageManager.getPattern(R.from.toString()),Z=z.imageManager.getPattern(R.to.toString()),it=z.imageManager.getPixelSize(),ot=it.width,bt=it.height,Pt=Math.pow(2,W.tileID.overscaledZ),mt=W.tileSize*Math.pow(2,z.transform.tileZoom)/Pt,It=mt*(W.tileID.canonical.x+W.tileID.wrap*Pt),Vt=mt*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:et.tl,u_pattern_br_a:et.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[ot,bt],u_mix:F.t,u_pattern_size_a:et.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/Rn(W,1,z.transform.tileZoom),u_pixel_coord_upper:[It>>16,Vt>>16],u_pixel_coord_lower:[65535&It,65535&Vt]}}(m,P,f,E),{u_matrix:l,u_opacity:d})},Vo={fillExtrusion:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_lightpos:new o.Uniform3f(l,d.u_lightpos),u_lightintensity:new o.Uniform1f(l,d.u_lightintensity),u_lightcolor:new o.Uniform3f(l,d.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,d.u_vertical_gradient),u_opacity:new o.Uniform1f(l,d.u_opacity)}},fillExtrusionPattern:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_lightpos:new o.Uniform3f(l,d.u_lightpos),u_lightintensity:new o.Uniform1f(l,d.u_lightintensity),u_lightcolor:new o.Uniform3f(l,d.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,d.u_vertical_gradient),u_height_factor:new o.Uniform1f(l,d.u_height_factor),u_image:new o.Uniform1i(l,d.u_image),u_texsize:new o.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,d.u_scale),u_fade:new o.Uniform1f(l,d.u_fade),u_opacity:new o.Uniform1f(l,d.u_opacity)}},fill:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix)}},fillPattern:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_image:new o.Uniform1i(l,d.u_image),u_texsize:new o.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,d.u_scale),u_fade:new o.Uniform1f(l,d.u_fade)}},fillOutline:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_world:new o.Uniform2f(l,d.u_world)}},fillOutlinePattern:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_world:new o.Uniform2f(l,d.u_world),u_image:new o.Uniform1i(l,d.u_image),u_texsize:new o.Uniform2f(l,d.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,d.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,d.u_scale),u_fade:new o.Uniform1f(l,d.u_fade)}},circle:function(l,d){return{u_camera_to_center_distance:new o.Uniform1f(l,d.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(l,d.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(l,d.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(l,d.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(l,d.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(l,d.u_matrix)}},collisionBox:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_camera_to_center_distance:new o.Uniform1f(l,d.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(l,d.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(l,d.u_extrude_scale),u_overscale_factor:new o.Uniform1f(l,d.u_overscale_factor)}},collisionCircle:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_inv_matrix:new o.UniformMatrix4f(l,d.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(l,d.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(l,d.u_viewport_size)}},debug:function(l,d){return{u_color:new o.UniformColor(l,d.u_color),u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_overlay:new o.Uniform1i(l,d.u_overlay),u_overlay_scale:new o.Uniform1f(l,d.u_overlay_scale)}},clippingMask:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix)}},heatmap:function(l,d){return{u_extrude_scale:new o.Uniform1f(l,d.u_extrude_scale),u_intensity:new o.Uniform1f(l,d.u_intensity),u_matrix:new o.UniformMatrix4f(l,d.u_matrix)}},heatmapTexture:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_world:new o.Uniform2f(l,d.u_world),u_image:new o.Uniform1i(l,d.u_image),u_color_ramp:new o.Uniform1i(l,d.u_color_ramp),u_opacity:new o.Uniform1f(l,d.u_opacity)}},hillshade:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_image:new o.Uniform1i(l,d.u_image),u_latrange:new o.Uniform2f(l,d.u_latrange),u_light:new o.Uniform2f(l,d.u_light),u_shadow:new o.UniformColor(l,d.u_shadow),u_highlight:new o.UniformColor(l,d.u_highlight),u_accent:new o.UniformColor(l,d.u_accent)}},hillshadePrepare:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_image:new o.Uniform1i(l,d.u_image),u_dimension:new o.Uniform2f(l,d.u_dimension),u_zoom:new o.Uniform1f(l,d.u_zoom),u_unpack:new o.Uniform4f(l,d.u_unpack)}},line:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_ratio:new o.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,d.u_units_to_pixels)}},lineGradient:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_ratio:new o.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,d.u_units_to_pixels),u_image:new o.Uniform1i(l,d.u_image),u_image_height:new o.Uniform1f(l,d.u_image_height)}},linePattern:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_texsize:new o.Uniform2f(l,d.u_texsize),u_ratio:new o.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,d.u_device_pixel_ratio),u_image:new o.Uniform1i(l,d.u_image),u_units_to_pixels:new o.Uniform2f(l,d.u_units_to_pixels),u_scale:new o.Uniform3f(l,d.u_scale),u_fade:new o.Uniform1f(l,d.u_fade)}},lineSDF:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_ratio:new o.Uniform1f(l,d.u_ratio),u_device_pixel_ratio:new o.Uniform1f(l,d.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,d.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(l,d.u_patternscale_a),u_patternscale_b:new o.Uniform2f(l,d.u_patternscale_b),u_sdfgamma:new o.Uniform1f(l,d.u_sdfgamma),u_image:new o.Uniform1i(l,d.u_image),u_tex_y_a:new o.Uniform1f(l,d.u_tex_y_a),u_tex_y_b:new o.Uniform1f(l,d.u_tex_y_b),u_mix:new o.Uniform1f(l,d.u_mix)}},raster:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_tl_parent:new o.Uniform2f(l,d.u_tl_parent),u_scale_parent:new o.Uniform1f(l,d.u_scale_parent),u_buffer_scale:new o.Uniform1f(l,d.u_buffer_scale),u_fade_t:new o.Uniform1f(l,d.u_fade_t),u_opacity:new o.Uniform1f(l,d.u_opacity),u_image0:new o.Uniform1i(l,d.u_image0),u_image1:new o.Uniform1i(l,d.u_image1),u_brightness_low:new o.Uniform1f(l,d.u_brightness_low),u_brightness_high:new o.Uniform1f(l,d.u_brightness_high),u_saturation_factor:new o.Uniform1f(l,d.u_saturation_factor),u_contrast_factor:new o.Uniform1f(l,d.u_contrast_factor),u_spin_weights:new o.Uniform3f(l,d.u_spin_weights)}},symbolIcon:function(l,d){return{u_is_size_zoom_constant:new o.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,d.u_size_t),u_size:new o.Uniform1f(l,d.u_size),u_camera_to_center_distance:new o.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,d.u_pitch),u_rotate_symbol:new o.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,d.u_fade_change),u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new o.Uniform1i(l,d.u_is_text),u_pitch_with_map:new o.Uniform1i(l,d.u_pitch_with_map),u_texsize:new o.Uniform2f(l,d.u_texsize),u_texture:new o.Uniform1i(l,d.u_texture)}},symbolSDF:function(l,d){return{u_is_size_zoom_constant:new o.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,d.u_size_t),u_size:new o.Uniform1f(l,d.u_size),u_camera_to_center_distance:new o.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,d.u_pitch),u_rotate_symbol:new o.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,d.u_fade_change),u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new o.Uniform1i(l,d.u_is_text),u_pitch_with_map:new o.Uniform1i(l,d.u_pitch_with_map),u_texsize:new o.Uniform2f(l,d.u_texsize),u_texture:new o.Uniform1i(l,d.u_texture),u_gamma_scale:new o.Uniform1f(l,d.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,d.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(l,d.u_is_halo)}},symbolTextAndIcon:function(l,d){return{u_is_size_zoom_constant:new o.Uniform1i(l,d.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,d.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,d.u_size_t),u_size:new o.Uniform1f(l,d.u_size),u_camera_to_center_distance:new o.Uniform1f(l,d.u_camera_to_center_distance),u_pitch:new o.Uniform1f(l,d.u_pitch),u_rotate_symbol:new o.Uniform1i(l,d.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,d.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,d.u_fade_change),u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,d.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,d.u_coord_matrix),u_is_text:new o.Uniform1i(l,d.u_is_text),u_pitch_with_map:new o.Uniform1i(l,d.u_pitch_with_map),u_texsize:new o.Uniform2f(l,d.u_texsize),u_texsize_icon:new o.Uniform2f(l,d.u_texsize_icon),u_texture:new o.Uniform1i(l,d.u_texture),u_texture_icon:new o.Uniform1i(l,d.u_texture_icon),u_gamma_scale:new o.Uniform1f(l,d.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,d.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(l,d.u_is_halo)}},background:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_opacity:new o.Uniform1f(l,d.u_opacity),u_color:new o.UniformColor(l,d.u_color)}},backgroundPattern:function(l,d){return{u_matrix:new o.UniformMatrix4f(l,d.u_matrix),u_opacity:new o.Uniform1f(l,d.u_opacity),u_image:new o.Uniform1i(l,d.u_image),u_pattern_tl_a:new o.Uniform2f(l,d.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(l,d.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(l,d.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(l,d.u_pattern_br_b),u_texsize:new o.Uniform2f(l,d.u_texsize),u_mix:new o.Uniform1f(l,d.u_mix),u_pattern_size_a:new o.Uniform2f(l,d.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(l,d.u_pattern_size_b),u_scale_a:new o.Uniform1f(l,d.u_scale_a),u_scale_b:new o.Uniform1f(l,d.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(l,d.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,d.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(l,d.u_tile_units_to_pixels)}}};function $a(l,d,f,m,E,P,R){for(var F=l.context,z=F.gl,W=l.useProgram("collisionBox"),et=[],Z=0,it=0,ot=0;ot<m.length;ot++){var bt=m[ot],Pt=d.getTile(bt),mt=Pt.getBucket(f);if(mt){var It=bt.posMatrix;E[0]===0&&E[1]===0||(It=l.translatePosMatrix(bt.posMatrix,Pt,E,P));var Vt=R?mt.textCollisionBox:mt.iconCollisionBox,Jt=mt.collisionCircleArray;if(Jt.length>0){var te=o.create(),Qt=It;o.mul(te,mt.placementInvProjMatrix,l.transform.glCoordMatrix),o.mul(te,te,mt.placementViewportMatrix),et.push({circleArray:Jt,circleOffset:it,transform:Qt,invTransform:te}),it=Z+=Jt.length/4}Vt&&W.draw(F,z.LINES,vt.disabled,Ot.disabled,l.colorModeForRenderPass(),_t.disabled,Za(It,l.transform,Pt),f.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,null,l.transform.zoom,null,null,Vt.collisionVertexBuffer)}}if(R&&et.length){var $t=l.useProgram("collisionCircle"),pe=new o.StructArrayLayout2f1f2i16;pe.resize(4*Z),pe._trim();for(var Oe=0,xe=0,Ue=et;xe<Ue.length;xe+=1)for(var oi=Ue[xe],Ei=0;Ei<oi.circleArray.length/4;Ei++){var Si=4*Ei,xn=oi.circleArray[Si+0],ai=oi.circleArray[Si+1],Wi=oi.circleArray[Si+2],nn=oi.circleArray[Si+3];pe.emplace(Oe++,xn,ai,Wi,nn,0),pe.emplace(Oe++,xn,ai,Wi,nn,1),pe.emplace(Oe++,xn,ai,Wi,nn,2),pe.emplace(Oe++,xn,ai,Wi,nn,3)}(!eo||eo.length<2*Z)&&(eo=function(Tr){var _o=2*Tr,oo=new o.StructArrayLayout3ui6;oo.resize(_o),oo._trim();for(var br=0;br<_o;br++){var Pr=6*br;oo.uint16[Pr+0]=4*br+0,oo.uint16[Pr+1]=4*br+1,oo.uint16[Pr+2]=4*br+2,oo.uint16[Pr+3]=4*br+2,oo.uint16[Pr+4]=4*br+3,oo.uint16[Pr+5]=4*br+0}return oo}(Z));for(var Hi=F.createIndexBuffer(eo,!0),zi=F.createVertexBuffer(pe,o.collisionCircleLayout.members,!0),Yi=0,Fi=et;Yi<Fi.length;Yi+=1){var Oi=Fi[Yi],Qr=_h(Oi.transform,Oi.invTransform,l.transform);$t.draw(F,z.TRIANGLES,vt.disabled,Ot.disabled,l.colorModeForRenderPass(),_t.disabled,Qr,f.id,zi,Hi,o.SegmentVector.simpleSegment(0,2*Oi.circleOffset,Oi.circleArray.length,Oi.circleArray.length/2),null,l.transform.zoom,null,null,null)}zi.destroy(),Hi.destroy()}}var Ho=o.identity(new Float32Array(16));function tc(l,d,f,m,E,P){var R=o.getAnchorAlignment(l),F=-(R.horizontalAlign-.5)*d,z=-(R.verticalAlign-.5)*f,W=o.evaluateVariableOffset(l,m);return new o.Point((F/E+W[0])*P,(z/E+W[1])*P)}function Oc(l,d,f,m,E,P,R,F,z,W,et){var Z=l.text.placedSymbolArray,it=l.text.dynamicLayoutVertexArray,ot=l.icon.dynamicLayoutVertexArray,bt={};it.clear();for(var Pt=0;Pt<Z.length;Pt++){var mt=Z.get(Pt),It=mt.hidden||!mt.crossTileID||l.allowVerticalPlacement&&!mt.placedOrientation?null:m[mt.crossTileID];if(It){var Vt=new o.Point(mt.anchorX,mt.anchorY),Jt=Qe(Vt,f?F:R),te=en(P.cameraToCenterDistance,Jt.signedDistanceFromCamera),Qt=E.evaluateSizeForFeature(l.textSizeData,W,mt)*te/o.ONE_EM;f&&(Qt*=l.tilePixelRatio/z);for(var $t=tc(It.anchor,It.width,It.height,It.textOffset,It.textBoxScale,Qt),pe=f?Qe(Vt.add($t),R).point:Jt.point.add(d?$t.rotate(-P.angle):$t),Oe=l.allowVerticalPlacement&&mt.placedOrientation===o.WritingMode.vertical?Math.PI/2:0,xe=0;xe<mt.numGlyphs;xe++)o.addDynamicAttributes(it,pe,Oe);et&&mt.associatedIconIndex>=0&&(bt[mt.associatedIconIndex]={shiftedAnchor:pe,angle:Oe})}else Fr(mt.numGlyphs,it)}if(et){ot.clear();for(var Ue=l.icon.placedSymbolArray,oi=0;oi<Ue.length;oi++){var Ei=Ue.get(oi);if(Ei.hidden)Fr(Ei.numGlyphs,ot);else{var Si=bt[oi];if(Si)for(var xn=0;xn<Ei.numGlyphs;xn++)o.addDynamicAttributes(ot,Si.shiftedAnchor,Si.angle);else Fr(Ei.numGlyphs,ot)}}l.icon.dynamicLayoutVertexBuffer.updateData(ot)}l.text.dynamicLayoutVertexBuffer.updateData(it)}function Lc(l,d,f){return f.iconsInText&&d?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function ec(l,d,f,m,E,P,R,F,z,W,et,Z){for(var it=l.context,ot=it.gl,bt=l.transform,Pt=F==="map",mt=z==="map",It=Pt&&f.layout.get("symbol-placement")!=="point",Vt=Pt&&!mt&&!It,Jt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,te=!1,Qt=l.depthModeForSublayer(0,vt.ReadOnly),$t=f.layout.get("text-variable-anchor"),pe=[],Oe=0,xe=m;Oe<xe.length;Oe+=1){var Ue=xe[Oe],oi=d.getTile(Ue),Ei=oi.getBucket(f);if(Ei){var Si=E?Ei.text:Ei.icon;if(Si&&Si.segments.get().length){var xn=Si.programConfigurations.get(f.id),ai=E||Ei.sdfIcons,Wi=E?Ei.textSizeData:Ei.iconSizeData,nn=mt||bt.pitch!==0,Hi=l.useProgram(Lc(ai,E,Ei),xn),zi=o.evaluateSizeForZoom(Wi,bt.zoom),Yi=void 0,Fi=[0,0],Oi=void 0,Qr=void 0,Tr=null,_o=void 0;if(E)Oi=oi.glyphAtlasTexture,Qr=ot.LINEAR,Yi=oi.glyphAtlasTexture.size,Ei.iconsInText&&(Fi=oi.imageAtlasTexture.size,Tr=oi.imageAtlasTexture,_o=nn||l.options.rotating||l.options.zooming||Wi.kind==="composite"||Wi.kind==="camera"?ot.LINEAR:ot.NEAREST);else{var oo=f.layout.get("icon-size").constantOr(0)!==1||Ei.iconsNeedLinear;Oi=oi.imageAtlasTexture,Qr=ai||l.options.rotating||l.options.zooming||oo||nn?ot.LINEAR:ot.NEAREST,Yi=oi.imageAtlasTexture.size}var br=Rn(oi,1,l.transform.zoom),Pr=mi(Ue.posMatrix,mt,Pt,l.transform,br),us=Bt(Ue.posMatrix,mt,Pt,l.transform,br),Ro=$t&&Ei.hasTextData(),Vc=f.layout.get("icon-text-fit")!=="none"&&Ro&&Ei.hasIconData();It&&va(Ei,Ue.posMatrix,l,E,Pr,us,mt,W);var Qo=l.translatePosMatrix(Ue.posMatrix,oi,P,R),sa=It||E&&$t||Vc?Ho:Pr,Fs=l.translatePosMatrix(us,oi,P,R,!0),Ih=ai&&f.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Tu={program:Hi,buffers:Si,uniformValues:ai?Ei.iconsInText?Au(Wi.kind,zi,Vt,mt,l,Qo,sa,Fs,Yi,Fi):ws(Wi.kind,zi,Vt,mt,l,Qo,sa,Fs,E,Yi):Sa(Wi.kind,zi,Vt,mt,l,Qo,sa,Fs,E,Yi),atlasTexture:Oi,atlasTextureIcon:Tr,atlasInterpolation:Qr,atlasInterpolationIcon:_o,isSDF:ai,hasHalo:Ih};if(Jt&&Ei.canOverlap){te=!0;for(var Hc=0,Su=Si.segments.get();Hc<Su.length;Hc+=1){var Mh=Su[Hc];pe.push({segments:new o.SegmentVector([Mh]),sortKey:Mh.sortKey,state:Tu})}}else pe.push({segments:Si.segments,sortKey:0,state:Tu})}}}te&&pe.sort(function(Wc,Ll){return Wc.sortKey-Ll.sortKey});for(var Ma=0,Ph=pe;Ma<Ph.length;Ma+=1){var Pa=Ph[Ma],Kr=Pa.state;if(it.activeTexture.set(ot.TEXTURE0),Kr.atlasTexture.bind(Kr.atlasInterpolation,ot.CLAMP_TO_EDGE),Kr.atlasTextureIcon&&(it.activeTexture.set(ot.TEXTURE1),Kr.atlasTextureIcon&&Kr.atlasTextureIcon.bind(Kr.atlasInterpolationIcon,ot.CLAMP_TO_EDGE)),Kr.isSDF){var oc=Kr.uniformValues;Kr.hasHalo&&(oc.u_is_halo=1,Fc(Kr.buffers,Pa.segments,f,l,Kr.program,Qt,et,Z,oc)),oc.u_is_halo=0}Fc(Kr.buffers,Pa.segments,f,l,Kr.program,Qt,et,Z,Kr.uniformValues)}}function Fc(l,d,f,m,E,P,R,F,z){var W=m.context;E.draw(W,W.gl.TRIANGLES,P,R,F,_t.disabled,z,f.id,l.layoutVertexBuffer,l.indexBuffer,d,f.paint,m.transform.zoom,l.programConfigurations.get(f.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function gu(l,d,f,m,E,P,R){var F,z,W,et,Z,it=l.context.gl,ot=f.paint.get("fill-pattern"),bt=ot&&ot.constantOr(1),Pt=f.getCrossfadeParameters();R?(z=bt&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=it.LINES):(z=bt?"fillPattern":"fill",F=it.TRIANGLES);for(var mt=0,It=m;mt<It.length;mt+=1){var Vt=It[mt],Jt=d.getTile(Vt);if(!bt||Jt.patternsLoaded()){var te=Jt.getBucket(f);if(te){var Qt=te.programConfigurations.get(f.id),$t=l.useProgram(z,Qt);bt&&(l.context.activeTexture.set(it.TEXTURE0),Jt.imageAtlasTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE),Qt.updatePaintBuffers(Pt));var pe=ot.constantOr(null);if(pe&&Jt.imageAtlas){var Oe=Jt.imageAtlas,xe=Oe.patternPositions[pe.to.toString()],Ue=Oe.patternPositions[pe.from.toString()];xe&&Ue&&Qt.setConstantPatternPositions(xe,Ue)}var oi=l.translatePosMatrix(Vt.posMatrix,Jt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){et=te.indexBuffer2,Z=te.segments2;var Ei=[it.drawingBufferWidth,it.drawingBufferHeight];W=z==="fillOutlinePattern"&&bt?fu(oi,l,Pt,Jt,Ei):Nf(oi,Ei)}else et=te.indexBuffer,Z=te.segments,W=bt?rs(oi,l,Pt,Jt):qs(oi);$t.draw(l.context,F,E,l.stencilModeForClipping(Vt),P,_t.disabled,W,f.id,te.layoutVertexBuffer,et,Z,f.paint,l.transform.zoom,Qt)}}}}function Tl(l,d,f,m,E,P,R){for(var F=l.context,z=F.gl,W=f.paint.get("fill-extrusion-pattern"),et=W.constantOr(1),Z=f.getCrossfadeParameters(),it=f.paint.get("fill-extrusion-opacity"),ot=0,bt=m;ot<bt.length;ot+=1){var Pt=bt[ot],mt=d.getTile(Pt),It=mt.getBucket(f);if(It){var Vt=It.programConfigurations.get(f.id),Jt=l.useProgram(et?"fillExtrusionPattern":"fillExtrusion",Vt);et&&(l.context.activeTexture.set(z.TEXTURE0),mt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Vt.updatePaintBuffers(Z));var te=W.constantOr(null);if(te&&mt.imageAtlas){var Qt=mt.imageAtlas,$t=Qt.patternPositions[te.to.toString()],pe=Qt.patternPositions[te.from.toString()];$t&&pe&&Vt.setConstantPatternPositions($t,pe)}var Oe=l.translatePosMatrix(Pt.posMatrix,mt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),xe=f.paint.get("fill-extrusion-vertical-gradient"),Ue=et?Ks(Oe,l,xe,it,Pt,Z,mt):kf(Oe,l,xe,it);Jt.draw(F,F.gl.TRIANGLES,E,P,R,_t.backCCW,Ue,f.id,It.layoutVertexBuffer,It.indexBuffer,It.segments,f.paint,l.transform.zoom,Vt)}}}function mu(l,d,f,m,E,P){var R=l.context,F=R.gl,z=d.fbo;if(z){var W=l.useProgram("hillshade");R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,z.colorAttachment.get());var et=function(Z,it,ot){var bt=ot.paint.get("hillshade-shadow-color"),Pt=ot.paint.get("hillshade-highlight-color"),mt=ot.paint.get("hillshade-accent-color"),It=ot.paint.get("hillshade-illumination-direction")*(Math.PI/180);ot.paint.get("hillshade-illumination-anchor")==="viewport"&&(It-=Z.transform.angle);var Vt,Jt,te,Qt=!Z.options.moving;return{u_matrix:Z.transform.calculatePosMatrix(it.tileID.toUnwrapped(),Qt),u_image:0,u_latrange:(Vt=it.tileID,Jt=Math.pow(2,Vt.canonical.z),te=Vt.canonical.y,[new o.MercatorCoordinate(0,te/Jt).toLngLat().lat,new o.MercatorCoordinate(0,(te+1)/Jt).toLngLat().lat]),u_light:[ot.paint.get("hillshade-exaggeration"),It],u_shadow:bt,u_highlight:Pt,u_accent:mt}}(l,d,f);W.draw(R,F.TRIANGLES,m,E,P,_t.disabled,et,f.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function lA(l,d,f,m,E,P){var R=l.context,F=R.gl,z=d.dem;if(z&&z.data){var W=z.dim,et=z.stride,Z=z.getPixels();if(R.activeTexture.set(F.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||l.getTileTexture(et),d.demTexture){var it=d.demTexture;it.update(Z,{premultiply:!1}),it.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else d.demTexture=new o.Texture(R,Z,F.RGBA,{premultiply:!1}),d.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);R.activeTexture.set(F.TEXTURE0);var ot=d.fbo;if(!ot){var bt=new o.Texture(R,{width:W,height:W,data:null},F.RGBA);bt.bind(F.LINEAR,F.CLAMP_TO_EDGE),(ot=d.fbo=R.createFramebuffer(W,W,!0)).colorAttachment.set(bt.texture)}R.bindFramebuffer.set(ot.framebuffer),R.viewport.set([0,0,W,W]),l.useProgram("hillshadePrepare").draw(R,F.TRIANGLES,m,E,P,_t.disabled,function(Pt,mt){var It=mt.stride,Vt=o.create();return o.ortho(Vt,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Vt,Vt,[0,-o.EXTENT,0]),{u_matrix:Vt,u_image:1,u_dimension:[It,It],u_zoom:Pt.overscaledZ,u_unpack:mt.getUnpackVector()}}(d.tileID,z),f.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Sl(l,d,f,m,E){var P=m.paint.get("raster-fade-duration");if(P>0){var R=o.browser.now(),F=(R-l.timeAdded)/P,z=d?(R-d.timeAdded)/P:-1,W=f.getSource(),et=E.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),Z=!d||Math.abs(d.tileID.overscaledZ-et)>Math.abs(l.tileID.overscaledZ-et),it=Z&&l.refreshedUponExpiration?1:o.clamp(Z?F:1-z,0,1);return l.refreshedUponExpiration&&F>=1&&(l.refreshedUponExpiration=!1),d?{opacity:1,mix:1-it}:{opacity:it,mix:0}}return{opacity:1,mix:0}}var yu=new o.Color(1,0,0,1),kc=new o.Color(0,1,0,1),ic=new o.Color(0,0,1,1),vu=new o.Color(1,0,1,1),nc=new o.Color(0,1,1,1);function bh(l,d,f,m){Il(l,0,d+f/2,l.transform.width,f,m)}function xh(l,d,f,m){Il(l,d-f/2,0,f,l.transform.height,m)}function Il(l,d,f,m,E,P){var R=l.context,F=R.gl;F.enable(F.SCISSOR_TEST),F.scissor(d*o.browser.devicePixelRatio,f*o.browser.devicePixelRatio,m*o.browser.devicePixelRatio,E*o.browser.devicePixelRatio),R.clear({color:P}),F.disable(F.SCISSOR_TEST)}function Gf(l,d,f){var m=l.context,E=m.gl,P=f.posMatrix,R=l.useProgram("debug"),F=vt.disabled,z=Ot.disabled,W=l.colorModeForRenderPass();m.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),R.draw(m,E.LINE_STRIP,F,z,W,_t.disabled,Zs(P,o.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var et=d.getTileByID(f.key).latestRawTileData,Z=Math.floor((et&&et.byteLength||0)/1024),it=d.getTile(f).tileSize,ot=512/Math.min(it,512)*(f.overscaledZ/l.transform.zoom)*.5,bt=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(bt+=" => "+f.overscaledZ),function(Pt,mt){Pt.initDebugOverlayCanvas();var It=Pt.debugOverlayCanvas,Vt=Pt.context.gl,Jt=Pt.debugOverlayCanvas.getContext("2d");Jt.clearRect(0,0,It.width,It.height),Jt.shadowColor="white",Jt.shadowBlur=2,Jt.lineWidth=1.5,Jt.strokeStyle="white",Jt.textBaseline="top",Jt.font="bold 36px Open Sans, sans-serif",Jt.fillText(mt,5,5),Jt.strokeText(mt,5,5),Pt.debugOverlayTexture.update(It),Pt.debugOverlayTexture.bind(Vt.LINEAR,Vt.CLAMP_TO_EDGE)}(l,bt+" "+Z+"kb"),R.draw(m,E.TRIANGLES,F,z,ft.alphaBlended,_t.disabled,Zs(P,o.Color.transparent,ot),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var rc={symbol:function(l,d,f,m,E){if(l.renderPass==="translucent"){var P=Ot.disabled,R=l.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(F,z,W,et,Z,it,ot){for(var bt=z.transform,Pt=Z==="map",mt=it==="map",It=0,Vt=F;It<Vt.length;It+=1){var Jt=Vt[It],te=et.getTile(Jt),Qt=te.getBucket(W);if(Qt&&Qt.text&&Qt.text.segments.get().length){var $t=o.evaluateSizeForZoom(Qt.textSizeData,bt.zoom),pe=Rn(te,1,z.transform.zoom),Oe=mi(Jt.posMatrix,mt,Pt,z.transform,pe),xe=W.layout.get("icon-text-fit")!=="none"&&Qt.hasIconData();if($t){var Ue=Math.pow(2,bt.zoom-te.tileID.overscaledZ);Oc(Qt,Pt,mt,ot,o.symbolSize,bt,Oe,Jt.posMatrix,Ue,$t,xe)}}}}(m,l,f,d,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),E),f.paint.get("icon-opacity").constantOr(1)!==0&&ec(l,d,f,m,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),P,R),f.paint.get("text-opacity").constantOr(1)!==0&&ec(l,d,f,m,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),P,R),d.map.showCollisionBoxes&&($a(l,d,f,m,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),$a(l,d,f,m,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(l,d,f,m){if(l.renderPass==="translucent"){var E=f.paint.get("circle-opacity"),P=f.paint.get("circle-stroke-width"),R=f.paint.get("circle-stroke-opacity"),F=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||P.constantOr(1)!==0&&R.constantOr(1)!==0){for(var z=l.context,W=z.gl,et=l.depthModeForSublayer(0,vt.ReadOnly),Z=Ot.disabled,it=l.colorModeForRenderPass(),ot=[],bt=0;bt<m.length;bt++){var Pt=m[bt],mt=d.getTile(Pt),It=mt.getBucket(f);if(It){var Vt=It.programConfigurations.get(f.id),Jt={programConfiguration:Vt,program:l.useProgram("circle",Vt),layoutVertexBuffer:It.layoutVertexBuffer,indexBuffer:It.indexBuffer,uniformValues:du(l,Pt,mt,f)};if(F)for(var te=0,Qt=It.segments.get();te<Qt.length;te+=1){var $t=Qt[te];ot.push({segments:new o.SegmentVector([$t]),sortKey:$t.sortKey,state:Jt})}else ot.push({segments:It.segments,sortKey:0,state:Jt})}}F&&ot.sort(function(oi,Ei){return oi.sortKey-Ei.sortKey});for(var pe=0,Oe=ot;pe<Oe.length;pe+=1){var xe=Oe[pe],Ue=xe.state;Ue.program.draw(z,W.TRIANGLES,et,Z,it,_t.disabled,Ue.uniformValues,f.id,Ue.layoutVertexBuffer,Ue.indexBuffer,xe.segments,f.paint,l.transform.zoom,Ue.programConfiguration)}}}},heatmap:function(l,d,f,m){if(f.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,P=E.gl,R=Ot.disabled,F=new ft([P.ONE,P.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(ot,bt,Pt){var mt=ot.gl;ot.activeTexture.set(mt.TEXTURE1),ot.viewport.set([0,0,bt.width/4,bt.height/4]);var It=Pt.heatmapFbo;if(It)mt.bindTexture(mt.TEXTURE_2D,It.colorAttachment.get()),ot.bindFramebuffer.set(It.framebuffer);else{var Vt=mt.createTexture();mt.bindTexture(mt.TEXTURE_2D,Vt),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_S,mt.CLAMP_TO_EDGE),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_WRAP_T,mt.CLAMP_TO_EDGE),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MIN_FILTER,mt.LINEAR),mt.texParameteri(mt.TEXTURE_2D,mt.TEXTURE_MAG_FILTER,mt.LINEAR),It=Pt.heatmapFbo=ot.createFramebuffer(bt.width/4,bt.height/4,!1),function(Jt,te,Qt,$t){var pe=Jt.gl;pe.texImage2D(pe.TEXTURE_2D,0,pe.RGBA,te.width/4,te.height/4,0,pe.RGBA,Jt.extRenderToTextureHalfFloat?Jt.extTextureHalfFloat.HALF_FLOAT_OES:pe.UNSIGNED_BYTE,null),$t.colorAttachment.set(Qt)}(ot,bt,Vt,It)}})(E,l,f),E.clear({color:o.Color.transparent});for(var z=0;z<m.length;z++){var W=m[z];if(!d.hasRenderableParent(W)){var et=d.getTile(W),Z=et.getBucket(f);if(Z){var it=Z.programConfigurations.get(f.id);l.useProgram("heatmap",it).draw(E,P.TRIANGLES,vt.disabled,R,F,_t.disabled,Bl(W.posMatrix,et,l.transform.zoom,f.paint.get("heatmap-intensity")),f.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,f.paint,l.transform.zoom,it)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(ot,bt){var Pt=ot.context,mt=Pt.gl,It=bt.heatmapFbo;if(It){Pt.activeTexture.set(mt.TEXTURE0),mt.bindTexture(mt.TEXTURE_2D,It.colorAttachment.get()),Pt.activeTexture.set(mt.TEXTURE1);var Vt=bt.colorRampTexture;Vt||(Vt=bt.colorRampTexture=new o.Texture(Pt,bt.colorRamp,mt.RGBA)),Vt.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),ot.useProgram("heatmapTexture").draw(Pt,mt.TRIANGLES,vt.disabled,Ot.disabled,ot.colorModeForRenderPass(),_t.disabled,function(Jt,te,Qt,$t){var pe=o.create();o.ortho(pe,0,Jt.width,Jt.height,0,0,1);var Oe=Jt.context.gl;return{u_matrix:pe,u_world:[Oe.drawingBufferWidth,Oe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:te.paint.get("heatmap-opacity")}}(ot,bt),bt.id,ot.viewportBuffer,ot.quadTriangleIndexBuffer,ot.viewportSegments,bt.paint,ot.transform.zoom)}}(l,f))},line:function(l,d,f,m){if(l.renderPass==="translucent"){var E=f.paint.get("line-opacity"),P=f.paint.get("line-width");if(E.constantOr(1)!==0&&P.constantOr(1)!==0)for(var R=l.depthModeForSublayer(0,vt.ReadOnly),F=l.colorModeForRenderPass(),z=f.paint.get("line-dasharray"),W=f.paint.get("line-pattern"),et=W.constantOr(1),Z=f.paint.get("line-gradient"),it=f.getCrossfadeParameters(),ot=et?"linePattern":z?"lineSDF":Z?"lineGradient":"line",bt=l.context,Pt=bt.gl,mt=!0,It=0,Vt=m;It<Vt.length;It+=1){var Jt=Vt[It],te=d.getTile(Jt);if(!et||te.patternsLoaded()){var Qt=te.getBucket(f);if(Qt){var $t=Qt.programConfigurations.get(f.id),pe=l.context.program.get(),Oe=l.useProgram(ot,$t),xe=mt||Oe.program!==pe,Ue=W.constantOr(null);if(Ue&&te.imageAtlas){var oi=te.imageAtlas,Ei=oi.patternPositions[Ue.to.toString()],Si=oi.patternPositions[Ue.from.toString()];Ei&&Si&&$t.setConstantPatternPositions(Ei,Si)}var xn=et?pu(l,te,f,it):z?aA(l,te,f,z,it):Z?Fn(l,te,f,Qt.lineClipsArray.length):Dn(l,te,f);if(et)bt.activeTexture.set(Pt.TEXTURE0),te.imageAtlasTexture.bind(Pt.LINEAR,Pt.CLAMP_TO_EDGE),$t.updatePaintBuffers(it);else if(z&&(xe||l.lineAtlas.dirty))bt.activeTexture.set(Pt.TEXTURE0),l.lineAtlas.bind(bt);else if(Z){var ai=Qt.gradients[f.id],Wi=ai.texture;if(f.gradientVersion!==ai.version){var nn=256;if(f.stepInterpolant){var Hi=d.getSource().maxzoom,zi=Jt.canonical.z===Hi?Math.ceil(1<<l.transform.maxZoom-Jt.canonical.z):1;nn=o.clamp(o.nextPowerOfTwo(Qt.maxLineLength/o.EXTENT*1024*zi),256,bt.maxTextureSize)}ai.gradient=o.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:nn,image:ai.gradient||void 0,clips:Qt.lineClipsArray}),ai.texture?ai.texture.update(ai.gradient):ai.texture=new o.Texture(bt,ai.gradient,Pt.RGBA),ai.version=f.gradientVersion,Wi=ai.texture}bt.activeTexture.set(Pt.TEXTURE0),Wi.bind(f.stepInterpolant?Pt.NEAREST:Pt.LINEAR,Pt.CLAMP_TO_EDGE)}Oe.draw(bt,Pt.TRIANGLES,R,l.stencilModeForClipping(Jt),F,_t.disabled,xn,f.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,f.paint,l.transform.zoom,$t,Qt.layoutVertexBuffer2),mt=!1}}}}},fill:function(l,d,f,m){var E=f.paint.get("fill-color"),P=f.paint.get("fill-opacity");if(P.constantOr(1)!==0){var R=l.colorModeForRenderPass(),F=f.paint.get("fill-pattern"),z=l.opaquePassEnabledForLayer()&&!F.constantOr(1)&&E.constantOr(o.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===z){var W=l.depthModeForSublayer(1,l.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);gu(l,d,f,m,W,R,!1)}if(l.renderPass==="translucent"&&f.paint.get("fill-antialias")){var et=l.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);gu(l,d,f,m,et,R,!0)}}},"fill-extrusion":function(l,d,f,m){var E=f.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var P=new vt(l.context.gl.LEQUAL,vt.ReadWrite,l.depthRangeFor3D);if(E!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Tl(l,d,f,m,P,Ot.disabled,ft.disabled),Tl(l,d,f,m,P,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var R=l.colorModeForRenderPass();Tl(l,d,f,m,P,Ot.disabled,R)}}},hillshade:function(l,d,f,m){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,P=l.depthModeForSublayer(0,vt.ReadOnly),R=l.colorModeForRenderPass(),F=l.renderPass==="translucent"?l.stencilConfigForOverlap(m):[{},m],z=F[0],W=0,et=F[1];W<et.length;W+=1){var Z=et[W],it=d.getTile(Z);it.needsHillshadePrepare&&l.renderPass==="offscreen"?lA(l,it,f,P,Ot.disabled,R):l.renderPass==="translucent"&&mu(l,it,f,P,z[Z.overscaledZ],R)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,d,f,m){if(l.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&m.length)for(var E=l.context,P=E.gl,R=d.getSource(),F=l.useProgram("raster"),z=l.colorModeForRenderPass(),W=R instanceof de?[{},m]:l.stencilConfigForOverlap(m),et=W[0],Z=W[1],it=Z[Z.length-1].overscaledZ,ot=!l.options.moving,bt=0,Pt=Z;bt<Pt.length;bt+=1){var mt=Pt[bt],It=l.depthModeForSublayer(mt.overscaledZ-it,f.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,P.LESS),Vt=d.getTile(mt),Jt=l.transform.calculatePosMatrix(mt.toUnwrapped(),ot);Vt.registerFadeDuration(f.paint.get("raster-fade-duration"));var te=d.findLoadedParent(mt,0),Qt=Sl(Vt,te,d,f,l.transform),$t=void 0,pe=void 0,Oe=f.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;E.activeTexture.set(P.TEXTURE0),Vt.texture.bind(Oe,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(P.TEXTURE1),te?(te.texture.bind(Oe,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),$t=Math.pow(2,te.tileID.overscaledZ-Vt.tileID.overscaledZ),pe=[Vt.tileID.canonical.x*$t%1,Vt.tileID.canonical.y*$t%1]):Vt.texture.bind(Oe,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var xe=cA(Jt,pe||[0,0],$t||1,Qt,f);R instanceof de?F.draw(E,P.TRIANGLES,It,Ot.disabled,z,_t.disabled,xe,f.id,R.boundsBuffer,l.quadTriangleIndexBuffer,R.boundsSegments):F.draw(E,P.TRIANGLES,It,et[mt.overscaledZ],z,_t.disabled,xe,f.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,d,f){var m=f.paint.get("background-color"),E=f.paint.get("background-opacity");if(E!==0){var P=l.context,R=P.gl,F=l.transform,z=F.tileSize,W=f.paint.get("background-pattern");if(!l.isPatternMissing(W)){var et=!W&&m.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===et){var Z=Ot.disabled,it=l.depthModeForSublayer(0,et==="opaque"?vt.ReadWrite:vt.ReadOnly),ot=l.colorModeForRenderPass(),bt=l.useProgram(W?"backgroundPattern":"background"),Pt=F.coveringTiles({tileSize:z});W&&(P.activeTexture.set(R.TEXTURE0),l.imageManager.bind(l.context));for(var mt=f.getCrossfadeParameters(),It=0,Vt=Pt;It<Vt.length;It+=1){var Jt=Vt[It],te=l.transform.calculatePosMatrix(Jt.toUnwrapped()),Qt=W?Dc(te,E,l,W,{tileID:Jt,tileSize:z},mt):Ya(te,E,m);bt.draw(P,R.TRIANGLES,it,Z,ot,_t.disabled,Qt,f.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,d,f){for(var m=0;m<f.length;m++)Gf(l,d,f[m])},custom:function(l,d,f){var m=l.context,E=f.implementation;if(l.renderPass==="offscreen"){var P=E.prerender;P&&(l.setCustomLayerDefaults(),m.setColorMode(l.colorModeForRenderPass()),P.call(E,m.gl,l.transform.customLayerMatrix()),m.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),m.setColorMode(l.colorModeForRenderPass()),m.setStencilMode(Ot.disabled);var R=E.renderingMode==="3d"?new vt(l.context.gl.LEQUAL,vt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,vt.ReadOnly);m.setDepthMode(R),E.render(m.gl,l.transform.customLayerMatrix()),m.setDirty(),l.setBaseState(),m.bindFramebuffer.set(null)}}},Xn=function(l,d){this.context=new st(l),this.transform=d,this._tileTextures={},this.setup(),this.numSublayers=wt.maxUnderzooming+wt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ba,this.gpuTimers={}};Xn.prototype.resize=function(l,d){if(this.width=l*o.browser.devicePixelRatio,this.height=d*o.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,m=this.style._order;f<m.length;f+=1)this.style._layers[m[f]].resize()},Xn.prototype.setup=function(){var l=this.context,d=new o.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(o.EXTENT,0),d.emplaceBack(0,o.EXTENT),d.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,fr.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);var f=new o.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(o.EXTENT,0),f.emplaceBack(0,o.EXTENT),f.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=l.createVertexBuffer(f,fr.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);var m=new o.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(o.EXTENT,0,o.EXTENT,0),m.emplaceBack(0,o.EXTENT,0,o.EXTENT),m.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(m,se.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);var E=new o.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,fr.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);var P=new o.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);var R=new o.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(R),this.emptyTexture=new o.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new Ot({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},Xn.prototype.clearStencil=function(){var l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=o.create();o.ortho(f,0,this.width,this.height,0,0,1),o.scale(f,f,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,d.TRIANGLES,vt.disabled,this.stencilClearMode,ft.disabled,_t.disabled,Ys(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Xn.prototype._renderTileClippingMasks=function(l,d){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&d&&d.length){this.currentStencilSource=l.source;var f=this.context,m=f.gl;this.nextStencilID+d.length>256&&this.clearStencil(),f.setColorMode(ft.disabled),f.setDepthMode(vt.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,R=d;P<R.length;P+=1){var F=R[P],z=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;E.draw(f,m.TRIANGLES,vt.disabled,new Ot({func:m.ALWAYS,mask:0},z,255,m.KEEP,m.KEEP,m.REPLACE),ft.disabled,_t.disabled,Ys(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Xn.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,d=this.context.gl;return new Ot({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)},Xn.prototype.stencilModeForClipping=function(l){var d=this.context.gl;return new Ot({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)},Xn.prototype.stencilConfigForOverlap=function(l){var d,f=this.context.gl,m=l.sort(function(z,W){return W.overscaledZ-z.overscaledZ}),E=m[m.length-1].overscaledZ,P=m[0].overscaledZ-E+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var R={},F=0;F<P;F++)R[F+E]=new Ot({func:f.GEQUAL,mask:255},F+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=P,[R,m]}return[(d={},d[E]=Ot.disabled,d),m]},Xn.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new ft([l.CONSTANT_COLOR,l.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ft.unblended:ft.alphaBlended},Xn.prototype.depthModeForSublayer=function(l,d,f){if(!this.opaquePassEnabledForLayer())return vt.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new vt(f||this.context.gl.LEQUAL,d,[m,m])},Xn.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Xn.prototype.render=function(l,d){var f=this;this.style=l,this.options=d,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();var m=this.style._order,E=this.style.sourceCaches;for(var P in E){var R=E[P];R.used&&R.prepare(this.context)}var F,z,W={},et={},Z={};for(var it in E){var ot=E[it];W[it]=ot.getVisibleCoordinates(),et[it]=W[it].slice().reverse(),Z[it]=ot.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var bt=0;bt<m.length;bt++)if(this.style._layers[m[bt]].is3D()){this.opaquePassCutoff=bt;break}this.renderPass="offscreen";for(var Pt=0,mt=m;Pt<mt.length;Pt+=1){var It=this.style._layers[mt[Pt]];if(It.hasOffscreenPass()&&!It.isHidden(this.transform.zoom)){var Vt=et[It.source];(It.type==="custom"||Vt.length)&&this.renderLayer(this,E[It.source],It,Vt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var Jt=this.style._layers[m[this.currentLayer]],te=E[Jt.source],Qt=W[Jt.source];this._renderTileClippingMasks(Jt,Qt),this.renderLayer(this,te,Jt,Qt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var $t=this.style._layers[m[this.currentLayer]],pe=E[$t.source],Oe=($t.type==="symbol"?Z:et)[$t.source];this._renderTileClippingMasks($t,W[$t.source]),this.renderLayer(this,pe,$t,Oe)}this.options.showTileBoundaries&&(o.values(this.style._layers).forEach(function(xe){xe.source&&!xe.isHidden(f.transform.zoom)&&(xe.source!==(z&&z.id)&&(z=f.style.sourceCaches[xe.source]),(!F||F.getSource().maxzoom<z.getSource().maxzoom)&&(F=z))}),F&&rc.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&function(xe){var Ue=xe.transform.padding;bh(xe,xe.transform.height-(Ue.top||0),3,yu),bh(xe,Ue.bottom||0,3,kc),xh(xe,Ue.left||0,3,ic),xh(xe,xe.transform.width-(Ue.right||0),3,vu);var oi=xe.transform.centerPoint;(function(Ei,Si,xn,ai){Il(Ei,Si-1,xn-10,2,20,ai),Il(Ei,Si-10,xn-1,20,2,ai)})(xe,oi.x,xe.transform.height-oi.y,nc)}(this),this.context.setDefault()},Xn.prototype.renderLayer=function(l,d,f,m){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||m.length)&&(this.id=f.id,this.gpuTimingStart(f),rc[f.type](l,d,f,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},Xn.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var d=this.context.extTimerQuery,f=this.gpuTimers[l.id];f||(f=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),f.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,f.query)}},Xn.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Xn.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Xn.prototype.queryGpuTimers=function(l){var d={};for(var f in l){var m=l[f],E=this.context.extTimerQuery,P=E.getQueryObjectEXT(m.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(m.query),d[f]=P}return d},Xn.prototype.translatePosMatrix=function(l,d,f,m,E){if(!f[0]&&!f[1])return l;var P=E?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(P){var R=Math.sin(P),F=Math.cos(P);f=[f[0]*F-f[1]*R,f[0]*R+f[1]*F]}var z=[E?f[0]:Rn(d,f[0],this.transform.zoom),E?f[1]:Rn(d,f[1],this.transform.zoom),0],W=new Float32Array(16);return o.translate(W,l,z),W},Xn.prototype.saveTileTexture=function(l){var d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]},Xn.prototype.getTileTexture=function(l){var d=this._tileTextures[l];return d&&d.length>0?d.pop():null},Xn.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var d=this.imageManager.getPattern(l.from.toString()),f=this.imageManager.getPattern(l.to.toString());return!d||!f},Xn.prototype.useProgram=function(l,d){this.cache=this.cache||{};var f=""+l+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new Ff(this.context,l,uu[l],d,Vo[l],this._showOverdrawInspector)),this.cache[f]},Xn.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Xn.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Xn.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Xn.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var _u=function(l,d){this.points=l,this.planes=d};_u.fromInvProjectionMatrix=function(l,d,f){var m=Math.pow(2,f),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return o.transformMat4([],R,l)}).map(function(R){return o.scale$1([],R,1/R[3]/d*m)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var F=o.sub([],E[R[0]],E[R[1]]),z=o.sub([],E[R[2]],E[R[1]]),W=o.normalize([],o.cross([],F,z)),et=-o.dot(W,E[R[1]]);return W.concat(et)});return new _u(E,P)};var $s=function(l,d){this.min=l,this.max=d,this.center=o.scale$2([],o.add([],this.min,this.max),.5)};$s.prototype.quadrant=function(l){for(var d=[l%2==0,l<2],f=o.clone$2(this.min),m=o.clone$2(this.max),E=0;E<d.length;E++)f[E]=d[E]?this.min[E]:this.center[E],m[E]=d[E]?this.center[E]:this.max[E];return m[2]=this.max[2],new $s(f,m)},$s.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},$s.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},$s.prototype.intersects=function(l){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,m=0;m<l.planes.length;m++){for(var E=l.planes[m],P=0,R=0;R<d.length;R++)P+=o.dot$1(E,d[R])>=0;if(P===0)return 0;P!==d.length&&(f=!1)}if(f)return 2;for(var F=0;F<3;F++){for(var z=Number.MAX_VALUE,W=-Number.MAX_VALUE,et=0;et<l.points.length;et++){var Z=l.points[et][F]-this.min[F];z=Math.min(z,Z),W=Math.max(W,Z)}if(W<0||z>this.max[F]-this.min[F])return 0}return 1};var ta=function(l,d,f,m){if(l===void 0&&(l=0),d===void 0&&(d=0),f===void 0&&(f=0),m===void 0&&(m=0),isNaN(l)||l<0||isNaN(d)||d<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=f,this.right=m};ta.prototype.interpolate=function(l,d,f){return d.top!=null&&l.top!=null&&(this.top=o.number(l.top,d.top,f)),d.bottom!=null&&l.bottom!=null&&(this.bottom=o.number(l.bottom,d.bottom,f)),d.left!=null&&l.left!=null&&(this.left=o.number(l.left,d.left,f)),d.right!=null&&l.right!=null&&(this.right=o.number(l.right,d.right,f)),this},ta.prototype.getCenter=function(l,d){var f=o.clamp((this.left+l-this.right)/2,0,l),m=o.clamp((this.top+d-this.bottom)/2,0,d);return new o.Point(f,m)},ta.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},ta.prototype.clone=function(){return new ta(this.top,this.bottom,this.left,this.right)},ta.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var hn=function(l,d,f,m,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=f??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ta,this._posMatrixCache={},this._alignedPosMatrixCache={}},kn={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};hn.prototype.clone=function(){var l=new hn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},kn.minZoom.get=function(){return this._minZoom},kn.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},kn.maxZoom.get=function(){return this._maxZoom},kn.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},kn.minPitch.get=function(){return this._minPitch},kn.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},kn.maxPitch.get=function(){return this._maxPitch},kn.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},kn.renderWorldCopies.get=function(){return this._renderWorldCopies},kn.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},kn.worldSize.get=function(){return this.tileSize*this.scale},kn.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},kn.size.get=function(){return new o.Point(this.width,this.height)},kn.bearing.get=function(){return-this.angle/Math.PI*180},kn.bearing.set=function(l){var d=-o.wrap(l,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},kn.pitch.get=function(){return this._pitch/Math.PI*180},kn.pitch.set=function(l){var d=o.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},kn.fov.get=function(){return this._fov/Math.PI*180},kn.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},kn.zoom.get=function(){return this._zoom},kn.zoom.set=function(l){var d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},kn.center.get=function(){return this._center},kn.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},kn.padding.get=function(){return this._edgeInsets.toJSON()},kn.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},kn.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},hn.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},hn.prototype.interpolatePadding=function(l,d,f){this._unmodified=!1,this._edgeInsets.interpolate(l,d,f),this._constrain(),this._calcMatrices()},hn.prototype.coveringZoomLevel=function(l){var d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)},hn.prototype.getVisibleUnwrappedCoordinates=function(l){var d=[new o.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new o.Point(0,0)),m=this.pointCoordinate(new o.Point(this.width,0)),E=this.pointCoordinate(new o.Point(this.width,this.height)),P=this.pointCoordinate(new o.Point(0,this.height)),R=Math.floor(Math.min(f.x,m.x,E.x,P.x)),F=Math.floor(Math.max(f.x,m.x,E.x,P.x)),z=R-1;z<=F+1;z++)z!==0&&d.push(new o.UnwrappedTileID(z,l));return d},hn.prototype.coveringTiles=function(l){var d=this.coveringZoomLevel(l),f=d;if(l.minzoom!==void 0&&d<l.minzoom)return[];l.maxzoom!==void 0&&d>l.maxzoom&&(d=l.maxzoom);var m=o.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,d),P=[E*m.x,E*m.y,0],R=_u.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),F=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=d);var z=function(xe){return{aabb:new $s([xe*E,0,0],[(xe+1)*E,E,0]),zoom:0,x:0,y:0,wrap:xe,fullyVisible:!1}},W=[],et=[],Z=d,it=l.reparseOverscaled?f:d;if(this._renderWorldCopies)for(var ot=1;ot<=3;ot++)W.push(z(-ot)),W.push(z(ot));for(W.push(z(0));W.length>0;){var bt=W.pop(),Pt=bt.x,mt=bt.y,It=bt.fullyVisible;if(!It){var Vt=bt.aabb.intersects(R);if(Vt===0)continue;It=Vt===2}var Jt=bt.aabb.distanceX(P),te=bt.aabb.distanceY(P),Qt=Math.max(Math.abs(Jt),Math.abs(te));if(bt.zoom===Z||Qt>3+(1<<Z-bt.zoom)-2&&bt.zoom>=F)et.push({tileID:new o.OverscaledTileID(bt.zoom===Z?it:bt.zoom,bt.wrap,bt.zoom,Pt,mt),distanceSq:o.sqrLen([P[0]-.5-Pt,P[1]-.5-mt])});else for(var $t=0;$t<4;$t++){var pe=(Pt<<1)+$t%2,Oe=(mt<<1)+($t>>1);W.push({aabb:bt.aabb.quadrant($t),zoom:bt.zoom+1,x:pe,y:Oe,wrap:bt.wrap,fullyVisible:It})}}return et.sort(function(xe,Ue){return xe.distanceSq-Ue.distanceSq}).map(function(xe){return xe.tileID})},hn.prototype.resize=function(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()},kn.unmodified.get=function(){return this._unmodified},hn.prototype.zoomScale=function(l){return Math.pow(2,l)},hn.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},hn.prototype.project=function(l){var d=o.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(l.lng)*this.worldSize,o.mercatorYfromLat(d)*this.worldSize)},hn.prototype.unproject=function(l){return new o.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},kn.point.get=function(){return this.project(this.center)},hn.prototype.setLocationAtPoint=function(l,d){var f=this.pointCoordinate(d),m=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),P=new o.MercatorCoordinate(E.x-(f.x-m.x),E.y-(f.y-m.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},hn.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},hn.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},hn.prototype.locationCoordinate=function(l){return o.MercatorCoordinate.fromLngLat(l)},hn.prototype.coordinateLocation=function(l){return l.toLngLat()},hn.prototype.pointCoordinate=function(l){var d=[l.x,l.y,0,1],f=[l.x,l.y,1,1];o.transformMat4(d,d,this.pixelMatrixInverse),o.transformMat4(f,f,this.pixelMatrixInverse);var m=d[3],E=f[3],P=d[1]/m,R=f[1]/E,F=d[2]/m,z=f[2]/E,W=F===z?0:(0-F)/(z-F);return new o.MercatorCoordinate(o.number(d[0]/m,f[0]/E,W)/this.worldSize,o.number(P,R,W)/this.worldSize)},hn.prototype.coordinatePoint=function(l){var d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.transformMat4(d,d,this.pixelMatrix),new o.Point(d[0]/d[3],d[1]/d[3])},hn.prototype.getBounds=function(){return new o.LngLatBounds().extend(this.pointLocation(new o.Point(0,0))).extend(this.pointLocation(new o.Point(this.width,0))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))},hn.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},hn.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},hn.prototype.calculatePosMatrix=function(l,d){d===void 0&&(d=!1);var f=l.key,m=d?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];var E=l.canonical,P=this.worldSize/this.zoomScale(E.z),R=E.x+Math.pow(2,E.z)*l.wrap,F=o.identity(new Float64Array(16));return o.translate(F,F,[R*P,E.y*P,0]),o.scale(F,F,[P/o.EXTENT,P/o.EXTENT,1]),o.multiply(F,d?this.alignedProjMatrix:this.projMatrix,F),m[f]=new Float32Array(F),m[f]},hn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},hn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,d,f,m,E=-90,P=90,R=-180,F=180,z=this.size,W=this._unmodified;if(this.latRange){var et=this.latRange;E=o.mercatorYfromLat(et[1])*this.worldSize,l=(P=o.mercatorYfromLat(et[0])*this.worldSize)-E<z.y?z.y/(P-E):0}if(this.lngRange){var Z=this.lngRange;R=o.mercatorXfromLng(Z[0])*this.worldSize,d=(F=o.mercatorXfromLng(Z[1])*this.worldSize)-R<z.x?z.x/(F-R):0}var it=this.point,ot=Math.max(d||0,l||0);if(ot)return this.center=this.unproject(new o.Point(d?(F+R)/2:it.x,l?(P+E)/2:it.y)),this.zoom+=this.scaleZoom(ot),this._unmodified=W,void(this._constraining=!1);if(this.latRange){var bt=it.y,Pt=z.y/2;bt-Pt<E&&(m=E+Pt),bt+Pt>P&&(m=P-Pt)}if(this.lngRange){var mt=it.x,It=z.x/2;mt-It<R&&(f=R+It),mt+It>F&&(f=F-It)}f===void 0&&m===void 0||(this.center=this.unproject(new o.Point(f!==void 0?f:it.x,m!==void 0?m:it.y))),this._unmodified=W,this._constraining=!1}},hn.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,f=this._fov*(.5+l.y/this.height),m=Math.sin(f)*this.cameraToCenterDistance/Math.sin(o.clamp(Math.PI-d-f,.01,Math.PI-.01)),E=this.point,P=E.x,R=E.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),z=this.height/50,W=new Float64Array(16);o.perspective(W,this._fov,this.width/this.height,z,F),W[8]=2*-l.x/this.width,W[9]=2*l.y/this.height,o.scale(W,W,[1,-1,1]),o.translate(W,W,[0,0,-this.cameraToCenterDistance]),o.rotateX(W,W,this._pitch),o.rotateZ(W,W,this.angle),o.translate(W,W,[-P,-R,0]),this.mercatorMatrix=o.scale([],W,[this.worldSize,this.worldSize,this.worldSize]),o.scale(W,W,[1,1,o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=W,this.invProjMatrix=o.invert([],this.projMatrix);var et=this.width%2/2,Z=this.height%2/2,it=Math.cos(this.angle),ot=Math.sin(this.angle),bt=P-Math.round(P)+it*et+ot*Z,Pt=R-Math.round(R)+it*Z+ot*et,mt=new Float64Array(W);if(o.translate(mt,mt,[bt>.5?bt-1:bt,Pt>.5?Pt-1:Pt,0]),this.alignedProjMatrix=mt,W=o.create(),o.scale(W,W,[this.width/2,-this.height/2,1]),o.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=o.create(),o.scale(W,W,[1,-1,1]),o.translate(W,W,[-1,-1,0]),o.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(W=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=W,this._posMatrixCache={},this._alignedPosMatrixCache={}}},hn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new o.Point(0,0)),d=[l.x*this.worldSize,l.y*this.worldSize,0,1];return o.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},hn.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,l))},hn.prototype.getCameraQueryGeometry=function(l){var d=this.getCameraPoint();if(l.length===1)return[l[0],d];for(var f=d.x,m=d.y,E=d.x,P=d.y,R=0,F=l;R<F.length;R+=1){var z=F[R];f=Math.min(f,z.x),m=Math.min(m,z.y),E=Math.max(E,z.x),P=Math.max(P,z.y)}return[new o.Point(f,m),new o.Point(E,m),new o.Point(E,P),new o.Point(f,P),new o.Point(f,m)]},Object.defineProperties(hn.prototype,kn);var Wo=function(l){var d,f,m,E;this._hashName=l&&encodeURIComponent(l),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(d=this._updateHashUnthrottled.bind(this),f=!1,m=null,E=function(){m=null,f&&(d(),m=setTimeout(E,300),f=!1)},function(){return f=!0,m||E(),m})};Wo.prototype.addTo=function(l){return this._map=l,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Wo.prototype.remove=function(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Wo.prototype.getHashString=function(l){var d=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,m),P=Math.round(d.lng*E)/E,R=Math.round(d.lat*E)/E,F=this._map.getBearing(),z=this._map.getPitch(),W="";if(W+=l?"/"+P+"/"+R+"/"+f:f+"/"+R+"/"+P,(F||z)&&(W+="/"+Math.round(10*F)/10),z&&(W+="/"+Math.round(z)),this._hashName){var et=this._hashName,Z=!1,it=o.window.location.hash.slice(1).split("&").map(function(ot){var bt=ot.split("=")[0];return bt===et?(Z=!0,bt+"="+W):ot}).filter(function(ot){return ot});return Z||it.push(et+"="+W),"#"+it.join("&")}return"#"+W},Wo.prototype._getCurrentHash=function(){var l,d=this,f=o.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===d._hashName&&(l=m)}),(l&&l[1]||"").split("/")):f.split("/")},Wo.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(f){return isNaN(f)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1},Wo.prototype._updateHashUnthrottled=function(){var l=o.window.location.href.replace(/(#.+)?$/,this.getHashString());try{o.window.history.replaceState(o.window.history.state,null,l)}catch{}};var Ml={linearity:.3,easing:o.bezier(0,0,.3,1)},Nc=o.extend({deceleration:2500,maxSpeed:1400},Ml),Pl=o.extend({deceleration:20,maxSpeed:1400},Ml),uA=o.extend({deceleration:1e3,maxSpeed:360},Ml),hA=o.extend({deceleration:1e3,maxSpeed:90},Ml),Uc=function(l){this._map=l,this.clear()};function Rl(l,d){(!l.duration||l.duration<d.duration)&&(l.duration=d.duration,l.easing=d.easing)}function Ds(l,d,f){var m=f.maxSpeed,E=f.linearity,P=f.deceleration,R=o.clamp(l*E/(d/1e3),-m,m),F=Math.abs(R)/(P*E);return{easing:f.easing,duration:1e3*F,amount:R*(F/2)}}Uc.prototype.clear=function(){this._inertiaBuffer=[]},Uc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:l})},Uc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,d=o.browser.now();l.length>0&&d-l[0].time>160;)l.shift()},Uc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0},f=0,m=this._inertiaBuffer;f<m.length;f+=1){var E=m[f].settings;d.zoom+=E.zoomDelta||0,d.bearing+=E.bearingDelta||0,d.pitch+=E.pitchDelta||0,E.panDelta&&d.pan._add(E.panDelta),E.around&&(d.around=E.around),E.pinchAround&&(d.pinchAround=E.pinchAround)}var P=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(d.pan.mag()){var F=Ds(d.pan.mag(),P,o.extend({},Nc,l||{}));R.offset=d.pan.mult(F.amount/d.pan.mag()),R.center=this._map.transform.center,Rl(R,F)}if(d.zoom){var z=Ds(d.zoom,P,Pl);R.zoom=this._map.transform.zoom+z.amount,Rl(R,z)}if(d.bearing){var W=Ds(d.bearing,P,uA);R.bearing=this._map.transform.bearing+o.clamp(W.amount,-179,179),Rl(R,W)}if(d.pitch){var et=Ds(d.pitch,P,hA);R.pitch=this._map.transform.pitch+et.amount,Rl(R,et)}if(R.zoom||R.bearing){var Z=d.pinchAround===void 0?d.around:d.pinchAround;R.around=Z?this._map.unproject(Z):this._map.getCenter()}return this.clear(),o.extend(R,{noMoveStart:!0})}};var Nn=function(l){function d(m,E,P,R){R===void 0&&(R={});var F=h.mousePos(E.getCanvasContainer(),P),z=E.unproject(F);l.call(this,m,o.extend({point:F,lngLat:z,originalEvent:P},R)),this._defaultPrevented=!1,this.target=E}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d}(o.Event),zc=function(l){function d(m,E,P){var R=m==="touchend"?P.changedTouches:P.touches,F=h.touchPos(E.getCanvasContainer(),R),z=F.map(function(Z){return E.unproject(Z)}),W=F.reduce(function(Z,it,ot,bt){return Z.add(it.div(bt.length))},new o.Point(0,0)),et=E.unproject(W);l.call(this,m,{points:F,point:W,lngLats:z,lngLat:et,originalEvent:P}),this._defaultPrevented=!1}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d}(o.Event),jf=function(l){function d(m,E,P){l.call(this,m,{originalEvent:P}),this._defaultPrevented=!1}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var f={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,f),d}(o.Event),Er=function(l,d){this._map=l,this._clickTolerance=d.clickTolerance};Er.prototype.reset=function(){delete this._mousedownPos},Er.prototype.wheel=function(l){return this._firePreventable(new jf(l.type,this._map,l))},Er.prototype.mousedown=function(l,d){return this._mousedownPos=d,this._firePreventable(new Nn(l.type,this._map,l))},Er.prototype.mouseup=function(l){this._map.fire(new Nn(l.type,this._map,l))},Er.prototype.click=function(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Nn(l.type,this._map,l))},Er.prototype.dblclick=function(l){return this._firePreventable(new Nn(l.type,this._map,l))},Er.prototype.mouseover=function(l){this._map.fire(new Nn(l.type,this._map,l))},Er.prototype.mouseout=function(l){this._map.fire(new Nn(l.type,this._map,l))},Er.prototype.touchstart=function(l){return this._firePreventable(new zc(l.type,this._map,l))},Er.prototype.touchmove=function(l){this._map.fire(new zc(l.type,this._map,l))},Er.prototype.touchend=function(l){this._map.fire(new zc(l.type,this._map,l))},Er.prototype.touchcancel=function(l){this._map.fire(new zc(l.type,this._map,l))},Er.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Er.prototype.isEnabled=function(){return!0},Er.prototype.isActive=function(){return!1},Er.prototype.enable=function(){},Er.prototype.disable=function(){};var si=function(l){this._map=l};si.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},si.prototype.mousemove=function(l){this._map.fire(new Nn(l.type,this._map,l))},si.prototype.mousedown=function(){this._delayContextMenu=!0},si.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Nn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},si.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Nn(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},si.prototype.isEnabled=function(){return!0},si.prototype.isActive=function(){return!1},si.prototype.enable=function(){},si.prototype.disable=function(){};var Io=function(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1};function bu(l,d){for(var f={},m=0;m<l.length;m++)f[l[m].identifier]=d[m];return f}Io.prototype.isEnabled=function(){return!!this._enabled},Io.prototype.isActive=function(){return!!this._active},Io.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Io.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Io.prototype.mousedown=function(l,d){this.isEnabled()&&l.shiftKey&&l.button===0&&(h.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},Io.prototype.mousemoveWindow=function(l,d){if(this._active){var f=d;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=f,this._box||(this._box=h.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(m.x,f.x),P=Math.max(m.x,f.x),R=Math.min(m.y,f.y),F=Math.max(m.y,f.y);h.setTransform(this._box,"translate("+E+"px,"+R+"px)"),this._box.style.width=P-E+"px",this._box.style.height=F-R+"px"}}},Io.prototype.mouseupWindow=function(l,d){var f=this;if(this._active&&l.button===0){var m=this._startPos,E=d;if(this.reset(),h.suppressClick(),m.x!==E.x||m.y!==E.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(P){return P.fitScreenCoordinates(m,E,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},Io.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},Io.prototype.blur=function(){this.reset()},Io.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(h.remove(this._box),this._box=null),h.enableDrag(),delete this._startPos,delete this._lastPos},Io.prototype._fireEvent=function(l,d){return this._map.fire(new o.Event(l,{originalEvent:d}))};var Jo=function(l){this.reset(),this.numTouches=l.numTouches};Jo.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Jo.prototype.touchstart=function(l,d,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){for(var E=new o.Point(0,0),P=0,R=m;P<R.length;P+=1)E._add(R[P]);return E.div(m.length)}(d),this.touches=bu(f,d)))},Jo.prototype.touchmove=function(l,d,f){if(!this.aborted&&this.centroid){var m=bu(f,d);for(var E in this.touches){var P=m[E];(!P||P.dist(this.touches[E])>30)&&(this.aborted=!0)}}},Jo.prototype.touchend=function(l,d,f){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var os=function(l){this.singleTap=new Jo(l),this.numTaps=l.numTaps,this.reset()};os.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},os.prototype.touchstart=function(l,d,f){this.singleTap.touchstart(l,d,f)},os.prototype.touchmove=function(l,d,f){this.singleTap.touchmove(l,d,f)},os.prototype.touchend=function(l,d,f){var m=this.singleTap.touchend(l,d,f);if(m){var E=l.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(m)<30;if(E&&P||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var yo=function(){this._zoomIn=new os({numTouches:1,numTaps:2}),this._zoomOut=new os({numTouches:2,numTaps:1}),this.reset()};yo.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},yo.prototype.touchstart=function(l,d,f){this._zoomIn.touchstart(l,d,f),this._zoomOut.touchstart(l,d,f)},yo.prototype.touchmove=function(l,d,f){this._zoomIn.touchmove(l,d,f),this._zoomOut.touchmove(l,d,f)},yo.prototype.touchend=function(l,d,f){var m=this,E=this._zoomIn.touchend(l,d,f),P=this._zoomOut.touchend(l,d,f);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(E)},{originalEvent:l})}}):P?(this._active=!0,l.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(P)},{originalEvent:l})}}):void 0},yo.prototype.touchcancel=function(){this.reset()},yo.prototype.enable=function(){this._enabled=!0},yo.prototype.disable=function(){this._enabled=!1,this.reset()},yo.prototype.isEnabled=function(){return this._enabled},yo.prototype.isActive=function(){return this._active};var wh={0:1,2:2},Ye=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Ye.prototype.blur=function(){this.reset()},Ye.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ye.prototype._correctButton=function(l,d){return!1},Ye.prototype._move=function(l,d){return{}},Ye.prototype.mousedown=function(l,d){if(!this._lastPoint){var f=h.mouseButton(l);this._correctButton(l,f)&&(this._lastPoint=d,this._eventButton=f)}},Ye.prototype.mousemoveWindow=function(l,d){var f=this._lastPoint;if(f){if(l.preventDefault(),function(m,E){var P=wh[E];return m.buttons===void 0||(m.buttons&P)!==P}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(f,d)}},Ye.prototype.mouseupWindow=function(l){this._lastPoint&&h.mouseButton(l)===this._eventButton&&(this._moved&&h.suppressClick(),this.reset())},Ye.prototype.enable=function(){this._enabled=!0},Ye.prototype.disable=function(){this._enabled=!1,this.reset()},Ye.prototype.isEnabled=function(){return this._enabled},Ye.prototype.isActive=function(){return this._active};var Ch=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.mousedown=function(f,m){l.prototype.mousedown.call(this,f,m),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(f,m){return m===0&&!f.ctrlKey},d.prototype._move=function(f,m){return{around:m,panDelta:m.sub(f)}},d}(Ye),xu=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},d.prototype._move=function(f,m){var E=.8*(m.x-f.x);if(E)return this._active=!0,{bearingDelta:E}},d.prototype.contextmenu=function(f){f.preventDefault()},d}(Ye),Eh=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},d.prototype._move=function(f,m){var E=-.5*(m.y-f.y);if(E)return this._active=!0,{pitchDelta:E}},d.prototype.contextmenu=function(f){f.preventDefault()},d}(Ye),ss=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};ss.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)},ss.prototype.touchstart=function(l,d,f){return this._calculateTransform(l,d,f)},ss.prototype.touchmove=function(l,d,f){if(this._active&&!(f.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,d,f)},ss.prototype.touchend=function(l,d,f){this._calculateTransform(l,d,f),this._active&&f.length<this._minTouches&&this.reset()},ss.prototype.touchcancel=function(){this.reset()},ss.prototype._calculateTransform=function(l,d,f){f.length>0&&(this._active=!0);var m=bu(f,d),E=new o.Point(0,0),P=new o.Point(0,0),R=0;for(var F in m){var z=m[F],W=this._touches[F];W&&(E._add(z),P._add(z.sub(W)),R++,m[F]=z)}if(this._touches=m,!(R<this._minTouches)&&P.mag()){var et=P.div(R);if(this._sum._add(et),!(this._sum.mag()<this._clickTolerance))return{around:E.div(R),panDelta:et}}},ss.prototype.enable=function(){this._enabled=!0},ss.prototype.disable=function(){this._enabled=!1,this.reset()},ss.prototype.isEnabled=function(){return this._enabled},ss.prototype.isActive=function(){return this._active};var Mo=function(){this.reset()};function wu(l,d,f){for(var m=0;m<l.length;m++)if(l[m].identifier===f)return d[m]}function Cu(l,d){return Math.log(l/d)/Math.LN2}Mo.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Mo.prototype._start=function(l){},Mo.prototype._move=function(l,d,f){return{}},Mo.prototype.touchstart=function(l,d,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([d[0],d[1]]))},Mo.prototype.touchmove=function(l,d,f){if(this._firstTwoTouches){l.preventDefault();var m=this._firstTwoTouches,E=m[1],P=wu(f,d,m[0]),R=wu(f,d,E);if(P&&R){var F=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],F,l)}}},Mo.prototype.touchend=function(l,d,f){if(this._firstTwoTouches){var m=this._firstTwoTouches,E=m[1],P=wu(f,d,m[0]),R=wu(f,d,E);P&&R||(this._active&&h.suppressClick(),this.reset())}},Mo.prototype.touchcancel=function(){this.reset()},Mo.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Mo.prototype.disable=function(){this._enabled=!1,this.reset()},Mo.prototype.isEnabled=function(){return this._enabled},Mo.prototype.isActive=function(){return this._active};var Po=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},d.prototype._move=function(f,m){var E=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(Cu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cu(this._distance,E),pinchAround:m}},d}(Mo);function ea(l,d){return 180*l.angleWith(d)/Math.PI}var Bh=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},d.prototype._move=function(f,m){var E=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ea(this._vector,E),pinchAround:m}},d.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var m=25/(Math.PI*this._minDiameter)*360,E=ea(f,this._startVector);return Math.abs(E)<m},d}(Mo);function Gc(l){return Math.abs(l.y)>Math.abs(l.x)}var Br=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(f){this._lastPoints=f,Gc(f[0].sub(f[1]))&&(this._valid=!1)},d.prototype._move=function(f,m,E){var P=f[0].sub(this._lastPoints[0]),R=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,R,E.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(P.y+R.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(f,m,E){if(this._valid!==void 0)return this._valid;var P=f.mag()>=2,R=m.mag()>=2;if(P||R){if(!P||!R)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var F=f.y>0==m.y>0;return Gc(f)&&Gc(m)&&F}},d}(Mo),Th={panStep:100,bearingStep:15,pitchStep:10},Cs=function(){var l=Th;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function io(l){return l*(2-l)}Cs.prototype.blur=function(){this.reset()},Cs.prototype.reset=function(){this._active=!1},Cs.prototype.keydown=function(l){var d=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var f=0,m=0,E=0,P=0,R=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?m=-1:(l.preventDefault(),P=-1);break;case 39:l.shiftKey?m=1:(l.preventDefault(),P=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),R=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(m=0,E=0),{cameraAnimation:function(F){var z=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:io,zoom:f?Math.round(z)+f*(l.shiftKey?2:1):z,bearing:F.getBearing()+m*d._bearingStep,pitch:F.getPitch()+E*d._pitchStep,offset:[-P*d._panStep,-R*d._panStep],center:F.getCenter()},{originalEvent:l})}}}},Cs.prototype.enable=function(){this._enabled=!0},Cs.prototype.disable=function(){this._enabled=!1,this.reset()},Cs.prototype.isEnabled=function(){return this._enabled},Cs.prototype.isActive=function(){return this._active},Cs.prototype.disableRotation=function(){this._rotationDisabled=!0},Cs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Vi=function(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,o.bindAll(["_onTimeout"],this)};Vi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Vi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Vi.prototype.isEnabled=function(){return!!this._enabled},Vi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Vi.prototype.isZooming=function(){return!!this._zooming},Vi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Vi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Vi.prototype.wheel=function(l){if(this.isEnabled()){var d=l.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,f=o.browser.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(m*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}},Vi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Vi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=h.mousePos(this._el,l);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Vi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&m!==0&&(m=1/m);var E=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(E*m))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P,R=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,F=this._startZoom,z=this._easing,W=!1;if(this._type==="wheel"&&F&&z){var et=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),Z=z(et);P=o.number(F,R,Z),et<1?this._frameId||(this._frameId=!0):W=!0}else P=R,W=!0;return this._active=!0,W&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!W,zoomDelta:P-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Vi.prototype._smoothOutEasing=function(l){var d=o.ease;if(this._prevEase){var f=this._prevEase,m=(o.browser.now()-f.start)/f.duration,E=f.easing(m+.01)-f.easing(m),P=.27/Math.sqrt(E*E+1e-4)*.01,R=Math.sqrt(.0729-P*P);d=o.bezier(P,R,.25,1)}return this._prevEase={start:o.browser.now(),duration:l,easing:d},d},Vi.prototype.blur=function(){this.reset()},Vi.prototype.reset=function(){this._active=!1};var Os=function(l,d){this._clickZoom=l,this._tapZoom=d};Os.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Os.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Os.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Os.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var as=function(){this.reset()};as.prototype.reset=function(){this._active=!1},as.prototype.blur=function(){this.reset()},as.prototype.dblclick=function(l,d){return l.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(l.shiftKey?-1:1),around:f.unproject(d)},{originalEvent:l})}}},as.prototype.enable=function(){this._enabled=!0},as.prototype.disable=function(){this._enabled=!1,this.reset()},as.prototype.isEnabled=function(){return this._enabled},as.prototype.isActive=function(){return this._active};var Jr=function(){this._tap=new os({numTouches:1,numTaps:1}),this.reset()};Jr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Jr.prototype.touchstart=function(l,d,f){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=d[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(l,d,f))},Jr.prototype.touchmove=function(l,d,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var m=d[0],E=m.y-this._swipePoint.y;return this._swipePoint=m,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,d,f)},Jr.prototype.touchend=function(l,d,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(l,d,f)&&(this._tapTime=l.timeStamp)},Jr.prototype.touchcancel=function(){this.reset()},Jr.prototype.enable=function(){this._enabled=!0},Jr.prototype.disable=function(){this._enabled=!1,this.reset()},Jr.prototype.isEnabled=function(){return this._enabled},Jr.prototype.isActive=function(){return this._active};var Ia=function(l,d,f){this._el=l,this._mousePan=d,this._touchPan=f};Ia.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Ia.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Ia.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Ia.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ia=function(l,d,f){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=f};ia.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ia.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ia.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ia.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var cs=function(l,d,f,m){this._el=l,this._touchZoom=d,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};cs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},cs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},cs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},cs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},cs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},cs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var no=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Dl=function(l){function d(){l.apply(this,arguments)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d}(o.Event);function xi(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var ui=function(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Uc(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d),o.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[o.window,"blur",void 0]];for(var m=0,E=this._listeners;m<E.length;m+=1){var P=E[m],R=P[0];h.addEventListener(R,P[1],R===o.window.document?this.handleWindowEvent:this.handleEvent,P[2])}};ui.prototype.destroy=function(){for(var l=0,d=this._listeners;l<d.length;l+=1){var f=d[l],m=f[0];h.removeEventListener(m,f[1],m===o.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},ui.prototype._addDefaultHandlers=function(l){var d=this._map,f=d.getCanvasContainer();this._add("mapEvent",new Er(d,l));var m=d.boxZoom=new Io(d,l);this._add("boxZoom",m);var E=new yo,P=new as;d.doubleClickZoom=new Os(P,E),this._add("tapZoom",E),this._add("clickZoom",P);var R=new Jr;this._add("tapDragZoom",R);var F=d.touchPitch=new Br;this._add("touchPitch",F);var z=new xu(l),W=new Eh(l);d.dragRotate=new ia(l,z,W),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);var et=new Ch(l),Z=new ss(l);d.dragPan=new Ia(f,et,Z),this._add("mousePan",et),this._add("touchPan",Z,["touchZoom","touchRotate"]);var it=new Bh,ot=new Po;d.touchZoomRotate=new cs(f,ot,it,R),this._add("touchRotate",it,["touchPan","touchZoom"]),this._add("touchZoom",ot,["touchPan","touchRotate"]);var bt=d.scrollZoom=new Vi(d,this);this._add("scrollZoom",bt,["mousePan"]);var Pt=d.keyboard=new Cs;this._add("keyboard",Pt),this._add("blockableMapEvent",new si(d));for(var mt=0,It=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];mt<It.length;mt+=1){var Vt=It[mt];l.interactive&&l[Vt]&&d[Vt].enable(l[Vt])}},ui.prototype._add=function(l,d,f){this._handlers.push({handlerName:l,handler:d,allowed:f}),this._handlersById[l]=d},ui.prototype.stop=function(l){if(!this._updatingCamera){for(var d=0,f=this._handlers;d<f.length;d+=1)f[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},ui.prototype.isActive=function(){for(var l=0,d=this._handlers;l<d.length;l+=1)if(d[l].handler.isActive())return!0;return!1},ui.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},ui.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},ui.prototype.isMoving=function(){return!!no(this._eventsInProgress)||this.isZooming()},ui.prototype._blockedByActive=function(l,d,f){for(var m in l)if(m!==f&&(!d||d.indexOf(m)<0))return!0;return!1},ui.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},ui.prototype._getMapTouches=function(l){for(var d=[],f=0,m=l;f<m.length;f+=1){var E=m[f];this._el.contains(E.target)&&d.push(E)}return d},ui.prototype.handleEvent=function(l,d){this._updatingCamera=!0;for(var f=l.type==="renderFrame"?void 0:l,m={needsRenderFrame:!1},E={},P={},R=l.touches?this._getMapTouches(l.touches):void 0,F=R?h.touchPos(this._el,R):h.mousePos(this._el,l),z=0,W=this._handlers;z<W.length;z+=1){var et=W[z],Z=et.handlerName,it=et.handler,ot=et.allowed;if(it.isEnabled()){var bt=void 0;this._blockedByActive(P,ot,Z)?it.reset():it[d||l.type]&&(bt=it[d||l.type](l,F,R),this.mergeHandlerResult(m,E,bt,Z,f),bt&&bt.needsRenderFrame&&this._triggerRenderFrame()),(bt||it.isActive())&&(P[Z]=it)}}var Pt={};for(var mt in this._previousActiveHandlers)P[mt]||(Pt[mt]=f);this._previousActiveHandlers=P,(Object.keys(Pt).length||xi(m))&&(this._changes.push([m,E,Pt]),this._triggerRenderFrame()),(Object.keys(P).length||xi(m))&&this._map._stop(!0),this._updatingCamera=!1;var It=m.cameraAnimation;It&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],It(this._map))},ui.prototype.mergeHandlerResult=function(l,d,f,m,E){if(f){o.extend(l,f);var P={handlerName:m,originalEvent:f.originalEvent||E};f.zoomDelta!==void 0&&(d.zoom=P),f.panDelta!==void 0&&(d.drag=P),f.pitchDelta!==void 0&&(d.pitch=P),f.bearingDelta!==void 0&&(d.rotate=P)}},ui.prototype._applyChanges=function(){for(var l={},d={},f={},m=0,E=this._changes;m<E.length;m+=1){var P=E[m],R=P[0],F=P[1],z=P[2];R.panDelta&&(l.panDelta=(l.panDelta||new o.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(l.around=R.around),R.pinchAround!==void 0&&(l.pinchAround=R.pinchAround),R.noInertia&&(l.noInertia=R.noInertia),o.extend(d,F),o.extend(f,z)}this._updateMapTransform(l,d,f),this._changes=[]},ui.prototype._updateMapTransform=function(l,d,f){var m=this._map,E=m.transform;if(!xi(l))return this._fireEvents(d,f,!0);var P=l.panDelta,R=l.zoomDelta,F=l.bearingDelta,z=l.pitchDelta,W=l.around,et=l.pinchAround;et!==void 0&&(W=et),m._stop(!0),W=W||m.transform.centerPoint;var Z=E.pointLocation(P?W.sub(P):W);F&&(E.bearing+=F),z&&(E.pitch+=z),R&&(E.zoom+=R),E.setLocationAtPoint(Z,W),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,f,!0)},ui.prototype._fireEvents=function(l,d,f){var m=this,E=no(this._eventsInProgress),P=no(l),R={};for(var F in l)this._eventsInProgress[F]||(R[F+"start"]=l[F].originalEvent),this._eventsInProgress[F]=l[F];for(var z in!E&&P&&this._fireEvent("movestart",P.originalEvent),R)this._fireEvent(z,R[z]);for(var W in P&&this._fireEvent("move",P.originalEvent),l)this._fireEvent(W,l[W].originalEvent);var et,Z={};for(var it in this._eventsInProgress){var ot=this._eventsInProgress[it],bt=ot.handlerName,Pt=ot.originalEvent;this._handlersById[bt].isActive()||(delete this._eventsInProgress[it],Z[it+"end"]=et=d[bt]||Pt)}for(var mt in Z)this._fireEvent(mt,Z[mt]);var It=no(this._eventsInProgress);if(f&&(E||P)&&!It){this._updatingCamera=!0;var Vt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Jt=function(te){return te!==0&&-m._bearingSnap<te&&te<m._bearingSnap};Vt?(Jt(Vt.bearing||this._map.getBearing())&&(Vt.bearing=0),this._map.easeTo(Vt,{originalEvent:et})):(this._map.fire(new o.Event("moveend",{originalEvent:et})),Jt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},ui.prototype._fireEvent=function(l,d){this._map.fire(new o.Event(l,d?{originalEvent:d}:{}))},ui.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete l._frameId,l.handleEvent(new Dl("renderFrame",{timeStamp:d})),l._applyChanges()})},ui.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Eu=function(l){function d(f,m){l.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=m.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.getCenter=function(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(f,m){return this.jumpTo({center:f},m)},d.prototype.panBy=function(f,m,E){return f=o.Point.convert(f).mult(-1),this.panTo(this.transform.center,o.extend({offset:f},m),E)},d.prototype.panTo=function(f,m,E){return this.easeTo(o.extend({center:f},m),E)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(f,m){return this.jumpTo({zoom:f},m),this},d.prototype.zoomTo=function(f,m,E){return this.easeTo(o.extend({zoom:f},m),E)},d.prototype.zoomIn=function(f,m){return this.zoomTo(this.getZoom()+1,f,m),this},d.prototype.zoomOut=function(f,m){return this.zoomTo(this.getZoom()-1,f,m),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(f,m){return this.jumpTo({bearing:f},m),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(f,m){return this.jumpTo({padding:f},m),this},d.prototype.rotateTo=function(f,m,E){return this.easeTo(o.extend({bearing:f},m),E)},d.prototype.resetNorth=function(f,m){return this.rotateTo(0,o.extend({duration:1e3},f),m),this},d.prototype.resetNorthPitch=function(f,m){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},f),m),this},d.prototype.snapToNorth=function(f,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,m):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(f,m){return this.jumpTo({pitch:f},m),this},d.prototype.cameraForBounds=function(f,m){f=o.LngLatBounds.convert(f);var E=m&&m.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),E,m)},d.prototype._cameraForBoxAndBearing=function(f,m,E,P){var R={top:0,bottom:0,right:0,left:0};if(typeof(P=o.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var F=P.padding;P.padding={top:F,bottom:F,right:F,left:F}}P.padding=o.extend(R,P.padding);var z=this.transform,W=z.padding,et=z.project(o.LngLat.convert(f)),Z=z.project(o.LngLat.convert(m)),it=et.rotate(-E*Math.PI/180),ot=Z.rotate(-E*Math.PI/180),bt=new o.Point(Math.max(it.x,ot.x),Math.max(it.y,ot.y)),Pt=new o.Point(Math.min(it.x,ot.x),Math.min(it.y,ot.y)),mt=bt.sub(Pt),It=(z.width-(W.left+W.right+P.padding.left+P.padding.right))/mt.x,Vt=(z.height-(W.top+W.bottom+P.padding.top+P.padding.bottom))/mt.y;if(!(Vt<0||It<0)){var Jt=Math.min(z.scaleZoom(z.scale*Math.min(It,Vt)),P.maxZoom),te=typeof P.offset.x=="number"?new o.Point(P.offset.x,P.offset.y):o.Point.convert(P.offset),Qt=new o.Point((P.padding.left-P.padding.right)/2,(P.padding.top-P.padding.bottom)/2).rotate(E*Math.PI/180),$t=te.add(Qt).mult(z.scale/z.zoomScale(Jt));return{center:z.unproject(et.add(Z).div(2).sub($t)),zoom:Jt,bearing:E}}o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(f,m,E){return this._fitInternal(this.cameraForBounds(f,m),m,E)},d.prototype.fitScreenCoordinates=function(f,m,E,P,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(f)),this.transform.pointLocation(o.Point.convert(m)),E,P),P,R)},d.prototype._fitInternal=function(f,m,E){return f?(delete(m=o.extend(f,m)).padding,m.linear?this.easeTo(m,E):this.flyTo(m,E)):this},d.prototype.jumpTo=function(f,m){this.stop();var E=this.transform,P=!1,R=!1,F=!1;return"zoom"in f&&E.zoom!==+f.zoom&&(P=!0,E.zoom=+f.zoom),f.center!==void 0&&(E.center=o.LngLat.convert(f.center)),"bearing"in f&&E.bearing!==+f.bearing&&(R=!0,E.bearing=+f.bearing),"pitch"in f&&E.pitch!==+f.pitch&&(F=!0,E.pitch=+f.pitch),f.padding==null||E.isPaddingEqual(f.padding)||(E.padding=f.padding),this.fire(new o.Event("movestart",m)).fire(new o.Event("move",m)),P&&this.fire(new o.Event("zoomstart",m)).fire(new o.Event("zoom",m)).fire(new o.Event("zoomend",m)),R&&this.fire(new o.Event("rotatestart",m)).fire(new o.Event("rotate",m)).fire(new o.Event("rotateend",m)),F&&this.fire(new o.Event("pitchstart",m)).fire(new o.Event("pitch",m)).fire(new o.Event("pitchend",m)),this.fire(new o.Event("moveend",m))},d.prototype.easeTo=function(f,m){var E=this;this._stop(!1,f.easeId),((f=o.extend({offset:[0,0],duration:500,easing:o.ease},f)).animate===!1||!f.essential&&o.browser.prefersReducedMotion)&&(f.duration=0);var P=this.transform,R=this.getZoom(),F=this.getBearing(),z=this.getPitch(),W=this.getPadding(),et="zoom"in f?+f.zoom:R,Z="bearing"in f?this._normalizeBearing(f.bearing,F):F,it="pitch"in f?+f.pitch:z,ot="padding"in f?f.padding:P.padding,bt=o.Point.convert(f.offset),Pt=P.centerPoint.add(bt),mt=P.pointLocation(Pt),It=o.LngLat.convert(f.center||mt);this._normalizeCenter(It);var Vt,Jt,te=P.project(mt),Qt=P.project(It).sub(te),$t=P.zoomScale(et-R);f.around&&(Vt=o.LngLat.convert(f.around),Jt=P.locationPoint(Vt));var pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||et!==R,this._rotating=this._rotating||F!==Z,this._pitching=this._pitching||it!==z,this._padding=!P.isPaddingEqual(ot),this._easeId=f.easeId,this._prepareEase(m,f.noMoveStart,pe),this._ease(function(Oe){if(E._zooming&&(P.zoom=o.number(R,et,Oe)),E._rotating&&(P.bearing=o.number(F,Z,Oe)),E._pitching&&(P.pitch=o.number(z,it,Oe)),E._padding&&(P.interpolatePadding(W,ot,Oe),Pt=P.centerPoint.add(bt)),Vt)P.setLocationAtPoint(Vt,Jt);else{var xe=P.zoomScale(P.zoom-R),Ue=et>R?Math.min(2,$t):Math.max(.5,$t),oi=Math.pow(Ue,1-Oe),Ei=P.unproject(te.add(Qt.mult(Oe*oi)).mult(xe));P.setLocationAtPoint(P.renderWorldCopies?Ei.wrap():Ei,Pt)}E._fireMoveEvents(m)},function(Oe){E._afterEase(m,Oe)},f),this},d.prototype._prepareEase=function(f,m,E){E===void 0&&(E={}),this._moving=!0,m||E.moving||this.fire(new o.Event("movestart",f)),this._zooming&&!E.zooming&&this.fire(new o.Event("zoomstart",f)),this._rotating&&!E.rotating&&this.fire(new o.Event("rotatestart",f)),this._pitching&&!E.pitching&&this.fire(new o.Event("pitchstart",f))},d.prototype._fireMoveEvents=function(f){this.fire(new o.Event("move",f)),this._zooming&&this.fire(new o.Event("zoom",f)),this._rotating&&this.fire(new o.Event("rotate",f)),this._pitching&&this.fire(new o.Event("pitch",f))},d.prototype._afterEase=function(f,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var E=this._zooming,P=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new o.Event("zoomend",f)),P&&this.fire(new o.Event("rotateend",f)),R&&this.fire(new o.Event("pitchend",f)),this.fire(new o.Event("moveend",f))}},d.prototype.flyTo=function(f,m){var E=this;if(!f.essential&&o.browser.prefersReducedMotion){var P=o.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,m)}this.stop(),f=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},f);var R=this.transform,F=this.getZoom(),z=this.getBearing(),W=this.getPitch(),et=this.getPadding(),Z="zoom"in f?o.clamp(+f.zoom,R.minZoom,R.maxZoom):F,it="bearing"in f?this._normalizeBearing(f.bearing,z):z,ot="pitch"in f?+f.pitch:W,bt="padding"in f?f.padding:R.padding,Pt=R.zoomScale(Z-F),mt=o.Point.convert(f.offset),It=R.centerPoint.add(mt),Vt=R.pointLocation(It),Jt=o.LngLat.convert(f.center||Vt);this._normalizeCenter(Jt);var te=R.project(Vt),Qt=R.project(Jt).sub(te),$t=f.curve,pe=Math.max(R.width,R.height),Oe=pe/Pt,xe=Qt.mag();if("minZoom"in f){var Ue=o.clamp(Math.min(f.minZoom,F,Z),R.minZoom,R.maxZoom),oi=pe/R.zoomScale(Ue-F);$t=Math.sqrt(oi/xe*2)}var Ei=$t*$t;function Si(Fi){var Oi=(Oe*Oe-pe*pe+(Fi?-1:1)*Ei*Ei*xe*xe)/(2*(Fi?Oe:pe)*Ei*xe);return Math.log(Math.sqrt(Oi*Oi+1)-Oi)}function xn(Fi){return(Math.exp(Fi)-Math.exp(-Fi))/2}function ai(Fi){return(Math.exp(Fi)+Math.exp(-Fi))/2}var Wi=Si(0),nn=function(Fi){return ai(Wi)/ai(Wi+$t*Fi)},Hi=function(Fi){return pe*((ai(Wi)*(xn(Oi=Wi+$t*Fi)/ai(Oi))-xn(Wi))/Ei)/xe;var Oi},zi=(Si(1)-Wi)/$t;if(Math.abs(xe)<1e-6||!isFinite(zi)){if(Math.abs(pe-Oe)<1e-6)return this.easeTo(f,m);var Yi=Oe<pe?-1:1;zi=Math.abs(Math.log(Oe/pe))/$t,Hi=function(){return 0},nn=function(Fi){return Math.exp(Yi*$t*Fi)}}return f.duration="duration"in f?+f.duration:1e3*zi/("screenSpeed"in f?+f.screenSpeed/$t:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=z!==it,this._pitching=ot!==W,this._padding=!R.isPaddingEqual(bt),this._prepareEase(m,!1),this._ease(function(Fi){var Oi=Fi*zi,Qr=1/nn(Oi);R.zoom=Fi===1?Z:F+R.scaleZoom(Qr),E._rotating&&(R.bearing=o.number(z,it,Fi)),E._pitching&&(R.pitch=o.number(W,ot,Fi)),E._padding&&(R.interpolatePadding(et,bt,Fi),It=R.centerPoint.add(mt));var Tr=Fi===1?Jt:R.unproject(te.add(Qt.mult(Hi(Oi))).mult(Qr));R.setLocationAtPoint(R.renderWorldCopies?Tr.wrap():Tr,It),E._fireMoveEvents(m)},function(){return E._afterEase(m)},f),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(f,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,m)}if(!f){var P=this.handlers;P&&P.stop(!1)}return this},d.prototype._ease=function(f,m,E){E.animate===!1||E.duration===0?(f(1),m()):(this._easeStart=o.browser.now(),this._easeOptions=E,this._onEaseFrame=f,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var f=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(f,m){f=o.wrap(f,-180,180);var E=Math.abs(f-m);return Math.abs(f-360-m)<E&&(f-=360),Math.abs(f+360-m)<E&&(f+=360),f},d.prototype._normalizeCenter=function(f){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var E=f.lng-m.center.lng;f.lng+=E>180?-360:E<-180?360:0}},d}(o.Evented),uo=function(l){l===void 0&&(l={}),this.options=l,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};uo.prototype.getDefaultPosition=function(){return"bottom-right"},uo.prototype.onAdd=function(l){var d=this.options&&this.options.compact;return this._map=l,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=h.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=h.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},uo.prototype.onRemove=function(){h.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},uo.prototype._setElementTitle=function(l,d){var f=this._map._getUIString("AttributionControl."+d);l.title=f,l.setAttribute("aria-label",f)},uo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},uo.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(l){var f=d.reduce(function(m,E,P){return E.value&&(m+=E.key+"="+E.value+(P<d.length-1?"&":"")),m},"?");l.href=o.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},uo.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},uo.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var f=this._map.style.sourceCaches;for(var m in f){var E=f[m];if(E.used){var P=E.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l.sort(function(F,z){return F.length-z.length});var R=(l=l.filter(function(F,z){for(var W=z+1;W<l.length;W++)if(l[W].indexOf(F)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,l.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},uo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Xr=function(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)};Xr.prototype.onAdd=function(l){this._map=l,this._container=h.create("div","mapboxgl-ctrl");var d=h.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Xr.prototype.onRemove=function(){h.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Xr.prototype.getDefaultPosition=function(){return"bottom-left"},Xr.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Xr.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var d in l)if(l[d].getSource().mapbox_logo)return!0;return!1}},Xr.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Qn=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Qn.prototype.add=function(l){var d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d},Qn.prototype.remove=function(l){for(var d=this._currentlyRunning,f=0,m=d?this._queue.concat(d):this._queue;f<m.length;f+=1){var E=m[f];if(E.id===l)return void(E.cancelled=!0)}},Qn.prototype.run=function(l){l===void 0&&(l=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,m=d;f<m.length;f+=1){var E=m[f];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Qn.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ui={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},ls=o.window.HTMLImageElement,An=o.window.HTMLElement,Ki=o.window.ImageBitmap,kr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Bu=function(l){function d(m){var E=this;if((m=o.extend({},kr,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var P=new hn(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(l.call(this,P,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Qn,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Ui,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new o.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=o.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof An))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new ui(this,m),this._hash=m.hash&&new Wo(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,o.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new uo({customAttribution:m.customAttribution})),this.addControl(new Xr,m.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(R){E._update(R.dataType==="style"),E.fire(new o.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){E.fire(new o.Event(R.dataType+"dataloading",R))})}l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(m,E){if(E===void 0&&(E=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=m.onAdd(this);this._controls.push(m);var R=this._controlPositions[E];return E.indexOf("bottom")!==-1?R.insertBefore(P,R.firstChild):R.appendChild(P),this},d.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(m);return E>-1&&this._controls.splice(E,1),m.onRemove(this),this},d.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},d.prototype.resize=function(m){var E=this._containerDimensions(),P=E[0],R=E[1];if(P===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(P,R),this.transform.resize(P,R),this.painter.resize(P,R);var F=!this._moving;return F&&this.fire(new o.Event("movestart",m)).fire(new o.Event("move",m)),this.fire(new o.Event("resize",m)),F&&this.fire(new o.Event("moveend",m)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(o.LngLatBounds.convert(m)),this._update()},d.prototype.setMinZoom=function(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(m){if((m=m??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},d.prototype.project=function(m){return this.transform.locationPoint(o.LngLat.convert(m))},d.prototype.unproject=function(m){return this.transform.pointLocation(o.Point.convert(m))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(m,E,P){var R,F=this;if(m==="mouseenter"||m==="mouseover"){var z=!1;return{layer:E,listener:P,delegates:{mousemove:function(et){var Z=F.getLayer(E)?F.queryRenderedFeatures(et.point,{layers:[E]}):[];Z.length?z||(z=!0,P.call(F,new Nn(m,F,et.originalEvent,{features:Z}))):z=!1},mouseout:function(){z=!1}}}}if(m==="mouseleave"||m==="mouseout"){var W=!1;return{layer:E,listener:P,delegates:{mousemove:function(et){(F.getLayer(E)?F.queryRenderedFeatures(et.point,{layers:[E]}):[]).length?W=!0:W&&(W=!1,P.call(F,new Nn(m,F,et.originalEvent)))},mouseout:function(et){W&&(W=!1,P.call(F,new Nn(m,F,et.originalEvent)))}}}}return{layer:E,listener:P,delegates:(R={},R[m]=function(et){var Z=F.getLayer(E)?F.queryRenderedFeatures(et.point,{layers:[E]}):[];Z.length&&(et.features=Z,P.call(F,et),delete et.features)},R)}},d.prototype.on=function(m,E,P){if(P===void 0)return l.prototype.on.call(this,m,E);var R=this._createDelegatedListener(m,E,P);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(R),R.delegates)this.on(F,R.delegates[F]);return this},d.prototype.once=function(m,E,P){if(P===void 0)return l.prototype.once.call(this,m,E);var R=this._createDelegatedListener(m,E,P);for(var F in R.delegates)this.once(F,R.delegates[F]);return this},d.prototype.off=function(m,E,P){var R=this;return P===void 0?l.prototype.off.call(this,m,E):(this._delegatedListeners&&this._delegatedListeners[m]&&function(F){for(var z=F[m],W=0;W<z.length;W++){var et=z[W];if(et.layer===E&&et.listener===P){for(var Z in et.delegates)R.off(Z,et.delegates[Z]);return z.splice(W,1),R}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(m,E){if(!this.style)return[];var P;if(E!==void 0||m===void 0||m instanceof o.Point||Array.isArray(m)||(E=m,m=void 0),E=E||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof o.Point||typeof m[0]=="number")P=[o.Point.convert(m)];else{var R=o.Point.convert(m[0]),F=o.Point.convert(m[1]);P=[R,new o.Point(F.x,R.y),F,new o.Point(R.x,F.y),R]}return this.style.queryRenderedFeatures(P,E,this.transform)},d.prototype.querySourceFeatures=function(m,E){return this.style.querySourceFeatures(m,E)},d.prototype.setStyle=function(m,E){return(E=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(m,E))},d.prototype._getUIString=function(m){var E=this._locale[m];if(E==null)throw new Error("Missing UI string '"+m+"'");return E},d.prototype._updateStyle=function(m,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Gn(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Gn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(m,E){var P=this;if(typeof m=="string"){var R=this._requestManager.normalizeStyleURL(m),F=this._requestManager.transformRequest(R,o.ResourceType.Style);o.getJSON(F,function(z,W){z?P.fire(new o.ErrorEvent(z)):W&&P._updateDiff(W,E)})}else typeof m=="object"&&this._updateDiff(m,E)},d.prototype._updateDiff=function(m,E){try{this.style.setState(m)&&this._update(!0)}catch(P){o.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(m,E)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(m,E){return this._lazyInitEmptyStyle(),this.style.addSource(m,E),this._update(!0)},d.prototype.isSourceLoaded=function(m){var E=this.style&&this.style.sourceCaches[m];if(E!==void 0)return E.loaded();this.fire(new o.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},d.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var E in m){var P=m[E]._tiles;for(var R in P){var F=P[R];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(m,E,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,E,P)},d.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},d.prototype.getSource=function(m){return this.style.getSource(m)},d.prototype.addImage=function(m,E,P){P===void 0&&(P={});var R=P.pixelRatio;R===void 0&&(R=1);var F=P.sdf;F===void 0&&(F=!1);var z=P.stretchX,W=P.stretchY,et=P.content;if(this._lazyInitEmptyStyle(),E instanceof ls||Ki&&E instanceof Ki){var Z=o.browser.getImageData(E);this.style.addImage(m,{data:new o.RGBAImage({width:Z.width,height:Z.height},Z.data),pixelRatio:R,stretchX:z,stretchY:W,content:et,sdf:F,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var it=E;this.style.addImage(m,{data:new o.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:R,stretchX:z,stretchY:W,content:et,sdf:F,version:0,userImage:it}),it.onAdd&&it.onAdd(this,m)}},d.prototype.updateImage=function(m,E){var P=this.style.getImage(m);if(!P)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=E instanceof ls||Ki&&E instanceof Ki?o.browser.getImageData(E):E,F=R.width,z=R.height,W=R.data;return F===void 0||z===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==P.data.width||z!==P.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(P.data.replace(W,!(E instanceof ls||Ki&&E instanceof Ki)),void this.style.updateImage(m,P))},d.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(m){this.style.removeImage(m)},d.prototype.loadImage=function(m,E){o.getImage(this._requestManager.transformRequest(m,o.ResourceType.Image),E)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(m,E){return this._lazyInitEmptyStyle(),this.style.addLayer(m,E),this._update(!0)},d.prototype.moveLayer=function(m,E){return this.style.moveLayer(m,E),this._update(!0)},d.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},d.prototype.getLayer=function(m){return this.style.getLayer(m)},d.prototype.setLayerZoomRange=function(m,E,P){return this.style.setLayerZoomRange(m,E,P),this._update(!0)},d.prototype.setFilter=function(m,E,P){return P===void 0&&(P={}),this.style.setFilter(m,E,P),this._update(!0)},d.prototype.getFilter=function(m){return this.style.getFilter(m)},d.prototype.setPaintProperty=function(m,E,P,R){return R===void 0&&(R={}),this.style.setPaintProperty(m,E,P,R),this._update(!0)},d.prototype.getPaintProperty=function(m,E){return this.style.getPaintProperty(m,E)},d.prototype.setLayoutProperty=function(m,E,P,R){return R===void 0&&(R={}),this.style.setLayoutProperty(m,E,P,R),this._update(!0)},d.prototype.getLayoutProperty=function(m,E){return this.style.getLayoutProperty(m,E)},d.prototype.setLight=function(m,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(m,E),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(m,E){return this.style.setFeatureState(m,E),this._update()},d.prototype.removeFeatureState=function(m,E){return this.style.removeFeatureState(m,E),this._update()},d.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var m=0,E=0;return this._container&&(m=this._container.clientWidth||400,E=this._container.clientHeight||300),[m,E]},d.prototype._detectMissingCSS=function(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=h.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=h.create("div","mapboxgl-canvas-container",m);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=h.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var R=this._controlContainer=h.create("div","mapboxgl-control-container",m),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(z){F[z]=h.create("div","mapboxgl-ctrl-"+z,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(m,E){var P=o.browser.devicePixelRatio||1;this._canvas.width=P*m,this._canvas.height=P*E,this._canvas.style.width=m+"px",this._canvas.style.height=E+"px"},d.prototype._setupPainter=function(){var m=o.extend({},c.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);E?(this.painter=new Xn(E,this.transform),o.webpSupported.testSupport(E)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:m}))},d.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:m}))},d.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},d.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},d.prototype._render=function(m){var E,P=this,R=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,E),R=o.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var W=this.transform.zoom,et=o.browser.now();this.style.zoomHistory.update(W,et);var Z=new o.EvaluationParameters(W,{now:et,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),it=Z.crossFadingFactor();it===1&&it===this._crossFadingFactor||(z=!0,this._crossFadingFactor=it),this.style.update(Z)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ot=o.browser.now()-R;F.endQueryEXT(F.TIME_ELAPSED_EXT,E),setTimeout(function(){var mt=F.getQueryObjectEXT(E,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(E),P.fire(new o.Event("gpu-timing-frame",{cpuTime:ot,gpuTime:mt}))},50)}if(this.listens("gpu-timing-layer")){var bt=this.painter.collectGpuTimers();setTimeout(function(){var mt=P.painter.queryGpuTimers(bt);P.fire(new o.Event("gpu-timing-layer",{layerTimes:mt}))},50)}var Pt=this._sourcesDirty||this._styleDirty||this._placementDirty;return Pt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||Pt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,E=this._controls;m<E.length;m+=1)E[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),Xo(this._canvasContainer),Xo(this._controlContainer),Xo(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new o.Event("remove"))},d.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=o.browser.frame(function(E){m._frame=null,m._render(E)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(m){this._vertices=m,this._update()},d.prototype._setCacheLimits=function(m,E){o.setCacheLimits(m,E)},f.version.get=function(){return o.version},Object.defineProperties(d.prototype,f),d}(Eu);function Xo(l){l.parentNode&&l.parentNode.removeChild(l)}var Sh={showCompass:!0,showZoom:!0,visualizePitch:!1},dr=function(l){var d=this;this.options=o.extend({},Sh,l),this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return d._map.zoomIn({},{originalEvent:f})}),h.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return d._map.zoomOut({},{originalEvent:f})}),h.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){d.options.visualizePitch?d._map.resetNorthPitch({},{originalEvent:f}):d._map.resetNorth({},{originalEvent:f})}),this._compassIcon=h.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};dr.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),d=l===this._map.getMaxZoom(),f=l===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},dr.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},dr.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ro(this._map,this._compass,this.options.visualizePitch)),this._container},dr.prototype.onRemove=function(){h.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},dr.prototype._createButton=function(l,d){var f=h.create("button",l,this._container);return f.type="button",f.addEventListener("click",d),f},dr.prototype._setButtonTitle=function(l,d){var f=this._map._getUIString("NavigationControl."+d);l.title=f,l.setAttribute("aria-label",f)};var ro=function(l,d,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=d,this.mouseRotate=new xu({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,f&&(this.mousePitch=new Eh({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener(d,"mousedown",this.mousedown),h.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),h.addEventListener(d,"touchmove",this.touchmove),h.addEventListener(d,"touchend",this.touchend),h.addEventListener(d,"touchcancel",this.reset)};function Es(l,d,f){if(l=new o.LngLat(l.lng,l.lat),d){var m=new o.LngLat(l.lng-360,l.lat),E=new o.LngLat(l.lng+360,l.lat),P=f.locationPoint(l).distSqr(d);f.locationPoint(m).distSqr(d)<P?l=m:f.locationPoint(E).distSqr(d)<P&&(l=E)}for(;Math.abs(l.lng-f.center.lng)>180;){var R=f.locationPoint(l);if(R.x>=0&&R.y>=0&&R.x<=f.width&&R.y<=f.height)break;l.lng>f.center.lng?l.lng-=360:l.lng+=360}return l}ro.prototype.down=function(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),h.disableDrag()},ro.prototype.move=function(l,d){var f=this.map,m=this.mouseRotate.mousemoveWindow(l,d);if(m&&m.bearingDelta&&f.setBearing(f.getBearing()+m.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,d);E&&E.pitchDelta&&f.setPitch(f.getPitch()+E.pitchDelta)}},ro.prototype.off=function(){var l=this.element;h.removeEventListener(l,"mousedown",this.mousedown),h.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),h.removeEventListener(l,"touchmove",this.touchmove),h.removeEventListener(l,"touchend",this.touchend),h.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},ro.prototype.offTemp=function(){h.enableDrag(),h.removeEventListener(o.window,"mousemove",this.mousemove),h.removeEventListener(o.window,"mouseup",this.mouseup)},ro.prototype.mousedown=function(l){this.down(o.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),h.mousePos(this.element,l)),h.addEventListener(o.window,"mousemove",this.mousemove),h.addEventListener(o.window,"mouseup",this.mouseup)},ro.prototype.mousemove=function(l){this.move(l,h.mousePos(this.element,l))},ro.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},ro.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=h.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},ro.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=h.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},ro.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ro.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Bs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Xe(l,d,f){var m=l.classList;for(var E in Bs)m.remove("mapboxgl-"+f+"-anchor-"+E);m.add("mapboxgl-"+f+"-anchor-"+d)}var ei,jc=function(l){function d(f,m){if(l.call(this),(f instanceof o.window.HTMLElement||m)&&(f=o.extend({element:f},m)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=o.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=h.create("div"),this._element.setAttribute("aria-label","Map marker");var E=h.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var P=h.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");var R=h.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var F=h.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var z=0,W=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];z<W.length;z+=1){var et=W[z],Z=h.createNS("http://www.w3.org/2000/svg","ellipse");Z.setAttributeNS(null,"opacity","0.04"),Z.setAttributeNS(null,"cx","10.5"),Z.setAttributeNS(null,"cy","5.80029008"),Z.setAttributeNS(null,"rx",et.rx),Z.setAttributeNS(null,"ry",et.ry),F.appendChild(Z)}var it=h.createNS("http://www.w3.org/2000/svg","g");it.setAttributeNS(null,"fill",this._color);var ot=h.createNS("http://www.w3.org/2000/svg","path");ot.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),it.appendChild(ot);var bt=h.createNS("http://www.w3.org/2000/svg","g");bt.setAttributeNS(null,"opacity","0.25"),bt.setAttributeNS(null,"fill","#000000");var Pt=h.createNS("http://www.w3.org/2000/svg","path");Pt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),bt.appendChild(Pt);var mt=h.createNS("http://www.w3.org/2000/svg","g");mt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),mt.setAttributeNS(null,"fill","#FFFFFF");var It=h.createNS("http://www.w3.org/2000/svg","g");It.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Vt=h.createNS("http://www.w3.org/2000/svg","circle");Vt.setAttributeNS(null,"fill","#000000"),Vt.setAttributeNS(null,"opacity","0.25"),Vt.setAttributeNS(null,"cx","5.5"),Vt.setAttributeNS(null,"cy","5.5"),Vt.setAttributeNS(null,"r","5.4999962");var Jt=h.createNS("http://www.w3.org/2000/svg","circle");Jt.setAttributeNS(null,"fill","#FFFFFF"),Jt.setAttributeNS(null,"cx","5.5"),Jt.setAttributeNS(null,"cy","5.5"),Jt.setAttributeNS(null,"r","5.4999962"),It.appendChild(Vt),It.appendChild(Jt),R.appendChild(F),R.appendChild(it),R.appendChild(bt),R.appendChild(mt),R.appendChild(It),E.appendChild(R),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=o.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(te){te.preventDefault()}),this._element.addEventListener("mousedown",function(te){te.preventDefault()}),Xe(this._element,this._anchor,"marker"),this._popup=null}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),h.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(f){return this._lngLat=o.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(f){var m=f.code,E=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&E!==32&&E!==13||this.togglePopup()},d.prototype._onMapClick=function(f){var m=f.originalEvent.target,E=this._element;this._popup&&(m===E||E.contains(m))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},d.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Es(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),h.setTransform(this._element,Bs[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+m)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(f){return this._offset=o.Point.convert(f),this._update(),this},d.prototype._onMove=function(f){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(o.Evented),Ol={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},na=0,Ls=!1,ra=function(l){function d(f){l.call(this),this.options=o.extend({},Ol,f),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.onAdd=function(f){var m;return this._map=f,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,ei!==void 0?m(ei):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(function(E){m(ei=E.state!=="denied")}):m(ei=!!o.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),h.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,na=0,Ls=!1},d.prototype._isOutOfMapMaxBounds=function(f){var m=this._map.getMaxBounds(),E=f.coords;return m&&(E.longitude<m.getWest()||E.longitude>m.getEast()||E.latitude<m.getSouth()||E.latitude>m.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",f)),this._finish()}},d.prototype._updateCamera=function(f){var m=new o.LngLat(f.coords.longitude,f.coords.latitude),E=f.coords.accuracy,P=this._map.getBearing(),R=o.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(E),R,{geolocateSource:!0})},d.prototype._updateMarker=function(f){if(f){var m=new o.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,m=this._map.unproject([0,f]),E=this._map.unproject([1,f]),P=m.distanceTo(E),R=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Ls)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",f)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(f){var m=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=h.create("button","mapboxgl-ctrl-geolocate",this._container),h.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=h.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new jc(this._dotElement),this._circleElement=h.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||m._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new o.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":na--,Ls=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++na>1?(f={maximumAge:6e5,timeout:0},Ls=!0):(f=this.options.positionOptions,Ls=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(o.Evented),oa={maxWidth:100,unit:"metric"},vo=function(l){this.options=o.extend({},oa,l),o.bindAll(["_onMove","setUnit"],this)};function v(l,d,f){var m=f&&f.maxWidth||100,E=l._container.clientHeight/2,P=l.unproject([0,E]),R=l.unproject([m,E]),F=P.distanceTo(R);if(f&&f.unit==="imperial"){var z=3.2808*F;z>5280?y(d,m,z/5280,l._getUIString("ScaleControl.Miles")):y(d,m,z,l._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?y(d,m,F/1852,l._getUIString("ScaleControl.NauticalMiles")):F>=1e3?y(d,m,F/1e3,l._getUIString("ScaleControl.Kilometers")):y(d,m,F,l._getUIString("ScaleControl.Meters"))}function y(l,d,f,m){var E,P,R,F=(E=f,(P=Math.pow(10,(""+Math.floor(E)).length-1))*(R=(R=E/P)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(z){var W=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*W)/W}(R)));l.style.width=d*(F/f)+"px",l.innerHTML=F+"&nbsp;"+m}vo.prototype.getDefaultPosition=function(){return"bottom-left"},vo.prototype._onMove=function(){v(this._map,this._container,this.options)},vo.prototype.onAdd=function(l){return this._map=l,this._container=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},vo.prototype.onRemove=function(){h.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},vo.prototype.setUnit=function(l){this.options.unit=l,v(this._map,this._container,this.options)};var b=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof o.window.HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.window.document&&(this._fullscreenchange="MSFullscreenChange")};b.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=h.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},b.prototype.onRemove=function(){h.remove(this._controlContainer),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},b.prototype._checkFullscreenSupport=function(){return!!(o.window.document.fullscreenEnabled||o.window.document.mozFullScreenEnabled||o.window.document.msFullscreenEnabled||o.window.document.webkitFullscreenEnabled)},b.prototype._setupUI=function(){var l=this._fullscreenButton=h.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);h.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},b.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},b.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},b.prototype._isFullscreen=function(){return this._fullscreen},b.prototype._changeIcon=function(){(o.window.document.fullscreenElement||o.window.document.mozFullScreenElement||o.window.document.webkitFullscreenElement||o.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},b.prototype._onClickFullscreen=function(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.mozCancelFullScreen?o.window.document.mozCancelFullScreen():o.window.document.msExitFullscreen?o.window.document.msExitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var w={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},T=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),M=function(l){function d(f){l.call(this),this.options=o.extend(Object.create(w),f),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(d.__proto__=l),(d.prototype=Object.create(l&&l.prototype)).constructor=d,d.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&h.remove(this._content),this._container&&(h.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(f){return this._lngLat=o.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(f){return this.setDOMContent(o.window.document.createTextNode(f))},d.prototype.setHTML=function(f){var m,E=o.window.document.createDocumentFragment(),P=o.window.document.createElement("body");for(P.innerHTML=f;m=P.firstChild;)E.appendChild(m);return this.setDOMContent(E)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},d.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=h.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},d.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},d.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},d.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=h.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(f){this._update(f.point)},d.prototype._onMouseMove=function(f){this._update(f.point)},d.prototype._onDrag=function(f){this._update(f.point)},d.prototype._update=function(f){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=h.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=h.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Z){return m._container.classList.add(Z)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Es(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var E=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),P=this.options.anchor,R=function Z(it){if(it){if(typeof it=="number"){var ot=Math.round(Math.sqrt(.5*Math.pow(it,2)));return{center:new o.Point(0,0),top:new o.Point(0,it),"top-left":new o.Point(ot,ot),"top-right":new o.Point(-ot,ot),bottom:new o.Point(0,-it),"bottom-left":new o.Point(ot,-ot),"bottom-right":new o.Point(-ot,-ot),left:new o.Point(it,0),right:new o.Point(-it,0)}}if(it instanceof o.Point||Array.isArray(it)){var bt=o.Point.convert(it);return{center:bt,top:bt,"top-left":bt,"top-right":bt,bottom:bt,"bottom-left":bt,"bottom-right":bt,left:bt,right:bt}}return{center:o.Point.convert(it.center||[0,0]),top:o.Point.convert(it.top||[0,0]),"top-left":o.Point.convert(it["top-left"]||[0,0]),"top-right":o.Point.convert(it["top-right"]||[0,0]),bottom:o.Point.convert(it.bottom||[0,0]),"bottom-left":o.Point.convert(it["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(it["bottom-right"]||[0,0]),left:o.Point.convert(it.left||[0,0]),right:o.Point.convert(it.right||[0,0])}}return Z(new o.Point(0,0))}(this.options.offset);if(!P){var F,z=this._container.offsetWidth,W=this._container.offsetHeight;F=E.y+R.bottom.y<W?["top"]:E.y>this._map.transform.height-W?["bottom"]:[],E.x<z/2?F.push("left"):E.x>this._map.transform.width-z/2&&F.push("right"),P=F.length===0?"bottom":F.join("-")}var et=E.add(R[P]).round();h.setTransform(this._container,Bs[P]+" translate("+et.x+"px,"+et.y+"px)"),Xe(this._container,P,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(T);f&&f.focus()}},d.prototype._onClose=function(){this.remove()},d}(o.Evented),O={version:o.version,supported:c,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:Bu,NavigationControl:dr,GeolocateControl:ra,AttributionControl:uo,ScaleControl:vo,FullscreenControl:b,Popup:M,Marker:jc,Style:Gn,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,config:o.config,prewarm:function(){he().acquire(Kt)},clearPrewarmedResources:function(){var l=Pe;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Kt),Pe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(l){o.config.ACCESS_TOKEN=l},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(l){o.config.API_URL=l},get workerCount(){return Ee.workerCount},set workerCount(l){Ee.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){o.clearTileCache(l)},workerUrl:""};return O}),r})}(z2)),z2.exports}var Qot=Xot();const ll=zh(Qot);var Kot=1e-7;function G2(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function iD(e,t){if(e===t)return!0;if(G2(e)&&G2(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!iD(e[i],t[i]))return!1;return!0}return Math.abs(e-t)<=Kot}function fy(e,t,i){return Math.max(t,Math.min(i,e))}function dy(e,t,i){return G2(e)?e.map(function(n,r){return dy(n,t[r],i)}):i*t+(1-i)*e}function yc(e,t){if(!e)throw new Error(t||"react-map-gl: assertion failed.")}function nD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function rD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?nD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var cf={minZoom:0,maxZoom:24,minPitch:0,maxPitch:60},j2={pitch:0,bearing:0,altitude:1.5},oD=5,qot=1.2,cp=function(){function e(t){var i=t.width,n=t.height,r=t.latitude,s=t.longitude,o=t.zoom,c=t.bearing,h=c===void 0?j2.bearing:c,A=t.pitch,_=A===void 0?j2.pitch:A,C=t.altitude,S=C===void 0?j2.altitude:C,L=t.maxZoom,N=L===void 0?cf.maxZoom:L,U=t.minZoom,H=U===void 0?cf.minZoom:U,j=t.maxPitch,tt=j===void 0?cf.maxPitch:j,K=t.minPitch,Q=K===void 0?cf.minPitch:K,pt=t.transitionDuration,$=t.transitionEasing,zt=t.transitionInterpolator,Gt=t.transitionInterruption,dt=t.startPanLngLat,lt=t.startZoomLngLat,Lt=t.startRotatePos,J=t.startBearing,ut=t.startPitch,Et=t.startZoom;Fu(this,e),yc(Number.isFinite(i),"`width` must be supplied"),yc(Number.isFinite(n),"`height` must be supplied"),yc(Number.isFinite(s),"`longitude` must be supplied"),yc(Number.isFinite(r),"`latitude` must be supplied"),yc(Number.isFinite(o),"`zoom` must be supplied"),this._viewportProps=this._applyConstraints({width:i,height:n,latitude:r,longitude:s,zoom:o,bearing:h,pitch:_,altitude:S,maxZoom:N,minZoom:H,maxPitch:tt,minPitch:Q,transitionDuration:pt,transitionEasing:$,transitionInterpolator:zt,transitionInterruption:Gt}),this._state={startPanLngLat:dt,startZoomLngLat:lt,startRotatePos:Lt,startBearing:J,startPitch:ut,startZoom:Et}}return Lu(e,[{key:"getViewportProps",value:function(){return this._viewportProps}},{key:"getState",value:function(){return this._state}},{key:"panStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startPanLngLat:this._unproject(i)})}},{key:"pan",value:function(t){var i=t.pos,n=t.startPos,r=this._state.startPanLngLat||this._unproject(n);if(!r)return this;var s=this._calculateNewLngLat({startPanLngLat:r,pos:i}),o=ho(s,2),c=o[0],h=o[1];return this._getUpdatedMapState({longitude:c,latitude:h})}},{key:"panEnd",value:function(){return this._getUpdatedMapState({startPanLngLat:null})}},{key:"rotateStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startRotatePos:i,startBearing:this._viewportProps.bearing,startPitch:this._viewportProps.pitch})}},{key:"rotate",value:function(t){var i=t.pos,n=t.deltaAngleX,r=n===void 0?0:n,s=t.deltaAngleY,o=s===void 0?0:s,c=this._state,h=c.startRotatePos,A=c.startBearing,_=c.startPitch;if(!Number.isFinite(A)||!Number.isFinite(_))return this;var C;return i?C=this._calculateNewPitchAndBearing(rD(rD({},this._getRotationParams(i,h)),{},{startBearing:A,startPitch:_})):C={bearing:A+r,pitch:_+o},this._getUpdatedMapState(C)}},{key:"rotateEnd",value:function(){return this._getUpdatedMapState({startBearing:null,startPitch:null})}},{key:"zoomStart",value:function(t){var i=t.pos;return this._getUpdatedMapState({startZoomLngLat:this._unproject(i),startZoom:this._viewportProps.zoom})}},{key:"zoom",value:function(t){var i=t.pos,n=t.startPos,r=t.scale;yc(r>0,"`scale` must be a positive number");var s=this._state,o=s.startZoom,c=s.startZoomLngLat;Number.isFinite(o)||(o=this._viewportProps.zoom,c=this._unproject(n)||this._unproject(i)),yc(c,"`startZoomLngLat` prop is required for zoom behavior to calculate where to position the map.");var h=this._calculateNewZoom({scale:r,startZoom:o||0}),A=new ml(Object.assign({},this._viewportProps,{zoom:h})),_=A.getMapCenterByLngLatPosition({lngLat:c,pos:i}),C=ho(_,2),S=C[0],L=C[1];return this._getUpdatedMapState({zoom:h,longitude:S,latitude:L})}},{key:"zoomEnd",value:function(){return this._getUpdatedMapState({startZoomLngLat:null,startZoom:null})}},{key:"_getUpdatedMapState",value:function(t){return new e(Object.assign({},this._viewportProps,this._state,t))}},{key:"_applyConstraints",value:function(t){var i=t.maxZoom,n=t.minZoom,r=t.zoom;t.zoom=fy(r,n,i);var s=t.maxPitch,o=t.minPitch,c=t.pitch;return t.pitch=fy(c,o,s),Object.assign(t,kot(t)),t}},{key:"_unproject",value:function(t){var i=new ml(this._viewportProps);return t&&i.unproject(t)}},{key:"_calculateNewLngLat",value:function(t){var i=t.startPanLngLat,n=t.pos,r=new ml(this._viewportProps);return r.getMapCenterByLngLatPosition({lngLat:i,pos:n})}},{key:"_calculateNewZoom",value:function(t){var i=t.scale,n=t.startZoom,r=this._viewportProps,s=r.maxZoom,o=r.minZoom,c=n+Math.log2(i);return fy(c,o,s)}},{key:"_calculateNewPitchAndBearing",value:function(t){var i=t.deltaScaleX,n=t.deltaScaleY,r=t.startBearing,s=t.startPitch;n=fy(n,-1,1);var o=this._viewportProps,c=o.minPitch,h=o.maxPitch,A=r+180*i,_=s;return n>0?_=s+n*(h-s):n<0&&(_=s-n*(c-s)),{pitch:_,bearing:A}}},{key:"_getRotationParams",value:function(t,i){var n=t[0]-i[0],r=t[1]-i[1],s=t[1],o=i[1],c=this._viewportProps,h=c.width,A=c.height,_=n/h,C=0;return r>0?Math.abs(A-o)>oD&&(C=r/(o-A)*qot):r<0&&o>oD&&(C=1-s/o),C=Math.min(1,Math.max(-1,C)),{deltaScaleX:_,deltaScaleY:C}}}]),e}();function Zot(e){return e[0].toLowerCase()+e.slice(1)}function Yot(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:cf;for(var i in t){var n=i.slice(0,3),r=Zot(i.slice(3));if(n==="min"&&e[r]<t[i]||n==="max"&&e[r]>t[i])return!1}return!0}function sD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function aD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?sD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var lf=Te.createContext({viewport:null,map:null,container:null,onViewportChange:null,onViewStateChange:null,eventManager:null}),V2=lf.Provider;function $ot(e){var t=e.value,i=e.children,n=Te.useState(null),r=ho(n,2),s=r[0],o=r[1],c=Te.useContext(lf);return t=aD(aD({setMap:o},c),{},{map:c&&c.map||s},t),Te.createElement(V2,{value:t},i)}lf.Provider=$ot;var H2=typeof window<"u"?Te.useLayoutEffect:Te.useEffect;function cD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function vc(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?cD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var tst="https://visgl.github.io/react-map-gl/docs/get-started/mapbox-tokens",lD="A valid API access token is required to use Mapbox data";function est(){}function uD(e){var t=e.props,i=e.width,n=e.height;return new ml(vc(vc(vc({},t),t.viewState),{},{width:i,height:n}))}var ist=401,hD={position:"absolute",width:"100%",height:"100%",overflow:"hidden"},nst=Object.assign({},af.propTypes,{width:Ae.oneOfType([Ae.number,Ae.string]),height:Ae.oneOfType([Ae.number,Ae.string]),onResize:Ae.func,disableTokenWarning:Ae.bool,visible:Ae.bool,className:Ae.string,style:Ae.object,visibilityConstraints:Ae.object}),rst=Object.assign({},af.defaultProps,{disableTokenWarning:!1,visible:!0,onResize:est,className:"",style:null,visibilityConstraints:cf});function ost(){var e={position:"absolute",left:0,top:0};return Te.createElement("div",{key:"warning",id:"no-token-warning",style:e},Te.createElement("h3",{key:"header"},lD),Te.createElement("div",{key:"text"},"For information on setting up your basemap, read"),Te.createElement("a",{key:"link",href:tst},"Note on Map Tokens"))}function sst(e){return{getMap:function(){return e.current&&e.current.getMap()},queryRenderedFeatures:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.current&&e.current.getMap();return n&&n.queryRenderedFeatures(t,i)}}}var Kl=Te.forwardRef(function(e,t){var i=Te.useState(!0),n=ho(i,2),r=n[0],s=n[1],o=Te.useState({width:0,height:0}),c=ho(o,2),h=c[0],A=c[1],_=Te.useRef(null),C=Te.useRef(null),S=Te.useRef(null),L=Te.useRef(null),N=Te.useContext(lf);H2(function(){if(Kl.supported()){var lt=new af(vc(vc(vc({},e),h),{},{mapboxgl:ll,container:C.current,onError:function(J){var ut=J.error&&J.error.status||J.status;ut===ist&&r&&(console.error(lD),s(!1)),e.onError(J)}}));_.current=lt,N&&N.setMap&&N.setMap(lt.getMap());var Lt=new sU(function(J){if(J[0].contentRect){var ut=J[0].contentRect,Et=ut.width,le=ut.height;A({width:Et,height:le}),e.onResize({width:Et,height:le})}});return Lt.observe(S.current),function(){lt.finalize(),_.current=null,Lt.disconnect()}}},[]),H2(function(){_.current&&_.current.setProps(vc(vc({},e),h))});var U=_.current&&_.current.getMap();Te.useImperativeHandle(t,function(){return sst(_)},[]);var H=Te.useCallback(function(lt){var Lt=lt.target;Lt===L.current&&Lt.scrollTo(0,0)},[]),j=U&&Te.createElement(V2,{value:vc(vc({},N),{},{viewport:N.viewport||uD(vc({map:U,props:e},h)),map:U,container:N.container||S.current})},Te.createElement("div",{key:"map-overlays",className:"overlays",ref:L,style:hD,onScroll:H},e.children)),tt=e.className,K=e.width,Q=e.height,pt=e.style,$=e.visibilityConstraints,zt=Object.assign({position:"relative"},pt,{width:K,height:Q}),Gt=e.visible&&Yot(e.viewState||e,$),dt=Object.assign({},hD,{visibility:Gt?"inherit":"hidden"});return Te.createElement("div",{key:"map-container",ref:S,style:zt},Te.createElement("div",{key:"map-mapbox",ref:C,style:dt,className:tt}),j,!r&&!e.disableTokenWarning&&Te.createElement(ost,null))});Kl.supported=function(){return ll&&ll.supported()},Kl.propTypes=nst,Kl.defaultProps=rst;function ast(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=cst(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,c;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,c=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw c}}}}function cst(e,t){if(e){if(typeof e=="string")return fD(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return fD(e,t)}}function fD(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var dD=function(){function e(){Fu(this,e),Ci(this,"propNames",[])}return Lu(e,[{key:"arePropsEqual",value:function(t,i){var n=ast(this.propNames||[]),r;try{for(n.s();!(r=n.n()).done;){var s=r.value;if(!iD(t[s],i[s]))return!1}}catch(o){n.e(o)}finally{n.f()}return!0}},{key:"initializeProps",value:function(t,i){return{start:t,end:i}}},{key:"interpolateProps",value:function(t,i,n){yc(!1,"interpolateProps is not implemented")}},{key:"getDuration",value:function(t,i){return i.transitionDuration}}]),e}(),lst={longitude:1,bearing:1};function py(e){return Number.isFinite(e)||Array.isArray(e)}function ust(e){return e in lst}function W2(e,t,i){return ust(e)&&Math.abs(i-t)>180&&(i=i<0?i+360:i-360),i}function J2(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=hst(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,c;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,c=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw c}}}}function hst(e,t){if(e){if(typeof e=="string")return pD(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return pD(e,t)}}function pD(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function fst(e){var t=dst();return function(){var i=gd(e),n;if(t){var r=gd(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return V_(this,n)}}function dst(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var pst=["longitude","latitude","zoom","bearing","pitch"],Ast=["latitude","longitude","zoom","width","height"],AD=["bearing","pitch"],gst={speed:1.2,curve:1.414};(function(e){j_(i,e);var t=fst(i);function i(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Fu(this,i),n=t.call(this),Ci(Ou(n),"propNames",pst),n.props=Object.assign({},gst,r),n}return Lu(i,[{key:"initializeProps",value:function(n,r){var s={},o={},c=J2(Ast),h;try{for(c.s();!(h=c.n()).done;){var A=h.value,_=n[A],C=r[A];yc(py(_)&&py(C),"".concat(A," must be supplied for transition")),s[A]=_,o[A]=W2(A,_,C)}}catch(j){c.e(j)}finally{c.f()}var S=J2(AD),L;try{for(S.s();!(L=S.n()).done;){var N=L.value,U=n[N]||0,H=r[N]||0;s[N]=U,o[N]=W2(N,U,H)}}catch(j){S.e(j)}finally{S.f()}return{start:s,end:o}}},{key:"interpolateProps",value:function(n,r,s){var o=Uot(n,r,s,this.props),c=J2(AD),h;try{for(c.s();!(h=c.n()).done;){var A=h.value;o[A]=dy(n[A],r[A],s)}}catch(_){c.e(_)}finally{c.f()}return o}},{key:"getDuration",value:function(n,r){var s=r.transitionDuration;return s==="auto"&&(s=zot(n,r,this.props)),s}}]),i})(dD);function gD(e,t){var i;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(i=mst(e))||t){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,o=!1,c;return{s:function(){i=e[Symbol.iterator]()},n:function(){var h=i.next();return s=h.done,h},e:function(h){o=!0,c=h},f:function(){try{!s&&i.return!=null&&i.return()}finally{if(o)throw c}}}}function mst(e,t){if(e){if(typeof e=="string")return mD(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return mD(e,t)}}function mD(e,t){(t==null||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function yst(e){var t=vst();return function(){var i=gd(e),n;if(t){var r=gd(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return V_(this,n)}}function vst(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var _st=["longitude","latitude","zoom","bearing","pitch"],_g=function(e){j_(i,e);var t=yst(i);function i(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Fu(this,i),n=t.call(this),Array.isArray(r)&&(r={transitionProps:r}),n.propNames=r.transitionProps||_st,r.around&&(n.around=r.around),n}return Lu(i,[{key:"initializeProps",value:function(n,r){var s={},o={};if(this.around){s.around=this.around;var c=new ml(n).unproject(this.around);Object.assign(o,r,{around:new ml(r).project(c),aroundLngLat:c})}var h=gD(this.propNames),A;try{for(h.s();!(A=h.n()).done;){var _=A.value,C=n[_],S=r[_];yc(py(C)&&py(S),"".concat(_," must be supplied for transition")),s[_]=C,o[_]=W2(_,C,S)}}catch(L){h.e(L)}finally{h.f()}return{start:s,end:o}}},{key:"interpolateProps",value:function(n,r,s){var o={},c=gD(this.propNames),h;try{for(c.s();!(h=c.n()).done;){var A=h.value;o[A]=dy(n[A],r[A],s)}}catch(N){c.e(N)}finally{c.f()}if(r.around){var _=new ml(Object.assign({},r,o)).getMapCenterByLngLatPosition({lngLat:r.aroundLngLat,pos:dy(n.around,r.around,s)}),C=ho(_,2),S=C[0],L=C[1];o.longitude=S,o.latitude=L}return o}}]),i}(dD),bg=function(){};function bst(e,t){var i=e(t);return function(n){return 1/(1-i)*(e(n*(1-t)+t)-i)}}var xg={BREAK:1,SNAP_TO_END:2,IGNORE:3,UPDATE:4},xst={transitionDuration:0,transitionEasing:function(e){return e},transitionInterpolator:new _g,transitionInterruption:xg.BREAK,onTransitionStart:bg,onTransitionInterrupt:bg,onTransitionEnd:bg},X2=function(){function e(){var t=this,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Fu(this,e),Ci(this,"_animationFrame",null),Ci(this,"_onTransitionFrame",function(){t._animationFrame=requestAnimationFrame(t._onTransitionFrame),t._updateViewport()}),this.props=null,this.onViewportChange=i.onViewportChange||bg,this.onStateChange=i.onStateChange||bg,this.time=i.getTime||Date.now}return Lu(e,[{key:"getViewportInTransition",value:function(){return this._animationFrame?this.state.propsInTransition:null}},{key:"processViewportChange",value:function(t){var i=this.props;if(this.props=t,!i||this._shouldIgnoreViewportChange(i,t))return!1;if(this._isTransitionEnabled(t)){var n=Object.assign({},i),r=Object.assign({},t);if(this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this.state.interruption===xg.SNAP_TO_END?Object.assign(n,this.state.endProps):Object.assign(n,this.state.propsInTransition),this.state.interruption===xg.UPDATE)){var s=this.time(),o=(s-this.state.startTime)/this.state.duration;r.transitionDuration=this.state.duration-(s-this.state.startTime),r.transitionEasing=bst(this.state.easing,o),r.transitionInterpolator=n.transitionInterpolator}return r.onTransitionStart(),this._triggerTransition(n,r),!0}return this._isTransitionInProgress()&&(i.onTransitionInterrupt(),this._endTransition()),!1}},{key:"_isTransitionInProgress",value:function(){return!!this._animationFrame}},{key:"_isTransitionEnabled",value:function(t){var i=t.transitionDuration,n=t.transitionInterpolator;return(i>0||i==="auto")&&!!n}},{key:"_isUpdateDueToCurrentTransition",value:function(t){return this.state.propsInTransition?this.state.interpolator.arePropsEqual(t,this.state.propsInTransition):!1}},{key:"_shouldIgnoreViewportChange",value:function(t,i){return t?this._isTransitionInProgress()?this.state.interruption===xg.IGNORE||this._isUpdateDueToCurrentTransition(i):this._isTransitionEnabled(i)?i.transitionInterpolator.arePropsEqual(t,i):!0:!0}},{key:"_triggerTransition",value:function(t,i){yc(this._isTransitionEnabled(i)),this._animationFrame&&cancelAnimationFrame(this._animationFrame);var n=i.transitionInterpolator,r=n.getDuration?n.getDuration(t,i):i.transitionDuration;if(r!==0){var s=i.transitionInterpolator.initializeProps(t,i),o={inTransition:!0,isZooming:t.zoom!==i.zoom,isPanning:t.longitude!==i.longitude||t.latitude!==i.latitude,isRotating:t.bearing!==i.bearing||t.pitch!==i.pitch};this.state={duration:r,easing:i.transitionEasing,interpolator:i.transitionInterpolator,interruption:i.transitionInterruption,startTime:this.time(),startProps:s.start,endProps:s.end,animation:null,propsInTransition:{}},this._onTransitionFrame(),this.onStateChange(o)}}},{key:"_endTransition",value:function(){this._animationFrame&&(cancelAnimationFrame(this._animationFrame),this._animationFrame=null),this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1})}},{key:"_updateViewport",value:function(){var t=this.time(),i=this.state,n=i.startTime,r=i.duration,s=i.easing,o=i.interpolator,c=i.startProps,h=i.endProps,A=!1,_=(t-n)/r;_>=1&&(_=1,A=!0),_=s(_);var C=o.interpolateProps(c,h,_),S=new cp(Object.assign({},this.props,C));this.state.propsInTransition=S.getViewportProps(),this.onViewportChange(this.state.propsInTransition,this.props),A&&(this._endTransition(),this.props.onTransitionEnd())}}]),e}();Ci(X2,"defaultProps",xst);var yD={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */var vD;function wst(){return vD||(vD=1,function(e){(function(t,i,n,r){var s=["","webkit","Moz","MS","ms","o"],o=i.createElement("div"),c="function",h=Math.round,A=Math.abs,_=Date.now;function C(At,Mt,Wt){return setTimeout(K(At,Wt),Mt)}function S(At,Mt,Wt){return Array.isArray(At)?(L(At,Wt[Mt],Wt),!0):!1}function L(At,Mt,Wt){var be;if(At)if(At.forEach)At.forEach(Mt,Wt);else if(At.length!==r)for(be=0;be<At.length;)Mt.call(Wt,At[be],be,At),be++;else for(be in At)At.hasOwnProperty(be)&&Mt.call(Wt,At[be],be,At)}function N(At,Mt,Wt){var be="DEPRECATED METHOD: "+Mt+`
`+Wt+` AT 
`;return function(){var He=new Error("get-stack-trace"),ji=He&&He.stack?He.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ii=t.console&&(t.console.warn||t.console.log);return Ii&&Ii.call(t.console,be,ji),At.apply(this,arguments)}}var U;typeof Object.assign!="function"?U=function(At){if(At===r||At===null)throw new TypeError("Cannot convert undefined or null to object");for(var Mt=Object(At),Wt=1;Wt<arguments.length;Wt++){var be=arguments[Wt];if(be!==r&&be!==null)for(var He in be)be.hasOwnProperty(He)&&(Mt[He]=be[He])}return Mt}:U=Object.assign;var H=N(function(At,Mt,Wt){for(var be=Object.keys(Mt),He=0;He<be.length;)(!Wt||Wt&&At[be[He]]===r)&&(At[be[He]]=Mt[be[He]]),He++;return At},"extend","Use `assign`."),j=N(function(At,Mt){return H(At,Mt,!0)},"merge","Use `assign`.");function tt(At,Mt,Wt){var be=Mt.prototype,He;He=At.prototype=Object.create(be),He.constructor=At,He._super=be,Wt&&U(He,Wt)}function K(At,Mt){return function(){return At.apply(Mt,arguments)}}function Q(At,Mt){return typeof At==c?At.apply(Mt&&Mt[0]||r,Mt):At}function pt(At,Mt){return At===r?Mt:At}function $(At,Mt,Wt){L(lt(Mt),function(be){At.addEventListener(be,Wt,!1)})}function zt(At,Mt,Wt){L(lt(Mt),function(be){At.removeEventListener(be,Wt,!1)})}function Gt(At,Mt){for(;At;){if(At==Mt)return!0;At=At.parentNode}return!1}function dt(At,Mt){return At.indexOf(Mt)>-1}function lt(At){return At.trim().split(/\s+/g)}function Lt(At,Mt,Wt){if(At.indexOf&&!Wt)return At.indexOf(Mt);for(var be=0;be<At.length;){if(Wt&&At[be][Wt]==Mt||!Wt&&At[be]===Mt)return be;be++}return-1}function J(At){return Array.prototype.slice.call(At,0)}function ut(At,Mt,Wt){for(var be=[],He=[],ji=0;ji<At.length;){var Ii=At[ji][Mt];Lt(He,Ii)<0&&be.push(At[ji]),He[ji]=Ii,ji++}return be=be.sort(function(Ln,So){return Ln[Mt]>So[Mt]}),be}function Et(At,Mt){for(var Wt,be,He=Mt[0].toUpperCase()+Mt.slice(1),ji=0;ji<s.length;){if(Wt=s[ji],be=Wt?Wt+He:Mt,be in At)return be;ji++}return r}var le=1;function Ct(){return le++}function Rt(At){var Mt=At.ownerDocument||At;return Mt.defaultView||Mt.parentWindow||t}var Nt=/mobile|tablet|ip(ad|hone|od)|android/i,Zt="ontouchstart"in t,re=Et(t,"PointerEvent")!==r,se=Zt&&Nt.test(navigator.userAgent),de="touch",Me="pen",Se="mouse",oe="kinect",Ai=25,Ke=1,qe=2,Ve=4,di=8,cn=1,Ri=2,bi=4,Vn=8,yi=16,vi=Ri|bi,un=Vn|yi,Di=vi|un,lr=["x","y"],Yn=["clientX","clientY"];function mn(At,Mt){var Wt=this;this.manager=At,this.callback=Mt,this.element=At.element,this.target=At.options.inputTarget,this.domHandler=function(be){Q(At.options.enable,[At])&&Wt.handler(be)},this.init()}mn.prototype={handler:function(){},init:function(){this.evEl&&$(this.element,this.evEl,this.domHandler),this.evTarget&&$(this.target,this.evTarget,this.domHandler),this.evWin&&$(Rt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&zt(this.element,this.evEl,this.domHandler),this.evTarget&&zt(this.target,this.evTarget,this.domHandler),this.evWin&&zt(Rt(this.element),this.evWin,this.domHandler)}};function ir(At){var Mt,Wt=At.options.inputClass;return Wt?Mt=Wt:re?Mt=xt:se?Mt=ft:Zt?Mt=g:Mt=ze,new Mt(At,Hn)}function Hn(At,Mt,Wt){var be=Wt.pointers.length,He=Wt.changedPointers.length,ji=Mt&Ke&&be-He===0,Ii=Mt&(Ve|di)&&be-He===0;Wt.isFirst=!!ji,Wt.isFinal=!!Ii,ji&&(At.session={}),Wt.eventType=Mt,Tn(At,Wt),At.emit("hammer.input",Wt),At.recognize(Wt),At.session.prevInput=Wt}function Tn(At,Mt){var Wt=At.session,be=Mt.pointers,He=be.length;Wt.firstInput||(Wt.firstInput=gi(Mt)),He>1&&!Wt.firstMultiple?Wt.firstMultiple=gi(Mt):He===1&&(Wt.firstMultiple=!1);var ji=Wt.firstInput,Ii=Wt.firstMultiple,Ln=Ii?Ii.center:ji.center,So=Mt.center=Mi(be);Mt.timeStamp=_(),Mt.deltaTime=Mt.timeStamp-ji.timeStamp,Mt.angle=ke(Ln,So),Mt.distance=St(Ln,So),$n(Wt,Mt),Mt.offsetDirection=yr(Mt.deltaX,Mt.deltaY);var lo=rn(Mt.deltaTime,Mt.deltaX,Mt.deltaY);Mt.overallVelocityX=lo.x,Mt.overallVelocityY=lo.y,Mt.overallVelocity=A(lo.x)>A(lo.y)?lo.x:lo.y,Mt.scale=Ii?li(Ii.pointers,be):1,Mt.rotation=Ii?Je(Ii.pointers,be):0,Mt.maxPointers=Wt.prevInput?Mt.pointers.length>Wt.prevInput.maxPointers?Mt.pointers.length:Wt.prevInput.maxPointers:Mt.pointers.length,Ge(Wt,Mt);var is=At.element;Gt(Mt.srcEvent.target,is)&&(is=Mt.srcEvent.target),Mt.target=is}function $n(At,Mt){var Wt=Mt.center,be=At.offsetDelta||{},He=At.prevDelta||{},ji=At.prevInput||{};(Mt.eventType===Ke||ji.eventType===Ve)&&(He=At.prevDelta={x:ji.deltaX||0,y:ji.deltaY||0},be=At.offsetDelta={x:Wt.x,y:Wt.y}),Mt.deltaX=He.x+(Wt.x-be.x),Mt.deltaY=He.y+(Wt.y-be.y)}function Ge(At,Mt){var Wt=At.lastInterval||Mt,be=Mt.timeStamp-Wt.timeStamp,He,ji,Ii,Ln;if(Mt.eventType!=di&&(be>Ai||Wt.velocity===r)){var So=Mt.deltaX-Wt.deltaX,lo=Mt.deltaY-Wt.deltaY,is=rn(be,So,lo);ji=is.x,Ii=is.y,He=A(is.x)>A(is.y)?is.x:is.y,Ln=yr(So,lo),At.lastInterval=Mt}else He=Wt.velocity,ji=Wt.velocityX,Ii=Wt.velocityY,Ln=Wt.direction;Mt.velocity=He,Mt.velocityX=ji,Mt.velocityY=Ii,Mt.direction=Ln}function gi(At){for(var Mt=[],Wt=0;Wt<At.pointers.length;)Mt[Wt]={clientX:h(At.pointers[Wt].clientX),clientY:h(At.pointers[Wt].clientY)},Wt++;return{timeStamp:_(),pointers:Mt,center:Mi(Mt),deltaX:At.deltaX,deltaY:At.deltaY}}function Mi(At){var Mt=At.length;if(Mt===1)return{x:h(At[0].clientX),y:h(At[0].clientY)};for(var Wt=0,be=0,He=0;He<Mt;)Wt+=At[He].clientX,be+=At[He].clientY,He++;return{x:h(Wt/Mt),y:h(be/Mt)}}function rn(At,Mt,Wt){return{x:Mt/At||0,y:Wt/At||0}}function yr(At,Mt){return At===Mt?cn:A(At)>=A(Mt)?At<0?Ri:bi:Mt<0?Vn:yi}function St(At,Mt,Wt){Wt||(Wt=lr);var be=Mt[Wt[0]]-At[Wt[0]],He=Mt[Wt[1]]-At[Wt[1]];return Math.sqrt(be*be+He*He)}function ke(At,Mt,Wt){Wt||(Wt=lr);var be=Mt[Wt[0]]-At[Wt[0]],He=Mt[Wt[1]]-At[Wt[1]];return Math.atan2(He,be)*180/Math.PI}function Je(At,Mt){return ke(Mt[1],Mt[0],Yn)+ke(At[1],At[0],Yn)}function li(At,Mt){return St(Mt[0],Mt[1],Yn)/St(At[0],At[1],Yn)}var Yt={mousedown:Ke,mousemove:qe,mouseup:Ve},Re="mousedown",gt="mousemove mouseup";function ze(){this.evEl=Re,this.evWin=gt,this.pressed=!1,mn.apply(this,arguments)}tt(ze,mn,{handler:function(At){var Mt=Yt[At.type];Mt&Ke&&At.button===0&&(this.pressed=!0),Mt&qe&&At.which!==1&&(Mt=Ve),this.pressed&&(Mt&Ve&&(this.pressed=!1),this.callback(this.manager,Mt,{pointers:[At],changedPointers:[At],pointerType:Se,srcEvent:At}))}});var we={pointerdown:Ke,pointermove:qe,pointerup:Ve,pointercancel:di,pointerout:di},V={2:de,3:Me,4:Se,5:oe},ve="pointerdown",Be="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(ve="MSPointerDown",Be="MSPointerMove MSPointerUp MSPointerCancel");function xt(){this.evEl=ve,this.evWin=Be,mn.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}tt(xt,mn,{handler:function(At){var Mt=this.store,Wt=!1,be=At.type.toLowerCase().replace("ms",""),He=we[be],ji=V[At.pointerType]||At.pointerType,Ii=ji==de,Ln=Lt(Mt,At.pointerId,"pointerId");He&Ke&&(At.button===0||Ii)?Ln<0&&(Mt.push(At),Ln=Mt.length-1):He&(Ve|di)&&(Wt=!0),!(Ln<0)&&(Mt[Ln]=At,this.callback(this.manager,He,{pointers:Mt,changedPointers:[At],pointerType:ji,srcEvent:At}),Wt&&Mt.splice(Ln,1))}});var Xt={touchstart:Ke,touchmove:qe,touchend:Ve,touchcancel:di},ce="touchstart",q="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=ce,this.evWin=q,this.started=!1,mn.apply(this,arguments)}tt(nt,mn,{handler:function(At){var Mt=Xt[At.type];if(Mt===Ke&&(this.started=!0),!!this.started){var Wt=at.call(this,At,Mt);Mt&(Ve|di)&&Wt[0].length-Wt[1].length===0&&(this.started=!1),this.callback(this.manager,Mt,{pointers:Wt[0],changedPointers:Wt[1],pointerType:de,srcEvent:At})}}});function at(At,Mt){var Wt=J(At.touches),be=J(At.changedTouches);return Mt&(Ve|di)&&(Wt=ut(Wt.concat(be),"identifier")),[Wt,be]}var vt={touchstart:Ke,touchmove:qe,touchend:Ve,touchcancel:di},Ot="touchstart touchmove touchend touchcancel";function ft(){this.evTarget=Ot,this.targetIds={},mn.apply(this,arguments)}tt(ft,mn,{handler:function(At){var Mt=vt[At.type],Wt=_t.call(this,At,Mt);Wt&&this.callback(this.manager,Mt,{pointers:Wt[0],changedPointers:Wt[1],pointerType:de,srcEvent:At})}});function _t(At,Mt){var Wt=J(At.touches),be=this.targetIds;if(Mt&(Ke|qe)&&Wt.length===1)return be[Wt[0].identifier]=!0,[Wt,Wt];var He,ji,Ii=J(At.changedTouches),Ln=[],So=this.target;if(ji=Wt.filter(function(lo){return Gt(lo.target,So)}),Mt===Ke)for(He=0;He<ji.length;)be[ji[He].identifier]=!0,He++;for(He=0;He<Ii.length;)be[Ii[He].identifier]&&Ln.push(Ii[He]),Mt&(Ve|di)&&delete be[Ii[He].identifier],He++;if(Ln.length)return[ut(ji.concat(Ln),"identifier"),Ln]}var st=2500,wt=25;function g(){mn.apply(this,arguments);var At=K(this.handler,this);this.touch=new ft(this.manager,At),this.mouse=new ze(this.manager,At),this.primaryTouch=null,this.lastTouches=[]}tt(g,mn,{handler:function(At,Mt,Wt){var be=Wt.pointerType==de,He=Wt.pointerType==Se;if(!(He&&Wt.sourceCapabilities&&Wt.sourceCapabilities.firesTouchEvents)){if(be)ct.call(this,Mt,Wt);else if(He&&Kt.call(this,Wt))return;this.callback(At,Mt,Wt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ct(At,Mt){At&Ke?(this.primaryTouch=Mt.changedPointers[0].identifier,Ce.call(this,Mt)):At&(Ve|di)&&Ce.call(this,Mt)}function Ce(At){var Mt=At.changedPointers[0];if(Mt.identifier===this.primaryTouch){var Wt={x:Mt.clientX,y:Mt.clientY};this.lastTouches.push(Wt);var be=this.lastTouches,He=function(){var ji=be.indexOf(Wt);ji>-1&&be.splice(ji,1)};setTimeout(He,st)}}function Kt(At){for(var Mt=At.srcEvent.clientX,Wt=At.srcEvent.clientY,be=0;be<this.lastTouches.length;be++){var He=this.lastTouches[be],ji=Math.abs(Mt-He.x),Ii=Math.abs(Wt-He.y);if(ji<=wt&&Ii<=wt)return!0}return!1}var Ee=Et(o.style,"touchAction"),Pe=Ee!==r,Le="compute",he="auto",Fe="manipulation",Ie="none",je="pan-x",Ni="pan-y",ti=Ji();function tn(At,Mt){this.manager=At,this.set(Mt)}tn.prototype={set:function(At){At==Le&&(At=this.compute()),Pe&&this.manager.element.style&&ti[At]&&(this.manager.element.style[Ee]=At),this.actions=At.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var At=[];return L(this.manager.recognizers,function(Mt){Q(Mt.options.enable,[Mt])&&(At=At.concat(Mt.getTouchAction()))}),ln(At.join(" "))},preventDefaults:function(At){var Mt=At.srcEvent,Wt=At.offsetDirection;if(this.manager.session.prevented){Mt.preventDefault();return}var be=this.actions,He=dt(be,Ie)&&!ti[Ie],ji=dt(be,Ni)&&!ti[Ni],Ii=dt(be,je)&&!ti[je];if(He){var Ln=At.pointers.length===1,So=At.distance<2,lo=At.deltaTime<250;if(Ln&&So&&lo)return}if(!(Ii&&ji)&&(He||ji&&Wt&vi||Ii&&Wt&un))return this.preventSrc(Mt)},preventSrc:function(At){this.manager.session.prevented=!0,At.preventDefault()}};function ln(At){if(dt(At,Ie))return Ie;var Mt=dt(At,je),Wt=dt(At,Ni);return Mt&&Wt?Ie:Mt||Wt?Mt?je:Ni:dt(At,Fe)?Fe:he}function Ji(){if(!Pe)return!1;var At={},Mt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Wt){At[Wt]=Mt?t.CSS.supports("touch-action",Wt):!0}),At}var Xi=1,Gi=2,vr=4,Qi=8,mi=Qi,Bt=16,Qe=32;function en(At){this.options=U({},this.defaults,At||{}),this.id=Ct(),this.manager=null,this.options.enable=pt(this.options.enable,!0),this.state=Xi,this.simultaneous={},this.requireFail=[]}en.prototype={defaults:{},set:function(At){return U(this.options,At),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(At){if(S(At,"recognizeWith",this))return this;var Mt=this.simultaneous;return At=ur(At,this),Mt[At.id]||(Mt[At.id]=At,At.recognizeWith(this)),this},dropRecognizeWith:function(At){return S(At,"dropRecognizeWith",this)?this:(At=ur(At,this),delete this.simultaneous[At.id],this)},requireFailure:function(At){if(S(At,"requireFailure",this))return this;var Mt=this.requireFail;return At=ur(At,this),Lt(Mt,At)===-1&&(Mt.push(At),At.requireFailure(this)),this},dropRequireFailure:function(At){if(S(At,"dropRequireFailure",this))return this;At=ur(At,this);var Mt=Lt(this.requireFail,At);return Mt>-1&&this.requireFail.splice(Mt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(At){return!!this.simultaneous[At.id]},emit:function(At){var Mt=this,Wt=this.state;function be(He){Mt.manager.emit(He,At)}Wt<Qi&&be(Mt.options.event+Hr(Wt)),be(Mt.options.event),At.additionalEvent&&be(At.additionalEvent),Wt>=Qi&&be(Mt.options.event+Hr(Wt))},tryEmit:function(At){if(this.canEmit())return this.emit(At);this.state=Qe},canEmit:function(){for(var At=0;At<this.requireFail.length;){if(!(this.requireFail[At].state&(Qe|Xi)))return!1;At++}return!0},recognize:function(At){var Mt=U({},At);if(!Q(this.options.enable,[this,Mt])){this.reset(),this.state=Qe;return}this.state&(mi|Bt|Qe)&&(this.state=Xi),this.state=this.process(Mt),this.state&(Gi|vr|Qi|Bt)&&this.tryEmit(Mt)},process:function(At){},getTouchAction:function(){},reset:function(){}};function Hr(At){return At&Bt?"cancel":At&Qi?"end":At&vr?"move":At&Gi?"start":""}function va(At){return At==yi?"down":At==Vn?"up":At==Ri?"left":At==bi?"right":""}function ur(At,Mt){var Wt=Mt.manager;return Wt?Wt.get(At):At}function Wn(){en.apply(this,arguments)}tt(Wn,en,{defaults:{pointers:1},attrTest:function(At){var Mt=this.options.pointers;return Mt===0||At.pointers.length===Mt},process:function(At){var Mt=this.state,Wt=At.eventType,be=Mt&(Gi|vr),He=this.attrTest(At);return be&&(Wt&di||!He)?Mt|Bt:be||He?Wt&Ve?Mt|Qi:Mt&Gi?Mt|vr:Gi:Qe}});function Tt(){Wn.apply(this,arguments),this.pX=null,this.pY=null}tt(Tt,Wn,{defaults:{event:"pan",threshold:10,pointers:1,direction:Di},getTouchAction:function(){var At=this.options.direction,Mt=[];return At&vi&&Mt.push(Ni),At&un&&Mt.push(je),Mt},directionTest:function(At){var Mt=this.options,Wt=!0,be=At.distance,He=At.direction,ji=At.deltaX,Ii=At.deltaY;return He&Mt.direction||(Mt.direction&vi?(He=ji===0?cn:ji<0?Ri:bi,Wt=ji!=this.pX,be=Math.abs(At.deltaX)):(He=Ii===0?cn:Ii<0?Vn:yi,Wt=Ii!=this.pY,be=Math.abs(At.deltaY))),At.direction=He,Wt&&be>Mt.threshold&&He&Mt.direction},attrTest:function(At){return Wn.prototype.attrTest.call(this,At)&&(this.state&Gi||!(this.state&Gi)&&this.directionTest(At))},emit:function(At){this.pX=At.deltaX,this.pY=At.deltaY;var Mt=va(At.direction);Mt&&(At.additionalEvent=this.options.event+Mt),this._super.emit.call(this,At)}});function Ws(){Wn.apply(this,arguments)}tt(Ws,Wn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ie]},attrTest:function(At){return this._super.attrTest.call(this,At)&&(Math.abs(At.scale-1)>this.options.threshold||this.state&Gi)},emit:function(At){if(At.scale!==1){var Mt=At.scale<1?"in":"out";At.additionalEvent=this.options.event+Mt}this._super.emit.call(this,At)}});function Jn(){en.apply(this,arguments),this._timer=null,this._input=null}tt(Jn,en,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[he]},process:function(At){var Mt=this.options,Wt=At.pointers.length===Mt.pointers,be=At.distance<Mt.threshold,He=At.deltaTime>Mt.time;if(this._input=At,!be||!Wt||At.eventType&(Ve|di)&&!He)this.reset();else if(At.eventType&Ke)this.reset(),this._timer=C(function(){this.state=mi,this.tryEmit()},Mt.time,this);else if(At.eventType&Ve)return mi;return Qe},reset:function(){clearTimeout(this._timer)},emit:function(At){this.state===mi&&(At&&At.eventType&Ve?this.manager.emit(this.options.event+"up",At):(this._input.timeStamp=_(),this.manager.emit(this.options.event,this._input)))}});function Js(){Wn.apply(this,arguments)}tt(Js,Wn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ie]},attrTest:function(At){return this._super.attrTest.call(this,At)&&(Math.abs(At.rotation)>this.options.threshold||this.state&Gi)}});function Fr(){Wn.apply(this,arguments)}tt(Fr,Wn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:vi|un,pointers:1},getTouchAction:function(){return Tt.prototype.getTouchAction.call(this)},attrTest:function(At){var Mt=this.options.direction,Wt;return Mt&(vi|un)?Wt=At.overallVelocity:Mt&vi?Wt=At.overallVelocityX:Mt&un&&(Wt=At.overallVelocityY),this._super.attrTest.call(this,At)&&Mt&At.offsetDirection&&At.distance>this.options.threshold&&At.maxPointers==this.options.pointers&&A(Wt)>this.options.velocity&&At.eventType&Ve},emit:function(At){var Mt=va(At.offsetDirection);Mt&&this.manager.emit(this.options.event+Mt,At),this.manager.emit(this.options.event,At)}});function hr(){en.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}tt(hr,en,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Fe]},process:function(At){var Mt=this.options,Wt=At.pointers.length===Mt.pointers,be=At.distance<Mt.threshold,He=At.deltaTime<Mt.time;if(this.reset(),At.eventType&Ke&&this.count===0)return this.failTimeout();if(be&&He&&Wt){if(At.eventType!=Ve)return this.failTimeout();var ji=this.pTime?At.timeStamp-this.pTime<Mt.interval:!0,Ii=!this.pCenter||St(this.pCenter,At.center)<Mt.posThreshold;this.pTime=At.timeStamp,this.pCenter=At.center,!Ii||!ji?this.count=1:this.count+=1,this._input=At;var Ln=this.count%Mt.taps;if(Ln===0)return this.hasRequireFailures()?(this._timer=C(function(){this.state=mi,this.tryEmit()},Mt.interval,this),Gi):mi}return Qe},failTimeout:function(){return this._timer=C(function(){this.state=Qe},this.options.interval,this),Qe},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==mi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Mr(At,Mt){return Mt=Mt||{},Mt.recognizers=pt(Mt.recognizers,Mr.defaults.preset),new Wr(At,Mt)}Mr.VERSION="2.0.7",Mr.defaults={domEvents:!1,touchAction:Le,enable:!0,inputTarget:null,inputClass:null,preset:[[Js,{enable:!1}],[Ws,{enable:!1},["rotate"]],[Fr,{direction:vi}],[Tt,{direction:vi},["swipe"]],[hr],[hr,{event:"doubletap",taps:2},["tap"]],[Jn]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Rn=1,mo=2;function Wr(At,Mt){this.options=U({},Mr.defaults,Mt||{}),this.options.inputTarget=this.options.inputTarget||At,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=At,this.input=ir(this),this.touchAction=new tn(this,this.options.touchAction),Go(this,!0),L(this.options.recognizers,function(Wt){var be=this.add(new Wt[0](Wt[1]));Wt[2]&&be.recognizeWith(Wt[2]),Wt[3]&&be.requireFailure(Wt[3])},this)}Wr.prototype={set:function(At){return U(this.options,At),At.touchAction&&this.touchAction.update(),At.inputTarget&&(this.input.destroy(),this.input.target=At.inputTarget,this.input.init()),this},stop:function(At){this.session.stopped=At?mo:Rn},recognize:function(At){var Mt=this.session;if(!Mt.stopped){this.touchAction.preventDefaults(At);var Wt,be=this.recognizers,He=Mt.curRecognizer;(!He||He&&He.state&mi)&&(He=Mt.curRecognizer=null);for(var ji=0;ji<be.length;)Wt=be[ji],Mt.stopped!==mo&&(!He||Wt==He||Wt.canRecognizeWith(He))?Wt.recognize(At):Wt.reset(),!He&&Wt.state&(Gi|vr|Qi)&&(He=Mt.curRecognizer=Wt),ji++}},get:function(At){if(At instanceof en)return At;for(var Mt=this.recognizers,Wt=0;Wt<Mt.length;Wt++)if(Mt[Wt].options.event==At)return Mt[Wt];return null},add:function(At){if(S(At,"add",this))return this;var Mt=this.get(At.options.event);return Mt&&this.remove(Mt),this.recognizers.push(At),At.manager=this,this.touchAction.update(),At},remove:function(At){if(S(At,"remove",this))return this;if(At=this.get(At),At){var Mt=this.recognizers,Wt=Lt(Mt,At);Wt!==-1&&(Mt.splice(Wt,1),this.touchAction.update())}return this},on:function(At,Mt){if(At!==r&&Mt!==r){var Wt=this.handlers;return L(lt(At),function(be){Wt[be]=Wt[be]||[],Wt[be].push(Mt)}),this}},off:function(At,Mt){if(At!==r){var Wt=this.handlers;return L(lt(At),function(be){Mt?Wt[be]&&Wt[be].splice(Lt(Wt[be],Mt),1):delete Wt[be]}),this}},emit:function(At,Mt){this.options.domEvents&&Sn(At,Mt);var Wt=this.handlers[At]&&this.handlers[At].slice();if(!(!Wt||!Wt.length)){Mt.type=At,Mt.preventDefault=function(){Mt.srcEvent.preventDefault()};for(var be=0;be<Wt.length;)Wt[be](Mt),be++}},destroy:function(){this.element&&Go(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Go(At,Mt){var Wt=At.element;if(Wt.style){var be;L(At.options.cssProps,function(He,ji){be=Et(Wt.style,ji),Mt?(At.oldCssProps[be]=Wt.style[be],Wt.style[be]=He):Wt.style[be]=At.oldCssProps[be]||""}),Mt||(At.oldCssProps={})}}function Sn(At,Mt){var Wt=i.createEvent("Event");Wt.initEvent(At,!0,!0),Wt.gesture=Mt,Mt.target.dispatchEvent(Wt)}U(Mr,{INPUT_START:Ke,INPUT_MOVE:qe,INPUT_END:Ve,INPUT_CANCEL:di,STATE_POSSIBLE:Xi,STATE_BEGAN:Gi,STATE_CHANGED:vr,STATE_ENDED:Qi,STATE_RECOGNIZED:mi,STATE_CANCELLED:Bt,STATE_FAILED:Qe,DIRECTION_NONE:cn,DIRECTION_LEFT:Ri,DIRECTION_RIGHT:bi,DIRECTION_UP:Vn,DIRECTION_DOWN:yi,DIRECTION_HORIZONTAL:vi,DIRECTION_VERTICAL:un,DIRECTION_ALL:Di,Manager:Wr,Input:mn,TouchAction:tn,TouchInput:ft,MouseInput:ze,PointerEventInput:xt,TouchMouseInput:g,SingleTouchInput:nt,Recognizer:en,AttrRecognizer:Wn,Tap:hr,Pan:Tt,Swipe:Fr,Pinch:Ws,Rotate:Js,Press:Jn,on:$,off:zt,each:L,merge:j,extend:H,assign:U,inherit:tt,bindFn:K,prefixed:Et});var _l=typeof t<"u"?t:typeof self<"u"?self:{};_l.Hammer=Mr,e.exports?e.exports=Mr:t[n]=Mr})(window,document,"Hammer")}(yD)),yD.exports}var wg=wst();const Cst=zh(wg),ul=vU({__proto__:null,default:Cst},[wg]),_D=1,bD=2,Q2=4,Est={mousedown:_D,mousemove:bD,mouseup:Q2};function Bst(e,t){for(let i=0;i<e.length;i++)if(t(e[i]))return!0;return!1}function Tst(e){const t=e.prototype.handler;e.prototype.handler=function(i){const n=this.store;i.button>0&&i.type==="pointerdown"&&(Bst(n,r=>r.pointerId===i.pointerId)||n.push(i)),t.call(this,i)}}function Sst(e){e.prototype.handler=function(t){let i=Est[t.type];i&_D&&t.button>=0&&(this.pressed=!0),i&bD&&t.which===0&&(i=Q2),this.pressed&&(i&Q2&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}}Tst(wg.PointerEventInput),Sst(wg.MouseInput);const Ist=wg.Manager;class Ay{constructor(t,i,n){this.element=t,this.callback=i,this.options={enable:!0,...n}}}const Mst=ul?[[ul.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ul.Rotate,{enable:!1}],[ul.Pinch,{enable:!1}],[ul.Swipe,{enable:!1}],[ul.Pan,{threshold:0,enable:!1}],[ul.Press,{enable:!1}],[ul.Tap,{event:"doubletap",taps:2,enable:!1}],[ul.Tap,{event:"anytap",enable:!1}],[ul.Tap,{enable:!1}]]:null,xD={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},Pst={doubletap:["tap"]},Rst={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},K2={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},Dst={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},wD={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},Ost=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",lp=typeof window<"u"?window:global;let q2=!1;try{const e={get passive(){return q2=!0,!0}};lp.addEventListener("test",null,e),lp.removeEventListener("test",null)}catch{q2=!1}const Lst=Ost.indexOf("firefox")!==-1,{WHEEL_EVENTS:Fst}=K2,CD="wheel",ED=4.000244140625,kst=40,Nst=.25;class Ust extends Ay{constructor(t,i,n){super(t,i,n),this.handleEvent=r=>{if(!this.options.enable)return;let s=r.deltaY;lp.WheelEvent&&(Lst&&r.deltaMode===lp.WheelEvent.DOM_DELTA_PIXEL&&(s/=lp.devicePixelRatio),r.deltaMode===lp.WheelEvent.DOM_DELTA_LINE&&(s*=kst)),s!==0&&s%ED===0&&(s=Math.floor(s/ED)),r.shiftKey&&s&&(s=s*Nst),this.callback({type:CD,center:{x:r.clientX,y:r.clientY},delta:-s,srcEvent:r,pointerType:"mouse",target:r.target})},this.events=(this.options.events||[]).concat(Fst),this.events.forEach(r=>t.addEventListener(r,this.handleEvent,q2?{passive:!1}:!1))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===CD&&(this.options.enable=i)}}const{MOUSE_EVENTS:zst}=K2,BD="pointermove",TD="pointerover",SD="pointerout",ID="pointerenter",MD="pointerleave";class Gst extends Ay{constructor(t,i,n){super(t,i,n),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,this.events=(this.options.events||[]).concat(zst),this.events.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===BD&&(this.enableMoveEvent=i),t===TD&&(this.enableOverEvent=i),t===SD&&(this.enableOutEvent=i),t===ID&&(this.enableEnterEvent=i),t===MD&&(this.enableLeaveEvent=i)}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit(TD,t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit(SD,t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit(ID,t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit(MD,t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.which===0&&(this.pressed=!1),this.pressed||this._emit(BD,t);break;case"mouseup":this.pressed=!1;break}}_emit(t,i){this.callback({type:t,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})}}const{KEY_EVENTS:jst}=K2,PD="keydown",RD="keyup";class Vst extends Ay{constructor(t,i,n){super(t,i,n),this.handleEvent=r=>{const s=r.target||r.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&r.type==="keydown"&&this.callback({type:PD,srcEvent:r,key:r.key,target:r.target}),this.enableUpEvent&&r.type==="keyup"&&this.callback({type:RD,srcEvent:r,key:r.key,target:r.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(jst),t.tabIndex=this.options.tabIndex||0,t.style.outline="none",this.events.forEach(r=>t.addEventListener(r,this.handleEvent))}destroy(){this.events.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,i){t===PD&&(this.enableDownEvent=i),t===RD&&(this.enableUpEvent=i)}}const DD="contextmenu";class Hst extends Ay{constructor(t,i,n){super(t,i,n),this.handleEvent=r=>{this.options.enable&&this.callback({type:DD,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,i){t===DD&&(this.options.enable=i)}}const Z2=1,gy=2,Y2=4,Wst={pointerdown:Z2,pointermove:gy,pointerup:Y2,mousedown:Z2,mousemove:gy,mouseup:Y2},Jst=1,Xst=2,Qst=3,Kst=0,qst=1,Zst=2,Yst=1,$st=2,tat=4;function eat(e){const t=Wst[e.srcEvent.type];if(!t)return null;const{buttons:i,button:n,which:r}=e.srcEvent;let s=!1,o=!1,c=!1;return t===Y2||t===gy&&!Number.isFinite(i)?(s=r===Jst,o=r===Xst,c=r===Qst):t===gy?(s=!!(i&Yst),o=!!(i&tat),c=!!(i&$st)):t===Z2&&(s=n===Kst,o=n===qst,c=n===Zst),{leftButton:s,middleButton:o,rightButton:c}}function iat(e,t){const i=e.center;if(!i)return null;const n=t.getBoundingClientRect(),r=n.width/t.offsetWidth||1,s=n.height/t.offsetHeight||1,o={x:(i.x-n.left-t.clientLeft)/r,y:(i.y-n.top-t.clientTop)/s};return{center:i,offsetCenter:o}}const $2={srcElement:"root",priority:0};class nat{constructor(t){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let r=i.srcEvent.target;for(;r&&r!==n.rootElement;){if(this._emit(n,r),n.handled)return;r=r.parentNode}this._emit(n,"root")},this.eventManager=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,i,n,r=!1,s=!1){const{handlers:o,handlersByElement:c}=this;let h=$2;typeof n=="string"||n&&n.addEventListener?h={...$2,srcElement:n}:n&&(h={...$2,...n});let A=c.get(h.srcElement);A||(A=[],c.set(h.srcElement,A));const _={type:t,handler:i,srcElement:h.srcElement,priority:h.priority};r&&(_.once=!0),s&&(_.passive=!0),o.push(_),this._active=this._active||!_.passive;let C=A.length-1;for(;C>=0&&!(A[C].priority>=_.priority);)C--;A.splice(C+1,0,_)}remove(t,i){const{handlers:n,handlersByElement:r}=this;for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.type===t&&o.handler===i){n.splice(s,1);const c=r.get(o.srcElement);c.splice(c.indexOf(o),1),c.length===0&&r.delete(o.srcElement)}}this._active=n.some(s=>!s.passive)}_emit(t,i){const n=this.handlersByElement.get(i);if(n){let r=!1;const s=()=>{t.handled=!0},o=()=>{t.handled=!0,r=!0},c=[];for(let h=0;h<n.length;h++){const{type:A,handler:_,once:C}=n[h];if(_({...t,type:A,stopPropagation:s,stopImmediatePropagation:o}),C&&c.push(n[h]),r)break}for(let h=0;h<c.length;h++){const{type:A,handler:_}=c[h];this.remove(A,_)}}}_normalizeEvent(t){const i=this.eventManager.getElement();return{...t,...eat(t),...iat(t,i),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:i}}}const rat={events:null,recognizers:null,recognizerOptions:{},Manager:Ist,touchAction:"none",tabIndex:0};class oat{constructor(t=null,i){this._onBasicInput=r=>{const{srcEvent:s}=r,o=Rst[s.type];o&&this.manager.emit(o,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={...rat,...i},this.events=new Map,this.setElement(t);const{events:n}=this.options;n&&this.on(n)}getElement(){return this.element}setElement(t){if(this.element&&this.destroy(),this.element=t,!t)return;const{options:i}=this,n=i.Manager;this.manager=new n(t,{touchAction:i.touchAction,recognizers:i.recognizers||Mst}).on("hammer.input",this._onBasicInput),i.recognizers||Object.keys(xD).forEach(r=>{const s=this.manager.get(r);s&&xD[r].forEach(o=>{s.recognizeWith(o)})});for(const r in i.recognizerOptions){const s=this.manager.get(r);if(s){const o=i.recognizerOptions[r];delete o.enable,s.set(o)}}this.wheelInput=new Ust(t,this._onOtherEvent,{enable:!1}),this.moveInput=new Gst(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Vst(t,this._onOtherEvent,{enable:!1,tabIndex:i.tabIndex}),this.contextmenuInput=new Hst(t,this._onOtherEvent,{enable:!1});for(const[r,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(r,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(t,i,n){this._addEventHandler(t,i,n,!1)}once(t,i,n){this._addEventHandler(t,i,n,!0)}watch(t,i,n){this._addEventHandler(t,i,n,!1,!0)}off(t,i){this._removeEventHandler(t,i)}_toggleRecognizer(t,i){const{manager:n}=this;if(!n)return;const r=n.get(t);if(r&&r.options.enable!==i){r.set({enable:i});const s=Pst[t];s&&!this.options.recognizers&&s.forEach(o=>{const c=n.get(o);i?(c.requireFailure(t),r.dropRequireFailure(o)):c.dropRequireFailure(t)})}this.wheelInput.enableEventType(t,i),this.moveInput.enableEventType(t,i),this.keyInput.enableEventType(t,i),this.contextmenuInput.enableEventType(t,i)}_addEventHandler(t,i,n,r,s){if(typeof t!="string"){n=i;for(const _ in t)this._addEventHandler(_,t[_],n,r,s);return}const{manager:o,events:c}=this,h=wD[t]||t;let A=c.get(h);A||(A=new nat(this),c.set(h,A),A.recognizerName=Dst[h]||h,o&&o.on(h,A.handleEvent)),A.add(t,i,n,r,s),A.isEmpty()||this._toggleRecognizer(A.recognizerName,!0)}_removeEventHandler(t,i){if(typeof t!="string"){for(const o in t)this._removeEventHandler(o,t[o]);return}const{events:n}=this,r=wD[t]||t,s=n.get(r);if(s&&(s.remove(t,i),s.isEmpty())){const{recognizerName:o}=s;let c=!1;for(const h of n.values())if(h.recognizerName===o&&!h.isEmpty()){c=!0;break}c||this._toggleRecognizer(o,!1)}}}function OD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Ps(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?OD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):OD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var uf={transitionDuration:0},ql={transitionDuration:300,transitionEasing:function(e){return e},transitionInterpolator:new _g,transitionInterruption:xg.BREAK},my=300,yy=function(e){return 1-(1-e)*(1-e)},up={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},LD=function(){function e(){var t=this;Fu(this,e),Ci(this,"events",[]),Ci(this,"scrollZoom",!0),Ci(this,"dragPan",!0),Ci(this,"dragRotate",!0),Ci(this,"doubleClickZoom",!0),Ci(this,"touchZoom",!0),Ci(this,"touchRotate",!1),Ci(this,"keyboard",!0),Ci(this,"_interactionState",{isDragging:!1}),Ci(this,"_events",{}),Ci(this,"_setInteractionState",function(i){Object.assign(t._interactionState,i),t.onStateChange&&t.onStateChange(t._interactionState)}),Ci(this,"_onTransition",function(i,n){t.onViewportChange(i,t._interactionState,n)}),this.handleEvent=this.handleEvent.bind(this),this._transitionManager=new X2({onViewportChange:this._onTransition,onStateChange:this._setInteractionState})}return Lu(e,[{key:"handleEvent",value:function(t){this.mapState=this.getMapState();var i=this._eventStartBlocked;switch(t.type){case"panstart":return i?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return i?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"tripanstart":return i?!1:this._onTriplePanStart(t);case"tripanmove":return this._onTriplePan(t);case"tripanend":return this._onTriplePanEnd(t);case"doubletap":return this._onDoubleTap(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}},{key:"getCenter",value:function(t){var i=t.offsetCenter,n=i.x,r=i.y;return[n,r]}},{key:"isFunctionKeyPressed",value:function(t){var i=t.srcEvent;return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}},{key:"blockEvents",value:function(t){var i=this,n=setTimeout(function(){i._eventStartBlocked===n&&(i._eventStartBlocked=null)},t);this._eventStartBlocked=n}},{key:"updateViewport",value:function(t,i,n){var r=this.mapState instanceof cp?this.mapState.getViewportProps():this.mapState,s=Ps(Ps({},t.getViewportProps()),i),o=Object.keys(s).some(function(c){return r[c]!==s[c]});this._state=t.getState(),this._setInteractionState(n),o&&this.onViewportChange(s,this._interactionState,r)}},{key:"getMapState",value:function(t){return new cp(Ps(Ps(Ps({},this.mapStateProps),this._state),t))}},{key:"isDragging",value:function(){return this._interactionState.isDragging}},{key:"setOptions",value:function(t){var i=t.onViewportChange,n=t.onStateChange,r=t.eventManager,s=r===void 0?this.eventManager:r,o=t.isInteractive,c=o===void 0?!0:o,h=t.scrollZoom,A=h===void 0?this.scrollZoom:h,_=t.dragPan,C=_===void 0?this.dragPan:_,S=t.dragRotate,L=S===void 0?this.dragRotate:S,N=t.doubleClickZoom,U=N===void 0?this.doubleClickZoom:N,H=t.touchZoom,j=H===void 0?this.touchZoom:H,tt=t.touchRotate,K=tt===void 0?this.touchRotate:tt,Q=t.keyboard,pt=Q===void 0?this.keyboard:Q;this.onViewportChange=i,this.onStateChange=n;var $=this.mapStateProps||{},zt=$.height!==t.height||$.width!==t.width;this.mapStateProps=t,zt&&(this.mapState=$,this.updateViewport(new cp(t))),this._transitionManager.processViewportChange(t),this.eventManager!==s&&(this.eventManager=s,this._events={},this.toggleEvents(this.events,!0)),this.toggleEvents(up.WHEEL,c&&!!A),this.toggleEvents(up.PAN,c&&!!(C||L)),this.toggleEvents(up.PINCH,c&&!!(j||K)),this.toggleEvents(up.TRIPLE_PAN,c&&!!K),this.toggleEvents(up.DOUBLE_TAP,c&&!!U),this.toggleEvents(up.KEYBOARD,c&&!!pt),this.scrollZoom=A,this.dragPan=C,this.dragRotate=L,this.doubleClickZoom=U,this.touchZoom=j,this.touchRotate=K,this.keyboard=pt}},{key:"toggleEvents",value:function(t,i){var n=this;this.eventManager&&t.forEach(function(r){n._events[r]!==i&&(n._events[r]=i,i?n.eventManager.on(r,n.handleEvent):n.eventManager.off(r,n.handleEvent))})}},{key:"_onPanStart",value:function(t){var i=this.getCenter(t);this._panRotate=this.isFunctionKeyPressed(t)||t.rightButton;var n=this._panRotate?this.mapState.rotateStart({pos:i}):this.mapState.panStart({pos:i});return this.updateViewport(n,uf,{isDragging:!0}),!0}},{key:"_onPan",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotate(t):this._onPanMove(t):!1}},{key:"_onPanEnd",value:function(t){return this.isDragging()?this._panRotate?this._onPanRotateEnd(t):this._onPanMoveEnd(t):!1}},{key:"_onPanMove",value:function(t){if(!this.dragPan)return!1;var i=this.getCenter(t),n=this.mapState.pan({pos:i});return this.updateViewport(n,uf,{isPanning:!0}),!0}},{key:"_onPanMoveEnd",value:function(t){if(this.dragPan){var i=this.dragPan.inertia,n=i===void 0?my:i;if(n&&t.velocity){var r=this.getCenter(t),s=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],o=this.mapState.pan({pos:s}).panEnd();return this.updateViewport(o,Ps(Ps({},ql),{},{transitionDuration:n,transitionEasing:yy}),{isDragging:!1,isPanning:!0}),!0}}var c=this.mapState.panEnd();return this.updateViewport(c,null,{isDragging:!1,isPanning:!1}),!0}},{key:"_onPanRotate",value:function(t){if(!this.dragRotate)return!1;var i=this.getCenter(t),n=this.mapState.rotate({pos:i});return this.updateViewport(n,uf,{isRotating:!0}),!0}},{key:"_onPanRotateEnd",value:function(t){if(this.dragRotate){var i=this.dragRotate.inertia,n=i===void 0?my:i;if(n&&t.velocity){var r=this.getCenter(t),s=[r[0]+t.velocityX*n/2,r[1]+t.velocityY*n/2],o=this.mapState.rotate({pos:s}).rotateEnd();return this.updateViewport(o,Ps(Ps({},ql),{},{transitionDuration:n,transitionEasing:yy}),{isDragging:!1,isRotating:!0}),!0}}var c=this.mapState.panEnd();return this.updateViewport(c,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onWheel",value:function(t){if(!this.scrollZoom)return!1;var i=this.scrollZoom,n=i.speed,r=n===void 0?.01:n,s=i.smooth,o=s===void 0?!1:s;t.preventDefault();var c=this.getCenter(t),h=t.delta,A=2/(1+Math.exp(-Math.abs(h*r)));h<0&&A!==0&&(A=1/A);var _=this.mapState.zoom({pos:c,scale:A});return _.getViewportProps().zoom===this.mapStateProps.zoom?!1:(this.updateViewport(_,Ps(Ps({},ql),{},{transitionInterpolator:new _g({around:c}),transitionDuration:o?250:1}),{isPanning:!0,isZooming:!0}),!0)}},{key:"_onPinchStart",value:function(t){var i=this.getCenter(t),n=this.mapState.zoomStart({pos:i}).rotateStart({pos:i});return this._startPinchRotation=t.rotation,this._lastPinchEvent=t,this.updateViewport(n,uf,{isDragging:!0}),!0}},{key:"_onPinch",value:function(t){if(!this.isDragging()||!this.touchZoom&&!this.touchRotate)return!1;var i=this.mapState;if(this.touchZoom){var n=t.scale,r=this.getCenter(t);i=i.zoom({pos:r,scale:n})}if(this.touchRotate){var s=t.rotation;i=i.rotate({deltaAngleX:this._startPinchRotation-s})}return this.updateViewport(i,uf,{isDragging:!0,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!!this.touchRotate}),this._lastPinchEvent=t,!0}},{key:"_onPinchEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchZoom){var i=this.touchZoom.inertia,n=i===void 0?my:i,r=this._lastPinchEvent;if(n&&r&&t.scale!==r.scale){var s=this.getCenter(t),o=this.mapState.rotateEnd(),c=Math.log2(t.scale),h=(c-Math.log2(r.scale))/(t.deltaTime-r.deltaTime),A=Math.pow(2,c+h*n/2);return o=o.zoom({pos:s,scale:A}).zoomEnd(),this.updateViewport(o,Ps(Ps({},ql),{},{transitionInterpolator:new _g({around:s}),transitionDuration:n,transitionEasing:yy}),{isDragging:!1,isPanning:!!this.touchZoom,isZooming:!!this.touchZoom,isRotating:!1}),this.blockEvents(n),!0}}var _=this.mapState.zoomEnd().rotateEnd();return this._state.startPinchRotation=0,this.updateViewport(_,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1}),this._startPinchRotation=null,this._lastPinchEvent=null,!0}},{key:"_onTriplePanStart",value:function(t){var i=this.getCenter(t),n=this.mapState.rotateStart({pos:i});return this.updateViewport(n,uf,{isDragging:!0}),!0}},{key:"_onTriplePan",value:function(t){if(!this.isDragging()||!this.touchRotate)return!1;var i=this.getCenter(t);i[0]-=t.deltaX;var n=this.mapState.rotate({pos:i});return this.updateViewport(n,uf,{isRotating:!0}),!0}},{key:"_onTriplePanEnd",value:function(t){if(!this.isDragging())return!1;if(this.touchRotate){var i=this.touchRotate.inertia,n=i===void 0?my:i;if(n&&t.velocityY){var r=this.getCenter(t),s=[r[0],r[1]+=t.velocityY*n/2],o=this.mapState.rotate({pos:s});return this.updateViewport(o,Ps(Ps({},ql),{},{transitionDuration:n,transitionEasing:yy}),{isDragging:!1,isRotating:!0}),this.blockEvents(n),!1}}var c=this.mapState.rotateEnd();return this.updateViewport(c,null,{isDragging:!1,isRotating:!1}),!0}},{key:"_onDoubleTap",value:function(t){if(!this.doubleClickZoom)return!1;var i=this.getCenter(t),n=this.isFunctionKeyPressed(t),r=this.mapState.zoom({pos:i,scale:n?.5:2});return this.updateViewport(r,Object.assign({},ql,{transitionInterpolator:new _g({around:i})}),{isZooming:!0}),!0}},{key:"_onKeyDown",value:function(t){if(!this.keyboard)return!1;var i=this.isFunctionKeyPressed(t),n=this.keyboard,r=n.zoomSpeed,s=r===void 0?2:r,o=n.moveSpeed,c=o===void 0?100:o,h=n.rotateSpeedX,A=h===void 0?15:h,_=n.rotateSpeedY,C=_===void 0?10:_,S=this.mapStateProps,L;switch(t.srcEvent.keyCode){case 189:i?L=this.getMapState({zoom:S.zoom-Math.log2(s)-1}):L=this.getMapState({zoom:S.zoom-Math.log2(s)});break;case 187:i?L=this.getMapState({zoom:S.zoom+Math.log2(s)+1}):L=this.getMapState({zoom:S.zoom+Math.log2(s)});break;case 37:i?L=this.getMapState({bearing:S.bearing-A}):L=this.mapState.pan({pos:[c,0],startPos:[0,0]});break;case 39:i?L=this.getMapState({bearing:S.bearing+A}):L=this.mapState.pan({pos:[-c,0],startPos:[0,0]});break;case 38:i?L=this.getMapState({pitch:S.pitch+C}):L=this.mapState.pan({pos:[0,c],startPos:[0,0]});break;case 40:i?L=this.getMapState({pitch:S.pitch-C}):L=this.mapState.pan({pos:[0,-c],startPos:[0,0]});break;default:return!1}return this.updateViewport(L,ql)}}]),e}();function FD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Zl(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?FD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var sat=Object.assign({},Kl.propTypes,{maxZoom:Ae.number,minZoom:Ae.number,maxPitch:Ae.number,minPitch:Ae.number,onViewStateChange:Ae.func,onViewportChange:Ae.func,onInteractionStateChange:Ae.func,transitionDuration:Ae.oneOfType([Ae.number,Ae.string]),transitionInterpolator:Ae.object,transitionInterruption:Ae.number,transitionEasing:Ae.func,onTransitionStart:Ae.func,onTransitionInterrupt:Ae.func,onTransitionEnd:Ae.func,scrollZoom:Ae.oneOfType([Ae.bool,Ae.object]),dragPan:Ae.oneOfType([Ae.bool,Ae.object]),dragRotate:Ae.oneOfType([Ae.bool,Ae.object]),doubleClickZoom:Ae.bool,touchZoom:Ae.oneOfType([Ae.bool,Ae.object]),touchRotate:Ae.oneOfType([Ae.bool,Ae.object]),keyboard:Ae.oneOfType([Ae.bool,Ae.object]),onHover:Ae.func,onClick:Ae.func,onDblClick:Ae.func,onContextMenu:Ae.func,onMouseDown:Ae.func,onMouseMove:Ae.func,onMouseUp:Ae.func,onTouchStart:Ae.func,onTouchMove:Ae.func,onTouchEnd:Ae.func,onMouseEnter:Ae.func,onMouseLeave:Ae.func,onMouseOut:Ae.func,onWheel:Ae.func,touchAction:Ae.string,eventRecognizerOptions:Ae.object,clickRadius:Ae.number,interactiveLayerIds:Ae.array,getCursor:Ae.func,controller:Ae.instanceOf(LD)}),aat=function(e){var t=e.isDragging,i=e.isHovering;return t?"grabbing":i?"pointer":"grab"},cat=Object.assign({},Kl.defaultProps,cf,X2.defaultProps,{onViewStateChange:null,onViewportChange:null,onClick:null,onNativeClick:null,onHover:null,onContextMenu:function(e){return e.preventDefault()},scrollZoom:!0,dragPan:!0,dragRotate:!0,doubleClickZoom:!0,touchZoom:!0,touchRotate:!1,keyboard:!0,touchAction:"none",eventRecognizerOptions:{},clickRadius:0,getCursor:aat});function tx(e){if(e.lngLat||!e.offsetCenter)return e;var t=e.offsetCenter,i=t.x,n=t.y;if(!Number.isFinite(i)||!Number.isFinite(n))return e;var r=[i,n];return e.point=r,e.lngLat=this.viewport.unproject(r),e}function kD(e){var t=this.map;if(!t||!e)return null;var i={},n=this.props.clickRadius;this.props.interactiveLayerIds&&(i.layers=this.props.interactiveLayerIds);try{return t.queryRenderedFeatures(n?[[e[0]-n,e[1]+n],[e[0]+n,e[1]-n]]:e,i)}catch{return null}}function Yl(e,t){var i=this.props[e];i&&i(tx.call(this,t))}function lat(e){Yl.call(this,e.pointerType==="touch"?"onTouchStart":"onMouseDown",e)}function uat(e){Yl.call(this,e.pointerType==="touch"?"onTouchEnd":"onMouseUp",e)}function hat(e){if(Yl.call(this,e.pointerType==="touch"?"onTouchMove":"onMouseMove",e),!this.state.isDragging){var t=this.props,i=t.onHover,n=t.interactiveLayerIds,r;e=tx.call(this,e),(n||i)&&(r=kD.call(this,e.point));var s=!!(n&&r&&r.length>0),o=s&&!this.state.isHovering,c=!s&&this.state.isHovering;(i||o)&&(e.features=r,i&&i(e)),o&&Yl.call(this,"onMouseEnter",e),c&&Yl.call(this,"onMouseLeave",e),(o||c)&&this.setState({isHovering:s})}}function ND(e){var t=this.props,i=t.onClick,n=t.onNativeClick,r=t.onDblClick,s=t.doubleClickZoom,o=[],c=r||s;switch(e.type){case"anyclick":o.push(n),c||o.push(i);break;case"click":c&&o.push(i);break}o=o.filter(Boolean),o.length&&(e=tx.call(this,e),e.features=kD.call(this,e.point),o.forEach(function(h){return h(e)}))}function fat(e){return{getMap:e.current&&e.current.getMap,queryRenderedFeatures:e.current&&e.current.queryRenderedFeatures}}var ex=Te.forwardRef(function(e,t){var i=Te.useContext(lf),n=Te.useMemo(function(){return e.controller||new LD},[]),r=Te.useMemo(function(){return new oat(null,{touchAction:e.touchAction,recognizerOptions:e.eventRecognizerOptions})},[]),s=Te.useRef(null),o=Te.useRef(null),c=Te.useRef({width:0,height:0,state:{isHovering:!1,isDragging:!1}}),h=c.current;h.props=e,h.map=o.current&&o.current.getMap(),h.setState=function($){h.state=Zl(Zl({},h.state),$),s.current.style.cursor=e.getCursor(h.state)};var A=!0,_,C,S=function($,zt,Gt){if(A){_=[$,zt,Gt];return}var dt=h.props,lt=dt.onViewStateChange,Lt=dt.onViewportChange;lt&&lt({viewState:$,interactionState:zt,oldViewState:Gt}),Lt&&Lt($,zt,Gt)};Te.useImperativeHandle(t,function(){return fat(o)},[]);var L=Te.useMemo(function(){return Zl(Zl({},i),{},{eventManager:r,container:i.container||s.current})},[i,s.current]);L.onViewportChange=S,L.viewport=i.viewport||uD(h),h.viewport=L.viewport;var N=function($){var zt=$.isDragging,Gt=zt===void 0?!1:zt;if(Gt!==h.state.isDragging&&h.setState({isDragging:Gt}),A){C=$;return}var dt=h.props.onInteractionStateChange;dt&&dt($)},U=function(){h.width&&h.height&&n.setOptions(Zl(Zl(Zl({},h.props),h.props.viewState),{},{isInteractive:!!(h.props.onViewStateChange||h.props.onViewportChange),onViewportChange:S,onStateChange:N,eventManager:r,width:h.width,height:h.height}))},H=function($){var zt=$.width,Gt=$.height;h.width=zt,h.height=Gt,U(),h.props.onResize({width:zt,height:Gt})};Te.useEffect(function(){return r.setElement(s.current),r.on({pointerdown:lat.bind(h),pointermove:hat.bind(h),pointerup:uat.bind(h),pointerleave:Yl.bind(h,"onMouseOut"),click:ND.bind(h),anyclick:ND.bind(h),dblclick:Yl.bind(h,"onDblClick"),wheel:Yl.bind(h,"onWheel"),contextmenu:Yl.bind(h,"onContextMenu")}),function(){r.destroy()}},[]),H2(function(){_&&S.apply(void 0,aU(_)),C&&N(C)}),U();var j=e.width,tt=e.height,K=e.style,Q=e.getCursor,pt=Te.useMemo(function(){return Zl(Zl({position:"relative"},K),{},{width:j,height:tt,cursor:Q(h.state)})},[K,j,tt,Q,h.state]);return(!_||!h._child)&&(h._child=Te.createElement(V2,{value:L},Te.createElement("div",{key:"event-canvas",ref:s,style:pt},Te.createElement(Kl,AB({},e,{width:"100%",height:"100%",style:null,onResize:H,ref:o}))))),A=!1,h._child});ex.supported=Kl.supported,ex.propTypes=sat,ex.defaultProps=cat,Ae.string.isRequired;var dat=["fill","line","symbol","circle","fill-extrusion","raster","background","heatmap","hillshade"];Ae.oneOf(dat).isRequired;var th={captureScroll:!1,captureDrag:!0,captureClick:!0,captureDoubleClick:!0,capturePointerMove:!1},_c={captureScroll:Ae.bool,captureDrag:Ae.bool,captureClick:Ae.bool,captureDoubleClick:Ae.bool,capturePointerMove:Ae.bool};function pat(e){var t=e.containerRef.current,i=e.context.eventManager;if(!(!t||!i)){var n={wheel:function(r){var s=e.props;s.captureScroll&&r.stopPropagation(),s.onScroll&&s.onScroll(r,e)},panstart:function(r){var s=e.props;s.captureDrag&&r.stopPropagation(),s.onDragStart&&s.onDragStart(r,e)},anyclick:function(r){var s=e.props;s.captureClick&&r.stopPropagation(),s.onNativeClick&&s.onNativeClick(r,e)},click:function(r){var s=e.props;s.captureClick&&r.stopPropagation(),s.onClick&&s.onClick(r,e)},dblclick:function(r){var s=e.props;s.captureDoubleClick&&r.stopPropagation(),s.onDoubleClick&&s.onDoubleClick(r,e)},pointermove:function(r){var s=e.props;s.capturePointerMove&&r.stopPropagation(),s.onPointerMove&&s.onPointerMove(r,e)}};return i.watch(n,t),function(){i.off(n)}}}function eh(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Te.useContext(lf),i=Te.useRef(null),n=Te.useRef({props:e,state:{},context:t,containerRef:i}),r=n.current;return r.props=e,r.context=t,Te.useEffect(function(){return pat(r)},[t.eventManager]),r}function Aat(e){var t=gat();return function(){var i=gd(e),n;if(t){var r=gd(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return V_(this,n)}}function gat(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}function mat(e){var t=e.instance,i=eh(e),n=i.context,r=i.containerRef;return t._context=n,t._containerRef=r,t._render()}var UD=function(e){j_(i,e);var t=Aat(i);function i(){var n;Fu(this,i);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return n=t.call.apply(t,[this].concat(s)),Ci(Ou(n),"_context",{}),Ci(Ou(n),"_containerRef",Te.createRef()),Ci(Ou(n),"_onScroll",function(c){}),Ci(Ou(n),"_onDragStart",function(c){}),Ci(Ou(n),"_onDblClick",function(c){}),Ci(Ou(n),"_onClick",function(c){}),Ci(Ou(n),"_onPointerMove",function(c){}),n}return Lu(i,[{key:"_render",value:function(){throw new Error("_render() not implemented")}},{key:"render",value:function(){return Te.createElement(mat,AB({instance:this},this.props,{onScroll:this._onScroll,onDragStart:this._onDragStart,onDblClick:this._onDblClick,onClick:this._onClick,onPointerMove:this._onPointerMove}))}}]),i}(Te.PureComponent);Ci(UD,"propTypes",_c),Ci(UD,"defaultProps",th);function zD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function GD(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?zD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var yat=Object.assign({},_c,{draggable:Ae.bool,onDrag:Ae.func,onDragEnd:Ae.func,onDragStart:Ae.func,offsetLeft:Ae.number,offsetTop:Ae.number}),vat=Object.assign({},th,{draggable:!1,offsetLeft:0,offsetTop:0});function jD(e){var t=e.offsetCenter,i=t.x,n=t.y;return[i,n]}function _at(e,t){var i=e.center,n=i.x,r=i.y;if(t){var s=t.getBoundingClientRect();return[s.left-n,s.top-r]}return null}function ix(e,t,i,n){var r=e[0]+t[0]-i.offsetLeft,s=e[1]+t[1]-i.offsetTop;return n.viewport.unproject([r,s])}function bat(e,t){var i=t.props,n=t.callbacks,r=t.state,s=t.context,o=t.containerRef,c=i.draggable;if(c){e.stopPropagation();var h=jD(e),A=_at(e,o.current);if(r.setDragPos(h),r.setDragOffset(A),n.onDragStart&&A){var _=Object.assign({},e);_.lngLat=ix(h,A,i,s),n.onDragStart(_)}}}function xat(e,t){var i=t.props,n=t.callbacks,r=t.state,s=t.context;e.stopPropagation();var o=jD(e);r.setDragPos(o);var c=r.dragOffset;if(n.onDrag&&c){var h=Object.assign({},e);h.lngLat=ix(o,c,i,s),n.onDrag(h)}}function wat(e,t){var i=t.props,n=t.callbacks,r=t.state,s=t.context;e.stopPropagation();var o=r.dragPos,c=r.dragOffset;if(r.setDragPos(null),r.setDragOffset(null),n.onDragEnd&&o&&c){var h=Object.assign({},e);h.lngLat=ix(o,c,i,s),n.onDragEnd(h)}}function Cat(e,t){var i=t.state;e.stopPropagation(),i.setDragPos(null),i.setDragOffset(null)}function Eat(e){var t=e.context.eventManager;if(!(!t||!e.state.dragPos)){var i={panmove:function(n){return xat(n,e)},panend:function(n){return wat(n,e)},pancancel:function(n){return Cat(n,e)}};return t.watch(i),function(){t.off(i)}}}function Bat(e){var t=Te.useState(null),i=ho(t,2),n=i[0],r=i[1],s=Te.useState(null),o=ho(s,2),c=o[0],h=o[1],A=eh(GD(GD({},e),{},{onDragStart:bat}));return A.callbacks=e,A.state.dragPos=n,A.state.setDragPos=r,A.state.dragOffset=c,A.state.setDragOffset=h,Te.useEffect(function(){return Eat(A)},[A.context.eventManager,!!n]),A}var VD=typeof window<"u"&&window.devicePixelRatio||1,Cg=function(e){return Math.round(e*VD)/VD},HD=function(e,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"x";if(e===null)return t;var n=i==="x"?e.offsetWidth:e.offsetHeight;return Cg(t/100*n)/n*100};function WD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Tat(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?WD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):WD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var Sat=Object.assign({},yat,{className:Ae.string,longitude:Ae.number.isRequired,latitude:Ae.number.isRequired,style:Ae.object}),Iat=Object.assign({},vat,{className:""});function Mat(e){var t=e.props,i=e.state,n=e.context,r=t.longitude,s=t.latitude,o=t.offsetLeft,c=t.offsetTop,h=i.dragPos,A=i.dragOffset;if(h&&A)return[h[0]+A[0],h[1]+A[1]];var _=n.viewport.project([r,s]),C=ho(_,2),S=C[0],L=C[1];return S+=o,L+=c,[S,L]}function nx(e){var t=Bat(e),i=t.state,n=t.containerRef,r=e.children,s=e.className,o=e.draggable,c=e.style,h=i.dragPos,A=Mat(t),_=ho(A,2),C=_[0],S=_[1],L="translate(".concat(Cg(C),"px, ").concat(Cg(S),"px)"),N=o?h?"grabbing":"grab":"auto",U=Te.useMemo(function(){var j=Tat({position:"absolute",left:0,top:0,transform:L,cursor:N},c);return Te.createElement("div",{className:"mapboxgl-marker ".concat(s),ref:t.containerRef,style:j},r)},[r,s]),H=n.current;return H&&(H.style.transform=L,H.style.cursor=N),U}nx.defaultProps=Iat,nx.propTypes=Sat,Te.memo(nx);var Eg={top:{x:.5,y:0},"top-left":{x:0,y:0},"top-right":{x:1,y:0},bottom:{x:.5,y:1},"bottom-left":{x:0,y:1},"bottom-right":{x:1,y:1},left:{x:0,y:.5},right:{x:1,y:.5}},Pat=Object.keys(Eg);function Rat(e){var t=e.x,i=e.y,n=e.width,r=e.height,s=e.selfWidth,o=e.selfHeight,c=e.anchor,h=e.padding,A=h===void 0?0:h,_=Eg[c],C=_.x,S=_.y,L=i-S*o,N=L+o,U=Math.max(0,A-L)+Math.max(0,N-r+A);if(U>0){var H=S,j=U;for(S=0;S<=1;S+=.5)L=i-S*o,N=L+o,U=Math.max(0,A-L)+Math.max(0,N-r+A),U<j&&(j=U,H=S);S=H}var tt=.5;S===.5&&(C=Math.floor(C),tt=1);var K=t-C*s,Q=K+s,pt=Math.max(0,A-K)+Math.max(0,Q-n+A);if(pt>0){var $=C,zt=pt;for(C=0;C<=1;C+=tt)K=t-C*s,Q=K+s,pt=Math.max(0,A-K)+Math.max(0,Q-n+A),pt<zt&&(zt=pt,$=C);C=$}return Pat.find(function(Gt){var dt=Eg[Gt];return dt.x===C&&dt.y===S})||c}var Dat=Object.assign({},_c,{className:Ae.string,longitude:Ae.number.isRequired,latitude:Ae.number.isRequired,altitude:Ae.number,offsetLeft:Ae.number,offsetTop:Ae.number,tipSize:Ae.number,closeButton:Ae.bool,closeOnClick:Ae.bool,anchor:Ae.oneOf(Object.keys(Eg)),dynamicPosition:Ae.bool,sortByDepth:Ae.bool,onClose:Ae.func}),Oat=Object.assign({},th,{className:"",altitude:0,offsetLeft:0,offsetTop:0,tipSize:10,anchor:"bottom",dynamicPosition:!0,sortByDepth:!1,closeButton:!0,closeOnClick:!0,onClose:function(){}});function Lat(e,t,i,n){var r=ho(n,2),s=r[0],o=r[1],c=e.anchor,h=e.dynamicPosition,A=e.tipSize;return i&&h?Rat({x:s,y:o,anchor:c,padding:A,width:t.width,height:t.height,selfWidth:i.clientWidth,selfHeight:i.clientHeight}):c}function Fat(e,t,i,n,r){var s=ho(n,3),o=s[0],c=s[1],h=s[2],A=e.offsetLeft,_=e.offsetTop,C=e.sortByDepth,S=Eg[r],L=o+A,N=c+_,U=HD(i,-S.x*100),H=HD(i,-S.y*100,"y"),j={position:"absolute",transform:`
      translate(`.concat(U,"%, ").concat(H,`%)
      translate(`).concat(Cg(L),"px, ").concat(Cg(N),`px)
    `),display:void 0,zIndex:void 0};return C&&(h>1||h<-1||o<0||o>t.width||c<0||c>t.height?j.display="none":j.zIndex=Math.floor((1-h)/2*1e5)),j}function rx(e){var t=Te.useRef(null),i=eh(e),n=i.context,r=i.containerRef,s=Te.useState(!1),o=ho(s,2),c=o[1];Te.useEffect(function(){c(!0)},[t.current]),Te.useEffect(function(){if(n.eventManager&&e.closeOnClick){var Q=function(){return i.props.onClose()};return n.eventManager.on("anyclick",Q),function(){n.eventManager.off("anyclick",Q)}}},[n.eventManager,e.closeOnClick]);var h=n.viewport,A=e.className,_=e.longitude,C=e.latitude,S=e.altitude,L=e.tipSize,N=e.closeButton,U=e.children,H=h.project([_,C,S]),j=Lat(e,h,t.current,H),tt=Fat(e,h,r.current,H,j),K=Te.useCallback(function(Q){i.props.onClose();var pt=i.context.eventManager;pt&&pt.once("click",function($){return $.stopPropagation()},Q.target)},[]);return Te.createElement("div",{className:"mapboxgl-popup mapboxgl-popup-anchor-".concat(j," ").concat(A),style:tt,ref:r},Te.createElement("div",{key:"tip",className:"mapboxgl-popup-tip",style:{borderWidth:L}}),Te.createElement("div",{key:"content",ref:t,className:"mapboxgl-popup-content"},N&&Te.createElement("button",{key:"close-button",className:"mapboxgl-popup-close-button",type:"button",onClick:K},"\xD7"),U))}rx.propTypes=Dat,rx.defaultProps=Oat,Te.memo(rx);function JD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function kat(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?JD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):JD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var Nat=Object.assign({},_c,{toggleLabel:Ae.string,className:Ae.string,style:Ae.object,compact:Ae.bool,customAttribution:Ae.oneOfType([Ae.string,Ae.arrayOf(Ae.string)])}),Uat=Object.assign({},th,{className:"",toggleLabel:"Toggle Attribution"});function zat(e,t,i,n){var r=new ll.AttributionControl(e);return r._map=t,r._container=i,r._innerContainer=n,r._updateAttributions(),r._updateEditLink(),t.on("styledata",r._updateData),t.on("sourcedata",r._updateData),r}function Gat(e){e._map.off("styledata",e._updateData),e._map.off("sourcedata",e._updateData)}function ox(e){var t=eh(e),i=t.context,n=t.containerRef,r=Te.useRef(null),s=Te.useState(!1),o=ho(s,2),c=o[0],h=o[1];Te.useEffect(function(){var S;return i.map&&(S=zat({customAttribution:e.customAttribution},i.map,n.current,r.current)),function(){return S&&Gat(S)}},[i.map]);var A=e.compact===void 0?i.viewport.width<=640:e.compact;Te.useEffect(function(){!A&&c&&h(!1)},[A]);var _=Te.useCallback(function(){return h(function(S){return!S})},[]),C=Te.useMemo(function(){return kat({position:"absolute"},e.style)},[e.style]);return Te.createElement("div",{style:C,className:e.className},Te.createElement("div",{ref:n,"aria-pressed":c,className:"mapboxgl-ctrl mapboxgl-ctrl-attrib ".concat(A?"mapboxgl-compact":""," ").concat(c?"mapboxgl-compact-show":"")},Te.createElement("button",{type:"button",className:"mapboxgl-ctrl-attrib-button",title:e.toggleLabel,onClick:_}),Te.createElement("div",{ref:r,className:"mapboxgl-ctrl-attrib-inner",role:"list"})))}ox.propTypes=Nat,ox.defaultProps=Uat,Te.memo(ox);function XD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function jat(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?XD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var Vat=Object.assign({},_c,{className:Ae.string,style:Ae.object,container:Ae.object,label:Ae.string}),Hat=Object.assign({},th,{className:"",container:null,label:"Toggle fullscreen"});function sx(e){var t=eh(e),i=t.context,n=t.containerRef,r=Te.useState(!1),s=ho(r,2),o=s[0],c=s[1],h=Te.useState(!1),A=ho(h,2),_=A[0],C=A[1],S=Te.useState(null),L=ho(S,2),N=L[0],U=L[1];Te.useEffect(function(){var pt=new ll.FullscreenControl;U(pt),C(pt._checkFullscreenSupport());var $=function(){var zt=!pt._fullscreen;pt._fullscreen=zt,c(zt)};return Ql.addEventListener(pt._fullscreenchange,$),function(){Ql.removeEventListener(pt._fullscreenchange,$)}},[]);var H=function(){N&&(N._container=e.container||i.container,N._onClickFullscreen())},j=Te.useMemo(function(){return jat({position:"absolute"},e.style)},[e.style]);if(!_)return null;var tt=e.className,K=e.label,Q=o?"shrink":"fullscreen";return Te.createElement("div",{style:j,className:tt},Te.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Te.createElement("button",{key:Q,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(Q),type:"button",title:K,onClick:H},Te.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}sx.propTypes=Vat,sx.defaultProps=Hat,Te.memo(sx);var hp;function Wat(){return hp!==void 0?Promise.resolve(hp):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(function(e){return hp=e.state!=="denied",hp}):(hp=!!window.navigator.geolocation,Promise.resolve(hp))}function QD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function Jat(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?QD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):QD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var KD=function(){},Xat=Object.assign({},_c,{className:Ae.string,style:Ae.object,label:Ae.string,disabledLabel:Ae.string,auto:Ae.bool,positionOptions:Ae.object,fitBoundsOptions:Ae.object,trackUserLocation:Ae.bool,showUserLocation:Ae.bool,showAccuracyCircle:Ae.bool,showUserHeading:Ae.bool,onViewStateChange:Ae.func,onViewportChange:Ae.func,onGeolocate:Ae.func}),Qat=Object.assign({},th,{className:"",label:"Find My Location",disabledLabel:"Location Not Available",auto:!1,positionOptions:{enableHighAccuracy:!1,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0,showUserHeading:!1,showAccuracyCircle:!0,onGeolocate:function(){}});function Kat(e){var t=new ll.LngLat(e.coords.longitude,e.coords.latitude),i=e.coords.accuracy,n=t.toBounds(i);return[[n._ne.lng,n._ne.lat],[n._sw.lng,n._sw.lat]]}function qat(e,t,i){var n=new ll.GeolocateControl(t);n._container=Ql.createElement("div"),n._map={on:function(){},_getUIString:function(){return""}},n._setupUI(!0),n._map=e.map,n._geolocateButton=i;var r=e.eventManager;return n.options.trackUserLocation&&r&&r.on("panstart",function(){n._watchState==="ACTIVE_LOCK"&&(n._watchState="BACKGROUND",i.classList.add("mapboxgl-ctrl-geolocate-background"),i.classList.remove("mapboxgl-ctrl-geolocate-active"))}),n.on("geolocate",t.onGeolocate),n}function Zat(e,t){var i=t.context,n=t.props,r=Kat(e),s=i.viewport.fitBounds(r,n.fitBoundsOptions),o=s.longitude,c=s.latitude,h=s.zoom,A=Object.assign({},i.viewport,{longitude:o,latitude:c,zoom:h}),_=new cp(A),C=Object.assign({},_.getViewportProps(),ql),S=n.onViewportChange||i.onViewportChange||KD,L=n.onViewStateChange||i.onViewStateChange||KD;L({viewState:C}),S(C)}function ax(e){var t=eh(e),i=t.context,n=t.containerRef,r=Te.useRef(null),s=Te.useState(null),o=ho(s,2),c=o[0],h=o[1],A=Te.useState(!1),_=ho(A,2),C=_[0],S=_[1];Te.useEffect(function(){var K;return i.map&&Wat().then(function(Q){S(Q),r.current&&(K=qat(i,e,r.current),K._updateCamera=function(pt){return Zat(pt,t)},h(K))}),function(){K&&K._clearWatch()}},[i.map]);var L=Te.useCallback(function(){c&&(c.options=t.props,c.trigger())},[c]);Te.useEffect(function(){e.auto&&L()},[c,e.auto]),Te.useEffect(function(){c&&c._onZoom()},[i.viewport.zoom]);var N=e.className,U=e.label,H=e.disabledLabel,j=e.trackUserLocation,tt=Te.useMemo(function(){return Jat({position:"absolute"},e.style)},[e.style]);return Te.createElement("div",{style:tt,className:N},Te.createElement("div",{key:"geolocate-control",className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},Te.createElement("button",{key:"geolocate",className:"mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",ref:r,disabled:!C,"aria-pressed":!j,type:"button",title:C?U:H,"aria-label":C?U:H,onClick:L},Te.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))))}ax.propTypes=Xat,ax.defaultProps=Qat,Te.memo(ax);function Yat(e,t){for(var i=(e||"").split(".").map(Number),n=t.split(".").map(Number),r=0;r<3;r++){var s=i[r]||0,o=n[r]||0;if(s<o)return-1;if(s>o)return 1}return 0}function qD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function $at(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?qD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var ZD=function(){},tct=Object.assign({},_c,{className:Ae.string,style:Ae.object,onViewStateChange:Ae.func,onViewportChange:Ae.func,showCompass:Ae.bool,showZoom:Ae.bool,zoomInLabel:Ae.string,zoomOutLabel:Ae.string,compassLabel:Ae.string}),ect=Object.assign({},th,{className:"",showCompass:!0,showZoom:!0,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",compassLabel:"Reset North"}),ict=1,cx=2;function nct(e){return Yat(e,"1.6.0")>=0?cx:ict}function lx(e,t,i){var n=e.viewport,r=new cp(Object.assign({},n,i)),s=Object.assign({},r.getViewportProps(),ql),o=t.onViewportChange||e.onViewportChange||ZD,c=t.onViewStateChange||e.onViewStateChange||ZD;c({viewState:s}),o(s)}function ux(e,t,i,n){return Te.createElement("button",{key:e,className:"mapboxgl-ctrl-icon mapboxgl-ctrl-".concat(e),type:"button",title:t,onClick:i},n||Te.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true"}))}function rct(e){var t=Te.useMemo(function(){return e.map?nct(e.map.version):cx},[e.map]),i=e.viewport.bearing,n={transform:"rotate(".concat(-i,"deg)")};return t===cx?Te.createElement("span",{className:"mapboxgl-ctrl-icon","aria-hidden":"true",style:n}):Te.createElement("span",{className:"mapboxgl-ctrl-compass-arrow",style:n})}function hx(e){var t=eh(e),i=t.context,n=t.containerRef,r=function(){lx(i,e,{zoom:i.viewport.zoom+1})},s=function(){lx(i,e,{zoom:i.viewport.zoom-1})},o=function(){lx(i,e,{bearing:0,pitch:0})},c=e.className,h=e.showCompass,A=e.showZoom,_=e.zoomInLabel,C=e.zoomOutLabel,S=e.compassLabel,L=Te.useMemo(function(){return $at({position:"absolute"},e.style)},[e.style]);return Te.createElement("div",{style:L,className:c},Te.createElement("div",{className:"mapboxgl-ctrl mapboxgl-ctrl-group",ref:n},A&&ux("zoom-in",_,r),A&&ux("zoom-out",C,s),h&&ux("compass",S,o,rct(i))))}hx.propTypes=tct,hx.defaultProps=ect;const oct=Te.memo(hx);function YD(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),i.push.apply(i,n)}return i}function sct(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?YD(Object(i),!0).forEach(function(n){Ci(e,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):YD(Object(i)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))})}return e}var act=Object.assign({},_c,{className:Ae.string,style:Ae.object,maxWidth:Ae.number,unit:Ae.oneOf(["imperial","metric","nautical"])}),cct=Object.assign({},th,{className:"",maxWidth:100,unit:"metric"});function fx(e){var t=eh(e),i=t.context,n=t.containerRef,r=Te.useState(null),s=ho(r,2),o=s[0],c=s[1];Te.useEffect(function(){if(i.map){var A=new ll.ScaleControl;A._map=i.map,A._container=n.current,c(A)}},[i.map]),o&&(o.options=e,o._onMove&&o._onMove());var h=Te.useMemo(function(){return sct({position:"absolute"},e.style)},[e.style]);return Te.createElement("div",{style:h,className:e.className},Te.createElement("div",{ref:n,className:"mapboxgl-ctrl mapboxgl-ctrl-scale"}))}fx.propTypes=act,fx.defaultProps=cct,Te.memo(fx),Object.assign({},_c,{redraw:Ae.func.isRequired}),Object.assign({},_c,{redraw:Ae.func.isRequired,style:Ae.object}),Object.assign({},_c,{redraw:Ae.func.isRequired,style:Ae.object}),ll&&ll.setRTLTextPlugin;const lct=()=>Yc.jsx(Yc.Fragment,{}),$D=gB("div",{target:"e1az0zs51"})(({height:e})=>({position:"relative",height:e,width:"100%"}),""),uct=gB("div",{target:"e1az0zs50"})(({theme:e})=>({position:"absolute",right:"2.625rem",top:e.spacing.md,zIndex:e.zIndices.priority,".mapboxgl-ctrl.mapboxgl-ctrl-group":{overflow:"hidden",background:e.colors.bgColor},"button:not(:disabled)":{background:e.colors.bgColor,width:e.iconSizes.twoXL,height:e.iconSizes.twoXL,"& + button":{borderTopColor:e.colors.borderColor},".mapboxgl-ctrl-icon":{backgroundSize:e.iconSizes.twoXL,"&:hover":{backgroundColor:e.colors.darkenedBgMix25}},"& span":{filter:mB(e)?"":"invert(100%)"}}}),""),hct=({container:e,element:t,heightFallback:i="auto",isFullScreen:n,shouldUseContainerWidth:r,widthFallback:s="auto"})=>{const o=Te.useMemo(()=>r||n?"100%":t.width||e.width||s,[e.width,t.width,n,r,s]),c=Te.useMemo(()=>n&&e.height?e.height:t.height||e.height||i,[n,t.height,e.height,i]);return{width:o,height:c}},tO=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,fct={name:"arc",vs:tO,fs:tO,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},dct=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,pct=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,vy=[0,0,0,255],Act={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:vy},getTargetColor:{type:"accessor",value:vy},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class Bg extends Bo{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:dct,fs:pct,modules:[Fo,ua,fct]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:vy},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:vy},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:i,widthScale:n,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,wrapLongitude:c,numSegments:h}=this.props,A={numSegments:h,widthUnits:Ms[i],widthScale:n,widthMinPixels:r,widthMaxPixels:s,greatCircle:o,useShortestPath:c},_=this.state.model;_.shaderInputs.setProps({arc:A}),_.setVertexCount(h*2),_.draw(this.context.renderPass)}_getModel(){return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}Bg.layerName="ArcLayer",Bg.defaultProps=Act;const gct=new Uint32Array([0,2,1,0,3,2]),mct=new Float32Array([0,1,0,0,1,0,1,1]);function yct(e,t){if(!t)return vct(e);const i=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),r=Math.ceil(i/t)+1,s=Math.ceil(n/t)+1,o=(r-1)*(s-1)*6,c=new Uint32Array(o),h=new Float32Array(r*s*2),A=new Float64Array(r*s*3);let _=0,C=0;for(let S=0;S<r;S++){const L=S/(r-1);for(let N=0;N<s;N++){const U=N/(s-1),H=_ct(e,L,U);A[_*3+0]=H[0],A[_*3+1]=H[1],A[_*3+2]=H[2]||0,h[_*2+0]=L,h[_*2+1]=1-U,S>0&&N>0&&(c[C++]=_-s,c[C++]=_-s-1,c[C++]=_-1,c[C++]=_-s,c[C++]=_-1,c[C++]=_),_++}}return{vertexCount:o,positions:A,indices:c,texCoords:h}}function vct(e){const t=new Float64Array(12);for(let i=0;i<e.length;i++)t[i*3+0]=e[i][0],t[i*3+1]=e[i][1],t[i*3+2]=e[i][2]||0;return{vertexCount:6,positions:t,indices:gct,texCoords:mct}}function _ct(e,t,i){return hc(hc(e[0],e[1],i),hc(e[3],e[2],i),t)}const eO=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,bct={name:"bitmap",vs:eO,fs:eO,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}},xct=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`,wct=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,Cct=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${wct}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`,Ect={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:$i.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}};class _y extends Bo{getShaders(){return super.getShaders({vs:xct,fs:Cct,modules:[Fo,ua,bct]})}initializeState(){const t=this.getAttributeManager();t.remove(["instancePickingColors"]);const i=!0;t.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:i},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:i},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:i}})}updateState({props:t,oldProps:i,changeFlags:n}){const r=this.getAttributeManager();if(n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll()),t.bounds!==i.bounds){const s=this.state.mesh,o=this._createMesh();this.state.model.setVertexCount(o.vertexCount);for(const c in o)s&&s[c]!==o[c]&&r.invalidate(c);this.setState({mesh:o,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==i._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){const{image:i}=this.props,n=t.info;if(!n.color||!i)return n.bitmap=null,n;const{width:r,height:s}=i;n.index=0;const o=Bct(n.color);return n.bitmap={size:{width:r,height:s},uv:o,pixel:[Math.floor(o[0]*r),Math.floor(o[1]*s)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){const{bounds:t}=this.props;let i=t;return iO(t)&&(i=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),yct(i,this.context.viewport.resolution)}_getModel(){return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(t){const{shaderModuleProps:i}=t,{model:n,coordinateConversion:r,bounds:s,disablePicking:o}=this.state,{image:c,desaturate:h,transparentColor:A,tintColor:_}=this.props;if(!(i.picking.isActive&&o)&&c&&n){const C={bitmapTexture:c,bounds:s,coordinateConversion:r,desaturate:h,tintColor:_.slice(0,3).map(S=>S/255),transparentColor:A.map(S=>S/255)};n.shaderInputs.setProps({bitmap:C}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){const{LNGLAT:t,CARTESIAN:i,DEFAULT:n}=$i;let{_imageCoordinateSystem:r}=this.props;if(r!==n){const{bounds:s}=this.props;if(!iO(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");const o=this.context.viewport.resolution?t:i;if(r=r===t?t:i,r===t&&o===i)return{coordinateConversion:-1,bounds:s};if(r===i&&o===t){const c=Xl([s[0],s[1]]),h=Xl([s[2],s[3]]);return{coordinateConversion:1,bounds:[c[0],c[1],h[0],h[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}_y.layerName="BitmapLayer",_y.defaultProps=Ect;function Bct(e){const[t,i,n]=e,r=(n&240)/256,s=(n&15)/16;return[(t+s)/256,(i+r)/256]}function iO(e){return Number.isFinite(e[0])}const nO=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,Tct={name:"icon",vs:nO,fs:nO,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},Sct=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,Ict=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mct=1024,Pct=4,rO=()=>{},oO={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Rct={x:0,y:0,width:0,height:0};function Dct(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Oct(e,t,i,n){const r=Math.min(i/t.width,n/t.height),s=Math.floor(t.width*r),o=Math.floor(t.height*r);return r===1?{image:t,width:s,height:o}:(e.canvas.height=o,e.canvas.width=s,e.clearRect(0,0,s,o),e.drawImage(t,0,0,t.width,t.height,0,0,s,o),{image:e.canvas,width:s,height:o})}function Tg(e){return e&&(e.id||e.url)}function Lct(e,t,i,n){const{width:r,height:s,device:o}=e,c=o.createTexture({format:"rgba8unorm",width:t,height:i,sampler:n,mipmaps:!0}),h=o.createCommandEncoder();return h.copyTextureToTexture({sourceTexture:e,destinationTexture:c,width:r,height:s}),h.finish(),e.destroy(),c}function sO(e,t,i){for(let n=0;n<t.length;n++){const{icon:r,xOffset:s}=t[n],o=Tg(r);e[o]={...r,x:s,y:i}}}function Fct({icons:e,buffer:t,mapping:i={},xOffset:n=0,yOffset:r=0,rowHeight:s=0,canvasWidth:o}){let c=[];for(let h=0;h<e.length;h++){const A=e[h],_=Tg(A);if(!i[_]){const{height:C,width:S}=A;n+S+t>o&&(sO(i,c,r),n=0,r=s+r+t,s=0,c=[]),c.push({icon:A,xOffset:n}),n=n+S+t,s=Math.max(s,C)}}return c.length>0&&sO(i,c,r),{mapping:i,rowHeight:s,xOffset:n,yOffset:r,canvasWidth:o,canvasHeight:Dct(s+r+t)}}function kct(e,t,i){if(!e||!t)return null;i=i||{};const n={},{iterable:r,objectInfo:s}=sl(e);for(const o of r){s.index++;const c=t(o,s),h=Tg(c);if(!c)throw new Error("Icon is missing.");if(!c.url)throw new Error("Icon url is missing.");!n[h]&&(!i[h]||c.url!==i[h].url)&&(n[h]={...c,source:o,sourceIndex:s.index})}return n}class Nct{constructor(t,{onUpdate:i=rO,onError:n=rO}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=Pct,this._canvasWidth=Mct,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=i,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){const i=this._autoPacking?Tg(t):t;return this._mapping[i]||Rct}setProps({loadOptions:t,autoPacking:i,iconAtlas:n,iconMapping:r,textureParameters:s}){t&&(this._loadOptions=t),i!==void 0&&(this._autoPacking=i),r&&(this._mapping=r),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(t,i){if(!this._autoPacking||typeof document>"u")return;const n=Object.values(kct(t,i,this._mapping)||{});if(n.length>0){const{mapping:r,xOffset:s,yOffset:o,rowHeight:c,canvasHeight:h}=Fct({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=c,this._mapping=r,this._xOffset=s,this._yOffset=o,this._canvasHeight=h,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||oO,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=Lct(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||oO)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(t){const i=this._canvas.getContext("2d",{willReadFrequently:!0});for(const n of t)this._pendingCount++,tp(n.url,this._loadOptions).then(r=>{const s=Tg(n),o=this._mapping[s],{x:c,y:h,width:A,height:_}=o,{image:C,width:S,height:L}=Oct(i,r,A,_);this._texture?.copyExternalImage({image:C,x:c+(A-S)/2,y:h+(_-L)/2,width:S,height:L}),o.width=S,o.height=L,this._texture.generateMipmap(),this.onUpdate()}).catch(r=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:r})}).finally(()=>{this._pendingCount--})}}const aO=[0,0,0,255],Uct={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:aO},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class fp extends Bo{getShaders(){return super.getShaders({vs:Sct,fs:Ict,modules:[Fo,ua,Tct]})}initializeState(){this.state={iconManager:new Nct(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:aO},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);const{props:i,oldProps:n,changeFlags:r}=t,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:c,data:h,getIcon:A,textureParameters:_}=i,{iconManager:C}=this.state;if(typeof o=="string")return;const S=o||this.internalState.isAsyncPropLoading("iconAtlas");C.setProps({loadOptions:i.loadOptions,autoPacking:!S,iconAtlas:o,iconMapping:S?c:null,textureParameters:_}),S?n.iconMapping!==i.iconMapping&&s.invalidate("getIcon"):(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getIcon))&&C.packIcons(h,A),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){const{sizeScale:i,sizeMinPixels:n,sizeMaxPixels:r,sizeUnits:s,billboard:o,alphaCutoff:c}=this.props,{iconManager:h}=this.state,A=h.getTexture();if(A){const _=this.state.model,C={iconsTexture:A,iconsTextureDim:[A.width,A.height],sizeUnits:Ms[s],sizeScale:i,sizeMinPixels:n,sizeMaxPixels:r,billboard:o,alphaCutoff:c};_.shaderInputs.setProps({icon:C}),_.draw(this.context.renderPass)}}_getModel(){const t=[-1,-1,1,-1,-1,1,1,1];return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Yo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){const i=this.getCurrentLayer()?.props.onIconError;i?i(t):Zi.error(t.error.message)()}getInstanceOffset(t){const{width:i,height:n,anchorX:r=i/2,anchorY:s=n/2}=this.state.iconManager.getIconMapping(t);return[i/2-r,n/2-s]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){const{x:i,y:n,width:r,height:s}=this.state.iconManager.getIconMapping(t);return[i,n,r,s]}}fp.defaultProps=Uct,fp.layerName="IconLayer";const zct=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,cO=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,Gct={name:"line",source:zct,vs:cO,fs:cO,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},jct=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90\xB0: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,Vct=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Hct=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Wct=[0,0,0,255],Jct={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:Wct},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class by extends Bo{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:Vct,fs:Hct,source:jct,modules:[Fo,ua,Gct]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{widthUnits:i,widthScale:n,widthMinPixels:r,widthMaxPixels:s,wrapLongitude:o}=this.props,c=this.state.model,h={widthUnits:Ms[i],widthScale:n,widthMinPixels:r,widthMaxPixels:s,useShortestPath:o?1:0};c.shaderInputs.setProps({line:h}),c.draw(this.context.renderPass),o&&(c.shaderInputs.setProps({line:{...h,useShortestPath:-1}}),c.draw(this.context.renderPass))}_getModel(){const t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Yo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}by.layerName="LineLayer",by.defaultProps=Jct;const lO=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,Xct={name:"pointCloud",vs:lO,fs:lO,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},Qct=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Kct=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,uO=[0,0,0,255],hO=[0,0,1],qct={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:hO},getColor:{type:"accessor",value:uO},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Zct(e){const{header:t,attributes:i}=e;if(!(!t||!i)&&(e.length=t.vertexCount,i.POSITION&&(i.instancePositions=i.POSITION),i.NORMAL&&(i.instanceNormals=i.NORMAL),i.COLOR_0)){const{size:n,value:r}=i.COLOR_0;i.instanceColors={size:n,type:"unorm8",value:r}}}class Sg extends Bo{getShaders(){return super.getShaders({vs:Qct,fs:Kct,modules:[Fo,x0,ua,Xct]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:hO},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:uO}})}updateState(t){const{changeFlags:i,props:n}=t;super.updateState(t),i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),i.dataChanged&&Zct(n.data)}draw({uniforms:t}){const{pointSize:i,sizeUnits:n}=this.props,r=this.state.model,s={sizeUnits:Ms[n],radiusPixels:i};r.shaderInputs.setProps({pointCloud:s}),r.draw(this.context.renderPass)}_getModel(){const t=[];for(let i=0;i<3;i++){const n=i/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Yo({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}}Sg.layerName="PointCloudLayer",Sg.defaultProps=qct;const fO=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Yct={name:"scatterplot",vs:fO,fs:fO,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},$ct=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,tlt=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,elt=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,dO=[0,0,0,255],ilt={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:dO},getLineColor:{type:"accessor",value:dO},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Ig extends Bo{getShaders(){return super.getShaders({vs:$ct,fs:tlt,source:elt,modules:[Fo,ua,Yct]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{radiusUnits:i,radiusScale:n,radiusMinPixels:r,radiusMaxPixels:s,stroked:o,filled:c,billboard:h,antialiasing:A,lineWidthUnits:_,lineWidthScale:C,lineWidthMinPixels:S,lineWidthMaxPixels:L}=this.props,N={stroked:o,filled:c,billboard:h,antialiasing:A,radiusUnits:Ms[i],radiusScale:n,radiusMinPixels:r,radiusMaxPixels:s,lineWidthUnits:Ms[_],lineWidthScale:C,lineWidthMinPixels:S,lineWidthMaxPixels:L},U=this.state.model;U.shaderInputs.setProps({scatterplot:N}),U.draw(this.context.renderPass)}_getModel(){const t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Yo({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}}Ig.defaultProps=ilt,Ig.layerName="ScatterplotLayer";const dx={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function px(e,t,i={}){return nlt(e,i)!==t?(olt(e,i),!0):!1}function nlt(e,t={}){return Math.sign(rlt(e,t))}const pO={x:0,y:1,z:2};function rlt(e,t={}){const{start:i=0,end:n=e.length,plane:r="xy"}=t,s=t.size||2;let o=0;const c=pO[r[0]],h=pO[r[1]];for(let A=i,_=n-s;A<n;A+=s)o+=(e[A+c]-e[_+c])*(e[A+h]+e[_+h]),_=A;return o/2}function olt(e,t){const{start:i=0,end:n=e.length,size:r=2}=t,s=(n-i)/r,o=Math.floor(s/2);for(let c=0;c<o;++c){const h=i+c*r,A=i+(s-1-c)*r;for(let _=0;_<r;++_){const C=e[h+_];e[h+_]=e[A+_],e[A+_]=C}}}function bc(e,t){const i=t.length,n=e.length;if(n>0){let r=!0;for(let s=0;s<i;s++)if(e[n-i+s]!==t[s]){r=!1;break}if(r)return!1}for(let r=0;r<i;r++)e[n+r]=t[r];return!0}function Ax(e,t){const i=t.length;for(let n=0;n<i;n++)e[n]=t[n]}function Mg(e,t,i,n,r=[]){const s=n+t*i;for(let o=0;o<i;o++)r[o]=e[s+o];return r}function gx(e,t,i,n,r=[]){let s,o;if(i&8)s=(n[3]-e[1])/(t[1]-e[1]),o=3;else if(i&4)s=(n[1]-e[1])/(t[1]-e[1]),o=1;else if(i&2)s=(n[2]-e[0])/(t[0]-e[0]),o=2;else if(i&1)s=(n[0]-e[0])/(t[0]-e[0]),o=0;else return null;for(let c=0;c<e.length;c++)r[c]=(o&1)===c?n[o]:s*(t[c]-e[c])+e[c];return r}function xy(e,t){let i=0;return e[0]<t[0]?i|=1:e[0]>t[2]&&(i|=2),e[1]<t[1]?i|=4:e[1]>t[3]&&(i|=8),i}function AO(e,t){const{size:i=2,broken:n=!1,gridResolution:r=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:c=e.length}=t||{},h=(c-o)/i;let A=[];const _=[A],C=Mg(e,0,i,o);let S,L;const N=vO(C,r,s,[]),U=[];bc(A,C);for(let H=1;H<h;H++){for(S=Mg(e,H,i,o,S),L=xy(S,N);L;){gx(C,S,L,N,U);const j=xy(U,N);j&&(gx(C,U,j,N,U),L=j),bc(A,U),Ax(C,U),alt(N,r,L),n&&A.length>i&&(A=[],_.push(A),bc(A,C)),L=xy(S,N)}bc(A,S),Ax(C,S)}return n?_:_[0]}const gO=0,slt=1;function mO(e,t=null,i){if(!e.length)return[];const{size:n=2,gridResolution:r=10,gridOffset:s=[0,0],edgeTypes:o=!1}=i||{},c=[],h=[{pos:e,types:o?new Array(e.length/n).fill(slt):null,holes:t||[]}],A=[[],[]];let _=[];for(;h.length;){const{pos:C,types:S,holes:L}=h.shift();clt(C,n,L[0]||C.length,A),_=vO(A[0],r,s,_);const N=xy(A[1],_);if(N){let U=yO(C,S,n,0,L[0]||C.length,_,N);const H={pos:U[0].pos,types:U[0].types,holes:[]},j={pos:U[1].pos,types:U[1].types,holes:[]};h.push(H,j);for(let tt=0;tt<L.length;tt++)U=yO(C,S,n,L[tt],L[tt+1]||C.length,_,N),U[0]&&(H.holes.push(H.pos.length),H.pos=wy(H.pos,U[0].pos),o&&(H.types=wy(H.types,U[0].types))),U[1]&&(j.holes.push(j.pos.length),j.pos=wy(j.pos,U[1].pos),o&&(j.types=wy(j.types,U[1].types)))}else{const U={positions:C};o&&(U.edgeTypes=S),L.length&&(U.holeIndices=L),c.push(U)}}return c}function yO(e,t,i,n,r,s,o){const c=(r-n)/i,h=[],A=[],_=[],C=[],S=[];let L,N,U;const H=Mg(e,c-1,i,n);let j=Math.sign(o&8?H[1]-s[3]:H[0]-s[2]),tt=t&&t[c-1],K=0,Q=0;for(let pt=0;pt<c;pt++)L=Mg(e,pt,i,n,L),N=Math.sign(o&8?L[1]-s[3]:L[0]-s[2]),U=t&&t[n/i+pt],N&&j&&j!==N&&(gx(H,L,o,s,S),bc(h,S)&&_.push(tt),bc(A,S)&&C.push(tt)),N<=0?(bc(h,L)&&_.push(U),K-=N):_.length&&(_[_.length-1]=gO),N>=0?(bc(A,L)&&C.push(U),Q+=N):C.length&&(C[C.length-1]=gO),Ax(H,L),j=N,tt=U;return[K?{pos:h,types:t&&_}:null,Q?{pos:A,types:t&&C}:null]}function vO(e,t,i,n){const r=Math.floor((e[0]-i[0])/t)*t+i[0],s=Math.floor((e[1]-i[1])/t)*t+i[1];return n[0]=r,n[1]=s,n[2]=r+t,n[3]=s+t,n}function alt(e,t,i){i&8?(e[1]+=t,e[3]+=t):i&4?(e[1]-=t,e[3]-=t):i&2?(e[0]+=t,e[2]+=t):i&1&&(e[0]-=t,e[2]-=t)}function clt(e,t,i,n){let r=1/0,s=-1/0,o=1/0,c=-1/0;for(let h=0;h<i;h+=t){const A=e[h],_=e[h+1];r=A<r?A:r,s=A>s?A:s,o=_<o?_:o,c=_>c?_:c}return n[0][0]=r,n[0][1]=o,n[1][0]=s,n[1][1]=c,n}function wy(e,t){for(let i=0;i<t.length;i++)e.push(t[i]);return e}const llt=85.051129;function ult(e,t){const{size:i=2,startIndex:n=0,endIndex:r=e.length,normalize:s=!0}=t||{},o=e.slice(n,r);_O(o,i,0,r-n);const c=AO(o,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const h of c)bO(h,i);return c}function hlt(e,t=null,i){const{size:n=2,normalize:r=!0,edgeTypes:s=!1}=i||{};t=t||[];const o=[],c=[];let h=0,A=0;for(let C=0;C<=t.length;C++){const S=t[C]||e.length,L=A,N=flt(e,n,h,S);for(let U=N;U<S;U++)o[A++]=e[U];for(let U=h;U<N;U++)o[A++]=e[U];_O(o,n,L,A),dlt(o,n,L,A,i?.maxLatitude),h=S,c[C]=A}c.pop();const _=mO(o,c,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(r)for(const C of _)bO(C.positions,n);return _}function flt(e,t,i,n){let r=-1,s=-1;for(let o=i+1;o<n;o+=t){const c=Math.abs(e[o]);c>r&&(r=c,s=o-1)}return s}function dlt(e,t,i,n,r=llt){const s=e[i],o=e[n-t];if(Math.abs(s-o)>180){const c=Mg(e,0,t,i);c[0]+=Math.round((o-s)/360)*360,bc(e,c),c[1]=Math.sign(c[1])*r,bc(e,c),c[0]=s,bc(e,c)}}function _O(e,t,i,n){let r=e[0],s;for(let o=i;o<n;o+=t){s=e[o];const c=s-r;(c>180||c<-180)&&(s-=Math.round(c/360)*360),e[o]=r=s}}function bO(e,t){let i;const n=e.length/t;for(let s=0;s<n&&(i=e[s*t],(i+180)%360===0);s++);const r=-Math.round(i/360)*360;if(r!==0)for(let s=0;s<n;s++)e[s*t]+=r}class plt extends Yo{constructor(t){const{indices:i,attributes:n}=Alt(t);super({...t,indices:i,attributes:n})}}function Alt(e){const{radius:t,height:i=1,nradial:n=10}=e;let{vertices:r}=e;r&&(Zi.assert(r.length>=n),r=r.flatMap(L=>[L[0],L[1]]),px(r,dx.COUNTER_CLOCKWISE));const s=i>0,o=n+1,c=s?o*3+1:n,h=Math.PI*2/n,A=new Uint16Array(s?n*3*2:0),_=new Float32Array(c*3),C=new Float32Array(c*3);let S=0;if(s){for(let L=0;L<o;L++){const N=L*h,U=L%n,H=Math.sin(N),j=Math.cos(N);for(let tt=0;tt<2;tt++)_[S+0]=r?r[U*2]:j*t,_[S+1]=r?r[U*2+1]:H*t,_[S+2]=(1/2-tt)*i,C[S+0]=r?r[U*2]:j,C[S+1]=r?r[U*2+1]:H,S+=3}_[S+0]=_[S-3],_[S+1]=_[S-2],_[S+2]=_[S-1],S+=3}for(let L=s?0:1;L<o;L++){const N=Math.floor(L/2)*Math.sign(.5-L%2),U=N*h,H=(N+n)%n,j=Math.sin(U),tt=Math.cos(U);_[S+0]=r?r[H*2]:tt*t,_[S+1]=r?r[H*2+1]:j*t,_[S+2]=i/2,C[S+2]=1,S+=3}if(s){let L=0;for(let N=0;N<n;N++)A[L++]=N*2+0,A[L++]=N*2+2,A[L++]=N*2+0,A[L++]=N*2+1,A[L++]=N*2+1,A[L++]=N*2+3}return{indices:A,attributes:{POSITION:{size:3,value:_},NORMAL:{size:3,value:C}}}}const xO=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,glt={name:"column",vs:xO,fs:xO,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},mlt=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ylt=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Cy=[0,0,0,255],vlt={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:Cy},getLineColor:{type:"accessor",value:Cy},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class hl extends Bo{getShaders(){const t={},{flatShading:i}=this.props;return i&&(t.FLAT_SHADING=1),super.getShaders({vs:mlt,fs:ylt,defines:t,modules:[Fo,i?$1:x0,ua,glt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Cy},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Cy},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(t){super.updateState(t);const{props:i,oldProps:n,changeFlags:r}=t,s=r.extensionsChanged||i.flatShading!==n.flatShading;s&&(this.state.models?.forEach(c=>c.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(s||i.diskResolution!==n.diskResolution||i.vertices!==n.vertices||(i.extruded||i.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(i)}getGeometry(t,i,n){const r=new plt({radius:1,height:n?2:0,vertices:i,nradial:t});let s=0;if(i)for(let o=0;o<t;o++){const c=i[o],h=Math.sqrt(c[0]*c[0]+c[1]*c[1]);s+=h/t}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*s}),r}_getModels(){const t=this.getShaders(),i=this.getAttributeManager().getBufferLayouts(),n=new Lr(this.context.device,{...t,id:`${this.props.id}-fill`,bufferLayout:i,isInstanced:!0}),r=new Lr(this.context.device,{...t,id:`${this.props.id}-wireframe`,bufferLayout:i,isInstanced:!0});return{fillModel:n,wireframeModel:r,models:[r,n]}}_updateGeometry({diskResolution:t,vertices:i,extruded:n,stroked:r}){const s=this.getGeometry(t,i,n||r);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});const o=this.state.fillModel,c=this.state.wireframeModel;o.setGeometry(s),o.setTopology("triangle-strip"),o.setIndexBuffer(null),c.setGeometry(s),c.setTopology("line-list")}draw({uniforms:t}){const{lineWidthUnits:i,lineWidthScale:n,lineWidthMinPixels:r,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:c,extruded:h,filled:A,stroked:_,wireframe:C,offset:S,coverage:L,radius:N,angle:U}=this.props,H=this.state.fillModel,j=this.state.wireframeModel,{fillVertexCount:tt,edgeDistance:K}=this.state,Q={radius:N,angle:U/180*Math.PI,offset:S,extruded:h,stroked:_,coverage:L,elevationScale:c,edgeDistance:K,radiusUnits:Ms[o],widthUnits:Ms[i],widthScale:n,widthMinPixels:r,widthMaxPixels:s};h&&C&&(j.shaderInputs.setProps({column:{...Q,isStroke:!0}}),j.draw(this.context.renderPass)),A&&(H.setVertexCount(tt),H.shaderInputs.setProps({column:{...Q,isStroke:!1}}),H.draw(this.context.renderPass)),!h&&_&&(H.setVertexCount(tt*2/3),H.shaderInputs.setProps({column:{...Q,isStroke:!0}}),H.draw(this.context.renderPass))}}hl.layerName="ColumnLayer",hl.defaultProps=vlt;const _lt={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}};let mx=class extends hl{_updateGeometry(){const e=new SM;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){const{elevationScale:t,extruded:i,offset:n,coverage:r,cellSize:s,angle:o,radiusUnits:c}=this.props,h=this.state.fillModel,A={radius:s/2,radiusUnits:Ms[c],angle:o,offset:n,extruded:i,stroked:!1,coverage:r,elevationScale:t,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};h.shaderInputs.setProps({column:A}),h.draw(this.context.renderPass)}};mx.layerName="GridCellLayer",mx.defaultProps=_lt;function blt(e,t,i,n){let r;if(Array.isArray(e[0])){const s=e.length*t;r=new Array(s);for(let o=0;o<e.length;o++)for(let c=0;c<t;c++)r[o*t+c]=e[o][c]||0}else r=e;return i?AO(r,{size:t,gridResolution:i}):n?ult(r,{size:t}):r}const xlt=1,wlt=2,yx=4;class Clt extends jP{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?blt(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(wO(t)){let n=0;for(const r of t)n+=this.getGeometrySize(r);return n}const i=this.getPathLength(t);return i<2?0:this.isClosed(t)?i<3?0:i+2:i}updateGeometryAttributes(t,i){if(i.geometrySize!==0)if(t&&wO(t))for(const n of t){const r=this.getGeometrySize(n);i.geometrySize=r,this.updateGeometryAttributes(n,i),i.vertexStart+=r}else this._updateSegmentTypes(t,i),this._updatePositions(t,i)}_updateSegmentTypes(t,i){const n=this.attributes.segmentTypes,r=t?this.isClosed(t):!1,{vertexStart:s,geometrySize:o}=i;n.fill(0,s,s+o),r?(n[s]=yx,n[s+o-2]=yx):(n[s]+=xlt,n[s+o-2]+=wlt),n[s+o-1]=yx}_updatePositions(t,i){const{positions:n}=this.attributes;if(!n||!t)return;const{vertexStart:r,geometrySize:s}=i,o=new Array(3);for(let c=r,h=0;h<s;c++,h++)this.getPointOnPath(t,h,o),n[c*3]=o[0],n[c*3+1]=o[1],n[c*3+2]=o[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,i,n=[]){const{positionSize:r}=this;i*r>=t.length&&(i+=1-t.length/r);const s=i*r;return n[0]=t[s],n[1]=t[s+1],n[2]=r===3&&t[s+2]||0,n}isClosed(t){if(!this.normalize)return!!this.opts.loop;const{positionSize:i}=this,n=t.length-i;return t[0]===t[n]&&t[1]===t[n+1]&&(i===2||t[2]===t[n+2])}}function wO(e){return Array.isArray(e[0])}const CO=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,Elt={name:"path",vs:CO,fs:CO,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Blt=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Tlt=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,EO=[0,0,0,255],Slt={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:EO},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},vx={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class ih extends Bo{getShaders(){return super.getShaders({vs:Blt,fs:Tlt,modules:[Fo,ua,Elt]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:vx,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:vx,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:vx,defaultValue:EO},instancePickingColors:{size:4,type:"uint8",accessor:(t,{index:i,target:n})=>this.encodePickingColor(t&&t.__source?t.__source.index:i,n)}}),this.setState({pathTesselator:new Clt({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);const{props:i,changeFlags:n}=t,r=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){const{pathTesselator:s}=this.state,o=i.data.attributes||{};s.updateGeometry({data:i.data,geometryBuffer:o.getPath,buffers:o,normalize:!i._pathType,loop:i._pathType==="loop",getGeometry:i.getPath,positionFormat:i.positionFormat,wrapLongitude:i.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),n.dataChanged||r.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),r.invalidateAll())}getPickingInfo(t){const i=super.getPickingInfo(t),{index:n}=i,r=this.props.data;return r[0]&&r[0].__source&&(i.object=r.find(s=>s.__source.index===n)),i}disablePickingIndex(t){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{jointRounded:i,capRounded:n,billboard:r,miterLimit:s,widthUnits:o,widthScale:c,widthMinPixels:h,widthMaxPixels:A}=this.props,_=this.state.model,C={jointType:Number(i),capType:Number(n),billboard:r,widthUnits:Ms[o],widthScale:c,miterLimit:s,widthMinPixels:h,widthMaxPixels:A};_.shaderInputs.setProps({path:C}),_.draw(this.context.renderPass)}_getModel(){const t=[0,1,2,1,4,2,1,3,4,3,5,4],i=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Yo({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(i),size:2}}}),isInstanced:!0})}calculatePositions(t){const{pathTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("positions")}calculateSegmentTypes(t){const{pathTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("segmentTypes")}}ih.defaultProps=Slt,ih.layerName="PathLayer";var Ey={exports:{}},BO;function Ilt(){if(BO)return Ey.exports;BO=1,Ey.exports=e,Ey.exports.default=e;function e(Ct,Rt,Nt){Nt=Nt||2;var Zt=Rt&&Rt.length,re=Zt?Rt[0]*Nt:Ct.length,se=t(Ct,0,re,Nt,!0),de=[];if(!se||se.next===se.prev)return de;var Me,Se,oe,Ai,Ke,qe,Ve;if(Zt&&(se=h(Ct,Rt,se,Nt)),Ct.length>80*Nt){Me=oe=Ct[0],Se=Ai=Ct[1];for(var di=Nt;di<re;di+=Nt)Ke=Ct[di],qe=Ct[di+1],Ke<Me&&(Me=Ke),qe<Se&&(Se=qe),Ke>oe&&(oe=Ke),qe>Ai&&(Ai=qe);Ve=Math.max(oe-Me,Ai-Se),Ve=Ve!==0?32767/Ve:0}return n(se,de,Nt,Me,Se,Ve,0),de}function t(Ct,Rt,Nt,Zt,re){var se,de;if(re===le(Ct,Rt,Nt,Zt)>0)for(se=Rt;se<Nt;se+=Zt)de=J(se,Ct[se],Ct[se+1],de);else for(se=Nt-Zt;se>=Rt;se-=Zt)de=J(se,Ct[se],Ct[se+1],de);return de&&Q(de,de.next)&&(ut(de),de=de.next),de}function i(Ct,Rt){if(!Ct)return Ct;Rt||(Rt=Ct);var Nt=Ct,Zt;do if(Zt=!1,!Nt.steiner&&(Q(Nt,Nt.next)||K(Nt.prev,Nt,Nt.next)===0)){if(ut(Nt),Nt=Rt=Nt.prev,Nt===Nt.next)break;Zt=!0}else Nt=Nt.next;while(Zt||Nt!==Rt);return Rt}function n(Ct,Rt,Nt,Zt,re,se,de){if(Ct){!de&&se&&L(Ct,Zt,re,se);for(var Me=Ct,Se,oe;Ct.prev!==Ct.next;){if(Se=Ct.prev,oe=Ct.next,se?s(Ct,Zt,re,se):r(Ct)){Rt.push(Se.i/Nt|0),Rt.push(Ct.i/Nt|0),Rt.push(oe.i/Nt|0),ut(Ct),Ct=oe.next,Me=oe.next;continue}if(Ct=oe,Ct===Me){de?de===1?(Ct=o(i(Ct),Rt,Nt),n(Ct,Rt,Nt,Zt,re,se,2)):de===2&&c(Ct,Rt,Nt,Zt,re,se):n(i(Ct),Rt,Nt,Zt,re,se,1);break}}}}function r(Ct){var Rt=Ct.prev,Nt=Ct,Zt=Ct.next;if(K(Rt,Nt,Zt)>=0)return!1;for(var re=Rt.x,se=Nt.x,de=Zt.x,Me=Rt.y,Se=Nt.y,oe=Zt.y,Ai=re<se?re<de?re:de:se<de?se:de,Ke=Me<Se?Me<oe?Me:oe:Se<oe?Se:oe,qe=re>se?re>de?re:de:se>de?se:de,Ve=Me>Se?Me>oe?Me:oe:Se>oe?Se:oe,di=Zt.next;di!==Rt;){if(di.x>=Ai&&di.x<=qe&&di.y>=Ke&&di.y<=Ve&&j(re,Me,se,Se,de,oe,di.x,di.y)&&K(di.prev,di,di.next)>=0)return!1;di=di.next}return!0}function s(Ct,Rt,Nt,Zt){var re=Ct.prev,se=Ct,de=Ct.next;if(K(re,se,de)>=0)return!1;for(var Me=re.x,Se=se.x,oe=de.x,Ai=re.y,Ke=se.y,qe=de.y,Ve=Me<Se?Me<oe?Me:oe:Se<oe?Se:oe,di=Ai<Ke?Ai<qe?Ai:qe:Ke<qe?Ke:qe,cn=Me>Se?Me>oe?Me:oe:Se>oe?Se:oe,Ri=Ai>Ke?Ai>qe?Ai:qe:Ke>qe?Ke:qe,bi=U(Ve,di,Rt,Nt,Zt),Vn=U(cn,Ri,Rt,Nt,Zt),yi=Ct.prevZ,vi=Ct.nextZ;yi&&yi.z>=bi&&vi&&vi.z<=Vn;){if(yi.x>=Ve&&yi.x<=cn&&yi.y>=di&&yi.y<=Ri&&yi!==re&&yi!==de&&j(Me,Ai,Se,Ke,oe,qe,yi.x,yi.y)&&K(yi.prev,yi,yi.next)>=0||(yi=yi.prevZ,vi.x>=Ve&&vi.x<=cn&&vi.y>=di&&vi.y<=Ri&&vi!==re&&vi!==de&&j(Me,Ai,Se,Ke,oe,qe,vi.x,vi.y)&&K(vi.prev,vi,vi.next)>=0))return!1;vi=vi.nextZ}for(;yi&&yi.z>=bi;){if(yi.x>=Ve&&yi.x<=cn&&yi.y>=di&&yi.y<=Ri&&yi!==re&&yi!==de&&j(Me,Ai,Se,Ke,oe,qe,yi.x,yi.y)&&K(yi.prev,yi,yi.next)>=0)return!1;yi=yi.prevZ}for(;vi&&vi.z<=Vn;){if(vi.x>=Ve&&vi.x<=cn&&vi.y>=di&&vi.y<=Ri&&vi!==re&&vi!==de&&j(Me,Ai,Se,Ke,oe,qe,vi.x,vi.y)&&K(vi.prev,vi,vi.next)>=0)return!1;vi=vi.nextZ}return!0}function o(Ct,Rt,Nt){var Zt=Ct;do{var re=Zt.prev,se=Zt.next.next;!Q(re,se)&&pt(re,Zt,Zt.next,se)&&dt(re,se)&&dt(se,re)&&(Rt.push(re.i/Nt|0),Rt.push(Zt.i/Nt|0),Rt.push(se.i/Nt|0),ut(Zt),ut(Zt.next),Zt=Ct=se),Zt=Zt.next}while(Zt!==Ct);return i(Zt)}function c(Ct,Rt,Nt,Zt,re,se){var de=Ct;do{for(var Me=de.next.next;Me!==de.prev;){if(de.i!==Me.i&&tt(de,Me)){var Se=Lt(de,Me);de=i(de,de.next),Se=i(Se,Se.next),n(de,Rt,Nt,Zt,re,se,0),n(Se,Rt,Nt,Zt,re,se,0);return}Me=Me.next}de=de.next}while(de!==Ct)}function h(Ct,Rt,Nt,Zt){var re=[],se,de,Me,Se,oe;for(se=0,de=Rt.length;se<de;se++)Me=Rt[se]*Zt,Se=se<de-1?Rt[se+1]*Zt:Ct.length,oe=t(Ct,Me,Se,Zt,!1),oe===oe.next&&(oe.steiner=!0),re.push(H(oe));for(re.sort(A),se=0;se<re.length;se++)Nt=_(re[se],Nt);return Nt}function A(Ct,Rt){return Ct.x-Rt.x}function _(Ct,Rt){var Nt=C(Ct,Rt);if(!Nt)return Rt;var Zt=Lt(Nt,Ct);return i(Zt,Zt.next),i(Nt,Nt.next)}function C(Ct,Rt){var Nt=Rt,Zt=Ct.x,re=Ct.y,se=-1/0,de;do{if(re<=Nt.y&&re>=Nt.next.y&&Nt.next.y!==Nt.y){var Me=Nt.x+(re-Nt.y)*(Nt.next.x-Nt.x)/(Nt.next.y-Nt.y);if(Me<=Zt&&Me>se&&(se=Me,de=Nt.x<Nt.next.x?Nt:Nt.next,Me===Zt))return de}Nt=Nt.next}while(Nt!==Rt);if(!de)return null;var Se=de,oe=de.x,Ai=de.y,Ke=1/0,qe;Nt=de;do Zt>=Nt.x&&Nt.x>=oe&&Zt!==Nt.x&&j(re<Ai?Zt:se,re,oe,Ai,re<Ai?se:Zt,re,Nt.x,Nt.y)&&(qe=Math.abs(re-Nt.y)/(Zt-Nt.x),dt(Nt,Ct)&&(qe<Ke||qe===Ke&&(Nt.x>de.x||Nt.x===de.x&&S(de,Nt)))&&(de=Nt,Ke=qe)),Nt=Nt.next;while(Nt!==Se);return de}function S(Ct,Rt){return K(Ct.prev,Ct,Rt.prev)<0&&K(Rt.next,Ct,Ct.next)<0}function L(Ct,Rt,Nt,Zt){var re=Ct;do re.z===0&&(re.z=U(re.x,re.y,Rt,Nt,Zt)),re.prevZ=re.prev,re.nextZ=re.next,re=re.next;while(re!==Ct);re.prevZ.nextZ=null,re.prevZ=null,N(re)}function N(Ct){var Rt,Nt,Zt,re,se,de,Me,Se,oe=1;do{for(Nt=Ct,Ct=null,se=null,de=0;Nt;){for(de++,Zt=Nt,Me=0,Rt=0;Rt<oe&&(Me++,Zt=Zt.nextZ,!!Zt);Rt++);for(Se=oe;Me>0||Se>0&&Zt;)Me!==0&&(Se===0||!Zt||Nt.z<=Zt.z)?(re=Nt,Nt=Nt.nextZ,Me--):(re=Zt,Zt=Zt.nextZ,Se--),se?se.nextZ=re:Ct=re,re.prevZ=se,se=re;Nt=Zt}se.nextZ=null,oe*=2}while(de>1);return Ct}function U(Ct,Rt,Nt,Zt,re){return Ct=(Ct-Nt)*re|0,Rt=(Rt-Zt)*re|0,Ct=(Ct|Ct<<8)&16711935,Ct=(Ct|Ct<<4)&252645135,Ct=(Ct|Ct<<2)&858993459,Ct=(Ct|Ct<<1)&1431655765,Rt=(Rt|Rt<<8)&16711935,Rt=(Rt|Rt<<4)&252645135,Rt=(Rt|Rt<<2)&858993459,Rt=(Rt|Rt<<1)&1431655765,Ct|Rt<<1}function H(Ct){var Rt=Ct,Nt=Ct;do(Rt.x<Nt.x||Rt.x===Nt.x&&Rt.y<Nt.y)&&(Nt=Rt),Rt=Rt.next;while(Rt!==Ct);return Nt}function j(Ct,Rt,Nt,Zt,re,se,de,Me){return(re-de)*(Rt-Me)>=(Ct-de)*(se-Me)&&(Ct-de)*(Zt-Me)>=(Nt-de)*(Rt-Me)&&(Nt-de)*(se-Me)>=(re-de)*(Zt-Me)}function tt(Ct,Rt){return Ct.next.i!==Rt.i&&Ct.prev.i!==Rt.i&&!Gt(Ct,Rt)&&(dt(Ct,Rt)&&dt(Rt,Ct)&&lt(Ct,Rt)&&(K(Ct.prev,Ct,Rt.prev)||K(Ct,Rt.prev,Rt))||Q(Ct,Rt)&&K(Ct.prev,Ct,Ct.next)>0&&K(Rt.prev,Rt,Rt.next)>0)}function K(Ct,Rt,Nt){return(Rt.y-Ct.y)*(Nt.x-Rt.x)-(Rt.x-Ct.x)*(Nt.y-Rt.y)}function Q(Ct,Rt){return Ct.x===Rt.x&&Ct.y===Rt.y}function pt(Ct,Rt,Nt,Zt){var re=zt(K(Ct,Rt,Nt)),se=zt(K(Ct,Rt,Zt)),de=zt(K(Nt,Zt,Ct)),Me=zt(K(Nt,Zt,Rt));return!!(re!==se&&de!==Me||re===0&&$(Ct,Nt,Rt)||se===0&&$(Ct,Zt,Rt)||de===0&&$(Nt,Ct,Zt)||Me===0&&$(Nt,Rt,Zt))}function $(Ct,Rt,Nt){return Rt.x<=Math.max(Ct.x,Nt.x)&&Rt.x>=Math.min(Ct.x,Nt.x)&&Rt.y<=Math.max(Ct.y,Nt.y)&&Rt.y>=Math.min(Ct.y,Nt.y)}function zt(Ct){return Ct>0?1:Ct<0?-1:0}function Gt(Ct,Rt){var Nt=Ct;do{if(Nt.i!==Ct.i&&Nt.next.i!==Ct.i&&Nt.i!==Rt.i&&Nt.next.i!==Rt.i&&pt(Nt,Nt.next,Ct,Rt))return!0;Nt=Nt.next}while(Nt!==Ct);return!1}function dt(Ct,Rt){return K(Ct.prev,Ct,Ct.next)<0?K(Ct,Rt,Ct.next)>=0&&K(Ct,Ct.prev,Rt)>=0:K(Ct,Rt,Ct.prev)<0||K(Ct,Ct.next,Rt)<0}function lt(Ct,Rt){var Nt=Ct,Zt=!1,re=(Ct.x+Rt.x)/2,se=(Ct.y+Rt.y)/2;do Nt.y>se!=Nt.next.y>se&&Nt.next.y!==Nt.y&&re<(Nt.next.x-Nt.x)*(se-Nt.y)/(Nt.next.y-Nt.y)+Nt.x&&(Zt=!Zt),Nt=Nt.next;while(Nt!==Ct);return Zt}function Lt(Ct,Rt){var Nt=new Et(Ct.i,Ct.x,Ct.y),Zt=new Et(Rt.i,Rt.x,Rt.y),re=Ct.next,se=Rt.prev;return Ct.next=Rt,Rt.prev=Ct,Nt.next=re,re.prev=Nt,Zt.next=Nt,Nt.prev=Zt,se.next=Zt,Zt.prev=se,Zt}function J(Ct,Rt,Nt,Zt){var re=new Et(Ct,Rt,Nt);return Zt?(re.next=Zt.next,re.prev=Zt,Zt.next.prev=re,Zt.next=re):(re.prev=re,re.next=re),re}function ut(Ct){Ct.next.prev=Ct.prev,Ct.prev.next=Ct.next,Ct.prevZ&&(Ct.prevZ.nextZ=Ct.nextZ),Ct.nextZ&&(Ct.nextZ.prevZ=Ct.prevZ)}function Et(Ct,Rt,Nt){this.i=Ct,this.x=Rt,this.y=Nt,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}e.deviation=function(Ct,Rt,Nt,Zt){var re=Rt&&Rt.length,se=re?Rt[0]*Nt:Ct.length,de=Math.abs(le(Ct,0,se,Nt));if(re)for(var Me=0,Se=Rt.length;Me<Se;Me++){var oe=Rt[Me]*Nt,Ai=Me<Se-1?Rt[Me+1]*Nt:Ct.length;de-=Math.abs(le(Ct,oe,Ai,Nt))}var Ke=0;for(Me=0;Me<Zt.length;Me+=3){var qe=Zt[Me]*Nt,Ve=Zt[Me+1]*Nt,di=Zt[Me+2]*Nt;Ke+=Math.abs((Ct[qe]-Ct[di])*(Ct[Ve+1]-Ct[qe+1])-(Ct[qe]-Ct[Ve])*(Ct[di+1]-Ct[qe+1]))}return de===0&&Ke===0?0:Math.abs((Ke-de)/de)};function le(Ct,Rt,Nt,Zt){for(var re=0,se=Rt,de=Nt-Zt;se<Nt;se+=Zt)re+=(Ct[de]-Ct[se])*(Ct[se+1]+Ct[de+1]),de=se;return re}return e.flatten=function(Ct){for(var Rt=Ct[0][0].length,Nt={vertices:[],holes:[],dimensions:Rt},Zt=0,re=0;re<Ct.length;re++){for(var se=0;se<Ct[re].length;se++)for(var de=0;de<Rt;de++)Nt.vertices.push(Ct[re][se][de]);re>0&&(Zt+=Ct[re-1].length,Nt.holes.push(Zt))}return Nt},Ey.exports}var Mlt=Ilt();const TO=zh(Mlt),By=dx.CLOCKWISE,SO=dx.COUNTER_CLOCKWISE,nh={};function Plt(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Pg(e){return"positions"in e?e.positions:e}function Ty(e){return"holeIndices"in e?e.holeIndices:null}function Rlt(e){return Array.isArray(e[0])}function Dlt(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function Olt(e){const t=e[0],i=e[e.length-1];return t[0]===i[0]&&t[1]===i[1]&&t[2]===i[2]}function Llt(e,t,i,n){for(let r=0;r<t;r++)if(e[i+r]!==e[n-t+r])return!1;return!0}function IO(e,t,i,n,r){let s=t;const o=i.length;for(let c=0;c<o;c++)for(let h=0;h<n;h++)e[s++]=i[c][h]||0;if(!Olt(i))for(let c=0;c<n;c++)e[s++]=i[0][c]||0;return nh.start=t,nh.end=s,nh.size=n,px(e,r,nh),s}function MO(e,t,i,n,r=0,s,o){s=s||i.length;const c=s-r;if(c<=0)return t;let h=t;for(let A=0;A<c;A++)e[h++]=i[r+A];if(!Llt(i,n,r,s))for(let A=0;A<n;A++)e[h++]=i[r+A];return nh.start=t,nh.end=h,nh.size=n,px(e,o,nh),h}function PO(e,t){Plt(e);const i=[],n=[];if("positions"in e){const{positions:r,holeIndices:s}=e;if(s){let o=0;for(let c=0;c<=s.length;c++)o=MO(i,o,r,t,s[c-1],s[c],c===0?By:SO),n.push(o);return n.pop(),{positions:i,holeIndices:n}}e=r}if(!Rlt(e))return MO(i,0,e,t,0,i.length,By),i;if(!Dlt(e)){let r=0;for(const[s,o]of e.entries())r=IO(i,r,o,t,s===0?By:SO),n.push(r);return n.pop(),{positions:i,holeIndices:n}}return IO(i,0,e,t,By),i}function _x(e,t,i){const n=e.length/3;let r=0;for(let s=0;s<n;s++){const o=(s+1)%n;r+=e[s*3+t]*e[o*3+i],r-=e[o*3+t]*e[s*3+i]}return Math.abs(r/2)}function RO(e,t,i,n){const r=e.length/3;for(let s=0;s<r;s++){const o=s*3,c=e[o+0],h=e[o+1],A=e[o+2];e[o+t]=c,e[o+i]=h,e[o+n]=A}}function Flt(e,t,i,n){let r=Ty(e);r&&(r=r.map(c=>c/t));let s=Pg(e);const o=n&&t===3;if(i){const c=s.length;s=s.slice();const h=[];for(let A=0;A<c;A+=t){h[0]=s[A],h[1]=s[A+1],o&&(h[2]=s[A+2]);const _=i(h);s[A]=_[0],s[A+1]=_[1],o&&(s[A+2]=_[2])}}if(o){const c=_x(s,0,1),h=_x(s,0,2),A=_x(s,1,2);if(!c&&!h&&!A)return[];c>h&&c>A||(h>A?(i||(s=s.slice()),RO(s,0,2,1)):(i||(s=s.slice()),RO(s,2,0,1)))}return TO(s,r,t)}class klt extends jP{constructor(t){const{fp64:i,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(t){const{attributes:i}=this;return t==="indices"?i.indices&&i.indices.subarray(0,this.vertexCount):i[t]}updateGeometry(t){super.updateGeometry(t);const i=this.buffers.indices;if(i)this.vertexCount=(i.value||i).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){const i=PO(t,this.positionSize);return this.opts.resolution?mO(Pg(i),Ty(i),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?hlt(Pg(i),Ty(i),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):i}return t}getGeometrySize(t){if(DO(t)){let i=0;for(const n of t)i+=this.getGeometrySize(n);return i}return Pg(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,i){if(t&&DO(t))for(const n of t){const r=this.getGeometrySize(n);i.geometrySize=r,this.updateGeometryAttributes(n,i),i.vertexStart+=r,i.indexStart=this.indexStarts[i.geometryIndex+1]}else{const n=t;this._updateIndices(n,i),this._updatePositions(n,i),this._updateVertexValid(n,i)}}_updateIndices(t,{geometryIndex:i,vertexStart:n,indexStart:r}){const{attributes:s,indexStarts:o,typedArrayManager:c}=this;let h=s.indices;if(!h||!t)return;let A=r;const _=Flt(t,this.positionSize,this.opts.preproject,this.opts.full3d);h=c.allocate(h,r+_.length,{copy:!0});for(let C=0;C<_.length;C++)h[A++]=_[C]+n;o[i+1]=r+_.length,s.indices=h}_updatePositions(t,{vertexStart:i,geometrySize:n}){const{attributes:{positions:r},positionSize:s}=this;if(!r||!t)return;const o=Pg(t);for(let c=i,h=0;h<n;c++,h++){const A=o[h*s],_=o[h*s+1],C=s>2?o[h*s+2]:0;r[c*3]=A,r[c*3+1]=_,r[c*3+2]=C}}_updateVertexValid(t,{vertexStart:i,geometrySize:n}){const{positionSize:r}=this,s=this.attributes.vertexValid,o=t&&Ty(t);if(t&&t.edgeTypes?s.set(t.edgeTypes,i):s.fill(1,i,i+n),o)for(let c=0;c<o.length;c++)s[i+o[c]/r-1]=0;s[i+n-1]=0}}function DO(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}const OO=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,Nlt={name:"solidPolygon",vs:OO,fs:OO,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},LO=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Ult=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${LO}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,zlt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${LO}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,Glt=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Sy=[0,0,0,255],jlt={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Sy},getLineColor:{type:"accessor",value:Sy},material:!0},Iy={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e};class rh extends Bo{getShaders(t){return super.getShaders({vs:t==="top"?Ult:zlt,fs:Glt,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[Fo,x0,ua,Nlt]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){const{viewport:t}=this.context;let{coordinateSystem:i}=this.props;const{_full3d:n}=this.props;t.isGeospatial&&i===$i.DEFAULT&&(i=$i.LNGLAT);let r;i===$i.LNGLAT&&(n?r=t.projectPosition.bind(t):r=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new klt({preproject:r,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:Iy,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:Iy,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Iy,accessor:"getFillColor",defaultValue:Sy},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:Iy,accessor:"getLineColor",defaultValue:Sy},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(c,{index:h,target:A})=>this.encodePickingColor(c&&c.__source?c.__source.index:h,A)}})}getPickingInfo(t){const i=super.getPickingInfo(t),{index:n}=i,r=this.props.data;return r[0]&&r[0].__source&&(i.object=r.find(s=>s.__source.index===n)),i}disablePickingIndex(t){const i=this.props.data;if(i[0]&&i[0].__source)for(let n=0;n<i.length;n++)i[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){const{extruded:i,filled:n,wireframe:r,elevationScale:s}=this.props,{topModel:o,sideModel:c,wireframeModel:h,polygonTesselator:A}=this.state,_={extruded:!!i,elevationScale:s,isWireframe:!1};h&&r&&(h.setInstanceCount(A.instanceCount-1),h.shaderInputs.setProps({solidPolygon:{..._,isWireframe:!0}}),h.draw(this.context.renderPass)),c&&n&&(c.setInstanceCount(A.instanceCount-1),c.shaderInputs.setProps({solidPolygon:_}),c.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(A.vertexCount),o.shaderInputs.setProps({solidPolygon:_}),o.draw(this.context.renderPass))}updateState(t){super.updateState(t),this.updateGeometry(t);const{props:i,oldProps:n,changeFlags:r}=t,s=this.getAttributeManager();(r.extensionsChanged||i.filled!==n.filled||i.extruded!==n.extruded)&&(this.state.models?.forEach(o=>o.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:t,oldProps:i,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){const{polygonTesselator:r}=this.state,s=t.data.attributes||{};r.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:s.getPolygon,buffers:s,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:r.instanceCount,startIndices:r.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:t,filled:i,extruded:n}=this.props;let r,s,o;if(i){const c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1;const h=this.getAttributeManager().getBufferLayouts({isInstanced:!1});r=new Lr(this.context.device,{...c,id:`${t}-top`,topology:"triangle-list",bufferLayout:h,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){const c=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new Lr(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:c,geometry:new Yo({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Lr(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:c,geometry:new Yo({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,r].filter(Boolean),topModel:r,sideModel:s,wireframeModel:o}}calculateIndices(t){const{polygonTesselator:i}=this.state;t.startIndices=i.indexStarts,t.value=i.get("indices")}calculatePositions(t){const{polygonTesselator:i}=this.state;t.startIndices=i.vertexStarts,t.value=i.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}}rh.defaultProps=jlt,rh.layerName="SolidPolygonLayer";function FO({data:e,getIndex:t,dataRange:i,replace:n}){const{startRow:r=0,endRow:s=1/0}=i,o=e.length;let c=o,h=o;for(let C=0;C<o;C++){const S=t(e[C]);if(c>C&&S>=r&&(c=C),S>=s){h=C;break}}let A=c;const _=h-c!==n.length?e.slice(h):void 0;for(let C=0;C<n.length;C++)e[A++]=n[C];if(_){for(let C=0;C<_.length;C++)e[A++]=_[C];e.length=A}return{startRow:c,endRow:c+n.length}}const kO=[0,0,0,255],Vlt=[0,0,0,255],Hlt={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:Vlt},getLineColor:{type:"accessor",value:kO},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class oh extends To{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&Zi.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:t}){const i=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(i&&Array.isArray(t.dataChanged)){const n=this.state.paths.slice(),r=t.dataChanged.map(s=>FO({data:n,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:n,pathsDiff:r})}else i&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){const{data:i,getPolygon:n,positionFormat:r,_normalize:s}=this.props,o=[],c=r==="XY"?2:3,{startRow:h,endRow:A}=t,{iterable:_,objectInfo:C}=sl(i,h,A);for(const S of _){C.index++;let L=n(S,C);s&&(L=PO(L,c));const{holeIndices:N}=L,U=L.positions||L;if(N)for(let H=0;H<=N.length;H++){const j=U.slice(N[H-1]||0,N[H]||U.length);o.push(this.getSubLayerRow({path:j},S,C.index))}else o.push(this.getSubLayerRow({path:U},S,C.index))}return o}renderLayers(){const{data:t,_dataDiff:i,stroked:n,filled:r,extruded:s,wireframe:o,_normalize:c,_windingOrder:h,elevationScale:A,transitions:_,positionFormat:C}=this.props,{lineWidthUnits:S,lineWidthScale:L,lineWidthMinPixels:N,lineWidthMaxPixels:U,lineJointRounded:H,lineMiterLimit:j,lineDashJustified:tt}=this.props,{getFillColor:K,getLineColor:Q,getLineWidth:pt,getLineDashArray:$,getElevation:zt,getPolygon:Gt,updateTriggers:dt,material:lt}=this.props,{paths:Lt,pathsDiff:J}=this.state,ut=this.getSubLayerClass("fill",rh),Et=this.getSubLayerClass("stroke",ih),le=this.shouldRenderSubLayer("fill",Lt)&&new ut({_dataDiff:i,extruded:s,elevationScale:A,filled:r,wireframe:o,_normalize:c,_windingOrder:h,getElevation:zt,getFillColor:K,getLineColor:s&&o?Q:kO,material:lt,transitions:_},this.getSubLayerProps({id:"fill",updateTriggers:dt&&{getPolygon:dt.getPolygon,getElevation:dt.getElevation,getFillColor:dt.getFillColor,lineColors:s&&o,getLineColor:dt.getLineColor}}),{data:t,positionFormat:C,getPolygon:Gt}),Ct=!s&&n&&this.shouldRenderSubLayer("stroke",Lt)&&new Et({_dataDiff:J&&(()=>J),widthUnits:S,widthScale:L,widthMinPixels:N,widthMaxPixels:U,jointRounded:H,miterLimit:j,dashJustified:tt,_pathType:"loop",transitions:_&&{getWidth:_.getLineWidth,getColor:_.getLineColor,getPath:_.getPolygon},getColor:this.getSubLayerAccessor(Q),getWidth:this.getSubLayerAccessor(pt),getDashArray:this.getSubLayerAccessor($)},this.getSubLayerProps({id:"stroke",updateTriggers:dt&&{getWidth:dt.getLineWidth,getColor:dt.getLineColor,getDashArray:dt.getLineDashArray}}),{data:Lt,positionFormat:C,getPath:Rt=>Rt.path});return[!s&&le,Ct,s&&le]}}oh.layerName="PolygonLayer",oh.defaultProps=Hlt;function Wlt(e,t){if(!e)return null;const i="startIndices"in e?e.startIndices[t]:t,n=e.featureIds.value[i];return i!==-1?Jlt(e,n,i):null}function Jlt(e,t,i){const n={properties:{...e.properties[t]}};for(const r in e.numericProps)n.properties[r]=e.numericProps[r].value[i];return n}function Xlt(e,t){const i={points:null,lines:null,polygons:null};for(const n in i){const r=e[n].globalFeatureIds.value;i[n]=new Uint8ClampedArray(r.length*4);const s=[];for(let o=0;o<r.length;o++)t(r[o],s),i[n][o*4+0]=s[0],i[n][o*4+1]=s[1],i[n][o*4+2]=s[2],i[n][o*4+3]=255}return i}const NO=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,Qlt={name:"sdf",vs:NO,fs:NO,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},Klt=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,bx=192/256,UO=[],qlt={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class My extends fp{getShaders(){const t=super.getShaders();return{...t,modules:[...t.modules,Qlt],fs:Klt}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(t,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t;let{outlineColor:r}=i;r!==n.outlineColor&&(r=r.map(s=>s/255),r[3]=Number.isFinite(r[3])?r[3]:1,this.setState({outlineColor:r})),!i.sdf&&i.outlineWidth&&Zi.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){const{sdf:i,smoothing:n,outlineWidth:r}=this.props,{outlineColor:s}=this.state,o=r?Math.max(n,bx*(1-r)):-1,c=this.state.model,h={buffer:bx,outlineBuffer:o,gamma:n,enabled:!!i,outlineColor:s};if(c.shaderInputs.setProps({sdf:h}),super.draw(t),i&&r){const{iconManager:A}=this.state;A.getTexture()&&(c.shaderInputs.setProps({sdf:{...h,outlineBuffer:bx}}),c.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(i=>super.getInstanceOffset(i)):UO}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(i=>super.getInstanceIconFrame(i)):UO}}My.defaultProps=qlt,My.layerName="MultiIconLayer";const Rg=1e20;class Zlt{constructor({fontSize:t=24,buffer:i=3,radius:n=8,cutoff:r=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:c="normal"}={}){this.buffer=i,this.cutoff=r,this.radius=n;const h=this.size=t+i*4,A=this._createCanvas(h),_=this.ctx=A.getContext("2d",{willReadFrequently:!0});_.font=`${c} ${o} ${t}px ${s}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(t){const i=document.createElement("canvas");return i.width=i.height=t,i}draw(t){const{width:i,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(t),c=Math.ceil(n),h=0,A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),_=Math.min(this.size-this.buffer,c+Math.ceil(r)),C=A+2*this.buffer,S=_+2*this.buffer,L=Math.max(C*S,0),N=new Uint8ClampedArray(L),U={data:N,width:C,height:S,glyphWidth:A,glyphHeight:_,glyphTop:c,glyphLeft:h,glyphAdvance:i};if(A===0||_===0)return U;const{ctx:H,buffer:j,gridInner:tt,gridOuter:K}=this;H.clearRect(j,j,A,_),H.fillText(t,j,j+c);const Q=H.getImageData(j,j,A,_);K.fill(Rg,0,L),tt.fill(0,0,L);for(let pt=0;pt<_;pt++)for(let $=0;$<A;$++){const zt=Q.data[4*(pt*A+$)+3]/255;if(zt===0)continue;const Gt=(pt+j)*C+$+j;if(zt===1)K[Gt]=0,tt[Gt]=Rg;else{const dt=.5-zt;K[Gt]=dt>0?dt*dt:0,tt[Gt]=dt<0?dt*dt:0}}zO(K,0,0,C,S,C,this.f,this.v,this.z),zO(tt,j,j,A,_,C,this.f,this.v,this.z);for(let pt=0;pt<L;pt++){const $=Math.sqrt(K[pt])-Math.sqrt(tt[pt]);N[pt]=Math.round(255-255*($/this.radius+this.cutoff))}return U}}function zO(e,t,i,n,r,s,o,c,h){for(let A=t;A<t+n;A++)GO(e,i*s+A,s,r,o,c,h);for(let A=i;A<i+r;A++)GO(e,A*s+t,1,n,o,c,h)}function GO(e,t,i,n,r,s,o){s[0]=0,o[0]=-Rg,o[1]=Rg,r[0]=e[t];for(let c=1,h=0,A=0;c<n;c++){r[c]=e[t+c*i];const _=c*c;do{const C=s[h];A=(r[c]-r[C]+_-C*C)/(c-C)/2}while(A<=o[h]&&--h>-1);h++,s[h]=c,o[h]=A,o[h+1]=Rg}for(let c=0,h=0;c<n;c++){for(;o[h+1]<c;)h++;const A=s[h],_=c-A;e[t+c*i]=r[A]+_*_}}const Ylt=32,$lt=[];function tut(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function eut({characterSet:e,getFontWidth:t,fontHeight:i,buffer:n,maxCanvasWidth:r,mapping:s={},xOffset:o=0,yOffset:c=0}){let h=0,A=o;const _=i+n*2;for(const C of e)if(!s[C]){const S=t(C);A+S+n*2>r&&(A=0,h++),s[C]={x:A+n,y:c+h*_+n,width:S,height:_,layoutWidth:S,layoutHeight:i},A+=S+n*2}return{mapping:s,xOffset:A,yOffset:c+h*_,canvasHeight:tut(c+(h+1)*_)}}function jO(e,t,i,n){let r=0;for(let s=t;s<i;s++){const o=e[s];r+=n[o]?.layoutWidth||0}return r}function VO(e,t,i,n,r,s){let o=t,c=0;for(let h=t;h<i;h++){const A=jO(e,h,h+1,r);c+A>n&&(o<h&&s.push(h),o=h,c=0),c+=A}return c}function iut(e,t,i,n,r,s){let o=t,c=t,h=t,A=0;for(let _=t;_<i;_++)if((e[_]===" "||e[_+1]===" "||_+1===i)&&(h=_+1),h>c){let C=jO(e,c,h,r);A+C>n&&(o<c&&(s.push(c),o=c,A=0),C>n&&(C=VO(e,c,h,n,r,s),o=s[s.length-1])),c=h,A+=C}return A}function nut(e,t,i,n,r=0,s){s===void 0&&(s=e.length);const o=[];return t==="break-all"?VO(e,r,s,i,n,o):iut(e,r,s,i,n,o),o}function rut(e,t,i,n,r,s){let o=0,c=0;for(let h=t;h<i;h++){const A=e[h],_=n[A];_?(c||(c=_.layoutHeight),r[h]=o+_.layoutWidth/2,o+=_.layoutWidth):(Zi.warn(`Missing character: ${A} (${A.codePointAt(0)})`)(),r[h]=o,o+=Ylt)}s[0]=o,s[1]=c}function out(e,t,i,n,r){const s=Array.from(e),o=s.length,c=new Array(o),h=new Array(o),A=new Array(o),_=(i==="break-word"||i==="break-all")&&isFinite(n)&&n>0,C=[0,0],S=[0,0];let L=0,N=0,U=0;for(let H=0;H<=o;H++){const j=s[H];if((j===`
`||H===o)&&(U=H),U>N){const tt=_?nut(s,i,n,r,N,U):$lt;for(let K=0;K<=tt.length;K++){const Q=K===0?N:tt[K-1],pt=K<tt.length?tt[K]:U;rut(s,Q,pt,r,c,S);for(let $=Q;$<pt;$++){c[$]-S[0]/2;const zt=s[$],Gt=r[zt]?.layoutOffsetY||0;h[$]=L+S[1]/2+Gt,A[$]=S[0]}L=L+S[1]*t,C[0]=Math.max(C[0],S[0])}N=U}j===`
`&&(c[N]=0,h[N]=0,A[N]=0,N++)}return C[1]=L,{x:c,y:h,rowWidth:A,size:C}}function sut({value:e,length:t,stride:i,offset:n,startIndices:r,characterSet:s}){const o=e.BYTES_PER_ELEMENT,c=i?i/o:1,h=n?n/o:0,A=r[t]||Math.ceil((e.length-h)/c),_=s&&new Set,C=new Array(t);let S=e;if(c>1||h>0){const L=e.constructor;S=new L(A);for(let N=0;N<A;N++)S[N]=e[N*c+h]}for(let L=0;L<t;L++){const N=r[L],U=r[L+1]||A,H=S.subarray(N,U);C[L]=String.fromCodePoint.apply(null,H),_&&H.forEach(_.add,_)}if(_)for(const L of _)s.add(String.fromCodePoint(L));return{texts:C,characterCount:A}}class HO{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){const i=this._cache[t];return i&&(this._deleteOrder(t),this._appendOrder(t)),i}set(t,i){this._cache[t]?(this.delete(t),this._cache[t]=i,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=i,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){const i=this._order.indexOf(t);i>=0&&this._order.splice(i,1)}_appendOrder(t){this._order.push(t)}}function aut(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}const dp={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:aut(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},WO=1024,JO=.9,XO=1.2,QO=3;let Py=new HO(QO);function cut(e,t){let i;typeof t=="string"?i=new Set(Array.from(t)):i=new Set(t);const n=Py.get(e);if(!n)return i;for(const r in n.mapping)i.has(r)&&i.delete(r);return i}function lut(e,t){for(let i=0;i<e.length;i++)t.data[4*i+3]=e[i]}function KO(e,t,i,n){e.font=`${n} ${i}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function uut(e){Zi.assert(Number.isFinite(e)&&e>=QO,"Invalid cache limit"),Py=new HO(e)}class hut{constructor(){this.props={...dp}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:t,buffer:i}=this.props;return(t*XO+i*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();const i=cut(this._key,this.props.characterSet),n=Py.get(this._key);if(n&&i.size===0){this._atlas!==n&&(this._atlas=n);return}const r=this._generateFontAtlas(i,n);this._atlas=r,Py.set(this._key,r)}_generateFontAtlas(t,i){const{fontFamily:n,fontWeight:r,fontSize:s,buffer:o,sdf:c,radius:h,cutoff:A}=this.props;let _=i&&i.data;_||(_=document.createElement("canvas"),_.width=WO);const C=_.getContext("2d",{willReadFrequently:!0});KO(C,n,s,r);const{mapping:S,canvasHeight:L,xOffset:N,yOffset:U}=eut({getFontWidth:H=>C.measureText(H).width,fontHeight:s*XO,buffer:o,characterSet:t,maxCanvasWidth:WO,...i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset}});if(_.height!==L){const H=C.getImageData(0,0,_.width,_.height);_.height=L,C.putImageData(H,0,0)}if(KO(C,n,s,r),c){const H=new Zlt({fontSize:s,buffer:o,radius:h,cutoff:A,fontFamily:n,fontWeight:`${r}`});for(const j of t){const{data:tt,width:K,height:Q,glyphTop:pt}=H.draw(j);S[j].width=K,S[j].layoutOffsetY=s*JO-pt;const $=C.createImageData(K,Q);lut(tt,$),C.putImageData($,S[j].x,S[j].y)}}else for(const H of t)C.fillText(H,S[H].x,S[H].y+o+s*JO);return{xOffset:N,yOffset:U,mapping:S,data:_,width:_.width,height:_.height}}_getKey(){const{fontFamily:t,fontWeight:i,fontSize:n,buffer:r,sdf:s,radius:o,cutoff:c}=this.props;return s?`${t} ${i} ${n} ${r} ${o} ${c}`:`${t} ${i} ${n} ${r}`}}const qO=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,fut={name:"textBackground",vs:qO,fs:qO,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},dut=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,put=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Aut={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class Dg extends Bo{getShaders(){return super.getShaders({vs:dut,fs:put,modules:[Fo,ua,fut]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);const{changeFlags:i}=t;i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){const{billboard:i,sizeScale:n,sizeUnits:r,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:c}=this.props;let{padding:h,borderRadius:A}=this.props;h.length<4&&(h=[h[0],h[1],h[0],h[1]]),Array.isArray(A)||(A=[A,A,A,A]);const _=this.state.model,C={billboard:i,stroked:!!c,borderRadius:A,padding:h,sizeUnits:Ms[r],sizeScale:n,sizeMinPixels:s,sizeMaxPixels:o};_.shaderInputs.setProps({textBackground:C}),_.draw(this.context.renderPass)}_getModel(){const t=[0,0,1,0,0,1,1,1];return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Yo({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}}Dg.defaultProps=Aut,Dg.layerName="TextBackgroundLayer";const ZO={start:1,middle:0,end:-1},YO={top:1,center:0,bottom:-1},xx=[0,0,0,255],gut=1,mut={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:xx},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:dp.characterSet},fontFamily:dp.fontFamily,fontWeight:dp.fontWeight,lineHeight:gut,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:xx},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:xx},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class hf extends To{constructor(){super(...arguments),this.getBoundingRect=(t,i)=>{let{size:[n,r]}=this.transformParagraph(t,i);const{fontSize:s}=this.state.fontAtlasManager.props;n/=s,r/=s;const{getTextAnchor:o,getAlignmentBaseline:c}=this.props,h=ZO[typeof o=="function"?o(t,i):o],A=YO[typeof c=="function"?c(t,i):c];return[(h-1)*n/2,(A-1)*r/2,n,r]},this.getIconOffsets=(t,i)=>{const{getTextAnchor:n,getAlignmentBaseline:r}=this.props,{x:s,y:o,rowWidth:c,size:[h,A]}=this.transformParagraph(t,i),_=ZO[typeof n=="function"?n(t,i):n],C=YO[typeof r=="function"?r(t,i):r],S=s.length,L=new Array(S*2);let N=0;for(let U=0;U<S;U++){const H=(1-_)*(h-c[U])/2;L[N++]=(_-1)*h/2+H+s[U],L[N++]=(C-1)*A/2+o[U]}return L}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new hut},this.props.maxWidth>0&&Zi.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){const{props:i,oldProps:n,changeFlags:r}=t;(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||i.lineHeight!==n.lineHeight||i.wordBreak!==n.wordBreak||i.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){const{fontSettings:t,fontFamily:i,fontWeight:n}=this.props,{fontAtlasManager:r,characterSet:s}=this.state,o={...t,characterSet:s,fontFamily:i,fontWeight:n};if(!r.mapping)return r.setProps(o),!0;for(const c in o)if(o[c]!==r.props[c])return r.setProps(o),!0;return!1}_updateText(){const{data:t,characterSet:i}=this.props,n=t.attributes?.getText;let{getText:r}=this.props,s=t.startIndices,o;const c=i==="auto"&&new Set;if(n&&s){const{texts:h,characterCount:A}=sut({...ArrayBuffer.isView(n)?{value:n}:n,length:t.length,startIndices:s,characterSet:c});o=A,r=(_,{index:C})=>h[C]}else{const{iterable:h,objectInfo:A}=sl(t);s=[0],o=0;for(const _ of h){A.index++;const C=Array.from(r(_,A)||"");c&&C.forEach(c.add,c),o+=C.length,s.push(o)}}this.setState({getText:r,startIndices:s,numInstances:o,characterSet:c||i})}transformParagraph(t,i){const{fontAtlasManager:n}=this.state,r=n.mapping,s=this.state.getText,{wordBreak:o,lineHeight:c,maxWidth:h}=this.props,A=s(t,i)||"";return out(A,c,o,h*n.props.fontSize,r)}renderLayers(){const{startIndices:t,numInstances:i,getText:n,fontAtlasManager:{scale:r,atlas:s,mapping:o},styleVersion:c}=this.state,{data:h,_dataDiff:A,getPosition:_,getColor:C,getSize:S,getAngle:L,getPixelOffset:N,getBackgroundColor:U,getBorderColor:H,getBorderWidth:j,backgroundBorderRadius:tt,backgroundPadding:K,background:Q,billboard:pt,fontSettings:$,outlineWidth:zt,outlineColor:Gt,sizeScale:dt,sizeUnits:lt,sizeMinPixels:Lt,sizeMaxPixels:J,transitions:ut,updateTriggers:Et}=this.props,le=this.getSubLayerClass("characters",My),Ct=this.getSubLayerClass("background",Dg);return[Q&&new Ct({getFillColor:U,getLineColor:H,getLineWidth:j,borderRadius:tt,padding:K,getPosition:_,getSize:S,getAngle:L,getPixelOffset:N,billboard:pt,sizeScale:dt,sizeUnits:lt,sizeMinPixels:Lt,sizeMaxPixels:J,transitions:ut&&{getPosition:ut.getPosition,getAngle:ut.getAngle,getSize:ut.getSize,getFillColor:ut.getBackgroundColor,getLineColor:ut.getBorderColor,getLineWidth:ut.getBorderWidth,getPixelOffset:ut.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Et.getPosition,getAngle:Et.getAngle,getSize:Et.getSize,getFillColor:Et.getBackgroundColor,getLineColor:Et.getBorderColor,getLineWidth:Et.getBorderWidth,getPixelOffset:Et.getPixelOffset,getBoundingRect:{getText:Et.getText,getTextAnchor:Et.getTextAnchor,getAlignmentBaseline:Et.getAlignmentBaseline,styleVersion:c}}}),{data:h.attributes&&h.attributes.background?{length:h.length,attributes:h.attributes.background}:h,_dataDiff:A,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new le({sdf:$.sdf,smoothing:Number.isFinite($.smoothing)?$.smoothing:dp.smoothing,outlineWidth:zt/($.radius||dp.radius),outlineColor:Gt,iconAtlas:s,iconMapping:o,getPosition:_,getColor:C,getSize:S,getAngle:L,getPixelOffset:N,billboard:pt,sizeScale:dt*r,sizeUnits:lt,sizeMinPixels:Lt*r,sizeMaxPixels:J*r,transitions:ut&&{getPosition:ut.getPosition,getAngle:ut.getAngle,getColor:ut.getColor,getSize:ut.getSize,getPixelOffset:ut.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Et.getText,getPosition:Et.getPosition,getAngle:Et.getAngle,getColor:Et.getColor,getSize:Et.getSize,getPixelOffset:Et.getPixelOffset,getIconOffsets:{getTextAnchor:Et.getTextAnchor,getAlignmentBaseline:Et.getAlignmentBaseline,styleVersion:c}}}),{data:h,_dataDiff:A,startIndices:t,numInstances:i,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){uut(t)}}hf.defaultProps=mut,hf.layerName="TextLayer";const Ry={circle:{type:Ig,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:fp,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:hf,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Dy={type:ih,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},wx={type:rh,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Og({type:e,props:t}){const i={};for(const n in t)i[n]=e.defaultProps[t[n]];return i}function Cx(e,t){const{transitions:i,updateTriggers:n}=e.props,r={updateTriggers:{},transitions:i&&{getPosition:i.geometry}};for(const s in t){const o=t[s];let c=e.props[s];s.startsWith("get")&&(c=e.getSubLayerAccessor(c),r.updateTriggers[o]=n[s],i&&(r.transitions[o]=i[s])),r[o]=c}return r}function yut(e){if(Array.isArray(e))return e;switch(Zi.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return Zi.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function $O(e,t,i={}){const n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:r=0,endRow:s=e.length}=i;for(let o=r;o<s;o++){const c=e[o],{geometry:h}=c;if(h)if(h.type==="GeometryCollection"){Zi.assert(Array.isArray(h.geometries),"GeoJSON does not have geometries array");const{geometries:A}=h;for(let _=0;_<A.length;_++){const C=A[_];tL(C,n,t,c,o)}}else tL(h,n,t,c,o)}return n}function tL(e,t,i,n,r){const{type:s,coordinates:o}=e,{pointFeatures:c,lineFeatures:h,polygonFeatures:A,polygonOutlineFeatures:_}=t;if(!_ut(s,o)){Zi.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":c.push(i({geometry:e},n,r));break;case"MultiPoint":o.forEach(C=>{c.push(i({geometry:{type:"Point",coordinates:C}},n,r))});break;case"LineString":h.push(i({geometry:e},n,r));break;case"MultiLineString":o.forEach(C=>{h.push(i({geometry:{type:"LineString",coordinates:C}},n,r))});break;case"Polygon":A.push(i({geometry:e},n,r)),o.forEach(C=>{_.push(i({geometry:{type:"LineString",coordinates:C}},n,r))});break;case"MultiPolygon":o.forEach(C=>{A.push(i({geometry:{type:"Polygon",coordinates:C}},n,r)),C.forEach(S=>{_.push(i({geometry:{type:"LineString",coordinates:S}},n,r))})});break}}const vut={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function _ut(e,t){let i=vut[e];for(Zi.assert(i,`Unknown GeoJSON type ${e}`);t&&--i>0;)t=t[0];return t&&Number.isFinite(t[0])}function eL(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function Oy(e){return e.geometry.coordinates}function but(e,t){const i=eL(),{pointFeatures:n,lineFeatures:r,polygonFeatures:s,polygonOutlineFeatures:o}=e;return i.points.data=n,i.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),i.points.getPosition=Oy,i.lines.data=r,i.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),i.lines.getPath=Oy,i.polygons.data=s,i.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),i.polygons.getPolygon=Oy,i.polygonsOutline.data=o,i.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),i.polygonsOutline.getPath=Oy,i}function xut(e,t){const i=eL(),{points:n,lines:r,polygons:s}=e,o=Xlt(e,t);return i.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:o.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},i.lines.data={length:r.pathIndices.value.length-1,startIndices:r.pathIndices.value,attributes:{...r.attributes,getPath:r.positions,instancePickingColors:{size:4,value:o.lines}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},i.lines._pathType="open",i.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygons._normalize=!1,s.triangles&&(i.polygons.data.attributes.indices=s.triangles.value),i.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},i.polygonsOutline._pathType="open",i}const wut=["points","linestrings","polygons"],Cut={...Og(Ry.circle),...Og(Ry.icon),...Og(Ry.text),...Og(Dy),...Og(wx),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class $l extends To{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:i}){if(!i.dataChanged)return;const{data:n}=this.props,r=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:r}),r?this._updateStateBinary({props:t,changeFlags:i}):this._updateStateJSON({props:t,changeFlags:i})}_updateStateBinary({props:t,changeFlags:i}){const n=xut(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:i}){const n=yut(t.data),r=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(i.dataChanged)){const h=this.state.features;for(const A in h)s[A]=h[A].slice(),o[A]=[];for(const A of i.dataChanged){const _=$O(n,r,A);for(const C in h)o[C].push(FO({data:s[C],getIndex:S=>S.__source.index,dataRange:A,replace:_[C]}))}}else s=$O(n,r);const c=but(s,o);this.setState({features:s,featuresDiff:o,layerProps:c})}getPickingInfo(t){const i=super.getPickingInfo(t),{index:n,sourceLayer:r}=i;return i.featureType=wut.find(s=>r.id.startsWith(`${this.id}-${s}-`)),n>=0&&r.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(i.index=this.props.data.points.globalFeatureIds.value[n]),i}_updateAutoHighlight(t){const i=`${this.id}-points-`,n=t.featureType==="points";for(const r of this.getSubLayers())r.id.startsWith(i)===n&&r.updateAutoHighlight(t)}_renderPolygonLayer(){const{extruded:t,wireframe:i}=this.props,{layerProps:n}=this.state,r="polygons-fill",s=this.shouldRenderSubLayer(r,n.polygons?.data)&&this.getSubLayerClass(r,wx.type);if(s){const o=Cx(this,wx.props),c=t&&i;return c||delete o.getLineColor,o.updateTriggers.lineColors=c,new s(o,this.getSubLayerProps({id:r,updateTriggers:o.updateTriggers}),n.polygons)}return null}_renderLineLayers(){const{extruded:t,stroked:i}=this.props,{layerProps:n}=this.state,r="polygons-stroke",s="linestrings",o=!t&&i&&this.shouldRenderSubLayer(r,n.polygonsOutline?.data)&&this.getSubLayerClass(r,Dy.type),c=this.shouldRenderSubLayer(s,n.lines?.data)&&this.getSubLayerClass(s,Dy.type);if(o||c){const h=Cx(this,Dy.props);return[o&&new o(h,this.getSubLayerProps({id:r,updateTriggers:h.updateTriggers}),n.polygonsOutline),c&&new c(h,this.getSubLayerProps({id:s,updateTriggers:h.updateTriggers}),n.lines)]}return null}_renderPointLayers(){const{pointType:t}=this.props,{layerProps:i,binary:n}=this.state;let{highlightedObjectIndex:r}=this.props;!n&&Number.isFinite(r)&&(r=i.points.data.findIndex(c=>c.__source.index===r));const s=new Set(t.split("+")),o=[];for(const c of s){const h=`points-${c}`,A=Ry[c],_=A&&this.shouldRenderSubLayer(h,i.points?.data)&&this.getSubLayerClass(h,A.type);if(_){const C=Cx(this,A.props);let S=i.points;if(c==="text"&&n){const{instancePickingColors:L,...N}=S.data.attributes;S={...S,data:{...S.data,attributes:N}}}o.push(new _(C,this.getSubLayerProps({id:h,updateTriggers:C.updateTriggers,highlightedObjectIndex:r}),S))}}return o}renderLayers(){const{extruded:t}=this.props,i=this._renderPolygonLayer(),n=this._renderLineLayers(),r=this._renderPointLayers();return[!t&&i,n,r,t&&i]}getSubLayerAccessor(t){const{binary:i}=this.state;return!i||typeof t!="function"?super.getSubLayerAccessor(t):(n,r)=>{const{data:s,index:o}=r,c=Wlt(s,o);return t(c,r)}}}$l.layerName="GeoJsonLayer",$l.defaultProps=Cut;const Eut=Object.freeze(Object.defineProperty({__proto__:null,ArcLayer:Bg,BitmapLayer:_y,ColumnLayer:hl,GeoJsonLayer:$l,GridCellLayer:mx,IconLayer:fp,LineLayer:by,PathLayer:ih,PointCloudLayer:Sg,PolygonLayer:oh,ScatterplotLayer:Ig,SolidPolygonLayer:rh,TextLayer:hf,_MultiIconLayer:My,_TextBackgroundLayer:Dg},Symbol.toStringTag,{value:"Module"}));function But(e){return typeof e=="string"?e.charAt(0).toLowerCase()+e.slice(1):e}function Ex(e){if(Array.isArray(e))return e.map(t=>Ex(t));if(e&&typeof e=="object"){const t={};for(const[i,n]of Object.entries(e))t[But(i)]=Ex(n);return t}return e}var Bx={},iL={},nL;function Tx(){return nL||(nL=1,function(e){const t=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i=t+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",n="["+t+"]["+i+"]*",r=new RegExp("^"+n+"$"),s=function(c,h){const A=[];let _=h.exec(c);for(;_;){const C=[];C.startIndex=h.lastIndex-_[0].length;const S=_.length;for(let L=0;L<S;L++)C.push(_[L]);A.push(C),_=h.exec(c)}return A},o=function(c){const h=r.exec(c);return!(h===null||typeof h>"u")};e.isExist=function(c){return typeof c<"u"},e.isEmptyObject=function(c){return Object.keys(c).length===0},e.merge=function(c,h,A){if(h){const _=Object.keys(h),C=_.length;for(let S=0;S<C;S++)A==="strict"?c[_[S]]=[h[_[S]]]:c[_[S]]=h[_[S]]}},e.getValue=function(c){return e.isExist(c)?c:""},e.isName=o,e.getAllMatches=s,e.nameRegexp=n}(iL)),iL}var rL;function oL(){if(rL)return Bx;rL=1;const e=Tx(),t={allowBooleanAttributes:!1,unpairedTags:[]};Bx.validate=function(j,tt){tt=Object.assign({},t,tt);const K=[];let Q=!1,pt=!1;j[0]==="\uFEFF"&&(j=j.substr(1));for(let $=0;$<j.length;$++)if(j[$]==="<"&&j[$+1]==="?"){if($+=2,$=n(j,$),$.err)return $}else if(j[$]==="<"){let zt=$;if($++,j[$]==="!"){$=r(j,$);continue}else{let Gt=!1;j[$]==="/"&&(Gt=!0,$++);let dt="";for(;$<j.length&&j[$]!==">"&&j[$]!==" "&&j[$]!=="	"&&j[$]!==`
`&&j[$]!=="\r";$++)dt+=j[$];if(dt=dt.trim(),dt[dt.length-1]==="/"&&(dt=dt.substring(0,dt.length-1),$--),!N(dt)){let J;return dt.trim().length===0?J="Invalid space after '<'.":J="Tag '"+dt+"' is an invalid name.",S("InvalidTag",J,U(j,$))}const lt=c(j,$);if(lt===!1)return S("InvalidAttr","Attributes for '"+dt+"' have open quote.",U(j,$));let Lt=lt.value;if($=lt.index,Lt[Lt.length-1]==="/"){const J=$-Lt.length;Lt=Lt.substring(0,Lt.length-1);const ut=A(Lt,tt);if(ut===!0)Q=!0;else return S(ut.err.code,ut.err.msg,U(j,J+ut.err.line))}else if(Gt)if(lt.tagClosed){if(Lt.trim().length>0)return S("InvalidTag","Closing tag '"+dt+"' can't have attributes or invalid starting.",U(j,zt));if(K.length===0)return S("InvalidTag","Closing tag '"+dt+"' has not been opened.",U(j,zt));{const J=K.pop();if(dt!==J.tagName){let ut=U(j,J.tagStartPos);return S("InvalidTag","Expected closing tag '"+J.tagName+"' (opened in line "+ut.line+", col "+ut.col+") instead of closing tag '"+dt+"'.",U(j,zt))}K.length==0&&(pt=!0)}}else return S("InvalidTag","Closing tag '"+dt+"' doesn't have proper closing.",U(j,$));else{const J=A(Lt,tt);if(J!==!0)return S(J.err.code,J.err.msg,U(j,$-Lt.length+J.err.line));if(pt===!0)return S("InvalidXml","Multiple possible root nodes found.",U(j,$));tt.unpairedTags.indexOf(dt)!==-1||K.push({tagName:dt,tagStartPos:zt}),Q=!0}for($++;$<j.length;$++)if(j[$]==="<")if(j[$+1]==="!"){$++,$=r(j,$);continue}else if(j[$+1]==="?"){if($=n(j,++$),$.err)return $}else break;else if(j[$]==="&"){const J=C(j,$);if(J==-1)return S("InvalidChar","char '&' is not expected.",U(j,$));$=J}else if(pt===!0&&!i(j[$]))return S("InvalidXml","Extra text at the end",U(j,$));j[$]==="<"&&$--}}else{if(i(j[$]))continue;return S("InvalidChar","char '"+j[$]+"' is not expected.",U(j,$))}if(Q){if(K.length==1)return S("InvalidTag","Unclosed tag '"+K[0].tagName+"'.",U(j,K[0].tagStartPos));if(K.length>0)return S("InvalidXml","Invalid '"+JSON.stringify(K.map($=>$.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return S("InvalidXml","Start tag expected.",1);return!0};function i(j){return j===" "||j==="	"||j===`
`||j==="\r"}function n(j,tt){const K=tt;for(;tt<j.length;tt++)if(j[tt]=="?"||j[tt]==" "){const Q=j.substr(K,tt-K);if(tt>5&&Q==="xml")return S("InvalidXml","XML declaration allowed only at the start of the document.",U(j,tt));if(j[tt]=="?"&&j[tt+1]==">"){tt++;break}else continue}return tt}function r(j,tt){if(j.length>tt+5&&j[tt+1]==="-"&&j[tt+2]==="-"){for(tt+=3;tt<j.length;tt++)if(j[tt]==="-"&&j[tt+1]==="-"&&j[tt+2]===">"){tt+=2;break}}else if(j.length>tt+8&&j[tt+1]==="D"&&j[tt+2]==="O"&&j[tt+3]==="C"&&j[tt+4]==="T"&&j[tt+5]==="Y"&&j[tt+6]==="P"&&j[tt+7]==="E"){let K=1;for(tt+=8;tt<j.length;tt++)if(j[tt]==="<")K++;else if(j[tt]===">"&&(K--,K===0))break}else if(j.length>tt+9&&j[tt+1]==="["&&j[tt+2]==="C"&&j[tt+3]==="D"&&j[tt+4]==="A"&&j[tt+5]==="T"&&j[tt+6]==="A"&&j[tt+7]==="["){for(tt+=8;tt<j.length;tt++)if(j[tt]==="]"&&j[tt+1]==="]"&&j[tt+2]===">"){tt+=2;break}}return tt}const s='"',o="'";function c(j,tt){let K="",Q="",pt=!1;for(;tt<j.length;tt++){if(j[tt]===s||j[tt]===o)Q===""?Q=j[tt]:Q!==j[tt]||(Q="");else if(j[tt]===">"&&Q===""){pt=!0;break}K+=j[tt]}return Q!==""?!1:{value:K,index:tt,tagClosed:pt}}const h=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function A(j,tt){const K=e.getAllMatches(j,h),Q={};for(let pt=0;pt<K.length;pt++){if(K[pt][1].length===0)return S("InvalidAttr","Attribute '"+K[pt][2]+"' has no space in starting.",H(K[pt]));if(K[pt][3]!==void 0&&K[pt][4]===void 0)return S("InvalidAttr","Attribute '"+K[pt][2]+"' is without value.",H(K[pt]));if(K[pt][3]===void 0&&!tt.allowBooleanAttributes)return S("InvalidAttr","boolean attribute '"+K[pt][2]+"' is not allowed.",H(K[pt]));const $=K[pt][2];if(!L($))return S("InvalidAttr","Attribute '"+$+"' is an invalid name.",H(K[pt]));if(!Q.hasOwnProperty($))Q[$]=1;else return S("InvalidAttr","Attribute '"+$+"' is repeated.",H(K[pt]))}return!0}function _(j,tt){let K=/\d/;for(j[tt]==="x"&&(tt++,K=/[\da-fA-F]/);tt<j.length;tt++){if(j[tt]===";")return tt;if(!j[tt].match(K))break}return-1}function C(j,tt){if(tt++,j[tt]===";")return-1;if(j[tt]==="#")return tt++,_(j,tt);let K=0;for(;tt<j.length;tt++,K++)if(!(j[tt].match(/\w/)&&K<20)){if(j[tt]===";")break;return-1}return tt}function S(j,tt,K){return{err:{code:j,msg:tt,line:K.line||K,col:K.col}}}function L(j){return e.isName(j)}function N(j){return e.isName(j)}function U(j,tt){const K=j.substring(0,tt).split(/\r?\n/);return{line:K.length,col:K[K.length-1].length+1}}function H(j){return j.startIndex+j[1].length}return Bx}var Ly={},sL;function Tut(){if(sL)return Ly;sL=1;const e={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(i,n){return n},attributeValueProcessor:function(i,n){return n},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(i,n,r){return i}},t=function(i){return Object.assign({},e,i)};return Ly.buildOptions=t,Ly.defaultOptions=e,Ly}var Sx,aL;function Sut(){if(aL)return Sx;aL=1;class e{constructor(i){this.tagname=i,this.child=[],this[":@"]={}}add(i,n){i==="__proto__"&&(i="#__proto__"),this.child.push({[i]:n})}addChild(i){i.tagname==="__proto__"&&(i.tagname="#__proto__"),i[":@"]&&Object.keys(i[":@"]).length>0?this.child.push({[i.tagname]:i.child,":@":i[":@"]}):this.child.push({[i.tagname]:i.child})}}return Sx=e,Sx}var Ix,cL;function Iut(){if(cL)return Ix;cL=1;const e=Tx();function t(A,_){const C={};if(A[_+3]==="O"&&A[_+4]==="C"&&A[_+5]==="T"&&A[_+6]==="Y"&&A[_+7]==="P"&&A[_+8]==="E"){_=_+9;let S=1,L=!1,N=!1,U="";for(;_<A.length;_++)if(A[_]==="<"&&!N){if(L&&r(A,_))_+=7,[entityName,val,_]=i(A,_+1),val.indexOf("&")===-1&&(C[h(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(L&&s(A,_))_+=8;else if(L&&o(A,_))_+=8;else if(L&&c(A,_))_+=9;else if(n)N=!0;else throw new Error("Invalid DOCTYPE");S++,U=""}else if(A[_]===">"){if(N?A[_-1]==="-"&&A[_-2]==="-"&&(N=!1,S--):S--,S===0)break}else A[_]==="["?L=!0:U+=A[_];if(S!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:C,i:_}}function i(A,_){let C="";for(;_<A.length&&A[_]!=="'"&&A[_]!=='"';_++)C+=A[_];if(C=C.trim(),C.indexOf(" ")!==-1)throw new Error("External entites are not supported");const S=A[_++];let L="";for(;_<A.length&&A[_]!==S;_++)L+=A[_];return[C,L,_]}function n(A,_){return A[_+1]==="!"&&A[_+2]==="-"&&A[_+3]==="-"}function r(A,_){return A[_+1]==="!"&&A[_+2]==="E"&&A[_+3]==="N"&&A[_+4]==="T"&&A[_+5]==="I"&&A[_+6]==="T"&&A[_+7]==="Y"}function s(A,_){return A[_+1]==="!"&&A[_+2]==="E"&&A[_+3]==="L"&&A[_+4]==="E"&&A[_+5]==="M"&&A[_+6]==="E"&&A[_+7]==="N"&&A[_+8]==="T"}function o(A,_){return A[_+1]==="!"&&A[_+2]==="A"&&A[_+3]==="T"&&A[_+4]==="T"&&A[_+5]==="L"&&A[_+6]==="I"&&A[_+7]==="S"&&A[_+8]==="T"}function c(A,_){return A[_+1]==="!"&&A[_+2]==="N"&&A[_+3]==="O"&&A[_+4]==="T"&&A[_+5]==="A"&&A[_+6]==="T"&&A[_+7]==="I"&&A[_+8]==="O"&&A[_+9]==="N"}function h(A){if(e.isName(A))return A;throw new Error(`Invalid entity name ${A}`)}return Ix=t,Ix}var Mx,lL;function Mut(){if(lL)return Mx;lL=1;const e=/^[-+]?0x[a-fA-F0-9]+$/,t=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const i={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function n(s,o={}){if(o=Object.assign({},i,o),!s||typeof s!="string")return s;let c=s.trim();if(o.skipLike!==void 0&&o.skipLike.test(c))return s;if(o.hex&&e.test(c))return Number.parseInt(c,16);{const h=t.exec(c);if(h){const A=h[1],_=h[2];let C=r(h[3]);const S=h[4]||h[6];if(!o.leadingZeros&&_.length>0&&A&&c[2]!=="."||!o.leadingZeros&&_.length>0&&!A&&c[1]!==".")return s;{const L=Number(c),N=""+L;return N.search(/[eE]/)!==-1||S?o.eNotation?L:s:c.indexOf(".")!==-1?N==="0"&&C===""||N===C||A&&N==="-"+C?L:s:_?C===N||A+C===N?L:s:c===N||c===A+N?L:s}}else return s}}function r(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}return Mx=n,Mx}var Px,uL;function Put(){if(uL)return Px;uL=1;const e=Tx(),t=Sut(),i=Iut(),n=Mut();class r{constructor(pt){this.options=pt,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:($,zt)=>String.fromCharCode(Number.parseInt(zt,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:($,zt)=>String.fromCharCode(Number.parseInt(zt,16))}},this.addExternalEntities=s,this.parseXml=_,this.parseTextData=o,this.resolveNameSpace=c,this.buildAttributesMap=A,this.isItStopNode=N,this.replaceEntitiesValue=S,this.readStopNodeData=tt,this.saveTextToParentTag=L,this.addChild=C}}function s(Q){const pt=Object.keys(Q);for(let $=0;$<pt.length;$++){const zt=pt[$];this.lastEntities[zt]={regex:new RegExp("&"+zt+";","g"),val:Q[zt]}}}function o(Q,pt,$,zt,Gt,dt,lt){if(Q!==void 0&&(this.options.trimValues&&!zt&&(Q=Q.trim()),Q.length>0)){lt||(Q=this.replaceEntitiesValue(Q));const Lt=this.options.tagValueProcessor(pt,Q,$,Gt,dt);return Lt==null?Q:typeof Lt!=typeof Q||Lt!==Q?Lt:this.options.trimValues?K(Q,this.options.parseTagValue,this.options.numberParseOptions):Q.trim()===Q?K(Q,this.options.parseTagValue,this.options.numberParseOptions):Q}}function c(Q){if(this.options.removeNSPrefix){const pt=Q.split(":"),$=Q.charAt(0)==="/"?"/":"";if(pt[0]==="xmlns")return"";pt.length===2&&(Q=$+pt[1])}return Q}const h=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function A(Q,pt,$){if(!this.options.ignoreAttributes&&typeof Q=="string"){const zt=e.getAllMatches(Q,h),Gt=zt.length,dt={};for(let lt=0;lt<Gt;lt++){const Lt=this.resolveNameSpace(zt[lt][1]);let J=zt[lt][4],ut=this.options.attributeNamePrefix+Lt;if(Lt.length)if(this.options.transformAttributeName&&(ut=this.options.transformAttributeName(ut)),ut==="__proto__"&&(ut="#__proto__"),J!==void 0){this.options.trimValues&&(J=J.trim()),J=this.replaceEntitiesValue(J);const Et=this.options.attributeValueProcessor(Lt,J,pt);Et==null?dt[ut]=J:typeof Et!=typeof J||Et!==J?dt[ut]=Et:dt[ut]=K(J,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(dt[ut]=!0)}if(!Object.keys(dt).length)return;if(this.options.attributesGroupName){const lt={};return lt[this.options.attributesGroupName]=dt,lt}return dt}}const _=function(Q){Q=Q.replace(/\r\n?/g,`
`);const pt=new t("!xml");let $=pt,zt="",Gt="";for(let dt=0;dt<Q.length;dt++)if(Q[dt]==="<")if(Q[dt+1]==="/"){const lt=H(Q,">",dt,"Closing Tag is not closed.");let Lt=Q.substring(dt+2,lt).trim();if(this.options.removeNSPrefix){const Et=Lt.indexOf(":");Et!==-1&&(Lt=Lt.substr(Et+1))}this.options.transformTagName&&(Lt=this.options.transformTagName(Lt)),$&&(zt=this.saveTextToParentTag(zt,$,Gt));const J=Gt.substring(Gt.lastIndexOf(".")+1);if(Lt&&this.options.unpairedTags.indexOf(Lt)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${Lt}>`);let ut=0;J&&this.options.unpairedTags.indexOf(J)!==-1?(ut=Gt.lastIndexOf(".",Gt.lastIndexOf(".")-1),this.tagsNodeStack.pop()):ut=Gt.lastIndexOf("."),Gt=Gt.substring(0,ut),$=this.tagsNodeStack.pop(),zt="",dt=lt}else if(Q[dt+1]==="?"){let lt=j(Q,dt,!1,"?>");if(!lt)throw new Error("Pi Tag is not closed.");if(zt=this.saveTextToParentTag(zt,$,Gt),!(this.options.ignoreDeclaration&&lt.tagName==="?xml"||this.options.ignorePiTags)){const Lt=new t(lt.tagName);Lt.add(this.options.textNodeName,""),lt.tagName!==lt.tagExp&&lt.attrExpPresent&&(Lt[":@"]=this.buildAttributesMap(lt.tagExp,Gt,lt.tagName)),this.addChild($,Lt,Gt)}dt=lt.closeIndex+1}else if(Q.substr(dt+1,3)==="!--"){const lt=H(Q,"-->",dt+4,"Comment is not closed.");if(this.options.commentPropName){const Lt=Q.substring(dt+4,lt-2);zt=this.saveTextToParentTag(zt,$,Gt),$.add(this.options.commentPropName,[{[this.options.textNodeName]:Lt}])}dt=lt}else if(Q.substr(dt+1,2)==="!D"){const lt=i(Q,dt);this.docTypeEntities=lt.entities,dt=lt.i}else if(Q.substr(dt+1,2)==="!["){const lt=H(Q,"]]>",dt,"CDATA is not closed.")-2,Lt=Q.substring(dt+9,lt);zt=this.saveTextToParentTag(zt,$,Gt);let J=this.parseTextData(Lt,$.tagname,Gt,!0,!1,!0,!0);J==null&&(J=""),this.options.cdataPropName?$.add(this.options.cdataPropName,[{[this.options.textNodeName]:Lt}]):$.add(this.options.textNodeName,J),dt=lt+2}else{let lt=j(Q,dt,this.options.removeNSPrefix),Lt=lt.tagName;const J=lt.rawTagName;let ut=lt.tagExp,Et=lt.attrExpPresent,le=lt.closeIndex;this.options.transformTagName&&(Lt=this.options.transformTagName(Lt)),$&&zt&&$.tagname!=="!xml"&&(zt=this.saveTextToParentTag(zt,$,Gt,!1));const Ct=$;if(Ct&&this.options.unpairedTags.indexOf(Ct.tagname)!==-1&&($=this.tagsNodeStack.pop(),Gt=Gt.substring(0,Gt.lastIndexOf("."))),Lt!==pt.tagname&&(Gt+=Gt?"."+Lt:Lt),this.isItStopNode(this.options.stopNodes,Gt,Lt)){let Rt="";if(ut.length>0&&ut.lastIndexOf("/")===ut.length-1)Lt[Lt.length-1]==="/"?(Lt=Lt.substr(0,Lt.length-1),Gt=Gt.substr(0,Gt.length-1),ut=Lt):ut=ut.substr(0,ut.length-1),dt=lt.closeIndex;else if(this.options.unpairedTags.indexOf(Lt)!==-1)dt=lt.closeIndex;else{const Zt=this.readStopNodeData(Q,J,le+1);if(!Zt)throw new Error(`Unexpected end of ${J}`);dt=Zt.i,Rt=Zt.tagContent}const Nt=new t(Lt);Lt!==ut&&Et&&(Nt[":@"]=this.buildAttributesMap(ut,Gt,Lt)),Rt&&(Rt=this.parseTextData(Rt,Lt,Gt,!0,Et,!0,!0)),Gt=Gt.substr(0,Gt.lastIndexOf(".")),Nt.add(this.options.textNodeName,Rt),this.addChild($,Nt,Gt)}else{if(ut.length>0&&ut.lastIndexOf("/")===ut.length-1){Lt[Lt.length-1]==="/"?(Lt=Lt.substr(0,Lt.length-1),Gt=Gt.substr(0,Gt.length-1),ut=Lt):ut=ut.substr(0,ut.length-1),this.options.transformTagName&&(Lt=this.options.transformTagName(Lt));const Rt=new t(Lt);Lt!==ut&&Et&&(Rt[":@"]=this.buildAttributesMap(ut,Gt,Lt)),this.addChild($,Rt,Gt),Gt=Gt.substr(0,Gt.lastIndexOf("."))}else{const Rt=new t(Lt);this.tagsNodeStack.push($),Lt!==ut&&Et&&(Rt[":@"]=this.buildAttributesMap(ut,Gt,Lt)),this.addChild($,Rt,Gt),$=Rt}zt="",dt=le}}else zt+=Q[dt];return pt.child};function C(Q,pt,$){const zt=this.options.updateTag(pt.tagname,$,pt[":@"]);zt===!1||(typeof zt=="string"&&(pt.tagname=zt),Q.addChild(pt))}const S=function(Q){if(this.options.processEntities){for(let pt in this.docTypeEntities){const $=this.docTypeEntities[pt];Q=Q.replace($.regx,$.val)}for(let pt in this.lastEntities){const $=this.lastEntities[pt];Q=Q.replace($.regex,$.val)}if(this.options.htmlEntities)for(let pt in this.htmlEntities){const $=this.htmlEntities[pt];Q=Q.replace($.regex,$.val)}Q=Q.replace(this.ampEntity.regex,this.ampEntity.val)}return Q};function L(Q,pt,$,zt){return Q&&(zt===void 0&&(zt=Object.keys(pt.child).length===0),Q=this.parseTextData(Q,pt.tagname,$,!1,pt[":@"]?Object.keys(pt[":@"]).length!==0:!1,zt),Q!==void 0&&Q!==""&&pt.add(this.options.textNodeName,Q),Q=""),Q}function N(Q,pt,$){const zt="*."+$;for(const Gt in Q){const dt=Q[Gt];if(zt===dt||pt===dt)return!0}return!1}function U(Q,pt,$=">"){let zt,Gt="";for(let dt=pt;dt<Q.length;dt++){let lt=Q[dt];if(zt)lt===zt&&(zt="");else if(lt==='"'||lt==="'")zt=lt;else if(lt===$[0])if($[1]){if(Q[dt+1]===$[1])return{data:Gt,index:dt}}else return{data:Gt,index:dt};else lt==="	"&&(lt=" ");Gt+=lt}}function H(Q,pt,$,zt){const Gt=Q.indexOf(pt,$);if(Gt===-1)throw new Error(zt);return Gt+pt.length-1}function j(Q,pt,$,zt=">"){const Gt=U(Q,pt+1,zt);if(!Gt)return;let dt=Gt.data;const lt=Gt.index,Lt=dt.search(/\s/);let J=dt,ut=!0;Lt!==-1&&(J=dt.substring(0,Lt),dt=dt.substring(Lt+1).trimStart());const Et=J;if($){const le=J.indexOf(":");le!==-1&&(J=J.substr(le+1),ut=J!==Gt.data.substr(le+1))}return{tagName:J,tagExp:dt,closeIndex:lt,attrExpPresent:ut,rawTagName:Et}}function tt(Q,pt,$){const zt=$;let Gt=1;for(;$<Q.length;$++)if(Q[$]==="<")if(Q[$+1]==="/"){const dt=H(Q,">",$,`${pt} is not closed`);if(Q.substring($+2,dt).trim()===pt&&(Gt--,Gt===0))return{tagContent:Q.substring(zt,$),i:dt};$=dt}else if(Q[$+1]==="?")$=H(Q,"?>",$+1,"StopNode is not closed.");else if(Q.substr($+1,3)==="!--")$=H(Q,"-->",$+3,"StopNode is not closed.");else if(Q.substr($+1,2)==="![")$=H(Q,"]]>",$,"StopNode is not closed.")-2;else{const dt=j(Q,$,">");dt&&((dt&&dt.tagName)===pt&&dt.tagExp[dt.tagExp.length-1]!=="/"&&Gt++,$=dt.closeIndex)}}function K(Q,pt,$){if(pt&&typeof Q=="string"){const zt=Q.trim();return zt==="true"?!0:zt==="false"?!1:n(Q,$)}else return e.isExist(Q)?Q:""}return Px=r,Px}var Rx={},hL;function Rut(){if(hL)return Rx;hL=1;function e(s,o){return t(s,o)}function t(s,o,c){let h;const A={};for(let _=0;_<s.length;_++){const C=s[_],S=i(C);let L="";if(c===void 0?L=S:L=c+"."+S,S===o.textNodeName)h===void 0?h=C[S]:h+=""+C[S];else{if(S===void 0)continue;if(C[S]){let N=t(C[S],o,L);const U=r(N,o);C[":@"]?n(N,C[":@"],L,o):Object.keys(N).length===1&&N[o.textNodeName]!==void 0&&!o.alwaysCreateTextNode?N=N[o.textNodeName]:Object.keys(N).length===0&&(o.alwaysCreateTextNode?N[o.textNodeName]="":N=""),A[S]!==void 0&&A.hasOwnProperty(S)?(Array.isArray(A[S])||(A[S]=[A[S]]),A[S].push(N)):o.isArray(S,L,U)?A[S]=[N]:A[S]=N}}}return typeof h=="string"?h.length>0&&(A[o.textNodeName]=h):h!==void 0&&(A[o.textNodeName]=h),A}function i(s){const o=Object.keys(s);for(let c=0;c<o.length;c++){const h=o[c];if(h!==":@")return h}}function n(s,o,c,h){if(o){const A=Object.keys(o),_=A.length;for(let C=0;C<_;C++){const S=A[C];h.isArray(S,c+"."+S,!0,!0)?s[S]=[o[S]]:s[S]=o[S]}}}function r(s,o){const{textNodeName:c}=o,h=Object.keys(s).length;return!!(h===0||h===1&&(s[c]||typeof s[c]=="boolean"||s[c]===0))}return Rx.prettify=e,Rx}var Dx,fL;function Dut(){if(fL)return Dx;fL=1;const{buildOptions:e}=Tut(),t=Put(),{prettify:i}=Rut(),n=oL();class r{constructor(o){this.externalEntities={},this.options=e(o)}parse(o,c){if(typeof o!="string")if(o.toString)o=o.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(c){c===!0&&(c={});const _=n.validate(o,c);if(_!==!0)throw Error(`${_.err.msg}:${_.err.line}:${_.err.col}`)}const h=new t(this.options);h.addExternalEntities(this.externalEntities);const A=h.parseXml(o);return this.options.preserveOrder||A===void 0?A:i(A,this.options)}addEntity(o,c){if(c.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(o.indexOf("&")!==-1||o.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(c==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[o]=c}}return Dx=r,Dx}var Ox,dL;function Out(){if(dL)return Ox;dL=1;const e=`
`;function t(c,h){let A="";return h.format&&h.indentBy.length>0&&(A=e),i(c,h,"",A)}function i(c,h,A,_){let C="",S=!1;for(let L=0;L<c.length;L++){const N=c[L],U=n(N);if(U===void 0)continue;let H="";if(A.length===0?H=U:H=`${A}.${U}`,U===h.textNodeName){let pt=N[U];s(H,h)||(pt=h.tagValueProcessor(U,pt),pt=o(pt,h)),S&&(C+=_),C+=pt,S=!1;continue}else if(U===h.cdataPropName){S&&(C+=_),C+=`<![CDATA[${N[U][0][h.textNodeName]}]]>`,S=!1;continue}else if(U===h.commentPropName){C+=_+`<!--${N[U][0][h.textNodeName]}-->`,S=!0;continue}else if(U[0]==="?"){const pt=r(N[":@"],h),$=U==="?xml"?"":_;let zt=N[U][0][h.textNodeName];zt=zt.length!==0?" "+zt:"",C+=$+`<${U}${zt}${pt}?>`,S=!0;continue}let j=_;j!==""&&(j+=h.indentBy);const tt=r(N[":@"],h),K=_+`<${U}${tt}`,Q=i(N[U],h,H,j);h.unpairedTags.indexOf(U)!==-1?h.suppressUnpairedNode?C+=K+">":C+=K+"/>":(!Q||Q.length===0)&&h.suppressEmptyNode?C+=K+"/>":Q&&Q.endsWith(">")?C+=K+`>${Q}${_}</${U}>`:(C+=K+">",Q&&_!==""&&(Q.includes("/>")||Q.includes("</"))?C+=_+h.indentBy+Q+_:C+=Q,C+=`</${U}>`),S=!0}return C}function n(c){const h=Object.keys(c);for(let A=0;A<h.length;A++){const _=h[A];if(c.hasOwnProperty(_)&&_!==":@")return _}}function r(c,h){let A="";if(c&&!h.ignoreAttributes)for(let _ in c){if(!c.hasOwnProperty(_))continue;let C=h.attributeValueProcessor(_,c[_]);C=o(C,h),C===!0&&h.suppressBooleanAttributes?A+=` ${_.substr(h.attributeNamePrefix.length)}`:A+=` ${_.substr(h.attributeNamePrefix.length)}="${C}"`}return A}function s(c,h){c=c.substr(0,c.length-h.textNodeName.length-1);let A=c.substr(c.lastIndexOf(".")+1);for(let _ in h.stopNodes)if(h.stopNodes[_]===c||h.stopNodes[_]==="*."+A)return!0;return!1}function o(c,h){if(c&&c.length>0&&h.processEntities)for(let A=0;A<h.entities.length;A++){const _=h.entities[A];c=c.replace(_.regex,_.val)}return c}return Ox=t,Ox}var Lx,pL;function Lut(){if(pL)return Lx;pL=1;const e=Out(),t={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(o,c){return c},attributeValueProcessor:function(o,c){return c},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function i(o){this.options=Object.assign({},t,o),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=s),this.processTextOrObjNode=n,this.options.format?(this.indentate=r,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}i.prototype.build=function(o){return this.options.preserveOrder?e(o,this.options):(Array.isArray(o)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(o={[this.options.arrayNodeName]:o}),this.j2x(o,0).val)},i.prototype.j2x=function(o,c){let h="",A="";for(let _ in o)if(Object.prototype.hasOwnProperty.call(o,_))if(typeof o[_]>"u")this.isAttribute(_)&&(A+="");else if(o[_]===null)this.isAttribute(_)?A+="":_[0]==="?"?A+=this.indentate(c)+"<"+_+"?"+this.tagEndChar:A+=this.indentate(c)+"<"+_+"/"+this.tagEndChar;else if(o[_]instanceof Date)A+=this.buildTextValNode(o[_],_,"",c);else if(typeof o[_]!="object"){const C=this.isAttribute(_);if(C)h+=this.buildAttrPairStr(C,""+o[_]);else if(_===this.options.textNodeName){let S=this.options.tagValueProcessor(_,""+o[_]);A+=this.replaceEntitiesValue(S)}else A+=this.buildTextValNode(o[_],_,"",c)}else if(Array.isArray(o[_])){const C=o[_].length;let S="",L="";for(let N=0;N<C;N++){const U=o[_][N];if(!(typeof U>"u"))if(U===null)_[0]==="?"?A+=this.indentate(c)+"<"+_+"?"+this.tagEndChar:A+=this.indentate(c)+"<"+_+"/"+this.tagEndChar;else if(typeof U=="object")if(this.options.oneListGroup){const H=this.j2x(U,c+1);S+=H.val,this.options.attributesGroupName&&U.hasOwnProperty(this.options.attributesGroupName)&&(L+=H.attrStr)}else S+=this.processTextOrObjNode(U,_,c);else if(this.options.oneListGroup){let H=this.options.tagValueProcessor(_,U);H=this.replaceEntitiesValue(H),S+=H}else S+=this.buildTextValNode(U,_,"",c)}this.options.oneListGroup&&(S=this.buildObjectNode(S,_,L,c)),A+=S}else if(this.options.attributesGroupName&&_===this.options.attributesGroupName){const C=Object.keys(o[_]),S=C.length;for(let L=0;L<S;L++)h+=this.buildAttrPairStr(C[L],""+o[_][C[L]])}else A+=this.processTextOrObjNode(o[_],_,c);return{attrStr:h,val:A}},i.prototype.buildAttrPairStr=function(o,c){return c=this.options.attributeValueProcessor(o,""+c),c=this.replaceEntitiesValue(c),this.options.suppressBooleanAttributes&&c==="true"?" "+o:" "+o+'="'+c+'"'};function n(o,c,h){const A=this.j2x(o,h+1);return o[this.options.textNodeName]!==void 0&&Object.keys(o).length===1?this.buildTextValNode(o[this.options.textNodeName],c,A.attrStr,h):this.buildObjectNode(A.val,c,A.attrStr,h)}i.prototype.buildObjectNode=function(o,c,h,A){if(o==="")return c[0]==="?"?this.indentate(A)+"<"+c+h+"?"+this.tagEndChar:this.indentate(A)+"<"+c+h+this.closeTag(c)+this.tagEndChar;{let _="</"+c+this.tagEndChar,C="";return c[0]==="?"&&(C="?",_=""),(h||h==="")&&o.indexOf("<")===-1?this.indentate(A)+"<"+c+h+C+">"+o+_:this.options.commentPropName!==!1&&c===this.options.commentPropName&&C.length===0?this.indentate(A)+`<!--${o}-->`+this.newLine:this.indentate(A)+"<"+c+h+C+this.tagEndChar+o+this.indentate(A)+_}},i.prototype.closeTag=function(o){let c="";return this.options.unpairedTags.indexOf(o)!==-1?this.options.suppressUnpairedNode||(c="/"):this.options.suppressEmptyNode?c="/":c=`></${o}`,c},i.prototype.buildTextValNode=function(o,c,h,A){if(this.options.cdataPropName!==!1&&c===this.options.cdataPropName)return this.indentate(A)+`<![CDATA[${o}]]>`+this.newLine;if(this.options.commentPropName!==!1&&c===this.options.commentPropName)return this.indentate(A)+`<!--${o}-->`+this.newLine;if(c[0]==="?")return this.indentate(A)+"<"+c+h+"?"+this.tagEndChar;{let _=this.options.tagValueProcessor(c,o);return _=this.replaceEntitiesValue(_),_===""?this.indentate(A)+"<"+c+h+this.closeTag(c)+this.tagEndChar:this.indentate(A)+"<"+c+h+">"+_+"</"+c+this.tagEndChar}},i.prototype.replaceEntitiesValue=function(o){if(o&&o.length>0&&this.options.processEntities)for(let c=0;c<this.options.entities.length;c++){const h=this.options.entities[c];o=o.replace(h.regex,h.val)}return o};function r(o){return this.options.indentBy.repeat(o)}function s(o){return o.startsWith(this.options.attributeNamePrefix)&&o!==this.options.textNodeName?o.substr(this.attrPrefixLen):!1}return Lx=i,Lx}var Fx,AL;function Fut(){if(AL)return Fx;AL=1;const e=oL(),t=Dut(),i=Lut();return Fx={XMLParser:t,XMLValidator:e,XMLBuilder:i},Fx}var kut=Fut();function gL(e,t){if(t?._parser&&t._parser!=="fast-xml-parser")throw new Error(t?._parser);const i={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:t?.removeNSPrefix,textNodeName:t?.textNodeName,isArray:(r,s,o,c)=>!!t?.arrayPaths?.some(h=>s===h),...t?._fastXML},n=Nut(e,i);return t?.uncapitalizeKeys?Ex(n):n}function Nut(e,t){return new kut.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...t}).parse(e)}const Uut="4.3.1",pp={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:Uut,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:zut,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(e,t)=>gL(new TextDecoder().decode(e),{...pp.options.xml,...t?.xml}),parseTextSync:(e,t)=>gL(e,{...pp.options.xml,...t?.xml})};function zut(e){return e.startsWith("<?xml")}async function ff(e,t,i,n){return n._parse(e,t,i,n)}function mr(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const mL=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),yL=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);yL&&parseFloat(yL[1]);function Gut(e,t){return vL(e||{},t)}function vL(e,t,i=0){if(i>3)return t;const n={...e};for(const[r,s]of Object.entries(t))s&&typeof s=="object"&&!Array.isArray(s)?n[r]=vL(n[r]||{},t[r],i+1):n[r]=t[r];return n}function jut(e){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,e)}function Vut(e){return globalThis.loaders?.modules?.[e]||null}function Hut(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.1"),globalThis._loadersgl_.version}const Wut=Hut();function Jut(e,t){if(!e)throw new Error("loaders.gl assertion failed.")}const Lg=typeof process!="object"||String(process)!=="[object process]"||process.browser,kx=typeof importScripts=="function",_L=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);_L&&parseFloat(_L[1]);const Nx={};async function df(e,t=null,i={},n=null){return t&&(e=Xut(e,t,i,n)),Nx[e]=Nx[e]||Qut(e),await Nx[e]}function Xut(e,t,i={},n=null){if(!i.useLocalLibraries&&e.startsWith("http"))return e;n=n||e;const r=i.modules||{};return r[n]?r[n]:Lg?i.CDN?(Jut(i.CDN.startsWith("http")),`${i.CDN}/${t}@${Wut}/dist/libs/${n}`):kx?`../src/libs/${n}`:`modules/${t}/src/libs/${n}`:`modules/${t}/dist/libs/${n}`}async function Qut(e){if(e.endsWith("wasm"))return await qut(e);if(!Lg)try{const{requireFromFile:i}=globalThis.loaders||{};return await i?.(e)}catch(i){return console.error(i),null}if(kx)return importScripts(e);const t=await Zut(e);return Kut(t,e)}function Kut(e,t){if(!Lg){const{requireFromString:n}=globalThis.loaders||{};return n?.(e,t)}if(kx)return eval.call(globalThis,e),null;const i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e))}catch{i.text=e}return document.body.appendChild(i),null}async function qut(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return Lg||!t||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await t(e)}async function Zut(e){const{readFileAsText:t}=globalThis.loaders||{};return Lg||!t||e.startsWith("http")?await(await fetch(e)).text():await t(e)}function Yut(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?bL(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?bL(e,0,t):""}function bL(e,t,i){if(e.byteLength<=t+i)return"";const n=new DataView(e);let r="";for(let s=0;s<i;s++)r+=String.fromCharCode(n.getUint8(t+s));return r}function xL(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${Yut(e)}"`)}}function Fg(e,t,i){const n=i!==void 0?new Uint8Array(e).subarray(t,t+i):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}function tu(e,t){return mr(e>=0),mr(t>0),e+(t-1)&-4}function wL(e,t,i){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{const r=e.byteOffset,s=e.byteLength;n=new Uint8Array(e.buffer||e.arrayBuffer,r,s)}return t.set(n,i),i+tu(n.byteLength,4)}const $ut="Queued Requests",tht="Active Requests",eht="Cancelled Requests",iht="Queued Requests Ever",nht="Active Requests Ever",rht={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class CL{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(t={}){this.props={...rht,...t},this.stats=new u4({id:this.props.id}),this.stats.get($ut),this.stats.get(tht),this.stats.get(eht),this.stats.get(iht),this.stats.get(nht)}scheduleRequest(t,i=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const n={handle:t,priority:0,getPriority:i},r=new Promise(s=>(n.resolve=s,n));return this.requestQueue.push(n),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:i,resolve:n}=t;let r=!1;const s=()=>{r||(r=!0,this.requestMap.delete(i),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let i=0;i<t;++i){const n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){const t=this.requestQueue;for(let i=0;i<t.length;++i){const n=t[i];this._updateRequest(n)||(t.splice(i,1),this.requestMap.delete(n.handle),i--)}t.sort((i,n)=>i.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}function oht(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function EL(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function sht(...e){const t=[];for(let s=0;s<e.length;s++)t[s]=e[s];let i="",n=!1,r;for(let s=t.length-1;s>=-1&&!n;s--){let o;s>=0?o=t[s]:(r===void 0&&(r=oht()),o=r),o.length!==0&&(i=`${o}/${i}`,n=o.charCodeAt(0)===kg)}return i=aht(i,!n),n?`/${i}`:i.length>0?i:"."}const kg=47,Ux=46;function aht(e,t){let i="",n=-1,r=0,s,o=!1;for(let c=0;c<=e.length;++c){if(c<e.length)s=e.charCodeAt(c);else{if(s===kg)break;s=kg}if(s===kg){if(!(n===c-1||r===1))if(n!==c-1&&r===2){if(i.length<2||!o||i.charCodeAt(i.length-1)!==Ux||i.charCodeAt(i.length-2)!==Ux){if(i.length>2){const h=i.length-1;let A=h;for(;A>=0&&i.charCodeAt(A)!==kg;--A);if(A!==h){i=A===-1?"":i.slice(0,A),n=c,r=0,o=!1;continue}}else if(i.length===2||i.length===1){i="",n=c,r=0,o=!1;continue}}t&&(i.length>0?i+="/..":i="..",o=!0)}else{const h=e.slice(n+1,c);i.length>0?i+=`/${h}`:i=h,o=!1}n=c,r=0}else s===Ux&&r!==-1?++r:r=-1}return i}class cht{fetch;loadOptions;_needsRefresh=!0;props;constructor(t){this.props={...t},this.loadOptions={...t.loadOptions},this.fetch=lht(this.loadOptions)}setProps(t){this.props=Object.assign(this.props,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(t=!0){const i=this._needsRefresh;return t&&(this._needsRefresh=!1),i}}function lht(e){const t=e?.fetch;if(t&&typeof t=="function")return(n,r)=>t(n,r);const i=e?.fetch;return i&&typeof i!="function"?n=>fetch(n,i):n=>fetch(n)}class zx extends cht{static type="template";static testURL=t=>!1}function uht(e,t){const i=pp.parseTextSync?.(e,t),n=i?.ServiceExceptionReport?.ServiceException||i?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof n=="string"?n:n.value||n.code||"Unknown error"}const hht="4.3.1",Fy={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:hht,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:fht,options:{wms:{throwOnError:!1}},parse:async(e,t)=>Gx(new TextDecoder().decode(e),t),parseSync:(e,t)=>Gx(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>Gx(e,t)};function fht(e){return e.startsWith("<?xml")}function Gx(e,t){const i={...Fy.options.wms,...t?.wms},n=uht(e,i),r=i.minimalErrors?n:`WMS Service error: ${n}`;if(i.throwOnError)throw new Error(r);return r}function Ap(e){return Array.isArray(e)?e:e?[e]:[]}function ky(e){const t=Ap(e);return t.length>0&&t.every(i=>typeof i=="string")?t:[]}function Ny(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseFloat(e);default:return}}function jx(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseInt(e,10);default:return}}function gp(e){switch(e){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function BL(e,t){const i=pp.parseTextSync?.(e,t),n=i.WMT_MS_Capabilities||i.WMS_Capabilities||i,r=dht(n);if(t?.inheritedLayerProps)for(const s of r.layers)SL(s,null);return t?.includeRawJSON&&(r.json=n),t?.includeXMLText&&(r.xml=e),r}function dht(e){const t={version:String(e.version||""),name:String(e.Service?.Name||"unnamed"),title:e.Service?.Title?String(e.Service?.Title):void 0,abstract:e.Service?.Abstract?String(e.Service?.Abstract):void 0,keywords:ky(e.Service?.KeywordList?.Keyword),fees:e.Service?.Fees?JSON.stringify(e.Service?.Fees):void 0,accessConstraints:e.Service?.AccessConstraints?JSON.stringify(e.Service?.AccessConstraints):void 0,layerLimit:jx(e.Service?.LayerLimit),maxWidth:jx(e.Service?.maxWidth),maxHeight:jx(e.Service?.maxHeight),layers:[],requests:pht(e.Capability?.Request),exceptions:Aht(e.Exception)},i=Ap(e.Capability?.Layer);for(const n of i)t.layers.push(TL(n));for(const[n,r]of Object.entries(t))r===void 0&&delete t[n];return t}function pht(e){const t={};for(const[i,n]of Object.entries(e||{})){const r=ky(n?.Format);t[i]={mimeTypes:r}}return t}function Aht(e){if(Ap(e?.Format).length>0)return{mimeTypes:ky(e)}}function TL(e){const t={title:String(e?.Title||""),name:e?.Name&&String(e?.Name),abstract:e?.Name&&String(e?.Abstract),keywords:ky(e.KeywordList?.Keyword)},i=e?.CRS||e?.SRS;i&&Array.isArray(i)&&i.every(h=>typeof h=="string")&&(t.crs=i);let n=e?.EX_GeographicBoundingBox&&ght(e?.EX_GeographicBoundingBox);n&&(t.geographicBoundingBox=n),n=e?.LatLonBoundingBox&&mht(e?.LatLonBoundingBox),n&&(t.geographicBoundingBox=n);const r=e?.BoundingBox&&yht(e?.BoundingBox);r&&r.length>0&&(t.boundingBoxes=r);const s=Ap(e?.Dimension).map(h=>_ht(h));s.length&&(t.dimensions=s),e?.opaque&&(t.opaque=gp(e?.opaque)),e?.cascaded&&(t.cascaded=gp(e?.cascaded)),e?.queryable&&(t.queryable=gp(e?.queryable));const o=Ap(e?.Layer),c=[];for(const h of o)c.push(TL(h));c.length>0&&(t.layers=c);for(const[h,A]of Object.entries(t))A===void 0&&delete t[h];return t}function ght(e){const{westBoundLongitude:t,northBoundLatitude:i,eastBoundLongitude:n,southBoundLatitude:r}=e;return[[t,r],[n,i]]}function mht(e){const{minx:t,miny:i,maxx:n,maxy:r}=e;return[[t,i],[n,r]]}function yht(e){return Ap(e).map(t=>vht(t))}function vht(e){const{CRS:t,SRS:i,minx:n,miny:r,maxx:s,maxy:o,resx:c,resy:h}=e,A={crs:t||i,boundingBox:[[Ny(n),Ny(r)],[Ny(s),Ny(o)]]};return c&&(A.xResolution=c),h&&(A.yResolution=h),A}function _ht(e){const{name:t,units:i,value:n}=e,r={name:t,units:i,extent:n};return e.unitSymbol&&(r.unitSymbol=e.unitSymbol),e.default&&(r.defaultValue=e.default),e.multipleValues&&(r.multipleValues=gp(e.multipleValues)),e.nearestValue&&(r.nearestValue=gp(e.nearestValue)),e.current&&(r.current=gp(e.current)),r}function SL(e,t){t?.geographicBoundingBox&&!e.geographicBoundingBox&&(e.geographicBoundingBox=[...t.geographicBoundingBox]),t?.crs&&!e.crs&&(e.crs=[...t.crs]),t?.boundingBoxes&&!e.boundingBoxes&&(e.boundingBoxes=[...t.boundingBoxes]),t?.dimensions&&!e.dimensions&&(e.dimensions=[...t.dimensions]);for(const i of e.layers||[])SL(i,e)}const bht="4.3.1",Vx={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:bht,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:xht,options:{wms:{}},parse:async(e,t)=>BL(new TextDecoder().decode(e),t?.wms),parseTextSync:(e,t)=>BL(e,t?.wms)};function xht(e){return e.startsWith("<?xml")}function IL(e,t){const i=(pp.parseTextSync?.(e,t)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(i)?i:[i]).map(n=>wht(n))}}function wht(e){return{attributes:e||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}const Cht={...Vx,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(e,t)=>IL(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>IL(e,t)};function ML(e,t){return pp.parseTextSync?.(e,t)}const Eht={...Vx,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(e,t)=>ML(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>ML(e,t)},Bht="4.3.1",Tht=globalThis.loaders?.parseImageNode,Hx=typeof Image<"u",Wx=typeof ImageBitmap<"u",Sht=!!Tht,Jx=mL?!0:Sht;function Iht(e){switch(e){case"auto":return Wx||Hx||Jx;case"imagebitmap":return Wx;case"image":return Hx;case"data":return Jx;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function Mht(){if(Wx)return"imagebitmap";if(Hx)return"image";if(Jx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Pht(e){const t=Rht(e);if(!t)throw new Error("Not an image");return t}function Xx(e){switch(Pht(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function Rht(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const Dht=/^data:image\/svg\+xml/,Oht=/\.svg((\?|#).*)?$/;function Qx(e){return e&&(Dht.test(e)||Oht.test(e))}function Lht(e,t){if(Qx(t)){let i=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(n){throw new Error(n.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return PL(e,t)}function PL(e,t){if(Qx(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function RL(e,t,i){const n=Lht(e,i),r=self.URL||self.webkitURL,s=typeof n!="string"&&r.createObjectURL(n);try{return await Fht(s||n,t)}finally{s&&r.revokeObjectURL(s)}}async function Fht(e,t){const i=new Image;return i.src=e,t.image&&t.image.decode&&i.decode?(await i.decode(),i):await new Promise((n,r)=>{try{i.onload=()=>n(i),i.onerror=s=>{const o=s instanceof Error?s.message:"error";r(new Error(o))}}catch(s){r(s)}})}const kht={};let DL=!0;async function Nht(e,t,i){let n;Qx(i)?n=await RL(e,t,i):n=PL(e,i);const r=t&&t.imagebitmap;return await Uht(n,r)}async function Uht(e,t=null){if((zht(t)||!DL)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(i){console.warn(i),DL=!1}return await createImageBitmap(e)}function zht(e){for(const t in e||kht)return!1;return!0}function Ght(e){return!Wht(e,"ftyp",4)||(e[8]&96)===0?null:jht(e)}function jht(e){switch(Vht(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Vht(e,t,i){return String.fromCharCode(...e.slice(t,i))}function Hht(e){return[...e].map(t=>t.charCodeAt(0))}function Wht(e,t,i=0){const n=Hht(t);for(let r=0;r<n.length;++r)if(n[r]!==e[r+i])return!1;return!0}const fl=!1,Ng=!0;function Uy(e){const t=Ug(e);return Xht(t)||qht(t)||Qht(t)||Kht(t)||Jht(t)}function Jht(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),i=Ght(t);return i?{mimeType:i.mimeType,width:0,height:0}:null}function Xht(e){const t=Ug(e);return t.byteLength>=24&&t.getUint32(0,fl)===2303741511?{mimeType:"image/png",width:t.getUint32(16,fl),height:t.getUint32(20,fl)}:null}function Qht(e){const t=Ug(e);return t.byteLength>=10&&t.getUint32(0,fl)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Ng),height:t.getUint16(8,Ng)}:null}function Kht(e){const t=Ug(e);return t.byteLength>=14&&t.getUint16(0,fl)===16973&&t.getUint32(2,Ng)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Ng),height:t.getUint32(22,Ng)}:null}function qht(e){const t=Ug(e);if(!(t.byteLength>=3&&t.getUint16(0,fl)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=Zht();let r=2;for(;r+9<t.byteLength;){const s=t.getUint16(r,fl);if(n.has(s))return{mimeType:"image/jpeg",height:t.getUint16(r+5,fl),width:t.getUint16(r+7,fl)};if(!i.has(s))return null;r+=2,r+=t.getUint16(r,fl)}return null}function Zht(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ug(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function Yht(e,t){const{mimeType:i}=Uy(e)||{},n=globalThis.loaders?.parseImageNode;return mr(n),await n(e,i)}async function $ht(e,t,i){t=t||{};const n=(t.image||{}).type||"auto",{url:r}=i||{},s=tft(n);let o;switch(s){case"imagebitmap":o=await Nht(e,t,r);break;case"image":o=await RL(e,t,r);break;case"data":o=await Yht(e);break;default:mr(!1)}return n==="data"&&(o=Xx(o)),o}function tft(e){switch(e){case"auto":case"data":return Mht();default:return Iht(e),e}}const eft=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],ift=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],nft={image:{type:"auto",decode:!0}},zy={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:Bht,mimeTypes:ift,extensions:eft,parse:$ht,tests:[e=>!!Uy(new DataView(e))],options:nft},Kx={};function OL(e){if(Kx[e]===void 0){const t=mL?oft(e):rft(e);Kx[e]=t}return Kx[e]}function rft(e){const t=["image/png","image/jpeg","image/gif"],i=globalThis.loaders?.imageFormatsNode||t;return!!globalThis.loaders?.parseImageNode&&i.includes(e)}function oft(e){switch(e){case"image/avif":case"image/webp":return sft(e);default:return!0}}function sft(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}const aft={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:e=>e.toLowerCase().includes("wms"),createDataSource:(e,t)=>new cft(e,t)};class cft extends zx{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(t,i){super(i),this.url=t,this.data=t,this.substituteCRS84=i.wms?.substituteCRS84??i.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...i.wmsParameters,...i.wms?.wmsParameters},this.vendorParameters=i.wms?.vendorParameters||i.vendorParameters||{}}async getMetadata(){const t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){const{boundingBox:i,bbox:n,...r}=t,s={bbox:i?[...i[0],...i[1]]:n,...r};return await this.getMap(s)}normalizeMetadata(t){return t}async getCapabilities(t,i){const n=this.getCapabilitiesURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();this._checkResponse(r,s);const o=await Vx.parse(s,this.loadOptions);return this.capabilities=o,o}async getMap(t,i){const n=this.getMapURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();this._checkResponse(r,s);try{return await zy.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(t,i){const n=this.getFeatureInfoURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();return this._checkResponse(r,s),await Cht.parse(s,this.loadOptions)}async getFeatureInfoText(t,i){const n=this.getFeatureInfoURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();return this._checkResponse(r,s),new TextDecoder().decode(s)}async describeLayer(t,i){const n=this.describeLayerURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();return this._checkResponse(r,s),await Eht.parse(s,this.loadOptions)}async getLegendGraphic(t,i){const n=this.getLegendGraphicURL(t,i),r=await this.fetch(n),s=await r.arrayBuffer();this._checkResponse(r,s);try{return await zy.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(t,i){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetCapabilities",n,i)}getMapURL(t,i){t=this._getWMS130Parameters(t);const n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetMap",n,i)}getFeatureInfoURL(t,i){t=this._getWMS130Parameters(t);const{boundingBox:n,bbox:r}=t;t.bbox=n?[...n[0],...n[1]]:r;const s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetFeatureInfo",s,i)}describeLayerURL(t,i){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("DescribeLayer",n,i)}getLegendGraphicURL(t,i){const n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetLegendGraphic",n,i)}_parseWMSUrl(t){const[i,n]=t.split("?"),r=n.split("&"),s={};for(const o of r){const[c,h]=o.split("=");s[c]=h}return{url:i,parameters:s}}_getWMSUrl(t,i,n){let r=this.url,s=!0;const o={service:"WMS",version:i.version,request:t,...i,...this.vendorParameters,...n},c=["transparent","time","elevation"];for(const[h,A]of Object.entries(o))(!c.includes(h)||A)&&(r+=s?"?":"&",s=!1,r+=this._getURLParameter(h,A,i));return encodeURI(r)}_getWMS130Parameters(t){const i={...t};return i.srs&&(i.crs=i.crs||i.srs,delete i.srs),i}_getURLParameter(t,i,n){switch(t){case"crs":n.version!=="1.3.0"?t="srs":this.substituteCRS84&&i==="EPSG:4326"&&(i="CRS:84");break;case"srs":n.version==="1.3.0"&&(t="crs");break;case"bbox":const r=this._flipBoundingBox(i,n);r&&(i=r);break;case"x":n.version==="1.3.0"&&(t="i");break;case"y":n.version==="1.3.0"&&(t="j");break}return t=t.toUpperCase(),Array.isArray(i)?`${t}=${i.join(",")}`:`${t}=${i?String(i):""}`}_flipBoundingBox(t,i){if(!Array.isArray(t)||t.length!==4)return null;const n=i.version==="1.3.0"&&this.flipCRS.includes(i.crs||"")&&!(this.substituteCRS84&&i.crs==="EPSG:4326"),r=t;return n?[r[1],r[0],r[3],r[2]]:r}async _fetchArrayBuffer(t){const i=await this.fetch(t),n=await i.arrayBuffer();return this._checkResponse(i,n),n}_checkResponse(t,i){const n=t.headers["content-type"];if(!t.ok||Fy.mimeTypes.includes(n)){const r=Gut(this.loadOptions,{wms:{throwOnError:!0}}),s=Fy.parseSync?.(i,r);throw new Error(s)}}_parseError(t){const i=Fy.parseSync?.(t,this.loadOptions);return new Error(i)}}const lft={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:e=>e.toLowerCase().includes("ImageServer"),createDataSource:(e,t)=>new uft(e,t)};class uft extends zx{url;data;constructor(t,i){super(i),this.url=t,this.data=t}async getMetadata(){return await this.metadata()}async getImage(t){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(t){throw new Error("not implemented")}metadataURL(t){return`${this.url}?f=pjson`}exportImageURL(t){const i=`bbox=${t.bbox[0]},${t.bbox[1]},${t.bbox[2]},${t.bbox[3]}`,n=`size=${t.width},${t.height}`,r={...t,bbox:i,size:n};return delete r.width,delete r.height,this.getUrl("exportImage",r)}getUrl(t,i,n){let r=`${this.url}/${t}`,s=!0;for(const[o,c]of Object.entries(i))r+=s?"?":"&",s=!1,Array.isArray(c)?r+=`${o.toUpperCase()}=${c.join(",")}`:r+=`${o.toUpperCase()}=${c?String(c):""}`;return r}async checkResponse(t){if(!t.ok)throw new Error("error")}}const hft=[aft,lft];function fft(e,t=hft){const{type:i="auto"}=e,n=i==="auto"?pft(e.url,t):dft(i,t);if(!n)throw new Error("Not a valid image source type");return n.createDataSource(e.url,e)}function dft(e,t){for(const i of t)if(i.type===e)return i;return null}function pft(e,t){for(const i of t)if(i.testURL&&i.testURL(e))return i;return null}const LL=6378137*Math.PI;function FL(e){const t=Xl(e);return t[0]=(t[0]/256-1)*LL,t[1]=(t[1]/256-1)*LL,t}const Aft={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(e,t)=>console.error(t,e)}};class qx extends To{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:t,props:i,oldProps:n}){const{viewport:r}=this.context;t.dataChanged||i.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(i),this._loadMetadata(),this.debounce(()=>this.loadImage(r,"image source changed"),0)):Yr(i.layers,n.layers,1)?t.viewportChanged&&this.debounce(()=>this.loadImage(r,"viewport changed")):this.debounce(()=>this.loadImage(r,"layers changed"),0)}finalizeState(){}renderLayers(){const{bounds:t,image:i,lastRequestParameters:n}=this.state;return i&&new _y({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?$i.LNGLAT:$i.CARTESIAN,bounds:t,image:i})}async getFeatureInfoText(t,i){const{lastRequestParameters:n}=this.state;return n?await this.state.imageSource.getFeatureInfoText?.({...n,query_layers:n.layers,x:t,y:i,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(t){if(t.data instanceof zx)return t.data;if(typeof t.data=="string")return fft({url:t.data,loadOptions:t.loadOptions,type:t.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){const{imageSource:t}=this.state;try{this.state.loadCounter++;const i=await t.getMetadata();this.state.imageSource===t&&this.getCurrentLayer()?.props.onMetadataLoad(i)}catch(i){this.getCurrentLayer()?.props.onMetadataLoadError(i)}finally{this.state.loadCounter--}}async loadImage(t,i){const{layers:n,serviceType:r}=this.props;if(r==="wms"&&n.length===0)return;const s=t.getBounds(),{width:o,height:c}=t,h=this.getRequestId();let{srs:A}=this.props;A==="auto"&&(A=t.resolution?"EPSG:4326":"EPSG:3857");const _={width:o,height:c,boundingBox:[[s[0],s[1]],[s[2],s[3]]],layers:n,crs:A};if(A==="EPSG:3857"){const C=FL([s[0],s[1]]),S=FL([s[2],s[3]]);_.boundingBox=[C,S]}try{this.state.loadCounter++,this.props.onImageLoadStart(h);const C=await this.state.imageSource.getImage(_);this.state.lastRequestId<h&&(this.getCurrentLayer()?.props.onImageLoad(h),this.setState({image:C,bounds:s,lastRequestParameters:_,lastRequestId:h}))}catch(C){this.raiseError(C,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(h,C)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(t,i=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>t(),i)}}qx.layerName="WMSLayer",qx.defaultProps=Aft;const gft={getHeight:{type:"accessor",value:0},greatCircle:!0};class Zx extends Bg{}Zx.layerName="GreatCircleLayer",Zx.defaultProps=gft;const mft={...oh.defaultProps};class sh extends To{indexToBounds(){return null}renderLayers(){const{elevationScale:t,extruded:i,wireframe:n,filled:r,stroked:s,lineWidthUnits:o,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:A,lineJointRounded:_,lineMiterLimit:C,lineDashJustified:S,getElevation:L,getFillColor:N,getLineColor:U,getLineWidth:H}=this.props,{updateTriggers:j,material:tt,transitions:K}=this.props,Q=this.getSubLayerClass("cell",oh),{updateTriggers:pt,...$}=this.indexToBounds()||{};return new Q({filled:r,wireframe:n,extruded:i,elevationScale:t,stroked:s,lineWidthUnits:o,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:A,lineJointRounded:_,lineMiterLimit:C,lineDashJustified:S,material:tt,transitions:K,getElevation:L,getFillColor:N,getLineColor:U,getLineWidth:H},this.getSubLayerProps({id:"cell",updateTriggers:j&&{...pt,getElevation:j.getElevation,getFillColor:j.getFillColor,getLineColor:j.getLineColor,getLineWidth:j.getLineWidth}}),$)}}sh.layerName="GeoCellLayer",sh.defaultProps=mft;function yft(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Yx={exports:{}},vft=Yx.exports,kL;function _ft(){return kL||(kL=1,function(e){/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */(function(t,i){typeof yft=="function"&&e&&e.exports?e.exports=i():(t.dcodeIO=t.dcodeIO||{}).Long=i()})(vft,function(){function t(lt,Lt,J){this.low=lt|0,this.high=Lt|0,this.unsigned=!!J}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function i(lt){return(lt&&lt.__isLong__)===!0}t.isLong=i;var n={},r={};function s(lt,Lt){var J,ut,Et;return Lt?(lt>>>=0,(Et=0<=lt&&lt<256)&&(ut=r[lt],ut)?ut:(J=c(lt,(lt|0)<0?-1:0,!0),Et&&(r[lt]=J),J)):(lt|=0,(Et=-128<=lt&&lt<128)&&(ut=n[lt],ut)?ut:(J=c(lt,lt<0?-1:0,!1),Et&&(n[lt]=J),J))}t.fromInt=s;function o(lt,Lt){if(isNaN(lt)||!isFinite(lt))return Lt?tt:j;if(Lt){if(lt<0)return tt;if(lt>=N)return zt}else{if(lt<=-U)return Gt;if(lt+1>=U)return $}return lt<0?o(-lt,Lt).neg():c(lt%L|0,lt/L|0,Lt)}t.fromNumber=o;function c(lt,Lt,J){return new t(lt,Lt,J)}t.fromBits=c;var h=Math.pow;function A(lt,Lt,J){if(lt.length===0)throw Error("empty string");if(lt==="NaN"||lt==="Infinity"||lt==="+Infinity"||lt==="-Infinity")return j;if(typeof Lt=="number"?(J=Lt,Lt=!1):Lt=!!Lt,J=J||10,J<2||36<J)throw RangeError("radix");var ut;if((ut=lt.indexOf("-"))>0)throw Error("interior hyphen");if(ut===0)return A(lt.substring(1),Lt,J).neg();for(var Et=o(h(J,8)),le=j,Ct=0;Ct<lt.length;Ct+=8){var Rt=Math.min(8,lt.length-Ct),Nt=parseInt(lt.substring(Ct,Ct+Rt),J);if(Rt<8){var Zt=o(h(J,Rt));le=le.mul(Zt).add(o(Nt))}else le=le.mul(Et),le=le.add(o(Nt))}return le.unsigned=Lt,le}t.fromString=A;function _(lt){return lt instanceof t?lt:typeof lt=="number"?o(lt):typeof lt=="string"?A(lt):c(lt.low,lt.high,lt.unsigned)}t.fromValue=_;var C=65536,S=1<<24,L=C*C,N=L*L,U=N/2,H=s(S),j=s(0);t.ZERO=j;var tt=s(0,!0);t.UZERO=tt;var K=s(1);t.ONE=K;var Q=s(1,!0);t.UONE=Q;var pt=s(-1);t.NEG_ONE=pt;var $=c(-1,2147483647,!1);t.MAX_VALUE=$;var zt=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=zt;var Gt=c(0,-2147483648,!1);t.MIN_VALUE=Gt;var dt=t.prototype;return dt.toInt=function(){return this.unsigned?this.low>>>0:this.low},dt.toNumber=function(){return this.unsigned?(this.high>>>0)*L+(this.low>>>0):this.high*L+(this.low>>>0)},dt.toString=function(lt){if(lt=lt||10,lt<2||36<lt)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Gt)){var Lt=o(lt),J=this.div(Lt),ut=J.mul(Lt).sub(this);return J.toString(lt)+ut.toInt().toString(lt)}else return"-"+this.neg().toString(lt);for(var Et=o(h(lt,6),this.unsigned),le=this,Ct="";;){var Rt=le.div(Et),Nt=le.sub(Rt.mul(Et)).toInt()>>>0,Zt=Nt.toString(lt);if(le=Rt,le.isZero())return Zt+Ct;for(;Zt.length<6;)Zt="0"+Zt;Ct=""+Zt+Ct}},dt.getHighBits=function(){return this.high},dt.getHighBitsUnsigned=function(){return this.high>>>0},dt.getLowBits=function(){return this.low},dt.getLowBitsUnsigned=function(){return this.low>>>0},dt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Gt)?64:this.neg().getNumBitsAbs();for(var lt=this.high!=0?this.high:this.low,Lt=31;Lt>0&&(lt&1<<Lt)==0;Lt--);return this.high!=0?Lt+33:Lt+1},dt.isZero=function(){return this.high===0&&this.low===0},dt.isNegative=function(){return!this.unsigned&&this.high<0},dt.isPositive=function(){return this.unsigned||this.high>=0},dt.isOdd=function(){return(this.low&1)===1},dt.isEven=function(){return(this.low&1)===0},dt.equals=function(lt){return i(lt)||(lt=_(lt)),this.unsigned!==lt.unsigned&&this.high>>>31===1&&lt.high>>>31===1?!1:this.high===lt.high&&this.low===lt.low},dt.eq=dt.equals,dt.notEquals=function(lt){return!this.eq(lt)},dt.neq=dt.notEquals,dt.lessThan=function(lt){return this.comp(lt)<0},dt.lt=dt.lessThan,dt.lessThanOrEqual=function(lt){return this.comp(lt)<=0},dt.lte=dt.lessThanOrEqual,dt.greaterThan=function(lt){return this.comp(lt)>0},dt.gt=dt.greaterThan,dt.greaterThanOrEqual=function(lt){return this.comp(lt)>=0},dt.gte=dt.greaterThanOrEqual,dt.compare=function(lt){if(i(lt)||(lt=_(lt)),this.eq(lt))return 0;var Lt=this.isNegative(),J=lt.isNegative();return Lt&&!J?-1:!Lt&&J?1:this.unsigned?lt.high>>>0>this.high>>>0||lt.high===this.high&&lt.low>>>0>this.low>>>0?-1:1:this.sub(lt).isNegative()?-1:1},dt.comp=dt.compare,dt.negate=function(){return!this.unsigned&&this.eq(Gt)?Gt:this.not().add(K)},dt.neg=dt.negate,dt.add=function(lt){i(lt)||(lt=_(lt));var Lt=this.high>>>16,J=this.high&65535,ut=this.low>>>16,Et=this.low&65535,le=lt.high>>>16,Ct=lt.high&65535,Rt=lt.low>>>16,Nt=lt.low&65535,Zt=0,re=0,se=0,de=0;return de+=Et+Nt,se+=de>>>16,de&=65535,se+=ut+Rt,re+=se>>>16,se&=65535,re+=J+Ct,Zt+=re>>>16,re&=65535,Zt+=Lt+le,Zt&=65535,c(se<<16|de,Zt<<16|re,this.unsigned)},dt.subtract=function(lt){return i(lt)||(lt=_(lt)),this.add(lt.neg())},dt.sub=dt.subtract,dt.multiply=function(lt){if(this.isZero()||(i(lt)||(lt=_(lt)),lt.isZero()))return j;if(this.eq(Gt))return lt.isOdd()?Gt:j;if(lt.eq(Gt))return this.isOdd()?Gt:j;if(this.isNegative())return lt.isNegative()?this.neg().mul(lt.neg()):this.neg().mul(lt).neg();if(lt.isNegative())return this.mul(lt.neg()).neg();if(this.lt(H)&&lt.lt(H))return o(this.toNumber()*lt.toNumber(),this.unsigned);var Lt=this.high>>>16,J=this.high&65535,ut=this.low>>>16,Et=this.low&65535,le=lt.high>>>16,Ct=lt.high&65535,Rt=lt.low>>>16,Nt=lt.low&65535,Zt=0,re=0,se=0,de=0;return de+=Et*Nt,se+=de>>>16,de&=65535,se+=ut*Nt,re+=se>>>16,se&=65535,se+=Et*Rt,re+=se>>>16,se&=65535,re+=J*Nt,Zt+=re>>>16,re&=65535,re+=ut*Rt,Zt+=re>>>16,re&=65535,re+=Et*Ct,Zt+=re>>>16,re&=65535,Zt+=Lt*Nt+J*Rt+ut*Ct+Et*le,Zt&=65535,c(se<<16|de,Zt<<16|re,this.unsigned)},dt.mul=dt.multiply,dt.divide=function(lt){if(i(lt)||(lt=_(lt)),lt.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?tt:j;var Lt,J,ut;if(this.unsigned){if(lt.unsigned||(lt=lt.toUnsigned()),lt.gt(this))return tt;if(lt.gt(this.shru(1)))return Q;ut=tt}else{if(this.eq(Gt)){if(lt.eq(K)||lt.eq(pt))return Gt;if(lt.eq(Gt))return K;var Et=this.shr(1);return Lt=Et.div(lt).shl(1),Lt.eq(j)?lt.isNegative()?K:pt:(J=this.sub(lt.mul(Lt)),ut=Lt.add(J.div(lt)),ut)}else if(lt.eq(Gt))return this.unsigned?tt:j;if(this.isNegative())return lt.isNegative()?this.neg().div(lt.neg()):this.neg().div(lt).neg();if(lt.isNegative())return this.div(lt.neg()).neg();ut=j}for(J=this;J.gte(lt);){Lt=Math.max(1,Math.floor(J.toNumber()/lt.toNumber()));for(var le=Math.ceil(Math.log(Lt)/Math.LN2),Ct=le<=48?1:h(2,le-48),Rt=o(Lt),Nt=Rt.mul(lt);Nt.isNegative()||Nt.gt(J);)Lt-=Ct,Rt=o(Lt,this.unsigned),Nt=Rt.mul(lt);Rt.isZero()&&(Rt=K),ut=ut.add(Rt),J=J.sub(Nt)}return ut},dt.div=dt.divide,dt.modulo=function(lt){return i(lt)||(lt=_(lt)),this.sub(this.div(lt).mul(lt))},dt.mod=dt.modulo,dt.not=function(){return c(~this.low,~this.high,this.unsigned)},dt.and=function(lt){return i(lt)||(lt=_(lt)),c(this.low&lt.low,this.high&lt.high,this.unsigned)},dt.or=function(lt){return i(lt)||(lt=_(lt)),c(this.low|lt.low,this.high|lt.high,this.unsigned)},dt.xor=function(lt){return i(lt)||(lt=_(lt)),c(this.low^lt.low,this.high^lt.high,this.unsigned)},dt.shiftLeft=function(lt){return i(lt)&&(lt=lt.toInt()),(lt&=63)===0?this:lt<32?c(this.low<<lt,this.high<<lt|this.low>>>32-lt,this.unsigned):c(0,this.low<<lt-32,this.unsigned)},dt.shl=dt.shiftLeft,dt.shiftRight=function(lt){return i(lt)&&(lt=lt.toInt()),(lt&=63)===0?this:lt<32?c(this.low>>>lt|this.high<<32-lt,this.high>>lt,this.unsigned):c(this.high>>lt-32,this.high>=0?0:-1,this.unsigned)},dt.shr=dt.shiftRight,dt.shiftRightUnsigned=function(lt){if(i(lt)&&(lt=lt.toInt()),lt&=63,lt===0)return this;var Lt=this.high;if(lt<32){var J=this.low;return c(J>>>lt|Lt<<32-lt,Lt>>>lt,this.unsigned)}else return lt===32?c(Lt,0,this.unsigned):c(Lt>>>lt-32,0,this.unsigned)},dt.shru=dt.shiftRightUnsigned,dt.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},dt.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},dt.toBytes=function(lt){return lt?this.toBytesLE():this.toBytesBE()},dt.toBytesLE=function(){var lt=this.high,Lt=this.low;return[Lt&255,Lt>>>8&255,Lt>>>16&255,Lt>>>24&255,lt&255,lt>>>8&255,lt>>>16&255,lt>>>24&255]},dt.toBytesBE=function(){var lt=this.high,Lt=this.low;return[lt>>>24&255,lt>>>16&255,lt>>>8&255,lt&255,Lt>>>24&255,Lt>>>16&255,Lt>>>8&255,Lt&255]},t})}(Yx)),Yx.exports}var bft=_ft();const Gy=zh(bft),xft=3,wft=30,Cft=2*wft+1,NL=180/Math.PI;function Eft(e,t,i){const n=1<<t;return[(e[0]+i[0])/n,(e[1]+i[1])/n]}function UL(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function Bft(e){return[UL(e[0]),UL(e[1])]}function Tft(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function Sft([e,t,i]){const n=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*NL,n*NL]}function Ift(e){let t=Gy.fromString(e,!0,10).toString(2);for(;t.length<xft+Cft;)t="0"+t;const i=t.lastIndexOf("1"),n=t.substring(0,3),r=t.substring(3,i),s=r.length/2,o=Gy.fromString(n,!0,2).toString(10);let c=Gy.fromString(r,!0,2).toString(4);for(;c.length<s;)c="0"+c;return`${o}/${c}`}function Mft(e,t,i,n){if(n===0){i===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function Pft(e){const t=e.split("/"),i=parseInt(t[0],10),n=t[1],r=n.length,s=[0,0];let o;for(let c=r-1;c>=0;c--){o=r-c;const h=n[c];let A=0,_=0;h==="1"?_=1:h==="2"?(A=1,_=1):h==="3"&&(A=1);const C=Math.pow(2,o-1);Mft(C,s,A,_),s[0]+=C*A,s[1]+=C*_}if(i%2===1){const c=s[0];s[0]=s[1],s[1]=c}return{face:i,ij:s,level:o}}function Rft(e){const t=e.padEnd(16,"0");return Gy.fromString(t,16)}const Dft=100;function Oft({face:e,ij:t,level:i}){const n=[[0,0],[0,1],[1,1],[1,0],[0,0]],r=Math.max(1,Math.ceil(Dft*Math.pow(2,-i))),s=new Float64Array(4*r*2+2);let o=0,c=0;for(let h=0;h<4;h++){const A=n[h].slice(0),_=n[h+1],C=(_[0]-A[0])/r,S=(_[1]-A[1])/r;for(let L=0;L<r;L++){A[0]+=C,A[1]+=S;const N=Eft(t,i,A),U=Bft(N),H=Tft(e,U),j=Sft(H);Math.abs(j[1])>89.999&&(j[0]=c);const tt=j[0]-c;j[0]+=tt>180?-360:tt<-180?360:0,s[o++]=j[0],s[o++]=j[1],c=j[0]}}return s[o++]=s[0],s[o++]=s[1],s}function Lft(e){if(typeof e=="string"){if(e.indexOf("/")>0)return e;e=Rft(e)}return Ift(e.toString())}function Fft(e){const t=Lft(e),i=Pft(t);return Oft(i)}const kft={getS2Token:{type:"accessor",value:e=>e.token}};class jy extends sh{indexToBounds(){const{data:t,getS2Token:i}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,r)=>Fft(i(n,r))}}}jy.layerName="S2Layer",jy.defaultProps=kft;const $x=512;function Nft(e,t){let i=0,n=0,r=1<<e.length;const s=r/$x;for(let o=0;o<e.length;o++){r>>=1;const c=parseInt(e[o]);c%2&&(i|=r),c>1&&(n|=r)}return[[i/s,$x-n/s],[(i+t)/s,$x-(n+t)/s]]}function Uft(e,t=1){const[i,n]=Nft(e,t),[r,s]=rl(i),[o,c]=rl(n);return[o,s,o,c,r,c,r,s,o,s]}const zft={getQuadkey:{type:"accessor",value:e=>e.quadkey}};class Vy extends sh{indexToBounds(){const{data:t,extruded:i,getQuadkey:n}=this.props,r=i?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>Uft(n(s,o),r),updateTriggers:{getPolygon:r}}}}Vy.layerName="QuadkeyLayer",Vy.defaultProps=zft;class zL{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:i,onLoad:n,onError:r}){const{index:s,id:o,bbox:c,userData:h,zoom:A}=this,_=this._loaderId;this._abortController=new AbortController;const{signal:C}=this._abortController,S=await i.scheduleRequest(this,U=>U.isSelected?1:-1);if(!S){this._isCancelled=!0;return}if(this._isCancelled){S.done();return}let L=null,N;try{L=await t({index:s,id:o,bbox:c,userData:h,zoom:A,signal:C})}catch(U){N=U||!0}finally{S.done()}if(_===this._loaderId){if(this._loader=void 0,this.content=L,this._isCancelled&&!L){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,N?r(N,this):n(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}}const gs={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},jL=new fe,Gft=new fe;class UE{constructor(t=[0,0,0],i=[0,0,0],n){n=n||jL.copy(t).add(i).scale(.5),this.center=new fe(n),this.halfDiagonal=new fe(i).subtract(this.center),this.minimum=new fe(t),this.maximum=new fe(i)}clone(){return new UE(this.minimum,this.maximum,this.center)}equals(t){return this===t||!!t&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){const{halfDiagonal:i}=this,n=Gft.from(t.normal),r=i.x*Math.abs(n.x)+i.y*Math.abs(n.y)+i.z*Math.abs(n.z),s=this.center.dot(n)+t.distance;return s-r>0?gs.INSIDE:s+r<0?gs.OUTSIDE:gs.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const i=jL.from(t).subtract(this.center),{halfDiagonal:n}=this;let r=0,s;return s=Math.abs(i.x)-n.x,s>0&&(r+=s*s),s=Math.abs(i.y)-n.y,s>0&&(r+=s*s),s=Math.abs(i.z)-n.z,s>0&&(r+=s*s),r}}const zg=new fe,VL=new fe;class em{constructor(t=[0,0,0],i=0){this.radius=-0,this.center=new fe,this.fromCenterRadius(t,i)}fromCenterRadius(t,i){return this.center.from(t),this.radius=i,this}fromCornerPoints(t,i){return i=zg.from(i),this.center=new fe().from(t).add(i).scale(.5),this.radius=this.center.distance(i),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new em(this.center,this.radius)}union(t){const i=this.center,n=this.radius,r=t.center,s=t.radius,o=zg.copy(r).subtract(i),c=o.magnitude();if(n>=c+s)return this.clone();if(s>=c+n)return t.clone();const h=(n+c+s)*.5;return VL.copy(o).scale((-n+h)/c).add(i),this.center.copy(VL),this.radius=h,this}expand(t){const i=zg.from(t).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(t){this.center.transform(t);const i=lH(zg,t);return this.radius=Math.max(i[0],Math.max(i[1],i[2]))*this.radius,this}distanceSquaredTo(t){const i=this.distanceTo(t);return i*i}distanceTo(t){const i=zg.from(t).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(t){const i=this.center,n=this.radius,r=t.normal.dot(i)+t.distance;return r<-n?gs.OUTSIDE:r<n?gs.INTERSECTING:gs.INSIDE}}const jft=new fe,Vft=new fe,Hy=new fe,Wy=new fe,Jy=new fe,Hft=new fe,Wft=new fe,eu={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class im{constructor(t=[0,0,0],i=[0,0,0,0,0,0,0,0,0]){this.center=new fe().from(t),this.halfAxes=new gr(i)}get halfSize(){const t=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new fe(t).len(),new fe(i).len(),new fe(n).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),i=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),r=new fe(t).normalize(),s=new fe(i).normalize(),o=new fe(n).normalize();return new KA().fromMatrix3(new gr([...r,...s,...o]))}fromCenterHalfSizeQuaternion(t,i,n){const r=new KA(n),s=new gr().fromQuaternion(r);return s[0]=s[0]*i[0],s[1]=s[1]*i[0],s[2]=s[2]*i[0],s[3]=s[3]*i[1],s[4]=s[4]*i[1],s[5]=s[5]*i[1],s[6]=s[6]*i[2],s[7]=s[7]*i[2],s[8]=s[8]*i[2],this.center=new fe().from(t),this.halfAxes=s,this}clone(){return new im(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new em){const i=this.halfAxes,n=i.getColumn(0,Hy),r=i.getColumn(1,Wy),s=i.getColumn(2,Jy),o=jft.copy(n).add(r).add(s);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const i=this.center,n=t.normal,r=this.halfAxes,s=n.x,o=n.y,c=n.z,h=Math.abs(s*r[eu.COLUMN0ROW0]+o*r[eu.COLUMN0ROW1]+c*r[eu.COLUMN0ROW2])+Math.abs(s*r[eu.COLUMN1ROW0]+o*r[eu.COLUMN1ROW1]+c*r[eu.COLUMN1ROW2])+Math.abs(s*r[eu.COLUMN2ROW0]+o*r[eu.COLUMN2ROW1]+c*r[eu.COLUMN2ROW2]),A=n.dot(i)+t.distance;return A<=-h?gs.OUTSIDE:A>=h?gs.INSIDE:gs.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const i=Vft.from(t).subtract(this.center),n=this.halfAxes,r=n.getColumn(0,Hy),s=n.getColumn(1,Wy),o=n.getColumn(2,Jy),c=r.magnitude(),h=s.magnitude(),A=o.magnitude();r.normalize(),s.normalize(),o.normalize();let _=0,C;return C=Math.abs(i.dot(r))-c,C>0&&(_+=C*C),C=Math.abs(i.dot(s))-h,C>0&&(_+=C*C),C=Math.abs(i.dot(o))-A,C>0&&(_+=C*C),_}computePlaneDistances(t,i,n=[-0,-0]){let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,c=this.halfAxes,h=c.getColumn(0,Hy),A=c.getColumn(1,Wy),_=c.getColumn(2,Jy),C=Hft.copy(h).add(A).add(_).add(o),S=Wft.copy(C).subtract(t);let L=i.dot(S);return r=Math.min(L,r),s=Math.max(L,s),C.copy(o).add(h).add(A).subtract(_),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),C.copy(o).add(h).subtract(A).add(_),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),C.copy(o).add(h).subtract(A).subtract(_),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).add(A).add(_),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).add(A).subtract(_),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).subtract(A).add(_),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),o.copy(C).subtract(h).subtract(A).subtract(_),S.copy(C).subtract(t),L=i.dot(S),r=Math.min(L,r),s=Math.max(L,s),n[0]=r,n[1]=s,n}transform(t){this.center.transformAsPoint(t);const i=this.halfAxes.getColumn(0,Hy);i.transformAsPoint(t);const n=this.halfAxes.getColumn(1,Wy);n.transformAsPoint(t);const r=this.halfAxes.getColumn(2,Jy);return r.transformAsPoint(t),this.halfAxes=new gr([...i,...n,...r]),this}getTransform(){throw new Error("not implemented")}}const HL=new fe,WL=new fe;class Ic{constructor(t=[0,0,1],i=0){this.normal=new fe,this.distance=-0,this.fromNormalDistance(t,i)}fromNormalDistance(t,i){return fc(Number.isFinite(i)),this.normal.from(t).normalize(),this.distance=i,this}fromPointNormal(t,i){t=HL.from(t),this.normal.from(i).normalize();const n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,i,n,r){return this.normal.set(t,i,n),fc(ca(this.normal.len(),1)),this.distance=r,this}clone(){return new Ic(this.normal,this.distance)}equals(t){return ca(this.distance,t.distance)&&ca(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const i=WL.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,i)}projectPointOntoPlane(t,i=[0,0,0]){const n=HL.from(t),r=this.getPointDistance(n),s=WL.copy(this.normal).scale(r);return n.subtract(s).to(i)}}const JL=[new fe([1,0,0]),new fe([0,1,0]),new fe([0,0,1])],XL=new fe,Jft=new fe;class ya{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*JL.length;const i=t.center,n=t.radius;let r=0;for(const s of JL){let o=this.planes[r],c=this.planes[r+1];o||(o=this.planes[r]=new Ic),c||(c=this.planes[r+1]=new Ic);const h=XL.copy(s).scale(-n).add(i);o.fromPointNormal(h,s);const A=XL.copy(s).scale(n).add(i),_=Jft.copy(s).negate();c.fromPointNormal(A,_),r+=2}return this}computeVisibility(t){let i=gs.INSIDE;for(const n of this.planes)switch(t.intersectPlane(n)){case gs.OUTSIDE:return gs.OUTSIDE;case gs.INTERSECTING:i=gs.INTERSECTING;break}return i}computeVisibilityWithPlaneMask(t,i){if(fc(Number.isFinite(i),"parentPlaneMask is required."),i===ya.MASK_OUTSIDE||i===ya.MASK_INSIDE)return i;let n=ya.MASK_INSIDE;const r=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&(i&o)===0)continue;const c=r[s],h=t.intersectPlane(c);if(h===gs.OUTSIDE)return ya.MASK_OUTSIDE;h===gs.INTERSECTING&&(n|=o)}return n}}ya.MASK_OUTSIDE=4294967295,ya.MASK_INSIDE=0,ya.MASK_INDETERMINATE=2147483647,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe;const dl=new gr,Xft=new gr,Qft=new gr,Xy=new gr,QL=new gr;function Kft(e,t={}){const i=QH,n=10;let r=0,s=0;const o=Xft,c=Qft;o.identity(),c.copy(e);const h=i*qft(c);for(;s<n&&Zft(c)>h;)Yft(c,Xy),QL.copy(Xy).transpose(),c.multiplyRight(Xy),c.multiplyLeft(QL),o.multiplyRight(Xy),++r>2&&(++s,r=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=c.toTarget(t.diagonal),t}function qft(e){let t=0;for(let i=0;i<9;++i){const n=e[i];t+=n*n}return Math.sqrt(t)}const tw=[1,0,0],ew=[2,2,1];function Zft(e){let t=0;for(let i=0;i<3;++i){const n=e[dl.getElementIndex(ew[i],tw[i])];t+=2*n*n}return Math.sqrt(t)}function Yft(e,t){const i=mI;let n=0,r=1;for(let A=0;A<3;++A){const _=Math.abs(e[dl.getElementIndex(ew[A],tw[A])]);_>n&&(r=A,n=_)}const s=tw[r],o=ew[r];let c=1,h=0;if(Math.abs(e[dl.getElementIndex(o,s)])>i){const A=e[dl.getElementIndex(o,o)],_=e[dl.getElementIndex(s,s)],C=e[dl.getElementIndex(o,s)],S=(A-_)/2/C;let L;S<0?L=-1/(-S+Math.sqrt(1+S*S)):L=1/(S+Math.sqrt(1+S*S)),c=1/Math.sqrt(1+L*L),h=L*c}return gr.IDENTITY.to(t),t[dl.getElementIndex(s,s)]=t[dl.getElementIndex(o,o)]=c,t[dl.getElementIndex(o,s)]=h,t[dl.getElementIndex(s,o)]=-h,t}const ah=new fe,$ft=new fe,tdt=new fe,edt=new fe,idt=new fe,ndt=new gr,rdt={diagonal:new gr,unitary:new gr};function KL(e,t=new im){if(!e||e.length===0)return t.halfAxes=new gr([0,0,0,0,0,0,0,0,0]),t.center=new fe,t;const i=e.length,n=new fe(0,0,0);for(const dt of e)n.add(dt);const r=1/i;n.multiplyByScalar(r);let s=0,o=0,c=0,h=0,A=0,_=0;for(const dt of e){const lt=ah.copy(dt).subtract(n);s+=lt.x*lt.x,o+=lt.x*lt.y,c+=lt.x*lt.z,h+=lt.y*lt.y,A+=lt.y*lt.z,_+=lt.z*lt.z}s*=r,o*=r,c*=r,h*=r,A*=r,_*=r;const C=ndt;C[0]=s,C[1]=o,C[2]=c,C[3]=o,C[4]=h,C[5]=A,C[6]=c,C[7]=A,C[8]=_;const{unitary:S}=Kft(C,rdt),L=t.halfAxes.copy(S);let N=L.getColumn(0,tdt),U=L.getColumn(1,edt),H=L.getColumn(2,idt),j=-Number.MAX_VALUE,tt=-Number.MAX_VALUE,K=-Number.MAX_VALUE,Q=Number.MAX_VALUE,pt=Number.MAX_VALUE,$=Number.MAX_VALUE;for(const dt of e)ah.copy(dt),j=Math.max(ah.dot(N),j),tt=Math.max(ah.dot(U),tt),K=Math.max(ah.dot(H),K),Q=Math.min(ah.dot(N),Q),pt=Math.min(ah.dot(U),pt),$=Math.min(ah.dot(H),$);N=N.multiplyByScalar(.5*(Q+j)),U=U.multiplyByScalar(.5*(pt+tt)),H=H.multiplyByScalar(.5*($+K)),t.center.copy(N).add(U).add(H);const zt=$ft.set(j-Q,tt-pt,K-$).multiplyByScalar(.5),Gt=new gr([zt[0],0,0,0,zt[1],0,0,0,zt[2]]);return t.halfAxes.multiplyRight(Gt),t}const mp=512,qL=3,ZL=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],YL=ZL.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),odt=YL.concat([[.25,.5],[.75,.5]]);class rA{constructor(t,i,n){this.x=t,this.y=i,this.z=n}get children(){if(!this._children){const t=this.x*2,i=this.y*2,n=this.z+1;this._children=[new rA(t,i,n),new rA(t,i+1,n),new rA(t+1,i,n),new rA(t+1,i+1,n)]}return this._children}update(t){const{viewport:i,cullingVolume:n,elevationBounds:r,minZ:s,maxZ:o,bounds:c,offset:h,project:A}=t,_=this.getBoundingVolume(r,h,A);if(c&&!this.insideBounds(c)||n.computeVisibility(_)<0)return!1;if(!this.childVisible){let{z:C}=this;if(C<o&&C>=s){const S=_.distanceTo(i.cameraPosition)*i.scale/i.height;C+=Math.floor(Math.log2(S))}if(C>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const C of this.children)C.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(const i of this._children)i.getSelected(t);return t}insideBounds([t,i,n,r]){const s=Math.pow(2,this.z),o=mp/s;return this.x*o<n&&this.y*o<r&&(this.x+1)*o>t&&(this.y+1)*o>i}getBoundingVolume(t,i,n){if(n){const h=this.z<1?odt:this.z<2?YL:ZL,A=[];for(const _ of h){const C=rw(this.x+_[0],this.y+_[1],this.z);C[2]=t[0],A.push(n(C)),t[0]!==t[1]&&(C[2]=t[1],A.push(n(C)))}return KL(A)}const r=Math.pow(2,this.z),s=mp/r,o=this.x*s+i*mp,c=mp-(this.y+1)*s;return new UE([o,c,t[0]],[o+s,c+s,t[1]])}}function sdt(e,t,i,n){const r=e instanceof bY&&e.resolution?e.projectPosition:null,s=Object.values(e.getFrustumPlanes()).map(({normal:L,distance:N})=>new Ic(L.clone().negate(),N)),o=new ya(s),c=e.distanceScales.unitsPerMeter[2],h=i&&i[0]*c||0,A=i&&i[1]*c||0,_=e instanceof eg&&e.pitch<=60?t:0;if(n){const[L,N,U,H]=n,j=Xl([L,H]),tt=Xl([U,N]);n=[j[0],mp-j[1],tt[0],mp-tt[1]]}const C=new rA(0,0,0),S={viewport:e,project:r,cullingVolume:o,elevationBounds:[h,A],minZ:_,maxZ:t,bounds:n,offset:0};if(C.update(S),e instanceof eg&&e.subViewports&&e.subViewports.length>1){for(S.offset=-1;C.update(S)&&!(--S.offset<-qL););for(S.offset=1;C.update(S)&&!(++S.offset>qL););}return C.getSelected()}const iu=512,adt=[-1/0,-1/0,1/0,1/0],Qy={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="string"),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;const i=e.length;if(i!==t.length)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}};function $L(e,t){const i=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...i.map(n=>n[0])),Math.min(...i.map(n=>n[1])),Math.max(...i.map(n=>n[0])),Math.max(...i.map(n=>n[1]))]}function cdt(e){return Math.abs(e.split("").reduce((t,i)=>(t<<5)-t+i.charCodeAt(0)|0,0))}function pf(e,t){if(!e||!e.length)return null;const{index:i,id:n}=t;if(Array.isArray(e)){const s=cdt(n)%e.length;e=e[s]}let r=e;for(const s of Object.keys(i)){const o=new RegExp(`{${s}}`,"g");r=r.replace(o,String(i[s]))}return Number.isInteger(i.y)&&Number.isInteger(i.z)&&(r=r.replace(/\{-y\}/g,String(Math.pow(2,i.z)-i.y-1))),r}function ldt(e,t,i){let n;return n=e.getBounds(),e.isGeospatial?[Math.max(n[0],i[0]),Math.max(n[1],i[1]),Math.min(n[2],i[2]),Math.min(n[3],i[3])]:[Math.max(Math.min(n[0],i[2]),i[0]),Math.max(Math.min(n[1],i[3]),i[1]),Math.min(Math.max(n[2],i[0]),i[2]),Math.min(Math.max(n[3],i[1]),i[3])]}function udt({viewport:e,z:t,cullRect:i}){return(e.subViewports||[e]).map(n=>iw(n,t||0,i))}function iw(e,t,i){if(!Array.isArray(t)){const s=i.x-e.x,o=i.y-e.y,{width:c,height:h}=i,A={targetZ:t},_=e.unproject([s,o],A),C=e.unproject([s+c,o],A),S=e.unproject([s,o+h],A),L=e.unproject([s+c,o+h],A);return[Math.min(_[0],C[0],S[0],L[0]),Math.min(_[1],C[1],S[1],L[1]),Math.max(_[0],C[0],S[0],L[0]),Math.max(_[1],C[1],S[1],L[1])]}const n=iw(e,t[0],i),r=iw(e,t[1],i);return[Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.max(n[2],r[2]),Math.max(n[3],r[3])]}function hdt(e,t,i){return i?$L(e,i).map(n=>n*t/iu):e.map(n=>n*t/iu)}function nw(e,t){return Math.pow(2,e)*iu/t}function rw(e,t,i){const n=nw(i,iu),r=e/n*360-180,s=Math.PI-2*Math.PI*t/n,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[r,o]}function t6(e,t,i,n){const r=nw(i,n);return[e/r*iu,t/r*iu]}function fdt(e,t,i,n,r=iu){if(e.isGeospatial){const[A,_]=rw(t,i,n),[C,S]=rw(t+1,i+1,n);return{west:A,north:_,east:C,south:S}}const[s,o]=t6(t,i,n,r),[c,h]=t6(t+1,i+1,n,r);return{left:s,top:o,right:c,bottom:h}}function ddt(e,t,i,n,r){const s=ldt(e,null,n),o=nw(t,i),[c,h,A,_]=hdt(s,o,r),C=[];for(let S=Math.floor(c);S<A;S++)for(let L=Math.floor(h);L<_;L++)C.push({x:S,y:L,z:t});return C}function pdt({viewport:e,maxZoom:t,minZoom:i,zRange:n,extent:r,tileSize:s=iu,modelMatrix:o,modelMatrixInverse:c,zoomOffset:h=0}){let A=e.isGeospatial?Math.round(e.zoom+Math.log2(iu/s))+h:Math.ceil(e.zoom)+h;if(typeof i=="number"&&Number.isFinite(i)&&A<i){if(!r)return[];A=i}typeof t=="number"&&Number.isFinite(t)&&A>t&&(A=t);let _=r;return o&&c&&r&&!e.isGeospatial&&(_=$L(r,o)),e.isGeospatial?sdt(e,A,n,r):ddt(e,A,s,_||adt,c)}function Adt(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function gdt(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}function mdt(e){let t={},i;return n=>{for(const r in n)if(!ydt(n[r],t[r])){i=e(n),t=n;break}return i}}function ydt(e,t){if(e===t)return!0;if(Array.isArray(e)){const i=e.length;if(!t||t.length!==i)return!1;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}return!1}const e6=1,Ky=2,vdt="never",_dt="no-overlap",ow="best-available",bdt=5,xdt={[ow]:Cdt,[_dt]:Edt,[vdt]:()=>{}},wdt={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class qy{constructor(t){this._getCullBounds=mdt(udt),this.opts={...wdt,...t},this.setOptions(this.opts),this.onTileLoad=i=>{this.opts.onTileLoad?.(i),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=i.byteLength,this._resizeCache())},this._requestScheduler=new CL({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new yn,this._modelMatrixInverse=new yn}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(const t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const t of this._cache.keys()){const i=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(i)?this._cache.delete(t):i.setNeedsReload()}}update(t,{zRange:i,modelMatrix:n}={zRange:null,modelMatrix:null}){const r=n?new yn(n):new yn,s=!r.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!ca(this._zRange,i)||s){s&&(this._modelMatrixInverse=r.clone().invert(),this._modelMatrix=r),this._viewport=t,this._zRange=i;const c=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:i,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=c.map(h=>this._getTile(h,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(c=>this._getTile(c.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(t,i){if(!t.isVisible)return!1;if(i&&this._viewport){const n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:i}),{bbox:r}=t;for(const[s,o,c,h]of n){let A;if("west"in r)A=r.west<c&&r.east>s&&r.south<h&&r.north>o;else{const _=Math.min(r.top,r.bottom),C=Math.max(r.top,r.bottom);A=r.left<c&&r.right>s&&_<h&&C>o}if(A)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:i,minZoom:n,zRange:r,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:c,extent:h,zoomOffset:A}=this.opts;return pdt({viewport:t,maxZoom:i,minZoom:n,zRange:r,tileSize:c,extent:h,modelMatrix:s,modelMatrixInverse:o,zoomOffset:A})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){const{tileSize:i}=this.opts;return{bbox:fdt(this._viewport,t.x,t.y,t.z,i)}}getParentIndex(t){const i=Math.floor(t.x/2),n=Math.floor(t.y/2),r=t.z-1;return{x:i,y:n,z:r}}updateTileStates(){const t=this.opts.refinementStrategy||ow,i=new Array(this._cache.size);let n=0;for(const r of this._cache.values())i[n++]=r.isVisible,r.isSelected=!1,r.isVisible=!1;for(const r of this._selectedTiles)r.isSelected=!0,r.isVisible=!0;(typeof t=="function"?t:xdt[t])(Array.from(this._cache.values())),n=0;for(const r of this._cache.values())if(i[n++]!==r.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:t=0}=this.opts,i=[];let n=0;for(const r of this._cache.values())r.isLoading&&(n++,!r.isSelected&&!r.isVisible&&i.push(r));for(;t>0&&n>t&&i.length>0;)i.shift().abort(),n--}_rebuildTree(){const{_cache:t}=this;for(const i of t.values())i.parent=null,i.children&&(i.children.length=0);for(const i of t.values()){const n=this._getNearestAncestor(i);i.parent=n,n?.children&&n.children.push(i)}}_resizeCache(){const{_cache:t,opts:i}=this,n=i.maxCacheSize??(i.maxCacheByteSize!==null?1/0:bdt*this.selectedTiles.length),r=i.maxCacheByteSize??1/0;if(t.size>n||this._cacheByteSize>r){for(const[s,o]of t)if(!o.isVisible&&!o.isSelected&&(this._cacheByteSize-=i.maxCacheByteSize!==null?o.byteLength:0,t.delete(s),this.opts.onTileUnload?.(o)),t.size<=n&&this._cacheByteSize<=r)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((s,o)=>s.zoom-o.zoom),this._dirty=!1)}_getTile(t,i){const n=this.getTileId(t);let r=this._cache.get(n),s=!1;return!r&&i?(r=new zL(t),Object.assign(r,this.getTileMetadata(r.index)),Object.assign(r,{id:n,zoom:this.getTileZoom(r.index)}),s=!0,this._cache.set(n,r),this._dirty=!0):r&&r.needsReload&&(s=!0),r&&s&&r.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),r}_getNearestAncestor(t){const{_minZoom:i=0}=this;let n=t.index;for(;this.getTileZoom(n)>i;){n=this.getParentIndex(n);const r=this._getTile(n);if(r)return r}return null}}function Cdt(e){for(const t of e)t.state=0;for(const t of e)t.isSelected&&!i6(t)&&sw(t);for(const t of e)t.isVisible=!!(t.state&Ky)}function Edt(e){for(const i of e)i.state=0;for(const i of e)i.isSelected&&i6(i);const t=Array.from(e).sort((i,n)=>i.zoom-n.zoom);for(const i of t)if(i.isVisible=!!(i.state&Ky),i.children&&(i.isVisible||i.state&e6))for(const n of i.children)n.state=e6;else i.isSelected&&sw(i)}function i6(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=Ky,!0;t=t.parent}return!1}function sw(e){for(const t of e.children)t.isLoaded||t.content?t.state|=Ky:sw(t)}const Bdt={TilesetClass:qy,data:{type:"data",value:[]},dataComparator:Qy.equal,renderSubLayers:{type:"function",value:e=>new $l(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:ow,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class nu extends To{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(t=>t.isLoaded&&t.layers&&t.layers.every(i=>i.isLoaded))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:i}=this.state;const n=t.propsOrDataChanged||t.updateTriggersChanged,r=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);i?n&&(i.setOptions(this._getTilesetOptions()),r?i.reloadAll():i.tiles.forEach(s=>{s.layers=null})):(i=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:i})),this._updateTileset()}_getTilesetOptions(){const{tileSize:t,maxCacheSize:i,maxCacheByteSize:n,refinementStrategy:r,extent:s,maxZoom:o,minZoom:c,maxRequests:h,debounceTime:A,zoomOffset:_}=this.props;return{maxCacheSize:i,maxCacheByteSize:n,maxZoom:o,minZoom:c,tileSize:t,refinementStrategy:r,extent:s,maxRequests:h,debounceTime:A,zoomOffset:_,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const t=this.state.tileset,{zRange:i,modelMatrix:n}=this.props,r=t.update(this.context.viewport,{zRange:i,modelMatrix:n}),{isLoaded:s}=t,o=this.state.isLoaded!==s,c=this.state.frameNumber!==r;s&&(o||c)&&this._onViewportLoad(),c&&this.setState({frameNumber:r}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:t}=this.state,{onViewportLoad:i}=this.props;i&&i(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,i){this.props.onTileError(t),i.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){const{data:i,getTileData:n,fetch:r}=this.props,{signal:s}=t;return t.url=typeof i=="string"||Array.isArray(i)?pf(i,t):null,n?n(t):r&&t.url?r(t.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){const i=t.sourceLayer,n=i.props.tile,r=t.info;return r.picked&&(r.tile=n),r.sourceTile=n,r.sourceTileSubLayer=i,r}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{const i=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)i&&t.layers[0]&&Object.keys(i).some(n=>t.layers[0].props[n]!==i[n])&&(t.layers=t.layers.map(n=>n.clone(i)));else{const n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=P0(n,Boolean).map(r=>r.clone({tile:t,...i}))}return t.layers})}filterSubLayer({layer:t,cullRect:i}){const{tile:n}=t.props;return this.state.tileset.isTileVisible(n,i)}}nu.defaultProps=Bdt,nu.layerName="TileLayer";const n6=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,Tdt={name:"trips",vs:n6,fs:n6,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}},Sdt={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}};class Zy extends ih{getShaders(){const t=super.getShaders();return t.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},t.modules=[...t.modules,Tdt],t}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){const{fadeTrail:i,trailLength:n,currentTime:r}=this.props,s={fadeTrail:i,trailLength:n,currentTime:r};this.state.model.shaderInputs.setProps({trips:s}),super.draw(t)}}Zy.layerName="TripsLayer",Zy.defaultProps=Sdt;var ki=function(e){e=e||{};var t=typeof e<"u"?e:{},i={},n;for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n]);var r="";function s(ft){return t.locateFile?t.locateFile(ft,r):r+ft}var o;typeof document<"u"&&document.currentScript&&(r=document.currentScript.src),r.indexOf("blob:")!==0?r=r.substr(0,r.lastIndexOf("/")+1):r="",o=function(ft,_t,st){var wt=new XMLHttpRequest;wt.open("GET",ft,!0),wt.responseType="arraybuffer",wt.onload=function(){if(wt.status==200||wt.status==0&&wt.response){_t(wt.response);return}var g=Re(ft);if(g){_t(g.buffer);return}st()},wt.onerror=st,wt.send(null)};var c=t.print||console.log.bind(console),h=t.printErr||console.warn.bind(console);for(n in i)i.hasOwnProperty(n)&&(t[n]=i[n]);i=null,t.arguments&&t.arguments;var A=0,_=function(ft){A=ft},C=function(){return A},S=8;function L(ft,_t,st,wt){switch(st=st||"i8",st.charAt(st.length-1)==="*"&&(st="i32"),st){case"i1":J[ft>>0]=_t;break;case"i8":J[ft>>0]=_t;break;case"i16":Et[ft>>1]=_t;break;case"i32":le[ft>>2]=_t;break;case"i64":$n=[_t>>>0,(Tn=_t,+bi(Tn)>=1?Tn>0?(vi(+yi(Tn/4294967296),4294967295)|0)>>>0:~~+Vn((Tn-+(~~Tn>>>0))/4294967296)>>>0:0)],le[ft>>2]=$n[0],le[ft+4>>2]=$n[1];break;case"float":Ct[ft>>2]=_t;break;case"double":Rt[ft>>3]=_t;break;default:Ot("invalid type for setValue: "+st)}}function N(ft,_t,st){switch(_t=_t||"i8",_t.charAt(_t.length-1)==="*"&&(_t="i32"),_t){case"i1":return J[ft>>0];case"i8":return J[ft>>0];case"i16":return Et[ft>>1];case"i32":return le[ft>>2];case"i64":return le[ft>>2];case"float":return Ct[ft>>2];case"double":return Rt[ft>>3];default:Ot("invalid type for getValue: "+_t)}return null}var U=!1;function H(ft,_t){ft||Ot("Assertion failed: "+_t)}function j(ft){var _t=t["_"+ft];return H(_t,"Cannot call unknown function "+ft+", make sure it is exported"),_t}function tt(ft,_t,st,wt,g){var ct={string:function(Ie){var je=0;if(Ie!=null&&Ie!==0){var Ni=(Ie.length<<2)+1;je=ve(Ni),Gt(Ie,je,Ni)}return je},array:function(Ie){var je=ve(Ie.length);return dt(Ie,je),je}};function Ce(Ie){return _t==="string"?$(Ie):_t==="boolean"?!!Ie:Ie}var Kt=j(ft),Ee=[],Pe=0;if(wt)for(var Le=0;Le<wt.length;Le++){var he=ct[st[Le]];he?(Pe===0&&(Pe=xt()),Ee[Le]=he(wt[Le])):Ee[Le]=wt[Le]}var Fe=Kt.apply(null,Ee);return Fe=Ce(Fe),Pe!==0&&Be(Pe),Fe}function K(ft,_t,st,wt){st=st||[];var g=st.every(function(Ce){return Ce==="number"}),ct=_t!=="string";return ct&&g&&!wt?j(ft):function(){return tt(ft,_t,st,arguments)}}var Q=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function pt(ft,_t,st){for(var wt=_t+st,g=_t;ft[g]&&!(g>=wt);)++g;if(g-_t>16&&ft.subarray&&Q)return Q.decode(ft.subarray(_t,g));for(var ct="";_t<g;){var Ce=ft[_t++];if(!(Ce&128)){ct+=String.fromCharCode(Ce);continue}var Kt=ft[_t++]&63;if((Ce&224)==192){ct+=String.fromCharCode((Ce&31)<<6|Kt);continue}var Ee=ft[_t++]&63;if((Ce&240)==224?Ce=(Ce&15)<<12|Kt<<6|Ee:Ce=(Ce&7)<<18|Kt<<12|Ee<<6|ft[_t++]&63,Ce<65536)ct+=String.fromCharCode(Ce);else{var Pe=Ce-65536;ct+=String.fromCharCode(55296|Pe>>10,56320|Pe&1023)}}return ct}function $(ft,_t){return ft?pt(ut,ft,_t):""}function zt(ft,_t,st,wt){if(!(wt>0))return 0;for(var g=st,ct=st+wt-1,Ce=0;Ce<ft.length;++Ce){var Kt=ft.charCodeAt(Ce);if(Kt>=55296&&Kt<=57343){var Ee=ft.charCodeAt(++Ce);Kt=65536+((Kt&1023)<<10)|Ee&1023}if(Kt<=127){if(st>=ct)break;_t[st++]=Kt}else if(Kt<=2047){if(st+1>=ct)break;_t[st++]=192|Kt>>6,_t[st++]=128|Kt&63}else if(Kt<=65535){if(st+2>=ct)break;_t[st++]=224|Kt>>12,_t[st++]=128|Kt>>6&63,_t[st++]=128|Kt&63}else{if(st+3>=ct)break;_t[st++]=240|Kt>>18,_t[st++]=128|Kt>>12&63,_t[st++]=128|Kt>>6&63,_t[st++]=128|Kt&63}}return _t[st]=0,st-g}function Gt(ft,_t,st){return zt(ft,ut,_t,st)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function dt(ft,_t){J.set(ft,_t)}function lt(ft,_t){return ft%_t>0&&(ft+=_t-ft%_t),ft}var Lt,J,ut,Et,le,Ct,Rt;function Nt(ft){Lt=ft,t.HEAP8=J=new Int8Array(ft),t.HEAP16=Et=new Int16Array(ft),t.HEAP32=le=new Int32Array(ft),t.HEAPU8=ut=new Uint8Array(ft),t.HEAPU16=new Uint16Array(ft),t.HEAPU32=new Uint32Array(ft),t.HEAPF32=Ct=new Float32Array(ft),t.HEAPF64=Rt=new Float64Array(ft)}var Zt=5267040,re=24128,se=t.TOTAL_MEMORY||33554432;t.buffer?Lt=t.buffer:Lt=new ArrayBuffer(se),se=Lt.byteLength,Nt(Lt),le[re>>2]=Zt;function de(ft){for(;ft.length>0;){var _t=ft.shift();if(typeof _t=="function"){_t();continue}var st=_t.func;typeof st=="number"?_t.arg===void 0?t.dynCall_v(st):t.dynCall_vi(st,_t.arg):st(_t.arg===void 0?null:_t.arg)}}var Me=[],Se=[],oe=[],Ai=[];function Ke(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)cn(t.preRun.shift());de(Me)}function qe(){de(Se)}function Ve(){de(oe)}function di(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)Ri(t.postRun.shift());de(Ai)}function cn(ft){Me.unshift(ft)}function Ri(ft){Ai.unshift(ft)}var bi=Math.abs,Vn=Math.ceil,yi=Math.floor,vi=Math.min,un=0,Di=null;function lr(ft){un++,t.monitorRunDependencies&&t.monitorRunDependencies(un)}function Yn(ft){if(un--,t.monitorRunDependencies&&t.monitorRunDependencies(un),un==0&&Di){var _t=Di;Di=null,_t()}}t.preloadedImages={},t.preloadedAudios={};var mn=null,ir="data:application/octet-stream;base64,";function Hn(ft){return String.prototype.startsWith?ft.startsWith(ir):ft.indexOf(ir)===0}var Tn,$n;mn="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var Ge=24144;function gi(ft,_t,st,wt){Ot("Assertion failed: "+$(ft)+", at: "+[_t?$(_t):"unknown filename",st,wt?$(wt):"unknown function"])}function Mi(){return J.length}function rn(ft,_t,st){ut.set(ut.subarray(_t,_t+st),ft)}function yr(ft){return t.___errno_location&&(le[t.___errno_location()>>2]=ft),ft}function St(ft){Ot("OOM")}function ke(ft){try{var _t=new ArrayBuffer(ft);return _t.byteLength!=ft?void 0:(new Int8Array(_t).set(J),V(_t),Nt(_t),1)}catch{}}function Je(ft){var _t=Mi(),st=16777216,wt=2147483648-st;if(ft>wt)return!1;for(var g=16777216,ct=Math.max(_t,g);ct<ft;)ct<=536870912?ct=lt(2*ct,st):ct=Math.min(lt((3*ct+2147483648)/4,st),wt);var Ce=ke(ct);return!!Ce}var li=typeof atob=="function"?atob:function(ft){var _t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",st="",wt,g,ct,Ce,Kt,Ee,Pe,Le=0;ft=ft.replace(/[^A-Za-z0-9\+\/\=]/g,"");do Ce=_t.indexOf(ft.charAt(Le++)),Kt=_t.indexOf(ft.charAt(Le++)),Ee=_t.indexOf(ft.charAt(Le++)),Pe=_t.indexOf(ft.charAt(Le++)),wt=Ce<<2|Kt>>4,g=(Kt&15)<<4|Ee>>2,ct=(Ee&3)<<6|Pe,st=st+String.fromCharCode(wt),Ee!==64&&(st=st+String.fromCharCode(g)),Pe!==64&&(st=st+String.fromCharCode(ct));while(Le<ft.length);return st};function Yt(ft){try{for(var _t=li(ft),st=new Uint8Array(_t.length),wt=0;wt<_t.length;++wt)st[wt]=_t.charCodeAt(wt);return st}catch{throw new Error("Converting base64 string to bytes failed.")}}function Re(ft){if(Hn(ft))return Yt(ft.slice(ir.length))}var gt={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},ze={b:_,c:C,d:gi,e:yr,f:Mi,g:rn,h:Je,i:St,o:Ge,p:re},we=function(ft,_t,st){"almost asm";var wt=new ft.Int8Array(st),g=new ft.Int32Array(st);new ft.Uint8Array(st),new ft.Float32Array(st);var ct=new ft.Float64Array(st),Ce=_t.o|0,Kt=_t.p|0,Ee=ft.Math.floor,Pe=ft.Math.abs,Le=ft.Math.sqrt,he=ft.Math.pow,Fe=ft.Math.cos,Ie=ft.Math.sin,je=ft.Math.tan,Ni=ft.Math.acos,ti=ft.Math.asin,tn=ft.Math.atan,ln=ft.Math.atan2,Ji=ft.Math.ceil,Xi=ft.Math.imul,Gi=ft.Math.min,vr=ft.Math.max,Qi=ft.Math.clz32,mi=_t.b,Bt=_t.c,Qe=_t.d,en=_t.e,Hr=_t.f,va=_t.g,ur=_t.h,Wn=_t.i,Tt=24160;function Ws(v){return wt=new Int8Array(v),g=new Int32Array(v),ct=new Float64Array(v),st=v,!0}function Jn(v){v=v|0;var y=0;return y=Tt,Tt=Tt+v|0,Tt=Tt+15&-16,y|0}function Js(){return Tt|0}function Fr(v){v=v|0,Tt=v}function hr(v,y){v=v|0,Tt=v}function Mr(v,y){v=v|0,y=y|0;var b=0,w=0,T=0;return(v|0)<0?(y=2,y|0):(v|0)>13780509?(y=$s(15,y)|0,y|0):(b=((v|0)<0)<<31>>31,T=dr(v|0,b|0,3,0)|0,w=Bt()|0,b=An(v|0,b|0,1,0)|0,b=dr(T|0,w|0,b|0,Bt()|0)|0,b=An(b|0,Bt()|0,1,0)|0,v=Bt()|0,g[y>>2]=b,g[y+4>>2]=v,y=0,y|0)}function Rn(v,y,b,w){return v=v|0,y=y|0,b=b|0,w=w|0,mo(v,y,b,w,0)|0}function mo(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0;if(d=Tt,Tt=Tt+16|0,O=d,!(Wr(v,y,b,w,T)|0))return w=0,Tt=d,w|0;do if((b|0)>=0){if((b|0)>13780509){if(M=$s(15,O)|0,M|0)break;l=O,O=g[l>>2]|0,l=g[l+4>>2]|0}else M=((b|0)<0)<<31>>31,f=dr(b|0,M|0,3,0)|0,l=Bt()|0,M=An(b|0,M|0,1,0)|0,M=dr(f|0,l|0,M|0,Bt()|0)|0,M=An(M|0,Bt()|0,1,0)|0,l=Bt()|0,g[O>>2]=M,g[O+4>>2]=l,O=M;if(ra(w|0,0,O<<3|0)|0,T|0){ra(T|0,0,O<<2|0)|0,M=Go(v,y,b,w,T,O,l,0)|0;break}M=ls(O,4)|0,M?(f=Go(v,y,b,w,M,O,l,0)|0,Ui(M),M=f):M=13}else M=2;while(!1);return f=M,Tt=d,f|0}function Wr(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0;if(z=Tt,Tt=Tt+16|0,R=z,F=z+8|0,P=R,g[P>>2]=v,g[P+4>>2]=y,(b|0)<0)return F=2,Tt=z,F|0;if(M=w,g[M>>2]=v,g[M+4>>2]=y,M=(T|0)!=0,M&&(g[T>>2]=0),Dn(v,y)|0)return F=9,Tt=z,F|0;g[F>>2]=0;t:do if((b|0)>=1)if(M)for(m=1,f=0,E=0,P=1,M=v;;){if(!(f|E)){if(M=Sn(M,y,4,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,Dn(M,y)|0){M=9;break t}}if(M=Sn(M,y,g[22384+(E<<2)>>2]|0,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,v=w+(m<<3)|0,g[v>>2]=M,g[v+4>>2]=y,g[T+(m<<2)>>2]=P,v=f+1|0,O=(v|0)==(P|0),l=E+1|0,d=(l|0)==6,Dn(M,y)|0){M=9;break t}if(P=P+(d&O&1)|0,(P|0)>(b|0)){M=0;break}else m=m+1|0,f=O?0:v,E=O?d?0:l:E}else for(m=1,f=0,E=0,P=1,M=v;;){if(!(f|E)){if(M=Sn(M,y,4,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,Dn(M,y)|0){M=9;break t}}if(M=Sn(M,y,g[22384+(E<<2)>>2]|0,F,R)|0,M|0)break t;if(y=R,M=g[y>>2]|0,y=g[y+4>>2]|0,v=w+(m<<3)|0,g[v>>2]=M,g[v+4>>2]=y,v=f+1|0,O=(v|0)==(P|0),l=E+1|0,d=(l|0)==6,Dn(M,y)|0){M=9;break t}if(P=P+(d&O&1)|0,(P|0)>(b|0)){M=0;break}else m=m+1|0,f=O?0:v,E=O?d?0:l:E}else M=0;while(!1);return F=M,Tt=z,F|0}function Go(v,y,b,w,T,M,O,l){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0,O=O|0,l=l|0;var d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0;if(z=Tt,Tt=Tt+16|0,R=z+8|0,F=z,d=Es(v|0,y|0,M|0,O|0)|0,m=Bt()|0,E=w+(d<<3)|0,W=E,et=g[W>>2]|0,W=g[W+4>>2]|0,f=(et|0)==(v|0)&(W|0)==(y|0),!((et|0)==0&(W|0)==0|f))do d=An(d|0,m|0,1,0)|0,d=ro(d|0,Bt()|0,M|0,O|0)|0,m=Bt()|0,E=w+(d<<3)|0,et=E,W=g[et>>2]|0,et=g[et+4>>2]|0,f=(W|0)==(v|0)&(et|0)==(y|0);while(!((W|0)==0&(et|0)==0|f));if(d=T+(d<<2)|0,f&&(g[d>>2]|0)<=(l|0)||(et=E,g[et>>2]=v,g[et+4>>2]=y,g[d>>2]=l,(l|0)>=(b|0)))return et=0,Tt=z,et|0;switch(f=l+1|0,g[R>>2]=0,d=Sn(v,y,2,R,F)|0,d|0){case 9:{P=9;break}case 0:{d=F,d=Go(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d||(P=9);break}}t:do if((P|0)==9){switch(g[R>>2]=0,d=Sn(v,y,3,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Go(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=Sn(v,y,1,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Go(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=Sn(v,y,5,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Go(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=Sn(v,y,4,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Go(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}switch(g[R>>2]=0,d=Sn(v,y,6,R,F)|0,d|0){case 9:break;case 0:{if(d=F,d=Go(g[d>>2]|0,g[d+4>>2]|0,b,w,T,M,O,f)|0,d|0)break t;break}default:break t}return et=0,Tt=z,et|0}while(!1);return et=d,Tt=z,et|0}function Sn(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(b>>>0>6)return T=1,T|0;if(E=(g[w>>2]|0)%6|0,g[w>>2]=E,(E|0)>0){M=0;do b=xs(b)|0,M=M+1|0;while((M|0)<(g[w>>2]|0))}if(E=Xe(v|0,y|0,45)|0,Bt()|0,m=E&127,m>>>0>121)return T=5,T|0;d=eo(v,y)|0,M=Xe(v|0,y|0,52)|0,Bt()|0,M=M&15;t:do if(!M)f=8;else{for(;;){if(O=(15-M|0)*3|0,l=Xe(v|0,y|0,O|0)|0,Bt()|0,l=l&7,(l|0)==7){y=5;break}if(F=(Vo(M)|0)==0,M=M+-1|0,P=ei(7,0,O|0)|0,y=y&~(Bt()|0),R=ei(g[(F?432:16)+(l*28|0)+(b<<2)>>2]|0,0,O|0)|0,O=Bt()|0,b=g[(F?640:224)+(l*28|0)+(b<<2)>>2]|0,v=R|v&~P,y=O|y,!b){b=0;break t}if(!M){f=8;break t}}return y|0}while(!1);(f|0)==8&&(F=g[848+(m*28|0)+(b<<2)>>2]|0,R=ei(F|0,0,45)|0,v=R|v,y=Bt()|0|y&-1040385,b=g[4272+(m*28|0)+(b<<2)>>2]|0,(F&127|0)==127&&(F=ei(g[848+(m*28|0)+20>>2]|0,0,45)|0,y=Bt()|0|y&-1040385,b=g[4272+(m*28|0)+20>>2]|0,v=ws(F|v,y)|0,y=Bt()|0,g[w>>2]=(g[w>>2]|0)+1)),l=Xe(v|0,y|0,45)|0,Bt()|0,l=l&127;t:do if(Ii(l)|0){e:do if((eo(v,y)|0)==1){if((m|0)!=(l|0))if(Ah(l,g[7696+(m*28|0)>>2]|0)|0){v=Ya(v,y)|0,O=1,y=Bt()|0;break}else Qe(23313,22416,436,22424);switch(d|0){case 3:{v=ws(v,y)|0,y=Bt()|0,g[w>>2]=(g[w>>2]|0)+1,O=0;break e}case 5:{v=Ya(v,y)|0,y=Bt()|0,g[w>>2]=(g[w>>2]|0)+5,O=0;break e}case 0:return F=9,F|0;default:return F=1,F|0}}else O=0;while(!1);if((b|0)>0){M=0;do v=Sa(v,y)|0,y=Bt()|0,M=M+1|0;while((M|0)!=(b|0))}if((m|0)!=(l|0)){if(!(Ln(l)|0)){if((O|0)!=0|(eo(v,y)|0)!=5)break;g[w>>2]=(g[w>>2]|0)+1;break}switch(E&127){case 8:case 118:break t}(eo(v,y)|0)!=3&&(g[w>>2]=(g[w>>2]|0)+1)}}else if((b|0)>0){M=0;do v=ws(v,y)|0,y=Bt()|0,M=M+1|0;while((M|0)!=(b|0))}while(!1);return g[w>>2]=((g[w>>2]|0)+b|0)%6|0,F=T,g[F>>2]=v,g[F+4>>2]=y,F=0,F|0}function _l(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0;for(l=Tt,Tt=Tt+16|0,M=l,O=l+8|0,T=(Dn(v,y)|0)==0,T=T?1:2;;){if(g[O>>2]=0,f=(Sn(v,y,T,O,M)|0)==0,d=M,f&((g[d>>2]|0)==(b|0)?(g[d+4>>2]|0)==(w|0):0)){v=4;break}if(T=T+1|0,T>>>0>=7){T=7,v=4;break}}return(v|0)==4?(Tt=l,T|0):0}function At(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(F=Tt,Tt=Tt+16|0,P=F,R=F+8|0,E=P,g[E>>2]=v,g[E+4>>2]=y,!b)return R=w,g[R>>2]=v,g[R+4>>2]=y,R=0,Tt=F,R|0;g[R>>2]=0;t:do if(Dn(v,y)|0)v=9;else{if(M=(b|0)>0,M){T=0,E=v;do{if(v=Sn(E,y,4,R,P)|0,v|0)break t;if(y=P,E=g[y>>2]|0,y=g[y+4>>2]|0,T=T+1|0,Dn(E,y)|0){v=9;break t}}while((T|0)<(b|0));if(m=w,g[m>>2]=E,g[m+4>>2]=y,m=b+-1|0,M){f=0,v=1;do{if(T=22384+(f<<2)|0,(f|0)==5)for(O=g[T>>2]|0,M=0,T=v;;){if(v=P,v=Sn(g[v>>2]|0,g[v+4>>2]|0,O,R,P)|0,v|0)break t;if((M|0)!=(m|0))if(d=P,l=g[d>>2]|0,d=g[d+4>>2]|0,v=w+(T<<3)|0,g[v>>2]=l,g[v+4>>2]=d,!(Dn(l,d)|0))v=T+1|0;else{v=9;break t}else v=T;if(M=M+1|0,(M|0)>=(b|0))break;T=v}else for(O=P,d=g[T>>2]|0,l=0,T=v,M=g[O>>2]|0,O=g[O+4>>2]|0;;){if(v=Sn(M,O,d,R,P)|0,v|0)break t;if(O=P,M=g[O>>2]|0,O=g[O+4>>2]|0,v=w+(T<<3)|0,g[v>>2]=M,g[v+4>>2]=O,v=T+1|0,Dn(M,O)|0){v=9;break t}if(l=l+1|0,(l|0)>=(b|0))break;T=v}f=f+1|0}while(f>>>0<6);v=P,O=E,T=g[v>>2]|0,M=y,v=g[v+4>>2]|0}else O=E,T=E,M=y,v=y}else O=w,g[O>>2]=v,g[O+4>>2]=y,O=v,T=v,M=y,v=y;v=(O|0)==(T|0)&(M|0)==(v|0)?0:9}while(!1);return R=v,Tt=F,R|0}function Mt(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0;if(l=Tt,Tt=Tt+48|0,T=l+16|0,M=l+8|0,O=l,b|0)return O=15,Tt=l,O|0;if(f=v,d=g[f+4>>2]|0,b=M,g[b>>2]=g[f>>2],g[b+4>>2]=d,yo(M,T),y=Xs(T,y,O)|0,!y){if(b=g[M>>2]|0,M=g[v+8>>2]|0,(M|0)>0){T=g[v+12>>2]|0,y=0;do b=(g[T+(y<<3)>>2]|0)+b|0,y=y+1|0;while((y|0)<(M|0))}y=O,T=g[y>>2]|0,y=g[y+4>>2]|0,M=((b|0)<0)<<31>>31,(y|0)<(M|0)|(y|0)==(M|0)&T>>>0<b>>>0?(y=O,g[y>>2]=b,g[y+4>>2]=M,y=M):b=T,d=An(b|0,y|0,12,0)|0,f=Bt()|0,y=O,g[y>>2]=d,g[y+4>>2]=f,y=w,g[y>>2]=d,g[y+4>>2]=f,y=0}return f=y,Tt=l,f|0}function Wt(v,y,b,w,T,M,O){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0,O=O|0;var l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0,It=0,Vt=0,Jt=0,te=0,Qt=0,$t=0,pe=0,Oe=0,xe=0,Ue=0,oi=0,Ei=0;if(Oe=Tt,Tt=Tt+64|0,te=Oe+48|0,Qt=Oe+32|0,$t=Oe+24|0,bt=Oe+8|0,Pt=Oe,d=g[v>>2]|0,(d|0)<=0)return pe=0,Tt=Oe,pe|0;for(mt=v+4|0,It=te+8|0,Vt=Qt+8|0,Jt=bt+8|0,l=0,it=0;;){f=g[mt>>2]|0,Z=f+(it<<4)|0,g[te>>2]=g[Z>>2],g[te+4>>2]=g[Z+4>>2],g[te+8>>2]=g[Z+8>>2],g[te+12>>2]=g[Z+12>>2],(it|0)==(d+-1|0)?(g[Qt>>2]=g[f>>2],g[Qt+4>>2]=g[f+4>>2],g[Qt+8>>2]=g[f+8>>2],g[Qt+12>>2]=g[f+12>>2]):(Z=f+(it+1<<4)|0,g[Qt>>2]=g[Z>>2],g[Qt+4>>2]=g[Z+4>>2],g[Qt+8>>2]=g[Z+8>>2],g[Qt+12>>2]=g[Z+12>>2]),d=ba(te,Qt,w,$t)|0;t:do if(d)f=0,l=d;else if(f=$t,d=g[f>>2]|0,f=g[f+4>>2]|0,(f|0)>0|(f|0)==0&d>>>0>0){et=0,Z=0;e:for(;;){if(Ei=+ct[te>>3],W=Ki(d|0,f|0,et|0,Z|0)|0,oi=+(W>>>0)+4294967296*+(Bt()|0),xe=+(d>>>0)+4294967296*+(f|0),Ue=+(et>>>0)+4294967296*+(Z|0),ct[bt>>3]=Ei*oi/xe+ +ct[Qt>>3]*Ue/xe,ct[Jt>>3]=+ct[It>>3]*oi/xe+ +ct[Vt>>3]*Ue/xe,d=$a(bt,w,Pt)|0,d|0){l=d;break}W=Pt,z=g[W>>2]|0,W=g[W+4>>2]|0,P=Es(z|0,W|0,y|0,b|0)|0,m=Bt()|0,d=O+(P<<3)|0,E=d,f=g[E>>2]|0,E=g[E+4>>2]|0;i:do if((f|0)==0&(E|0)==0)ot=d,pe=16;else for(R=0,F=0;;){if((R|0)>(b|0)|(R|0)==(b|0)&F>>>0>y>>>0){l=1;break e}if((f|0)==(z|0)&(E|0)==(W|0))break i;if(d=An(P|0,m|0,1,0)|0,P=ro(d|0,Bt()|0,y|0,b|0)|0,m=Bt()|0,F=An(F|0,R|0,1,0)|0,R=Bt()|0,d=O+(P<<3)|0,E=d,f=g[E>>2]|0,E=g[E+4>>2]|0,(f|0)==0&(E|0)==0){ot=d,pe=16;break}}while(!1);if((pe|0)==16&&(pe=0,!((z|0)==0&(W|0)==0))&&(F=ot,g[F>>2]=z,g[F+4>>2]=W,F=M+(g[T>>2]<<3)|0,g[F>>2]=z,g[F+4>>2]=W,F=T,F=An(g[F>>2]|0,g[F+4>>2]|0,1,0)|0,z=Bt()|0,W=T,g[W>>2]=F,g[W+4>>2]=z),et=An(et|0,Z|0,1,0)|0,Z=Bt()|0,f=$t,d=g[f>>2]|0,f=g[f+4>>2]|0,!((f|0)>(Z|0)|(f|0)==(Z|0)&d>>>0>et>>>0)){f=1;break t}}f=0}else f=1;while(!1);if(it=it+1|0,!f){pe=21;break}if(d=g[v>>2]|0,(it|0)>=(d|0)){l=0,pe=21;break}}return(pe|0)==21?(Tt=Oe,l|0):0}function be(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0,It=0,Vt=0,Jt=0,te=0,Qt=0,$t=0,pe=0,Oe=0,xe=0,Ue=0,oi=0;if(oi=Tt,Tt=Tt+112|0,pe=oi+80|0,d=oi+72|0,Oe=oi,xe=oi+56|0,b|0)return Ue=15,Tt=oi,Ue|0;if(f=v+8|0,Ue=Qn((g[f>>2]<<5)+32|0)|0,!Ue)return Ue=13,Tt=oi,Ue|0;if(wh(v,Ue),Qt=v,$t=g[Qt+4>>2]|0,b=d,g[b>>2]=g[Qt>>2],g[b+4>>2]=$t,yo(d,pe),b=Xs(pe,y,Oe)|0,b)Qt=0,$t=0;else{if(b=g[d>>2]|0,M=g[f>>2]|0,(M|0)>0){O=g[v+12>>2]|0,T=0;do b=(g[O+(T<<3)>>2]|0)+b|0,T=T+1|0;while((T|0)!=(M|0));T=b}else T=b;b=Oe,M=g[b>>2]|0,b=g[b+4>>2]|0,O=((T|0)<0)<<31>>31,(b|0)<(O|0)|(b|0)==(O|0)&M>>>0<T>>>0?(b=Oe,g[b>>2]=T,g[b+4>>2]=O,b=O):T=M,Qt=An(T|0,b|0,12,0)|0,$t=Bt()|0,b=Oe,g[b>>2]=Qt,g[b+4>>2]=$t,b=0}if(b|0)return Ui(Ue),Ue=b,Tt=oi,Ue|0;if(T=ls(Qt,8)|0,!T)return Ui(Ue),Ue=13,Tt=oi,Ue|0;if(l=ls(Qt,8)|0,!l)return Ui(Ue),Ui(T),Ue=13,Tt=oi,Ue|0;Jt=pe,g[Jt>>2]=0,g[Jt+4>>2]=0,Jt=v,te=g[Jt+4>>2]|0,b=d,g[b>>2]=g[Jt>>2],g[b+4>>2]=te,b=Wt(d,Qt,$t,y,pe,T,l)|0;t:do if(b)Ui(T),Ui(l),Ui(Ue);else{e:do if((g[f>>2]|0)>0){for(O=v+12|0,M=0;b=Wt((g[O>>2]|0)+(M<<3)|0,Qt,$t,y,pe,T,l)|0,M=M+1|0,!(b|0);)if((M|0)>=(g[f>>2]|0))break e;Ui(T),Ui(l),Ui(Ue);break t}while(!1);($t|0)>0|($t|0)==0&Qt>>>0>0&&ra(l|0,0,Qt<<3|0)|0,te=pe,Jt=g[te+4>>2]|0;e:do if((Jt|0)>0|(Jt|0)==0&(g[te>>2]|0)>>>0>0){mt=T,It=l,Vt=T,Jt=l,te=T,b=T,ot=T,bt=l,Pt=l,T=l;i:for(;;){for(W=0,et=0,Z=0,it=0,M=0,O=0;;){l=Oe,d=l+56|0;do g[l>>2]=0,l=l+4|0;while((l|0)<(d|0));if(y=mt+(W<<3)|0,f=g[y>>2]|0,y=g[y+4>>2]|0,Wr(f,y,1,Oe,0)|0){l=Oe,d=l+56|0;do g[l>>2]=0,l=l+4|0;while((l|0)<(d|0));l=ls(7,4)|0,l|0&&(Go(f,y,1,Oe,l,7,0,0)|0,Ui(l))}for(z=0;;){F=Oe+(z<<3)|0,R=g[F>>2]|0,F=g[F+4>>2]|0;n:do if((R|0)==0&(F|0)==0)l=M,d=O;else{if(m=Es(R|0,F|0,Qt|0,$t|0)|0,f=Bt()|0,l=w+(m<<3)|0,y=l,d=g[y>>2]|0,y=g[y+4>>2]|0,!((d|0)==0&(y|0)==0)){E=0,P=0;do{if((E|0)>($t|0)|(E|0)==($t|0)&P>>>0>Qt>>>0)break i;if((d|0)==(R|0)&(y|0)==(F|0)){l=M,d=O;break n}l=An(m|0,f|0,1,0)|0,m=ro(l|0,Bt()|0,Qt|0,$t|0)|0,f=Bt()|0,P=An(P|0,E|0,1,0)|0,E=Bt()|0,l=w+(m<<3)|0,y=l,d=g[y>>2]|0,y=g[y+4>>2]|0}while(!((d|0)==0&(y|0)==0))}(R|0)==0&(F|0)==0?(l=M,d=O):(Oc(R,F,xe)|0,Ye(v,Ue,xe)|0&&(P=An(M|0,O|0,1,0)|0,O=Bt()|0,E=l,g[E>>2]=R,g[E+4>>2]=F,M=It+(M<<3)|0,g[M>>2]=R,g[M+4>>2]=F,M=P),l=M,d=O)}while(!1);if(z=z+1|0,z>>>0>=7)break;M=l,O=d}if(W=An(W|0,et|0,1,0)|0,et=Bt()|0,Z=An(Z|0,it|0,1,0)|0,it=Bt()|0,O=pe,M=g[O>>2]|0,O=g[O+4>>2]|0,(it|0)<(O|0)|(it|0)==(O|0)&Z>>>0<M>>>0)M=l,O=d;else break}if((O|0)>0|(O|0)==0&M>>>0>0){M=0,O=0;do it=mt+(M<<3)|0,g[it>>2]=0,g[it+4>>2]=0,M=An(M|0,O|0,1,0)|0,O=Bt()|0,it=pe,Z=g[it+4>>2]|0;while((O|0)<(Z|0)|((O|0)==(Z|0)?M>>>0<(g[it>>2]|0)>>>0:0))}if(it=pe,g[it>>2]=l,g[it+4>>2]=d,(d|0)>0|(d|0)==0&l>>>0>0)z=T,W=Pt,et=te,Z=bt,it=It,T=ot,Pt=b,bt=Vt,ot=z,b=W,te=Jt,Jt=et,Vt=Z,It=mt,mt=it;else break e}Ui(Vt),Ui(Jt),Ui(Ue),b=1;break t}else b=l;while(!1);Ui(Ue),Ui(T),Ui(b),b=0}while(!1);return Ue=b,Tt=oi,Ue|0}function He(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0;if(m=Tt,Tt=Tt+176|0,d=m,(y|0)<1)return Ia(b,0,0),f=0,Tt=m,f|0;for(l=v,l=Xe(g[l>>2]|0,g[l+4>>2]|0,52)|0,Bt()|0,Ia(b,(y|0)>6?y:6,l&15),l=0;w=v+(l<<3)|0,w=Lc(g[w>>2]|0,g[w+4>>2]|0,d)|0,!(w|0);){if(w=g[d>>2]|0,(w|0)>0){O=0;do M=d+8+(O<<4)|0,O=O+1|0,w=d+8+(((O|0)%(w|0)|0)<<4)|0,T=xi(b,w,M)|0,T?no(b,T)|0:Dl(b,M,w)|0,w=g[d>>2]|0;while((O|0)<(w|0))}if(l=l+1|0,(l|0)>=(y|0)){w=0,f=13;break}}return(f|0)==13?(Tt=m,w|0):(ia(b),f=w,Tt=m,f|0)}function ji(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;if(M=Tt,Tt=Tt+32|0,w=M,T=M+16|0,v=He(v,y,T)|0,v|0)return b=v,Tt=M,b|0;if(g[b>>2]=0,g[b+4>>2]=0,g[b+8>>2]=0,v=cs(T)|0,v|0)do{y=uA(b)|0;do hA(y,v)|0,O=v+16|0,g[w>>2]=g[O>>2],g[w+4>>2]=g[O+4>>2],g[w+8>>2]=g[O+8>>2],g[w+12>>2]=g[O+12>>2],no(T,v)|0,v=ui(T,w)|0;while((v|0)!=0);v=cs(T)|0}while((v|0)!=0);return ia(T),v=Rl(b)|0,v?(Uc(b),O=v,Tt=M,O|0):(O=0,Tt=M,O|0)}function Ii(v){return v=v|0,v>>>0>121?(v=0,v|0):(v=g[7696+(v*28|0)+16>>2]|0,v|0)}function Ln(v){return v=v|0,(v|0)==4|(v|0)==117|0}function So(v){return v=v|0,g[11120+((g[v>>2]|0)*216|0)+((g[v+4>>2]|0)*72|0)+((g[v+8>>2]|0)*24|0)+(g[v+12>>2]<<3)>>2]|0}function lo(v){return v=v|0,g[11120+((g[v>>2]|0)*216|0)+((g[v+4>>2]|0)*72|0)+((g[v+8>>2]|0)*24|0)+(g[v+12>>2]<<3)+4>>2]|0}function is(v,y){v=v|0,y=y|0,v=7696+(v*28|0)|0,g[y>>2]=g[v>>2],g[y+4>>2]=g[v+4>>2],g[y+8>>2]=g[v+8>>2],g[y+12>>2]=g[v+12>>2]}function Pf(v,y){v=v|0,y=y|0;var b=0,w=0;if(y>>>0>20)return y=-1,y|0;do if((g[11120+(y*216|0)>>2]|0)!=(v|0))if((g[11120+(y*216|0)+8>>2]|0)!=(v|0))if((g[11120+(y*216|0)+16>>2]|0)!=(v|0))if((g[11120+(y*216|0)+24>>2]|0)!=(v|0))if((g[11120+(y*216|0)+32>>2]|0)!=(v|0))if((g[11120+(y*216|0)+40>>2]|0)!=(v|0))if((g[11120+(y*216|0)+48>>2]|0)!=(v|0))if((g[11120+(y*216|0)+56>>2]|0)!=(v|0))if((g[11120+(y*216|0)+64>>2]|0)!=(v|0))if((g[11120+(y*216|0)+72>>2]|0)!=(v|0))if((g[11120+(y*216|0)+80>>2]|0)!=(v|0))if((g[11120+(y*216|0)+88>>2]|0)!=(v|0))if((g[11120+(y*216|0)+96>>2]|0)!=(v|0))if((g[11120+(y*216|0)+104>>2]|0)!=(v|0))if((g[11120+(y*216|0)+112>>2]|0)!=(v|0))if((g[11120+(y*216|0)+120>>2]|0)!=(v|0))if((g[11120+(y*216|0)+128>>2]|0)!=(v|0))if((g[11120+(y*216|0)+136>>2]|0)==(v|0))v=2,b=1,w=2;else{if((g[11120+(y*216|0)+144>>2]|0)==(v|0)){v=0,b=2,w=0;break}if((g[11120+(y*216|0)+152>>2]|0)==(v|0)){v=0,b=2,w=1;break}if((g[11120+(y*216|0)+160>>2]|0)==(v|0)){v=0,b=2,w=2;break}if((g[11120+(y*216|0)+168>>2]|0)==(v|0)){v=1,b=2,w=0;break}if((g[11120+(y*216|0)+176>>2]|0)==(v|0)){v=1,b=2,w=1;break}if((g[11120+(y*216|0)+184>>2]|0)==(v|0)){v=1,b=2,w=2;break}if((g[11120+(y*216|0)+192>>2]|0)==(v|0)){v=2,b=2,w=0;break}if((g[11120+(y*216|0)+200>>2]|0)==(v|0)){v=2,b=2,w=1;break}if((g[11120+(y*216|0)+208>>2]|0)==(v|0)){v=2,b=2,w=2;break}else v=-1;return v|0}else v=2,b=1,w=1;else v=2,b=1,w=0;else v=1,b=1,w=2;else v=1,b=1,w=1;else v=1,b=1,w=0;else v=0,b=1,w=2;else v=0,b=1,w=1;else v=0,b=1,w=0;else v=2,b=0,w=2;else v=2,b=0,w=1;else v=2,b=0,w=0;else v=1,b=0,w=2;else v=1,b=0,w=1;else v=1,b=0,w=0;else v=0,b=0,w=2;else v=0,b=0,w=1;else v=0,b=0,w=0;while(!1);return y=g[11120+(y*216|0)+(b*72|0)+(v*24|0)+(w<<3)+4>>2]|0,y|0}function Ah(v,y){return v=v|0,y=y|0,(g[7696+(v*28|0)+20>>2]|0)==(y|0)?(y=1,y|0):(y=(g[7696+(v*28|0)+24>>2]|0)==(y|0),y|0)}function _a(v,y){return v=v|0,y=y|0,g[848+(v*28|0)+(y<<2)>>2]|0}function bl(v,y){return v=v|0,y=y|0,(g[848+(v*28|0)>>2]|0)==(y|0)?(y=0,y|0):(g[848+(v*28|0)+4>>2]|0)==(y|0)?(y=1,y|0):(g[848+(v*28|0)+8>>2]|0)==(y|0)?(y=2,y|0):(g[848+(v*28|0)+12>>2]|0)==(y|0)?(y=3,y|0):(g[848+(v*28|0)+16>>2]|0)==(y|0)?(y=4,y|0):(g[848+(v*28|0)+20>>2]|0)==(y|0)?(y=5,y|0):((g[848+(v*28|0)+24>>2]|0)==(y|0)?6:7)|0}function xl(){return 122}function Rf(v){v=v|0;var y=0,b=0,w=0;y=0;do ei(y|0,0,45)|0,w=Bt()|0|134225919,b=v+(y<<3)|0,g[b>>2]=-1,g[b+4>>2]=w,y=y+1|0;while((y|0)!=122);return 0}function wl(v){return v=v|0,+ct[v+16>>3]<+ct[v+24>>3]|0}function jo(v,y){v=v|0,y=y|0;var b=0,w=0,T=0;return b=+ct[y>>3],!(b>=+ct[v+8>>3])||!(b<=+ct[v>>3])?(y=0,y|0):(w=+ct[v+16>>3],b=+ct[v+24>>3],T=+ct[y+8>>3],y=T>=b,v=T<=w&1,w<b?y&&(v=1):y||(v=0),y=(v|0)!=0,y|0)}function Xs(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0;F=Tt,Tt=Tt+288|0,m=F+264|0,E=F+96|0,f=F,l=f,d=l+96|0;do g[l>>2]=0,l=l+4|0;while((l|0)<(d|0));return y=Tl(y,f)|0,y|0?(R=y,Tt=F,R|0):(d=f,f=g[d>>2]|0,d=g[d+4>>2]|0,Oc(f,d,m)|0,Lc(f,d,E)|0,O=+nc(m,E+8|0),ct[m>>3]=+ct[v>>3],d=m+8|0,ct[d>>3]=+ct[v+16>>3],ct[E>>3]=+ct[v+8>>3],f=E+8|0,ct[f>>3]=+ct[v+24>>3],T=+nc(m,E),W=+ct[d>>3]-+ct[f>>3],M=+Pe(+W),z=+ct[m>>3]-+ct[E>>3],w=+Pe(+z),!(W==0|z==0)&&(W=+jc(+M,+w),W=+Ji(+(T*T/+Ol(+(W/+Ol(+M,+w)),3)/(O*(O*2.59807621135)*.8))),ct[Ce>>3]=W,P=~~W>>>0,R=+Pe(W)>=1?W>0?~~+Gi(+Ee(W/4294967296),4294967295)>>>0:~~+Ji((W-+(~~W>>>0))/4294967296)>>>0:0,(g[Ce+4>>2]&2146435072|0)!=2146435072)?(E=(P|0)==0&(R|0)==0,y=b,g[y>>2]=E?1:P,g[y+4>>2]=E?0:R,y=0):y=1,R=y,Tt=F,R|0)}function ba(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0;f=Tt,Tt=Tt+288|0,O=f+264|0,l=f+96|0,d=f,T=d,M=T+96|0;do g[T>>2]=0,T=T+4|0;while((T|0)<(M|0));return b=Tl(b,d)|0,b|0?(w=b,Tt=f,w|0):(b=d,T=g[b>>2]|0,b=g[b+4>>2]|0,Oc(T,b,O)|0,Lc(T,b,l)|0,m=+nc(O,l+8|0),m=+Ji(+(+nc(v,y)/(m*2))),ct[Ce>>3]=m,b=~~m>>>0,T=+Pe(m)>=1?m>0?~~+Gi(+Ee(m/4294967296),4294967295)>>>0:~~+Ji((m-+(~~m>>>0))/4294967296)>>>0:0,(g[Ce+4>>2]&2146435072|0)==2146435072?(w=1,Tt=f,w|0):(d=(b|0)==0&(T|0)==0,g[w>>2]=d?1:b,g[w+4>>2]=d?0:T,w=0,Tt=f,w|0))}function Ja(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0,g[v>>2]=y,g[v+4>>2]=b,g[v+8>>2]=w}function xa(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0;E=y+8|0,g[E>>2]=0,d=+ct[v>>3],O=+Pe(+d),f=+ct[v+8>>3],l=+Pe(+f)/.8660254037844386,O=O+l*.5,b=~~O,v=~~l,O=O-+(b|0),l=l-+(v|0);do if(O<.5)if(O<.3333333333333333)if(g[y>>2]=b,l<(O+1)*.5){g[y+4>>2]=v;break}else{v=v+1|0,g[y+4>>2]=v;break}else if(P=1-O,v=(!(l<P)&1)+v|0,g[y+4>>2]=v,P<=l&l<O*2){b=b+1|0,g[y>>2]=b;break}else{g[y>>2]=b;break}else{if(!(O<.6666666666666666))if(b=b+1|0,g[y>>2]=b,l<O*.5){g[y+4>>2]=v;break}else{v=v+1|0,g[y+4>>2]=v;break}if(l<1-O){if(g[y+4>>2]=v,O*2+-1<l){g[y>>2]=b;break}}else v=v+1|0,g[y+4>>2]=v;b=b+1|0,g[y>>2]=b}while(!1);do if(d<0)if(v&1){m=(v+1|0)/2|0,m=Ki(b|0,((b|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-((+(m>>>0)+4294967296*+(Bt()|0))*2+1)),g[y>>2]=b;break}else{m=(v|0)/2|0,m=Ki(b|0,((b|0)<0)<<31>>31|0,m|0,((m|0)<0)<<31>>31|0)|0,b=~~(+(b|0)-(+(m>>>0)+4294967296*+(Bt()|0))*2),g[y>>2]=b;break}while(!1);m=y+4|0,f<0&&(b=b-((v<<1|1|0)/2|0)|0,g[y>>2]=b,v=0-v|0,g[m>>2]=v),w=v-b|0,(b|0)<0?(T=0-b|0,g[m>>2]=w,g[E>>2]=T,g[y>>2]=0,v=w,b=0):T=0,(v|0)<0&&(b=b-v|0,g[y>>2]=b,T=T-v|0,g[E>>2]=T,g[m>>2]=0,v=0),M=b-T|0,w=v-T|0,(T|0)<0&&(g[y>>2]=M,g[m>>2]=w,g[E>>2]=0,v=w,b=M,T=0),w=(v|0)<(b|0)?v:b,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(g[y>>2]=b-w,g[m>>2]=v-w,g[E>>2]=T-w)}function _r(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0;y=g[v>>2]|0,O=v+4|0,b=g[O>>2]|0,(y|0)<0&&(b=b-y|0,g[O>>2]=b,M=v+8|0,g[M>>2]=(g[M>>2]|0)-y,g[v>>2]=0,y=0),(b|0)<0?(y=y-b|0,g[v>>2]=y,M=v+8|0,T=(g[M>>2]|0)-b|0,g[M>>2]=T,g[O>>2]=0,b=0):(T=v+8|0,M=T,T=g[T>>2]|0),(T|0)<0&&(y=y-T|0,g[v>>2]=y,b=b-T|0,g[O>>2]=b,g[M>>2]=0,T=0),w=(b|0)<(y|0)?b:y,w=(T|0)<(w|0)?T:w,!((w|0)<=0)&&(g[v>>2]=y-w,g[O>>2]=b-w,g[M>>2]=T-w)}function Rs(v,y){v=v|0,y=y|0;var b=0,w=0;w=g[v+8>>2]|0,b=+((g[v+4>>2]|0)-w|0),ct[y>>3]=+((g[v>>2]|0)-w|0)-b*.5,ct[y+8>>3]=b*.8660254037844386}function Gn(v,y,b){v=v|0,y=y|0,b=b|0,g[b>>2]=(g[y>>2]|0)+(g[v>>2]|0),g[b+4>>2]=(g[y+4>>2]|0)+(g[v+4>>2]|0),g[b+8>>2]=(g[y+8>>2]|0)+(g[v+8>>2]|0)}function fr(v,y,b){v=v|0,y=y|0,b=b|0,g[b>>2]=(g[v>>2]|0)-(g[y>>2]|0),g[b+4>>2]=(g[v+4>>2]|0)-(g[y+4>>2]|0),g[b+8>>2]=(g[v+8>>2]|0)-(g[y+8>>2]|0)}function Xa(v,y){v=v|0,y=y|0;var b=0,w=0;b=Xi(g[v>>2]|0,y)|0,g[v>>2]=b,b=v+4|0,w=Xi(g[b>>2]|0,y)|0,g[b>>2]=w,v=v+8|0,y=Xi(g[v>>2]|0,y)|0,g[v>>2]=y}function Cl(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;O=g[v>>2]|0,l=(O|0)<0,w=(g[v+4>>2]|0)-(l?O:0)|0,M=(w|0)<0,T=(M?0-w|0:0)+((g[v+8>>2]|0)-(l?O:0))|0,b=(T|0)<0,v=b?0:T,y=(M?0:w)-(b?T:0)|0,T=(l?0:O)-(M?w:0)-(b?T:0)|0,b=(y|0)<(T|0)?y:T,b=(v|0)<(b|0)?v:b,w=(b|0)>0,v=v-(w?b:0)|0,y=y-(w?b:0)|0;t:do switch(T-(w?b:0)|0){case 0:switch(y|0){case 0:return l=(v|0)==0?0:(v|0)==1?1:7,l|0;case 1:return l=(v|0)==0?2:(v|0)==1?3:7,l|0;default:break t}case 1:switch(y|0){case 0:return l=(v|0)==0?4:(v|0)==1?5:7,l|0;case 1:{if(!v)v=6;else break t;return v|0}default:break t}}while(!1);return l=7,l|0}function oA(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;O=v+8|0,T=g[O>>2]|0,M=(g[v>>2]|0)-T|0,l=v+4|0,T=(g[l>>2]|0)-T|0;do if(M>>>0>715827881|T>>>0>715827881){if(b=(M|0)>0,b){if((2147483647-M|0)<(M|0)||(2147483647-(M<<1)|0)<(M|0))return l=1,l|0}else if((-2147483648-M|0)>(M|0)||(-2147483648-(M<<1)|0)>(M|0))return l=1,l|0;if(y=M*3|0,(T|0)>0){if((2147483647-T|0)<(T|0))return l=1,l|0}else if((-2147483648-T|0)>(T|0))return l=1,l|0;if(w=T<<1,(M|0)>-1){if((y|-2147483648|0)>=(T|0))return l=1,l|0}else if((y^-2147483648|0)<(T|0))return l=1,l|0;if(b){if((2147483647-M|0)<(w|0))y=1;else{b=w;break}return y|0}else{if((-2147483648-M|0)>(w|0))y=1;else{b=w;break}return y|0}}else b=T<<1,y=M*3|0;while(!1);w=Xr(+(y-T|0)/7)|0,g[v>>2]=w,T=Xr(+(b+M|0)/7)|0,g[l>>2]=T,g[O>>2]=0,b=(T|0)<(w|0),y=b?w:T,b=b?T:w;do if((b|0)<0){if((y|0)>0){if((y|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-y|0)>=(b|0)))break;Qe(23313,22444,355,22455)}if((b|0)==-2147483648|(-2147483648-y|0)>(b|0)&&Qe(23313,22444,355,22455),(y|0)>-1){if((y|-2147483648|0)<(b|0))break;Qe(23313,22444,355,22455)}else{if((y^-2147483648|0)>=(b|0))break;Qe(23313,22444,355,22455)}}while(!1);return y=T-w|0,(w|0)<0?(b=0-w|0,g[l>>2]=y,g[O>>2]=b,g[v>>2]=0,w=0):(y=T,b=0),(y|0)<0&&(w=w-y|0,g[v>>2]=w,b=b-y|0,g[O>>2]=b,g[l>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[v>>2]=M,g[l>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,(w|0)<=0?(l=0,l|0):(g[v>>2]=T-w,g[l>>2]=y-w,g[O>>2]=b-w,l=0,l|0)}function sA(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;O=v+8|0,T=g[O>>2]|0,M=(g[v>>2]|0)-T|0,l=v+4|0,T=(g[l>>2]|0)-T|0;do if(M>>>0>715827881|T>>>0>715827881){if(b=(M|0)>0,b){if((2147483647-M|0)<(M|0))return l=1,l|0}else if((-2147483648-M|0)>(M|0))return l=1,l|0;if(y=M<<1,(T|0)>0){if((2147483647-T|0)<(T|0)||(2147483647-(T<<1)|0)<(T|0))return l=1,l|0}else if((-2147483648-T|0)>(T|0)||(-2147483648-(T<<1)|0)>(T|0))return l=1,l|0;if(w=T*3|0,b){if((2147483647-y|0)<(T|0))return l=1,l|0}else if((-2147483648-y|0)>(T|0))return l=1,l|0;if((T|0)>-1){if((w|-2147483648|0)<(M|0)){b=w;break}else y=1;return y|0}else{if((w^-2147483648|0)<(M|0))y=1;else{b=w;break}return y|0}}else b=T*3|0,y=M<<1;while(!1);w=Xr(+(y+T|0)/7)|0,g[v>>2]=w,T=Xr(+(b-M|0)/7)|0,g[l>>2]=T,g[O>>2]=0,b=(T|0)<(w|0),y=b?w:T,b=b?T:w;do if((b|0)<0){if((y|0)>0){if((y|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-y|0)>=(b|0)))break;Qe(23313,22444,404,22469)}if((b|0)==-2147483648|(-2147483648-y|0)>(b|0)&&Qe(23313,22444,404,22469),(y|0)>-1){if((y|-2147483648|0)<(b|0))break;Qe(23313,22444,404,22469)}else{if((y^-2147483648|0)>=(b|0))break;Qe(23313,22444,404,22469)}}while(!1);return y=T-w|0,(w|0)<0?(b=0-w|0,g[l>>2]=y,g[O>>2]=b,g[v>>2]=0,w=0):(y=T,b=0),(y|0)<0&&(w=w-y|0,g[v>>2]=w,b=b-y|0,g[O>>2]=b,g[l>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[v>>2]=M,g[l>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,(w|0)<=0?(l=0,l|0):(g[v>>2]=T-w,g[l>>2]=y-w,g[O>>2]=b-w,l=0,l|0)}function gh(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;O=v+8|0,b=g[O>>2]|0,y=(g[v>>2]|0)-b|0,l=v+4|0,b=(g[l>>2]|0)-b|0,w=Xr(+((y*3|0)-b|0)/7)|0,g[v>>2]=w,y=Xr(+((b<<1)+y|0)/7)|0,g[l>>2]=y,g[O>>2]=0,b=y-w|0,(w|0)<0?(M=0-w|0,g[l>>2]=b,g[O>>2]=M,g[v>>2]=0,y=b,w=0,b=M):b=0,(y|0)<0&&(w=w-y|0,g[v>>2]=w,b=b-y|0,g[O>>2]=b,g[l>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[v>>2]=M,g[l>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,!((w|0)<=0)&&(g[v>>2]=T-w,g[l>>2]=y-w,g[O>>2]=b-w)}function cu(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;O=v+8|0,b=g[O>>2]|0,y=(g[v>>2]|0)-b|0,l=v+4|0,b=(g[l>>2]|0)-b|0,w=Xr(+((y<<1)+b|0)/7)|0,g[v>>2]=w,y=Xr(+((b*3|0)-y|0)/7)|0,g[l>>2]=y,g[O>>2]=0,b=y-w|0,(w|0)<0?(M=0-w|0,g[l>>2]=b,g[O>>2]=M,g[v>>2]=0,y=b,w=0,b=M):b=0,(y|0)<0&&(w=w-y|0,g[v>>2]=w,b=b-y|0,g[O>>2]=b,g[l>>2]=0,y=0),M=w-b|0,T=y-b|0,(b|0)<0?(g[v>>2]=M,g[l>>2]=T,g[O>>2]=0,y=T,T=M,b=0):T=w,w=(y|0)<(T|0)?y:T,w=(b|0)<(w|0)?b:w,!((w|0)<=0)&&(g[v>>2]=T-w,g[l>>2]=y-w,g[O>>2]=b-w)}function Mc(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;y=g[v>>2]|0,O=v+4|0,b=g[O>>2]|0,l=v+8|0,w=g[l>>2]|0,T=b+(y*3|0)|0,g[v>>2]=T,b=w+(b*3|0)|0,g[O>>2]=b,y=(w*3|0)+y|0,g[l>>2]=y,w=b-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=w,g[l>>2]=y,g[v>>2]=0,b=w,w=0):w=T,(b|0)<0&&(w=w-b|0,g[v>>2]=w,y=y-b|0,g[l>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[v>>2]=M,g[O>>2]=T,g[l>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[v>>2]=w-b,g[O>>2]=T-b,g[l>>2]=y-b)}function Qs(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;T=g[v>>2]|0,O=v+4|0,y=g[O>>2]|0,l=v+8|0,b=g[l>>2]|0,w=(y*3|0)+T|0,T=b+(T*3|0)|0,g[v>>2]=T,g[O>>2]=w,y=(b*3|0)+y|0,g[l>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[l>>2]=y,g[v>>2]=0,T=0):b=w,(b|0)<0&&(T=T-b|0,g[v>>2]=T,y=y-b|0,g[l>>2]=y,g[O>>2]=0,b=0),M=T-y|0,w=b-y|0,(y|0)<0?(g[v>>2]=M,g[O>>2]=w,g[l>>2]=0,T=M,y=0):w=b,b=(w|0)<(T|0)?w:T,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[v>>2]=T-b,g[O>>2]=w-b,g[l>>2]=y-b)}function mh(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0;(y+-1|0)>>>0>=6||(T=(g[15440+(y*12|0)>>2]|0)+(g[v>>2]|0)|0,g[v>>2]=T,l=v+4|0,w=(g[15440+(y*12|0)+4>>2]|0)+(g[l>>2]|0)|0,g[l>>2]=w,O=v+8|0,y=(g[15440+(y*12|0)+8>>2]|0)+(g[O>>2]|0)|0,g[O>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[l>>2]=b,g[O>>2]=y,g[v>>2]=0,w=0):(b=w,w=T),(b|0)<0&&(w=w-b|0,g[v>>2]=w,y=y-b|0,g[O>>2]=y,g[l>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[v>>2]=M,g[l>>2]=T,g[O>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[v>>2]=w-b,g[l>>2]=T-b,g[O>>2]=y-b))}function yh(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;T=g[v>>2]|0,O=v+4|0,y=g[O>>2]|0,l=v+8|0,b=g[l>>2]|0,w=y+T|0,T=b+T|0,g[v>>2]=T,g[O>>2]=w,y=b+y|0,g[l>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[l>>2]=y,g[v>>2]=0,w=0):(b=w,w=T),(b|0)<0&&(w=w-b|0,g[v>>2]=w,y=y-b|0,g[l>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[v>>2]=M,g[O>>2]=T,g[l>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[v>>2]=w-b,g[O>>2]=T-b,g[l>>2]=y-b)}function lu(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;y=g[v>>2]|0,O=v+4|0,w=g[O>>2]|0,l=v+8|0,b=g[l>>2]|0,T=w+y|0,g[v>>2]=T,w=b+w|0,g[O>>2]=w,y=b+y|0,g[l>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[l>>2]=y,g[v>>2]=0,w=0):(b=w,w=T),(b|0)<0&&(w=w-b|0,g[v>>2]=w,y=y-b|0,g[l>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[v>>2]=M,g[O>>2]=T,g[l>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[v>>2]=w-b,g[O>>2]=T-b,g[l>>2]=y-b)}function xs(v){switch(v=v|0,v|0){case 1:{v=5;break}case 5:{v=4;break}case 4:{v=6;break}case 6:{v=2;break}case 2:{v=3;break}case 3:{v=1;break}}return v|0}function ns(v){switch(v=v|0,v|0){case 1:{v=3;break}case 3:{v=2;break}case 2:{v=6;break}case 6:{v=4;break}case 4:{v=5;break}case 5:{v=1;break}}return v|0}function vh(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;y=g[v>>2]|0,O=v+4|0,b=g[O>>2]|0,l=v+8|0,w=g[l>>2]|0,T=b+(y<<1)|0,g[v>>2]=T,b=w+(b<<1)|0,g[O>>2]=b,y=(w<<1)+y|0,g[l>>2]=y,w=b-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=w,g[l>>2]=y,g[v>>2]=0,b=w,w=0):w=T,(b|0)<0&&(w=w-b|0,g[v>>2]=w,y=y-b|0,g[l>>2]=y,g[O>>2]=0,b=0),M=w-y|0,T=b-y|0,(y|0)<0?(g[v>>2]=M,g[O>>2]=T,g[l>>2]=0,w=M,y=0):T=b,b=(T|0)<(w|0)?T:w,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[v>>2]=w-b,g[O>>2]=T-b,g[l>>2]=y-b)}function zr(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;T=g[v>>2]|0,O=v+4|0,y=g[O>>2]|0,l=v+8|0,b=g[l>>2]|0,w=(y<<1)+T|0,T=b+(T<<1)|0,g[v>>2]=T,g[O>>2]=w,y=(b<<1)+y|0,g[l>>2]=y,b=w-T|0,(T|0)<0?(y=y-T|0,g[O>>2]=b,g[l>>2]=y,g[v>>2]=0,T=0):b=w,(b|0)<0&&(T=T-b|0,g[v>>2]=T,y=y-b|0,g[l>>2]=y,g[O>>2]=0,b=0),M=T-y|0,w=b-y|0,(y|0)<0?(g[v>>2]=M,g[O>>2]=w,g[l>>2]=0,T=M,y=0):w=b,b=(w|0)<(T|0)?w:T,b=(y|0)<(b|0)?y:b,!((b|0)<=0)&&(g[v>>2]=T-b,g[O>>2]=w-b,g[l>>2]=y-b)}function El(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0;return O=(g[v>>2]|0)-(g[y>>2]|0)|0,l=(O|0)<0,w=(g[v+4>>2]|0)-(g[y+4>>2]|0)-(l?O:0)|0,M=(w|0)<0,T=(l?0-O|0:0)+(g[v+8>>2]|0)-(g[y+8>>2]|0)+(M?0-w|0:0)|0,v=(T|0)<0,y=v?0:T,b=(M?0:w)-(v?T:0)|0,T=(l?0:O)-(M?w:0)-(v?T:0)|0,v=(b|0)<(T|0)?b:T,v=(y|0)<(v|0)?y:v,w=(v|0)>0,y=y-(w?v:0)|0,b=b-(w?v:0)|0,v=T-(w?v:0)|0,v=(v|0)>-1?v:0-v|0,b=(b|0)>-1?b:0-b|0,y=(y|0)>-1?y:0-y|0,y=(b|0)>(y|0)?b:y,((v|0)>(y|0)?v:y)|0}function wa(v,y){v=v|0,y=y|0;var b=0;b=g[v+8>>2]|0,g[y>>2]=(g[v>>2]|0)-b,g[y+4>>2]=(g[v+4>>2]|0)-b}function Ca(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0;w=g[v>>2]|0,g[y>>2]=w,T=g[v+4>>2]|0,O=y+4|0,g[O>>2]=T,l=y+8|0,g[l>>2]=0,b=(T|0)<(w|0),v=b?w:T,b=b?T:w;do if((b|0)<0){if((v|0)>0){if((v|-2147483648|0)<(b|0)&((b|0)!=-2147483648&(2147483647-v|0)>=(b|0)))break;return v=1,v|0}if((b|0)==-2147483648|(-2147483648-v|0)>(b|0))return y=1,y|0;if((v|0)>-1){if((v|-2147483648|0)<(b|0))break;return v=1,v|0}else{if((v^-2147483648|0)<(b|0))v=1;else break;return v|0}}while(!1);return v=T-w|0,(w|0)<0?(b=0-w|0,g[O>>2]=v,g[l>>2]=b,g[y>>2]=0,w=0):(v=T,b=0),(v|0)<0&&(w=w-v|0,g[y>>2]=w,b=b-v|0,g[l>>2]=b,g[O>>2]=0,v=0),M=w-b|0,T=v-b|0,(b|0)<0?(g[y>>2]=M,g[O>>2]=T,g[l>>2]=0,v=T,T=M,b=0):T=w,w=(v|0)<(T|0)?v:T,w=(b|0)<(w|0)?b:w,(w|0)<=0?(y=0,y|0):(g[y>>2]=T-w,g[O>>2]=v-w,g[l>>2]=b-w,y=0,y|0)}function Ea(v){v=v|0;var y=0,b=0,w=0,T=0;y=v+8|0,T=g[y>>2]|0,b=T-(g[v>>2]|0)|0,g[v>>2]=b,w=v+4|0,v=(g[w>>2]|0)-T|0,g[w>>2]=v,g[y>>2]=0-(v+b)}function Qa(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;b=g[v>>2]|0,y=0-b|0,g[v>>2]=y,O=v+8|0,g[O>>2]=0,l=v+4|0,w=g[l>>2]|0,T=w+b|0,(b|0)>0?(g[l>>2]=T,g[O>>2]=b,g[v>>2]=0,y=0,w=T):b=0,(w|0)<0?(M=y-w|0,g[v>>2]=M,b=b-w|0,g[O>>2]=b,g[l>>2]=0,T=M-b|0,y=0-b|0,(b|0)<0?(g[v>>2]=T,g[l>>2]=y,g[O>>2]=0,w=y,b=0):(w=0,T=M)):T=y,y=(w|0)<(T|0)?w:T,y=(b|0)<(y|0)?b:y,!((y|0)<=0)&&(g[v>>2]=T-y,g[l>>2]=w-y,g[O>>2]=b-y)}function Ba(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0;if(E=Tt,Tt=Tt+64|0,m=E,l=E+56|0,!(!0&(y&2013265920|0)==134217728&(!0&(w&2013265920|0)==134217728)))return T=5,Tt=E,T|0;if((v|0)==(b|0)&(y|0)==(w|0))return g[T>>2]=0,T=0,Tt=E,T|0;if(O=Xe(v|0,y|0,52)|0,Bt()|0,O=O&15,f=Xe(b|0,w|0,52)|0,Bt()|0,(O|0)!=(f&15|0))return T=12,Tt=E,T|0;if(M=O+-1|0,O>>>0>1){Ys(v,y,M,m)|0,Ys(b,w,M,l)|0,f=m,d=g[f>>2]|0,f=g[f+4>>2]|0;t:do if((d|0)==(g[l>>2]|0)&&(f|0)==(g[l+4>>2]|0)){O=(O^15)*3|0,M=Xe(v|0,y|0,O|0)|0,Bt()|0,M=M&7,O=Xe(b|0,w|0,O|0)|0,Bt()|0,O=O&7;do if((M|0)==0|(O|0)==0)g[T>>2]=1,M=0;else if((M|0)==7)M=5;else{if((M|0)==1|(O|0)==1&&Dn(d,f)|0){M=5;break}if((g[15536+(M<<2)>>2]|0)!=(O|0)&&(g[15568+(M<<2)>>2]|0)!=(O|0))break t;g[T>>2]=1,M=0}while(!1);return T=M,Tt=E,T|0}while(!1)}M=m,O=M+56|0;do g[M>>2]=0,M=M+4|0;while((M|0)<(O|0));return Rn(v,y,1,m)|0,y=m,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0))&&(y=m+8|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+16|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+24|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+32|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))&&(y=m+40|0,!((g[y>>2]|0)==(b|0)&&(g[y+4>>2]|0)==(w|0)))?(M=m+48|0,M=((g[M>>2]|0)==(b|0)?(g[M+4>>2]|0)==(w|0):0)&1):M=1,g[T>>2]=M,T=0,Tt=E,T|0}function Ka(v,y,b,w,T){return v=v|0,y=y|0,b=b|0,w=w|0,T=T|0,b=_l(v,y,b,w)|0,(b|0)==7?(T=11,T|0):(w=ei(b|0,0,56)|0,y=y&-2130706433|(Bt()|0)|268435456,g[T>>2]=v|w,g[T+4>>2]=y,T=0,T|0)}function qa(v,y,b){return v=v|0,y=y|0,b=b|0,!0&(y&2013265920|0)==268435456?(g[b>>2]=v,g[b+4>>2]=y&-2130706433|134217728,b=0,b|0):(b=6,b|0)}function Ta(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;return T=Tt,Tt=Tt+16|0,w=T,g[w>>2]=0,!0&(y&2013265920|0)==268435456?(M=Xe(v|0,y|0,56)|0,Bt()|0,w=Sn(v,y&-2130706433|134217728,M&7,w,b)|0,Tt=T,w|0):(w=6,Tt=T,w|0)}function Df(v,y){v=v|0,y=y|0;var b=0;switch(b=Xe(v|0,y|0,56)|0,Bt()|0,b&7){case 0:case 7:return b=0,b|0}return b=y&-2130706433|134217728,!(!0&(y&2013265920|0)==268435456)||!0&(y&117440512|0)==16777216&(Dn(v,b)|0)!=0?(b=0,b|0):(b=Zs(v,b)|0,b|0)}function Of(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;return T=Tt,Tt=Tt+16|0,w=T,!0&(y&2013265920|0)==268435456?(M=y&-2130706433|134217728,O=b,g[O>>2]=v,g[O+4>>2]=M,g[w>>2]=0,y=Xe(v|0,y|0,56)|0,Bt()|0,w=Sn(v,M,y&7,w,b+8|0)|0,Tt=T,w|0):(w=6,Tt=T,w|0)}function In(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0;return T=(Dn(v,y)|0)==0,y=y&-2130706433,w=b,g[w>>2]=T?v:0,g[w+4>>2]=T?y|285212672:0,w=b+8|0,g[w>>2]=v,g[w+4>>2]=y|301989888,w=b+16|0,g[w>>2]=v,g[w+4>>2]=y|318767104,w=b+24|0,g[w>>2]=v,g[w+4>>2]=y|335544320,w=b+32|0,g[w>>2]=v,g[w+4>>2]=y|352321536,b=b+40|0,g[b>>2]=v,g[b+4>>2]=y|369098752,0}function uu(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;return O=Tt,Tt=Tt+16|0,T=O,M=y&-2130706433|134217728,!0&(y&2013265920|0)==268435456?(w=Xe(v|0,y|0,56)|0,Bt()|0,w=Cs(v,M,w&7)|0,(w|0)==-1?(g[b>>2]=0,M=6,Tt=O,M|0):(tc(v,M,T)|0&&Qe(23313,22484,282,22499),y=Xe(v|0,y|0,52)|0,Bt()|0,y=y&15,Dn(v,M)|0?Ks(T,y,w,2,b):fu(T,y,w,2,b),M=0,Tt=O,M|0)):(M=6,Tt=O,M|0)}function hu(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0;w=Tt,Tt=Tt+16|0,T=w,Lf(v,y,b,T),xa(T,b+4|0),Tt=w}function Lf(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0;if(l=Tt,Tt=Tt+16|0,d=l,Ff(v,b,d),M=+Ni(+(1-+ct[d>>3]*.5)),M<1e-16){g[w>>2]=0,g[w+4>>2]=0,g[w+8>>2]=0,g[w+12>>2]=0,Tt=l;return}if(d=g[b>>2]|0,T=+ct[15920+(d*24|0)>>3],T=+kc(T-+kc(+xh(15600+(d<<4)|0,v))),Vo(y)|0?O=+kc(T+-.3334731722518321):O=T,T=+je(+M)/.381966011250105,(y|0)>0){v=0;do T=T*2.6457513110645907,v=v+1|0;while((v|0)!=(y|0))}M=+Fe(+O)*T,ct[w>>3]=M,O=+Ie(+O)*T,ct[w+8>>3]=O,Tt=l}function Ff(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(M=Tt,Tt=Tt+32|0,T=M,Th(v,T),g[y>>2]=0,ct[b>>3]=5,w=+Br(16400,T),w<+ct[b>>3]&&(g[y>>2]=0,ct[b>>3]=w),w=+Br(16424,T),w<+ct[b>>3]&&(g[y>>2]=1,ct[b>>3]=w),w=+Br(16448,T),w<+ct[b>>3]&&(g[y>>2]=2,ct[b>>3]=w),w=+Br(16472,T),w<+ct[b>>3]&&(g[y>>2]=3,ct[b>>3]=w),w=+Br(16496,T),w<+ct[b>>3]&&(g[y>>2]=4,ct[b>>3]=w),w=+Br(16520,T),w<+ct[b>>3]&&(g[y>>2]=5,ct[b>>3]=w),w=+Br(16544,T),w<+ct[b>>3]&&(g[y>>2]=6,ct[b>>3]=w),w=+Br(16568,T),w<+ct[b>>3]&&(g[y>>2]=7,ct[b>>3]=w),w=+Br(16592,T),w<+ct[b>>3]&&(g[y>>2]=8,ct[b>>3]=w),w=+Br(16616,T),w<+ct[b>>3]&&(g[y>>2]=9,ct[b>>3]=w),w=+Br(16640,T),w<+ct[b>>3]&&(g[y>>2]=10,ct[b>>3]=w),w=+Br(16664,T),w<+ct[b>>3]&&(g[y>>2]=11,ct[b>>3]=w),w=+Br(16688,T),w<+ct[b>>3]&&(g[y>>2]=12,ct[b>>3]=w),w=+Br(16712,T),w<+ct[b>>3]&&(g[y>>2]=13,ct[b>>3]=w),w=+Br(16736,T),w<+ct[b>>3]&&(g[y>>2]=14,ct[b>>3]=w),w=+Br(16760,T),w<+ct[b>>3]&&(g[y>>2]=15,ct[b>>3]=w),w=+Br(16784,T),w<+ct[b>>3]&&(g[y>>2]=16,ct[b>>3]=w),w=+Br(16808,T),w<+ct[b>>3]&&(g[y>>2]=17,ct[b>>3]=w),w=+Br(16832,T),w<+ct[b>>3]&&(g[y>>2]=18,ct[b>>3]=w),w=+Br(16856,T),!(w<+ct[b>>3])){Tt=M;return}g[y>>2]=19,ct[b>>3]=w,Tt=M}function Pc(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0;if(M=+ea(v),M<1e-16){y=15600+(y<<4)|0,g[T>>2]=g[y>>2],g[T+4>>2]=g[y+4>>2],g[T+8>>2]=g[y+8>>2],g[T+12>>2]=g[y+12>>2];return}if(O=+ln(+ +ct[v+8>>3],+ +ct[v>>3]),(b|0)>0){v=0;do M=M/2.6457513110645907,v=v+1|0;while((v|0)!=(b|0))}w?(M=M/3,b=(Vo(b)|0)==0,M=+tn(+((b?M:M/2.6457513110645907)*.381966011250105))):(M=+tn(+(M*.381966011250105)),Vo(b)|0&&(O=+kc(O+.3334731722518321))),Il(15600+(y<<4)|0,+kc(+ct[15920+(y*24|0)>>3]-O),M,T)}function kf(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0;w=Tt,Tt=Tt+16|0,T=w,Rs(v+4|0,T),Pc(T,g[v>>2]|0,y,0,b),Tt=w}function Ks(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0,It=0,Vt=0,Jt=0,te=0,Qt=0,$t=0,pe=0,Oe=0,xe=0;if(pe=Tt,Tt=Tt+272|0,M=pe+256|0,Z=pe+240|0,te=pe,Qt=pe+224|0,$t=pe+208|0,it=pe+176|0,ot=pe+160|0,bt=pe+192|0,Pt=pe+144|0,mt=pe+128|0,It=pe+112|0,Vt=pe+96|0,Jt=pe+80|0,g[M>>2]=y,g[Z>>2]=g[v>>2],g[Z+4>>2]=g[v+4>>2],g[Z+8>>2]=g[v+8>>2],g[Z+12>>2]=g[v+12>>2],qs(Z,M,te),g[T>>2]=0,Z=w+b+((w|0)==5&1)|0,(Z|0)<=(b|0)){Tt=pe;return}d=g[M>>2]|0,f=Qt+4|0,m=it+4|0,E=b+5|0,P=16880+(d<<2)|0,R=16960+(d<<2)|0,F=mt+8|0,z=It+8|0,W=Vt+8|0,et=$t+4|0,l=b;t:for(;;){O=te+(((l|0)%5|0)<<4)|0,g[$t>>2]=g[O>>2],g[$t+4>>2]=g[O+4>>2],g[$t+8>>2]=g[O+8>>2],g[$t+12>>2]=g[O+12>>2];do;while((rs($t,d,0,1)|0)==2);if((l|0)>(b|0)&(Vo(y)|0)!=0){if(g[it>>2]=g[$t>>2],g[it+4>>2]=g[$t+4>>2],g[it+8>>2]=g[$t+8>>2],g[it+12>>2]=g[$t+12>>2],Rs(f,ot),w=g[it>>2]|0,M=g[17040+(w*80|0)+(g[Qt>>2]<<2)>>2]|0,g[it>>2]=g[18640+(w*80|0)+(M*20|0)>>2],O=g[18640+(w*80|0)+(M*20|0)+16>>2]|0,(O|0)>0){v=0;do yh(m),v=v+1|0;while((v|0)<(O|0))}switch(O=18640+(w*80|0)+(M*20|0)+4|0,g[bt>>2]=g[O>>2],g[bt+4>>2]=g[O+4>>2],g[bt+8>>2]=g[O+8>>2],Xa(bt,(g[P>>2]|0)*3|0),Gn(m,bt,m),_r(m),Rs(m,Pt),Oe=+(g[R>>2]|0),ct[mt>>3]=Oe*3,ct[F>>3]=0,xe=Oe*-1.5,ct[It>>3]=xe,ct[z>>3]=Oe*2.598076211353316,ct[Vt>>3]=xe,ct[W>>3]=Oe*-2.598076211353316,g[17040+((g[it>>2]|0)*80|0)+(g[$t>>2]<<2)>>2]|0){case 1:{v=It,w=mt;break}case 3:{v=Vt,w=It;break}case 2:{v=mt,w=Vt;break}default:{v=12;break t}}Bh(ot,Pt,w,v,Jt),Pc(Jt,g[it>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1}if((l|0)<(E|0)&&(Rs(et,it),Pc(it,g[$t>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1),g[Qt>>2]=g[$t>>2],g[Qt+4>>2]=g[$t+4>>2],g[Qt+8>>2]=g[$t+8>>2],g[Qt+12>>2]=g[$t+12>>2],l=l+1|0,(l|0)>=(Z|0)){v=3;break}}if((v|0)==3){Tt=pe;return}else(v|0)==12&&Qe(22522,22569,571,22579)}function qs(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0;d=Tt,Tt=Tt+128|0,w=d+64|0,T=d,M=w,O=20240,l=M+60|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));M=T,O=20304,l=M+60|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));l=(Vo(g[y>>2]|0)|0)==0,w=l?w:T,T=v+4|0,vh(T),zr(T),Vo(g[y>>2]|0)|0&&(Qs(T),g[y>>2]=(g[y>>2]|0)+1),g[b>>2]=g[v>>2],y=b+4|0,Gn(T,w,y),_r(y),g[b+16>>2]=g[v>>2],y=b+20|0,Gn(T,w+12|0,y),_r(y),g[b+32>>2]=g[v>>2],y=b+36|0,Gn(T,w+24|0,y),_r(y),g[b+48>>2]=g[v>>2],y=b+52|0,Gn(T,w+36|0,y),_r(y),g[b+64>>2]=g[v>>2],b=b+68|0,Gn(T,w+48|0,b),_r(b),Tt=d}function rs(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(F=Tt,Tt=Tt+32|0,P=F+12|0,l=F,R=v+4|0,E=g[16960+(y<<2)>>2]|0,m=(w|0)!=0,E=m?E*3|0:E,T=g[R>>2]|0,f=v+8|0,O=g[f>>2]|0,m){if(M=v+12|0,w=g[M>>2]|0,T=O+T+w|0,(T|0)==(E|0))return R=1,Tt=F,R|0;d=M}else d=v+12|0,w=g[d>>2]|0,T=O+T+w|0;if((T|0)<=(E|0))return R=0,Tt=F,R|0;do if((w|0)>0){if(w=g[v>>2]|0,(O|0)>0){M=18640+(w*80|0)+60|0,w=v;break}w=18640+(w*80|0)+40|0,b?(Ja(P,E,0,0),fr(R,P,l),lu(l),Gn(l,P,R),M=w,w=v):(M=w,w=v)}else M=18640+((g[v>>2]|0)*80|0)+20|0,w=v;while(!1);if(g[w>>2]=g[M>>2],T=M+16|0,(g[T>>2]|0)>0){w=0;do yh(R),w=w+1|0;while((w|0)<(g[T>>2]|0))}return v=M+4|0,g[P>>2]=g[v>>2],g[P+4>>2]=g[v+4>>2],g[P+8>>2]=g[v+8>>2],y=g[16880+(y<<2)>>2]|0,Xa(P,m?y*3|0:y),Gn(R,P,R),_r(R),m?w=((g[f>>2]|0)+(g[R>>2]|0)+(g[d>>2]|0)|0)==(E|0)?1:2:w=2,R=w,Tt=F,R|0}function Nf(v,y){v=v|0,y=y|0;var b=0;do b=rs(v,y,0,1)|0;while((b|0)==2);return b|0}function fu(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0,It=0,Vt=0,Jt=0,te=0;if(Vt=Tt,Tt=Tt+240|0,M=Vt+224|0,bt=Vt+208|0,Pt=Vt,mt=Vt+192|0,It=Vt+176|0,W=Vt+160|0,et=Vt+144|0,Z=Vt+128|0,it=Vt+112|0,ot=Vt+96|0,g[M>>2]=y,g[bt>>2]=g[v>>2],g[bt+4>>2]=g[v+4>>2],g[bt+8>>2]=g[v+8>>2],g[bt+12>>2]=g[v+12>>2],du(bt,M,Pt),g[T>>2]=0,z=w+b+((w|0)==6&1)|0,(z|0)<=(b|0)){Tt=Vt;return}d=g[M>>2]|0,f=b+6|0,m=16960+(d<<2)|0,E=et+8|0,P=Z+8|0,R=it+8|0,F=mt+4|0,O=0,l=b,w=-1;t:for(;;){if(M=(l|0)%6|0,v=Pt+(M<<4)|0,g[mt>>2]=g[v>>2],g[mt+4>>2]=g[v+4>>2],g[mt+8>>2]=g[v+8>>2],g[mt+12>>2]=g[v+12>>2],v=O,O=rs(mt,d,0,1)|0,(l|0)>(b|0)&(Vo(y)|0)!=0&&(v|0)!=1&&(g[mt>>2]|0)!=(w|0)){switch(Rs(Pt+(((M+5|0)%6|0)<<4)+4|0,It),Rs(Pt+(M<<4)+4|0,W),Jt=+(g[m>>2]|0),ct[et>>3]=Jt*3,ct[E>>3]=0,te=Jt*-1.5,ct[Z>>3]=te,ct[P>>3]=Jt*2.598076211353316,ct[it>>3]=te,ct[R>>3]=Jt*-2.598076211353316,M=g[bt>>2]|0,g[17040+(M*80|0)+(((w|0)==(M|0)?g[mt>>2]|0:w)<<2)>>2]|0){case 1:{v=Z,w=et;break}case 3:{v=it,w=Z;break}case 2:{v=et,w=it;break}default:{v=8;break t}}Bh(It,W,w,v,ot),!(Gc(It,ot)|0)&&!(Gc(W,ot)|0)&&(Pc(ot,g[bt>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1)}if((l|0)<(f|0)&&(Rs(F,It),Pc(It,g[mt>>2]|0,d,1,T+8+(g[T>>2]<<4)|0),g[T>>2]=(g[T>>2]|0)+1),l=l+1|0,(l|0)>=(z|0)){v=3;break}else w=g[mt>>2]|0}if((v|0)==3){Tt=Vt;return}else(v|0)==8&&Qe(22606,22569,736,22651)}function du(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0;d=Tt,Tt=Tt+160|0,w=d+80|0,T=d,M=w,O=20368,l=M+72|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));M=T,O=20448,l=M+72|0;do g[M>>2]=g[O>>2],M=M+4|0,O=O+4|0;while((M|0)<(l|0));l=(Vo(g[y>>2]|0)|0)==0,w=l?w:T,T=v+4|0,vh(T),zr(T),Vo(g[y>>2]|0)|0&&(Qs(T),g[y>>2]=(g[y>>2]|0)+1),g[b>>2]=g[v>>2],y=b+4|0,Gn(T,w,y),_r(y),g[b+16>>2]=g[v>>2],y=b+20|0,Gn(T,w+12|0,y),_r(y),g[b+32>>2]=g[v>>2],y=b+36|0,Gn(T,w+24|0,y),_r(y),g[b+48>>2]=g[v>>2],y=b+52|0,Gn(T,w+36|0,y),_r(y),g[b+64>>2]=g[v>>2],y=b+68|0,Gn(T,w+48|0,y),_r(y),g[b+80>>2]=g[v>>2],b=b+84|0,Gn(T,w+60|0,b),_r(b),Tt=d}function Za(v,y){return v=v|0,y=y|0,y=Xe(v|0,y|0,52)|0,Bt()|0,y&15|0}function _h(v,y){return v=v|0,y=y|0,y=Xe(v|0,y|0,45)|0,Bt()|0,y&127|0}function Zs(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0;if(!(!0&(y&-16777216|0)==134217728)||(O=Xe(v|0,y|0,45)|0,Bt()|0,O=O&127,O>>>0>121))return y=0,y|0;b=Xe(v|0,y|0,52)|0,Bt()|0,b=b&15;do if(b|0){for(T=1,w=0;;){if(M=Xe(v|0,y|0,(15-T|0)*3|0)|0,Bt()|0,M=M&7,(M|0)!=0&(w^1))if((M|0)==1&(Ii(O)|0)!=0){l=0,w=13;break}else w=1;if((M|0)==7){l=0,w=13;break}if(T>>>0<b>>>0)T=T+1|0;else{w=9;break}}if((w|0)==9){if((b|0)==15)l=1;else break;return l|0}else if((w|0)==13)return l|0}while(!1);for(;;){if(l=Xe(v|0,y|0,(14-b|0)*3|0)|0,Bt()|0,!((l&7|0)==7&!0)){l=0,w=13;break}if(b>>>0<14)b=b+1|0;else{l=1,w=13;break}}return(w|0)==13?l|0:0}function Ys(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;if(M=Xe(v|0,y|0,52)|0,Bt()|0,M=M&15,b>>>0>15)return w=4,w|0;if((M|0)<(b|0))return w=12,w|0;if((M|0)==(b|0))return g[w>>2]=v,g[w+4>>2]=y,w=0,w|0;if(T=ei(b|0,0,52)|0,T=T|v,v=Bt()|0|y&-15728641,(M|0)>(b|0))do y=ei(7,0,(14-b|0)*3|0)|0,b=b+1|0,T=y|T,v=Bt()|0|v;while((b|0)<(M|0));return g[w>>2]=T,g[w+4>>2]=v,w=0,w|0}function Bl(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0;if(M=Xe(v|0,y|0,52)|0,Bt()|0,M=M&15,!((b|0)<16&(M|0)<=(b|0)))return w=4,w|0;T=b-M|0,b=Xe(v|0,y|0,45)|0,Bt()|0;t:do if(!(Ii(b&127)|0))b=Jo(7,0,T,((T|0)<0)<<31>>31)|0,T=Bt()|0;else{e:do if(M|0){for(b=1;O=ei(7,0,(15-b|0)*3|0)|0,!!((O&v|0)==0&((Bt()|0)&y|0)==0);)if(b>>>0<M>>>0)b=b+1|0;else break e;b=Jo(7,0,T,((T|0)<0)<<31>>31)|0,T=Bt()|0;break t}while(!1);b=Jo(7,0,T,((T|0)<0)<<31>>31)|0,b=dr(b|0,Bt()|0,5,0)|0,b=An(b|0,Bt()|0,-5,-1)|0,b=Xo(b|0,Bt()|0,6,0)|0,b=An(b|0,Bt()|0,1,0)|0,T=Bt()|0}while(!1);return O=w,g[O>>2]=b,g[O+4>>2]=T,O=0,O|0}function Dn(v,y){v=v|0,y=y|0;var b=0,w=0,T=0;if(T=Xe(v|0,y|0,45)|0,Bt()|0,!(Ii(T&127)|0))return T=0,T|0;T=Xe(v|0,y|0,52)|0,Bt()|0,T=T&15;t:do if(!T)b=0;else for(w=1;;){if(b=Xe(v|0,y|0,(15-w|0)*3|0)|0,Bt()|0,b=b&7,b|0)break t;if(w>>>0<T>>>0)w=w+1|0;else{b=0;break}}while(!1);return T=(b|0)==0&1,T|0}function Fn(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0;if(O=Tt,Tt=Tt+16|0,M=O,Sl(M,v,y,b),y=M,v=g[y>>2]|0,y=g[y+4>>2]|0,(v|0)==0&(y|0)==0)return Tt=O,0;T=0,b=0;do l=w+(T<<3)|0,g[l>>2]=v,g[l+4>>2]=y,T=An(T|0,b|0,1,0)|0,b=Bt()|0,yu(M),l=M,v=g[l>>2]|0,y=g[l+4>>2]|0;while(!((v|0)==0&(y|0)==0));return Tt=O,0}function pu(v,y,b,w){return v=v|0,y=y|0,b=b|0,w=w|0,(w|0)<(b|0)?(b=y,w=v,mi(b|0),w|0):(b=ei(-1,-1,((w-b|0)*3|0)+3|0)|0,w=ei(~b|0,~(Bt()|0)|0,(15-w|0)*3|0)|0,b=~(Bt()|0)&y,w=~w&v,mi(b|0),w|0)}function aA(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0;return T=Xe(v|0,y|0,52)|0,Bt()|0,T=T&15,(b|0)<16&(T|0)<=(b|0)?((T|0)<(b|0)&&(T=ei(-1,-1,((b+-1-T|0)*3|0)+3|0)|0,T=ei(~T|0,~(Bt()|0)|0,(15-b|0)*3|0)|0,y=~(Bt()|0)&y,v=~T&v),T=ei(b|0,0,52)|0,b=y&-15728641|(Bt()|0),g[w>>2]=v|T,g[w+4>>2]=b,w=0,w|0):(w=4,w|0)}function Rc(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0,It=0;if((b|0)==0&(w|0)==0)return mt=0,mt|0;if(T=v,M=g[T>>2]|0,T=g[T+4>>2]|0,!0&(T&15728640|0)==0){if(!((w|0)>0|(w|0)==0&b>>>0>0)||(mt=y,g[mt>>2]=M,g[mt+4>>2]=T,(b|0)==1&(w|0)==0))return mt=0,mt|0;T=1;do bt=v+(T<<3)|0,Pt=g[bt+4>>2]|0,mt=y+(T<<3)|0,g[mt>>2]=g[bt>>2],g[mt+4>>2]=Pt,T=T+1|0;while(0<(w|0)|(w|0)==0&T>>>0<b>>>0);return T=0,T|0}if(ot=b<<3,Pt=Qn(ot)|0,!Pt)return mt=13,mt|0;if(Ls(Pt|0,v|0,ot|0)|0,bt=ls(b,8)|0,!bt)return Ui(Pt),mt=13,mt|0;t:do if(b|0){e:for(;;){T=Pt,et=g[T>>2]|0,T=g[T+4>>2]|0,Z=Xe(et|0,T|0,52)|0,Bt()|0,Z=Z&15,it=Z+-1|0,W=(b|0)>0;i:do if((Z|0)!=0&W){if(R=((b|0)<0)<<31>>31,F=ei(it|0,0,52)|0,z=Bt()|0,it>>>0>15){if(!((et|0)==0&(T|0)==0)){mt=17;break e}for(M=0;;){if(M=M+1|0,(M|0)>=(b|0))break i;if(w=Pt+(M<<3)|0,z=g[w>>2]|0,w=g[w+4>>2]|0,!((z|0)==0&(w|0)==0)){T=w,mt=17;break e}}}for(M=0,v=et,w=T;;){if(!((v|0)==0&(w|0)==0)){if(!(!0&(w&117440512|0)==0)){mt=22;break e}if(l=Xe(v|0,w|0,52)|0,Bt()|0,l=l&15,(l|0)<(it|0)){T=12,mt=28;break e}if((l|0)!=(it|0)&&(v=v|F,w=w&-15728641|z,l>>>0>=Z>>>0)){O=it;do P=ei(7,0,(14-O|0)*3|0)|0,O=O+1|0,v=P|v,w=Bt()|0|w;while(O>>>0<l>>>0)}if(O=Es(v|0,w|0,b|0,R|0)|0,Bt()|0,f=bt+(O<<3)|0,l=f,d=g[l>>2]|0,l=g[l+4>>2]|0,(d|0)==0&(l|0)==0)O=f;else for(P=0;;){if((P|0)>(b|0)){mt=32;break e}if((d|0)==(v|0)&(l&-117440513|0)==(w|0)){m=Xe(d|0,l|0,56)|0,Bt()|0,m=m&7,E=m+1|0,It=Xe(d|0,l|0,45)|0,Bt()|0;n:do if(!(Ii(It&127)|0))l=7;else{if(d=Xe(d|0,l|0,52)|0,Bt()|0,d=d&15,!d){l=6;break}for(l=1;;){if(It=ei(7,0,(15-l|0)*3|0)|0,!((It&v|0)==0&((Bt()|0)&w|0)==0)){l=7;break n}if(l>>>0<d>>>0)l=l+1|0;else{l=6;break}}}while(!1);if((m+2|0)>>>0>l>>>0){mt=42;break e}It=ei(E|0,0,56)|0,w=Bt()|0|w&-117440513,E=f,g[E>>2]=0,g[E+4>>2]=0,v=It|v}else O=(O+1|0)%(b|0)|0;if(f=bt+(O<<3)|0,l=f,d=g[l>>2]|0,l=g[l+4>>2]|0,(d|0)==0&(l|0)==0){O=f;break}else P=P+1|0}It=O,g[It>>2]=v,g[It+4>>2]=w}if(M=M+1|0,(M|0)>=(b|0))break i;w=Pt+(M<<3)|0,v=g[w>>2]|0,w=g[w+4>>2]|0}}while(!1);if((b+5|0)>>>0<11){mt=85;break}if(z=ls((b|0)/6|0,8)|0,!z){mt=49;break}i:do if(W){P=0,E=0;do{if(l=bt+(P<<3)|0,w=l,M=g[w>>2]|0,w=g[w+4>>2]|0,!((M|0)==0&(w|0)==0)){d=Xe(M|0,w|0,56)|0,Bt()|0,d=d&7,v=d+1|0,f=w&-117440513,It=Xe(M|0,w|0,45)|0,Bt()|0;n:do if(Ii(It&127)|0){if(m=Xe(M|0,w|0,52)|0,Bt()|0,m=m&15,m|0)for(O=1;;){if(It=ei(7,0,(15-O|0)*3|0)|0,!((M&It|0)==0&(f&(Bt()|0)|0)==0))break n;if(O>>>0<m>>>0)O=O+1|0;else break}w=ei(v|0,0,56)|0,M=w|M,w=Bt()|0|f,v=l,g[v>>2]=M,g[v+4>>2]=w,v=d+2|0}while(!1);(v|0)==7&&(It=z+(E<<3)|0,g[It>>2]=M,g[It+4>>2]=w&-117440513,E=E+1|0)}P=P+1|0}while((P|0)!=(b|0));if(W){if(P=((b|0)<0)<<31>>31,R=ei(it|0,0,52)|0,F=Bt()|0,it>>>0>15){if(!((et|0)==0&(T|0)==0)){T=4,mt=84;break e}for(T=0;;){if(T=T+1|0,(T|0)>=(b|0)){M=0,T=E;break i}if(It=Pt+(T<<3)|0,!((g[It>>2]|0)==0&(g[It+4>>2]|0)==0)){T=4,mt=84;break e}}}for(m=0,M=0,f=et;;){do if(!((f|0)==0&(T|0)==0)){if(l=Xe(f|0,T|0,52)|0,Bt()|0,l=l&15,(l|0)<(it|0)){T=12,mt=84;break e}do if((l|0)==(it|0))w=f,l=T;else{if(w=f|R,v=T&-15728641|F,l>>>0<Z>>>0){l=v;break}O=it;do It=ei(7,0,(14-O|0)*3|0)|0,O=O+1|0,w=It|w,v=Bt()|0|v;while(O>>>0<l>>>0);l=v}while(!1);for(O=Es(w|0,l|0,b|0,P|0)|0,Bt()|0,v=0;;){if((v|0)>(b|0)){mt=77;break e}if(It=bt+(O<<3)|0,d=g[It+4>>2]|0,(d&-117440513|0)==(l|0)&&(g[It>>2]|0)==(w|0)){mt=79;break}if(O=(O+1|0)%(b|0)|0,It=bt+(O<<3)|0,(g[It>>2]|0)==(w|0)&&(g[It+4>>2]|0)==(l|0))break;v=v+1|0}if((mt|0)==79&&(mt=0,!0&(d&117440512|0)==100663296))break;It=y+(M<<3)|0,g[It>>2]=f,g[It+4>>2]=T,M=M+1|0}while(!1);if(T=m+1|0,(T|0)>=(b|0)){T=E;break i}It=Pt+(T<<3)|0,m=T,f=g[It>>2]|0,T=g[It+4>>2]|0}}else M=0,T=E}else M=0,T=0;while(!1);if(ra(bt|0,0,ot|0)|0,Ls(Pt|0,z|0,T<<3|0)|0,Ui(z),T)y=y+(M<<3)|0,b=T;else break t}if((mt|0)==17)!0&(T&117440512|0)==0?(T=4,mt=28):mt=22;else if((mt|0)==32)Qe(23313,22674,362,22684);else{if((mt|0)==42)return Ui(Pt),Ui(bt),It=10,It|0;if((mt|0)==49)return Ui(Pt),Ui(bt),It=13,It|0;if((mt|0)==77)Qe(23313,22674,462,22684);else{if((mt|0)==84)return Ui(z),Ui(Pt),Ui(bt),It=T,It|0;if((mt|0)==85){Ls(y|0,Pt|0,b<<3|0)|0;break}}}if((mt|0)==22)return Ui(Pt),Ui(bt),It=5,It|0;if((mt|0)==28)return Ui(Pt),Ui(bt),It=T,It|0}while(!1);return Ui(Pt),Ui(bt),It=0,It|0}function Uf(v,y,b,w,T,M,O){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0,O=O|0;var l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0;if(z=Tt,Tt=Tt+16|0,F=z,!((b|0)>0|(b|0)==0&y>>>0>0))return F=0,Tt=z,F|0;if((O|0)>=16)return F=12,Tt=z,F|0;P=0,R=0,E=0,l=0;t:for(;;){if(f=v+(P<<3)|0,d=g[f>>2]|0,f=g[f+4>>2]|0,m=Xe(d|0,f|0,52)|0,Bt()|0,(m&15|0)>(O|0)){l=12,d=11;break}if(Sl(F,d,f,O),m=F,f=g[m>>2]|0,m=g[m+4>>2]|0,(f|0)==0&(m|0)==0)d=E;else{d=E;do{if(!((l|0)<(M|0)|(l|0)==(M|0)&d>>>0<T>>>0)){d=10;break t}E=w+(d<<3)|0,g[E>>2]=f,g[E+4>>2]=m,d=An(d|0,l|0,1,0)|0,l=Bt()|0,yu(F),E=F,f=g[E>>2]|0,m=g[E+4>>2]|0}while(!((f|0)==0&(m|0)==0))}if(P=An(P|0,R|0,1,0)|0,R=Bt()|0,(R|0)<(b|0)|(R|0)==(b|0)&P>>>0<y>>>0)E=d;else{l=0,d=11;break}}return(d|0)==10?(F=14,Tt=z,F|0):(d|0)==11?(Tt=z,l|0):0}function cA(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0;P=Tt,Tt=Tt+16|0,E=P;t:do if((b|0)>0|(b|0)==0&y>>>0>0){for(f=0,O=0,M=0,m=0;;){if(d=v+(f<<3)|0,l=g[d>>2]|0,d=g[d+4>>2]|0,!((l|0)==0&(d|0)==0)&&(d=(Bl(l,d,w,E)|0)==0,l=E,O=An(g[l>>2]|0,g[l+4>>2]|0,O|0,M|0)|0,M=Bt()|0,!d)){M=12;break}if(f=An(f|0,m|0,1,0)|0,m=Bt()|0,!((m|0)<(b|0)|(m|0)==(b|0)&f>>>0<y>>>0))break t}return Tt=P,M|0}else O=0,M=0;while(!1);return g[T>>2]=O,g[T+4>>2]=M,T=0,Tt=P,T|0}function zf(v,y){return v=v|0,y=y|0,y=Xe(v|0,y|0,52)|0,Bt()|0,y&1|0}function eo(v,y){v=v|0,y=y|0;var b=0,w=0,T=0;if(T=Xe(v|0,y|0,52)|0,Bt()|0,T=T&15,!T)return T=0,T|0;for(w=1;;){if(b=Xe(v|0,y|0,(15-w|0)*3|0)|0,Bt()|0,b=b&7,b|0){w=5;break}if(w>>>0<T>>>0)w=w+1|0;else{b=0,w=5;break}}return(w|0)==5?b|0:0}function Sa(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0,d=0;if(d=Xe(v|0,y|0,52)|0,Bt()|0,d=d&15,!d)return l=y,d=v,mi(l|0),d|0;for(l=1,b=0;;){M=(15-l|0)*3|0,w=ei(7,0,M|0)|0,T=Bt()|0,O=Xe(v|0,y|0,M|0)|0,Bt()|0,M=ei(xs(O&7)|0,0,M|0)|0,O=Bt()|0,v=M|v&~w,y=O|y&~T;t:do if(!b)if((M&w|0)==0&(O&T|0)==0)b=0;else if(w=Xe(v|0,y|0,52)|0,Bt()|0,w=w&15,!w)b=1;else{b=1;e:for(;;){switch(O=Xe(v|0,y|0,(15-b|0)*3|0)|0,Bt()|0,O&7){case 1:break e;case 0:break;default:{b=1;break t}}if(b>>>0<w>>>0)b=b+1|0;else{b=1;break t}}for(b=1;;)if(O=(15-b|0)*3|0,T=Xe(v|0,y|0,O|0)|0,Bt()|0,M=ei(7,0,O|0)|0,y=y&~(Bt()|0),O=ei(xs(T&7)|0,0,O|0)|0,v=v&~M|O,y=y|(Bt()|0),b>>>0<w>>>0)b=b+1|0;else{b=1;break}}while(!1);if(l>>>0<d>>>0)l=l+1|0;else break}return mi(y|0),v|0}function ws(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0;if(w=Xe(v|0,y|0,52)|0,Bt()|0,w=w&15,!w)return b=y,w=v,mi(b|0),w|0;for(b=1;M=(15-b|0)*3|0,O=Xe(v|0,y|0,M|0)|0,Bt()|0,T=ei(7,0,M|0)|0,y=y&~(Bt()|0),M=ei(xs(O&7)|0,0,M|0)|0,v=M|v&~T,y=Bt()|0|y,b>>>0<w>>>0;)b=b+1|0;return mi(y|0),v|0}function Au(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0,d=0;if(d=Xe(v|0,y|0,52)|0,Bt()|0,d=d&15,!d)return l=y,d=v,mi(l|0),d|0;for(l=1,b=0;;){M=(15-l|0)*3|0,w=ei(7,0,M|0)|0,T=Bt()|0,O=Xe(v|0,y|0,M|0)|0,Bt()|0,M=ei(ns(O&7)|0,0,M|0)|0,O=Bt()|0,v=M|v&~w,y=O|y&~T;t:do if(!b)if((M&w|0)==0&(O&T|0)==0)b=0;else if(w=Xe(v|0,y|0,52)|0,Bt()|0,w=w&15,!w)b=1;else{b=1;e:for(;;){switch(O=Xe(v|0,y|0,(15-b|0)*3|0)|0,Bt()|0,O&7){case 1:break e;case 0:break;default:{b=1;break t}}if(b>>>0<w>>>0)b=b+1|0;else{b=1;break t}}for(b=1;;)if(T=(15-b|0)*3|0,M=ei(7,0,T|0)|0,O=y&~(Bt()|0),y=Xe(v|0,y|0,T|0)|0,Bt()|0,y=ei(ns(y&7)|0,0,T|0)|0,v=v&~M|y,y=O|(Bt()|0),b>>>0<w>>>0)b=b+1|0;else{b=1;break}}while(!1);if(l>>>0<d>>>0)l=l+1|0;else break}return mi(y|0),v|0}function Ya(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0;if(w=Xe(v|0,y|0,52)|0,Bt()|0,w=w&15,!w)return b=y,w=v,mi(b|0),w|0;for(b=1;O=(15-b|0)*3|0,M=ei(7,0,O|0)|0,T=y&~(Bt()|0),y=Xe(v|0,y|0,O|0)|0,Bt()|0,y=ei(ns(y&7)|0,0,O|0)|0,v=y|v&~M,y=Bt()|0|T,b>>>0<w>>>0;)b=b+1|0;return mi(y|0),v|0}function Dc(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0;if(d=Tt,Tt=Tt+64|0,l=d+40|0,w=d+24|0,T=d+12|0,M=d,ei(y|0,0,52)|0,b=Bt()|0|134225919,!y)return(g[v+4>>2]|0)>2||(g[v+8>>2]|0)>2||(g[v+12>>2]|0)>2?(O=0,l=0,mi(O|0),Tt=d,l|0):(ei(So(v)|0,0,45)|0,O=Bt()|0|b,l=-1,mi(O|0),Tt=d,l|0);if(g[l>>2]=g[v>>2],g[l+4>>2]=g[v+4>>2],g[l+8>>2]=g[v+8>>2],g[l+12>>2]=g[v+12>>2],O=l+4|0,(y|0)>0)for(v=-1;g[w>>2]=g[O>>2],g[w+4>>2]=g[O+4>>2],g[w+8>>2]=g[O+8>>2],y&1?(gh(O),g[T>>2]=g[O>>2],g[T+4>>2]=g[O+4>>2],g[T+8>>2]=g[O+8>>2],Mc(T)):(cu(O),g[T>>2]=g[O>>2],g[T+4>>2]=g[O+4>>2],g[T+8>>2]=g[O+8>>2],Qs(T)),fr(w,T,M),_r(M),m=(15-y|0)*3|0,f=ei(7,0,m|0)|0,b=b&~(Bt()|0),m=ei(Cl(M)|0,0,m|0)|0,v=m|v&~f,b=Bt()|0|b,(y|0)>1;)y=y+-1|0;else v=-1;t:do if((g[O>>2]|0)<=2&&(g[l+8>>2]|0)<=2&&(g[l+12>>2]|0)<=2){if(w=So(l)|0,y=ei(w|0,0,45)|0,y=y|v,v=Bt()|0|b&-1040385,M=lo(l)|0,!(Ii(w)|0)){if((M|0)<=0)break;for(T=0;;){if(w=Xe(y|0,v|0,52)|0,Bt()|0,w=w&15,w)for(b=1;m=(15-b|0)*3|0,l=Xe(y|0,v|0,m|0)|0,Bt()|0,f=ei(7,0,m|0)|0,v=v&~(Bt()|0),m=ei(xs(l&7)|0,0,m|0)|0,y=y&~f|m,v=v|(Bt()|0),b>>>0<w>>>0;)b=b+1|0;if(T=T+1|0,(T|0)==(M|0))break t}}T=Xe(y|0,v|0,52)|0,Bt()|0,T=T&15;e:do if(T){b=1;i:for(;;){switch(m=Xe(y|0,v|0,(15-b|0)*3|0)|0,Bt()|0,m&7){case 1:break i;case 0:break;default:break e}if(b>>>0<T>>>0)b=b+1|0;else break e}if(Ah(w,g[l>>2]|0)|0)for(b=1;l=(15-b|0)*3|0,f=ei(7,0,l|0)|0,m=v&~(Bt()|0),v=Xe(y|0,v|0,l|0)|0,Bt()|0,v=ei(ns(v&7)|0,0,l|0)|0,y=y&~f|v,v=m|(Bt()|0),b>>>0<T>>>0;)b=b+1|0;else for(b=1;m=(15-b|0)*3|0,l=Xe(y|0,v|0,m|0)|0,Bt()|0,f=ei(7,0,m|0)|0,v=v&~(Bt()|0),m=ei(xs(l&7)|0,0,m|0)|0,y=y&~f|m,v=v|(Bt()|0),b>>>0<T>>>0;)b=b+1|0}while(!1);if((M|0)>0){b=0;do y=Sa(y,v)|0,v=Bt()|0,b=b+1|0;while((b|0)!=(M|0))}}else y=0,v=0;while(!1);return f=v,m=y,mi(f|0),Tt=d,m|0}function Vo(v){return v=v|0,(v|0)%2|0|0}function $a(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0;return T=Tt,Tt=Tt+16|0,w=T,y>>>0>15?(w=4,Tt=T,w|0):(g[v+4>>2]&2146435072|0)==2146435072||(g[v+8+4>>2]&2146435072|0)==2146435072?(w=3,Tt=T,w|0):(hu(v,y,w),y=Dc(w,y)|0,w=Bt()|0,g[b>>2]=y,g[b+4>>2]=w,(y|0)==0&(w|0)==0&&Qe(23313,22674,786,22697),w=0,Tt=T,w|0)}function Ho(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;if(T=b+4|0,M=Xe(v|0,y|0,52)|0,Bt()|0,M=M&15,O=Xe(v|0,y|0,45)|0,Bt()|0,w=(M|0)==0,Ii(O&127)|0){if(w)return O=1,O|0;w=1}else{if(w)return O=0,O|0;(g[T>>2]|0)==0&&(g[b+8>>2]|0)==0?w=(g[b+12>>2]|0)!=0&1:w=1}for(b=1;b&1?Mc(T):Qs(T),O=Xe(v|0,y|0,(15-b|0)*3|0)|0,Bt()|0,mh(T,O&7),b>>>0<M>>>0;)b=b+1|0;return w|0}function tc(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0;if(m=Tt,Tt=Tt+16|0,d=m,f=Xe(v|0,y|0,45)|0,Bt()|0,f=f&127,f>>>0>121)return g[b>>2]=0,g[b+4>>2]=0,g[b+8>>2]=0,g[b+12>>2]=0,f=5,Tt=m,f|0;t:do if((Ii(f)|0)!=0&&(M=Xe(v|0,y|0,52)|0,Bt()|0,M=M&15,(M|0)!=0)){w=1;e:for(;;){switch(l=Xe(v|0,y|0,(15-w|0)*3|0)|0,Bt()|0,l&7){case 5:break e;case 0:break;default:{w=y;break t}}if(w>>>0<M>>>0)w=w+1|0;else{w=y;break t}}for(T=1,w=y;y=(15-T|0)*3|0,O=ei(7,0,y|0)|0,l=w&~(Bt()|0),w=Xe(v|0,w|0,y|0)|0,Bt()|0,w=ei(ns(w&7)|0,0,y|0)|0,v=v&~O|w,w=l|(Bt()|0),T>>>0<M>>>0;)T=T+1|0}else w=y;while(!1);if(l=7696+(f*28|0)|0,g[b>>2]=g[l>>2],g[b+4>>2]=g[l+4>>2],g[b+8>>2]=g[l+8>>2],g[b+12>>2]=g[l+12>>2],!(Ho(v,w,b)|0))return f=0,Tt=m,f|0;if(O=b+4|0,g[d>>2]=g[O>>2],g[d+4>>2]=g[O+4>>2],g[d+8>>2]=g[O+8>>2],M=Xe(v|0,w|0,52)|0,Bt()|0,l=M&15,M&1?(Qs(O),M=l+1|0):M=l,!(Ii(f)|0))w=0;else{t:do if(!l)w=0;else for(y=1;;){if(T=Xe(v|0,w|0,(15-y|0)*3|0)|0,Bt()|0,T=T&7,T|0){w=T;break t}if(y>>>0<l>>>0)y=y+1|0;else{w=0;break}}while(!1);w=(w|0)==4&1}if(!(rs(b,M,w,0)|0))(M|0)!=(l|0)&&(g[O>>2]=g[d>>2],g[O+4>>2]=g[d+4>>2],g[O+8>>2]=g[d+8>>2]);else{if(Ii(f)|0)do;while((rs(b,M,0,0)|0)!=0);(M|0)!=(l|0)&&cu(O)}return f=0,Tt=m,f|0}function Oc(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;return M=Tt,Tt=Tt+16|0,w=M,T=tc(v,y,w)|0,T|0?(Tt=M,T|0):(T=Xe(v|0,y|0,52)|0,Bt()|0,kf(w,T&15,b),T=0,Tt=M,T|0)}function Lc(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0;if(O=Tt,Tt=Tt+16|0,M=O,w=tc(v,y,M)|0,w|0)return M=w,Tt=O,M|0;w=Xe(v|0,y|0,45)|0,Bt()|0,w=(Ii(w&127)|0)==0,T=Xe(v|0,y|0,52)|0,Bt()|0,T=T&15;t:do if(!w){if(T|0)for(w=1;;){if(l=ei(7,0,(15-w|0)*3|0)|0,!((l&v|0)==0&((Bt()|0)&y|0)==0))break t;if(w>>>0<T>>>0)w=w+1|0;else break}return Ks(M,T,0,5,b),l=0,Tt=O,l|0}while(!1);return fu(M,T,0,6,b),l=0,Tt=O,l|0}function ec(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(T=Xe(v|0,y|0,45)|0,Bt()|0,!(Ii(T&127)|0))return T=2,g[b>>2]=T,0;if(T=Xe(v|0,y|0,52)|0,Bt()|0,T=T&15,!T)return T=5,g[b>>2]=T,0;for(w=1;;){if(M=ei(7,0,(15-w|0)*3|0)|0,!((M&v|0)==0&((Bt()|0)&y|0)==0)){w=2,v=6;break}if(w>>>0<T>>>0)w=w+1|0;else{w=5,v=6;break}}return(v|0)==6&&(g[b>>2]=w),0}function Fc(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0;E=Tt,Tt=Tt+128|0,f=E+112|0,M=E+96|0,m=E,T=Xe(v|0,y|0,52)|0,Bt()|0,l=T&15,g[f>>2]=l,O=Xe(v|0,y|0,45)|0,Bt()|0,O=O&127;t:do if(Ii(O)|0){if(l|0)for(w=1;;){if(d=ei(7,0,(15-w|0)*3|0)|0,!((d&v|0)==0&((Bt()|0)&y|0)==0)){T=0;break t}if(w>>>0<l>>>0)w=w+1|0;else break}if(T&1)T=1;else return d=ei(l+1|0,0,52)|0,m=Bt()|0|y&-15728641,f=ei(7,0,(14-l|0)*3|0)|0,m=Fc((d|v)&~f,m&~(Bt()|0),b)|0,Tt=E,m|0}else T=0;while(!1);if(w=tc(v,y,M)|0,!w){T?(qs(M,f,m),d=5):(du(M,f,m),d=6);t:do if(Ii(O)|0)if(!l)v=5;else for(w=1;;){if(O=ei(7,0,(15-w|0)*3|0)|0,!((O&v|0)==0&((Bt()|0)&y|0)==0)){v=2;break t}if(w>>>0<l>>>0)w=w+1|0;else{v=5;break}}else v=2;while(!1);ra(b|0,-1,v<<2|0)|0;t:do if(T)for(M=0;;){if(O=m+(M<<4)|0,Nf(O,g[f>>2]|0)|0,O=g[O>>2]|0,l=g[b>>2]|0,(l|0)==-1|(l|0)==(O|0))w=b;else{T=0;do{if(T=T+1|0,T>>>0>=v>>>0){w=1;break t}w=b+(T<<2)|0,l=g[w>>2]|0}while(!((l|0)==-1|(l|0)==(O|0)))}if(g[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}else for(M=0;;){if(O=m+(M<<4)|0,rs(O,g[f>>2]|0,0,1)|0,O=g[O>>2]|0,l=g[b>>2]|0,(l|0)==-1|(l|0)==(O|0))w=b;else{T=0;do{if(T=T+1|0,T>>>0>=v>>>0){w=1;break t}w=b+(T<<2)|0,l=g[w>>2]|0}while(!((l|0)==-1|(l|0)==(O|0)))}if(g[w>>2]=O,M=M+1|0,M>>>0>=d>>>0){w=0;break}}while(!1)}return m=w,Tt=E,m|0}function gu(){return 12}function Tl(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0,d=0;if(v>>>0>15)return l=4,l|0;if(ei(v|0,0,52)|0,l=Bt()|0|134225919,!v){b=0,w=0;do Ii(w)|0&&(ei(w|0,0,45)|0,O=l|(Bt()|0),v=y+(b<<3)|0,g[v>>2]=-1,g[v+4>>2]=O,b=b+1|0),w=w+1|0;while((w|0)!=122);return b=0,b|0}b=0,O=0;do{if(Ii(O)|0){for(ei(O|0,0,45)|0,w=1,T=-1,M=l|(Bt()|0);d=ei(7,0,(15-w|0)*3|0)|0,T=T&~d,M=M&~(Bt()|0),(w|0)!=(v|0);)w=w+1|0;d=y+(b<<3)|0,g[d>>2]=T,g[d+4>>2]=M,b=b+1|0}O=O+1|0}while((O|0)!=122);return b=0,b|0}function mu(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0;if(Z=Tt,Tt=Tt+16|0,W=Z,et=Xe(v|0,y|0,52)|0,Bt()|0,et=et&15,b>>>0>15)return et=4,Tt=Z,et|0;if((et|0)<(b|0))return et=12,Tt=Z,et|0;if((et|0)!=(b|0))if(M=ei(b|0,0,52)|0,M=M|v,l=Bt()|0|y&-15728641,(et|0)>(b|0)){d=b;do z=ei(7,0,(14-d|0)*3|0)|0,d=d+1|0,M=z|M,l=Bt()|0|l;while((d|0)<(et|0));z=M}else z=M;else z=v,l=y;F=Xe(z|0,l|0,45)|0,Bt()|0;t:do if(Ii(F&127)|0){if(d=Xe(z|0,l|0,52)|0,Bt()|0,d=d&15,d|0)for(M=1;;){if(F=ei(7,0,(15-M|0)*3|0)|0,!((F&z|0)==0&((Bt()|0)&l|0)==0)){f=33;break t}if(M>>>0<d>>>0)M=M+1|0;else break}if(F=w,g[F>>2]=0,g[F+4>>2]=0,(et|0)>(b|0)){for(F=y&-15728641,R=et;;){if(P=R,R=R+-1|0,R>>>0>15|(et|0)<(R|0)){f=19;break}if((et|0)!=(R|0))if(M=ei(R|0,0,52)|0,M=M|v,d=Bt()|0|F,(et|0)<(P|0))E=M;else{f=R;do E=ei(7,0,(14-f|0)*3|0)|0,f=f+1|0,M=E|M,d=Bt()|0|d;while((f|0)<(et|0));E=M}else E=v,d=y;if(m=Xe(E|0,d|0,45)|0,Bt()|0,!(Ii(m&127)|0))M=0;else{m=Xe(E|0,d|0,52)|0,Bt()|0,m=m&15;e:do if(!m)M=0;else for(f=1;;){if(M=Xe(E|0,d|0,(15-f|0)*3|0)|0,Bt()|0,M=M&7,M|0)break e;if(f>>>0<m>>>0)f=f+1|0;else{M=0;break}}while(!1);M=(M|0)==0&1}if(d=Xe(v|0,y|0,(15-P|0)*3|0)|0,Bt()|0,d=d&7,(d|0)==7){T=5,f=42;break}if(M=(M|0)!=0,(d|0)==1&M){T=5,f=42;break}if(E=d+(((d|0)!=0&M)<<31>>31)|0,E|0&&(f=et-P|0,f=Jo(7,0,f,((f|0)<0)<<31>>31)|0,m=Bt()|0,M?(M=dr(f|0,m|0,5,0)|0,M=An(M|0,Bt()|0,-5,-1)|0,M=Xo(M|0,Bt()|0,6,0)|0,M=An(M|0,Bt()|0,1,0)|0,d=Bt()|0):(M=f,d=m),P=E+-1|0,P=dr(f|0,m|0,P|0,((P|0)<0)<<31>>31|0)|0,P=An(M|0,d|0,P|0,Bt()|0)|0,E=Bt()|0,m=w,m=An(P|0,E|0,g[m>>2]|0,g[m+4>>2]|0)|0,E=Bt()|0,P=w,g[P>>2]=m,g[P+4>>2]=E),(R|0)<=(b|0)){f=37;break}}if((f|0)==19)Qe(23313,22674,1099,22710);else if((f|0)==37){O=w,T=g[O+4>>2]|0,O=g[O>>2]|0;break}else if((f|0)==42)return Tt=Z,T|0}else T=0,O=0}else f=33;while(!1);t:do if((f|0)==33)if(F=w,g[F>>2]=0,g[F+4>>2]=0,(et|0)>(b|0)){for(M=et;;){if(T=Xe(v|0,y|0,(15-M|0)*3|0)|0,Bt()|0,T=T&7,(T|0)==7){T=5;break}if(O=et-M|0,O=Jo(7,0,O,((O|0)<0)<<31>>31)|0,T=dr(O|0,Bt()|0,T|0,0)|0,O=Bt()|0,F=w,O=An(g[F>>2]|0,g[F+4>>2]|0,T|0,O|0)|0,T=Bt()|0,F=w,g[F>>2]=O,g[F+4>>2]=T,M=M+-1|0,(M|0)<=(b|0))break t}return Tt=Z,T|0}else T=0,O=0;while(!1);return Bl(z,l,et,W)|0&&Qe(23313,22674,1063,22725),et=W,W=g[et+4>>2]|0,((T|0)>-1|(T|0)==-1&O>>>0>4294967295)&((W|0)>(T|0)|((W|0)==(T|0)?(g[et>>2]|0)>>>0>O>>>0:0))?(et=0,Tt=Z,et|0):(Qe(23313,22674,1139,22710),0)}function lA(v,y,b,w,T,M){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0;var O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0;if(E=Tt,Tt=Tt+16|0,O=E,T>>>0>15)return M=4,Tt=E,M|0;if(l=Xe(b|0,w|0,52)|0,Bt()|0,l=l&15,(l|0)>(T|0))return M=12,Tt=E,M|0;if(Bl(b,w,T,O)|0&&Qe(23313,22674,1063,22725),m=O,f=g[m+4>>2]|0,!(((y|0)>-1|(y|0)==-1&v>>>0>4294967295)&((f|0)>(y|0)|((f|0)==(y|0)?(g[m>>2]|0)>>>0>v>>>0:0))))return M=2,Tt=E,M|0;m=T-l|0,T=ei(T|0,0,52)|0,d=Bt()|0|w&-15728641,f=M,g[f>>2]=T|b,g[f+4>>2]=d,f=Xe(b|0,w|0,45)|0,Bt()|0;t:do if(Ii(f&127)|0){if(l|0)for(O=1;;){if(f=ei(7,0,(15-O|0)*3|0)|0,!((f&b|0)==0&((Bt()|0)&w|0)==0))break t;if(O>>>0<l>>>0)O=O+1|0;else break}if((m|0)<1)return M=0,Tt=E,M|0;for(f=l^15,w=-1,d=1,O=1;;){l=m-d|0,l=Jo(7,0,l,((l|0)<0)<<31>>31)|0,b=Bt()|0;do if(O)if(O=dr(l|0,b|0,5,0)|0,O=An(O|0,Bt()|0,-5,-1)|0,O=Xo(O|0,Bt()|0,6,0)|0,T=Bt()|0,(y|0)>(T|0)|(y|0)==(T|0)&v>>>0>O>>>0){y=An(v|0,y|0,-1,-1)|0,y=Ki(y|0,Bt()|0,O|0,T|0)|0,O=Bt()|0,P=M,F=g[P>>2]|0,P=g[P+4>>2]|0,z=(f+w|0)*3|0,R=ei(7,0,z|0)|0,P=P&~(Bt()|0),w=Xo(y|0,O|0,l|0,b|0)|0,v=Bt()|0,T=An(w|0,v|0,2,0)|0,z=ei(T|0,Bt()|0,z|0)|0,P=Bt()|0|P,T=M,g[T>>2]=z|F&~R,g[T+4>>2]=P,v=dr(w|0,v|0,l|0,b|0)|0,v=Ki(y|0,O|0,v|0,Bt()|0)|0,O=0,y=Bt()|0;break}else{z=M,R=g[z>>2]|0,z=g[z+4>>2]|0,F=ei(7,0,(f+w|0)*3|0)|0,z=z&~(Bt()|0),O=M,g[O>>2]=R&~F,g[O+4>>2]=z,O=1;break}else R=M,T=g[R>>2]|0,R=g[R+4>>2]|0,w=(f+w|0)*3|0,P=ei(7,0,w|0)|0,R=R&~(Bt()|0),z=Xo(v|0,y|0,l|0,b|0)|0,O=Bt()|0,w=ei(z|0,O|0,w|0)|0,R=Bt()|0|R,F=M,g[F>>2]=w|T&~P,g[F+4>>2]=R,O=dr(z|0,O|0,l|0,b|0)|0,v=Ki(v|0,y|0,O|0,Bt()|0)|0,O=0,y=Bt()|0;while(!1);if((m|0)>(d|0))w=~d,d=d+1|0;else{y=0;break}}return Tt=E,y|0}while(!1);if((m|0)<1)return z=0,Tt=E,z|0;for(T=l^15,O=1;;)if(F=m-O|0,F=Jo(7,0,F,((F|0)<0)<<31>>31)|0,z=Bt()|0,d=M,b=g[d>>2]|0,d=g[d+4>>2]|0,l=(T-O|0)*3|0,w=ei(7,0,l|0)|0,d=d&~(Bt()|0),P=Xo(v|0,y|0,F|0,z|0)|0,R=Bt()|0,l=ei(P|0,R|0,l|0)|0,d=Bt()|0|d,f=M,g[f>>2]=l|b&~w,g[f+4>>2]=d,z=dr(P|0,R|0,F|0,z|0)|0,v=Ki(v|0,y|0,z|0,Bt()|0)|0,y=Bt()|0,(m|0)<=(O|0)){y=0;break}else O=O+1|0;return Tt=E,y|0}function Sl(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;T=Xe(y|0,b|0,52)|0,Bt()|0,T=T&15,(y|0)==0&(b|0)==0|((w|0)>15|(T|0)>(w|0))?(w=-1,T=-1,y=0,b=0):(M=pu(y,b,T+1|0,w)|0,b=(Bt()|0)&-15728641,y=ei(w|0,0,52)|0,y=M|y,b=b|(Bt()|0),M=(Dn(y,b)|0)==0,w=M?-1:w),M=v,g[M>>2]=y,g[M+4>>2]=b,g[v+8>>2]=T,g[v+12>>2]=w}function yu(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0,d=0,f=0;if(b=v,y=g[b>>2]|0,b=g[b+4>>2]|0,!((y|0)==0&(b|0)==0)&&(w=Xe(y|0,b|0,52)|0,Bt()|0,w=w&15,l=ei(1,0,(w^15)*3|0)|0,y=An(l|0,Bt()|0,y|0,b|0)|0,b=Bt()|0,l=v,g[l>>2]=y,g[l+4>>2]=b,l=v+8|0,O=g[l>>2]|0,!((w|0)<(O|0)))){for(d=v+12|0,M=w;;){if((M|0)==(O|0)){w=5;break}if(f=(M|0)==(g[d>>2]|0),T=(15-M|0)*3|0,w=Xe(y|0,b|0,T|0)|0,Bt()|0,w=w&7,f&((w|0)==1&!0)){w=7;break}if(!((w|0)==7&!0)){w=10;break}if(f=ei(1,0,T|0)|0,y=An(y|0,b|0,f|0,Bt()|0)|0,b=Bt()|0,f=v,g[f>>2]=y,g[f+4>>2]=b,(M|0)>(O|0))M=M+-1|0;else{w=10;break}}if((w|0)==5){f=v,g[f>>2]=0,g[f+4>>2]=0,g[l>>2]=-1,g[d>>2]=-1;return}else if((w|0)==7){O=ei(1,0,T|0)|0,O=An(y|0,b|0,O|0,Bt()|0)|0,l=Bt()|0,f=v,g[f>>2]=O,g[f+4>>2]=l,g[d>>2]=M+-1;return}else if((w|0)==10)return}}function kc(v){v=+v;var y=0;return y=v<0?v+6.283185307179586:v,+(v>=6.283185307179586?y+-6.283185307179586:y)}function ic(v,y){return v=v|0,y=y|0,+Pe(+(+ct[v>>3]-+ct[y>>3]))<17453292519943298e-27?(y=+Pe(+(+ct[v+8>>3]-+ct[y+8>>3]))<17453292519943298e-27,y|0):(y=0,y|0)}function vu(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0;return T=+ct[y>>3],w=+ct[v>>3],M=+Ie(+((T-w)*.5)),b=+Ie(+((+ct[y+8>>3]-+ct[v+8>>3])*.5)),b=M*M+b*(+Fe(+T)*+Fe(+w)*b),+(+ln(+ +Le(+b),+ +Le(+(1-b)))*2)}function nc(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0;return T=+ct[y>>3],w=+ct[v>>3],M=+Ie(+((T-w)*.5)),b=+Ie(+((+ct[y+8>>3]-+ct[v+8>>3])*.5)),b=M*M+b*(+Fe(+T)*+Fe(+w)*b),+(+ln(+ +Le(+b),+ +Le(+(1-b)))*2*6371.007180918475)}function bh(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0;return T=+ct[y>>3],w=+ct[v>>3],M=+Ie(+((T-w)*.5)),b=+Ie(+((+ct[y+8>>3]-+ct[v+8>>3])*.5)),b=M*M+b*(+Fe(+T)*+Fe(+w)*b),+(+ln(+ +Le(+b),+ +Le(+(1-b)))*2*6371.007180918475*1e3)}function xh(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0;return M=+ct[y>>3],w=+Fe(+M),T=+ct[y+8>>3]-+ct[v+8>>3],O=w*+Ie(+T),b=+ct[v>>3],+ +ln(+O,+(+Ie(+M)*+Fe(+b)-+Fe(+T)*(w*+Ie(+b))))}function Il(v,y,b,w){v=v|0,y=+y,b=+b,w=w|0;var T=0,M=0,O=0,l=0;if(b<1e-16){g[w>>2]=g[v>>2],g[w+4>>2]=g[v+4>>2],g[w+8>>2]=g[v+8>>2],g[w+12>>2]=g[v+12>>2];return}M=y<0?y+6.283185307179586:y,M=y>=6.283185307179586?M+-6.283185307179586:M;do if(M<1e-16)y=+ct[v>>3]+b,ct[w>>3]=y,T=w;else{if(T=+Pe(+(M+-3.141592653589793))<1e-16,y=+ct[v>>3],T){y=y-b,ct[w>>3]=y,T=w;break}if(O=+Fe(+b),b=+Ie(+b),y=O*+Ie(+y)+ +Fe(+M)*(b*+Fe(+y)),y=y>1?1:y,y=+ti(+(y<-1?-1:y)),ct[w>>3]=y,+Pe(+(y+-1.5707963267948966))<1e-16){ct[w>>3]=1.5707963267948966,ct[w+8>>3]=0;return}if(+Pe(+(y+1.5707963267948966))<1e-16){ct[w>>3]=-1.5707963267948966,ct[w+8>>3]=0;return}if(l=+Fe(+y),M=b*+Ie(+M)/l,b=+ct[v>>3],y=(O-+Ie(+y)*+Ie(+b))/+Fe(+b)/l,O=M>1?1:M,y=y>1?1:y,y=+ct[v+8>>3]+ +ln(+(O<-1?-1:O),+(y<-1?-1:y)),y>3.141592653589793)do y=y+-6.283185307179586;while(y>3.141592653589793);if(y<-3.141592653589793)do y=y+6.283185307179586;while(y<-3.141592653589793);ct[w+8>>3]=y;return}while(!1);if(+Pe(+(y+-1.5707963267948966))<1e-16){ct[T>>3]=1.5707963267948966,ct[w+8>>3]=0;return}if(+Pe(+(y+1.5707963267948966))<1e-16){ct[T>>3]=-1.5707963267948966,ct[w+8>>3]=0;return}if(y=+ct[v+8>>3],y>3.141592653589793)do y=y+-6.283185307179586;while(y>3.141592653589793);if(y<-3.141592653589793)do y=y+6.283185307179586;while(y<-3.141592653589793);ct[w+8>>3]=y}function Gf(v,y){return v=v|0,y=y|0,v>>>0>15?(y=4,y|0):(ct[y>>3]=+ct[20528+(v<<3)>>3],y=0,y|0)}function rc(v,y){return v=v|0,y=y|0,v>>>0>15?(y=4,y|0):(ct[y>>3]=+ct[20656+(v<<3)>>3],y=0,y|0)}function Xn(v,y){return v=v|0,y=y|0,v>>>0>15?(y=4,y|0):(ct[y>>3]=+ct[20784+(v<<3)>>3],y=0,y|0)}function _u(v,y){return v=v|0,y=y|0,v>>>0>15?(y=4,y|0):(ct[y>>3]=+ct[20912+(v<<3)>>3],y=0,y|0)}function $s(v,y){v=v|0,y=y|0;var b=0;return v>>>0>15?(y=4,y|0):(b=Jo(7,0,v,((v|0)<0)<<31>>31)|0,b=dr(b|0,Bt()|0,120,0)|0,v=Bt()|0,g[y>>2]=b|2,g[y+4>>2]=v,y=0,y|0)}function ta(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0;return P=+ct[y>>3],m=+ct[v>>3],d=+Ie(+((P-m)*.5)),M=+ct[y+8>>3],f=+ct[v+8>>3],O=+Ie(+((M-f)*.5)),l=+Fe(+m),E=+Fe(+P),O=d*d+O*(E*l*O),O=+ln(+ +Le(+O),+ +Le(+(1-O)))*2,d=+ct[b>>3],P=+Ie(+((d-P)*.5)),w=+ct[b+8>>3],M=+Ie(+((w-M)*.5)),T=+Fe(+d),M=P*P+M*(E*T*M),M=+ln(+ +Le(+M),+ +Le(+(1-M)))*2,d=+Ie(+((m-d)*.5)),w=+Ie(+((f-w)*.5)),w=d*d+w*(l*T*w),w=+ln(+ +Le(+w),+ +Le(+(1-w)))*2,T=(O+M+w)*.5,+(+tn(+ +Le(+(+je(+(T*.5))*+je(+((T-O)*.5))*+je(+((T-M)*.5))*+je(+((T-w)*.5)))))*4)}function hn(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0;if(l=Tt,Tt=Tt+192|0,M=l+168|0,O=l,T=Oc(v,y,M)|0,T|0)return b=T,Tt=l,b|0;if(Lc(v,y,O)|0&&Qe(23313,22742,386,22751),y=g[O>>2]|0,(y|0)>0){if(w=+ta(O+8|0,O+8+(((y|0)!=1&1)<<4)|0,M)+0,(y|0)!=1){v=1;do T=v,v=v+1|0,w=w+ +ta(O+8+(T<<4)|0,O+8+(((v|0)%(y|0)|0)<<4)|0,M);while((v|0)<(y|0))}}else w=0;return ct[b>>3]=w,b=0,Tt=l,b|0}function kn(v,y,b){return v=v|0,y=y|0,b=b|0,v=hn(v,y,b)|0,v|0||(ct[b>>3]=+ct[b>>3]*6371.007180918475*6371.007180918475),v|0}function Wo(v,y,b){return v=v|0,y=y|0,b=b|0,v=hn(v,y,b)|0,v|0||(ct[b>>3]=+ct[b>>3]*6371.007180918475*6371.007180918475*1e3*1e3),v|0}function Ml(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0;if(l=Tt,Tt=Tt+176|0,O=l,v=uu(v,y,O)|0,v|0)return O=v,Tt=l,O|0;if(ct[b>>3]=0,v=g[O>>2]|0,(v|0)<=1)return O=0,Tt=l,O|0;y=v+-1|0,v=0,w=+ct[O+8>>3],T=+ct[O+16>>3],M=0;do v=v+1|0,f=w,w=+ct[O+8+(v<<4)>>3],m=+Ie(+((w-f)*.5)),d=T,T=+ct[O+8+(v<<4)+8>>3],d=+Ie(+((T-d)*.5)),d=m*m+d*(+Fe(+w)*+Fe(+f)*d),M=M+ +ln(+ +Le(+d),+ +Le(+(1-d)))*2;while((v|0)<(y|0));return ct[b>>3]=M,O=0,Tt=l,O|0}function Nc(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0;if(l=Tt,Tt=Tt+176|0,O=l,v=uu(v,y,O)|0,v|0)return O=v,M=+ct[b>>3],M=M*6371.007180918475,ct[b>>3]=M,Tt=l,O|0;if(ct[b>>3]=0,v=g[O>>2]|0,(v|0)<=1)return O=0,M=0,M=M*6371.007180918475,ct[b>>3]=M,Tt=l,O|0;y=v+-1|0,v=0,w=+ct[O+8>>3],T=+ct[O+16>>3],M=0;do v=v+1|0,f=w,w=+ct[O+8+(v<<4)>>3],m=+Ie(+((w-f)*.5)),d=T,T=+ct[O+8+(v<<4)+8>>3],d=+Ie(+((T-d)*.5)),d=m*m+d*(+Fe(+f)*+Fe(+w)*d),M=M+ +ln(+ +Le(+d),+ +Le(+(1-d)))*2;while((v|0)!=(y|0));return ct[b>>3]=M,O=0,m=M,m=m*6371.007180918475,ct[b>>3]=m,Tt=l,O|0}function Pl(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0;if(l=Tt,Tt=Tt+176|0,O=l,v=uu(v,y,O)|0,v|0)return O=v,M=+ct[b>>3],M=M*6371.007180918475,M=M*1e3,ct[b>>3]=M,Tt=l,O|0;if(ct[b>>3]=0,v=g[O>>2]|0,(v|0)<=1)return O=0,M=0,M=M*6371.007180918475,M=M*1e3,ct[b>>3]=M,Tt=l,O|0;y=v+-1|0,v=0,w=+ct[O+8>>3],T=+ct[O+16>>3],M=0;do v=v+1|0,f=w,w=+ct[O+8+(v<<4)>>3],m=+Ie(+((w-f)*.5)),d=T,T=+ct[O+8+(v<<4)+8>>3],d=+Ie(+((T-d)*.5)),d=m*m+d*(+Fe(+f)*+Fe(+w)*d),M=M+ +ln(+ +Le(+d),+ +Le(+(1-d)))*2;while((v|0)!=(y|0));return ct[b>>3]=M,O=0,m=M,m=m*6371.007180918475,m=m*1e3,ct[b>>3]=m,Tt=l,O|0}function uA(v){v=v|0;var y=0,b=0,w=0;return y=ls(1,12)|0,y||Qe(22832,22787,49,22845),b=v+4|0,w=g[b>>2]|0,w|0?(w=w+8|0,g[w>>2]=y,g[b>>2]=y,y|0):(g[v>>2]|0&&Qe(22862,22787,61,22885),w=v,g[w>>2]=y,g[b>>2]=y,y|0)}function hA(v,y){v=v|0,y=y|0;var b=0,w=0;return w=Qn(24)|0,w||Qe(22899,22787,78,22913),g[w>>2]=g[y>>2],g[w+4>>2]=g[y+4>>2],g[w+8>>2]=g[y+8>>2],g[w+12>>2]=g[y+12>>2],g[w+16>>2]=0,y=v+4|0,b=g[y>>2]|0,b|0?(g[b+16>>2]=w,g[y>>2]=w,w|0):(g[v>>2]|0&&Qe(22928,22787,82,22913),g[v>>2]=w,g[y>>2]=w,w|0)}function Uc(v){v=v|0;var y=0,b=0,w=0,T=0;if(v)for(w=1;;){if(y=g[v>>2]|0,y|0)do{if(b=g[y>>2]|0,b|0)do T=b,b=g[b+16>>2]|0,Ui(T);while((b|0)!=0);T=y,y=g[y+8>>2]|0,Ui(T)}while((y|0)!=0);if(y=v,v=g[v+8>>2]|0,w||Ui(y),v)w=0;else break}}function Rl(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0,It=0,Vt=0,Jt=0,te=0,Qt=0,$t=0,pe=0,Oe=0,xe=0;if(T=v+8|0,g[T>>2]|0)return xe=1,xe|0;if(w=g[v>>2]|0,!w)return xe=0,xe|0;y=w,b=0;do b=b+1|0,y=g[y+8>>2]|0;while((y|0)!=0);if(b>>>0<2)return xe=0,xe|0;pe=Qn(b<<2)|0,pe||Qe(22948,22787,317,22967),$t=Qn(b<<5)|0,$t||Qe(22989,22787,321,22967),g[v>>2]=0,Pt=v+4|0,g[Pt>>2]=0,g[T>>2]=0,b=0,Qt=0,bt=0,E=0;t:for(;;){if(m=g[w>>2]|0,m){M=0,O=m;do{if(d=+ct[O+8>>3],y=O,O=g[O+16>>2]|0,f=(O|0)==0,T=f?m:O,l=+ct[T+8>>3],+Pe(+(d-l))>3.141592653589793){xe=14;break}M=M+(l-d)*(+ct[y>>3]+ +ct[T>>3])}while(!f);if((xe|0)==14){xe=0,M=0,y=m;do ot=+ct[y+8>>3],te=y+16|0,Jt=g[te>>2]|0,Jt=(Jt|0)==0?m:Jt,it=+ct[Jt+8>>3],M=M+(+ct[y>>3]+ +ct[Jt>>3])*((it<0?it+6.283185307179586:it)-(ot<0?ot+6.283185307179586:ot)),y=g[((y|0)==0?w:te)>>2]|0;while((y|0)!=0)}M>0?(g[pe+(Qt<<2)>>2]=w,Qt=Qt+1|0,T=bt,y=E):xe=19}else xe=19;if((xe|0)==19){xe=0;do if(b){if(y=b+8|0,g[y>>2]|0){xe=21;break t}if(b=ls(1,12)|0,!b){xe=23;break t}g[y>>2]=b,T=b+4|0,O=b,y=E}else if(E){T=Pt,O=E+8|0,y=w,b=v;break}else if(g[v>>2]|0){xe=27;break t}else{T=Pt,O=v,y=w,b=v;break}while(!1);if(g[O>>2]=w,g[T>>2]=w,O=$t+(bt<<5)|0,f=g[w>>2]|0,f){for(m=$t+(bt<<5)+8|0,ct[m>>3]=17976931348623157e292,E=$t+(bt<<5)+24|0,ct[E>>3]=17976931348623157e292,ct[O>>3]=-17976931348623157e292,P=$t+(bt<<5)+16|0,ct[P>>3]=-17976931348623157e292,et=17976931348623157e292,Z=-17976931348623157e292,T=0,R=f,d=17976931348623157e292,z=17976931348623157e292,W=-17976931348623157e292,l=-17976931348623157e292;M=+ct[R>>3],ot=+ct[R+8>>3],R=g[R+16>>2]|0,F=(R|0)==0,it=+ct[(F?f:R)+8>>3],M<d&&(ct[m>>3]=M,d=M),ot<z&&(ct[E>>3]=ot,z=ot),M>W?ct[O>>3]=M:M=W,ot>l&&(ct[P>>3]=ot,l=ot),et=ot>0&ot<et?ot:et,Z=ot<0&ot>Z?ot:Z,T=T|+Pe(+(ot-it))>3.141592653589793,!F;)W=M;T&&(ct[P>>3]=Z,ct[E>>3]=et)}else g[O>>2]=0,g[O+4>>2]=0,g[O+8>>2]=0,g[O+12>>2]=0,g[O+16>>2]=0,g[O+20>>2]=0,g[O+24>>2]=0,g[O+28>>2]=0;T=bt+1|0}if(te=w+8|0,w=g[te>>2]|0,g[te>>2]=0,w)bt=T,E=y;else{xe=45;break}}if((xe|0)==21)Qe(22765,22787,35,22799);else if((xe|0)==23)Qe(22819,22787,37,22799);else if((xe|0)==27)Qe(22862,22787,61,22885);else if((xe|0)==45){t:do if((Qt|0)>0){for(te=(T|0)==0,Vt=T<<2,Jt=(v|0)==0,It=0,y=0;;){if(mt=g[pe+(It<<2)>>2]|0,te)xe=73;else{if(bt=Qn(Vt)|0,!bt){xe=50;break}if(Pt=Qn(Vt)|0,!Pt){xe=52;break}e:do if(Jt)b=0;else{for(T=0,b=0,O=v;w=$t+(T<<5)|0,Ds(g[O>>2]|0,w,g[mt>>2]|0)|0?(g[bt+(b<<2)>>2]=O,g[Pt+(b<<2)>>2]=w,F=b+1|0):F=b,O=g[O+8>>2]|0,O;)T=T+1|0,b=F;if((F|0)>0)if(w=g[bt>>2]|0,(F|0)==1)b=w;else for(P=0,R=-1,b=w,E=w;;){for(f=g[E>>2]|0,w=0,O=0;T=g[g[bt+(O<<2)>>2]>>2]|0,(T|0)==(f|0)?m=w:m=w+((Ds(T,g[Pt+(O<<2)>>2]|0,g[f>>2]|0)|0)&1)|0,O=O+1|0,(O|0)!=(F|0);)w=m;if(T=(m|0)>(R|0),b=T?E:b,w=P+1|0,(w|0)==(F|0))break e;P=w,R=T?m:R,E=g[bt+(w<<2)>>2]|0}else b=0}while(!1);if(Ui(bt),Ui(Pt),b){if(T=b+4|0,w=g[T>>2]|0,w)b=w+8|0;else if(g[b>>2]|0){xe=70;break}g[b>>2]=mt,g[T>>2]=mt}else xe=73}if((xe|0)==73){if(xe=0,y=g[mt>>2]|0,y|0)do Pt=y,y=g[y+16>>2]|0,Ui(Pt);while((y|0)!=0);Ui(mt),y=1}if(It=It+1|0,(It|0)>=(Qt|0)){Oe=y;break t}}(xe|0)==50?Qe(23004,22787,249,23023):(xe|0)==52?Qe(23042,22787,252,23023):(xe|0)==70&&Qe(22862,22787,61,22885)}else Oe=0;while(!1);return Ui(pe),Ui($t),xe=Oe,xe|0}return 0}function Ds(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0;if(!(jo(y,b)|0)||(y=wl(y)|0,w=+ct[b>>3],T=+ct[b+8>>3],T=y&T<0?T+6.283185307179586:T,v=g[v>>2]|0,!v))return v=0,v|0;if(y){y=0,f=T,b=v;t:for(;;){for(;O=+ct[b>>3],T=+ct[b+8>>3],b=b+16|0,m=g[b>>2]|0,m=(m|0)==0?v:m,M=+ct[m>>3],l=+ct[m+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=T,T=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=g[b>>2]|0,!b){b=22;break t}if(l=O<0?O+6.283185307179586:O,O=T<0?T+6.283185307179586:T,f=l==f|O==f?f+-2220446049250313e-31:f,d=l+(O-l)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>f&&(y=y^1),b=g[b>>2]|0,!b){b=22;break}}if((b|0)==22)return y|0}else{y=0,f=T,b=v;t:for(;;){for(;O=+ct[b>>3],T=+ct[b+8>>3],b=b+16|0,m=g[b>>2]|0,m=(m|0)==0?v:m,M=+ct[m>>3],l=+ct[m+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=T,T=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=g[b>>2]|0,!b){b=22;break t}if(f=O==f|T==f?f+-2220446049250313e-31:f,O+(T-O)*((w-M)/(d-M))>f&&(y=y^1),b=g[b>>2]|0,!b){b=22;break}}if((b|0)==22)return y|0}return 0}function Nn(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0;if(Z=Tt,Tt=Tt+32|0,et=Z+16|0,W=Z,M=Xe(v|0,y|0,52)|0,Bt()|0,M=M&15,R=Xe(b|0,w|0,52)|0,Bt()|0,(M|0)!=(R&15|0))return et=12,Tt=Z,et|0;if(f=Xe(v|0,y|0,45)|0,Bt()|0,f=f&127,m=Xe(b|0,w|0,45)|0,Bt()|0,m=m&127,f>>>0>121|m>>>0>121)return et=5,Tt=Z,et|0;if(R=(f|0)!=(m|0),R){if(l=bl(f,m)|0,(l|0)==7)return et=1,Tt=Z,et|0;d=bl(m,f)|0,(d|0)==7?Qe(23066,23090,161,23100):(F=l,O=d)}else F=0,O=0;E=Ii(f)|0,P=Ii(m)|0,g[et>>2]=0,g[et+4>>2]=0,g[et+8>>2]=0,g[et+12>>2]=0;do if(F){if(m=g[4272+(f*28|0)+(F<<2)>>2]|0,l=(m|0)>0,P)if(l){f=0,d=b,l=w;do d=Au(d,l)|0,l=Bt()|0,O=ns(O)|0,(O|0)==1&&(O=ns(1)|0),f=f+1|0;while((f|0)!=(m|0));m=O,f=d,d=l}else m=O,f=b,d=w;else if(l){f=0,d=b,l=w;do d=Ya(d,l)|0,l=Bt()|0,O=ns(O)|0,f=f+1|0;while((f|0)!=(m|0));m=O,f=d,d=l}else m=O,f=b,d=w;if(Ho(f,d,et)|0,R||Qe(23115,23090,191,23100),l=(E|0)!=0,O=(P|0)!=0,l&O&&Qe(23142,23090,192,23100),l){if(O=eo(v,y)|0,(O|0)==7){M=5;break}if(wt[21872+(O*7|0)+F>>0]|0){M=1;break}d=g[21040+(O*28|0)+(F<<2)>>2]|0,f=d}else if(O){if(O=eo(f,d)|0,(O|0)==7){M=5;break}if(wt[21872+(O*7|0)+m>>0]|0){M=1;break}f=0,d=g[21040+(m*28|0)+(O<<2)>>2]|0}else f=0,d=0;if((f|d|0)<0)M=5;else{if((d|0)>0){l=et+4|0,O=0;do lu(l),O=O+1|0;while((O|0)!=(d|0))}if(g[W>>2]=0,g[W+4>>2]=0,g[W+8>>2]=0,mh(W,F),M|0)for(;Vo(M)|0?Mc(W):Qs(W),(M|0)>1;)M=M+-1|0;if((f|0)>0){M=0;do lu(W),M=M+1|0;while((M|0)!=(f|0))}z=et+4|0,Gn(z,W,z),_r(z),z=51}}else if(Ho(b,w,et)|0,(E|0)!=0&(P|0)!=0)if((m|0)!=(f|0)&&Qe(23173,23090,261,23100),O=eo(v,y)|0,M=eo(b,w)|0,(O|0)==7|(M|0)==7)M=5;else if(wt[21872+(O*7|0)+M>>0]|0)M=1;else if(O=g[21040+(O*28|0)+(M<<2)>>2]|0,(O|0)>0){l=et+4|0,M=0;do lu(l),M=M+1|0;while((M|0)!=(O|0));z=51}else z=51;else z=51;while(!1);return(z|0)==51&&(M=et+4|0,g[T>>2]=g[M>>2],g[T+4>>2]=g[M+4>>2],g[T+8>>2]=g[M+8>>2],M=0),et=M,Tt=Z,et|0}function zc(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0;if(z=Tt,Tt=Tt+48|0,f=z+36|0,O=z+24|0,l=z+12|0,d=z,T=Xe(v|0,y|0,52)|0,Bt()|0,T=T&15,P=Xe(v|0,y|0,45)|0,Bt()|0,P=P&127,P>>>0>121)return w=5,Tt=z,w|0;if(m=Ii(P)|0,ei(T|0,0,52)|0,W=Bt()|0|134225919,M=w,g[M>>2]=-1,g[M+4>>2]=W,!T)return T=Cl(b)|0,(T|0)==7||(T=_a(P,T)|0,(T|0)==127)?(W=1,Tt=z,W|0):(R=ei(T|0,0,45)|0,F=Bt()|0,P=w,F=g[P+4>>2]&-1040385|F,W=w,g[W>>2]=g[P>>2]|R,g[W+4>>2]=F,W=0,Tt=z,W|0);for(g[f>>2]=g[b>>2],g[f+4>>2]=g[b+4>>2],g[f+8>>2]=g[b+8>>2],b=T;;){if(M=b,b=b+-1|0,g[O>>2]=g[f>>2],g[O+4>>2]=g[f+4>>2],g[O+8>>2]=g[f+8>>2],Vo(M)|0){if(T=oA(f)|0,T|0){b=13;break}g[l>>2]=g[f>>2],g[l+4>>2]=g[f+4>>2],g[l+8>>2]=g[f+8>>2],Mc(l)}else{if(T=sA(f)|0,T|0){b=13;break}g[l>>2]=g[f>>2],g[l+4>>2]=g[f+4>>2],g[l+8>>2]=g[f+8>>2],Qs(l)}if(fr(O,l,d),_r(d),T=w,Z=g[T>>2]|0,T=g[T+4>>2]|0,it=(15-M|0)*3|0,et=ei(7,0,it|0)|0,T=T&~(Bt()|0),it=ei(Cl(d)|0,0,it|0)|0,T=Bt()|0|T,W=w,g[W>>2]=it|Z&~et,g[W+4>>2]=T,(M|0)<=1){b=14;break}}t:do if((b|0)!=13&&(b|0)==14)if((g[f>>2]|0)<=1&&(g[f+4>>2]|0)<=1&&(g[f+8>>2]|0)<=1){b=Cl(f)|0,T=_a(P,b)|0,(T|0)==127?d=0:d=Ii(T)|0;e:do if(b){if(m){if(T=eo(v,y)|0,(T|0)==7){T=5;break t}if(M=g[21248+(T*28|0)+(b<<2)>>2]|0,(M|0)>0){T=b,b=0;do T=xs(T)|0,b=b+1|0;while((b|0)!=(M|0))}else T=b;if((T|0)==1){T=9;break t}b=_a(P,T)|0,(b|0)==127&&Qe(23200,23090,411,23230),Ii(b)|0?Qe(23245,23090,412,23230):(F=b,R=M,E=T)}else F=T,R=0,E=b;if(l=g[4272+(P*28|0)+(E<<2)>>2]|0,(l|0)<=-1&&Qe(23276,23090,419,23230),!d){if((R|0)<0){T=5;break t}if(R|0){M=w,T=0,b=g[M>>2]|0,M=g[M+4>>2]|0;do b=ws(b,M)|0,M=Bt()|0,it=w,g[it>>2]=b,g[it+4>>2]=M,T=T+1|0;while((T|0)<(R|0))}if((l|0)<=0){T=F,b=58;break}for(M=w,T=0,b=g[M>>2]|0,M=g[M+4>>2]|0;;)if(b=ws(b,M)|0,M=Bt()|0,it=w,g[it>>2]=b,g[it+4>>2]=M,T=T+1|0,(T|0)==(l|0)){T=F,b=58;break e}}if(O=bl(F,P)|0,(O|0)==7&&Qe(23066,23090,428,23230),T=w,b=g[T>>2]|0,T=g[T+4>>2]|0,(l|0)>0){M=0;do b=ws(b,T)|0,T=Bt()|0,it=w,g[it>>2]=b,g[it+4>>2]=T,M=M+1|0;while((M|0)!=(l|0))}if(T=eo(b,T)|0,(T|0)==7&&Qe(23313,23090,440,23230),b=Ln(F)|0,b=g[(b?21664:21456)+(O*28|0)+(T<<2)>>2]|0,(b|0)<0&&Qe(23313,23090,454,23230),!b)T=F,b=58;else{O=w,T=0,M=g[O>>2]|0,O=g[O+4>>2]|0;do M=Sa(M,O)|0,O=Bt()|0,it=w,g[it>>2]=M,g[it+4>>2]=O,T=T+1|0;while((T|0)<(b|0));T=F,b=58}}else if((m|0)!=0&(d|0)!=0){if(b=eo(v,y)|0,M=w,M=eo(g[M>>2]|0,g[M+4>>2]|0)|0,(b|0)==7|(M|0)==7){T=5;break t}if(M=g[21248+(b*28|0)+(M<<2)>>2]|0,(M|0)<0){T=5;break t}if(!M)b=59;else{l=w,b=0,O=g[l>>2]|0,l=g[l+4>>2]|0;do O=ws(O,l)|0,l=Bt()|0,it=w,g[it>>2]=O,g[it+4>>2]=l,b=b+1|0;while((b|0)<(M|0));b=58}}else b=58;while(!1);if((b|0)==58&&d&&(b=59),(b|0)==59&&(it=w,(eo(g[it>>2]|0,g[it+4>>2]|0)|0)==1)){T=9;break}it=w,et=g[it>>2]|0,it=g[it+4>>2]&-1040385,Z=ei(T|0,0,45)|0,it=it|(Bt()|0),T=w,g[T>>2]=et|Z,g[T+4>>2]=it,T=0}else T=1;while(!1);return it=T,Tt=z,it|0}function jf(v,y,b,w,T,M){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0,M=M|0;var O=0,l=0;return l=Tt,Tt=Tt+16|0,O=l,T?v=15:(v=Nn(v,y,b,w,O)|0,v||(wa(O,M),v=0)),Tt=l,v|0}function Er(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0;return O=Tt,Tt=Tt+16|0,M=O,w?b=15:(b=Ca(b,M)|0,b||(b=zc(v,y,M,T)|0)),Tt=O,b|0}function si(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0;return d=Tt,Tt=Tt+32|0,O=d+12|0,l=d,M=Nn(v,y,v,y,O)|0,M|0?(l=M,Tt=d,l|0):(v=Nn(v,y,b,w,l)|0,v|0?(l=v,Tt=d,l|0):(O=El(O,l)|0,l=T,g[l>>2]=O,g[l+4>>2]=((O|0)<0)<<31>>31,l=0,Tt=d,l|0))}function Io(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0;return d=Tt,Tt=Tt+32|0,O=d+12|0,l=d,M=Nn(v,y,v,y,O)|0,!M&&(M=Nn(v,y,b,w,l)|0,!M)?(w=El(O,l)|0,w=An(w|0,((w|0)<0)<<31>>31|0,1,0)|0,O=Bt()|0,l=T,g[l>>2]=w,g[l+4>>2]=O,l=0,Tt=d,l|0):(l=M,Tt=d,l|0)}function bu(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0,It=0;if(mt=Tt,Tt=Tt+48|0,O=mt+24|0,l=mt+12|0,Pt=mt,M=Nn(v,y,v,y,O)|0,!M&&(M=Nn(v,y,b,w,l)|0,!M)){ot=El(O,l)|0,bt=((ot|0)<0)<<31>>31,g[O>>2]=0,g[O+4>>2]=0,g[O+8>>2]=0,g[l>>2]=0,g[l+4>>2]=0,g[l+8>>2]=0,Nn(v,y,v,y,O)|0&&Qe(23313,23090,691,23299),Nn(v,y,b,w,l)|0&&Qe(23313,23090,696,23299),Ea(O),Ea(l),ot?(E=g[O>>2]|0,F=+(ot|0),et=O+4|0,P=g[et>>2]|0,Z=O+8|0,R=g[Z>>2]|0,it=O,w=E,M=P,b=R,z=+((g[l>>2]|0)-E|0)/F,W=+((g[l+4>>2]|0)-P|0)/F,F=+((g[l+8>>2]|0)-R|0)/F):(M=O+4|0,b=O+8|0,et=M,Z=b,it=O,w=g[O>>2]|0,M=g[M>>2]|0,b=g[b>>2]|0,z=0,W=0,F=0),g[Pt>>2]=w,R=Pt+4|0,g[R>>2]=M,P=Pt+8|0,g[P>>2]=b;t:do if((ot|0)<0)M=0;else for(m=0,E=0,M=w;;){f=+(E>>>0)+4294967296*+(m|0),It=z*f+ +(M|0),d=W*f+ +(g[et>>2]|0),f=F*f+ +(g[Z>>2]|0),b=~~+na(+It),O=~~+na(+d),M=~~+na(+f),It=+Pe(+(+(b|0)-It)),d=+Pe(+(+(O|0)-d)),f=+Pe(+(+(M|0)-f));do if(It>d&It>f)b=0-(O+M)|0,w=O;else if(l=0-b|0,d>f){w=l-M|0;break}else{w=O,M=l-O|0;break}while(!1);if(g[Pt>>2]=b,g[R>>2]=w,g[P>>2]=M,Qa(Pt),M=zc(v,y,Pt,T+(E<<3)|0)|0,M|0)break t;if(!((m|0)<(bt|0)|(m|0)==(bt|0)&E>>>0<ot>>>0)){M=0;break t}M=An(E|0,m|0,1,0)|0,l=Bt()|0,m=l,E=M,M=g[it>>2]|0}while(!1);return Pt=M,Tt=mt,Pt|0}return Pt=M,Tt=mt,Pt|0}function Jo(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0;if((b|0)==0&(w|0)==0)return T=0,M=1,mi(T|0),M|0;M=v,T=y,v=1,y=0;do O=(b&1|0)==0&!0,v=dr((O?1:M)|0,(O?0:T)|0,v|0,y|0)|0,y=Bt()|0,b=Bs(b|0,w|0,1)|0,w=Bt()|0,M=dr(M|0,T|0,M|0,T|0)|0,T=Bt()|0;while(!((b|0)==0&(w|0)==0));return mi(y|0),v|0}function os(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0;if(!(jo(y,b)|0)||(y=wl(y)|0,w=+ct[b>>3],T=+ct[b+8>>3],T=y&T<0?T+6.283185307179586:T,P=g[v>>2]|0,(P|0)<=0))return P=0,P|0;if(E=g[v+4>>2]|0,y){y=0,m=T,b=-1,v=0;t:for(;;){for(f=v;O=+ct[E+(f<<4)>>3],T=+ct[E+(f<<4)+8>>3],v=(b+2|0)%(P|0)|0,M=+ct[E+(v<<4)>>3],l=+ct[E+(v<<4)+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=T,T=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=f+1|0,(b|0)>=(P|0)){b=22;break t}else v=f,f=b,b=v;if(l=O<0?O+6.283185307179586:O,O=T<0?T+6.283185307179586:T,m=l==m|O==m?m+-2220446049250313e-31:m,d=l+(O-l)*((w-M)/(d-M)),(d<0?d+6.283185307179586:d)>m&&(y=y^1),v=f+1|0,(v|0)>=(P|0)){b=22;break}else b=f}if((b|0)==22)return y|0}else{y=0,m=T,b=-1,v=0;t:for(;;){for(f=v;O=+ct[E+(f<<4)>>3],T=+ct[E+(f<<4)+8>>3],v=(b+2|0)%(P|0)|0,M=+ct[E+(v<<4)>>3],l=+ct[E+(v<<4)+8>>3],O>M?(d=O,O=l):(d=M,M=O,O=T,T=l),w=w==M|w==d?w+2220446049250313e-31:w,!!(w<M|w>d);)if(b=f+1|0,(b|0)>=(P|0)){b=22;break t}else v=f,f=b,b=v;if(m=O==m|T==m?m+-2220446049250313e-31:m,O+(T-O)*((w-M)/(d-M))>m&&(y=y^1),v=f+1|0,(v|0)>=(P|0)){b=22;break}else b=f}if((b|0)==22)return y|0}return 0}function yo(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0;if(F=g[v>>2]|0,!F){g[y>>2]=0,g[y+4>>2]=0,g[y+8>>2]=0,g[y+12>>2]=0,g[y+16>>2]=0,g[y+20>>2]=0,g[y+24>>2]=0,g[y+28>>2]=0;return}if(z=y+8|0,ct[z>>3]=17976931348623157e292,W=y+24|0,ct[W>>3]=17976931348623157e292,ct[y>>3]=-17976931348623157e292,et=y+16|0,ct[et>>3]=-17976931348623157e292,!((F|0)<=0)){for(P=g[v+4>>2]|0,f=17976931348623157e292,m=-17976931348623157e292,E=0,v=-1,M=17976931348623157e292,O=17976931348623157e292,d=-17976931348623157e292,w=-17976931348623157e292,R=0;b=+ct[P+(R<<4)>>3],l=+ct[P+(R<<4)+8>>3],v=v+2|0,T=+ct[P+(((v|0)==(F|0)?0:v)<<4)+8>>3],b<M&&(ct[z>>3]=b,M=b),l<O&&(ct[W>>3]=l,O=l),b>d?ct[y>>3]=b:b=d,l>w&&(ct[et>>3]=l,w=l),f=l>0&l<f?l:f,m=l<0&l>m?l:m,E=E|+Pe(+(l-T))>3.141592653589793,v=R+1|0,(v|0)!=(F|0);)Z=R,d=b,R=v,v=Z;E&&(ct[et>>3]=m,ct[W>>3]=f)}}function wh(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0,Pt=0,mt=0;if(F=g[v>>2]|0,F){if(z=y+8|0,ct[z>>3]=17976931348623157e292,W=y+24|0,ct[W>>3]=17976931348623157e292,ct[y>>3]=-17976931348623157e292,et=y+16|0,ct[et>>3]=-17976931348623157e292,(F|0)>0){for(T=g[v+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,w=0,b=-1,d=17976931348623157e292,f=17976931348623157e292,E=-17976931348623157e292,O=-17976931348623157e292,Z=0;M=+ct[T+(Z<<4)>>3],m=+ct[T+(Z<<4)+8>>3],Pt=b+2|0,l=+ct[T+(((Pt|0)==(F|0)?0:Pt)<<4)+8>>3],M<d&&(ct[z>>3]=M,d=M),m<f&&(ct[W>>3]=m,f=m),M>E?ct[y>>3]=M:M=E,m>O&&(ct[et>>3]=m,O=m),P=m>0&m<P?m:P,R=m<0&m>R?m:R,w=w|+Pe(+(m-l))>3.141592653589793,b=Z+1|0,(b|0)!=(F|0);)Pt=Z,E=M,Z=b,b=Pt;w&&(ct[et>>3]=R,ct[W>>3]=P)}}else g[y>>2]=0,g[y+4>>2]=0,g[y+8>>2]=0,g[y+12>>2]=0,g[y+16>>2]=0,g[y+20>>2]=0,g[y+24>>2]=0,g[y+28>>2]=0;if(Pt=v+8|0,b=g[Pt>>2]|0,!((b|0)<=0)){bt=v+12|0,ot=0;do if(T=g[bt>>2]|0,w=ot,ot=ot+1|0,W=y+(ot<<5)|0,et=g[T+(w<<3)>>2]|0,et){if(Z=y+(ot<<5)+8|0,ct[Z>>3]=17976931348623157e292,v=y+(ot<<5)+24|0,ct[v>>3]=17976931348623157e292,ct[W>>3]=-17976931348623157e292,it=y+(ot<<5)+16|0,ct[it>>3]=-17976931348623157e292,(et|0)>0){for(F=g[T+(w<<3)+4>>2]|0,P=17976931348623157e292,R=-17976931348623157e292,T=0,w=-1,z=0,d=17976931348623157e292,f=17976931348623157e292,m=-17976931348623157e292,O=-17976931348623157e292;M=+ct[F+(z<<4)>>3],E=+ct[F+(z<<4)+8>>3],w=w+2|0,l=+ct[F+(((w|0)==(et|0)?0:w)<<4)+8>>3],M<d&&(ct[Z>>3]=M,d=M),E<f&&(ct[v>>3]=E,f=E),M>m?ct[W>>3]=M:M=m,E>O&&(ct[it>>3]=E,O=E),P=E>0&E<P?E:P,R=E<0&E>R?E:R,T=T|+Pe(+(E-l))>3.141592653589793,w=z+1|0,(w|0)!=(et|0);)mt=z,z=w,m=M,w=mt;T&&(ct[it>>3]=R,ct[v>>3]=P)}}else g[W>>2]=0,g[W+4>>2]=0,g[W+8>>2]=0,g[W+12>>2]=0,g[W+16>>2]=0,g[W+20>>2]=0,g[W+24>>2]=0,g[W+28>>2]=0,b=g[Pt>>2]|0;while((ot|0)<(b|0))}}function Ye(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(!(os(v,y,b)|0))return T=0,T|0;if(T=v+8|0,(g[T>>2]|0)<=0)return T=1,T|0;for(w=v+12|0,v=0;;){if(M=v,v=v+1|0,os((g[w>>2]|0)+(M<<3)|0,y+(v<<5)|0,b)|0){v=0,w=6;break}if((v|0)>=(g[T>>2]|0)){v=1,w=6;break}}return(w|0)==6?v|0:0}function Ch(){return 8}function xu(){return 16}function Eh(){return 168}function ss(){return 8}function Mo(){return 16}function wu(){return 12}function Cu(){return 8}function Po(v){return v=v|0,+(+((g[v>>2]|0)>>>0)+4294967296*+(g[v+4>>2]|0))}function ea(v){v=v|0;var y=0,b=0;return b=+ct[v>>3],y=+ct[v+8>>3],+ +Le(+(b*b+y*y))}function Bh(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0;f=+ct[v>>3],d=+ct[y>>3]-f,l=+ct[v+8>>3],O=+ct[y+8>>3]-l,E=+ct[b>>3],M=+ct[w>>3]-E,P=+ct[b+8>>3],m=+ct[w+8>>3]-P,M=(M*(l-P)-(f-E)*m)/(d*m-O*M),ct[T>>3]=f+d*M,ct[T+8>>3]=l+O*M}function Gc(v,y){return v=v|0,y=y|0,+Pe(+(+ct[v>>3]-+ct[y>>3]))<11920928955078125e-23?(y=+Pe(+(+ct[v+8>>3]-+ct[y+8>>3]))<11920928955078125e-23,y|0):(y=0,y|0)}function Br(v,y){v=v|0,y=y|0;var b=0,w=0,T=0;return T=+ct[v>>3]-+ct[y>>3],w=+ct[v+8>>3]-+ct[y+8>>3],b=+ct[v+16>>3]-+ct[y+16>>3],+(T*T+w*w+b*b)}function Th(v,y){v=v|0,y=y|0;var b=0,w=0,T=0;b=+ct[v>>3],w=+Fe(+b),b=+Ie(+b),ct[y+16>>3]=b,b=+ct[v+8>>3],T=w*+Fe(+b),ct[y>>3]=T,b=w*+Ie(+b),ct[y+8>>3]=b}function Cs(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;if(M=Tt,Tt=Tt+16|0,T=M,w=Dn(v,y)|0,(b+-1|0)>>>0>5||(w=(w|0)!=0,(b|0)==1&w))return T=-1,Tt=M,T|0;do if(io(v,y,T)|0)w=-1;else if(w){w=((g[21936+(b<<2)>>2]|0)+5-(g[T>>2]|0)|0)%5|0;break}else{w=((g[21968+(b<<2)>>2]|0)+6-(g[T>>2]|0)|0)%6|0;break}while(!1);return T=w,Tt=M,T|0}function io(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0,f=0;if(f=Tt,Tt=Tt+32|0,O=f+16|0,l=f,w=tc(v,y,O)|0,w|0)return b=w,Tt=f,b|0;M=_h(v,y)|0,d=eo(v,y)|0,is(M,l),w=Pf(M,g[O>>2]|0)|0;t:do if(Ii(M)|0){do switch(M|0){case 4:{v=0;break}case 14:{v=1;break}case 24:{v=2;break}case 38:{v=3;break}case 49:{v=4;break}case 58:{v=5;break}case 63:{v=6;break}case 72:{v=7;break}case 83:{v=8;break}case 97:{v=9;break}case 107:{v=10;break}case 117:{v=11;break}default:{w=1;break t}}while(!1);if(T=g[22e3+(v*24|0)+8>>2]|0,y=g[22e3+(v*24|0)+16>>2]|0,v=g[O>>2]|0,(v|0)!=(g[l>>2]|0)&&(l=Ln(M)|0,v=g[O>>2]|0,l|(v|0)==(y|0)&&(w=(w+1|0)%6|0)),(d|0)==3&(v|0)==(y|0)){w=(w+5|0)%6|0,T=22;break}(d|0)==5&(v|0)==(T|0)&&(w=(w+1|0)%6|0),T=22}else T=22;while(!1);return(T|0)==22&&(g[b>>2]=w,w=0),b=w,Tt=f,b|0}function Vi(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0;if(it=Tt,Tt=Tt+32|0,Z=it+24|0,W=it+20|0,F=it+8|0,R=it+16|0,P=it,d=(Dn(v,y)|0)==0,d=d?6:5,m=Xe(v|0,y|0,52)|0,Bt()|0,m=m&15,d>>>0<=b>>>0)return w=2,Tt=it,w|0;E=(m|0)==0,!E&&(z=ei(7,0,(m^15)*3|0)|0,(z&v|0)==0&((Bt()|0)&y|0)==0)?T=b:M=4;t:do if((M|0)==4){if(T=(Dn(v,y)|0)!=0,((T?4:5)|0)<(b|0)||io(v,y,Z)|0||(M=(g[Z>>2]|0)+b|0,T?T=22288+(((M|0)%5|0)<<2)|0:T=22320+(((M|0)%6|0)<<2)|0,z=g[T>>2]|0,(z|0)==7))return w=1,Tt=it,w|0;g[W>>2]=0,T=Sn(v,y,z,W,F)|0;do if(!T){if(l=F,f=g[l>>2]|0,l=g[l+4>>2]|0,O=l>>>0<y>>>0|(l|0)==(y|0)&f>>>0<v>>>0,M=O?f:v,O=O?l:y,!E&&(E=ei(7,0,(m^15)*3|0)|0,(f&E|0)==0&(l&(Bt()|0)|0)==0))T=b;else{if(l=(b+-1+d|0)%(d|0)|0,T=Dn(v,y)|0,(l|0)<0&&Qe(23313,23315,245,23324),d=(T|0)!=0,((d?4:5)|0)<(l|0)&&Qe(23313,23315,245,23324),io(v,y,Z)|0&&Qe(23313,23315,245,23324),T=(g[Z>>2]|0)+l|0,d?T=22288+(((T|0)%5|0)<<2)|0:T=22320+(((T|0)%6|0)<<2)|0,l=g[T>>2]|0,(l|0)==7&&Qe(23313,23315,245,23324),g[R>>2]=0,T=Sn(v,y,l,R,P)|0,T|0)break;f=P,d=g[f>>2]|0,f=g[f+4>>2]|0;do if(f>>>0<O>>>0|(f|0)==(O|0)&d>>>0<M>>>0){if(Dn(d,f)|0?M=_l(d,f,v,y)|0:M=g[22384+((((g[R>>2]|0)+(g[22352+(l<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=Dn(d,f)|0,(M+-1|0)>>>0>5){T=-1,M=d,O=f;break}if(T=(T|0)!=0,(M|0)==1&T){T=-1,M=d,O=f;break}do if(io(d,f,Z)|0)T=-1;else if(T){T=((g[21936+(M<<2)>>2]|0)+5-(g[Z>>2]|0)|0)%5|0;break}else{T=((g[21968+(M<<2)>>2]|0)+6-(g[Z>>2]|0)|0)%6|0;break}while(!1);M=d,O=f}else T=b;while(!1);l=F,f=g[l>>2]|0,l=g[l+4>>2]|0}if((M|0)==(f|0)&(O|0)==(l|0)){if(d=(Dn(f,l)|0)!=0,d?v=_l(f,l,v,y)|0:v=g[22384+((((g[W>>2]|0)+(g[22352+(z<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,T=Dn(f,l)|0,(v+-1|0)>>>0<=5&&(et=(T|0)!=0,!((v|0)==1&et)))do if(io(f,l,Z)|0)T=-1;else if(et){T=((g[21936+(v<<2)>>2]|0)+5-(g[Z>>2]|0)|0)%5|0;break}else{T=((g[21968+(v<<2)>>2]|0)+6-(g[Z>>2]|0)|0)%6|0;break}while(!1);else T=-1;T=T+1|0,T=(T|0)==6|d&(T|0)==5?0:T}y=O,v=M;break t}while(!1);return w=T,Tt=it,w|0}while(!1);return et=ei(T|0,0,56)|0,Z=Bt()|0|y&-2130706433|536870912,g[w>>2]=et|v,g[w+4>>2]=Z,w=0,Tt=it,w|0}function Os(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;return M=(Dn(v,y)|0)==0,w=Vi(v,y,0,b)|0,T=(w|0)==0,M?!T||(w=Vi(v,y,1,b+8|0)|0,w|0)||(w=Vi(v,y,2,b+16|0)|0,w|0)||(w=Vi(v,y,3,b+24|0)|0,w|0)||(w=Vi(v,y,4,b+32|0)|0,w)?(M=w,M|0):Vi(v,y,5,b+40|0)|0:!T||(w=Vi(v,y,1,b+8|0)|0,w|0)||(w=Vi(v,y,2,b+16|0)|0,w|0)||(w=Vi(v,y,3,b+24|0)|0,w|0)||(w=Vi(v,y,4,b+32|0)|0,w|0)?(M=w,M|0):(M=b+40|0,g[M>>2]=0,g[M+4>>2]=0,M=0,M|0)}function as(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0,l=0,d=0;return d=Tt,Tt=Tt+192|0,T=d,M=d+168|0,O=Xe(v|0,y|0,56)|0,Bt()|0,O=O&7,l=y&-2130706433|134217728,w=tc(v,l,M)|0,w|0?(l=w,Tt=d,l|0):(y=Xe(v|0,y|0,52)|0,Bt()|0,y=y&15,Dn(v,l)|0?Ks(M,y,O,1,T):fu(M,y,O,1,T),l=T+8|0,g[b>>2]=g[l>>2],g[b+4>>2]=g[l+4>>2],g[b+8>>2]=g[l+8>>2],g[b+12>>2]=g[l+12>>2],l=0,Tt=d,l|0)}function Jr(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0;return T=Tt,Tt=Tt+16|0,b=T,!(!0&(y&2013265920|0)==536870912)||(w=y&-2130706433|134217728,!(Zs(v,w)|0))?(w=0,Tt=T,w|0):(M=Xe(v|0,y|0,56)|0,Bt()|0,M=(Vi(v,w,M&7,b)|0)==0,w=b,w=M&((g[w>>2]|0)==(v|0)?(g[w+4>>2]|0)==(y|0):0)&1,Tt=T,w|0)}function Ia(v,y,b){v=v|0,y=y|0,b=b|0;var w=0;(y|0)>0?(w=ls(y,4)|0,g[v>>2]=w,w||Qe(23337,23360,40,23374)):g[v>>2]=0,g[v+4>>2]=y,g[v+8>>2]=0,g[v+12>>2]=b}function ia(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0;T=v+4|0,M=v+12|0,O=v+8|0;t:for(;;){for(b=g[T>>2]|0,y=0;;){if((y|0)>=(b|0))break t;if(w=g[v>>2]|0,l=g[w+(y<<2)>>2]|0,!l)y=y+1|0;else break}y=w+(~~(+Pe(+(+he(10,+ +(15-(g[M>>2]|0)|0))*(+ct[l>>3]+ +ct[l+8>>3])))%+(b|0))>>>0<<2)|0,b=g[y>>2]|0;e:do if(b|0){if(w=l+32|0,(b|0)==(l|0))g[y>>2]=g[w>>2];else{if(b=b+32|0,y=g[b>>2]|0,!y)break;for(;(y|0)!=(l|0);)if(b=y+32|0,y=g[b>>2]|0,!y)break e;g[b>>2]=g[w>>2]}Ui(l),g[O>>2]=(g[O>>2]|0)+-1}while(!1)}Ui(g[v>>2]|0)}function cs(v){v=v|0;var y=0,b=0,w=0;for(w=g[v+4>>2]|0,b=0;;){if((b|0)>=(w|0)){y=0,b=4;break}if(y=g[(g[v>>2]|0)+(b<<2)>>2]|0,!y)b=b+1|0;else{b=4;break}}return(b|0)==4?y|0:0}function no(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0;if(b=~~(+Pe(+(+he(10,+ +(15-(g[v+12>>2]|0)|0))*(+ct[y>>3]+ +ct[y+8>>3])))%+(g[v+4>>2]|0))>>>0,b=(g[v>>2]|0)+(b<<2)|0,w=g[b>>2]|0,!w)return M=1,M|0;M=y+32|0;do if((w|0)!=(y|0)){if(b=g[w+32>>2]|0,!b)return M=1,M|0;for(T=b;;){if((T|0)==(y|0)){T=8;break}if(b=g[T+32>>2]|0,b)w=T,T=b;else{b=1,T=10;break}}if((T|0)==8){g[w+32>>2]=g[M>>2];break}else if((T|0)==10)return b|0}else g[b>>2]=g[M>>2];while(!1);return Ui(y),M=v+8|0,g[M>>2]=(g[M>>2]|0)+-1,M=0,M|0}function Dl(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;M=Qn(40)|0,M||Qe(23390,23360,98,23403),g[M>>2]=g[y>>2],g[M+4>>2]=g[y+4>>2],g[M+8>>2]=g[y+8>>2],g[M+12>>2]=g[y+12>>2],T=M+16|0,g[T>>2]=g[b>>2],g[T+4>>2]=g[b+4>>2],g[T+8>>2]=g[b+8>>2],g[T+12>>2]=g[b+12>>2],g[M+32>>2]=0,T=~~(+Pe(+(+he(10,+ +(15-(g[v+12>>2]|0)|0))*(+ct[y>>3]+ +ct[y+8>>3])))%+(g[v+4>>2]|0))>>>0,T=(g[v>>2]|0)+(T<<2)|0,w=g[T>>2]|0;do if(!w)g[T>>2]=M;else{for(;!(ic(w,y)|0&&ic(w+16|0,b)|0);)if(T=g[w+32>>2]|0,w=(T|0)==0?w:T,!(g[w+32>>2]|0)){O=10;break}if((O|0)==10){g[w+32>>2]=M;break}return Ui(M),O=w,O|0}while(!1);return O=v+8|0,g[O>>2]=(g[O>>2]|0)+1,O=M,O|0}function xi(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0;if(T=~~(+Pe(+(+he(10,+ +(15-(g[v+12>>2]|0)|0))*(+ct[y>>3]+ +ct[y+8>>3])))%+(g[v+4>>2]|0))>>>0,T=g[(g[v>>2]|0)+(T<<2)>>2]|0,!T)return b=0,b|0;if(!b){for(v=T;;){if(ic(v,y)|0){w=10;break}if(v=g[v+32>>2]|0,!v){v=0,w=10;break}}if((w|0)==10)return v|0}for(v=T;;){if(ic(v,y)|0&&ic(v+16|0,b)|0){w=10;break}if(v=g[v+32>>2]|0,!v){v=0,w=10;break}}return(w|0)==10?v|0:0}function ui(v,y){v=v|0,y=y|0;var b=0;if(b=~~(+Pe(+(+he(10,+ +(15-(g[v+12>>2]|0)|0))*(+ct[y>>3]+ +ct[y+8>>3])))%+(g[v+4>>2]|0))>>>0,v=g[(g[v>>2]|0)+(b<<2)>>2]|0,!v)return b=0,b|0;for(;;){if(ic(v,y)|0){y=5;break}if(v=g[v+32>>2]|0,!v){v=0,y=5;break}}return(y|0)==5?v|0:0}function Eu(){return 23424}function uo(v){return v=+v,+ +oa(+v)}function Xr(v){return v=+v,~~+uo(v)|0}function Qn(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0,z=0,W=0,et=0,Z=0,it=0,ot=0,bt=0;bt=Tt,Tt=Tt+16|0,P=bt;do if(v>>>0<245){if(f=v>>>0<11?16:v+11&-8,v=f>>>3,E=g[5857]|0,b=E>>>v,b&3|0)return y=(b&1^1)+v|0,v=23468+(y<<1<<2)|0,b=v+8|0,w=g[b>>2]|0,T=w+8|0,M=g[T>>2]|0,(M|0)==(v|0)?g[5857]=E&~(1<<y):(g[M+12>>2]=v,g[b>>2]=M),ot=y<<3,g[w+4>>2]=ot|3,ot=w+ot+4|0,g[ot>>2]=g[ot>>2]|1,ot=T,Tt=bt,ot|0;if(m=g[5859]|0,f>>>0>m>>>0){if(b|0)return y=2<<v,y=b<<v&(y|0-y),y=(y&0-y)+-1|0,l=y>>>12&16,y=y>>>l,b=y>>>5&8,y=y>>>b,M=y>>>2&4,y=y>>>M,v=y>>>1&2,y=y>>>v,w=y>>>1&1,w=(b|l|M|v|w)+(y>>>w)|0,y=23468+(w<<1<<2)|0,v=y+8|0,M=g[v>>2]|0,l=M+8|0,b=g[l>>2]|0,(b|0)==(y|0)?(v=E&~(1<<w),g[5857]=v):(g[b+12>>2]=y,g[v>>2]=b,v=E),ot=w<<3,O=ot-f|0,g[M+4>>2]=f|3,T=M+f|0,g[T+4>>2]=O|1,g[M+ot>>2]=O,m|0&&(w=g[5862]|0,y=m>>>3,b=23468+(y<<1<<2)|0,y=1<<y,v&y?(v=b+8|0,y=g[v>>2]|0):(g[5857]=v|y,y=b,v=b+8|0),g[v>>2]=w,g[y+12>>2]=w,g[w+8>>2]=y,g[w+12>>2]=b),g[5859]=O,g[5862]=T,ot=l,Tt=bt,ot|0;if(M=g[5858]|0,M){for(b=(M&0-M)+-1|0,T=b>>>12&16,b=b>>>T,w=b>>>5&8,b=b>>>w,O=b>>>2&4,b=b>>>O,l=b>>>1&2,b=b>>>l,d=b>>>1&1,d=g[23732+((w|T|O|l|d)+(b>>>d)<<2)>>2]|0,b=d,l=d,d=(g[d+4>>2]&-8)-f|0;v=g[b+16>>2]|0,!(!v&&(v=g[b+20>>2]|0,!v));)O=(g[v+4>>2]&-8)-f|0,T=O>>>0<d>>>0,b=v,l=T?v:l,d=T?O:d;if(O=l+f|0,O>>>0>l>>>0){T=g[l+24>>2]|0,y=g[l+12>>2]|0;do if((y|0)==(l|0)){if(v=l+20|0,y=g[v>>2]|0,!y&&(v=l+16|0,y=g[v>>2]|0,!y)){b=0;break}for(;;)if(w=y+20|0,b=g[w>>2]|0,b)y=b,v=w;else if(w=y+16|0,b=g[w>>2]|0,b)y=b,v=w;else break;g[v>>2]=0,b=y}else b=g[l+8>>2]|0,g[b+12>>2]=y,g[y+8>>2]=b,b=y;while(!1);do if(T|0){if(y=g[l+28>>2]|0,v=23732+(y<<2)|0,(l|0)==(g[v>>2]|0)){if(g[v>>2]=b,!b){g[5858]=M&~(1<<y);break}}else if(ot=T+16|0,g[((g[ot>>2]|0)==(l|0)?ot:T+20|0)>>2]=b,!b)break;g[b+24>>2]=T,y=g[l+16>>2]|0,y|0&&(g[b+16>>2]=y,g[y+24>>2]=b),y=g[l+20>>2]|0,y|0&&(g[b+20>>2]=y,g[y+24>>2]=b)}while(!1);return d>>>0<16?(ot=d+f|0,g[l+4>>2]=ot|3,ot=l+ot+4|0,g[ot>>2]=g[ot>>2]|1):(g[l+4>>2]=f|3,g[O+4>>2]=d|1,g[O+d>>2]=d,m|0&&(w=g[5862]|0,y=m>>>3,b=23468+(y<<1<<2)|0,y=1<<y,y&E?(v=b+8|0,y=g[v>>2]|0):(g[5857]=y|E,y=b,v=b+8|0),g[v>>2]=w,g[y+12>>2]=w,g[w+8>>2]=y,g[w+12>>2]=b),g[5859]=d,g[5862]=O),ot=l+8|0,Tt=bt,ot|0}else E=f}else E=f}else E=f}else if(v>>>0<=4294967231)if(v=v+11|0,f=v&-8,w=g[5858]|0,w){T=0-f|0,v=v>>>8,v?f>>>0>16777215?d=31:(E=(v+1048320|0)>>>16&8,z=v<<E,l=(z+520192|0)>>>16&4,z=z<<l,d=(z+245760|0)>>>16&2,d=14-(l|E|d)+(z<<d>>>15)|0,d=f>>>(d+7|0)&1|d<<1):d=0,b=g[23732+(d<<2)>>2]|0;t:do if(!b)b=0,v=0,z=61;else for(v=0,l=f<<((d|0)==31?0:25-(d>>>1)|0),M=0;;){if(O=(g[b+4>>2]&-8)-f|0,O>>>0<T>>>0)if(O)v=b,T=O;else{v=b,T=0,z=65;break t}if(z=g[b+20>>2]|0,b=g[b+16+(l>>>31<<2)>>2]|0,M=(z|0)==0|(z|0)==(b|0)?M:z,b)l=l<<1;else{b=M,z=61;break}}while(!1);if((z|0)==61){if((b|0)==0&(v|0)==0){if(v=2<<d,v=(v|0-v)&w,!v){E=f;break}E=(v&0-v)+-1|0,O=E>>>12&16,E=E>>>O,M=E>>>5&8,E=E>>>M,l=E>>>2&4,E=E>>>l,d=E>>>1&2,E=E>>>d,b=E>>>1&1,v=0,b=g[23732+((M|O|l|d|b)+(E>>>b)<<2)>>2]|0}b?z=65:(l=v,O=T)}if((z|0)==65)for(M=b;;)if(E=(g[M+4>>2]&-8)-f|0,b=E>>>0<T>>>0,T=b?E:T,v=b?M:v,b=g[M+16>>2]|0,b||(b=g[M+20>>2]|0),b)M=b;else{l=v,O=T;break}if((l|0)!=0&&O>>>0<((g[5859]|0)-f|0)>>>0&&(m=l+f|0,m>>>0>l>>>0)){M=g[l+24>>2]|0,y=g[l+12>>2]|0;do if((y|0)==(l|0)){if(v=l+20|0,y=g[v>>2]|0,!y&&(v=l+16|0,y=g[v>>2]|0,!y)){y=0;break}for(;;)if(T=y+20|0,b=g[T>>2]|0,b)y=b,v=T;else if(T=y+16|0,b=g[T>>2]|0,b)y=b,v=T;else break;g[v>>2]=0}else ot=g[l+8>>2]|0,g[ot+12>>2]=y,g[y+8>>2]=ot;while(!1);do if(M){if(v=g[l+28>>2]|0,b=23732+(v<<2)|0,(l|0)==(g[b>>2]|0)){if(g[b>>2]=y,!y){w=w&~(1<<v),g[5858]=w;break}}else if(ot=M+16|0,g[((g[ot>>2]|0)==(l|0)?ot:M+20|0)>>2]=y,!y)break;g[y+24>>2]=M,v=g[l+16>>2]|0,v|0&&(g[y+16>>2]=v,g[v+24>>2]=y),v=g[l+20>>2]|0,v&&(g[y+20>>2]=v,g[v+24>>2]=y)}while(!1);t:do if(O>>>0<16)ot=O+f|0,g[l+4>>2]=ot|3,ot=l+ot+4|0,g[ot>>2]=g[ot>>2]|1;else{if(g[l+4>>2]=f|3,g[m+4>>2]=O|1,g[m+O>>2]=O,y=O>>>3,O>>>0<256){b=23468+(y<<1<<2)|0,v=g[5857]|0,y=1<<y,v&y?(v=b+8|0,y=g[v>>2]|0):(g[5857]=v|y,y=b,v=b+8|0),g[v>>2]=m,g[y+12>>2]=m,g[m+8>>2]=y,g[m+12>>2]=b;break}if(y=O>>>8,y?O>>>0>16777215?b=31:(it=(y+1048320|0)>>>16&8,ot=y<<it,Z=(ot+520192|0)>>>16&4,ot=ot<<Z,b=(ot+245760|0)>>>16&2,b=14-(Z|it|b)+(ot<<b>>>15)|0,b=O>>>(b+7|0)&1|b<<1):b=0,y=23732+(b<<2)|0,g[m+28>>2]=b,v=m+16|0,g[v+4>>2]=0,g[v>>2]=0,v=1<<b,!(w&v)){g[5858]=w|v,g[y>>2]=m,g[m+24>>2]=y,g[m+12>>2]=m,g[m+8>>2]=m;break}y=g[y>>2]|0;e:do if((g[y+4>>2]&-8|0)!=(O|0)){for(w=O<<((b|0)==31?0:25-(b>>>1)|0);b=y+16+(w>>>31<<2)|0,v=g[b>>2]|0,!!v;)if((g[v+4>>2]&-8|0)==(O|0)){y=v;break e}else w=w<<1,y=v;g[b>>2]=m,g[m+24>>2]=y,g[m+12>>2]=m,g[m+8>>2]=m;break t}while(!1);it=y+8|0,ot=g[it>>2]|0,g[ot+12>>2]=m,g[it>>2]=m,g[m+8>>2]=ot,g[m+12>>2]=y,g[m+24>>2]=0}while(!1);return ot=l+8|0,Tt=bt,ot|0}else E=f}else E=f;else E=-1;while(!1);if(b=g[5859]|0,b>>>0>=E>>>0)return y=b-E|0,v=g[5862]|0,y>>>0>15?(ot=v+E|0,g[5862]=ot,g[5859]=y,g[ot+4>>2]=y|1,g[v+b>>2]=y,g[v+4>>2]=E|3):(g[5859]=0,g[5862]=0,g[v+4>>2]=b|3,ot=v+b+4|0,g[ot>>2]=g[ot>>2]|1),ot=v+8|0,Tt=bt,ot|0;if(O=g[5860]|0,O>>>0>E>>>0)return Z=O-E|0,g[5860]=Z,ot=g[5863]|0,it=ot+E|0,g[5863]=it,g[it+4>>2]=Z|1,g[ot+4>>2]=E|3,ot=ot+8|0,Tt=bt,ot|0;if(g[5975]|0?v=g[5977]|0:(g[5977]=4096,g[5976]=4096,g[5978]=-1,g[5979]=-1,g[5980]=0,g[5968]=0,g[5975]=P&-16^1431655768,v=4096),l=E+48|0,d=E+47|0,M=v+d|0,T=0-v|0,f=M&T,f>>>0<=E>>>0||(v=g[5967]|0,v|0&&(m=g[5965]|0,P=m+f|0,P>>>0<=m>>>0|P>>>0>v>>>0)))return ot=0,Tt=bt,ot|0;t:do if(g[5968]&4)y=0,z=143;else{b=g[5863]|0;e:do if(b){for(w=23876;P=g[w>>2]|0,!(P>>>0<=b>>>0&&(P+(g[w+4>>2]|0)|0)>>>0>b>>>0);)if(v=g[w+8>>2]|0,v)w=v;else{z=128;break e}if(y=M-O&T,y>>>0<2147483647)if(v=vo(y|0)|0,(v|0)==((g[w>>2]|0)+(g[w+4>>2]|0)|0)){if((v|0)!=-1){O=y,M=v,z=145;break t}}else w=v,z=136;else y=0}else z=128;while(!1);do if((z|0)==128)if(b=vo(0)|0,(b|0)!=-1&&(y=b,R=g[5976]|0,F=R+-1|0,y=((F&y|0)==0?0:(F+y&0-R)-y|0)+f|0,R=g[5965]|0,F=y+R|0,y>>>0>E>>>0&y>>>0<2147483647)){if(P=g[5967]|0,P|0&&F>>>0<=R>>>0|F>>>0>P>>>0){y=0;break}if(v=vo(y|0)|0,(v|0)==(b|0)){O=y,M=b,z=145;break t}else w=v,z=136}else y=0;while(!1);do if((z|0)==136){if(b=0-y|0,!(l>>>0>y>>>0&(y>>>0<2147483647&(w|0)!=-1)))if((w|0)==-1){y=0;break}else{O=y,M=w,z=145;break t}if(v=g[5977]|0,v=d-y+v&0-v,v>>>0>=2147483647){O=y,M=w,z=145;break t}if((vo(v|0)|0)==-1){vo(b|0)|0,y=0;break}else{O=v+y|0,M=w,z=145;break t}}while(!1);g[5968]=g[5968]|4,z=143}while(!1);if((z|0)==143&&f>>>0<2147483647&&(Z=vo(f|0)|0,F=vo(0)|0,W=F-Z|0,et=W>>>0>(E+40|0)>>>0,!((Z|0)==-1|et^1|Z>>>0<F>>>0&((Z|0)!=-1&(F|0)!=-1)^1))&&(O=et?W:y,M=Z,z=145),(z|0)==145){y=(g[5965]|0)+O|0,g[5965]=y,y>>>0>(g[5966]|0)>>>0&&(g[5966]=y),d=g[5863]|0;t:do if(d){for(y=23876;;){if(v=g[y>>2]|0,b=g[y+4>>2]|0,(M|0)==(v+b|0)){z=154;break}if(w=g[y+8>>2]|0,w)y=w;else break}if((z|0)==154&&(it=y+4|0,(g[y+12>>2]&8|0)==0)&&M>>>0>d>>>0&v>>>0<=d>>>0){g[it>>2]=b+O,ot=(g[5860]|0)+O|0,Z=d+8|0,Z=(Z&7|0)==0?0:0-Z&7,it=d+Z|0,Z=ot-Z|0,g[5863]=it,g[5860]=Z,g[it+4>>2]=Z|1,g[d+ot+4>>2]=40,g[5864]=g[5979];break}for(M>>>0<(g[5861]|0)>>>0&&(g[5861]=M),b=M+O|0,y=23876;;){if((g[y>>2]|0)==(b|0)){z=162;break}if(v=g[y+8>>2]|0,v)y=v;else break}if((z|0)==162&&(g[y+12>>2]&8|0)==0){g[y>>2]=M,m=y+4|0,g[m>>2]=(g[m>>2]|0)+O,m=M+8|0,m=M+((m&7|0)==0?0:0-m&7)|0,y=b+8|0,y=b+((y&7|0)==0?0:0-y&7)|0,f=m+E|0,l=y-m-E|0,g[m+4>>2]=E|3;e:do if((d|0)==(y|0))ot=(g[5860]|0)+l|0,g[5860]=ot,g[5863]=f,g[f+4>>2]=ot|1;else{if((g[5862]|0)==(y|0)){ot=(g[5859]|0)+l|0,g[5859]=ot,g[5862]=f,g[f+4>>2]=ot|1,g[f+ot>>2]=ot;break}if(v=g[y+4>>2]|0,(v&3|0)==1){O=v&-8,w=v>>>3;i:do if(v>>>0<256)if(v=g[y+8>>2]|0,b=g[y+12>>2]|0,(b|0)==(v|0)){g[5857]=g[5857]&~(1<<w);break}else{g[v+12>>2]=b,g[b+8>>2]=v;break}else{M=g[y+24>>2]|0,v=g[y+12>>2]|0;do if((v|0)==(y|0)){if(b=y+16|0,w=b+4|0,v=g[w>>2]|0,v)b=w;else if(v=g[b>>2]|0,!v){v=0;break}for(;;)if(T=v+20|0,w=g[T>>2]|0,w)v=w,b=T;else if(T=v+16|0,w=g[T>>2]|0,w)v=w,b=T;else break;g[b>>2]=0}else ot=g[y+8>>2]|0,g[ot+12>>2]=v,g[v+8>>2]=ot;while(!1);if(!M)break;b=g[y+28>>2]|0,w=23732+(b<<2)|0;do if((g[w>>2]|0)!=(y|0)){if(ot=M+16|0,g[((g[ot>>2]|0)==(y|0)?ot:M+20|0)>>2]=v,!v)break i}else{if(g[w>>2]=v,v|0)break;g[5858]=g[5858]&~(1<<b);break i}while(!1);if(g[v+24>>2]=M,b=y+16|0,w=g[b>>2]|0,w|0&&(g[v+16>>2]=w,g[w+24>>2]=v),b=g[b+4>>2]|0,!b)break;g[v+20>>2]=b,g[b+24>>2]=v}while(!1);y=y+O|0,T=O+l|0}else T=l;if(y=y+4|0,g[y>>2]=g[y>>2]&-2,g[f+4>>2]=T|1,g[f+T>>2]=T,y=T>>>3,T>>>0<256){b=23468+(y<<1<<2)|0,v=g[5857]|0,y=1<<y,v&y?(v=b+8|0,y=g[v>>2]|0):(g[5857]=v|y,y=b,v=b+8|0),g[v>>2]=f,g[y+12>>2]=f,g[f+8>>2]=y,g[f+12>>2]=b;break}y=T>>>8;do if(!y)w=0;else{if(T>>>0>16777215){w=31;break}it=(y+1048320|0)>>>16&8,ot=y<<it,Z=(ot+520192|0)>>>16&4,ot=ot<<Z,w=(ot+245760|0)>>>16&2,w=14-(Z|it|w)+(ot<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1}while(!1);if(y=23732+(w<<2)|0,g[f+28>>2]=w,v=f+16|0,g[v+4>>2]=0,g[v>>2]=0,v=g[5858]|0,b=1<<w,!(v&b)){g[5858]=v|b,g[y>>2]=f,g[f+24>>2]=y,g[f+12>>2]=f,g[f+8>>2]=f;break}y=g[y>>2]|0;i:do if((g[y+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);b=y+16+(w>>>31<<2)|0,v=g[b>>2]|0,!!v;)if((g[v+4>>2]&-8|0)==(T|0)){y=v;break i}else w=w<<1,y=v;g[b>>2]=f,g[f+24>>2]=y,g[f+12>>2]=f,g[f+8>>2]=f;break e}while(!1);it=y+8|0,ot=g[it>>2]|0,g[ot+12>>2]=f,g[it>>2]=f,g[f+8>>2]=ot,g[f+12>>2]=y,g[f+24>>2]=0}while(!1);return ot=m+8|0,Tt=bt,ot|0}for(y=23876;v=g[y>>2]|0,!(v>>>0<=d>>>0&&(ot=v+(g[y+4>>2]|0)|0,ot>>>0>d>>>0));)y=g[y+8>>2]|0;T=ot+-47|0,v=T+8|0,v=T+((v&7|0)==0?0:0-v&7)|0,T=d+16|0,v=v>>>0<T>>>0?d:v,y=v+8|0,b=O+-40|0,Z=M+8|0,Z=(Z&7|0)==0?0:0-Z&7,it=M+Z|0,Z=b-Z|0,g[5863]=it,g[5860]=Z,g[it+4>>2]=Z|1,g[M+b+4>>2]=40,g[5864]=g[5979],b=v+4|0,g[b>>2]=27,g[y>>2]=g[5969],g[y+4>>2]=g[5970],g[y+8>>2]=g[5971],g[y+12>>2]=g[5972],g[5969]=M,g[5970]=O,g[5972]=0,g[5971]=y,y=v+24|0;do it=y,y=y+4|0,g[y>>2]=7;while((it+8|0)>>>0<ot>>>0);if((v|0)!=(d|0)){if(M=v-d|0,g[b>>2]=g[b>>2]&-2,g[d+4>>2]=M|1,g[v>>2]=M,y=M>>>3,M>>>0<256){b=23468+(y<<1<<2)|0,v=g[5857]|0,y=1<<y,v&y?(v=b+8|0,y=g[v>>2]|0):(g[5857]=v|y,y=b,v=b+8|0),g[v>>2]=d,g[y+12>>2]=d,g[d+8>>2]=y,g[d+12>>2]=b;break}if(y=M>>>8,y?M>>>0>16777215?w=31:(it=(y+1048320|0)>>>16&8,ot=y<<it,Z=(ot+520192|0)>>>16&4,ot=ot<<Z,w=(ot+245760|0)>>>16&2,w=14-(Z|it|w)+(ot<<w>>>15)|0,w=M>>>(w+7|0)&1|w<<1):w=0,b=23732+(w<<2)|0,g[d+28>>2]=w,g[d+20>>2]=0,g[T>>2]=0,y=g[5858]|0,v=1<<w,!(y&v)){g[5858]=y|v,g[b>>2]=d,g[d+24>>2]=b,g[d+12>>2]=d,g[d+8>>2]=d;break}y=g[b>>2]|0;e:do if((g[y+4>>2]&-8|0)!=(M|0)){for(w=M<<((w|0)==31?0:25-(w>>>1)|0);b=y+16+(w>>>31<<2)|0,v=g[b>>2]|0,!!v;)if((g[v+4>>2]&-8|0)==(M|0)){y=v;break e}else w=w<<1,y=v;g[b>>2]=d,g[d+24>>2]=y,g[d+12>>2]=d,g[d+8>>2]=d;break t}while(!1);it=y+8|0,ot=g[it>>2]|0,g[ot+12>>2]=d,g[it>>2]=d,g[d+8>>2]=ot,g[d+12>>2]=y,g[d+24>>2]=0}}else ot=g[5861]|0,(ot|0)==0|M>>>0<ot>>>0&&(g[5861]=M),g[5969]=M,g[5970]=O,g[5972]=0,g[5866]=g[5975],g[5865]=-1,g[5870]=23468,g[5869]=23468,g[5872]=23476,g[5871]=23476,g[5874]=23484,g[5873]=23484,g[5876]=23492,g[5875]=23492,g[5878]=23500,g[5877]=23500,g[5880]=23508,g[5879]=23508,g[5882]=23516,g[5881]=23516,g[5884]=23524,g[5883]=23524,g[5886]=23532,g[5885]=23532,g[5888]=23540,g[5887]=23540,g[5890]=23548,g[5889]=23548,g[5892]=23556,g[5891]=23556,g[5894]=23564,g[5893]=23564,g[5896]=23572,g[5895]=23572,g[5898]=23580,g[5897]=23580,g[5900]=23588,g[5899]=23588,g[5902]=23596,g[5901]=23596,g[5904]=23604,g[5903]=23604,g[5906]=23612,g[5905]=23612,g[5908]=23620,g[5907]=23620,g[5910]=23628,g[5909]=23628,g[5912]=23636,g[5911]=23636,g[5914]=23644,g[5913]=23644,g[5916]=23652,g[5915]=23652,g[5918]=23660,g[5917]=23660,g[5920]=23668,g[5919]=23668,g[5922]=23676,g[5921]=23676,g[5924]=23684,g[5923]=23684,g[5926]=23692,g[5925]=23692,g[5928]=23700,g[5927]=23700,g[5930]=23708,g[5929]=23708,g[5932]=23716,g[5931]=23716,ot=O+-40|0,Z=M+8|0,Z=(Z&7|0)==0?0:0-Z&7,it=M+Z|0,Z=ot-Z|0,g[5863]=it,g[5860]=Z,g[it+4>>2]=Z|1,g[M+ot+4>>2]=40,g[5864]=g[5979];while(!1);if(y=g[5860]|0,y>>>0>E>>>0)return Z=y-E|0,g[5860]=Z,ot=g[5863]|0,it=ot+E|0,g[5863]=it,g[it+4>>2]=Z|1,g[ot+4>>2]=E|3,ot=ot+8|0,Tt=bt,ot|0}return ot=Eu()|0,g[ot>>2]=12,ot=0,Tt=bt,ot|0}function Ui(v){v=v|0;var y=0,b=0,w=0,T=0,M=0,O=0,l=0,d=0;if(v){b=v+-8|0,T=g[5861]|0,v=g[v+-4>>2]|0,y=v&-8,d=b+y|0;do if(v&1)l=b,O=b;else{if(w=g[b>>2]|0,!(v&3)||(O=b+(0-w)|0,M=w+y|0,O>>>0<T>>>0))return;if((g[5862]|0)==(O|0)){if(v=d+4|0,y=g[v>>2]|0,(y&3|0)!=3){l=O,y=M;break}g[5859]=M,g[v>>2]=y&-2,g[O+4>>2]=M|1,g[O+M>>2]=M;return}if(b=w>>>3,w>>>0<256)if(v=g[O+8>>2]|0,y=g[O+12>>2]|0,(y|0)==(v|0)){g[5857]=g[5857]&~(1<<b),l=O,y=M;break}else{g[v+12>>2]=y,g[y+8>>2]=v,l=O,y=M;break}T=g[O+24>>2]|0,v=g[O+12>>2]|0;do if((v|0)==(O|0)){if(y=O+16|0,b=y+4|0,v=g[b>>2]|0,v)y=b;else if(v=g[y>>2]|0,!v){v=0;break}for(;;)if(w=v+20|0,b=g[w>>2]|0,b)v=b,y=w;else if(w=v+16|0,b=g[w>>2]|0,b)v=b,y=w;else break;g[y>>2]=0}else l=g[O+8>>2]|0,g[l+12>>2]=v,g[v+8>>2]=l;while(!1);if(T){if(y=g[O+28>>2]|0,b=23732+(y<<2)|0,(g[b>>2]|0)==(O|0)){if(g[b>>2]=v,!v){g[5858]=g[5858]&~(1<<y),l=O,y=M;break}}else if(l=T+16|0,g[((g[l>>2]|0)==(O|0)?l:T+20|0)>>2]=v,!v){l=O,y=M;break}g[v+24>>2]=T,y=O+16|0,b=g[y>>2]|0,b|0&&(g[v+16>>2]=b,g[b+24>>2]=v),y=g[y+4>>2]|0,y?(g[v+20>>2]=y,g[y+24>>2]=v,l=O,y=M):(l=O,y=M)}else l=O,y=M}while(!1);if(!(O>>>0>=d>>>0)&&(v=d+4|0,w=g[v>>2]|0,!!(w&1))){if(w&2)g[v>>2]=w&-2,g[l+4>>2]=y|1,g[O+y>>2]=y,T=y;else{if((g[5863]|0)==(d|0)){if(d=(g[5860]|0)+y|0,g[5860]=d,g[5863]=l,g[l+4>>2]=d|1,(l|0)!=(g[5862]|0))return;g[5862]=0,g[5859]=0;return}if((g[5862]|0)==(d|0)){d=(g[5859]|0)+y|0,g[5859]=d,g[5862]=O,g[l+4>>2]=d|1,g[O+d>>2]=d;return}T=(w&-8)+y|0,b=w>>>3;do if(w>>>0<256)if(y=g[d+8>>2]|0,v=g[d+12>>2]|0,(v|0)==(y|0)){g[5857]=g[5857]&~(1<<b);break}else{g[y+12>>2]=v,g[v+8>>2]=y;break}else{M=g[d+24>>2]|0,v=g[d+12>>2]|0;do if((v|0)==(d|0)){if(y=d+16|0,b=y+4|0,v=g[b>>2]|0,v)y=b;else if(v=g[y>>2]|0,!v){b=0;break}for(;;)if(w=v+20|0,b=g[w>>2]|0,b)v=b,y=w;else if(w=v+16|0,b=g[w>>2]|0,b)v=b,y=w;else break;g[y>>2]=0,b=v}else b=g[d+8>>2]|0,g[b+12>>2]=v,g[v+8>>2]=b,b=v;while(!1);if(M|0){if(v=g[d+28>>2]|0,y=23732+(v<<2)|0,(g[y>>2]|0)==(d|0)){if(g[y>>2]=b,!b){g[5858]=g[5858]&~(1<<v);break}}else if(w=M+16|0,g[((g[w>>2]|0)==(d|0)?w:M+20|0)>>2]=b,!b)break;g[b+24>>2]=M,v=d+16|0,y=g[v>>2]|0,y|0&&(g[b+16>>2]=y,g[y+24>>2]=b),v=g[v+4>>2]|0,v|0&&(g[b+20>>2]=v,g[v+24>>2]=b)}}while(!1);if(g[l+4>>2]=T|1,g[O+T>>2]=T,(l|0)==(g[5862]|0)){g[5859]=T;return}}if(v=T>>>3,T>>>0<256){b=23468+(v<<1<<2)|0,y=g[5857]|0,v=1<<v,y&v?(y=b+8|0,v=g[y>>2]|0):(g[5857]=y|v,v=b,y=b+8|0),g[y>>2]=l,g[v+12>>2]=l,g[l+8>>2]=v,g[l+12>>2]=b;return}v=T>>>8,v?T>>>0>16777215?w=31:(O=(v+1048320|0)>>>16&8,d=v<<O,M=(d+520192|0)>>>16&4,d=d<<M,w=(d+245760|0)>>>16&2,w=14-(M|O|w)+(d<<w>>>15)|0,w=T>>>(w+7|0)&1|w<<1):w=0,v=23732+(w<<2)|0,g[l+28>>2]=w,g[l+20>>2]=0,g[l+16>>2]=0,y=g[5858]|0,b=1<<w;t:do if(!(y&b))g[5858]=y|b,g[v>>2]=l,g[l+24>>2]=v,g[l+12>>2]=l,g[l+8>>2]=l;else{v=g[v>>2]|0;e:do if((g[v+4>>2]&-8|0)!=(T|0)){for(w=T<<((w|0)==31?0:25-(w>>>1)|0);b=v+16+(w>>>31<<2)|0,y=g[b>>2]|0,!!y;)if((g[y+4>>2]&-8|0)==(T|0)){v=y;break e}else w=w<<1,v=y;g[b>>2]=l,g[l+24>>2]=v,g[l+12>>2]=l,g[l+8>>2]=l;break t}while(!1);O=v+8|0,d=g[O>>2]|0,g[d+12>>2]=l,g[O>>2]=l,g[l+8>>2]=d,g[l+12>>2]=v,g[l+24>>2]=0}while(!1);if(d=(g[5865]|0)+-1|0,g[5865]=d,!(d|0)){for(v=23884;v=g[v>>2]|0,v;)v=v+8|0;g[5865]=-1}}}}function ls(v,y){v=v|0,y=y|0;var b=0;return v?(b=Xi(y,v)|0,(y|v)>>>0>65535&&(b=((b>>>0)/(v>>>0)|0|0)==(y|0)?b:-1)):b=0,v=Qn(b)|0,!v||!(g[v+-4>>2]&3)||ra(v|0,0,b|0)|0,v|0}function An(v,y,b,w){return v=v|0,y=y|0,b=b|0,w=w|0,b=v+b>>>0,mi(y+w+(b>>>0<v>>>0|0)>>>0|0),b|0|0}function Ki(v,y,b,w){return v=v|0,y=y|0,b=b|0,w=w|0,w=y-w-(b>>>0>v>>>0|0)>>>0,mi(w|0),v-b>>>0|0|0}function kr(v){return v=v|0,(v?31-(Qi(v^v-1)|0)|0:32)|0}function Bu(v,y,b,w,T){v=v|0,y=y|0,b=b|0,w=w|0,T=T|0;var M=0,O=0,l=0,d=0,f=0,m=0,E=0,P=0,R=0,F=0;if(m=v,d=y,f=d,O=b,P=w,l=P,!f)return M=(T|0)!=0,l?M?(g[T>>2]=v|0,g[T+4>>2]=y&0,P=0,T=0,mi(P|0),T|0):(P=0,T=0,mi(P|0),T|0):(M&&(g[T>>2]=(m>>>0)%(O>>>0),g[T+4>>2]=0),P=0,T=(m>>>0)/(O>>>0)>>>0,mi(P|0),T|0);M=(l|0)==0;do if(O){if(!M){if(M=(Qi(l|0)|0)-(Qi(f|0)|0)|0,M>>>0<=31){E=M+1|0,l=31-M|0,y=M-31>>31,O=E,v=m>>>(E>>>0)&y|f<<l,y=f>>>(E>>>0)&y,M=0,l=m<<l;break}return T?(g[T>>2]=v|0,g[T+4>>2]=d|y&0,P=0,T=0,mi(P|0),T|0):(P=0,T=0,mi(P|0),T|0)}if(M=O-1|0,M&O|0){l=(Qi(O|0)|0)+33-(Qi(f|0)|0)|0,F=64-l|0,E=32-l|0,d=E>>31,R=l-32|0,y=R>>31,O=l,v=E-1>>31&f>>>(R>>>0)|(f<<E|m>>>(l>>>0))&y,y=y&f>>>(l>>>0),M=m<<F&d,l=(f<<F|m>>>(R>>>0))&d|m<<E&l-33>>31;break}return T|0&&(g[T>>2]=M&m,g[T+4>>2]=0),(O|0)==1?(R=d|y&0,F=v|0|0,mi(R|0),F|0):(F=kr(O|0)|0,R=f>>>(F>>>0)|0,F=f<<32-F|m>>>(F>>>0)|0,mi(R|0),F|0)}else{if(M)return T|0&&(g[T>>2]=(f>>>0)%(O>>>0),g[T+4>>2]=0),R=0,F=(f>>>0)/(O>>>0)>>>0,mi(R|0),F|0;if(!m)return T|0&&(g[T>>2]=0,g[T+4>>2]=(f>>>0)%(l>>>0)),R=0,F=(f>>>0)/(l>>>0)>>>0,mi(R|0),F|0;if(M=l-1|0,!(M&l))return T|0&&(g[T>>2]=v|0,g[T+4>>2]=M&f|y&0),R=0,F=f>>>((kr(l|0)|0)>>>0),mi(R|0),F|0;if(M=(Qi(l|0)|0)-(Qi(f|0)|0)|0,M>>>0<=30){y=M+1|0,l=31-M|0,O=y,v=f<<l|m>>>(y>>>0),y=f>>>(y>>>0),M=0,l=m<<l;break}return T?(g[T>>2]=v|0,g[T+4>>2]=d|y&0,R=0,F=0,mi(R|0),F|0):(R=0,F=0,mi(R|0),F|0)}while(!1);if(!O)f=l,d=0,l=0;else{E=b|0|0,m=P|w&0,f=An(E|0,m|0,-1,-1)|0,b=Bt()|0,d=l,l=0;do w=d,d=M>>>31|d<<1,M=l|M<<1,w=v<<1|w>>>31|0,P=v>>>31|y<<1|0,Ki(f|0,b|0,w|0,P|0)|0,F=Bt()|0,R=F>>31|((F|0)<0?-1:0)<<1,l=R&1,v=Ki(w|0,P|0,R&E|0,(((F|0)<0?-1:0)>>31|((F|0)<0?-1:0)<<1)&m|0)|0,y=Bt()|0,O=O-1|0;while((O|0)!=0);f=d,d=0}return O=0,T|0&&(g[T>>2]=v,g[T+4>>2]=y),R=(M|0)>>>31|(f|O)<<1|(O<<1|M>>>31)&0|d,F=(M<<1|0)&-2|l,mi(R|0),F|0}function Xo(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0;return f=y>>31|((y|0)<0?-1:0)<<1,d=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,M=w>>31|((w|0)<0?-1:0)<<1,T=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,l=Ki(f^v|0,d^y|0,f|0,d|0)|0,O=Bt()|0,v=M^f,y=T^d,Ki((Bu(l,O,Ki(M^b|0,T^w|0,M|0,T|0)|0,Bt()|0,0)|0)^v|0,(Bt()|0)^y|0,v|0,y|0)|0}function Sh(v,y){v=v|0,y=y|0;var b=0,w=0,T=0,M=0;return M=v&65535,T=y&65535,b=Xi(T,M)|0,w=v>>>16,v=(b>>>16)+(Xi(T,w)|0)|0,T=y>>>16,y=Xi(T,M)|0,mi((v>>>16)+(Xi(T,w)|0)+(((v&65535)+y|0)>>>16)|0),v+y<<16|b&65535|0|0}function dr(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;return T=v,M=b,b=Sh(T,M)|0,v=Bt()|0,mi((Xi(y,M)|0)+(Xi(w,T)|0)+v|v&0|0),b|0|0|0}function ro(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0,O=0,l=0,d=0,f=0;return T=Tt,Tt=Tt+16|0,l=T|0,O=y>>31|((y|0)<0?-1:0)<<1,M=((y|0)<0?-1:0)>>31|((y|0)<0?-1:0)<<1,f=w>>31|((w|0)<0?-1:0)<<1,d=((w|0)<0?-1:0)>>31|((w|0)<0?-1:0)<<1,v=Ki(O^v|0,M^y|0,O|0,M|0)|0,y=Bt()|0,Bu(v,y,Ki(f^b|0,d^w|0,f|0,d|0)|0,Bt()|0,l)|0,w=Ki(g[l>>2]^O|0,g[l+4>>2]^M|0,O|0,M|0)|0,b=Bt()|0,Tt=T,mi(b|0),w|0}function Es(v,y,b,w){v=v|0,y=y|0,b=b|0,w=w|0;var T=0,M=0;return M=Tt,Tt=Tt+16|0,T=M|0,Bu(v,y,b,w,T)|0,Tt=M,mi(g[T+4>>2]|0),g[T>>2]|0|0}function Bs(v,y,b){return v=v|0,y=y|0,b=b|0,(b|0)<32?(mi(y>>b|0),v>>>b|(y&(1<<b)-1)<<32-b):(mi(((y|0)<0?-1:0)|0),y>>b-32|0)}function Xe(v,y,b){return v=v|0,y=y|0,b=b|0,(b|0)<32?(mi(y>>>b|0),v>>>b|(y&(1<<b)-1)<<32-b):(mi(0),y>>>b-32|0)}function ei(v,y,b){return v=v|0,y=y|0,b=b|0,(b|0)<32?(mi(y<<b|(v&(1<<b)-1<<32-b)>>>32-b|0),v<<b):(mi(v<<b-32|0),0)}function jc(v,y){return v=+v,y=+y,v!=v?+y:y!=y?+v:+vr(+v,+y)}function Ol(v,y){return v=+v,y=+y,v!=v?+y:y!=y?+v:+Gi(+v,+y)}function na(v){return v=+v,v>=0?+Ee(v+.5):+Ji(v-.5)}function Ls(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0;if((b|0)>=8192)return va(v|0,y|0,b|0)|0,v|0;if(M=v|0,T=v+b|0,(v&3)==(y&3)){for(;v&3;){if(!b)return M|0;wt[v>>0]=wt[y>>0]|0,v=v+1|0,y=y+1|0,b=b-1|0}for(b=T&-4|0,w=b-64|0;(v|0)<=(w|0);)g[v>>2]=g[y>>2],g[v+4>>2]=g[y+4>>2],g[v+8>>2]=g[y+8>>2],g[v+12>>2]=g[y+12>>2],g[v+16>>2]=g[y+16>>2],g[v+20>>2]=g[y+20>>2],g[v+24>>2]=g[y+24>>2],g[v+28>>2]=g[y+28>>2],g[v+32>>2]=g[y+32>>2],g[v+36>>2]=g[y+36>>2],g[v+40>>2]=g[y+40>>2],g[v+44>>2]=g[y+44>>2],g[v+48>>2]=g[y+48>>2],g[v+52>>2]=g[y+52>>2],g[v+56>>2]=g[y+56>>2],g[v+60>>2]=g[y+60>>2],v=v+64|0,y=y+64|0;for(;(v|0)<(b|0);)g[v>>2]=g[y>>2],v=v+4|0,y=y+4|0}else for(b=T-4|0;(v|0)<(b|0);)wt[v>>0]=wt[y>>0]|0,wt[v+1>>0]=wt[y+1>>0]|0,wt[v+2>>0]=wt[y+2>>0]|0,wt[v+3>>0]=wt[y+3>>0]|0,v=v+4|0,y=y+4|0;for(;(v|0)<(T|0);)wt[v>>0]=wt[y>>0]|0,v=v+1|0,y=y+1|0;return M|0}function ra(v,y,b){v=v|0,y=y|0,b=b|0;var w=0,T=0,M=0,O=0;if(M=v+b|0,y=y&255,(b|0)>=67){for(;v&3;)wt[v>>0]=y,v=v+1|0;for(w=M&-4|0,O=y|y<<8|y<<16|y<<24,T=w-64|0;(v|0)<=(T|0);)g[v>>2]=O,g[v+4>>2]=O,g[v+8>>2]=O,g[v+12>>2]=O,g[v+16>>2]=O,g[v+20>>2]=O,g[v+24>>2]=O,g[v+28>>2]=O,g[v+32>>2]=O,g[v+36>>2]=O,g[v+40>>2]=O,g[v+44>>2]=O,g[v+48>>2]=O,g[v+52>>2]=O,g[v+56>>2]=O,g[v+60>>2]=O,v=v+64|0;for(;(v|0)<(w|0);)g[v>>2]=O,v=v+4|0}for(;(v|0)<(M|0);)wt[v>>0]=y,v=v+1|0;return M-b|0}function oa(v){return v=+v,v>=0?+Ee(v+.5):+Ji(v-.5)}function vo(v){v=v|0;var y=0,b=0,w=0;return w=Hr()|0,b=g[Kt>>2]|0,y=b+v|0,(v|0)>0&(y|0)<(b|0)|(y|0)<0?(Wn(y|0)|0,en(12),-1):(y|0)>(w|0)&&!(ur(y|0)|0)?(en(12),-1):(g[Kt>>2]=y,b|0)}return{___divdi3:Xo,___muldi3:dr,___remdi3:ro,___uremdi3:Es,_areNeighborCells:Ba,_bitshift64Ashr:Bs,_bitshift64Lshr:Xe,_bitshift64Shl:ei,_calloc:ls,_cellAreaKm2:kn,_cellAreaM2:Wo,_cellAreaRads2:hn,_cellToBoundary:Lc,_cellToCenterChild:aA,_cellToChildPos:mu,_cellToChildren:Fn,_cellToChildrenSize:Bl,_cellToLatLng:Oc,_cellToLocalIj:jf,_cellToParent:Ys,_cellToVertex:Vi,_cellToVertexes:Os,_cellsToDirectedEdge:Ka,_cellsToLinkedMultiPolygon:ji,_childPosToCell:lA,_compactCells:Rc,_destroyLinkedMultiPolygon:Uc,_directedEdgeToBoundary:uu,_directedEdgeToCells:Of,_edgeLengthKm:Nc,_edgeLengthM:Pl,_edgeLengthRads:Ml,_emscripten_replace_memory:Ws,_free:Ui,_getBaseCellNumber:_h,_getDirectedEdgeDestination:Ta,_getDirectedEdgeOrigin:qa,_getHexagonAreaAvgKm2:Gf,_getHexagonAreaAvgM2:rc,_getHexagonEdgeLengthAvgKm:Xn,_getHexagonEdgeLengthAvgM:_u,_getIcosahedronFaces:Fc,_getNumCells:$s,_getPentagons:Tl,_getRes0Cells:Rf,_getResolution:Za,_greatCircleDistanceKm:nc,_greatCircleDistanceM:bh,_greatCircleDistanceRads:vu,_gridDisk:Rn,_gridDiskDistances:mo,_gridDistance:si,_gridPathCells:bu,_gridPathCellsSize:Io,_gridRingUnsafe:At,_i64Add:An,_i64Subtract:Ki,_isPentagon:Dn,_isResClassIII:zf,_isValidCell:Zs,_isValidDirectedEdge:Df,_isValidVertex:Jr,_latLngToCell:$a,_llvm_maxnum_f64:jc,_llvm_minnum_f64:Ol,_llvm_round_f64:na,_localIjToCell:Er,_malloc:Qn,_maxFaceCount:ec,_maxGridDiskSize:Mr,_maxPolygonToCellsSize:Mt,_memcpy:Ls,_memset:ra,_originToDirectedEdges:In,_pentagonCount:gu,_polygonToCells:be,_readInt64AsDoubleFromPointer:Po,_res0CellCount:xl,_round:oa,_sbrk:vo,_sizeOfCellBoundary:Eh,_sizeOfCoordIJ:Cu,_sizeOfGeoLoop:ss,_sizeOfGeoPolygon:Mo,_sizeOfH3Index:Ch,_sizeOfLatLng:xu,_sizeOfLinkedGeoPolygon:wu,_uncompactCells:Uf,_uncompactCellsSize:cA,_vertexToLatLng:as,establishStackSpace:hr,stackAlloc:Jn,stackRestore:Fr,stackSave:Js}}(gt,ze,Lt);t.___divdi3=we.___divdi3,t.___muldi3=we.___muldi3,t.___remdi3=we.___remdi3,t.___uremdi3=we.___uremdi3,t._areNeighborCells=we._areNeighborCells,t._bitshift64Ashr=we._bitshift64Ashr,t._bitshift64Lshr=we._bitshift64Lshr,t._bitshift64Shl=we._bitshift64Shl,t._calloc=we._calloc,t._cellAreaKm2=we._cellAreaKm2,t._cellAreaM2=we._cellAreaM2,t._cellAreaRads2=we._cellAreaRads2,t._cellToBoundary=we._cellToBoundary,t._cellToCenterChild=we._cellToCenterChild,t._cellToChildPos=we._cellToChildPos,t._cellToChildren=we._cellToChildren,t._cellToChildrenSize=we._cellToChildrenSize,t._cellToLatLng=we._cellToLatLng,t._cellToLocalIj=we._cellToLocalIj,t._cellToParent=we._cellToParent,t._cellToVertex=we._cellToVertex,t._cellToVertexes=we._cellToVertexes,t._cellsToDirectedEdge=we._cellsToDirectedEdge,t._cellsToLinkedMultiPolygon=we._cellsToLinkedMultiPolygon,t._childPosToCell=we._childPosToCell,t._compactCells=we._compactCells,t._destroyLinkedMultiPolygon=we._destroyLinkedMultiPolygon,t._directedEdgeToBoundary=we._directedEdgeToBoundary,t._directedEdgeToCells=we._directedEdgeToCells,t._edgeLengthKm=we._edgeLengthKm,t._edgeLengthM=we._edgeLengthM,t._edgeLengthRads=we._edgeLengthRads;var V=t._emscripten_replace_memory=we._emscripten_replace_memory;t._free=we._free,t._getBaseCellNumber=we._getBaseCellNumber,t._getDirectedEdgeDestination=we._getDirectedEdgeDestination,t._getDirectedEdgeOrigin=we._getDirectedEdgeOrigin,t._getHexagonAreaAvgKm2=we._getHexagonAreaAvgKm2,t._getHexagonAreaAvgM2=we._getHexagonAreaAvgM2,t._getHexagonEdgeLengthAvgKm=we._getHexagonEdgeLengthAvgKm,t._getHexagonEdgeLengthAvgM=we._getHexagonEdgeLengthAvgM,t._getIcosahedronFaces=we._getIcosahedronFaces,t._getNumCells=we._getNumCells,t._getPentagons=we._getPentagons,t._getRes0Cells=we._getRes0Cells,t._getResolution=we._getResolution,t._greatCircleDistanceKm=we._greatCircleDistanceKm,t._greatCircleDistanceM=we._greatCircleDistanceM,t._greatCircleDistanceRads=we._greatCircleDistanceRads,t._gridDisk=we._gridDisk,t._gridDiskDistances=we._gridDiskDistances,t._gridDistance=we._gridDistance,t._gridPathCells=we._gridPathCells,t._gridPathCellsSize=we._gridPathCellsSize,t._gridRingUnsafe=we._gridRingUnsafe,t._i64Add=we._i64Add,t._i64Subtract=we._i64Subtract,t._isPentagon=we._isPentagon,t._isResClassIII=we._isResClassIII,t._isValidCell=we._isValidCell,t._isValidDirectedEdge=we._isValidDirectedEdge,t._isValidVertex=we._isValidVertex,t._latLngToCell=we._latLngToCell,t._llvm_maxnum_f64=we._llvm_maxnum_f64,t._llvm_minnum_f64=we._llvm_minnum_f64,t._llvm_round_f64=we._llvm_round_f64,t._localIjToCell=we._localIjToCell,t._malloc=we._malloc,t._maxFaceCount=we._maxFaceCount,t._maxGridDiskSize=we._maxGridDiskSize,t._maxPolygonToCellsSize=we._maxPolygonToCellsSize,t._memcpy=we._memcpy,t._memset=we._memset,t._originToDirectedEdges=we._originToDirectedEdges,t._pentagonCount=we._pentagonCount,t._polygonToCells=we._polygonToCells,t._readInt64AsDoubleFromPointer=we._readInt64AsDoubleFromPointer,t._res0CellCount=we._res0CellCount,t._round=we._round,t._sbrk=we._sbrk,t._sizeOfCellBoundary=we._sizeOfCellBoundary,t._sizeOfCoordIJ=we._sizeOfCoordIJ,t._sizeOfGeoLoop=we._sizeOfGeoLoop,t._sizeOfGeoPolygon=we._sizeOfGeoPolygon,t._sizeOfH3Index=we._sizeOfH3Index,t._sizeOfLatLng=we._sizeOfLatLng,t._sizeOfLinkedGeoPolygon=we._sizeOfLinkedGeoPolygon,t._uncompactCells=we._uncompactCells,t._uncompactCellsSize=we._uncompactCellsSize,t._vertexToLatLng=we._vertexToLatLng,t.establishStackSpace=we.establishStackSpace;var ve=t.stackAlloc=we.stackAlloc,Be=t.stackRestore=we.stackRestore,xt=t.stackSave=we.stackSave;if(t.asm=we,t.cwrap=K,t.setValue=L,t.getValue=N,mn){Hn(mn)||(mn=s(mn));{lr();var Xt=function(ft){ft.byteLength&&(ft=new Uint8Array(ft)),ut.set(ft,S),t.memoryInitializerRequest&&delete t.memoryInitializerRequest.response,Yn()},ce=function(){o(mn,Xt,function(){throw"could not load memory initializer "+mn})},q=Re(mn);if(q)Xt(q.buffer);else if(t.memoryInitializerRequest){var nt=function(){var ft=t.memoryInitializerRequest,_t=ft.response;if(ft.status!==200&&ft.status!==0){var st=Re(t.memoryInitializerRequestURL);if(st)_t=st.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+ft.status+", retrying "+mn),ce();return}}Xt(_t)};t.memoryInitializerRequest.response?setTimeout(nt,0):t.memoryInitializerRequest.addEventListener("load",nt)}else ce()}}var at;Di=function ft(){at||vt(),at||(Di=ft)};function vt(ft){if(un>0||(Ke(),un>0))return;function _t(){at||(at=!0,!U&&(qe(),Ve(),t.onRuntimeInitialized&&t.onRuntimeInitialized(),di()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),_t()},1)):_t()}t.run=vt;function Ot(ft){throw t.onAbort&&t.onAbort(ft),ft+="",c(ft),h(ft),U=!0,"abort("+ft+"). Build with -s ASSERTIONS=1 for more info."}if(t.abort=Ot,t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return vt(),e}(typeof ki=="object"?ki:{}),_n="number",an=_n,Gg=_n,dn=_n,pn=_n,ms=_n,Pi=_n,Idt=[["sizeOfH3Index",_n],["sizeOfLatLng",_n],["sizeOfCellBoundary",_n],["sizeOfGeoLoop",_n],["sizeOfGeoPolygon",_n],["sizeOfLinkedGeoPolygon",_n],["sizeOfCoordIJ",_n],["readInt64AsDoubleFromPointer",_n],["isValidCell",Gg,[dn,pn]],["latLngToCell",an,[_n,_n,ms,Pi]],["cellToLatLng",an,[dn,pn,Pi]],["cellToBoundary",an,[dn,pn,Pi]],["maxGridDiskSize",an,[_n,Pi]],["gridDisk",an,[dn,pn,_n,Pi]],["gridDiskDistances",an,[dn,pn,_n,Pi,Pi]],["gridRingUnsafe",an,[dn,pn,_n,Pi]],["maxPolygonToCellsSize",an,[Pi,ms,_n,Pi]],["polygonToCells",an,[Pi,ms,_n,Pi]],["cellsToLinkedMultiPolygon",an,[Pi,_n,Pi]],["destroyLinkedMultiPolygon",null,[Pi]],["compactCells",an,[Pi,Pi,_n,_n]],["uncompactCells",an,[Pi,_n,_n,Pi,_n,ms]],["uncompactCellsSize",an,[Pi,_n,_n,ms,Pi]],["isPentagon",Gg,[dn,pn]],["isResClassIII",Gg,[dn,pn]],["getBaseCellNumber",_n,[dn,pn]],["getResolution",_n,[dn,pn]],["maxFaceCount",an,[dn,pn,Pi]],["getIcosahedronFaces",an,[dn,pn,Pi]],["cellToParent",an,[dn,pn,ms,Pi]],["cellToChildren",an,[dn,pn,ms,Pi]],["cellToCenterChild",an,[dn,pn,ms,Pi]],["cellToChildrenSize",an,[dn,pn,ms,Pi]],["cellToChildPos",an,[dn,pn,ms,Pi]],["childPosToCell",an,[_n,_n,dn,pn,ms,Pi]],["areNeighborCells",an,[dn,pn,dn,pn,Pi]],["cellsToDirectedEdge",an,[dn,pn,dn,pn,Pi]],["getDirectedEdgeOrigin",an,[dn,pn,Pi]],["getDirectedEdgeDestination",an,[dn,pn,Pi]],["isValidDirectedEdge",Gg,[dn,pn]],["directedEdgeToCells",an,[dn,pn,Pi]],["originToDirectedEdges",an,[dn,pn,Pi]],["directedEdgeToBoundary",an,[dn,pn,Pi]],["gridDistance",an,[dn,pn,dn,pn,Pi]],["gridPathCells",an,[dn,pn,dn,pn,Pi]],["gridPathCellsSize",an,[dn,pn,dn,pn,Pi]],["cellToLocalIj",an,[dn,pn,dn,pn,_n,Pi]],["localIjToCell",an,[dn,pn,Pi,_n,Pi]],["getHexagonAreaAvgM2",an,[ms,Pi]],["getHexagonAreaAvgKm2",an,[ms,Pi]],["getHexagonEdgeLengthAvgM",an,[ms,Pi]],["getHexagonEdgeLengthAvgKm",an,[ms,Pi]],["greatCircleDistanceM",_n,[Pi,Pi]],["greatCircleDistanceKm",_n,[Pi,Pi]],["greatCircleDistanceRads",_n,[Pi,Pi]],["cellAreaM2",an,[dn,pn,Pi]],["cellAreaKm2",an,[dn,pn,Pi]],["cellAreaRads2",an,[dn,pn,Pi]],["edgeLengthM",an,[dn,pn,Pi]],["edgeLengthKm",an,[dn,pn,Pi]],["edgeLengthRads",an,[dn,pn,Pi]],["getNumCells",an,[ms,Pi]],["getRes0Cells",an,[Pi]],["res0CellCount",_n],["getPentagons",an,[_n,Pi]],["pentagonCount",_n],["cellToVertex",an,[dn,pn,_n,Pi]],["cellToVertexes",an,[dn,pn,Pi]],["vertexToLatLng",an,[dn,pn,Pi]],["isValidVertex",Gg,[dn,pn]]],Mdt=0,Pdt=1,Rdt=2,Ddt=3,r6=4,Odt=5,Ldt=6,Fdt=7,kdt=8,Ndt=9,Udt=10,zdt=11,Gdt=12,jdt=13,Vdt=14,Hdt=15,ts={};ts[Mdt]="Success",ts[Pdt]="The operation failed but a more specific error is not available",ts[Rdt]="Argument was outside of acceptable range",ts[Ddt]="Latitude or longitude arguments were outside of acceptable range",ts[r6]="Resolution argument was outside of acceptable range",ts[Odt]="Cell argument was not valid",ts[Ldt]="Directed edge argument was not valid",ts[Fdt]="Undirected edge argument was not valid",ts[kdt]="Vertex argument was not valid",ts[Ndt]="Pentagon distortion was encountered",ts[Udt]="Duplicate input",ts[zdt]="Cell arguments were not neighbors",ts[Gdt]="Cell arguments had incompatible resolutions",ts[jdt]="Memory allocation failed",ts[Vdt]="Bounds of provided memory were insufficient",ts[Hdt]="Mode or flags argument was not valid";var aw=1e3,o6=1001,s6=1002,Yy={};Yy[aw]="Unknown unit",Yy[o6]="Array length out of bounds",Yy[s6]="Got unexpected null value for H3 index";var Wdt="Unknown error";function a6(e,t,i){var n=i&&"value"in i,r=new Error((e[t]||Wdt)+" (code: "+t+(n?", value: "+i.value:"")+")");return r.code=t,r}function c6(e,t){var i=arguments.length===2?{value:t}:{};return a6(ts,e,i)}function $y(e,t){var i=arguments.length===2?{value:t}:{};return a6(Yy,e,i)}function ys(e){if(e!==0)throw c6(e)}var sr={};Idt.forEach(function(e){sr[e[0]]=ki.cwrap.apply(ki,e)});var yp=16,vp=4,l6=4,pl=8,cw=8,ch=sr.sizeOfH3Index(),lw=sr.sizeOfLatLng(),Jdt=sr.sizeOfCellBoundary(),Xdt=sr.sizeOfGeoPolygon(),jg=sr.sizeOfGeoLoop(),Qdt=sr.sizeOfLinkedGeoPolygon();sr.sizeOfCoordIJ();var _p={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function u6(e){if(typeof e!="number"||e<0||e>15||Math.floor(e)!==e)throw c6(r6,e);return e}function h6(e){if(!e)throw $y(s6);return e}var Kdt=Math.pow(2,32)-1;function f6(e){if(e>Kdt)throw $y(o6,e);return e}var qdt=/[^0-9a-fA-F]/;function xc(e){if(Array.isArray(e)&&e.length===2&&Number.isInteger(e[0])&&Number.isInteger(e[1]))return e;if(typeof e!="string"||qdt.test(e))return[0,0];var t=parseInt(e.substring(0,e.length-8),yp),i=parseInt(e.substring(e.length-8),yp);return[i,t]}function d6(e){if(e>=0)return e.toString(yp);e=e&2147483647;var t=p6(8,e.toString(yp)),i=(parseInt(t[0],yp)+8).toString(yp);return t=i+t.substring(1),t}function Zdt(e,t){return d6(t)+p6(8,d6(e))}function p6(e,t){for(var i=e-t.length,n="",r=0;r<i;r++)n+="0";return n=n+t,n}function A6(e,t,i){for(var n=e.length,r=ki._calloc(n,lw),s=i?1:0,o=i?0:1,c=0;c<n*2;c+=2)ki.HEAPF64.set([e[c/2][s],e[c/2][o]].map(_6),r/pl+c);return ki.HEAPU32.set([n,r],t/vp),t}function Ydt(e,t){var i=e.length-1,n=ki._calloc(Xdt),r=0,s=r+jg,o=s+vp;A6(e[0],n+r,t);var c;if(i>0){c=ki._calloc(i,jg);for(var h=0;h<i;h++)A6(e[h+1],c+jg*h,t)}return ki.setValue(n+s,i,"i32"),ki.setValue(n+o,c,"i32"),n}function $dt(e){var t=0,i=t+jg,n=i+vp,r=vp;ki._free(ki.getValue(e+t+r,"i8*"));var s=ki.getValue(e+i,"i32");if(s>0){for(var o=ki.getValue(e+n,"i32"),c=0;c<s;c++)ki._free(ki.getValue(o+jg*c+r,"i8*"));ki._free(o)}ki._free(e)}function uw(e,t){t===void 0&&(t=0);var i=ki.getValue(e+ch*t,"i32"),n=ki.getValue(e+ch*t+vp,"i32");return n?Zdt(i,n):null}function g6(e,t){return t===void 0&&(t=0),ki.getValue(e+pl*t,"double")}function hw(e){return sr.readInt64AsDoubleFromPointer(e)}function tpt(e,t,i){ki.HEAPU32.set(xc(e),t/vp+2*i)}function fw(e,t){for(var i=[],n=0;n<t;n++){var r=uw(e,n);r!==null&&i.push(r)}return i}function ept(e,t){for(var i=t.length,n=0;n<i;n++)tpt(t[n],e,n)}function tv(e){return dpt(ki.getValue(e,"double"))}function m6(e){return[tv(e),tv(e+pl)]}function y6(e){return[tv(e+pl),tv(e)]}function ipt(e,t,i){for(var n=ki.getValue(e,"i32"),r=e+pl,s=[],o=t?y6:m6,c=0;c<n*2;c+=2)s.push(o(r+pl*c));return i&&s.push(s[0]),s}function npt(e,t){for(var i=[],n=y6,r,s,o,c;e;){for(i.push(r=[]),s=ki.getValue(e,"i8*");s;){for(r.push(o=[]),c=ki.getValue(s,"i8*");c;)o.push(n(c)),c=ki.getValue(c+pl*2,"i8*");o.push(o[0]),s=ki.getValue(s+l6*2,"i8*")}e=ki.getValue(e+l6*2,"i8*")}return i}function rpt(e){var t=xc(e),i=t[0],n=t[1];return!!sr.isPentagon(i,n)}function ev(e){var t=xc(e),i=t[0],n=t[1];return sr.isValidCell(i,n)?sr.getResolution(i,n):-1}function dw(e,t,i){var n=ki._malloc(lw);ki.HEAPF64.set([e,t].map(_6),n/pl);var r=ki._malloc(ch);try{return ys(sr.latLngToCell(n,i,r)),h6(uw(r))}finally{ki._free(r),ki._free(n)}}function pw(e){var t=ki._malloc(lw),i=xc(e),n=i[0],r=i[1];try{return ys(sr.cellToLatLng(n,r,t)),m6(t)}finally{ki._free(t)}}function v6(e,t){var i=ki._malloc(Jdt),n=xc(e),r=n[0],s=n[1];try{return ys(sr.cellToBoundary(r,s,i)),ipt(i,t,t)}finally{ki._free(i)}}function opt(e,t){var i=xc(e),n=i[0],r=i[1],s=ki._malloc(ch);try{return ys(sr.cellToParent(n,r,t,s)),h6(uw(s))}finally{ki._free(s)}}function spt(e,t){var i=xc(e),n=i[0],r=i[1],s=ki._malloc(cw);try{ys(sr.maxGridDiskSize(t,s));var o=f6(hw(s)),c=ki._calloc(o,ch);try{return ys(sr.gridDisk(n,r,t,c)),fw(c,o)}finally{ki._free(c)}}finally{ki._free(s)}}function apt(e,t,i){if(u6(t),i=!!i,e.length===0||e[0].length===0)return[];var n=typeof e[0][0]=="number"?[e]:e,r=Ydt(n,i),s=ki._malloc(cw);try{ys(sr.maxPolygonToCellsSize(r,t,0,s));var o=f6(hw(s)),c=ki._calloc(o,ch);try{return ys(sr.polygonToCells(r,t,0,c)),fw(c,o)}finally{ki._free(c)}}finally{ki._free(s),$dt(r)}}function cpt(e,t){if(!e||!e.length)return[];var i=e.length,n=ki._calloc(i,ch);ept(n,e);var r=ki._calloc(Qdt);try{return ys(sr.cellsToLinkedMultiPolygon(n,i,r)),npt(r,t)}finally{sr.destroyLinkedMultiPolygon(r),ki._free(r),ki._free(n)}}function lpt(e){var t=xc(e),i=t[0],n=t[1],r=6,s=ki._calloc(r,ch);try{return ys(sr.originToDirectedEdges(i,n,s)),fw(s,r)}finally{ki._free(s)}}function upt(e,t){var i=xc(e),n=i[0],r=i[1],s=xc(t),o=s[0],c=s[1],h=ki._malloc(cw);try{return ys(sr.gridDistance(n,r,o,c,h)),hw(h)}finally{ki._free(h)}}function hpt(e,t){var i=xc(e),n=i[0],r=i[1],s=ki._malloc(pl);try{switch(t){case _p.m:ys(sr.edgeLengthM(n,r,s));break;case _p.km:ys(sr.edgeLengthKm(n,r,s));break;case _p.rads:ys(sr.edgeLengthRads(n,r,s));break;default:throw $y(aw,t)}return g6(s)}finally{ki._free(s)}}function fpt(e,t){u6(e);var i=ki._malloc(pl);try{switch(t){case _p.m:ys(sr.getHexagonEdgeLengthAvgM(e,i));break;case _p.km:ys(sr.getHexagonEdgeLengthAvgKm(e,i));break;default:throw $y(aw,t)}return g6(i)}finally{ki._free(i)}}function _6(e){return e*Math.PI/180}function dpt(e){return e*180/Math.PI}function Aw(e,t){t=t===void 0?e[0][0]:t;for(const i of e){const n=i[0]-t;n>180?i[0]-=360:n<-180&&(i[0]+=360)}}function ppt(e,t,i){const[n,r]=pw(e),s=t.length;Aw(t,r);const o=t[0]===t[s-1]?s-1:s;for(let c=0;c<o;c++)t[c][0]=hc(r,t[c][0],i),t[c][1]=hc(n,t[c][1],i)}function Apt(e,t,i){const n=e(t,i),[r,s]=pw(n);return[s,r]}function b6(e,t=1){const i=v6(e,!0);return t!==1?ppt(e,i,t):Aw(i),i}function gpt(e){const t=new Float64Array(e.length*2);let i=0;for(const n of e)t[i++]=n[0],t[i++]=n[1];return t}const mpt=10;function ypt(e,t){let i;return e==null?i=t:typeof e=="object"?i={...e,coverage:t}:i={getHexagon:e,coverage:t},i}const vpt={...oh.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0};class gl extends To{initializeState(){gl._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:t}){return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}updateState({props:t,changeFlags:i}){if(t.highPrecision!==!0&&(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagon)){const n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let t=-1,i=!1,n=!1;const{iterable:r,objectInfo:s}=sl(this.props.data);for(const o of r){s.index++;const c=this.props.getHexagon(o,s),h=ev(c);if(t<0){if(t=h,!this.props.highPrecision)break}else if(t!==h){n=!0;break}if(rpt(c)){i=!0;break}}return{resolution:t,edgeLengthKM:t>=0?fpt(t,"km"):0,hasMultipleRes:n,hasPentagon:i}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:t,hasPentagon:i,hasMultipleRes:n}=this.state,{viewport:r}=this.context;return!!r?.resolution||n||i||t>=0&&t<=5}return this.props.highPrecision}_updateVertices(t){if(this._shouldUseHighPrecision())return;const{resolution:i,edgeLengthKM:n,centerHex:r}=this.state;if(i<0)return;const s=this.props.centerHexagon||dw(t.latitude,t.longitude,i);if(r===s)return;if(r)try{if(upt(r,s)*n<mpt)return}catch{}const{unitsPerMeter:o}=t.distanceScales;let c=b6(s);const[h,A]=pw(s),[_,C]=t.projectFlat([A,h]);c=c.map(S=>{const L=t.projectFlat(S);return[(L[0]-_)/o[0],(L[1]-C)/o[1]]}),this.setState({centerHex:s,vertices:c})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:t,material:i,coverage:n,extruded:r,wireframe:s,stroked:o,filled:c,lineWidthUnits:h,lineWidthScale:A,lineWidthMinPixels:_,lineWidthMaxPixels:C,getFillColor:S,getElevation:L,getLineColor:N,getLineWidth:U,transitions:H,updateTriggers:j}=this.props;return{elevationScale:t,extruded:r,coverage:n,wireframe:s,stroked:o,filled:c,lineWidthUnits:h,lineWidthScale:A,lineWidthMinPixels:_,lineWidthMaxPixels:C,material:i,getElevation:L,getFillColor:S,getLineColor:N,getLineWidth:U,transitions:H,updateTriggers:{getFillColor:j.getFillColor,getElevation:j.getElevation,getLineColor:j.getLineColor,getLineWidth:j.getLineWidth}}}_renderPolygonLayer(){const{data:t,getHexagon:i,updateTriggers:n,coverage:r}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",oh),o=this._getForwardProps();return o.updateTriggers.getPolygon=ypt(n.getHexagon,r),new s(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(c,h)=>{const A=i(c,h);return gpt(b6(A,r))}})}_renderColumnLayer(){const{data:t,getHexagon:i,updateTriggers:n}=this.props,r=this.getSubLayerClass("hexagon-cell",hl),s=this._getForwardProps();return s.updateTriggers.getPosition=n.getHexagon,new r(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:Apt.bind(null,i)})}}gl.defaultProps=vpt,gl.layerName="H3HexagonLayer",gl._checkH3Lib=()=>{};const _pt={getHexagons:{type:"accessor",value:e=>e.hexagons}};class iv extends sh{initializeState(){gl._checkH3Lib()}updateState({props:t,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&i.updateTriggersChanged.getHexagons){const{data:n,getHexagons:r}=t,s=[],{iterable:o,objectInfo:c}=sl(n);for(const h of o){c.index++;const A=r(h,c),_=cpt(A,!0);for(const C of _){for(const S of C)Aw(S);s.push(this.getSubLayerRow({polygon:C},h,c.index))}}this.setState({polygons:s})}}indexToBounds(){const{getElevation:t,getFillColor:i,getLineColor:n,getLineWidth:r}=this.props;return{data:this.state.polygons,getPolygon:s=>s.polygon,getElevation:this.getSubLayerAccessor(t),getFillColor:this.getSubLayerAccessor(i),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(r)}}}iv.layerName="H3ClusterLayer",iv.defaultProps=_pt;const gw=Math.PI/180,nv=new Float32Array(16),x6=new Float32Array(12);function w6(e,t,i){const n=t[0]*gw,r=t[1]*gw,s=t[2]*gw,o=Math.sin(s),c=Math.sin(n),h=Math.sin(r),A=Math.cos(s),_=Math.cos(n),C=Math.cos(r),S=i[0],L=i[1],N=i[2];e[0]=S*C*_,e[1]=S*h*_,e[2]=S*-c,e[3]=L*(-h*A+C*c*o),e[4]=L*(C*A+h*c*o),e[5]=L*_*o,e[6]=N*(h*o+C*c*A),e[7]=N*(-C*o+h*c*A),e[8]=N*_*A}function C6(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}const E6={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:i}){const{data:n,getOrientation:r,getScale:s,getTranslation:o,getTransformMatrix:c}=this.props,h=Array.isArray(c),A=h&&c.length===16,_=Array.isArray(s),C=Array.isArray(r),S=Array.isArray(o),L=A||!h&&!!c(n[0]);L?e.constant=A:e.constant=C&&_&&S;const N=e.value;if(e.constant){let U;L?(nv.set(c),U=C6(nv)):(U=x6,w6(U,r,s),U.set(o,9)),e.value=new Float32Array(U)}else{let U=t*e.size;const{iterable:H,objectInfo:j}=sl(n,t,i);for(const tt of H){j.index++;let K;if(L)nv.set(A?c:c(tt,j)),K=C6(nv);else{K=x6;const Q=C?r:r(tt,j),pt=_?s:s(tt,j);w6(K,Q,pt),K.set(S?o:o(tt,j),9)}N[U++]=K[0],N[U++]=K[1],N[U++]=K[2],N[U++]=K[3],N[U++]=K[4],N[U++]=K[5],N[U++]=K[6],N[U++]=K[7],N[U++]=K[8],N[U++]=K[9],N[U++]=K[10],N[U++]=K[11]}}}};function B6(e,t){return t===$i.CARTESIAN||t===$i.METER_OFFSETS||t===$i.DEFAULT&&!e.isGeospatial}const T6=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,bpt={name:"simpleMesh",vs:T6,fs:T6,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},xpt=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,wpt=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function Cpt(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function S6(e){let t=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,o=-1/0;const c=e.POSITION?e.POSITION.value:[],h=c&&c.length;for(let A=0;A<h;A+=3){const _=c[A],C=c[A+1],S=c[A+2];t=_<t?_:t,i=C<i?C:i,n=S<n?S:n,r=_>r?_:r,s=C>s?C:s,o=S>o?S:o}return[[t,i,n],[r,s,o]]}function Ept(e,t,i){const n=Cpt(t.value),r=i||Bpt(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:r}}function Bpt(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}function mw(e){const t=e.positions||e.POSITION;Zi.assert(t,'no "postions" or "POSITION" attribute in mesh');const i=t.value.length/t.size;let n=e.COLOR_0||e.colors;n||(n={size:3,value:new Float32Array(i*3).fill(1)});let r=e.NORMAL||e.normals;r||(r={size:3,value:new Float32Array(i*3).fill(0)});let s=e.TEXCOORD_0||e.texCoords;return s||(s={size:2,value:new Float32Array(i*2).fill(0)}),{positions:t,colors:n,normals:r,texCoords:s}}function I6(e){return e instanceof Yo?(e.attributes=mw(e.attributes),e):e.attributes?new Yo({...e,topology:"triangle-list",attributes:mw(e.attributes)}):new Yo({topology:"triangle-list",attributes:mw(e)})}const Tpt=[0,0,0,255],Spt={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:Tpt},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class Af extends Bo{getShaders(){return super.getShaders({vs:xpt,fs:wpt,modules:[Fo,$1,ua,bpt]})}getBounds(){if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;const{mesh:i}=this.props;if(!i)return null;if(t=i.header?.boundingBox,!t){const{attributes:n}=I6(i);n.POSITION=n.POSITION||n.positions,t=S6(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:E6}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);const{props:i,oldProps:n,changeFlags:r}=t;if(i.mesh!==n.mesh||r.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),i.mesh){this.state.model=this.getModel(i.mesh);const s=i.mesh.attributes||i.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}i.texture!==n.texture&&i.texture instanceof cr&&this.setTexture(i.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){const{model:i}=this.state;if(!i)return;const{viewport:n,renderPass:r}=this.context,{sizeScale:s,coordinateSystem:o,_instanced:c}=this.props,h={sizeScale:s,composeModelMatrix:!c||B6(n,o),flatShading:!this.state.hasNormals};i.shaderInputs.setProps({simpleMesh:h}),i.draw(r)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(t){const i=new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:I6(t),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:r}=this.state,s={sampler:n||r,hasTexture:!!n};return i.shaderInputs.setProps({simpleMesh:s}),i}setTexture(t){const{emptyTexture:i,model:n}=this.state;if(n){const r={sampler:t||i,hasTexture:!!t};n.shaderInputs.setProps({simpleMesh:r})}}}Af.defaultProps=Spt,Af.layerName="SimpleMeshLayer";var wc;(function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(wc||(wc={}));function M6(e,t,i,n){const r={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};r.defines.USE_TEX_LOD=1;const{imageBasedLightingEnvironment:s}=n;return s&&(r.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,r.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,r.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,r.uniforms.scaleIBLAmbient=[1,1]),n?.pbrDebug&&(r.defines.PBR_DEBUG=1,r.uniforms.scaleDiffBaseMR=[0,0,0,0],r.uniforms.scaleFGDSpec=[0,0,0,0]),i.NORMAL&&(r.defines.HAS_NORMALS=1),i.TANGENT&&n?.useTangents&&(r.defines.HAS_TANGENTS=1),i.TEXCOORD_0&&(r.defines.HAS_UV=1),n?.imageBasedLightingEnvironment&&(r.defines.USE_IBL=1),n?.lights&&(r.defines.USE_LIGHTS=1),t&&Ipt(e,t,r),r}function Ipt(e,t,i){if(i.uniforms.unlit=!!t.unlit,t.pbrMetallicRoughness&&Mpt(e,t.pbrMetallicRoughness,i),t.normalTexture){Vg(e,t.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",i);const{scale:n=1}=t.normalTexture;i.uniforms.normalScale=n}if(t.occlusionTexture){Vg(e,t.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",i);const{strength:n=1}=t.occlusionTexture;i.uniforms.occlusionStrength=n}switch(t.emissiveTexture&&(Vg(e,t.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",i),i.uniforms.emissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode){case"MASK":const{alphaCutoff:n=.5}=t;i.defines.ALPHA_CUTOFF=1,i.uniforms.alphaCutoff=n;break;case"BLEND":$e.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),i.parameters.blendColorOperation="add",i.parameters.blendColorSrcFactor="src-alpha",i.parameters.blendColorDstFactor="one-minus-src-alpha",i.parameters.blendAlphaOperation="add",i.parameters.blendAlphaSrcFactor="one",i.parameters.blendAlphaDstFactor="one-minus-src-alpha",i.glParameters.blend=!0,i.glParameters.blendEquation=wc.FUNC_ADD,i.glParameters.blendFunc=[wc.SRC_ALPHA,wc.ONE_MINUS_SRC_ALPHA,wc.ONE,wc.ONE_MINUS_SRC_ALPHA];break}}function Mpt(e,t,i){t.baseColorTexture&&Vg(e,t.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",i),i.uniforms.baseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&Vg(e,t.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",i);const{metallicFactor:n=1,roughnessFactor:r=1}=t;i.uniforms.metallicRoughnessValues=[n,r]}function Vg(e,t,i,n=null,r){const s=t?.texture?.sampler?.parameters||{},o=t.texture.source.image;let c,h={};o.compressed?(c=o,h={[wc.TEXTURE_MIN_FILTER]:o.data.length>1?wc.LINEAR_MIPMAP_NEAREST:wc.LINEAR}):c={data:o};const A=e.createTexture({id:t.uniformName||t.id,parameters:{...s,...h},pixelStore:{[wc.UNPACK_FLIP_Y_WEBGL]:!1},...c});r.bindings[i]=A,n&&(r.defines[n]=1),r.generatedTextures.push(A)}const Ppt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Rpt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class Dpt{name;startTime=0;playing=!0;speed=1;channels=[];constructor(t){Object.assign(this,t)}animate(t){if(!this.playing)return;const i=(t/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:r,path:s})=>{zpt(i,n,r,s),Fpt(r,r._node)})}}class Opt{animations;constructor(t){this.animations=t.animations.map((i,n)=>{const r=i.name||`Animation-${n}`,s=i.samplers.map(({input:c,interpolation:h="LINEAR",output:A})=>({input:P6(t.accessors[c]),interpolation:h,output:P6(t.accessors[A])})),o=i.channels.map(({sampler:c,target:h})=>({sampler:s[c],target:t.nodes[h.node],path:h.path}));return new Dpt({name:r,channels:o})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(i=>i.animate(t))}getAnimations(){return this.animations}}function P6(e){if(!e._animation){const t=Rpt[e.componentType],i=Ppt[e.type],n=i*e.count,{buffer:r,byteOffset:s}=e.bufferView.data,o=new t(r,s+(e.byteOffset||0),n);if(i===1)e._animation=Array.from(o);else{const c=[];for(let h=0;h<o.length;h+=i)c.push(Array.from(o.slice(h,h+i)));e._animation=c}}return e._animation}const Lpt=new yn;function Fpt(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){const i=Lpt.fromQuaternion(e.rotation);t.matrix.multiplyRight(i)}e.scale&&t.matrix.scale(e.scale)}const yw=new KA;function kpt(e,t,i,n,r){if(t==="rotation"){yw.slerp({start:i,target:n,ratio:r});for(let s=0;s<yw.length;s++)e[t][s]=yw[s]}else for(let s=0;s<i.length;s++)e[t][s]=r*n[s]+(1-r)*i[s]}function Npt(e,t,{p0:i,outTangent0:n,inTangent1:r,p1:s,tDiff:o,ratio:c}){for(let h=0;h<e[t].length;h++){const A=n[h]*o,_=r[h]*o;e[t][h]=(2*Math.pow(c,3)-3*Math.pow(c,2)+1)*i[h]+(Math.pow(c,3)-2*Math.pow(c,2)+c)*A+(-2*Math.pow(c,3)+3*Math.pow(c,2))*s[h]+(Math.pow(c,3)-Math.pow(c,2))*_}}function Upt(e,t,i){for(let n=0;n<i.length;n++)e[t][n]=i[n]}function zpt(e,{input:t,interpolation:i,output:n},r,s){const o=t[t.length-1],c=e%o,h=t.findIndex(S=>S>=c),A=Math.max(0,h-1);if(!Array.isArray(r[s]))switch(s){case"translation":r[s]=[0,0,0];break;case"rotation":r[s]=[0,0,0,1];break;case"scale":r[s]=[1,1,1];break;default:$e.warn(`Bad animation path ${s}`)()}const _=t[A],C=t[h];switch(i){case"STEP":Upt(r,s,n[A]);break;case"LINEAR":if(C>_){const S=(c-_)/(C-_);kpt(r,s,n[A],n[h],S)}break;case"CUBICSPLINE":if(C>_){const S=(c-_)/(C-_),L=C-_,N=n[3*A+1],U=n[3*A+2],H=n[3*h+0],j=n[3*h+1];Npt(r,s,{p0:N,outTangent0:U,inTangent1:H,p1:j,tDiff:L,ratio:S})}break;default:$e.warn(`Interpolation ${i} not supported`)();break}}const Gpt=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,jpt=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,Vpt=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function Hpt(e,t){const{id:i,geometry:n,material:r,vertexCount:s,materialOptions:o,modelOptions:c}=t,h=M6(e,r,n.attributes,o);$e.info(4,"createGLTFModel defines: ",h.defines)();const A=[],_={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},C={id:i,source:Gpt,vs:jpt,fs:Vpt,geometry:n,topology:n.topology,vertexCount:s,modules:[tb],...c,defines:{...h.defines,...c.defines},parameters:{..._,...h.parameters,...c.parameters}},S=new Lr(e,C),{camera:L,...N}={...h.uniforms,...c.uniforms,...h.bindings,...c.bindings};return S.shaderInputs.setProps({pbrMaterial:N,pbrProjection:{camera:L}}),new xb({managedResources:A,model:S})}var gf;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(gf||(gf={}));function Wpt(e){switch(e){case gf.POINTS:return"point-list";case gf.LINES:return"line-list";case gf.LINE_STRIP:return"line-strip";case gf.TRIANGLES:return"triangle-list";case gf.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(e))}}const Jpt={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class Xpt{device;options;gltf;constructor(t,i={}){this.device=t,this.options={...Jpt,...i}}instantiate(t){return this.gltf=vw(t),(this.gltf.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new Opt(this.gltf):null}createScene(t){const i=(t.nodes||[]).map(n=>this.createNode(n));return new nA({id:t.name||t.id,children:i})}createNode(t){if(!t._node){const n=(t.children||[]).map(s=>this.createNode(s));t.mesh&&n.push(this.createMesh(t.mesh));const r=new nA({id:t.name||t.id,children:n});if(t.matrix)r.setMatrix(t.matrix);else{if(r.matrix.identity(),t.translation&&r.matrix.translate(t.translation),t.rotation){const s=new yn().fromQuaternion(t.rotation);r.matrix.multiplyRight(s)}t.scale&&r.matrix.scale(t.scale)}t._node=r}const i=this.gltf.nodes.find(n=>n.id===t.id);return i._node=t._node,t._node}createMesh(t){if(!t._mesh){const i=(t.primitives||[]).map((r,s)=>this.createPrimitive(r,s,t)),n=new nA({id:t.name||t.id,children:i});t._mesh=n}return t._mesh}createPrimitive(t,i,n){const r=t.name||`${n.name||n.id}-primitive-${i}`,s=Wpt(t.mode||4),o=t.indices?t.indices.count:this.getVertexCount(t.attributes),c=Hpt(this.device,{id:r,geometry:this.createGeometry(r,t,s),material:t.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return c.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],c}getVertexCount(t){throw new Error("getVertexCount not implemented")}createGeometry(t,i,n){const r={};for(const[s,o]of Object.entries(i.attributes)){const{components:c,size:h,value:A}=o;r[s]={size:h??c,value:A}}return new Yo({id:t,topology:n,indices:i.indices.value,attributes:r})}createBuffer(t,i){t.bufferView||(t.bufferView={});const{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[i]||(n.lumaBuffers[i]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||t.value})),n.lumaBuffers[i]}createSampler(t){return t}needsPOT(){return!1}}function vw(e){if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof ImageBitmap)return e;if(Array.isArray(e))return e.map(vw);if(e&&typeof e=="object"){const t={};for(const i in e)t[i]=vw(e[i]);return t}return e}function Qpt(e,t,i){const n=new Xpt(e,i),r=n.instantiate(t),s=n.createAnimator();return{scenes:r,animator:s}}function pa(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const R6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},D6={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},O6=["SCALAR","VEC2","VEC3","VEC4"],Kpt=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],qpt=new Map(Kpt),Zpt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ypt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},$pt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function L6(e){return O6[e-1]||O6[0]}function rv(e){const t=qpt.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function _w(e,t){const i=$pt[e.componentType],n=Zpt[e.type],r=Ypt[e.componentType],s=e.count*n,o=e.count*n*r;pa(o>=0&&o<=t.byteLength);const c=D6[e.componentType],h=R6[e.type];return{ArrayType:i,length:s,byteLength:o,componentByteSize:c,numberOfComponentsInElement:h}}function tAt(e,t,i){const n=e.bufferViews[i];pa(n);const r=n.buffer,s=t[r];pa(s);const o=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,n.byteLength)}function eAt(e,t,i){const n=typeof i=="number"?e.accessors?.[i]:i;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const r=e.bufferViews?.[n.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:s,byteOffset:o}=t[r.buffer],c=(o||0)+(n.byteOffset||0)+(r.byteOffset||0),{ArrayType:h,length:A,componentByteSize:_,numberOfComponentsInElement:C}=_w(n,r),S=_*C,L=r.byteStride||S;if(typeof r.byteStride>"u"||r.byteStride===S)return new h(s,c,A);const N=new h(A);for(let U=0;U<n.count;U++){const H=new h(s,c+U*L,C);N.set(H,U*C)}return N}function iAt(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}let Uo=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||iAt(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof t=="string"||typeof i=="string"}getExtension(e){const t=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return t?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(t=>t===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if(typeof t=="object")return t;const i=this.json[e]&&this.json[e][t];if(!i)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);const t=e.buffer,i=this.gltf.buffers[t];pa(i);const n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return eAt(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,n=t.byteOffset||0;return new Uint8Array(i,n,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}setObjectExtension(e,t,i){const n=e.extensions||{};n[t]=i}removeObjectExtension(e,t){const i=e?.extensions||{};if(i[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const n=this.json.extensionsRemoved;n.includes(t)||n.push(t)}delete i[t]}addExtension(e,t={}){return pa(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return pa(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:i}=e;this.json.nodes=this.json.nodes||[];const n={mesh:t};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:i,material:n,mode:r=4}=e,s={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(i){const o=this._addIndices(i);s.primitives[0].indices=o}return Number.isFinite(n)&&(s.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const i=Uy(e),n=t||i?.mimeType,r={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e,t=0,i=this.byteLength){const n=e.byteLength;pa(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:t,byteOffset:i,byteLength:n};return this.byteLength+=tu(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const i={bufferView:e,type:L6(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const i=this.addBufferView(e);let n={min:t.min,max:t.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:rv(e),count:Math.round(e.length/t.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,i={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,t=new ArrayBuffer(e),i=new Uint8Array(t);let n=0;for(const r of this.sourceBuffers||[])n=wL(r,i,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let i=!0;for(;i;){const n=e.indexOf(t);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){const t={};for(const i in e){const n=e[i],r=this._getGltfAttributeName(i),s=this.addBinaryBuffer(n.value,n);t[r]=s}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];const n=e.subarray(0,t);for(const r of n)i.min.push(r),i.max.push(r);for(let r=t;r<e.length;r+=t)for(let s=0;s<t;s++)i.min[0+s]=Math.min(i.min[0+s],e[r+s]),i.max[0+s]=Math.max(i.max[0+s],e[r+s]);return i}};function F6(e){return(e%1+1)%1}const k6={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},nAt={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},N6={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function bw(e,t){return N6[t]*k6[e]}function ov(e,t,i,n){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),s=sv(r,"SCALAR",i,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function sv(e,t,i,n=1){const r=k6[t],s=nAt[i],o=N6[i],c=n*r,h=c*o;let A=e.buffer,_=e.byteOffset;return _%o!==0&&(A=new Uint8Array(A).slice(_,_+h).buffer,_=0),new s(A,_,c)}function xw(e,t,i){const n=`TEXCOORD_${t.texCoord||0}`,r=i.attributes[n],s=e.getTypedArrayForAccessor(r),o=e.gltf.json,c=t.index,h=o.textures?.[c]?.source;if(typeof h<"u"){const A=o.images?.[h]?.mimeType,_=e.gltf.images?.[h];if(_&&typeof _.width<"u"){const C=[];for(let S=0;S<s.length;S+=2){const L=rAt(_,A,s,S,t.channels);C.push(L)}return C}}return[]}function U6(e,t,i,n,r){if(!i?.length)return;const s=[];for(const _ of i){let C=n.findIndex(S=>S===_);C===-1&&(C=n.push(_)-1),s.push(C)}const o=new Uint32Array(s),c=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,h=e.addBufferView(o,c,0),A=e.addAccessor(h,{size:1,componentType:rv(o),count:o.length});r.attributes[t]=A}function rAt(e,t,i,n,r=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[n],c=i[n+1];let h=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(h=4);const A=oAt(o,c,e,h);let _=0;for(const C of r){const S=typeof C=="number"?Object.values(s)[C]:s[C],L=A+S.offset,N=Xx(e);if(N.data.length<=L)throw new Error(`${N.data.length} <= ${L}`);const U=N.data[L];_|=U<<S.shift}return _}function oAt(e,t,i,n=1){const r=i.width,s=F6(e)*(r-1),o=Math.round(s),c=i.height,h=F6(t)*(c-1),A=Math.round(h),_=i.components?i.components:n;return(A*r+o)*_}function z6(e,t,i,n,r){const s=[];for(let o=0;o<t;o++){const c=i[o],h=i[o+1]-i[o];if(h+c>n)break;const A=c/r,_=h/r;s.push(e.slice(A,A+_))}return s}function G6(e,t,i){const n=[];for(let r=0;r<t;r++){const s=r*i;n.push(e.slice(s,s+i))}return n}function j6(e,t,i,n){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],s=new TextDecoder("utf8");let o=0;for(let c=0;c<e;c++){const h=n[c+1]-n[c];if(h+o<=t.length){const A=t.subarray(o,h+o),_=s.decode(A);r.push(_),o+=h}}return r}return[]}const bp="EXT_mesh_features",sAt=bp;async function aAt(e,t){const i=new Uo(e);lAt(i,t)}function cAt(e,t){const i=new Uo(e);return hAt(i),i.createBinaryChunk(),i.gltf}function lAt(e,t){const i=e.gltf.json;if(i.meshes)for(const n of i.meshes)for(const r of n.primitives)uAt(e,r,t)}function uAt(e,t,i){if(!i?.gltf?.loadBuffers)return;const n=t.extensions?.[bp]?.featureIds;if(n)for(const r of n){let s;if(typeof r.attribute<"u"){const o=`_FEATURE_ID_${r.attribute}`,c=t.attributes[o];s=e.getTypedArrayForAccessor(c)}else typeof r.texture<"u"&&i?.gltf?.loadImages?s=xw(e,r.texture,t):s=[];r.data=s}}function hAt(e,t){const i=e.gltf.json.meshes;if(i)for(const n of i)for(const r of n.primitives)dAt(e,r)}function fAt(e,t,i,n){t.extensions||(t.extensions={});let r=t.extensions[bp];r||(r={featureIds:[]},t.extensions[bp]=r);const{featureIds:s}=r,o={featureCount:i.length,propertyTable:n,data:i};s.push(o),e.addObjectExtension(t,bp,r)}function dAt(e,t){const i=t.extensions?.[bp];if(!i)return;const n=i.featureIds;n.forEach((r,s)=>{if(r.data){const{accessorKey:o,index:c}=pAt(t.attributes),h=new Uint32Array(r.data);n[s]={featureCount:h.length,propertyTable:r.propertyTable,attribute:c},e.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const A=e.addBufferView(h),_=e.addAccessor(A,{size:1,componentType:rv(h),count:h.length});t.attributes[o]=_}})}function pAt(e){const t="_FEATURE_ID_",i=Object.keys(e).filter(r=>r.indexOf(t)===0);let n=-1;for(const r of i){const s=Number(r.substring(t.length));s>n&&(n=s)}return n++,{accessorKey:`${t}${n}`,index:n}}const AAt=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:fAt,decode:aAt,encode:cAt,name:sAt},Symbol.toStringTag,{value:"Module"})),xp="EXT_structural_metadata",gAt=xp;async function mAt(e,t){const i=new Uo(e);vAt(i,t)}function yAt(e,t){const i=new Uo(e);return LAt(i),i.createBinaryChunk(),i.gltf}function vAt(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(xp);i&&(t.gltf?.loadImages&&_At(e,i),bAt(e,i))}function _At(e,t){const i=t.propertyTextures,n=e.gltf.json;if(i&&n.meshes)for(const r of n.meshes)for(const s of r.primitives)wAt(e,i,s,t)}function bAt(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.propertyTables;if(n&&r)for(const s in n){const o=xAt(r,s);o&&EAt(e,i,o)}}function xAt(e,t){for(const i of e)if(i.class===t)return i;return null}function wAt(e,t,i,n){if(!t)return;const r=i.extensions?.[xp]?.propertyTextures;if(r)for(const s of r){const o=t[s];CAt(e,o,i,n)}}function CAt(e,t,i,n){if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const r=t.class;for(const s in t.properties){const o=`${r}_${s}`,c=t.properties?.[s];if(!c)continue;c.data||(c.data=[]);const h=c.data,A=xw(e,c,i);A!==null&&(U6(e,o,A,h,i),c.data=h,n.dataAttributeNames.push(o))}}function EAt(e,t,i){const n=t.classes?.[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const s in n.properties){const o=n.properties[s],c=i.properties?.[s];if(c){const h=BAt(e,t,o,r,c);c.data=h}}}function BAt(e,t,i,n,r){let s=[];const o=r.values,c=e.getTypedArrayForBufferView(o),h=TAt(e,i,r,n),A=SAt(e,r,n);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=IAt(i,n,c,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{s=j6(n,c,h,A);break}case"ENUM":{s=MAt(t,i,n,c,h);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function TAt(e,t,i,n){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?ov(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",n):null}function SAt(e,t,i){return typeof t.stringOffsets<"u"?ov(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}function IAt(e,t,i,n){const r=e.array,s=e.count,o=bw(e.type,e.componentType),c=i.byteLength/o;let h;return e.componentType?h=sv(i,e.type,e.componentType,c):h=i,r?n?z6(h,t,n,i.length,o):s?G6(h,t,s):[]:h}function MAt(e,t,i,n,r){const s=t.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=e.enums?.[s];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const c=o.valueType||"UINT16",h=bw(t.type,c),A=n.byteLength/h;let _=sv(n,t.type,c,A);if(_||(_=n),t.array){if(r)return PAt({valuesData:_,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:h,enumEntry:o});const C=t.count;return C?RAt(_,i,C,o):[]}return ww(_,0,i,o)}function PAt(e){const{valuesData:t,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r,elementSize:s,enumEntry:o}=e,c=[];for(let h=0;h<i;h++){const A=n[h],_=n[h+1]-n[h];if(_+A>r)break;const C=A/s,S=_/s,L=ww(t,C,S,o);c.push(L)}return c}function RAt(e,t,i,n){const r=[];for(let s=0;s<t;s++){const o=i*s,c=ww(e,o,i,n);r.push(c)}return r}function ww(e,t,i,n){const r=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+s],c=DAt(n,o);c?r.push(c.name):r.push("")}return r}function DAt(e,t){for(const i of e.values)if(i.value===t)return i;return null}const OAt="schemaClassId";function LAt(e,t){const i=e.getExtension(xp);if(i&&i.propertyTables)for(const n of i.propertyTables){const r=n.class,s=i.schema?.classes?.[r];n.properties&&s&&FAt(n,s,e)}}function FAt(e,t,i){for(const n in e.properties){const r=e.properties[n].data;if(r){const s=t.properties[n];if(s){const o=zAt(r,s,i);e.properties[n]=o}}}}function kAt(e,t,i=OAt){let n=e.getExtension(xp);n||(n=e.addExtension(xp)),n.schema=NAt(t,i,n.schema);const r=UAt(t,i,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(r)-1}function NAt(e,t,i){const n=i??{id:"schema_id"},r={properties:{}};for(const s of e){const o={type:s.elementType,componentType:s.componentType};r.properties[s.name]=o}return n.classes={},n.classes[t]=r,n}function UAt(e,t,i){const n={class:t,count:0};let r=0;const s=i.classes?.[t];for(const o of e){if(r===0&&(r=o.values.length),r!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");s?.properties[o.name]&&(n.properties||(n.properties={}),n.properties[o.name]={values:0,data:o.values})}return n.count=r,n}function zAt(e,t,i){const n={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:s}=VAt(e);n.stringOffsets=Cw(s,i),n.values=Cw(r,i)}else if(t.type==="SCALAR"&&t.componentType){const r=jAt(e,t.componentType);n.values=Cw(r,i)}return n}const GAt={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function jAt(e,t){const i=[];for(const r of e)i.push(Number(r));const n=GAt[t];if(!n)throw new Error("Illegal component type");return new n(i)}function VAt(e){const t=new TextEncoder,i=[];let n=0;for(const h of e){const A=t.encode(h);n+=A.length,i.push(A)}const r=new Uint8Array(n),s=[];let o=0;for(const h of i)r.set(h,o),s.push(o),o+=h.length;s.push(o);const c=new Uint32Array(s);return{stringData:r,stringOffsets:c}}function Cw(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const HAt=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:kAt,decode:mAt,encode:yAt,name:gAt},Symbol.toStringTag,{value:"Module"})),V6="EXT_feature_metadata",WAt=V6;async function JAt(e,t){const i=new Uo(e);XAt(i,t)}function XAt(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(V6);i&&(t.gltf?.loadImages&&QAt(e,i),KAt(e,i))}function QAt(e,t){const i=t.schema;if(!i)return;const n=i.classes,{featureTextures:r}=t;if(n&&r)for(const s in n){const o=n[s],c=ZAt(r,s);c&&$At(e,c,o)}}function KAt(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.featureTables;if(n&&r)for(const s in n){const o=qAt(r,s);o&&YAt(e,i,o)}}function qAt(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function ZAt(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function YAt(e,t,i){if(!i.class)return;const n=t.classes?.[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const s in n.properties){const o=n.properties[s],c=i.properties?.[s];if(c){const h=tgt(e,t,o,r,c);c.data=h}}}function $At(e,t,i){const n=t.class;for(const r in i.properties){const s=t?.properties?.[r];if(s){const o=ogt(e,s,n);s.data=o}}}function tgt(e,t,i,n,r){let s=[];const o=r.bufferView,c=e.getTypedArrayForBufferView(o),h=egt(e,i,r,n),A=igt(e,i,r,n);return i.type==="STRING"||i.componentType==="STRING"?s=j6(n,c,h,A):ngt(i)&&(s=rgt(i,n,c,h)),s}function egt(e,t,i,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?ov(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",n):null}function igt(e,t,i,n){return typeof i.stringOffsetBufferView<"u"?ov(e,i.stringOffsetBufferView,i.offsetType||"UINT32",n):null}function ngt(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function rgt(e,t,i,n){const r=e.type==="ARRAY",s=e.componentCount,o="SCALAR",c=e.componentType||e.type,h=bw(o,c),A=i.byteLength/h,_=sv(i,o,c,A);return r?n?z6(_,t,n,i.length,h):s?G6(_,t,s):[]:_}function ogt(e,t,i){const n=e.gltf.json;if(!n.meshes)return[];const r=[];for(const s of n.meshes)for(const o of s.primitives)sgt(e,i,t,r,o);return r}function sgt(e,t,i,n,r){const s={channels:i.channels,...i.texture},o=xw(e,s,r);o&&U6(e,t,o,n,r)}const agt=Object.freeze(Object.defineProperty({__proto__:null,decode:JAt,name:WAt},Symbol.toStringTag,{value:"Module"})),cgt="4.3.1",lgt="4.3.1",av={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let H6;async function W6(e){return jut(e.modules),Vut("basis")||(H6||=ugt(e),await H6)}async function ugt(e){let t=null,i=null;return[t,i]=await Promise.all([await df(av.TRANSCODER,"textures",e),await df(av.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await hgt(t,i)}function hgt(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,initializeBasis:o}=r;o(),n({BasisFile:s})})})}let Ew;async function J6(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(Ew=Ew||fgt(e),await Ew)}async function fgt(e){let t=null,i=null;return[t,i]=await Promise.all([await df(av.ENCODER,"textures",e),await df(av.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await dgt(t,i)}function dgt(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e(i).then(r=>{const{BasisFile:s,KTX2File:o,initializeBasis:c,BasisEncoder:h}=r;c(),n({BasisFile:s,KTX2File:o,BasisEncoder:h})})})}const wp={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},pgt=["","WEBKIT_","MOZ_"],X6={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let cv=null;function Agt(e){if(!cv){e=e||ggt()||void 0,cv=new Set;for(const t of pgt)for(const i in X6)if(e&&e.getExtension(`${t}${i}`)){const n=X6[i];cv.add(n)}}return cv}function ggt(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Aa=[171,75,84,88,32,50,48,187,13,10,26,10];function mgt(e){const t=new Uint8Array(e);return!(t.byteLength<Aa.length||t[0]!==Aa[0]||t[1]!==Aa[1]||t[2]!==Aa[2]||t[3]!==Aa[3]||t[4]!==Aa[4]||t[5]!==Aa[5]||t[6]!==Aa[6]||t[7]!==Aa[7]||t[8]!==Aa[8]||t[9]!==Aa[9]||t[10]!==Aa[10]||t[11]!==Aa[11])}const ygt={etc1:{basisFormat:0,compressed:!0,format:wp.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:wp.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:wp.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:wp.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:wp.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:wp.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function vgt(e,t){if(t.basis.containerFormat==="auto"){if(mgt(e)){const n=await J6(t);return Q6(n.KTX2File,e,t)}const{BasisFile:i}=await W6(t);return Bw(i,e,t)}switch(t.basis.module){case"encoder":const i=await J6(t);switch(t.basis.containerFormat){case"ktx2":return Q6(i.KTX2File,e,t);case"basis":default:return Bw(i.BasisFile,e,t)}case"transcoder":default:const{BasisFile:n}=await W6(t);return Bw(n,e,t)}}function Bw(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");const r=n.getNumImages(),s=[];for(let o=0;o<r;o++){const c=n.getNumLevels(o),h=[];for(let A=0;A<c;A++)h.push(_gt(n,o,A,i));s.push(h)}return s}finally{n.close(),n.delete()}}function _gt(e,t,i,n){const r=e.getImageWidth(t,i),s=e.getImageHeight(t,i),o=e.getHasAlpha(),{compressed:c,format:h,basisFormat:A}=K6(n,o),_=e.getImageTranscodedSizeInBytes(t,i,A),C=new Uint8Array(_);if(!e.transcodeImage(C,t,i,A,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:s,data:C,compressed:c,format:h,hasAlpha:o}}function Q6(e,t,i){const n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=n.getLevels(),s=[];for(let o=0;o<r;o++)s.push(bgt(n,o,i));return[s]}finally{n.close(),n.delete()}}function bgt(e,t,i){const{alphaFlag:n,height:r,width:s}=e.getImageLevelInfo(t,0,0),{compressed:o,format:c,basisFormat:h}=K6(i,n),A=e.getImageTranscodedSizeInBytes(t,0,0,h),_=new Uint8Array(A);if(!e.transcodeImage(_,t,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:r,data:_,compressed:o,levelSize:A,hasAlpha:n,format:c}}function K6(e,t){let i=e&&e.basis&&e.basis.format;return i==="auto"&&(i=Tw()),typeof i=="object"&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),ygt[i]}function Tw(){const e=Agt();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const xgt={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:lgt,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},q6={...xgt,parse:vgt},Cp=!0,Z6=1735152710,Sw=12,lv=8,wgt=1313821514,Cgt=5130562,Egt=0,Bgt=0,Tgt=1;function Sgt(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function Igt(e,t=0,i={}){const n=new DataView(e),{magic:r=Z6}=i,s=n.getUint32(t,!1);return s===r||s===Z6}function Mgt(e,t,i=0,n={}){const r=new DataView(t),s=Sgt(r,i+0),o=r.getUint32(i+4,Cp),c=r.getUint32(i+8,Cp);switch(Object.assign(e,{header:{byteOffset:i,byteLength:c,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=Sw,e.version){case 1:return Pgt(e,r,i);case 2:return Rgt(e,r,i,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function Pgt(e,t,i){mr(e.header.byteLength>Sw+lv);const n=t.getUint32(i+0,Cp),r=t.getUint32(i+4,Cp);return i+=lv,mr(r===Egt),Iw(e,t,i,n),i+=n,i+=Mw(e,t,i,e.header.byteLength),i}function Rgt(e,t,i,n){return mr(e.header.byteLength>Sw+lv),Dgt(e,t,i,n),i+e.header.byteLength}function Dgt(e,t,i,n){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,Cp),s=t.getUint32(i+4,Cp);switch(i+=lv,s){case wgt:Iw(e,t,i,r);break;case Cgt:Mw(e,t,i,r);break;case Bgt:n.strict||Iw(e,t,i,r);break;case Tgt:n.strict||Mw(e,t,i,r);break}i+=tu(r,4)}return i}function Iw(e,t,i,n){const r=new Uint8Array(t.buffer,i,n),s=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(s),tu(n,4)}function Mw(e,t,i,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:t.buffer}),tu(n,4)}function Y6(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}const Ogt="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Lgt="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Fgt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),kgt=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ngt={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Ugt={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function zgt(e,t,i,n,r,s="NONE"){const o=await Ggt();Hgt(o,o.exports[Ugt[r]],e,t,i,n,o.exports[Ngt[s||"NONE"]])}let Pw;async function Ggt(){return Pw||(Pw=jgt()),Pw}async function jgt(){let e=Ogt;WebAssembly.validate(Fgt)&&(e=Lgt,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(Vgt(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function Vgt(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?kgt[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}function Hgt(e,t,i,n,r,s,o){const c=e.exports.sbrk,h=n+3&-4,A=c(h*r),_=c(s.length),C=new Uint8Array(e.exports.memory.buffer);C.set(s,_);const S=t(A,n,r,_,s.length);if(S===0&&o&&o(A,h,r),i.set(C.subarray(A,A+n*r)),c(A-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const uv="EXT_meshopt_compression",Wgt=uv;async function Jgt(e,t){const i=new Uo(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const n=[];for(const r of e.json.bufferViews||[])n.push(Xgt(i,r));await Promise.all(n),i.removeExtension(uv)}async function Xgt(e,t){const i=e.getObjectExtension(t,uv);if(i){const{byteOffset:n=0,byteLength:r=0,byteStride:s,count:o,mode:c,filter:h="NONE",buffer:A}=i,_=e.gltf.buffers[A],C=new Uint8Array(_.arrayBuffer,_.byteOffset+n,r),S=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await zgt(S,o,s,C,c,h),e.removeObjectExtension(t,uv)}}const Qgt=Object.freeze(Object.defineProperty({__proto__:null,decode:Jgt,name:Wgt},Symbol.toStringTag,{value:"Module"})),Ep="EXT_texture_webp",Kgt=Ep;function qgt(e,t){const i=new Uo(e);if(!OL("image/webp")){if(i.getRequiredExtensions().includes(Ep))throw new Error(`gltf: Required extension ${Ep} not supported by browser`);return}const{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,Ep);s&&(r.source=s.source),i.removeObjectExtension(r,Ep)}i.removeExtension(Ep)}const Zgt=Object.freeze(Object.defineProperty({__proto__:null,name:Kgt,preprocess:qgt},Symbol.toStringTag,{value:"Module"})),hv="KHR_texture_basisu",Ygt=hv;function $gt(e,t){const i=new Uo(e),{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,hv);s&&(r.source=s.source,i.removeObjectExtension(r,hv))}i.removeExtension(hv)}const tmt=Object.freeze(Object.defineProperty({__proto__:null,name:Ygt,preprocess:$gt},Symbol.toStringTag,{value:"Module"})),emt="4.3.1",imt={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:emt,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function nmt(e,t,i){const n=tF(t.metadata),r=[],s=rmt(t.attributes);for(const o in e){const c=e[o],h=$6(o,c,s[o]);r.push(h)}if(i){const o=$6("indices",i);r.push(o)}return{fields:r,metadata:n}}function rmt(e){const t={};for(const i in e){const n=e[i];t[n.name||"undefined"]=n}return t}function $6(e,t,i){const n=i?tF(i.metadata):void 0;return Ept(e,t,n)}function tF(e){Object.entries(e);const t={};for(const i in e)t[`${i}.string`]=JSON.stringify(e[i]);return t}const eF={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},omt={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},smt=4;class amt{draco;decoder;metadataQuerier;constructor(t){this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,i={}){const n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(i);const r=this.decoder.GetEncodedGeometryType(n),s=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(n,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(n,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){const C=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(C)}const c=this._getDracoLoaderData(s,r,i),h=this._getMeshData(s,c,i),A=S6(h.attributes),_=nmt(h.attributes,c,h.indices);return{loader:"draco",loaderData:c,header:{vertexCount:s.num_points(),boundingBox:A},...h,schema:_}}finally{this.draco.destroy(n),s&&this.draco.destroy(s)}}_getDracoLoaderData(t,i,n){const r=this._getTopLevelMetadata(t),s=this._getDracoAttributes(t,n);return{geometry_type:i,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:s}}_getDracoAttributes(t,i){const n={};for(let r=0;r<t.num_attributes();r++){const s=this.decoder.GetAttribute(t,r),o=this._getAttributeMetadata(t,r);n[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:r,metadata:o};const c=this._getQuantizationTransform(s,i);c&&(n[s.unique_id()].quantization_transform=c);const h=this._getOctahedronTransform(s,i);h&&(n[s.unique_id()].octahedron_transform=h)}return n}_getMeshData(t,i,n){const r=this._getMeshAttributes(i,t,n);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,i,n){const r={};for(const s of Object.values(t.attributes)){const o=this._deduceAttributeName(s,n);s.name=o;const c=this._getAttributeValues(i,s);if(c){const{value:h,size:A}=c;r[o]={value:h,size:A,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return r}_getTriangleListIndices(t){const i=t.num_faces()*3,n=i*smt,r=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(t,n,r),new Uint32Array(this.draco.HEAPF32.buffer,r,i).slice()}finally{this.draco._free(r)}}_getTriangleStripIndices(t){const i=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,i),umt(i)}finally{this.draco.destroy(i)}}_getAttributeValues(t,i){const n=omt[i.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${i.data_type}`),null;const r=i.num_components,s=t.num_points()*r,o=s*n.BYTES_PER_ELEMENT,c=cmt(this.draco,n);let h;const A=this.draco._malloc(o);try{const _=this.decoder.GetAttribute(t,i.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,_,c,o,A),h=new n(this.draco.HEAPF32.buffer,A,s).slice()}finally{this.draco._free(A)}return{value:h,size:r}}_deduceAttributeName(t,i){const n=t.unique_id;for(const[o,c]of Object.entries(i.extraAttributes||{}))if(c===n)return o;const r=t.attribute_type;for(const o in eF)if(this.draco[o]===r)return eF[o];const s=i.attributeNameEntry||"name";return t.metadata[s]?t.metadata[s].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(t){const i=this.decoder.GetMetadata(t);return this._getDracoMetadata(i)}_getAttributeMetadata(t,i){const n=this.decoder.GetAttributeMetadata(t,i);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const i={},n=this.metadataQuerier.NumEntries(t);for(let r=0;r<n;r++){const s=this.metadataQuerier.GetEntryName(t,r);i[s]=this._getDracoMetadataField(t,s)}return i}_getDracoMetadataField(t,i){const n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,i,n);const r=lmt(n);return{int:this.metadataQuerier.GetIntEntry(t,i),string:this.metadataQuerier.GetStringEntry(t,i),double:this.metadataQuerier.GetDoubleEntry(t,i),intArray:r}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){const{quantizedAttributes:i=[],octahedronAttributes:n=[]}=t,r=[...i,...n];for(const s of r)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(t,i){const{quantizedAttributes:n=[]}=i,r=t.attribute_type();if(n.map(s=>this.decoder[s]).includes(r)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits(),range:s.range(),min_values:new Float32Array([1,2,3]).map(o=>s.min_value(o))}}finally{this.draco.destroy(s)}}return null}_getOctahedronTransform(t,i){const{octahedronAttributes:n=[]}=i,r=t.attribute_type();if(n.map(s=>this.decoder[s]).includes(r)){const s=new this.draco.AttributeQuantizationTransform;try{if(s.InitFromAttribute(t))return{quantization_bits:s.quantization_bits()}}finally{this.draco.destroy(s)}}return null}}function cmt(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function lmt(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}function umt(e){const t=e.size(),i=new Int32Array(t);for(let n=0;n<t;n++)i[n]=e.GetValue(n);return i}const hmt="1.5.6",fmt="1.4.1",Rw=`https://www.gstatic.com/draco/versioned/decoders/${hmt}`,Gs={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Dw={[Gs.DECODER]:`${Rw}/${Gs.DECODER}`,[Gs.DECODER_WASM]:`${Rw}/${Gs.DECODER_WASM}`,[Gs.FALLBACK_DECODER]:`${Rw}/${Gs.FALLBACK_DECODER}`,[Gs.ENCODER]:`https://raw.githubusercontent.com/google/draco/${fmt}/javascript/${Gs.ENCODER}`};let Ow;async function dmt(e){const t=e.modules||{};return t.draco3d?Ow||=t.draco3d.createDecoderModule({}).then(i=>({draco:i})):Ow||=pmt(e),await Ow}async function pmt(e){let t,i;switch(e.draco&&e.draco.decoderType){case"js":t=await df(Dw[Gs.FALLBACK_DECODER],"draco",e,Gs.FALLBACK_DECODER);break;case"wasm":default:[t,i]=await Promise.all([await df(Dw[Gs.DECODER],"draco",e,Gs.DECODER),await df(Dw[Gs.DECODER_WASM],"draco",e,Gs.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await Amt(t,i)}function Amt(e,t){const i={};return t&&(i.wasmBinary=t),new Promise(n=>{e({...i,onModuleLoaded:r=>n({draco:r})})})}const Lw={...imt,parse:gmt};async function gmt(e,t){const{draco:i}=await dmt(t),n=new amt(i);try{return n.parseSync(e,t?.draco)}finally{n.destroy()}}function mmt(e){const t={};for(const i in e){const n=e[i];if(i!=="indices"){const r=iF(n);t[i]=r}}return t}function iF(e){const{buffer:t,size:i,count:n}=ymt(e);return{value:t,size:i,byteOffset:0,count:n,type:L6(i),componentType:rv(t)}}function ymt(e){let t=e,i=1,n=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=vmt(t,Float32Array)),n=t.length/i),{buffer:t,size:i,count:n}}function vmt(e,t,i=!1){return e?Array.isArray(e)?new t(e):i&&!(e instanceof t)?new t(e):e:null}const lh="KHR_draco_mesh_compression",_mt=lh;function bmt(e,t,i){const n=new Uo(e);for(const r of nF(n))n.getObjectExtension(r,lh)}async function xmt(e,t,i){if(!t?.gltf?.decompressMeshes)return;const n=new Uo(e),r=[];for(const s of nF(n))n.getObjectExtension(s,lh)&&r.push(Cmt(n,s,t,i));await Promise.all(r),n.removeExtension(lh)}function wmt(e,t={}){const i=new Uo(e);for(const n of i.json.meshes||[])Emt(n),i.addRequiredExtension(lh)}async function Cmt(e,t,i,n){const r=e.getObjectExtension(t,lh);if(!r)return;const s=e.getTypedArrayForBufferView(r.bufferView),o=Fg(s.buffer,s.byteOffset),c={...i};delete c["3d-tiles"];const h=await ff(o,Lw,c,n),A=mmt(h.attributes);for(const[_,C]of Object.entries(A))if(_ in t.attributes){const S=t.attributes[_],L=e.getAccessor(S);L?.min&&L?.max&&(C.min=L.min,C.max=L.max)}t.attributes=A,h.indices&&(t.indices=iF(h.indices)),e.removeObjectExtension(t,lh),Bmt(t)}function Emt(e,t,i=4,n,r){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=n.DracoWriter.encodeSync({attributes:e}),o=r?.parseSync?.({attributes:e}),c=n._addFauxAttributes(o.attributes),h=n.addBufferView(s);return{primitives:[{attributes:c,mode:i,extensions:{[lh]:{bufferView:h,attributes:c}}}]}}function Bmt(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*nF(e){for(const t of e.json.meshes||[])for(const i of t.primitives)yield i}const Tmt=Object.freeze(Object.defineProperty({__proto__:null,decode:xmt,encode:wmt,name:_mt,preprocess:bmt},Symbol.toStringTag,{value:"Module"})),fv="KHR_texture_transform",Smt=fv,dv=new fe,Imt=new gr,Mmt=new gr;async function Pmt(e,t){if(!new Uo(e).hasExtension(fv)||!t.gltf?.loadBuffers)return;const i=e.json.materials||[];for(let n=0;n<i.length;n++)Rmt(n,e)}function Rmt(e,t){const i=t.json.materials?.[e],n=[i?.pbrMetallicRoughness?.baseColorTexture,i?.emissiveTexture,i?.normalTexture,i?.occlusionTexture,i?.pbrMetallicRoughness?.metallicRoughnessTexture],r=[];for(const s of n)s&&s?.extensions?.[fv]&&Dmt(t,e,s,r)}function Dmt(e,t,i,n){const r=Omt(i,n);if(!r)return;const s=e.json.meshes||[];for(const o of s)for(const c of o.primitives){const h=c.material;Number.isFinite(h)&&t===h&&Lmt(e,c,r)}}function Omt(e,t){const i=e.extensions?.[fv],{texCoord:n=0}=e,{texCoord:r=n}=i;if(t.findIndex(([s,o])=>s===n&&o===r)===-1){const s=Nmt(i);return n!==r&&(e.texCoord=r),t.push([n,r]),{originalTexCoord:n,texCoord:r,matrix:s}}return null}function Lmt(e,t,i){const{originalTexCoord:n,texCoord:r,matrix:s}=i,o=t.attributes[`TEXCOORD_${n}`];if(Number.isFinite(o)){const c=e.json.accessors?.[o];if(c&&c.bufferView){const h=e.json.bufferViews?.[c.bufferView];if(h){const{arrayBuffer:A,byteOffset:_}=e.buffers[h.buffer],C=(_||0)+(c.byteOffset||0)+(h.byteOffset||0),{ArrayType:S,length:L}=_w(c,h),N=D6[c.componentType],U=R6[c.type],H=h.byteStride||N*U,j=new Float32Array(L);for(let tt=0;tt<c.count;tt++){const K=new S(A,C+tt*H,2);dv.set(K[0],K[1],1),dv.transformByMatrix3(s),j.set([dv[0],dv[1]],tt*U)}n===r?Fmt(c,h,e.buffers,j):kmt(r,c,t,e,j)}}}}function Fmt(e,t,i,n){e.componentType=5126,i.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function kmt(e,t,i,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=n.json.accessors;o&&(o.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}function Nmt(e){const{offset:t=[0,0],rotation:i=0,scale:n=[1,1]}=e,r=new gr().set(1,0,0,0,1,0,t[0],t[1],1),s=Imt.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=Mmt.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}const Umt=Object.freeze(Object.defineProperty({__proto__:null,decode:Pmt,name:Smt},Symbol.toStringTag,{value:"Module"})),mf="KHR_lights_punctual",zmt=mf;async function Gmt(e){const t=new Uo(e),{json:i}=t,n=t.getExtension(mf);n&&(t.json.lights=n.lights,t.removeExtension(mf));for(const r of i.nodes||[]){const s=t.getObjectExtension(r,mf);s&&(r.light=s.light),t.removeObjectExtension(r,mf)}}async function jmt(e){const t=new Uo(e),{json:i}=t;if(i.lights){const n=t.addExtension(mf);pa(!n.lights),n.lights=i.lights,delete i.lights}if(t.json.lights){for(const n of t.json.lights){const r=n.node;t.addObjectExtension(r,mf,n)}delete t.json.lights}}const Vmt=Object.freeze(Object.defineProperty({__proto__:null,decode:Gmt,encode:jmt,name:zmt},Symbol.toStringTag,{value:"Module"})),Hg="KHR_materials_unlit",Hmt=Hg;async function Wmt(e){const t=new Uo(e),{json:i}=t;for(const n of i.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,Hg);t.removeExtension(Hg)}function Jmt(e){const t=new Uo(e),{json:i}=t;if(t.materials)for(const n of i.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,Hg,{}),t.addExtension(Hg))}const Xmt=Object.freeze(Object.defineProperty({__proto__:null,decode:Wmt,encode:Jmt,name:Hmt},Symbol.toStringTag,{value:"Module"})),Wg="KHR_techniques_webgl",Qmt=Wg;async function Kmt(e){const t=new Uo(e),{json:i}=t,n=t.getExtension(Wg);if(n){const r=Zmt(n,t);for(const s of i.materials||[]){const o=t.getObjectExtension(s,Wg);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=Ymt(s.technique,t)),t.removeObjectExtension(s,Wg)}t.removeExtension(Wg)}}async function qmt(e,t){}function Zmt(e,t){const{programs:i=[],shaders:n=[],techniques:r=[]}=e,s=new TextDecoder;return n.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(o=>{o.fragmentShader=n[o.fragmentShader],o.vertexShader=n[o.vertexShader]}),r.forEach(o=>{o.program=i[o.program]}),r}function Ymt(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in i)&&(i[n]=e.uniforms[n].value)}),Object.keys(i).forEach(n=>{typeof i[n]=="object"&&i[n].index!==void 0&&(i[n].texture=t.getTexture(i[n].index))}),i}const $mt=Object.freeze(Object.defineProperty({__proto__:null,decode:Kmt,encode:qmt,name:Qmt},Symbol.toStringTag,{value:"Module"})),rF=[HAt,AAt,Qgt,Zgt,tmt,Tmt,Vmt,Xmt,$mt,Umt,agt];function t0t(e,t={},i){const n=rF.filter(r=>oF(r.name,t));for(const r of n)r.preprocess?.(e,t,i)}async function e0t(e,t={},i){const n=rF.filter(r=>oF(r.name,t));for(const r of n)await r.decode?.(e,t,i)}function oF(e,t){const i=t?.gltf?.excludeExtensions||{};return!(e in i&&!i[e])}const Fw="KHR_binary_glTF";function i0t(e){const t=new Uo(e),{json:i}=t;for(const n of i.images||[]){const r=t.getObjectExtension(n,Fw);r&&Object.assign(n,r),t.removeObjectExtension(n,Fw)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(Fw)}const sF={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},n0t={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};let r0t=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,t){this.json=e.json;const i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),i0t(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in sF)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const i=e[t];if(!(!i||Array.isArray(i))){e[t]=[];for(const n in i){const r=i[n];r.id=r.id||n;const s=e[t].length;e[t].push(r),this.idToIndexMap[t][n]=s}}}_convertObjectIdsToArrayIndices(e){for(const t in sF)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:i,indices:n,material:r}=t;for(const s in i)i[s]=this._convertIdToIndex(i[s],"accessor");n&&(t.indices=this._convertIdToIndex(n,"accessor")),r&&(t.material=this._convertIdToIndex(r,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(t=>this._convertIdToIndex(t,"node"))),e.meshes&&(e.meshes=e.meshes.map(t=>this._convertIdToIndex(t,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(t=>this._convertIdToIndex(t,"node")))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const i of e[t])for(const n in i){const r=i[n],s=this._convertIdToIndex(r,n);i[n]=s}}_convertIdToIndex(e,t){const i=n0t[t];if(i in this.idToIndexMap){const n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return n}return e}_updateObjects(e){for(const t of this.json.buffers)delete t.type}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const i=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,n=e.textures.findIndex(r=>r.id===i);n!==-1&&(t.pbrMetallicRoughness.baseColorTexture={index:n})}}};function o0t(e,t={}){return new r0t().normalize(e,t)}async function s0t(e,t,i=0,n,r){return a0t(e,t,i,n),o0t(e,{normalize:n?.gltf?.normalize}),t0t(e,n,r),n?.gltf?.loadBuffers&&e.json.buffers&&await c0t(e,n,r),n?.gltf?.loadImages&&await l0t(e,n,r),await e0t(e,n,r),e}function a0t(e,t,i,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!Igt(t,i,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=xL(t);else if(t instanceof ArrayBuffer){const o={};i=Mgt(o,t,i,n.glb),pa(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else pa(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function c0t(e,t,i){const n=e.json.buffers||[];for(let r=0;r<n.length;++r){const s=n[r];if(s.uri){const{fetch:o}=i;pa(o);const c=Y6(s.uri,t),h=await(await i?.fetch?.(c))?.arrayBuffer?.();e.buffers[r]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete s.uri}else e.buffers[r]===null&&(e.buffers[r]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function l0t(e,t,i){const n=u0t(e),r=e.json.images||[],s=[];for(const o of n)s.push(h0t(e,r[o],o,t,i));return await Promise.all(s)}function u0t(e){const t=new Set,i=e.json.textures||[];for(const n of i)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function h0t(e,t,i,n,r){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const c=Y6(t.uri,n),{fetch:h}=r;s=await(await h(c)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const c=tAt(e.json,e.buffers,t.bufferView);s=Fg(c.buffer,c.byteOffset,c.byteLength)}pa(s,"glTF image has no data");let o=await ff(s,[zy,q6],{...n,mimeType:t.mimeType,basis:n.basis||{format:Tw()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}const kw={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:cgt,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:f0t,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function f0t(e,t={},i){t={...kw.options,...t},t.gltf={...kw.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await s0t({},e,n,t,i)}const d0t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},p0t={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ka={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},A0t={magFilter:ka.TEXTURE_MAG_FILTER,minFilter:ka.TEXTURE_MIN_FILTER,wrapS:ka.TEXTURE_WRAP_S,wrapT:ka.TEXTURE_WRAP_T},g0t={[ka.TEXTURE_MAG_FILTER]:ka.LINEAR,[ka.TEXTURE_MIN_FILTER]:ka.NEAREST_MIPMAP_LINEAR,[ka.TEXTURE_WRAP_S]:ka.REPEAT,[ka.TEXTURE_WRAP_T]:ka.REPEAT};function m0t(){return{id:"default-sampler",parameters:g0t}}function y0t(e){return p0t[e]}function v0t(e){return d0t[e]}let _0t=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,t={}){const{json:i,buffers:n=[],images:r=[]}=e,{baseUri:s=""}=e;return pa(i),this.baseUri=s,this.buffers=n,this.images=r,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,r)=>this._resolveBufferView(n,r))),e.images&&(i.images=e.images.map((n,r)=>this._resolveImage(n,r))),e.samplers&&(i.samplers=e.samplers.map((n,r)=>this._resolveSampler(n,r))),e.textures&&(i.textures=e.textures.map((n,r)=>this._resolveTexture(n,r))),e.accessors&&(i.accessors=e.accessors.map((n,r)=>this._resolveAccessor(n,r))),e.materials&&(i.materials=e.materials.map((n,r)=>this._resolveMaterial(n,r))),e.meshes&&(i.meshes=e.meshes.map((n,r)=>this._resolveMesh(n,r))),e.nodes&&(i.nodes=e.nodes.map((n,r)=>this._resolveNode(n,r)),i.nodes=i.nodes.map((n,r)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,r)=>this._resolveSkin(n,r))),e.scenes&&(i.scenes=e.scenes.map((n,r)=>this._resolveScene(n,r))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if(typeof t=="object")return t;const i=e&&e[t];return i||console.warn(`glTF file error: Could not find ${e}[${t}]`),i}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,t){const i={...e,id:e?.id||`node-${t}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,r)=>{const s=this.getMesh(r);return n.id=s.id,n.primitives=n.primitives.concat(s.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(t=>this.getNode(t))),e}_resolveSkin(e,t){const i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:i}}_resolveMesh(e,t){const i={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{const r={...n,attributes:{},indices:void 0,material:void 0},s=n.attributes;for(const o in s)r.attributes[o]=this.getAccessor(s[o]);return n.indices!==void 0&&(r.indices=this.getAccessor(n.indices)),n.material!==void 0&&(r.material=this.getMaterial(n.material)),r})),i}_resolveMaterial(e,t){const i={...e,id:e.id||`material-${t}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};const n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,t){const i=y0t(e.componentType),n=v0t(e.type),r=i*n,s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:i,components:n,bytesPerElement:r,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){const o=s.bufferView.buffer,{ArrayType:c,byteLength:h}=_w(s,s.bufferView),A=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+o.byteOffset;let _=o.arrayBuffer.slice(A,A+h);s.bufferView.byteStride&&(_=this._getValueFromInterleavedBuffer(o,A,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new c(_)}return s}_getValueFromInterleavedBuffer(e,t,i,n,r){const s=new Uint8Array(r*n);for(let o=0;o<r;o++){const c=t+o*i;s.set(new Uint8Array(e.arrayBuffer.slice(c,c+n)),o*n)}return s.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):m0t(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,t){const i={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const n in i){const r=this._enumSamplerParameter(n);r!==void 0&&(i.parameters[r]=i[n])}return i}_enumSamplerParameter(e){return A0t[e]}_resolveImage(e,t){const i={...e,id:e.id||`image-${t}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[t];return n&&(i.image=n),i}_resolveBufferView(e,t){const i=e.buffer,n=this.buffers[i].arrayBuffer;let r=this.buffers[i].byteOffset||0;return e.byteOffset&&(r+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,r,e.byteLength)}}_resolveCamera(e,t){const i={...e,id:e.id||`camera-${t}`};return i.perspective,i.orthographic,i}};function b0t(e,t){return new _0t().postProcess(e,t)}async function x0t(e){const t=[];return e.scenes.forEach(i=>{i.traverse(n=>{Object.values(n.model.uniforms).forEach(r=>{r.loaded===!1&&t.push(r)})})}),await w0t(()=>t.some(i=>!i.loaded))}async function w0t(e){for(;e();)await new Promise(t=>requestAnimationFrame(t))}const aF=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,C0t={name:"scenegraph",vs:aF,fs:aF,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},E0t=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,B0t=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,cF=[255,255,255,255],T0t={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?typeof e.scene=="object"?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:cF},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[kw]};class Jg extends Bo{getShaders(){const t={};let i;this.props._lighting==="pbr"?(i=tb,t.LIGHTING_PBR=1):i={name:"pbrMaterial"};const n=[Fo,ua,C0t,i];return super.getShaders({defines:t,vs:E0t,fs:B0t,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:cF,transition:!0},instanceModelMatrix:E6})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t;i.scenegraph!==n.scenegraph?this._updateScenegraph():i._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,i._animations)}finalizeState(t){super.finalizeState(t),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){const t=this.props,{device:i}=this.context;let n=null;if(t.scenegraph instanceof I0)n={scenes:[t.scenegraph]};else if(t.scenegraph&&typeof t.scenegraph=="object"){const c=t.scenegraph,h=c.json?b0t(c):c,A=Qpt(i,h,this._getModelOptions());n={gltf:h,...A},x0t(A).then(()=>{this.setNeedsRedraw()}).catch(_=>{this.raiseError(_,"loading glTF")})}const r={layer:this,device:this.context.device},s=t.getScene(n,r),o=t.getAnimator(n,r);if(s instanceof nA){this.state.scenegraph?.destroy(),this._applyAnimationsProp(o,t._animations);const c=[];s.traverse(h=>{h instanceof xb&&c.push(h.model)}),this.setState({scenegraph:s,animator:o,models:c}),this.getAttributeManager().invalidateAll()}else s!==null&&Zi.warn("invalid scenegraph:",s)()}_applyAnimationsProp(t,i){if(!t||!i)return;const n=t.getAnimations();Object.keys(i).sort().forEach(r=>{const s=i[r];if(r==="*")n.forEach(o=>{Object.assign(o,s)});else if(Number.isFinite(Number(r))){const o=Number(r);o>=0&&o<n.length?Object.assign(n[o],s):Zi.warn(`animation ${r} not found`)()}else{const o=n.find(({name:c})=>c===r);o?Object.assign(o,s):Zi.warn(`animation ${r} not found`)()}})}_getModelOptions(){const{_imageBasedLightingEnvironment:t}=this.props;let i;return t&&(typeof t=="function"?i=t({gl:this.context.gl,layer:this}):i=t),{imageBasedLightingEnvironment:i,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:t}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());const{viewport:i,renderPass:n}=this.context,{sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o,coordinateSystem:c}=this.props,h=this.getNumInstances();this.state.scenegraph.traverse((A,{worldMatrix:_})=>{if(A instanceof xb){const{model:C}=A;C.setInstanceCount(h);const S={camera:C.uniforms.cameraPosition},L={sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o,composeModelMatrix:B6(i,c),sceneModelMatrix:_};C.shaderInputs.setProps({pbrProjection:S,scenegraph:L}),C.draw(n)}})}}Jg.defaultProps=T0t,Jg.layerName="ScenegraphLayer";const S0t=Object.freeze(Object.defineProperty({__proto__:null,ScenegraphLayer:Jg,SimpleMeshLayer:Af},Symbol.toStringTag,{value:"Module"})),lF=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,I0t={name:"mesh",vs:lF,fs:lF,uniformTypes:{pickFeatureIds:"f32"}},M0t=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,P0t=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function R0t(e){const t=e.positions||e.POSITION,i=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(i*4).fill(255),normalized:!0})}const D0t={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};class Nw extends Af{getShaders(){const t=super.getShaders();return t.modules.push(tb,I0t),{...t,vs:M0t,fs:P0t}}initializeState(){const{featureIds:t}=this.props;super.initializeState();const i=this.getAttributeManager();t&&i.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t;i.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(i.pbrMaterial)}draw(t){const{featureIds:i}=this.props,{model:n}=this.state;if(!n)return;const r={pickFeatureIds:!!i},s={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:s,mesh:r}),super.draw(t)}getModel(t){const{id:i}=this.props,n=this.parseMaterial(this.props.pbrMaterial,t);this.setState({parsedPBRMaterial:n});const r=this.getShaders();return R0t(t.attributes),new Lr(this.context.device,{...this.getShaders(),id:i,geometry:t,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...r.defines,...n?.defines,HAS_UV_REGIONS:t.attributes.uvRegions?1:0},parameters:n?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){const{model:i}=this.state;if(i){const{mesh:n}=this.props,r=this.parseMaterial(t,n);this.setState({parsedPBRMaterial:r});const{pbr_baseColorSampler:s}=r.bindings,{emptyTexture:o}=this.state,c={sampler:s||o,hasTexture:!!s},{camera:h,...A}={...r.bindings,...r.uniforms};i.shaderInputs.setProps({simpleMesh:c,pbrMaterial:A})}}parseMaterial(t,i){const n=!!(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return M6(this.context.device,{unlit:n,...t},{NORMAL:i.attributes.normals,TEXCOORD_0:i.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){const i=this.props.featureIds,n=new Uint8ClampedArray(i.length*t.size),r=[];for(let s=0;s<i.length;s++)this.encodePickingColor(i[s],r),n[s*3]=r[0],n[s*3+1]=r[1],n[s*3+2]=r[2];t.value=n}finalizeState(t){super.finalizeState(t),this.state.parsedPBRMaterial?.generatedTextures.forEach(i=>i.destroy()),this.setState({parsedPBRMaterial:null})}}Nw.layerName="MeshLayer",Nw.defaultProps=D0t;const O0t=6378137,L0t=6378137,F0t=6356752314245179e-9;function pv(e){return e}new fe;function k0t(e,t=[],i=pv){return"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):"x"in e?(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}function N0t(e,t=[]){return k0t(e,t,Co._cartographicRadians?pv:TV)}function U0t(e,t,i=pv){return"longitude"in t?(t.longitude=i(e[0]),t.latitude=i(e[1]),t.height=e[2]):"x"in t?(t.x=i(e[0]),t.y=i(e[1]),t.z=e[2]):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}function z0t(e,t){return U0t(e,t,Co._cartographicRadians?pv:SV)}const uF=1e-14,G0t=new fe,hF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Uw={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Xg={east:new fe,north:new fe,up:new fe,west:new fe,south:new fe,down:new fe},j0t=new fe,V0t=new fe,H0t=new fe;function fF(e,t,i,n,r,s){const o=hF[t]&&hF[t][i];fc(o&&(!n||n===o));let c,h,A;const _=G0t.copy(r);if(ca(_.x,0,uF)&&ca(_.y,0,uF)){const C=Math.sign(_.z);c=j0t.fromArray(Uw[t]),t!=="east"&&t!=="west"&&c.scale(C),h=V0t.fromArray(Uw[i]),i!=="east"&&i!=="west"&&h.scale(C),A=H0t.fromArray(Uw[n]),n!=="east"&&n!=="west"&&A.scale(C)}else{const{up:C,east:S,north:L}=Xg;S.set(-_.y,_.x,0).normalize(),e.geodeticSurfaceNormal(_,C),L.copy(C).cross(S);const{down:N,west:U,south:H}=Xg;N.copy(C).scale(-1),U.copy(S).scale(-1),H.copy(L).scale(-1),c=Xg[t],h=Xg[i],A=Xg[n]}return s[0]=c.x,s[1]=c.y,s[2]=c.z,s[3]=0,s[4]=h.x,s[5]=h.y,s[6]=h.z,s[7]=0,s[8]=A.x,s[9]=A.y,s[10]=A.z,s[11]=0,s[12]=_.x,s[13]=_.y,s[14]=_.z,s[15]=1,s}const Bp=new fe,W0t=new fe,J0t=new fe;function X0t(e,t,i=[]){const{oneOverRadii:n,oneOverRadiiSquared:r,centerToleranceSquared:s}=t;Bp.from(e);const o=Bp.x,c=Bp.y,h=Bp.z,A=n.x,_=n.y,C=n.z,S=o*o*A*A,L=c*c*_*_,N=h*h*C*C,U=S+L+N,H=Math.sqrt(1/U);if(!Number.isFinite(H))return;const j=W0t;if(j.copy(e).scale(H),U<s)return j.to(i);const tt=r.x,K=r.y,Q=r.z,pt=J0t;pt.set(j.x*tt*2,j.y*K*2,j.z*Q*2);let $=(1-H)*Bp.len()/(.5*pt.len()),zt=0,Gt,dt,lt,Lt;do{$-=zt,Gt=1/(1+$*tt),dt=1/(1+$*K),lt=1/(1+$*Q);const J=Gt*Gt,ut=dt*dt,Et=lt*lt,le=J*Gt,Ct=ut*dt,Rt=Et*lt;Lt=S*J+L*ut+N*Et-1;const Nt=-2*(S*le*tt+L*Ct*K+N*Rt*Q);zt=Lt/Nt}while(Math.abs(Lt)>XH);return Bp.scale([Gt,dt,lt]).to(i)}const Av=new fe,dF=new fe,Q0t=new fe,Cc=new fe,K0t=new fe,gv=new fe;class wr{constructor(t=0,i=0,n=0){this.centerToleranceSquared=JH,fc(t>=0),fc(i>=0),fc(n>=0),this.radii=new fe(t,i,n),this.radiiSquared=new fe(t*t,i*i,n*n),this.radiiToTheFourth=new fe(t*t*t*t,i*i*i*i,n*n*n*n),this.oneOverRadii=new fe(t===0?0:1/t,i===0?0:1/i,n===0?0:1/n),this.oneOverRadiiSquared=new fe(t===0?0:1/(t*t),i===0?0:1/(i*i),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,i,n),this.maximumRadius=Math.max(t,i,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,i=[0,0,0]){const n=dF,r=Q0t,[,,s]=t;this.geodeticSurfaceNormalCartographic(t,n),r.copy(this.radiiSquared).scale(n);const o=Math.sqrt(n.dot(r));return r.scale(1/o),n.scale(s),r.add(n),r.to(i)}cartesianToCartographic(t,i=[0,0,0]){gv.from(t);const n=this.scaleToGeodeticSurface(gv,Cc);if(!n)return;const r=this.geodeticSurfaceNormal(n,dF),s=K0t;s.copy(gv).subtract(n);const o=Math.atan2(r.y,r.x),c=Math.asin(r.z),h=Math.sign(G1(s,gv))*tI(s);return z0t([o,c,h],i)}eastNorthUpToFixedFrame(t,i=new yn){return fF(this,"east","north","up",t,i)}localFrameToFixedFrame(t,i,n,r,s=new yn){return fF(this,t,i,n,r,s)}geocentricSurfaceNormal(t,i=[0,0,0]){return Av.from(t).normalize().to(i)}geodeticSurfaceNormalCartographic(t,i=[0,0,0]){const n=N0t(t),r=n[0],s=n[1],o=Math.cos(s);return Av.set(o*Math.cos(r),o*Math.sin(r),Math.sin(s)).normalize(),Av.to(i)}geodeticSurfaceNormal(t,i=[0,0,0]){return Av.from(t).scale(this.oneOverRadiiSquared).normalize().to(i)}scaleToGeodeticSurface(t,i){return X0t(t,this,i)}scaleToGeocentricSurface(t,i=[0,0,0]){Cc.from(t);const n=Cc.x,r=Cc.y,s=Cc.z,o=this.oneOverRadiiSquared,c=1/Math.sqrt(n*n*o.x+r*r*o.y+s*s*o.z);return Cc.multiplyScalar(c).to(i)}transformPositionToScaledSpace(t,i=[0,0,0]){return Cc.from(t).scale(this.oneOverRadii).to(i)}transformPositionFromScaledSpace(t,i=[0,0,0]){return Cc.from(t).scale(this.radii).to(i)}getSurfaceNormalIntersectionWithZAxis(t,i=0,n=[0,0,0]){fc(ca(this.radii.x,this.radii.y,mI)),fc(this.radii.z>0),Cc.from(t);const r=Cc.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-i))return Cc.set(0,0,r).to(n)}}wr.WGS84=new wr(O0t,L0t,F0t);class q0t{item;previous;next;constructor(t,i,n){this.item=t,this.previous=i,this.next=n}}class Z0t{head=null;tail=null;_length=0;get length(){return this._length}add(t){const i=new q0t(t,this.tail,null);return this.tail?(this.tail.next=i,this.tail=i):(this.head=i,this.tail=i),++this._length,i}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,i){t!==i&&(this.remove(i),this._insert(t,i))}_insert(t,i){const n=t.next;t.next=i,this.tail===t?this.tail=i:n.previous=i,i.next=n,i.previous=t,++this._length}}class Y0t{_list;_sentinel;_trimTiles;constructor(){this._list=new Z0t,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const i=t._cacheNode;i&&this._list.splice(this._sentinel,i)}add(t,i,n){i._cacheNode||(i._cacheNode=this._list.add(i),n&&n(t,i))}unloadTile(t,i,n){const r=i._cacheNode;r&&(this._list.remove(r),i._cacheNode=null,n&&n(t,i))}unloadTiles(t,i){const n=this._trimTiles;this._trimTiles=!1;const r=this._list,s=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let c=r.head;for(;c!==o&&(t.gpuMemoryUsageInBytes>s||n);){const h=c.item;c=c.next,this.unloadTile(t,h,i)}}trim(){this._trimTiles=!0}}function $0t(e,t){mr(e),mr(t);const{rtcCenter:i,gltfUpAxis:n}=t,{computedTransform:r,boundingVolume:{center:s}}=e;let o=new yn(r);switch(i&&o.translate(i),n){case"Z":break;case"Y":const _=new yn().rotateX(Math.PI/2);o=o.multiplyRight(_);break;case"X":const C=new yn().rotateY(-Math.PI/2);o=o.multiplyRight(C);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const c=new fe(s);t.cartesianModelMatrix=o,t.cartesianOrigin=c;const h=wr.WGS84.cartesianToCartographic(c,new fe),A=wr.WGS84.eastNorthUpToFixedFrame(c).invert();t.cartographicModelMatrix=A.multiplyRight(o),t.cartographicOrigin=h,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const pF=new fe,zw=new fe,Gw=new ya([new Ic,new Ic,new Ic,new Ic,new Ic,new Ic]);function tyt(e,t){const{cameraDirection:i,cameraUp:n,height:r}=e,{metersPerUnit:s}=e.distanceScales,o=mv(e,e.center),c=wr.WGS84.eastNorthUpToFixedFrame(o),h=e.unprojectPosition(e.cameraPosition),A=wr.WGS84.cartographicToCartesian(h,new fe),_=new fe(c.transformAsVector(new fe(i).scale(s))).normalize(),C=new fe(c.transformAsVector(new fe(n).scale(s))).normalize();iyt(e);const S=e.constructor,{longitude:L,latitude:N,width:U,bearing:H,zoom:j}=e,tt=new S({longitude:L,latitude:N,height:r,width:U,bearing:H,zoom:j,pitch:0});return{camera:{position:A,direction:_,up:C},viewport:e,topDownViewport:tt,height:r,cullingVolume:Gw,frameNumber:t,sseDenominator:1.15}}function eyt(e,t,i){if(i===0||e.length<=i)return[e,[]];const n=[],{longitude:r,latitude:s}=t.viewport;for(const[A,_]of e.entries()){const[C,S]=_.header.mbs,L=Math.abs(r-C),N=Math.abs(s-S),U=Math.sqrt(N*N+L*L);n.push([A,U])}const o=n.sort((A,_)=>A[1]-_[1]),c=[];for(let A=0;A<i;A++)c.push(e[o[A][0]]);const h=[];for(let A=i;A<o.length;A++)h.push(e[o[A][0]]);return[c,h]}function iyt(e){const t=e.getFrustumPlanes(),i=AF(t.near,e.cameraPosition),n=mv(e,i),r=mv(e,e.cameraPosition,zw);let s=0;Gw.planes[s++].fromPointNormal(n,pF.copy(n).subtract(r));for(const o in t){if(o==="near")continue;const c=t[o],h=AF(c,i,zw),A=mv(e,h,zw);Gw.planes[s++].fromPointNormal(A,pF.copy(n).subtract(A))}}function AF(e,t,i=new fe){const n=e.normal.dot(t);return i.copy(e.normal).scale(e.distance-n).add(t),i}function mv(e,t,i=new fe){const n=e.unprojectPosition(t);return wr.WGS84.cartographicToCartesian(n,i)}const nyt=6378137,ryt=6378137,jw=6356752314245179e-9,Tp=new fe;function oyt(e,t){if(e instanceof im){const{halfAxes:i}=e,n=ayt(i);return Math.log2(jw/(n+t[2]))}else if(e instanceof em){const{radius:i}=e;return Math.log2(jw/(i+t[2]))}else if(e.width&&e.height){const{width:i,height:n}=e,r=Math.log2(nyt/i),s=Math.log2(ryt/n);return(r+s)/2}return 1}function gF(e,t,i){wr.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],Tp);const n=Math.sqrt(Math.pow(Tp[0]-i[0],2)+Math.pow(Tp[1]-i[1],2)+Math.pow(Tp[2]-i[2],2));return Math.log2(jw/(n+t[2]))}function syt(e,t,i){const[n,r,s,o]=e;return gF({xmax:s,ymax:o,zmax:0},t,i)}function ayt(e){e.getColumn(0,Tp);const t=e.getColumn(1),i=e.getColumn(2);return Tp.add(t).add(i).len()}const ga={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var Ec;(function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"})(Ec||(Ec={}));var ru;(function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"})(ru||(ru={}));var js;(function(e){e.I3S="I3S",e.TILES3D="TILES3D"})(js||(js={}));var Sp;(function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(Sp||(Sp={}));const cyt={USE_OPTIMIZATION:1};function mF(e){return e!=null}const vs=new fe,yv=new fe,lyt=new fe,uyt=new fe,yf=new fe,yF=new fe,vF=new fe,_F=new fe;function Vw(e,t,i){if(mr(e,"3D Tile: boundingVolume must be defined"),e.box)return bF(e.box,t,i);if(e.region)return dyt(e.region);if(e.sphere)return fyt(e.sphere,t,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function hyt(e,t){if(e.box)return pyt(t);if(e.region){const[i,n,r,s,o,c]=e.region;return[[uc(i),uc(n),o],[uc(r),uc(s),c]]}if(e.sphere)return Ayt(t);throw new Error("Unkown boundingVolume type")}function bF(e,t,i){const n=new fe(e[0],e[1],e[2]);t.transform(n,n);let r=[];if(e.length===10){const A=e.slice(3,6),_=new KA;_.fromArray(e,6);const C=new fe([1,0,0]),S=new fe([0,1,0]),L=new fe([0,0,1]);C.transformByQuaternion(_),C.scale(A[0]),S.transformByQuaternion(_),S.scale(A[1]),L.transformByQuaternion(_),L.scale(A[2]),r=[...C.toArray(),...S.toArray(),...L.toArray()]}else r=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const s=t.transformAsVector(r.slice(0,3)),o=t.transformAsVector(r.slice(3,6)),c=t.transformAsVector(r.slice(6,9)),h=new gr([s[0],s[1],s[2],o[0],o[1],o[2],c[0],c[1],c[2]]);return mF(i)?(i.center=n,i.halfAxes=h,i):new im(n,h)}function fyt(e,t,i){const n=new fe(e[0],e[1],e[2]);t.transform(n,n);const r=t.getScale(yv),s=Math.max(Math.max(r[0],r[1]),r[2]),o=e[3]*s;return mF(i)?(i.center=n,i.radius=o,i):new em(n,o)}function dyt(e){const[t,i,n,r,s,o]=e,c=wr.WGS84.cartographicToCartesian([uc(t),uc(r),s],lyt),h=wr.WGS84.cartographicToCartesian([uc(n),uc(i),o],uyt),A=new fe().addVectors(c,h).multiplyByScalar(.5);return wr.WGS84.cartesianToCartographic(A,yf),wr.WGS84.cartographicToCartesian([uc(n),yf[1],yf[2]],yF),wr.WGS84.cartographicToCartesian([yf[0],uc(r),yf[2]],vF),wr.WGS84.cartographicToCartesian([yf[0],yf[1],o],_F),bF([...A,...yF.subtract(A),...vF.subtract(A),..._F.subtract(A)],new yn)}function pyt(e){const t=xF(),{halfAxes:i}=e,n=new fe(i.getColumn(0)),r=new fe(i.getColumn(1)),s=new fe(i.getColumn(2));for(let o=0;o<2;o++){for(let c=0;c<2;c++){for(let h=0;h<2;h++)vs.copy(e.center),vs.add(n),vs.add(r),vs.add(s),wF(t,vs),s.negate();r.negate()}n.negate()}return t}function Ayt(e){const t=xF(),{center:i,radius:n}=e,r=wr.WGS84.scaleToGeodeticSurface(i,vs);let s;r?s=wr.WGS84.geodeticSurfaceNormal(r):s=new fe(0,0,1);let o=new fe(s[2],-s[1],0);o.len()>0?o.normalize():o=new fe(0,1,0);const c=o.clone().cross(s);for(const h of[o,c,s]){yv.copy(h).scale(n);for(let A=0;A<2;A++)vs.copy(i),vs.add(yv),wF(t,vs),yv.negate()}return t}function xF(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function wF(e,t){wr.WGS84.cartesianToCartographic(t,vs),e[0][0]=Math.min(e[0][0],vs[0]),e[0][1]=Math.min(e[0][1],vs[1]),e[0][2]=Math.min(e[0][2],vs[2]),e[1][0]=Math.max(e[1][0],vs[0]),e[1][1]=Math.max(e[1][1],vs[1]),e[1][2]=Math.max(e[1][2],vs[2])}new fe,new fe,new yn,new fe,new fe,new fe;function gyt(e,t){const i=e*t;return 1-Math.exp(-(i*i))}function myt(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const i=e.dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return gyt(t,i)*n}return 0}function yyt(e,t,i){const n=e.tileset,r=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=i?r:e.lodMetricValue;if(s===0)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:c,sseDenominator:h}=t,{viewDistanceScale:A}=n.options;let _=s*c*(A||1)/(o*h);return _-=myt(n,o),_}const Hw=new fe,CF=new fe,uh=new fe,EF=new fe,vyt=new fe,Ww=new yn,BF=new yn;function _yt(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const i=2*TF(e,t);return i<2?"OUT":!e.header.children||i<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function TF(e,t){const{topDownViewport:i}=t,n=e.header.mbs[1],r=e.header.mbs[0],s=e.header.mbs[2],o=e.header.mbs[3],c=[...e.boundingVolume.center],h=i.unprojectPosition(i.cameraPosition);wr.WGS84.cartographicToCartesian(h,Hw),CF.copy(Hw).subtract(c).normalize(),wr.WGS84.eastNorthUpToFixedFrame(c,Ww),BF.copy(Ww).invert(),uh.copy(Hw).transform(BF);const A=Math.sqrt(uh[0]*uh[0]+uh[1]*uh[1]),_=A*A/uh[2];EF.copy([uh[0],uh[1],_]);const C=EF.transform(Ww).subtract(c).normalize(),S=CF.cross(C).normalize().scale(o).add(c),L=wr.WGS84.cartesianToCartographic(S),N=i.project([r,n,s]),U=i.project(L);return vyt.copy(N).subtract(U).magnitude()}function byt(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class SF{_map=new Map;_array;_length;constructor(t=0){this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return mr(t<this._array.length),this._array[t]}set(t,i){mr(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=i,this._map.set(i,t)}delete(t){const i=this._map.get(t);i>=0&&(this._array.splice(i,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const i=this.length++;this._array[i]=t,this._map.set(t,i)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){mr(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){mr(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const xyt={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class vv{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new SF;_emptyTraversalStack=new SF;_frameNumber=null;traversalFinished(t){return!0}constructor(t){this.options={...xyt,...t}}traverse(t,i,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,i),this._frameNumber=i.frameNumber,this.executeTraversal(t,i)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,i){const n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){const s=n.pop();let o=!1;this.canTraverse(s,i)&&(this.updateChildTiles(s,i),o=this.updateAndPushChildren(s,i,n,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));const c=s.parent,h=!!(!c||c._shouldRefine),A=!o;s.hasRenderContent?s.refine===Ec.ADD?(this.loadTile(s,i),this.selectTile(s,i)):s.refine===Ec.REPLACE&&(this.loadTile(s,i),A&&this.selectTile(s,i)):(this.emptyTiles[s.id]=s,this.loadTile(s,i),A&&this.selectTile(s,i)),this.touchTile(s,i),s._shouldRefine=o&&h}const r=new Date().getTime();(this.traversalFinished(i)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(i))}updateChildTiles(t,i){const n=t.children;for(const r of n)this.updateTile(r,i)}updateAndPushChildren(t,i,n,r){const{loadSiblings:s,skipLevelOfDetail:o}=this.options,c=t.children;c.sort(this.compareDistanceToCamera.bind(this));const h=t.refine===Ec.REPLACE&&t.hasRenderContent&&!o;let A=!1,_=!0;for(const C of c)if(C._selectionDepth=r,C.isVisibleAndInRequestVolume?(n.find(C)&&n.delete(C),n.push(C),A=!0):(h||s)&&(this.loadTile(C,i),this.touchTile(C,i)),h){let S;if(C._inRequestVolume?C.hasRenderContent?S=C.contentAvailable:S=this.executeEmptyTraversal(C,i):S=!1,_=_&&S,!_)return!1}return A||(_=!1),_}updateTile(t,i){this.updateTileVisibility(t,i)}selectTile(t,i){this.shouldSelectTile(t)&&(t._selectedFrame=i.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,i){this.shouldLoadTile(t)&&(t._requestedFrame=i.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,i){t.tileset._cache.touch(t),t._touchedFrame=i.frameNumber}canTraverse(t,i){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,i):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,i,n=!1){let r=t._screenSpaceError;return n&&(r=t.getScreenSpaceError(i,!0)),r>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,i){const n=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===i.viewport.id&&n.push(r);else n.push(i.viewport.id);t.updateVisibility(i,n)}compareDistanceToCamera(t,i){return t._distanceToCamera-i._distanceToCamera}anyChildrenVisible(t,i){let n=!1;for(const r of t.children)r.updateVisibility(i),n=n||r.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,i){let n=!0;const r=this._emptyTraversalStack;for(r.push(t);r.length>0;){const s=r.pop(),o=!s.hasRenderContent&&this.canTraverse(s,i),c=!s.hasRenderContent&&s.children.length===0;if(!o&&!s.contentAvailable&&!c&&(n=!1),this.updateTile(s,i),s.isVisibleAndInRequestVolume||(this.loadTile(s,i),this.touchTile(s,i)),o){const h=s.children;for(const A of h)r.push(A)}}return n}}const IF=new fe;function wyt(e){return e!=null}class Jw{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=ga.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new yn;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new vv({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new yn;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(t,i,n,r=""){this.header=i,this.tileset=t,this.id=r||i.id,this.url=i.url,this.parent=n,this.refine=this._getRefine(i.refine),this.type=i.type,this.contentUrl=i.contentUrl,this._initializeLodMetric(i),this._initializeTransforms(i),this._initializeBoundingVolumes(i),this._initializeContent(i),this._initializeRenderingState(i),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===ga.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===ga.UNLOADED}get contentExpired(){return this.contentState===ga.EXPIRED}get contentFailed(){return this.contentState===ga.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=hyt(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,i){switch(this.tileset.type){case js.I3S:return TF(this,t);case js.TILES3D:return yyt(this,t,i);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:i}=t.options,n=this.refine===Ec.ADD||i;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===ga.UNLOADED)return-1;const r=this.parent,s=r&&(!n||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,o=t.root?t.root._screenSpaceError:0;return Math.max(o-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=ga.LOADING;const t=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!t)return this.contentState=ga.UNLOADED,!1;try{const i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,r={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await tp(i,n,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=ga.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=ga.FAILED,i}finally{t.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=ga.UNLOADED,!0}updateVisibility(t,i){if(this._frameNumber===t.frameNumber)return;const n=this.parent,r=n?n._visibilityPlaneMask:ya.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const s=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==ya.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=i}visibility(t,i){const{cullingVolume:n}=t,{boundingVolume:r}=this;return n.computeVisibilityWithPlaneMask(r,i)}contentVisibility(){return!0}distanceToTile(t){const i=this.boundingVolume;return Math.sqrt(Math.max(i.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){const i=this.boundingVolume;return IF.subVectors(i.center,t.position),t.direction.dot(IF)}insideViewerRequestVolume(t){const i=this._viewerRequestVolume;return!i||i.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(wyt(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=ga.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new yn(t.transform):new yn;const i=this.parent,n=this.tileset,r=i&&i.computedTransform?i.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new yn(r).multiplyRight(this.transform);const s=i&&i._initialTransform?i._initialTransform.clone():new yn;this._initialTransform=new yn(s).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=ga.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ya.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Ec.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Vw(t.boundingVolume,this.computedTransform,this.boundingVolume);const i=t.content;i&&(i.boundingVolume&&(this._contentBoundingVolume=Vw(i.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Vw(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new yn){const i=t.clone().multiplyRight(this.transform);i.equals(this.computedTransform)||(this.computedTransform=i,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return byt(this.tileset.tileset)}}}class Cyt extends vv{compareDistanceToCamera(t,i){return i._distanceToCamera===0&&t._distanceToCamera===0?i._centerZDepth-t._centerZDepth:i._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,i){if(super.updateTileVisibility(t,i),!t.isVisibleAndInRequestVolume)return;const n=t.children.length>0;if(t.hasTilesetContent&&n){const o=t.children[0];this.updateTileVisibility(o,i),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,i)){t._visible=!1;return}const r=t.refine===Ec.REPLACE,s=t._optimChildrenWithinParent===cyt.USE_OPTIMIZATION;if(r&&s&&n&&!this.anyChildrenVisible(t,i)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,i){const{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==Ec.ADD?!1:!this.shouldRefine(t,i,!0)}}class Eyt{frameNumberMap=new Map;register(t,i){const n=this.frameNumberMap.get(t)||new Map,r=n.get(i)||0;n.set(i,r+1),this.frameNumberMap.set(t,n)}deregister(t,i){const n=this.frameNumberMap.get(t);if(!n)return;const r=n.get(i)||1;n.set(i,r-1)}isZero(t,i){return(this.frameNumberMap.get(t)?.get(i)||0)===0}}const Xw={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Byt{_statusMap;pendingTilesRegister=new Eyt;constructor(){this._statusMap={}}add(t,i,n,r){if(!this._statusMap[i]){const{frameNumber:s,viewport:{id:o}}=r;this._statusMap[i]={request:t,callback:n,key:i,frameState:r,status:Xw.REQUESTED},this.pendingTilesRegister.register(o,s),t().then(c=>{this._statusMap[i].status=Xw.COMPLETED;const{frameNumber:h,viewport:{id:A}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(A,h),this._statusMap[i].callback(c,r)}).catch(c=>{this._statusMap[i].status=Xw.ERROR;const{frameNumber:h,viewport:{id:A}}=this._statusMap[i].frameState;this.pendingTilesRegister.deregister(A,h),n(c)})}}update(t,i){if(this._statusMap[t]){const{frameNumber:n,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,n);const{frameNumber:s,viewport:{id:o}}=i;this.pendingTilesRegister.register(o,s),this._statusMap[t].frameState=i}}find(t){return this._statusMap[t]}hasPendingTiles(t,i){return!this.pendingTilesRegister.isZero(t,i)}}class Tyt extends vv{_tileManager;constructor(t){super(t),this._tileManager=new Byt}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,i){return t._lodJudge=_yt(t,i),t._lodJudge==="DIG"}updateChildTiles(t,i){const n=t.header.children||[],r=t.children,s=t.tileset;for(const o of n){const c=`${o.id}-${i.viewport.id}`,h=r&&r.find(A=>A.id===c);if(h)h&&this.updateTile(h,i);else{let A=()=>this._loadTile(o.id,s);this._tileManager.find(c)?this._tileManager.update(c,i):(s.tileset.nodePages&&(A=()=>s.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(A,c,_=>this._onTileLoad(_,t,c),i))}}return!1}async _loadTile(t,i){const{loader:n}=i,r=i.getTileUrl(`${i.url}/nodes/${t}`),s={...i.loadOptions,i3s:{...i.loadOptions.i3s,isTileHeader:!0}};return await tp(r,n,s)}_onTileLoad(t,i,n){const r=new Jw(i.tileset,t,i,n);i.children.push(r);const s=this._tileManager.find(r.id).frameState;this.updateTile(r,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,s)}}const Syt={description:"",ellipsoid:wr.WGS84,modelMatrix:new yn,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},_v="Tiles In Tileset(s)",Qw="Tiles In Memory",MF="Tiles In View",PF="Tiles To Render",RF="Tiles Loaded",Kw="Tiles Loading",DF="Tiles Unloaded",OF="Failed Tile Loads",LF="Points/Vertices",qw="Tile Memory Use",FF="Maximum Screen Space Error";class Iyt{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new Y0t;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(t,i){this.options={...Syt,...i},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||EL(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new CL({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new u4({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let i=t;return this.queryParams.length&&(i=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(i=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),i(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const i=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=i.length;const n=[];for(const r of i){const s=r.id;this._needTraverse(s)?n.push(s):this.traverseCounter--}for(const r of i){const s=r.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!n.includes(s))continue;const o=tyt(r,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(t){let i=t;return this.options.viewportTraversersMap&&(i=this.options.viewportTraversersMap[t]),i===t}_onTraversalEnd(t){const i=t.viewport.id;this.frameStateData[i]||(this.frameStateData[i]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const n=this.frameStateData[i],r=Object.values(this._traverser.selectedTiles),[s,o]=eyt(r,t,this.options.maximumTilesSelected);n.selectedTiles=s;for(const c of o)c.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const i=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(i.selectedTiles),this._requestedTiles=this._requestedTiles.concat(i._requestedTiles),this._emptyTiles=this._emptyTiles.concat(i._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,i){if(t.length!==i.length)return!0;const n=new Set(t.map(o=>o.id)),r=new Set(i.map(o=>o.id));let s=t.filter(o=>!r.has(o.id)).length>0;return s=s||i.filter(o=>!n.has(o.id)).length>0,s}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,i)=>t._unloadTile(i))}_updateStats(){let t=0,i=0;for(const n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?i+=n.content.pointCount:i+=n.content.vertexCount);this.stats.get(MF).count=this.selectedTiles.length,this.stats.get(PF).count=t,this.stats.get(LF).count=i,this.stats.get(FF).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===js.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===js.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===js.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const t=this.tileset.fullExtent;if(t){const{xmin:n,xmax:r,ymin:s,ymax:o,zmin:c,zmax:h}=t;this.cartographicCenter=new fe(n+(r-n)/2,s+(o-s)/2,c+(h-c)/2),this.cartesianCenter=new fe,wr.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=gF(t,this.cartographicCenter,this.cartesianCenter);return}const i=this.tileset.store?.extent;if(i){const[n,r,s,o]=i;this.cartographicCenter=new fe(n+(s-n)/2,r+(o-r)/2,0),this.cartesianCenter=new fe,wr.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=syt(i,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new fe,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:i}=t.boundingVolume;if(!i){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new fe,this.zoom=1;return}i[0]!==0||i[1]!==0||i[2]!==0?(this.cartographicCenter=new fe,wr.WGS84.cartesianToCartographic(i,this.cartographicCenter)):this.cartographicCenter=new fe(0,0,-wr.WGS84.radii[0]),this.cartesianCenter=i,this.zoom=oyt(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(_v),this.stats.get(Kw),this.stats.get(Qw),this.stats.get(MF),this.stats.get(PF),this.stats.get(RF),this.stats.get(DF),this.stats.get(OF),this.stats.get(LF),this.stats.get(qw,"memory"),this.stats.get(FF)}_initializeTileHeaders(t,i){const n=new Jw(this,t.root,i);if(i&&(i.children.push(n),n.depth=i.depth+1),this.type===js.TILES3D){const r=[];for(r.push(n);r.length>0;){const s=r.pop();this.stats.get(_v).incrementCount();const o=s.header.children||[];for(const c of o){const h=new Jw(this,c,s);if(h.contentUrl?.includes("?session=")){const A=new URL(h.contentUrl).searchParams.get("session");A&&(this._queryParams.session=A)}s.children.push(h),h.depth=s.depth+1,r.push(h)}}}return n}_initializeTraverser(){let t;switch(this.type){case js.TILES3D:t=Cyt;break;case js.I3S:t=Tyt;break;default:t=vv}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let i;try{this._onStartTileLoading(),i=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,i)}}_onTileLoadError(t,i){this.stats.get(OF).incrementCount();const n=i.message||i.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${n}`),this.options.onTileError(t,n,r)}_onTileLoad(t,i){if(i){if(this.type===js.I3S){const n=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(_v).reset(),this.stats.get(_v).addCount(n)}t&&t.content&&$0t(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===js.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===js.TILES3D){const{extensionsRemoved:i=[]}=t.content?.gltf||{};i.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),i.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),i.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Kw).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Kw).decrementCount()}_addTileToCache(t){this._cache.add(this,t,i=>i._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(RF).incrementCount(),this.stats.get(Qw).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(qw).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(Qw).decrementCount(),this.stats.get(DF).incrementCount(),this.stats.get(qw).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const i=t.pop();for(const n of i.children)t.push(n);this._destroyTile(i)}this.root=null}_destroySubtree(t){const i=t,n=[];for(n.push(i);n.length>0;){t=n.pop();for(const r of t.children)n.push(r);t!==i&&this._destroyTile(t)}i.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const i=new URLSearchParams(t.queryString),n=Object.fromEntries(i.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const kF="4.3.1",Qg={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GLTF:"glTF"};function NF(e,t,i){mr(e instanceof ArrayBuffer);const n=new TextDecoder("utf8"),r=new Uint8Array(e,t,i);return n.decode(r)}function Myt(e,t=0){const i=new DataView(e);return`${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}const Pyt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},go={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},zn={...Pyt,...go},Zw={[go.DOUBLE]:Float64Array,[go.FLOAT]:Float32Array,[go.UNSIGNED_SHORT]:Uint16Array,[go.UNSIGNED_INT]:Uint32Array,[go.UNSIGNED_BYTE]:Uint8Array,[go.BYTE]:Int8Array,[go.SHORT]:Int16Array,[go.INT]:Int32Array},Ryt={DOUBLE:go.DOUBLE,FLOAT:go.FLOAT,UNSIGNED_SHORT:go.UNSIGNED_SHORT,UNSIGNED_INT:go.UNSIGNED_INT,UNSIGNED_BYTE:go.UNSIGNED_BYTE,BYTE:go.BYTE,SHORT:go.SHORT,INT:go.INT},Yw="Failed to convert GL type";class vl{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const i in Zw)if(Zw[i]===t)return i;throw new Error(Yw)}static fromName(t){const i=Ryt[t];if(!i)throw new Error(Yw);return i}static getArrayType(t){switch(t){case go.UNSIGNED_SHORT_5_6_5:case go.UNSIGNED_SHORT_4_4_4_4:case go.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const i=Zw[t];if(!i)throw new Error(Yw);return i}}static getByteSize(t){return vl.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!vl.getArrayType(t)}static createTypedArray(t,i,n=0,r){r===void 0&&(r=(i.byteLength-n)/vl.getByteSize(t));const s=vl.getArrayType(t);return new s(i,n,r)}}function Dyt(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function Oyt(e,t=[0,0,0]){const i=e>>11&31,n=e>>5&63,r=e&31;return t[0]=i<<3,t[1]=n<<2,t[2]=r<<3,t}new z1,new fe,new z1,new z1;function UF(e,t=255){return Wl(e,0,t)/t*2-1}function zF(e){return e<0?-1:1}function Lyt(e,t,i,n){if(Dyt(n),e<0||e>i||t<0||t>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(n.x=UF(e,i),n.y=UF(t,i),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){const r=n.x;n.x=(1-Math.abs(n.y))*zF(r),n.y=(1-Math.abs(r))*zF(n.y)}return n.normalize()}function Fyt(e,t,i){return Lyt(e,t,255,i)}class $w{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(t,i){this.json=t,this.buffer=i}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t,i=zn.UNSIGNED_INT,n=1){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,i,n,1,r.byteOffset):r}getPropertyArray(t,i,n){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(i=vl.fromName(r.componentType)),this._getTypedArrayFromBinary(t,i,n,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,i,r)}getProperty(t,i,n,r,s){const o=this.json[t];if(!o)return o;const c=this.getPropertyArray(t,i,n);if(n===1)return c[r];for(let h=0;h<n;++h)s[h]=c[n*r+h];return s}_getTypedArrayFromBinary(t,i,n,r,s){const o=this._cachedTypedArrays;let c=o[t];return c||(c=vl.createTypedArray(i,this.buffer.buffer,this.buffer.byteOffset+s,r*n),o[t]=c),c}_getTypedArrayFromArray(t,i,n){const r=this._cachedTypedArrays;let s=r[t];return s||(s=vl.createTypedArray(i,n),r[t]=s),s}}const kyt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nyt={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Uyt={SCALAR:(e,t,i)=>{t[i]=e},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1]},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2]},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9]},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15]}};function zyt(e,t,i,n){const{componentType:r}=e;mr(e.componentType);const s=typeof r=="string"?vl.fromName(r):r,o=kyt[e.type],c=Nyt[e.type],h=Uyt[e.type];return i+=e.byteOffset,{values:vl.createTypedArray(s,t,i,o*n),type:s,size:o,unpacker:c,packer:h}}const Al=e=>e!==void 0;function Gyt(e,t,i){if(!t)return null;let n=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,n=r),n?jyt(n,i):null}function jyt(e,t){let i,n,r;const s=e.instancesLength,o=e.classes;let c=e.classIds,h=e.parentCounts,A=e.parentIds,_=s;Al(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,s));let C;if(Al(h))for(Al(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,r=getBinaryAccessor(h),h=r.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,s)),C=new Uint16Array(s),_=0,i=0;i<s;++i)C[i]=_,_+=h[i];Al(A)&&Al(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,r=getBinaryAccessor(A),A=r.createArrayBufferView(t.buffer,t.byteOffset+A.byteOffset,_));const S=o.length;for(i=0;i<S;++i){const H=o[i].length,j=o[i].instances,tt=getBinaryProperties(H,j,t);o[i].instances=combine(tt,j)}const L=new Array(S).fill(0),N=new Uint16Array(s);for(i=0;i<s;++i)n=c[i],N[i]=L[n],++L[n];const U={classes:o,classIds:c,classIndexes:N,parentCounts:h,parentIndexes:C,parentIds:A};return Wyt(U),U}function Kg(e,t,i){if(!e)return;const n=e.parentCounts;return e.parentIds?i(e,t):n>0?Vyt(e,t,i):Hyt(e,t,i)}function Vyt(e,t,i){const n=e.classIds,r=e.parentCounts,s=e.parentIds,o=e.parentIndexes,c=n.length,h=scratchVisited;h.length=Math.max(h.length,c);const A=++marker,_=scratchStack;for(_.length=0,_.push(t);_.length>0;){if(t=_.pop(),h[t]===A)continue;h[t]=A;const C=i(e,t);if(Al(C))return C;const S=r[t],L=o[t];for(let N=0;N<S;++N){const U=s[L+N];U!==t&&_.push(U)}}return null}function Hyt(e,t,i){let n=!0;for(;n;){const r=i(e,t);if(Al(r))return r;const s=e.parentIds[t];n=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}function Wyt(e){const t=e.classIds.length;for(let i=0;i<t;++i)GF(e,i,stack)}function GF(e,t,i){const n=e.parentCounts,r=e.parentIds,s=e.parentIndexes,o=e.classIds.length;if(!Al(r))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(i.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),i.push(t);const c=Al(n)?n[t]:1,h=Al(n)?s[t]:t;for(let A=0;A<c;++A){const _=r[h+A];_!==t&&GF(e,_,i)}i.pop(t)}function Vs(e){return e!=null}const bv=(e,t)=>e,Jyt={HIERARCHY:!0,extensions:!0,extras:!0};class jF{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(t,i,n,r={}){mr(n>=0),this.json=t||{},this.binary=i,this.featureCount=n,this._extensions=this.json?.extensions||{},this._properties={};for(const s in this.json)Jyt[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=Gyt(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,i){if(this._checkBatchId(t),mr(typeof i=="string",i),this._hierarchy){const n=Kg(this._hierarchy,t,(r,s)=>{const o=r.classIds[s];return r.classes[o].name===i});return Vs(n)}return!1}isExactClass(t,i){return mr(typeof i=="string",i),this.getExactClassName(t)===i}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const i=this._hierarchy.classIds[t];return this._hierarchy.classes[i].name}}hasProperty(t,i){return this._checkBatchId(t),mr(typeof i=="string",i),Vs(this._properties[i])||this._hasPropertyInHierarchy(t,i)}getPropertyNames(t,i){this._checkBatchId(t),i=Vs(i)?i:[],i.length=0;const n=Object.keys(this._properties);return i.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,i),i}getProperty(t,i){if(this._checkBatchId(t),mr(typeof i=="string",i),this._binaryProperties){const r=this._binaryProperties[i];if(Vs(r))return this._getBinaryProperty(r,t)}const n=this._properties[i];if(Vs(n))return bv(n[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,i);if(Vs(r))return r}}setProperty(t,i,n){const r=this.featureCount;if(this._checkBatchId(t),mr(typeof i=="string",i),this._binaryProperties){const o=this._binaryProperties[i];if(o){this._setBinaryProperty(o,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,i,n))return;let s=this._properties[i];Vs(s)||(this._properties[i]=new Array(r),s=this._properties[i]),s[t]=bv(n)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,i){return t.unpack(t.typedArray,i)}_setBinaryProperty(t,i,n){t.pack(n,t.typedArray,i)}_initializeBinaryProperties(){let t=null;for(const i in this._properties){const n=this._properties[i],r=this._initializeBinaryProperty(i,n);r&&(t=t||{},t[i]=r)}return t}_initializeBinaryProperty(t,i){if("byteOffset"in i){const n=i;mr(this.binary,`Property ${t} requires a batch table binary.`),mr(n.type,`Property ${t} requires a type.`);const r=zyt(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(t,i){if(!this._hierarchy)return!1;const n=Kg(this._hierarchy,t,(r,s)=>{const o=r.classIds[s],c=r.classes[o].instances;return Vs(c[i])});return Vs(n)}_getPropertyNamesInHierarchy(t,i){Kg(this._hierarchy,t,(n,r)=>{const s=n.classIds[r],o=n.classes[s].instances;for(const c in o)o.hasOwnProperty(c)&&i.indexOf(c)===-1&&i.push(c)})}_getHierarchyProperty(t,i){return Kg(this._hierarchy,t,(n,r)=>{const s=n.classIds[r],o=n.classes[s],c=n.classIndexes[r],h=o.instances[i];return Vs(h)?Vs(h.typedArray)?this._getBinaryProperty(h,c):bv(h[c]):null})}_setHierarchyProperty(t,i,n,r){const s=Kg(this._hierarchy,i,(o,c)=>{const h=o.classIds[c],A=o.classes[h],_=o.classIndexes[c],C=A.instances[n];return Vs(C)?(mr(c===i,`Inherited property "${n}" is read-only.`),Vs(C.typedArray)?this._setBinaryProperty(C,_,r):C[_]=bv(r),!0):!1});return Vs(s)}}const tC=4;function xv(e,t,i=0){const n=new DataView(t);if(e.magic=n.getUint32(i,!0),i+=tC,e.version=n.getUint32(i,!0),i+=tC,e.byteLength=n.getUint32(i,!0),i+=tC,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return i}const Ip=4,VF="b3dm tile in legacy format.";function eC(e,t,i){const n=new DataView(t);let r;e.header=e.header||{};let s=n.getUint32(i,!0);i+=Ip;let o=n.getUint32(i,!0);i+=Ip;let c=n.getUint32(i,!0);i+=Ip;let h=n.getUint32(i,!0);return i+=Ip,c>=570425344?(i-=Ip*2,r=s,c=o,h=0,s=0,o=0,console.warn(VF)):h>=570425344&&(i-=Ip,r=c,c=s,h=o,s=0,o=0,console.warn(VF)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=c,e.header.batchTableBinaryByteLength=h,e.header.batchLength=r,i}function iC(e,t,i,n){return i=Xyt(e,t,i),i=Qyt(e,t,i),i}function Xyt(e,t,i,n){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:s,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const c=NF(t,i,r);e.featureTableJson=JSON.parse(c)}return i+=r||0,e.featureTableBinary=new Uint8Array(t,i,s),i+=s||0,i}function Qyt(e,t,i,n){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:s}=e.header||{};if(r&&r>0){const o=NF(t,i,r);e.batchTableJson=JSON.parse(o),i+=r,s&&s>0&&(e.batchTableBinary=new Uint8Array(t,i,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=s)}return i}function HF(e,t,i){if(!t&&(!e||!e.batchIds||!i))return null;const{batchIds:n,isRGB565:r,pointCount:s=0}=e;if(n&&i){const o=new Uint8ClampedArray(s*3);for(let c=0;c<s;c++){const h=n[c],A=i.getProperty(h,"dimensions").map(_=>_*255);o[c*3]=A[0],o[c*3+1]=A[1],o[c*3+2]=A[2]}return{type:zn.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&r){const o=new Uint8ClampedArray(s*3);for(let c=0;c<s;c++){const h=Oyt(t[c]);o[c*3]=h[0],o[c*3+1]=h[1],o[c*3+2]=h[2]}return{type:zn.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===s*3?{type:zn.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:zn.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const WF=new fe;function Kyt(e,t){if(!t)return null;if(e.isOctEncoded16P){const i=new Float32Array((e.pointsLength||0)*3);for(let n=0;n<(e.pointsLength||0);n++)Fyt(t[n*2],t[n*2+1],WF),WF.toArray(i,n*3);return{type:zn.FLOAT,size:2,value:i}}return{type:zn.FLOAT,size:2,value:t}}function qyt(e,t,i){return e.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,Zyt(e,t)):{type:zn.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Zyt(e,t){const i=new fe,n=new Float32Array(e.pointCount*3);for(let r=0;r<e.pointCount;r++)i.set(t[r*3],t[r*3+1],t[r*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,r*3);return n}async function Yyt(e,t,i,n,r){i=xv(e,t,i),i=eC(e,t,i),i=iC(e,t,i),$yt(e);const{featureTable:s,batchTable:o}=tvt(e);return await ovt(e,s,o,n,r),evt(e,s,n),ivt(e,s,o),nvt(e,s),i}function $yt(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function tvt(e){const t=new $w(e.featureTableJson,e.featureTableBinary),i=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=i,e.featuresLength=i,e.pointsLength=i,e.pointCount=i,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",zn.FLOAT,3);const n=rvt(e,t);return{featureTable:t,batchTable:n}}function evt(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",zn.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const n=t.getPropertyArray("POSITION_QUANTIZED",zn.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",zn.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",zn.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=qyt(e,n,i)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function ivt(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",zn.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",zn.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",zn.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=HF(e,n,i)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",zn.UNSIGNED_BYTE,4))}function nvt(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let i=null;t.hasProperty("NORMAL")?i=t.getPropertyArray("NORMAL",zn.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(i=t.getPropertyArray("NORMAL_OCT16P",zn.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=Kyt(e,i)}}function rvt(e,t){let i=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",zn.UNSIGNED_SHORT,1),e.batchIds)){const n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:s}=e;i=new jF(r,s,n)}return i}async function ovt(e,t,i,n,r){let s,o,c;const h=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];h&&(c=h.properties);const A=t.getExtension("3DTILES_draco_point_compression");if(A){o=A.properties;const C=A.byteOffset,S=A.byteLength;if(!o||!Number.isFinite(C)||!S)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(e.featureTableBinary||[]).slice(C,C+S),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const _={buffer:s,properties:{...o,...c},batchTableProperties:c};return await svt(e,_,n,r)}async function svt(e,t,i,n){if(!n)return;const r={...i,draco:{...i?.draco,extraAttributes:t.batchTableProperties||{}}};delete r["3d-tiles"];const s=await ff(t.buffer,Lw,r,n),o=s.attributes.POSITION&&s.attributes.POSITION.value,c=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,h=s.attributes.NORMAL&&s.attributes.NORMAL.value,A=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,_=o&&s.attributes.POSITION.value.quantization,C=h&&s.attributes.NORMAL.value.quantization;if(_){const L=s.POSITION.data.quantization,N=L.range;e.quantizedVolumeScale=new fe(N,N,N),e.quantizedVolumeOffset=new fe(L.minValues),e.quantizedRange=(1<<L.quantizationBits)-1,e.isQuantizedDraco=!0}C&&(e.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const S={};if(t.batchTableProperties)for(const L of Object.keys(t.batchTableProperties))s.attributes[L]&&s.attributes[L].value&&(S[L.toLowerCase()]=s.attributes[L].value);e.attributes={positions:o,colors:HF(e,c,void 0),normals:h,batchIds:A,...S}}function ma(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const JF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},XF={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},avt=1.33,QF=["SCALAR","VEC2","VEC3","VEC4"],cvt=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],lvt=new Map(cvt),uvt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hvt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},fvt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function KF(e){return QF[e-1]||QF[0]}function wv(e){const t=lvt.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function nC(e,t){const i=fvt[e.componentType],n=uvt[e.type],r=hvt[e.componentType],s=e.count*n,o=e.count*n*r;ma(o>=0&&o<=t.byteLength);const c=XF[e.componentType],h=JF[e.type];return{ArrayType:i,length:s,byteLength:o,componentByteSize:c,numberOfComponentsInElement:h}}function qF(e){let{images:t,bufferViews:i}=e;t=t||[],i=i||[];const n=t.map(o=>o.bufferView);i=i.filter(o=>!n.includes(o));const r=i.reduce((o,c)=>o+c.byteLength,0),s=t.reduce((o,c)=>{const{width:h,height:A}=c.image;return o+h*A},0);return r+Math.ceil(4*s*avt)}function dvt(e,t,i){const n=e.bufferViews[i];ma(n);const r=n.buffer,s=t[r];ma(s);const o=(n.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,n.byteLength)}function pvt(e,t,i){const n=typeof i=="number"?e.accessors?.[i]:i;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(i)}`);const r=e.bufferViews?.[n.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:s,byteOffset:o}=t[r.buffer],c=(o||0)+(n.byteOffset||0)+(r.byteOffset||0),{ArrayType:h,length:A,componentByteSize:_,numberOfComponentsInElement:C}=nC(n,r),S=_*C,L=r.byteStride||S;if(typeof r.byteStride>"u"||r.byteStride===S)return new h(s,c,A);const N=new h(A);for(let U=0;U<n.count;U++){const H=new h(s,c+U*L,C);N.set(H,U*C)}return N}function Avt(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class zo{gltf;sourceBuffers;byteLength;constructor(t){this.gltf={json:t?.json||Avt(),buffers:t?.buffers||[],images:t?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const i=this.getUsedExtensions().find(r=>r===t),n=this.getRequiredExtensions().find(r=>r===t);return typeof i=="string"||typeof n=="string"}getExtension(t){const i=this.getUsedExtensions().find(r=>r===t),n=this.json.extensions||{};return i?n[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(i=>i===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,i){return(t.extensions||{})[i]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,i){if(typeof i=="object")return i;const n=this.json[t]&&this.json[t][i];if(!n)throw new Error(`glTF file error: Could not find ${t}[${i}]`);return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);const i=t.buffer,n=this.gltf.buffers[i];ma(n);const r=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const i=this.getAccessor(t);return pvt(this.gltf.json,this.gltf.buffers,i)}getTypedArrayForImageData(t){t=this.getAccessor(t);const i=this.getBufferView(t.bufferView),n=this.getBuffer(i.buffer).data,r=i.byteOffset||0;return new Uint8Array(n,r,i.byteLength)}addApplicationData(t,i){return this.json[t]=i,this}addExtraData(t,i){return this.json.extras=this.json.extras||{},this.json.extras[t]=i,this}addObjectExtension(t,i,n){return t.extensions=t.extensions||{},t.extensions[i]=n,this.registerUsedExtension(i),this}setObjectExtension(t,i,n){const r=t.extensions||{};r[i]=n}removeObjectExtension(t,i){const n=t?.extensions||{};if(n[i]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(i)||r.push(i)}delete n[i]}addExtension(t,i={}){return ma(i),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=i,this.registerUsedExtension(t),i}addRequiredExtension(t,i={}){return ma(i),this.addExtension(t,i),this.registerRequiredExtension(t),i}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(i=>i===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(i=>i===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(this.json.extensions?.[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const i=this.json.extensionsRemoved;i.includes(t)||i.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:i}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:i}),this.json.scenes.length-1}addNode(t){const{meshIndex:i,matrix:n}=t;this.json.nodes=this.json.nodes||[];const r={mesh:i};return n&&(r.matrix=n),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:i,indices:n,material:r,mode:s=4}=t,o={primitives:[{attributes:this._addAttributes(i),mode:s}]};if(n){const c=this._addIndices(n);o.primitives[0].indices=c}return Number.isFinite(r)&&(o.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(t){const i={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(t,i){const n=Uy(t),r=i||n?.mimeType,s={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(s),this.json.images.length-1}addBufferView(t,i=0,n=this.byteLength){const r=t.byteLength;ma(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const s={buffer:i,byteOffset:n,byteLength:r};return this.byteLength+=tu(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(t,i){const n={bufferView:t,type:KF(i.size),componentType:i.componentType,count:i.count,max:i.max,min:i.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t,i={size:3}){const n=this.addBufferView(t);let r={min:i.min,max:i.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(t,i.size));const s={size:i.size,componentType:wv(t),count:Math.round(t.length/i.size),min:r.min,max:r.max};return this.addAccessor(n,Object.assign(s,i))}addTexture(t){const{imageIndex:i}=t,n={source:i};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){const t=this.byteLength,i=new ArrayBuffer(t),n=new Uint8Array(i);let r=0;for(const s of this.sourceBuffers||[])r=wL(s,n,r);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=i,this.sourceBuffers=[i],this.gltf.buffers=[{arrayBuffer:i,byteOffset:0,byteLength:i.byteLength}]}_removeStringFromArray(t,i){let n=!0;for(;n;){const r=t.indexOf(i);r>-1?t.splice(r,1):n=!1}}_addAttributes(t={}){const i={};for(const n in t){const r=t[n],s=this._getGltfAttributeName(n),o=this.addBinaryBuffer(r.value,r);i[s]=o}return i}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,i){const n={min:null,max:null};if(t.length<i)return n;n.min=[],n.max=[];const r=t.subarray(0,i);for(const s of r)n.min.push(s),n.max.push(s);for(let s=i;s<t.length;s+=i)for(let o=0;o<i;o++)n.min[0+o]=Math.min(n.min[0+o],t[s+o]),n.max[0+o]=Math.max(n.max[0+o],t[s+o]);return n}}function ZF(e){return(e%1+1)%1}const YF={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},gvt={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},$F={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function rC(e,t){return $F[t]*YF[e]}function Cv(e,t,i,n){if(i!=="UINT8"&&i!=="UINT16"&&i!=="UINT32"&&i!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),s=Ev(r,"SCALAR",i,n+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function Ev(e,t,i,n=1){const r=YF[t],s=gvt[i],o=$F[i],c=n*r,h=c*o;let A=e.buffer,_=e.byteOffset;return _%o!==0&&(A=new Uint8Array(A).slice(_,_+h).buffer,_=0),new s(A,_,c)}function oC(e,t,i){const n=`TEXCOORD_${t.texCoord||0}`,r=i.attributes[n],s=e.getTypedArrayForAccessor(r),o=e.gltf.json,c=t.index,h=o.textures?.[c]?.source;if(typeof h<"u"){const A=o.images?.[h]?.mimeType,_=e.gltf.images?.[h];if(_&&typeof _.width<"u"){const C=[];for(let S=0;S<s.length;S+=2){const L=mvt(_,A,s,S,t.channels);C.push(L)}return C}}return[]}function t8(e,t,i,n,r){if(!i?.length)return;const s=[];for(const _ of i){let C=n.findIndex(S=>S===_);C===-1&&(C=n.push(_)-1),s.push(C)}const o=new Uint32Array(s),c=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,h=e.addBufferView(o,c,0),A=e.addAccessor(h,{size:1,componentType:wv(o),count:o.length});r.attributes[t]=A}function mvt(e,t,i,n,r=[0]){const s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=i[n],c=i[n+1];let h=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(h=4);const A=yvt(o,c,e,h);let _=0;for(const C of r){const S=typeof C=="number"?Object.values(s)[C]:s[C],L=A+S.offset,N=Xx(e);if(N.data.length<=L)throw new Error(`${N.data.length} <= ${L}`);const U=N.data[L];_|=U<<S.shift}return _}function yvt(e,t,i,n=1){const r=i.width,s=ZF(e)*(r-1),o=Math.round(s),c=i.height,h=ZF(t)*(c-1),A=Math.round(h),_=i.components?i.components:n;return(A*r+o)*_}function e8(e,t,i,n,r){const s=[];for(let o=0;o<t;o++){const c=i[o],h=i[o+1]-i[o];if(h+c>n)break;const A=c/r,_=h/r;s.push(e.slice(A,A+_))}return s}function i8(e,t,i){const n=[];for(let r=0;r<t;r++){const s=r*i;n.push(e.slice(s,s+i))}return n}function n8(e,t,i,n){if(i)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){const r=[],s=new TextDecoder("utf8");let o=0;for(let c=0;c<e;c++){const h=n[c+1]-n[c];if(h+o<=t.length){const A=t.subarray(o,h+o),_=s.decode(A);r.push(_),o+=h}}return r}return[]}const Mp="EXT_mesh_features",vvt=Mp;async function _vt(e,t){const i=new zo(e);xvt(i,t)}function bvt(e,t){const i=new zo(e);return Cvt(i),i.createBinaryChunk(),i.gltf}function xvt(e,t){const i=e.gltf.json;if(i.meshes)for(const n of i.meshes)for(const r of n.primitives)wvt(e,r,t)}function wvt(e,t,i){if(!i?.gltf?.loadBuffers)return;const n=t.extensions?.[Mp]?.featureIds;if(n)for(const r of n){let s;if(typeof r.attribute<"u"){const o=`_FEATURE_ID_${r.attribute}`,c=t.attributes[o];s=e.getTypedArrayForAccessor(c)}else typeof r.texture<"u"&&i?.gltf?.loadImages?s=oC(e,r.texture,t):s=[];r.data=s}}function Cvt(e,t){const i=e.gltf.json.meshes;if(i)for(const n of i)for(const r of n.primitives)Bvt(e,r)}function Evt(e,t,i,n){t.extensions||(t.extensions={});let r=t.extensions[Mp];r||(r={featureIds:[]},t.extensions[Mp]=r);const{featureIds:s}=r,o={featureCount:i.length,propertyTable:n,data:i};s.push(o),e.addObjectExtension(t,Mp,r)}function Bvt(e,t){const i=t.extensions?.[Mp];if(!i)return;const n=i.featureIds;n.forEach((r,s)=>{if(r.data){const{accessorKey:o,index:c}=Tvt(t.attributes),h=new Uint32Array(r.data);n[s]={featureCount:h.length,propertyTable:r.propertyTable,attribute:c},e.gltf.buffers.push({arrayBuffer:h.buffer,byteOffset:h.byteOffset,byteLength:h.byteLength});const A=e.addBufferView(h),_=e.addAccessor(A,{size:1,componentType:wv(h),count:h.length});t.attributes[o]=_}})}function Tvt(e){const t="_FEATURE_ID_",i=Object.keys(e).filter(r=>r.indexOf(t)===0);let n=-1;for(const r of i){const s=Number(r.substring(t.length));s>n&&(n=s)}return n++,{accessorKey:`${t}${n}`,index:n}}const Svt=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:Evt,decode:_vt,encode:bvt,name:vvt},Symbol.toStringTag,{value:"Module"})),Pp="EXT_structural_metadata",Ivt=Pp;async function Mvt(e,t){const i=new zo(e);Rvt(i,t)}function Pvt(e,t){const i=new zo(e);return Qvt(i),i.createBinaryChunk(),i.gltf}function Rvt(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(Pp);i&&(t.gltf?.loadImages&&Dvt(e,i),Ovt(e,i))}function Dvt(e,t){const i=t.propertyTextures,n=e.gltf.json;if(i&&n.meshes)for(const r of n.meshes)for(const s of r.primitives)Fvt(e,i,s,t)}function Ovt(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.propertyTables;if(n&&r)for(const s in n){const o=Lvt(r,s);o&&Nvt(e,i,o)}}function Lvt(e,t){for(const i of e)if(i.class===t)return i;return null}function Fvt(e,t,i,n){if(!t)return;const r=i.extensions?.[Pp]?.propertyTextures;if(r)for(const s of r){const o=t[s];kvt(e,o,i,n)}}function kvt(e,t,i,n){if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);const r=t.class;for(const s in t.properties){const o=`${r}_${s}`,c=t.properties?.[s];if(!c)continue;c.data||(c.data=[]);const h=c.data,A=oC(e,c,i);A!==null&&(t8(e,o,A,h,i),c.data=h,n.dataAttributeNames.push(o))}}function Nvt(e,t,i){const n=t.classes?.[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const s in n.properties){const o=n.properties[s],c=i.properties?.[s];if(c){const h=Uvt(e,t,o,r,c);c.data=h}}}function Uvt(e,t,i,n,r){let s=[];const o=r.values,c=e.getTypedArrayForBufferView(o),h=zvt(e,i,r,n),A=Gvt(e,r,n);switch(i.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=jvt(i,n,c,h);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${i.type}`);case"STRING":{s=n8(n,c,h,A);break}case"ENUM":{s=Vvt(t,i,n,c,h);break}default:throw new Error(`Unknown classProperty type ${i.type}`)}return s}function zvt(e,t,i,n){return t.array&&typeof t.count>"u"&&typeof i.arrayOffsets<"u"?Cv(e,i.arrayOffsets,i.arrayOffsetType||"UINT32",n):null}function Gvt(e,t,i){return typeof t.stringOffsets<"u"?Cv(e,t.stringOffsets,t.stringOffsetType||"UINT32",i):null}function jvt(e,t,i,n){const r=e.array,s=e.count,o=rC(e.type,e.componentType),c=i.byteLength/o;let h;return e.componentType?h=Ev(i,e.type,e.componentType,c):h=i,r?n?e8(h,t,n,i.length,o):s?i8(h,t,s):[]:h}function Vvt(e,t,i,n,r){const s=t.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=e.enums?.[s];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);const c=o.valueType||"UINT16",h=rC(t.type,c),A=n.byteLength/h;let _=Ev(n,t.type,c,A);if(_||(_=n),t.array){if(r)return Hvt({valuesData:_,numberOfElements:i,arrayOffsets:r,valuesDataBytesLength:n.length,elementSize:h,enumEntry:o});const C=t.count;return C?Wvt(_,i,C,o):[]}return sC(_,0,i,o)}function Hvt(e){const{valuesData:t,numberOfElements:i,arrayOffsets:n,valuesDataBytesLength:r,elementSize:s,enumEntry:o}=e,c=[];for(let h=0;h<i;h++){const A=n[h],_=n[h+1]-n[h];if(_+A>r)break;const C=A/s,S=_/s,L=sC(t,C,S,o);c.push(L)}return c}function Wvt(e,t,i,n){const r=[];for(let s=0;s<t;s++){const o=i*s,c=sC(e,o,i,n);r.push(c)}return r}function sC(e,t,i,n){const r=[];for(let s=0;s<i;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+s],c=Jvt(n,o);c?r.push(c.name):r.push("")}return r}function Jvt(e,t){for(const i of e.values)if(i.value===t)return i;return null}const Xvt="schemaClassId";function Qvt(e,t){const i=e.getExtension(Pp);if(i&&i.propertyTables)for(const n of i.propertyTables){const r=n.class,s=i.schema?.classes?.[r];n.properties&&s&&Kvt(n,s,e)}}function Kvt(e,t,i){for(const n in e.properties){const r=e.properties[n].data;if(r){const s=t.properties[n];if(s){const o=$vt(r,s,i);e.properties[n]=o}}}}function qvt(e,t,i=Xvt){let n=e.getExtension(Pp);n||(n=e.addExtension(Pp)),n.schema=Zvt(t,i,n.schema);const r=Yvt(t,i,n.schema);return n.propertyTables||(n.propertyTables=[]),n.propertyTables.push(r)-1}function Zvt(e,t,i){const n=i??{id:"schema_id"},r={properties:{}};for(const s of e){const o={type:s.elementType,componentType:s.componentType};r.properties[s.name]=o}return n.classes={},n.classes[t]=r,n}function Yvt(e,t,i){const n={class:t,count:0};let r=0;const s=i.classes?.[t];for(const o of e){if(r===0&&(r=o.values.length),r!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");s?.properties[o.name]&&(n.properties||(n.properties={}),n.properties[o.name]={values:0,data:o.values})}return n.count=r,n}function $vt(e,t,i){const n={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:s}=i_t(e);n.stringOffsets=aC(s,i),n.values=aC(r,i)}else if(t.type==="SCALAR"&&t.componentType){const r=e_t(e,t.componentType);n.values=aC(r,i)}return n}const t_t={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function e_t(e,t){const i=[];for(const r of e)i.push(Number(r));const n=t_t[t];if(!n)throw new Error("Illegal component type");return new n(i)}function i_t(e){const t=new TextEncoder,i=[];let n=0;for(const h of e){const A=t.encode(h);n+=A.length,i.push(A)}const r=new Uint8Array(n),s=[];let o=0;for(const h of i)r.set(h,o),s.push(o),o+=h.length;s.push(o);const c=new Uint32Array(s);return{stringData:r,stringOffsets:c}}function aC(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}const n_t=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:qvt,decode:Mvt,encode:Pvt,name:Ivt},Symbol.toStringTag,{value:"Module"})),r8="EXT_feature_metadata",r_t=r8;async function o_t(e,t){const i=new zo(e);s_t(i,t)}function s_t(e,t){if(!t.gltf?.loadBuffers)return;const i=e.getExtension(r8);i&&(t.gltf?.loadImages&&a_t(e,i),c_t(e,i))}function a_t(e,t){const i=t.schema;if(!i)return;const n=i.classes,{featureTextures:r}=t;if(n&&r)for(const s in n){const o=n[s],c=u_t(r,s);c&&f_t(e,c,o)}}function c_t(e,t){const i=t.schema;if(!i)return;const n=i.classes,r=t.featureTables;if(n&&r)for(const s in n){const o=l_t(r,s);o&&h_t(e,i,o)}}function l_t(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function u_t(e,t){for(const i in e){const n=e[i];if(n.class===t)return n}return null}function h_t(e,t,i){if(!i.class)return;const n=t.classes?.[i.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${i.class}`);const r=i.count;for(const s in n.properties){const o=n.properties[s],c=i.properties?.[s];if(c){const h=d_t(e,t,o,r,c);c.data=h}}}function f_t(e,t,i){const n=t.class;for(const r in i.properties){const s=t?.properties?.[r];if(s){const o=y_t(e,s,n);s.data=o}}}function d_t(e,t,i,n,r){let s=[];const o=r.bufferView,c=e.getTypedArrayForBufferView(o),h=p_t(e,i,r,n),A=A_t(e,i,r,n);return i.type==="STRING"||i.componentType==="STRING"?s=n8(n,c,h,A):g_t(i)&&(s=m_t(i,n,c,h)),s}function p_t(e,t,i,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof i.arrayOffsetBufferView<"u"?Cv(e,i.arrayOffsetBufferView,i.offsetType||"UINT32",n):null}function A_t(e,t,i,n){return typeof i.stringOffsetBufferView<"u"?Cv(e,i.stringOffsetBufferView,i.offsetType||"UINT32",n):null}function g_t(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function m_t(e,t,i,n){const r=e.type==="ARRAY",s=e.componentCount,o="SCALAR",c=e.componentType||e.type,h=rC(o,c),A=i.byteLength/h,_=Ev(i,o,c,A);return r?n?e8(_,t,n,i.length,h):s?i8(_,t,s):[]:_}function y_t(e,t,i){const n=e.gltf.json;if(!n.meshes)return[];const r=[];for(const s of n.meshes)for(const o of s.primitives)v_t(e,i,t,r,o);return r}function v_t(e,t,i,n,r){const s={channels:i.channels,...i.texture},o=oC(e,s,r);o&&t8(e,t,o,n,r)}const __t=Object.freeze(Object.defineProperty({__proto__:null,decode:o_t,name:r_t},Symbol.toStringTag,{value:"Module"})),b_t="4.3.1",Rp=!0,o8=1735152710,cC=12,Bv=8,x_t=1313821514,w_t=5130562,C_t=0,E_t=0,B_t=1;function T_t(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function S_t(e,t=0,i={}){const n=new DataView(e),{magic:r=o8}=i,s=n.getUint32(t,!1);return s===r||s===o8}function I_t(e,t,i=0,n={}){const r=new DataView(t),s=T_t(r,i+0),o=r.getUint32(i+4,Rp),c=r.getUint32(i+8,Rp);switch(Object.assign(e,{header:{byteOffset:i,byteLength:c,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),i+=cC,e.version){case 1:return M_t(e,r,i);case 2:return P_t(e,r,i,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function M_t(e,t,i){mr(e.header.byteLength>cC+Bv);const n=t.getUint32(i+0,Rp),r=t.getUint32(i+4,Rp);return i+=Bv,mr(r===C_t),lC(e,t,i,n),i+=n,i+=uC(e,t,i,e.header.byteLength),i}function P_t(e,t,i,n){return mr(e.header.byteLength>cC+Bv),R_t(e,t,i,n),i+e.header.byteLength}function R_t(e,t,i,n){for(;i+8<=e.header.byteLength;){const r=t.getUint32(i+0,Rp),s=t.getUint32(i+4,Rp);switch(i+=Bv,s){case x_t:lC(e,t,i,r);break;case w_t:uC(e,t,i,r);break;case E_t:n.strict||lC(e,t,i,r);break;case B_t:n.strict||uC(e,t,i,r);break}i+=tu(r,4)}return i}function lC(e,t,i,n){const r=new Uint8Array(t.buffer,i,n),s=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(s),tu(n,4)}function uC(e,t,i,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:n,arrayBuffer:t.buffer}),tu(n,4)}function s8(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const i=t.baseUri||t.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return i.substr(0,i.lastIndexOf("/")+1)+e}const D_t="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",O_t="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",L_t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),F_t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),k_t={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},N_t={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function U_t(e,t,i,n,r,s="NONE"){const o=await z_t();V_t(o,o.exports[N_t[r]],e,t,i,n,o.exports[k_t[s||"NONE"]])}let hC;async function z_t(){return hC||(hC=G_t()),hC}async function G_t(){let e=D_t;WebAssembly.validate(L_t)&&(e=O_t,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(j_t(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function j_t(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){const r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?F_t[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}function V_t(e,t,i,n,r,s,o){const c=e.exports.sbrk,h=n+3&-4,A=c(h*r),_=c(s.length),C=new Uint8Array(e.exports.memory.buffer);C.set(s,_);const S=t(A,n,r,_,s.length);if(S===0&&o&&o(A,h,r),i.set(C.subarray(A,A+n*r)),c(A-c(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const Tv="EXT_meshopt_compression",H_t=Tv;async function W_t(e,t){const i=new zo(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const n=[];for(const r of e.json.bufferViews||[])n.push(J_t(i,r));await Promise.all(n),i.removeExtension(Tv)}async function J_t(e,t){const i=e.getObjectExtension(t,Tv);if(i){const{byteOffset:n=0,byteLength:r=0,byteStride:s,count:o,mode:c,filter:h="NONE",buffer:A}=i,_=e.gltf.buffers[A],C=new Uint8Array(_.arrayBuffer,_.byteOffset+n,r),S=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await U_t(S,o,s,C,c,h),e.removeObjectExtension(t,Tv)}}const X_t=Object.freeze(Object.defineProperty({__proto__:null,decode:W_t,name:H_t},Symbol.toStringTag,{value:"Module"})),Dp="EXT_texture_webp",Q_t=Dp;function K_t(e,t){const i=new zo(e);if(!OL("image/webp")){if(i.getRequiredExtensions().includes(Dp))throw new Error(`gltf: Required extension ${Dp} not supported by browser`);return}const{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,Dp);s&&(r.source=s.source),i.removeObjectExtension(r,Dp)}i.removeExtension(Dp)}const q_t=Object.freeze(Object.defineProperty({__proto__:null,name:Q_t,preprocess:K_t},Symbol.toStringTag,{value:"Module"})),Sv="KHR_texture_basisu",Z_t=Sv;function Y_t(e,t){const i=new zo(e),{json:n}=i;for(const r of n.textures||[]){const s=i.getObjectExtension(r,Sv);s&&(r.source=s.source,i.removeObjectExtension(r,Sv))}i.removeExtension(Sv)}const $_t=Object.freeze(Object.defineProperty({__proto__:null,name:Z_t,preprocess:Y_t},Symbol.toStringTag,{value:"Module"}));function t1t(e){const t={};for(const i in e){const n=e[i];if(i!=="indices"){const r=a8(n);t[i]=r}}return t}function a8(e){const{buffer:t,size:i,count:n}=e1t(e);return{value:t,size:i,byteOffset:0,count:n,type:KF(i),componentType:wv(t)}}function e1t(e){let t=e,i=1,n=0;return e&&e.value&&(t=e.value,i=e.size||1),t&&(ArrayBuffer.isView(t)||(t=i1t(t,Float32Array)),n=t.length/i),{buffer:t,size:i,count:n}}function i1t(e,t,i=!1){return e?Array.isArray(e)?new t(e):i&&!(e instanceof t)?new t(e):e:null}const hh="KHR_draco_mesh_compression",n1t=hh;function r1t(e,t,i){const n=new zo(e);for(const r of c8(n))n.getObjectExtension(r,hh)}async function o1t(e,t,i){if(!t?.gltf?.decompressMeshes)return;const n=new zo(e),r=[];for(const s of c8(n))n.getObjectExtension(s,hh)&&r.push(a1t(n,s,t,i));await Promise.all(r),n.removeExtension(hh)}function s1t(e,t={}){const i=new zo(e);for(const n of i.json.meshes||[])c1t(n),i.addRequiredExtension(hh)}async function a1t(e,t,i,n){const r=e.getObjectExtension(t,hh);if(!r)return;const s=e.getTypedArrayForBufferView(r.bufferView),o=Fg(s.buffer,s.byteOffset),c={...i};delete c["3d-tiles"];const h=await ff(o,Lw,c,n),A=t1t(h.attributes);for(const[_,C]of Object.entries(A))if(_ in t.attributes){const S=t.attributes[_],L=e.getAccessor(S);L?.min&&L?.max&&(C.min=L.min,C.max=L.max)}t.attributes=A,h.indices&&(t.indices=a8(h.indices)),e.removeObjectExtension(t,hh),l1t(t)}function c1t(e,t,i=4,n,r){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const s=n.DracoWriter.encodeSync({attributes:e}),o=r?.parseSync?.({attributes:e}),c=n._addFauxAttributes(o.attributes),h=n.addBufferView(s);return{primitives:[{attributes:c,mode:i,extensions:{[hh]:{bufferView:h,attributes:c}}}]}}function l1t(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*c8(e){for(const t of e.json.meshes||[])for(const i of t.primitives)yield i}const u1t=Object.freeze(Object.defineProperty({__proto__:null,decode:o1t,encode:s1t,name:n1t,preprocess:r1t},Symbol.toStringTag,{value:"Module"})),Iv="KHR_texture_transform",h1t=Iv,Mv=new fe,f1t=new gr,d1t=new gr;async function p1t(e,t){if(!new zo(e).hasExtension(Iv)||!t.gltf?.loadBuffers)return;const i=e.json.materials||[];for(let n=0;n<i.length;n++)A1t(n,e)}function A1t(e,t){const i=t.json.materials?.[e],n=[i?.pbrMetallicRoughness?.baseColorTexture,i?.emissiveTexture,i?.normalTexture,i?.occlusionTexture,i?.pbrMetallicRoughness?.metallicRoughnessTexture],r=[];for(const s of n)s&&s?.extensions?.[Iv]&&g1t(t,e,s,r)}function g1t(e,t,i,n){const r=m1t(i,n);if(!r)return;const s=e.json.meshes||[];for(const o of s)for(const c of o.primitives){const h=c.material;Number.isFinite(h)&&t===h&&y1t(e,c,r)}}function m1t(e,t){const i=e.extensions?.[Iv],{texCoord:n=0}=e,{texCoord:r=n}=i;if(t.findIndex(([s,o])=>s===n&&o===r)===-1){const s=b1t(i);return n!==r&&(e.texCoord=r),t.push([n,r]),{originalTexCoord:n,texCoord:r,matrix:s}}return null}function y1t(e,t,i){const{originalTexCoord:n,texCoord:r,matrix:s}=i,o=t.attributes[`TEXCOORD_${n}`];if(Number.isFinite(o)){const c=e.json.accessors?.[o];if(c&&c.bufferView){const h=e.json.bufferViews?.[c.bufferView];if(h){const{arrayBuffer:A,byteOffset:_}=e.buffers[h.buffer],C=(_||0)+(c.byteOffset||0)+(h.byteOffset||0),{ArrayType:S,length:L}=nC(c,h),N=XF[c.componentType],U=JF[c.type],H=h.byteStride||N*U,j=new Float32Array(L);for(let tt=0;tt<c.count;tt++){const K=new S(A,C+tt*H,2);Mv.set(K[0],K[1],1),Mv.transformByMatrix3(s),j.set([Mv[0],Mv[1]],tt*U)}n===r?v1t(c,h,e.buffers,j):_1t(r,c,t,e,j)}}}}function v1t(e,t,i,n){e.componentType=5126,i.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=i.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function _1t(e,t,i,n,r){n.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const s=n.json.bufferViews;if(!s)return;s.push({buffer:n.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=n.json.accessors;o&&(o.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),i.attributes[`TEXCOORD_${e}`]=o.length-1)}function b1t(e){const{offset:t=[0,0],rotation:i=0,scale:n=[1,1]}=e,r=new gr().set(1,0,0,0,1,0,t[0],t[1],1),s=f1t.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),o=d1t.set(n[0],0,0,0,n[1],0,0,0,1);return r.multiplyRight(s).multiplyRight(o)}const x1t=Object.freeze(Object.defineProperty({__proto__:null,decode:p1t,name:h1t},Symbol.toStringTag,{value:"Module"})),vf="KHR_lights_punctual",w1t=vf;async function C1t(e){const t=new zo(e),{json:i}=t,n=t.getExtension(vf);n&&(t.json.lights=n.lights,t.removeExtension(vf));for(const r of i.nodes||[]){const s=t.getObjectExtension(r,vf);s&&(r.light=s.light),t.removeObjectExtension(r,vf)}}async function E1t(e){const t=new zo(e),{json:i}=t;if(i.lights){const n=t.addExtension(vf);ma(!n.lights),n.lights=i.lights,delete i.lights}if(t.json.lights){for(const n of t.json.lights){const r=n.node;t.addObjectExtension(r,vf,n)}delete t.json.lights}}const B1t=Object.freeze(Object.defineProperty({__proto__:null,decode:C1t,encode:E1t,name:w1t},Symbol.toStringTag,{value:"Module"})),qg="KHR_materials_unlit",T1t=qg;async function S1t(e){const t=new zo(e),{json:i}=t;for(const n of i.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,qg);t.removeExtension(qg)}function I1t(e){const t=new zo(e),{json:i}=t;if(t.materials)for(const n of i.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,qg,{}),t.addExtension(qg))}const M1t=Object.freeze(Object.defineProperty({__proto__:null,decode:S1t,encode:I1t,name:T1t},Symbol.toStringTag,{value:"Module"})),Zg="KHR_techniques_webgl",P1t=Zg;async function R1t(e){const t=new zo(e),{json:i}=t,n=t.getExtension(Zg);if(n){const r=O1t(n,t);for(const s of i.materials||[]){const o=t.getObjectExtension(s,Zg);o&&(s.technique=Object.assign({},o,r[o.technique]),s.technique.values=L1t(s.technique,t)),t.removeObjectExtension(s,Zg)}t.removeExtension(Zg)}}async function D1t(e,t){}function O1t(e,t){const{programs:i=[],shaders:n=[],techniques:r=[]}=e,s=new TextDecoder;return n.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),i.forEach(o=>{o.fragmentShader=n[o.fragmentShader],o.vertexShader=n[o.vertexShader]}),r.forEach(o=>{o.program=i[o.program]}),r}function L1t(e,t){const i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in i)&&(i[n]=e.uniforms[n].value)}),Object.keys(i).forEach(n=>{typeof i[n]=="object"&&i[n].index!==void 0&&(i[n].texture=t.getTexture(i[n].index))}),i}const F1t=Object.freeze(Object.defineProperty({__proto__:null,decode:R1t,encode:D1t,name:P1t},Symbol.toStringTag,{value:"Module"})),l8=[n_t,Svt,X_t,q_t,$_t,u1t,B1t,M1t,F1t,x1t,__t];function k1t(e,t={},i){const n=l8.filter(r=>u8(r.name,t));for(const r of n)r.preprocess?.(e,t,i)}async function N1t(e,t={},i){const n=l8.filter(r=>u8(r.name,t));for(const r of n)await r.decode?.(e,t,i)}function u8(e,t){const i=t?.gltf?.excludeExtensions||{};return!(e in i&&!i[e])}const fC="KHR_binary_glTF";function U1t(e){const t=new zo(e),{json:i}=t;for(const n of i.images||[]){const r=t.getObjectExtension(n,fC);r&&Object.assign(n,r),t.removeObjectExtension(n,fC)}i.buffers&&i.buffers[0]&&delete i.buffers[0].uri,t.removeExtension(fC)}const h8={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},z1t={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class G1t{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(t,i){this.json=t.json;const n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!i.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),U1t(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const i in h8)this._convertTopLevelObjectToArray(t,i)}_convertTopLevelObjectToArray(t,i){const n=t[i];if(!(!n||Array.isArray(n))){t[i]=[];for(const r in n){const s=n[r];s.id=s.id||r;const o=t[i].length;t[i].push(s),this.idToIndexMap[i][r]=o}}}_convertObjectIdsToArrayIndices(t){for(const i in h8)this._convertIdsToIndices(t,i);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const i of t.textures)this._convertTextureIds(i);for(const i of t.meshes)this._convertMeshIds(i);for(const i of t.nodes)this._convertNodeIds(i);for(const i of t.scenes)this._convertSceneIds(i)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const i of t.primitives){const{attributes:n,indices:r,material:s}=i;for(const o in n)n[o]=this._convertIdToIndex(n[o],"accessor");r&&(i.indices=this._convertIdToIndex(r,"accessor")),s&&(i.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(i=>this._convertIdToIndex(i,"node"))),t.meshes&&(t.meshes=t.meshes.map(i=>this._convertIdToIndex(i,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(i=>this._convertIdToIndex(i,"node")))}_convertIdsToIndices(t,i){t[i]||(console.warn(`gltf v1: json doesn't contain attribute ${i}`),t[i]=[]);for(const n of t[i])for(const r in n){const s=n[r],o=this._convertIdToIndex(s,r);n[r]=o}}_convertIdToIndex(t,i){const n=z1t[i];if(n in this.idToIndexMap){const r=this.idToIndexMap[n][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${i} with id ${t}`);return r}return t}_updateObjects(t){for(const i of this.json.buffers)delete i.type}_updateMaterial(t){for(const i of t.materials){i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const n=i.values?.tex||i.values?.texture2d_0||i.values?.diffuseTex,r=t.textures.findIndex(s=>s.id===n);r!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:r})}}}function j1t(e,t={}){return new G1t().normalize(e,t)}async function V1t(e,t,i=0,n,r){return H1t(e,t,i,n),j1t(e,{normalize:n?.gltf?.normalize}),k1t(e,n,r),n?.gltf?.loadBuffers&&e.json.buffers&&await W1t(e,n,r),n?.gltf?.loadImages&&await J1t(e,n,r),await N1t(e,n,r),e}function H1t(e,t,i,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!S_t(t,i,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=xL(t);else if(t instanceof ArrayBuffer){const o={};i=I_t(o,t,i,n.glb),ma(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else ma(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const s=e.json.images||[];e.images=new Array(s.length).fill({})}async function W1t(e,t,i){const n=e.json.buffers||[];for(let r=0;r<n.length;++r){const s=n[r];if(s.uri){const{fetch:o}=i;ma(o);const c=s8(s.uri,t),h=await(await i?.fetch?.(c))?.arrayBuffer?.();e.buffers[r]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete s.uri}else e.buffers[r]===null&&(e.buffers[r]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function J1t(e,t,i){const n=X1t(e),r=e.json.images||[],s=[];for(const o of n)s.push(Q1t(e,r[o],o,t,i));return await Promise.all(s)}function X1t(e){const t=new Set,i=e.json.textures||[];for(const n of i)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function Q1t(e,t,i,n,r){let s;if(t.uri&&!t.hasOwnProperty("bufferView")){const c=s8(t.uri,n),{fetch:h}=r;s=await(await h(c)).arrayBuffer(),t.bufferView={data:s}}if(Number.isFinite(t.bufferView)){const c=dvt(e.json,e.buffers,t.bufferView);s=Fg(c.buffer,c.byteOffset,c.byteLength)}ma(s,"glTF image has no data");let o=await ff(s,[zy,q6],{...n,mimeType:t.mimeType,basis:n.basis||{format:Tw()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[i]=o}const Pv={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:b_t,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:K1t,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function K1t(e,t={},i){t={...Pv.options,...t},t.gltf={...Pv.options.gltf,...t.gltf};const{byteOffset:n=0}=t;return await V1t({},e,n,t,i)}const q1t={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Z1t={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Na={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},Y1t={magFilter:Na.TEXTURE_MAG_FILTER,minFilter:Na.TEXTURE_MIN_FILTER,wrapS:Na.TEXTURE_WRAP_S,wrapT:Na.TEXTURE_WRAP_T},$1t={[Na.TEXTURE_MAG_FILTER]:Na.LINEAR,[Na.TEXTURE_MIN_FILTER]:Na.NEAREST_MIPMAP_LINEAR,[Na.TEXTURE_WRAP_S]:Na.REPEAT,[Na.TEXTURE_WRAP_T]:Na.REPEAT};function tbt(){return{id:"default-sampler",parameters:$1t}}function ebt(e){return Z1t[e]}function ibt(e){return q1t[e]}class nbt{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(t,i={}){const{json:n,buffers:r=[],images:s=[]}=t,{baseUri:o=""}=t;return ma(n),this.baseUri=o,this.buffers=r,this.images=s,this.jsonUnprocessed=n,this.json=this._resolveTree(t.json,i),this.json}_resolveTree(t,i={}){const n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((r,s)=>this._resolveBufferView(r,s))),t.images&&(n.images=t.images.map((r,s)=>this._resolveImage(r,s))),t.samplers&&(n.samplers=t.samplers.map((r,s)=>this._resolveSampler(r,s))),t.textures&&(n.textures=t.textures.map((r,s)=>this._resolveTexture(r,s))),t.accessors&&(n.accessors=t.accessors.map((r,s)=>this._resolveAccessor(r,s))),t.materials&&(n.materials=t.materials.map((r,s)=>this._resolveMaterial(r,s))),t.meshes&&(n.meshes=t.meshes.map((r,s)=>this._resolveMesh(r,s))),t.nodes&&(n.nodes=t.nodes.map((r,s)=>this._resolveNode(r,s)),n.nodes=n.nodes.map((r,s)=>this._resolveNodeChildren(r))),t.skins&&(n.skins=t.skins.map((r,s)=>this._resolveSkin(r,s))),t.scenes&&(n.scenes=t.scenes.map((r,s)=>this._resolveScene(r,s))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,i){if(typeof i=="object")return i;const n=t&&t[i];return n||console.warn(`glTF file error: Could not find ${t}[${i}]`),n}_resolveScene(t,i){return{...t,id:t.id||`scene-${i}`,nodes:(t.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(t,i){const n={...t,id:t?.id||`node-${i}`};return t.mesh!==void 0&&(n.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(n.camera=this.getCamera(t.camera)),t.skin!==void 0&&(n.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(n.mesh=t.meshes.reduce((r,s)=>{const o=this.getMesh(s);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),n}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(i=>this.getNode(i))),t}_resolveSkin(t,i){const n=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${i}`,inverseBindMatrices:n}}_resolveMesh(t,i){const n={...t,id:t.id||`mesh-${i}`,primitives:[]};return t.primitives&&(n.primitives=t.primitives.map(r=>{const s={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const c in o)s.attributes[c]=this.getAccessor(o[c]);return r.indices!==void 0&&(s.indices=this.getAccessor(r.indices)),r.material!==void 0&&(s.material=this.getMaterial(r.material)),s})),n}_resolveMaterial(t,i){const n={...t,id:t.id||`material-${i}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};const r=n.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return n}_resolveAccessor(t,i){const n=ebt(t.componentType),r=ibt(t.type),s=n*r,o={...t,id:t.id||`accessor-${i}`,bytesPerComponent:n,components:r,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const c=o.bufferView.buffer,{ArrayType:h,byteLength:A}=nC(o,o.bufferView),_=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+c.byteOffset;let C=c.arrayBuffer.slice(_,_+A);o.bufferView.byteStride&&(C=this._getValueFromInterleavedBuffer(c,_,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new h(C)}return o}_getValueFromInterleavedBuffer(t,i,n,r,s){const o=new Uint8Array(s*r);for(let c=0;c<s;c++){const h=i+c*n;o.set(new Uint8Array(t.arrayBuffer.slice(h,h+r)),c*r)}return o.buffer}_resolveTexture(t,i){return{...t,id:t.id||`texture-${i}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):tbt(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,i){const n={id:t.id||`sampler-${i}`,...t,parameters:{}};for(const r in n){const s=this._enumSamplerParameter(r);s!==void 0&&(n.parameters[s]=n[r])}return n}_enumSamplerParameter(t){return Y1t[t]}_resolveImage(t,i){const n={...t,id:t.id||`image-${i}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},r=this.images[i];return r&&(n.image=r),n}_resolveBufferView(t,i){const n=t.buffer,r=this.buffers[n].arrayBuffer;let s=this.buffers[n].byteOffset||0;return t.byteOffset&&(s+=t.byteOffset),{id:`bufferView-${i}`,...t,buffer:this.buffers[n],data:new Uint8Array(r,s,t.byteLength)}}_resolveCamera(t,i){const n={...t,id:t.id||`camera-${i}`};return n.perspective,n.orthographic,n}}function f8(e,t){return new nbt().postProcess(e,t)}const dC={URI:0,EMBEDDED:1};function d8(e,t,i,n){e.rotateYtoZ=!0;const r=(e.byteOffset||0)+(e.byteLength||0)-i;if(r===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Fg(t,i,r),e.gltfByteOffset=0,e.gltfByteLength=r,i%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function p8(e,t,i,n){const r=i?.["3d-tiles"]||{};if(rbt(e,t),r.loadGLTF){if(!n)return;if(e.gltfUrl){const{fetch:s}=n,o=await s(e.gltfUrl,i);e.gltfArrayBuffer=await o.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const s=await ff(e.gltfArrayBuffer,Pv,i,n);e.gltf=f8(s),e.gpuMemoryUsageInBytes=qF(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function rbt(e,t,i){switch(t){case dC.URI:if(e.gltfArrayBuffer){const n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),r=new TextDecoder().decode(n);e.gltfUrl=r.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case dC.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function obt(e,t,i,n,r){i=sbt(e,t,i,n),await p8(e,dC.EMBEDDED,n,r);const s=e?.gltf?.extensions;return s&&s.CESIUM_RTC&&(e.rtcCenter=s.CESIUM_RTC.center),i}function sbt(e,t,i,n,r){i=xv(e,t,i),i=eC(e,t,i),i=iC(e,t,i),i=d8(e,t,i,n);const s=new $w(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",zn.FLOAT,3),i}async function abt(e,t,i,n,r){return i=cbt(e,t,i,n),await p8(e,e.gltfFormat||0,n,r),i}function cbt(e,t,i,n,r){if(i=xv(e,t,i),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);i=eC(e,t,i);const s=new DataView(t);if(e.gltfFormat=s.getUint32(i,!0),i+=4,i=iC(e,t,i),i=d8(e,t,i,n),!e?.header?.featureTableJsonByteLength||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const o=new $w(e.featureTableJson,e.featureTableBinary),c=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",zn.FLOAT,3);const h=new jF(e.batchTableJson,e.batchTableBinary,c);return lbt(e,o,h,c),i}function lbt(e,t,i,n){const r=new Array(n),s=new fe;new fe,new fe,new fe;const o=new gr,c=new KA,h=new fe,A={},_=new yn,C=[],S=[],L=[],N=[];for(let U=0;U<n;U++){let H;if(t.hasProperty("POSITION"))H=t.getProperty("POSITION",zn.FLOAT,3,U,s);else if(t.hasProperty("POSITION_QUANTIZED")){H=t.getProperty("POSITION_QUANTIZED",zn.UNSIGNED_SHORT,3,U,s);const $=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",zn.FLOAT,3);if(!$)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const zt=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",zn.FLOAT,3);if(!zt)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const Gt=65535;for(let dt=0;dt<3;dt++)H[dt]=H[dt]/Gt*zt[dt]+$[dt]}if(!H)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(s.copy(H),A.translation=s,e.normalUp=t.getProperty("NORMAL_UP",zn.FLOAT,3,U,C),e.normalRight=t.getProperty("NORMAL_RIGHT",zn.FLOAT,3,U,S),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",zn.UNSIGNED_SHORT,2,U,C),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",zn.UNSIGNED_SHORT,2,U,S),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(wr.WGS84.eastNorthUpToFixedFrame(s,_),_.getRotationMatrix3(o)):o.identity()}c.fromMatrix3(o),A.rotation=c,h.set(1,1,1);const j=t.getProperty("SCALE",zn.FLOAT,1,U,L);Number.isFinite(j)&&h.multiplyByScalar(j);const tt=t.getProperty("SCALE_NON_UNIFORM",zn.FLOAT,3,U,C);tt&&h.scale(tt),A.scale=h;let K=t.getProperty("BATCH_ID",zn.UNSIGNED_SHORT,1,U,N);K===void 0&&(K=U);const Q=new yn().fromQuaternion(A.rotation);_.identity(),_.translate(A.translation),_.multiplyRight(Q),_.scale(A.scale);const pt=_.clone();r[U]={modelMatrix:pt,batchId:K}}e.instances=r}async function ubt(e,t,i,n,r,s){i=xv(e,t,i);const o=new DataView(t);for(e.tilesLength=o.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-i>12;){const c={shape:"tile3d"};e.tiles.push(c),i=await s(t,i,n,r,c)}return i}async function hbt(e,t,i,n){if(e.rotateYtoZ=!0,e.gltfUpAxis=i?.["3d-tiles"]?.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",i?.["3d-tiles"]?.loadGLTF){if(!n)return t.byteLength;const r=await ff(t,Pv,i,n);e.gltf=f8(r),e.gpuMemoryUsageInBytes=qF(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function A8(e,t=0,i,n,r={shape:"tile3d"}){switch(r.byteOffset=t,r.type=Myt(e,t),r.type){case Qg.COMPOSITE:return await ubt(r,e,t,i,n,A8);case Qg.BATCHED_3D_MODEL:return await obt(r,e,t,i,n);case Qg.GLTF:return await hbt(r,e,i,n);case Qg.INSTANCED_3D_MODEL:return await abt(r,e,t,i,n);case Qg.POINT_CLOUD:return await Yyt(r,e,t,i,n);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const fbt=1952609651,dbt=1;async function pbt(e,t,i){if(new Uint32Array(e.slice(0,4))[0]!==fbt)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==dbt)throw new Error("Wrong subtree file verson, must be 1");const n=g8(e.slice(8,16)),r=new Uint8Array(e,24,n),s=new TextDecoder("utf8").decode(r),o=JSON.parse(s),c=g8(e.slice(16,24));let h=new ArrayBuffer(0);if(c&&(h=e.slice(24+n)),await Rv(o,o.tileAvailability,h,i),Array.isArray(o.contentAvailability))for(const A of o.contentAvailability)await Rv(o,A,h,i);else await Rv(o,o.contentAvailability,h,i);return await Rv(o,o.childSubtreeAvailability,h,i),o}async function Rv(e,t,i,n){const r=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof r!="number")return;const s=e.bufferViews[r],o=e.buffers[s.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(o.uri){const h=`${n?.baseUrl||""}/${o.uri}`,A=await(await n.fetch(h)).arrayBuffer();t.explicitBitstream=new Uint8Array(A,s.byteOffset,s.byteLength);return}const c=e.buffers.slice(0,s.buffer).reduce((h,A)=>h+A.byteLength,0);t.explicitBitstream=new Uint8Array(i.slice(c,c+o.byteLength),s.byteOffset,s.byteLength)}function g8(e){const t=new DataView(e),i=t.getUint32(0,!0),n=t.getUint32(4,!0);return i+2**32*n}const m8={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:kF,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:pbt,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ua=null;try{Ua=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ar(e,t,i){this.low=e|0,this.high=t|0,this.unsigned=!!i}ar.prototype.__isLong__,Object.defineProperty(ar.prototype,"__isLong__",{value:!0});function _s(e){return(e&&e.__isLong__)===!0}function y8(e){var t=Math.clz32(e&-e);return e?31-t:t}ar.isLong=_s;var v8={},_8={};function _f(e,t){var i,n,r;return t?(e>>>=0,(r=0<=e&&e<256)&&(n=_8[e],n)?n:(i=jn(e,0,!0),r&&(_8[e]=i),i)):(e|=0,(r=-128<=e&&e<128)&&(n=v8[e],n)?n:(i=jn(e,e<0?-1:0,!1),r&&(v8[e]=i),i))}ar.fromInt=_f;function za(e,t){if(isNaN(e))return t?ou:Tc;if(t){if(e<0)return ou;if(e>=x8)return T8}else{if(e<=-w8)return Hs;if(e+1>=w8)return B8}return e<0?za(-e,t).neg():jn(e%Op|0,e/Op|0,t)}ar.fromNumber=za;function jn(e,t,i){return new ar(e,t,i)}ar.fromBits=jn;var Dv=Math.pow;function pC(e,t,i){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(i=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?ou:Tc;if(i=i||10,i<2||36<i)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return pC(e.substring(1),t,i).neg();for(var r=za(Dv(i,8)),s=Tc,o=0;o<e.length;o+=8){var c=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+c),i);if(c<8){var A=za(Dv(i,c));s=s.mul(A).add(za(h))}else s=s.mul(r),s=s.add(za(h))}return s.unsigned=t,s}ar.fromString=pC;function Bc(e,t){return typeof e=="number"?za(e,t):typeof e=="string"?pC(e,t):jn(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}ar.fromValue=Bc;var b8=65536,Abt=1<<24,Op=b8*b8,x8=Op*Op,w8=x8/2,C8=_f(Abt),Tc=_f(0);ar.ZERO=Tc;var ou=_f(0,!0);ar.UZERO=ou;var Lp=_f(1);ar.ONE=Lp;var E8=_f(1,!0);ar.UONE=E8;var AC=_f(-1);ar.NEG_ONE=AC;var B8=jn(-1,2147483647,!1);ar.MAX_VALUE=B8;var T8=jn(-1,-1,!0);ar.MAX_UNSIGNED_VALUE=T8;var Hs=jn(0,-2147483648,!1);ar.MIN_VALUE=Hs;var ii=ar.prototype;ii.toInt=function(){return this.unsigned?this.low>>>0:this.low},ii.toNumber=function(){return this.unsigned?(this.high>>>0)*Op+(this.low>>>0):this.high*Op+(this.low>>>0)},ii.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Hs)){var t=za(e),i=this.div(t),n=i.mul(t).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var r=za(Dv(e,6),this.unsigned),s=this,o="";;){var c=s.div(r),h=s.sub(c.mul(r)).toInt()>>>0,A=h.toString(e);if(s=c,s.isZero())return A+o;for(;A.length<6;)A="0"+A;o=""+A+o}},ii.getHighBits=function(){return this.high},ii.getHighBitsUnsigned=function(){return this.high>>>0},ii.getLowBits=function(){return this.low},ii.getLowBitsUnsigned=function(){return this.low>>>0},ii.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Hs)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1},ii.isZero=function(){return this.high===0&&this.low===0},ii.eqz=ii.isZero,ii.isNegative=function(){return!this.unsigned&&this.high<0},ii.isPositive=function(){return this.unsigned||this.high>=0},ii.isOdd=function(){return(this.low&1)===1},ii.isEven=function(){return(this.low&1)===0},ii.equals=function(e){return _s(e)||(e=Bc(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},ii.eq=ii.equals,ii.notEquals=function(e){return!this.eq(e)},ii.neq=ii.notEquals,ii.ne=ii.notEquals,ii.lessThan=function(e){return this.comp(e)<0},ii.lt=ii.lessThan,ii.lessThanOrEqual=function(e){return this.comp(e)<=0},ii.lte=ii.lessThanOrEqual,ii.le=ii.lessThanOrEqual,ii.greaterThan=function(e){return this.comp(e)>0},ii.gt=ii.greaterThan,ii.greaterThanOrEqual=function(e){return this.comp(e)>=0},ii.gte=ii.greaterThanOrEqual,ii.ge=ii.greaterThanOrEqual,ii.compare=function(e){if(_s(e)||(e=Bc(e)),this.eq(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},ii.comp=ii.compare,ii.negate=function(){return!this.unsigned&&this.eq(Hs)?Hs:this.not().add(Lp)},ii.neg=ii.negate,ii.add=function(e){_s(e)||(e=Bc(e));var t=this.high>>>16,i=this.high&65535,n=this.low>>>16,r=this.low&65535,s=e.high>>>16,o=e.high&65535,c=e.low>>>16,h=e.low&65535,A=0,_=0,C=0,S=0;return S+=r+h,C+=S>>>16,S&=65535,C+=n+c,_+=C>>>16,C&=65535,_+=i+o,A+=_>>>16,_&=65535,A+=t+s,A&=65535,jn(C<<16|S,A<<16|_,this.unsigned)},ii.subtract=function(e){return _s(e)||(e=Bc(e)),this.add(e.neg())},ii.sub=ii.subtract,ii.multiply=function(e){if(this.isZero())return this;if(_s(e)||(e=Bc(e)),Ua){var t=Ua.mul(this.low,this.high,e.low,e.high);return jn(t,Ua.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?ou:Tc;if(this.eq(Hs))return e.isOdd()?Hs:Tc;if(e.eq(Hs))return this.isOdd()?Hs:Tc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(C8)&&e.lt(C8))return za(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,r=this.low>>>16,s=this.low&65535,o=e.high>>>16,c=e.high&65535,h=e.low>>>16,A=e.low&65535,_=0,C=0,S=0,L=0;return L+=s*A,S+=L>>>16,L&=65535,S+=r*A,C+=S>>>16,S&=65535,S+=s*h,C+=S>>>16,S&=65535,C+=n*A,_+=C>>>16,C&=65535,C+=r*h,_+=C>>>16,C&=65535,C+=s*c,_+=C>>>16,C&=65535,_+=i*A+n*h+r*c+s*o,_&=65535,jn(S<<16|L,_<<16|C,this.unsigned)},ii.mul=ii.multiply,ii.divide=function(e){if(_s(e)||(e=Bc(e)),e.isZero())throw Error("division by zero");if(Ua){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ua.div_u:Ua.div_s)(this.low,this.high,e.low,e.high);return jn(t,Ua.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ou:Tc;var i,n,r;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ou;if(e.gt(this.shru(1)))return E8;r=ou}else{if(this.eq(Hs)){if(e.eq(Lp)||e.eq(AC))return Hs;if(e.eq(Hs))return Lp;var s=this.shr(1);return i=s.div(e).shl(1),i.eq(Tc)?e.isNegative()?Lp:AC:(n=this.sub(e.mul(i)),r=i.add(n.div(e)),r)}else if(e.eq(Hs))return this.unsigned?ou:Tc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Tc}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),c=o<=48?1:Dv(2,o-48),h=za(i),A=h.mul(e);A.isNegative()||A.gt(n);)i-=c,h=za(i,this.unsigned),A=h.mul(e);h.isZero()&&(h=Lp),r=r.add(h),n=n.sub(A)}return r},ii.div=ii.divide,ii.modulo=function(e){if(_s(e)||(e=Bc(e)),Ua){var t=(this.unsigned?Ua.rem_u:Ua.rem_s)(this.low,this.high,e.low,e.high);return jn(t,Ua.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},ii.mod=ii.modulo,ii.rem=ii.modulo,ii.not=function(){return jn(~this.low,~this.high,this.unsigned)},ii.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},ii.clz=ii.countLeadingZeros,ii.countTrailingZeros=function(){return this.low?y8(this.low):y8(this.high)+32},ii.ctz=ii.countTrailingZeros,ii.and=function(e){return _s(e)||(e=Bc(e)),jn(this.low&e.low,this.high&e.high,this.unsigned)},ii.or=function(e){return _s(e)||(e=Bc(e)),jn(this.low|e.low,this.high|e.high,this.unsigned)},ii.xor=function(e){return _s(e)||(e=Bc(e)),jn(this.low^e.low,this.high^e.high,this.unsigned)},ii.shiftLeft=function(e){return _s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?jn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):jn(0,this.low<<e-32,this.unsigned)},ii.shl=ii.shiftLeft,ii.shiftRight=function(e){return _s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?jn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):jn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},ii.shr=ii.shiftRight,ii.shiftRightUnsigned=function(e){return _s(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?jn(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?jn(this.high,0,this.unsigned):jn(this.high>>>e-32,0,this.unsigned)},ii.shru=ii.shiftRightUnsigned,ii.shr_u=ii.shiftRightUnsigned,ii.rotateLeft=function(e){var t;return _s(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?jn(this.high,this.low,this.unsigned):e<32?(t=32-e,jn(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,jn(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},ii.rotl=ii.rotateLeft,ii.rotateRight=function(e){var t;return _s(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?jn(this.high,this.low,this.unsigned):e<32?(t=32-e,jn(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,jn(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},ii.rotr=ii.rotateRight,ii.toSigned=function(){return this.unsigned?jn(this.low,this.high,!1):this},ii.toUnsigned=function(){return this.unsigned?this:jn(this.low,this.high,!0)},ii.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},ii.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},ii.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]},ar.fromBytes=function(e,t,i){return i?ar.fromBytesLE(e,t):ar.fromBytesBE(e,t)},ar.fromBytesLE=function(e,t){return new ar(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},ar.fromBytesBE=function(e,t){return new ar(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const gbt=16;function S8(e){e==="X"&&(e="");const t=e.padEnd(gbt,"0");return ar.fromString(t,!0,16)}function mbt(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const i=t%4;t=(t-i)/4;const n=t;t*=4;const r=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-r.length).join("0")+r}function ybt(e,t){const i=vbt(e).shiftRightUnsigned(2);return e.add(ar.fromNumber(2*t+1-4).multiply(i))}function vbt(e){return e.and(e.not().add(1))}const _bt=3,bbt=30,xbt=2*bbt+1,I8=180/Math.PI;function wbt(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),i=parseInt(t[0],10),n=t[1],r=n.length;let s=0;const o=[0,0];for(let c=r-1;c>=0;c--){s=r-c;const h=n[c];let A=0,_=0;h==="1"?_=1:h==="2"?(A=1,_=1):h==="3"&&(A=1);const C=Math.pow(2,s-1);Ebt(C,o,A,_),o[0]+=C*A,o[1]+=C*_}if(i%2===1){const c=o[0];o[0]=o[1],o[1]=c}return{face:i,ij:o,level:s}}function Cbt(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<_bt+xbt;)t="0"+t;const i=t.lastIndexOf("1"),n=t.substring(0,3),r=t.substring(3,i),s=r.length/2,o=ar.fromString(n,!0,2).toString(10);let c="";if(s!==0)for(c=ar.fromString(r,!0,2).toString(4);c.length<s;)c="0"+c;return`${o}/${c}`}function M8(e,t,i){const n=1<<t;return[(e[0]+i[0])/n,(e[1]+i[1])/n]}function P8(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function R8(e){return[P8(e[0]),P8(e[1])]}function D8(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function O8([e,t,i]){const n=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*I8,n*I8]}function Ebt(e,t,i,n){if(n===0){i===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function Bbt(e){const t=M8(e.ij,e.level,[.5,.5]),i=R8(t),n=D8(e.face,i);return O8(n)}const Tbt=100;function L8(e){const{face:t,ij:i,level:n}=e,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(Tbt*Math.pow(2,-n))),o=new Float64Array(4*s*2+2);let c=0,h=0;for(let A=0;A<4;A++){const _=r[A].slice(0),C=r[A+1],S=(C[0]-_[0])/s,L=(C[1]-_[1])/s;for(let N=0;N<s;N++){_[0]+=S,_[1]+=L;const U=M8(i,n,_),H=R8(U),j=D8(t,H),tt=O8(j);Math.abs(tt[1])>89.999&&(tt[0]=h);const K=tt[0]-h;tt[0]+=K>180?-360:K<-180?360:0,o[c++]=tt[0],o[c++]=tt[1],h=tt[0]}}return o[c++]=o[0],o[c++]=o[1],o}function gC(e){const t=Sbt(e);return wbt(t)}function Sbt(e){if(e.indexOf("/")>0)return e;const t=S8(e);return Cbt(t)}function Ibt(e){const t=gC(e);return Bbt(t)}function Mbt(e){let t;if(e.face===2||e.face===5){let i=null,n=0;for(let r=0;r<4;r++){const s=`${e.face}/${r}`,o=gC(s),c=L8(o);(typeof i>"u"||i===null)&&(i=new Float64Array(4*c.length)),i.set(c,n),n+=c.length}t=F8(i)}else{const i=L8(e);t=F8(i)}return t}function F8(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],i=[];for(let n=0;n<e.length;n+=2)t.push(e[n]),i.push(e[n+1]);return t.sort((n,r)=>n-r),i.sort((n,r)=>n-r),{west:t[0],east:t[t.length-1],north:i[i.length-1],south:i[0]}}function Pbt(e,t){const i=t?.minimumHeight||0,n=t?.maximumHeight||0,r=gC(e),s=Mbt(r),o=s.west,c=s.south,h=s.east,A=s.north,_=[];return _.push(new fe(o,A,i)),_.push(new fe(h,A,i)),_.push(new fe(h,c,i)),_.push(new fe(o,c,i)),_.push(new fe(o,A,n)),_.push(new fe(h,A,n)),_.push(new fe(h,c,n)),_.push(new fe(o,c,n)),_}function k8(e){const t=e.token,i={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},n=Pbt(t,i),r=Ibt(t),s=r[0],o=r[1],c=wr.WGS84.cartographicToCartesian([s,o,i.maximumHeight]),h=new fe(c[0],c[1],c[2]);n.push(h);const A=KL(n);return[...A.center,...A.halfAxes]}const Rbt=4,Dbt=8,Obt={QUADTREE:Rbt,OCTREE:Dbt};function Lbt(e,t,i){if(e?.box){const n=S8(e.s2VolumeInfo.token),r=ybt(n,t),s=mbt(r),o={...e.s2VolumeInfo};switch(o.token=s,i){case"OCTREE":const c=e.s2VolumeInfo,h=c.maximumHeight-c.minimumHeight,A=h/2,_=c.minimumHeight+h/2;c.minimumHeight=_-A,c.maximumHeight=_+A;break}return{box:k8(o),s2VolumeInfo:o}}}async function N8(e){const{subtree:t,subtreeData:i={level:0,x:0,y:0,z:0},parentData:n={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:r=0,implicitOptions:s,loaderOptions:o,s2VolumeBox:c}=e,{subdivisionScheme:h,subtreeLevels:A,maximumLevel:_,contentUrlTemplate:C,subtreesUriTemplate:S,basePath:L}=s,N={children:[],lodMetricValue:0,contentUrl:""};if(!_)return i4.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${C} won't be loaded...`),N;const U=n.localLevel+1,H=i.level+U;if(H>_)return N;const j=Obt[h],tt=Math.log2(j),K=r&1,Q=r>>1&1,pt=r>>2&1,$=bf(n.localX,K,1),zt=bf(n.localY,Q,1),Gt=bf(n.localZ,pt,1),dt=bf(i.x,$,U),lt=bf(i.y,zt,U),Lt=bf(i.z,Gt,U),J=bf(n.mortonIndex,r,tt),ut=U===A&&mC(t.childSubtreeAvailability,J);let Et,le,Ct,Rt;if(ut){const Nt=`${L}/${S}`,Zt=yC(Nt,H,dt,lt,Lt);Et=await tp(Zt,m8,o),Rt=0,le={level:H,x:dt,y:lt,z:Lt},Ct={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else Et=t,Rt=(j**U-1)/(j-1)+J,le=i,Ct={mortonIndex:J,localLevel:U,localX:$,localY:zt,localZ:Gt};if(!mC(Et.tileAvailability,Rt))return N;mC(Et.contentAvailability,Rt)&&(N.contentUrl=yC(C,H,dt,lt,Lt));for(let Nt=0;Nt<j;Nt++){const Zt=Lbt(c,Nt,h),re=await N8({subtree:Et,subtreeData:le,parentData:Ct,childIndex:Nt,implicitOptions:s,loaderOptions:o,s2VolumeBox:Zt});(re.contentUrl||re.children.length)&&N.children.push(re)}return N.contentUrl||N.children.length?Fbt(N,{level:H,x:dt,y:lt,z:Lt},s,c):N}function mC(e,t){let i;return Array.isArray(e)?(i=e[0],e.length>1&&i4.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=e,"constant"in i?!!i.constant:i.explicitBitstream?Ubt(t,i.explicitBitstream):!1}function Fbt(e,t,i,n){const{basePath:r,refine:s,getRefine:o,lodMetricType:c,getTileType:h,rootLodMetricValue:A,rootBoundingVolume:_}=i,C=e.contentUrl&&e.contentUrl.replace(`${r}/`,""),S=A/2**t.level,L=n?.box?{box:n.box}:_,N=kbt(L,t,i.subdivisionScheme);return{children:e.children,contentUrl:e.contentUrl,content:{uri:C},id:e.contentUrl,refine:o(s),type:h(e),lodMetricType:c,lodMetricValue:S,geometricError:S,transform:e.transform,boundingVolume:N}}function kbt(e,t,i){if(e.region){const{level:n,x:r,y:s,z:o}=t,[c,h,A,_,C,S]=e.region,L=2**n,N=(A-c)/L,[U,H]=[c+N*r,c+N*(r+1)],j=(_-h)/L,[tt,K]=[h+j*s,h+j*(s+1)];let Q,pt;if(i==="OCTREE"){const $=(S-C)/L;[Q,pt]=[C+$*o,C+$*(o+1)]}else[Q,pt]=[C,S];return{region:[U,tt,H,K,Q,pt]}}if(e.box)return e;throw new Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}function bf(e,t,i){return(e<<i)+t}function yC(e,t,i,n,r){const s=Nbt({level:t,x:i,y:n,z:r});return e.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function Nbt(e){const t={};for(const i in e)t[`{${i}}`]=e[i];return t}function Ubt(e,t){const i=Math.floor(e/8),n=e%8;return(t[i]>>n&1)===1}function vC(e,t=""){if(!t)return ru.EMPTY;const i=t.split("?")[0].split(".").pop();switch(i){case"pnts":return ru.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return ru.SCENEGRAPH;default:return i||ru.EMPTY}}function _C(e){switch(e){case"REPLACE":case"replace":return Ec.REPLACE;case"ADD":case"add":return Ec.ADD;default:return e}}function bC(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const i=new URL(e,`${t}/`);return decodeURI(i.toString())}else if(e.startsWith("/"))return e;return sht(t,e)}function U8(e,t){if(!e)return null;let i;if(e.content){const n=e.content.uri||e.content?.url;typeof n<"u"&&(i=bC(n,t))}return{...e,id:i,contentUrl:i,lodMetricType:Sp.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:vC(e,i),refine:_C(e.refine)}}async function zbt(e,t,i){let n=null;const r=G8(e.root);r&&e.root?n=await z8(e.root,e,t,r,i):n=U8(e.root,t);const s=[];for(s.push(n);s.length>0;){const o=s.pop()||{},c=o.children||[],h=[];for(const A of c){const _=G8(A);let C;_?C=await z8(A,e,t,_,i):C=U8(A,t),C&&(h.push(C),s.push(C))}o.children=h}return n}async function z8(e,t,i,n,r){const{subdivisionScheme:s,maximumLevel:o,availableLevels:c,subtreeLevels:h,subtrees:{uri:A}}=n,_=yC(A,0,0,0,0),C=bC(_,i),S=await tp(C,m8,r),L=e.content?.uri,N=L?bC(L,i):"",U=t?.root?.refine,H=e.geometricError,j=e.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(j){const Q={box:k8(j),s2VolumeInfo:j};e.boundingVolume=Q}const tt=e.boundingVolume,K={contentUrlTemplate:N,subtreesUriTemplate:A,subdivisionScheme:s,subtreeLevels:h,maximumLevel:Number.isFinite(c)?c-1:o,refine:U,basePath:i,lodMetricType:Sp.GEOMETRIC_ERROR,rootLodMetricValue:H,rootBoundingVolume:tt,getTileType:vC,getRefine:_C};return await Gbt(e,i,S,K,r)}async function Gbt(e,t,i,n,r){if(!e)return null;const{children:s,contentUrl:o}=await N8({subtree:i,implicitOptions:n,loaderOptions:r});let c,h=null;return o&&(c=o,h={uri:o.replace(`${t}/`,"")}),{...e,id:c,contentUrl:c,lodMetricType:Sp.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:vC(e,c),refine:_C(e.refine),content:h||e.content,children:s}}function G8(e){return e?.extensions?.["3DTILES_implicit_tiling"]||e?.implicitTiling}const j8={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:kF,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:jbt,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function jbt(e,t={},i){const n=t["3d-tiles"]||{};let r;return n.isTileset==="auto"?r=i?.url&&i.url.indexOf(".json")!==-1:r=n.isTileset,r?Vbt(e,t,i):Hbt(e,t,i)}async function Vbt(e,t,i){const n=JSON.parse(new TextDecoder().decode(e)),r=i?.url||"",s=Wbt(r),o=await zbt(n,s,t||{});return{...n,shape:"tileset3d",loader:j8,url:r,queryString:i?.queryString||"",basePath:s,root:o||n.root,type:js.TILES3D,lodMetricType:Sp.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0}}async function Hbt(e,t,i){const n={content:{shape:"tile3d",featureIds:null}};return await A8(e,0,t,i,n.content),n.content}function Wbt(e){return EL(e)}var V8={},H8;function fh(){return H8||(H8=1,function(e){var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function i(s,o){return Object.prototype.hasOwnProperty.call(s,o)}e.assign=function(s){for(var o=Array.prototype.slice.call(arguments,1);o.length;){var c=o.shift();if(c){if(typeof c!="object")throw new TypeError(c+"must be non-object");for(var h in c)i(c,h)&&(s[h]=c[h])}}return s},e.shrinkBuf=function(s,o){return s.length===o?s:s.subarray?s.subarray(0,o):(s.length=o,s)};var n={arraySet:function(s,o,c,h,A){if(o.subarray&&s.subarray){s.set(o.subarray(c,c+h),A);return}for(var _=0;_<h;_++)s[A+_]=o[c+_]},flattenChunks:function(s){var o,c,h,A,_,C;for(h=0,o=0,c=s.length;o<c;o++)h+=s[o].length;for(C=new Uint8Array(h),A=0,o=0,c=s.length;o<c;o++)_=s[o],C.set(_,A),A+=_.length;return C}},r={arraySet:function(s,o,c,h,A){for(var _=0;_<h;_++)s[A+_]=o[c+_]},flattenChunks:function(s){return[].concat.apply([],s)}};e.setTyped=function(s){s?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,r))},e.setTyped(t)}(V8)),V8}var Fp={},Sc={},xf={},W8;function Jbt(){if(W8)return xf;W8=1;var e=fh(),t=4,i=0,n=1,r=2;function s(St){for(var ke=St.length;--ke>=0;)St[ke]=0}var o=0,c=1,h=2,A=3,_=258,C=29,S=256,L=S+1+C,N=30,U=19,H=2*L+1,j=15,tt=16,K=7,Q=256,pt=16,$=17,zt=18,Gt=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],dt=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],lt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Lt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],J=512,ut=new Array((L+2)*2);s(ut);var Et=new Array(N*2);s(Et);var le=new Array(J);s(le);var Ct=new Array(_-A+1);s(Ct);var Rt=new Array(C);s(Rt);var Nt=new Array(N);s(Nt);function Zt(St,ke,Je,li,Yt){this.static_tree=St,this.extra_bits=ke,this.extra_base=Je,this.elems=li,this.max_length=Yt,this.has_stree=St&&St.length}var re,se,de;function Me(St,ke){this.dyn_tree=St,this.max_code=0,this.stat_desc=ke}function Se(St){return St<256?le[St]:le[256+(St>>>7)]}function oe(St,ke){St.pending_buf[St.pending++]=ke&255,St.pending_buf[St.pending++]=ke>>>8&255}function Ai(St,ke,Je){St.bi_valid>tt-Je?(St.bi_buf|=ke<<St.bi_valid&65535,oe(St,St.bi_buf),St.bi_buf=ke>>tt-St.bi_valid,St.bi_valid+=Je-tt):(St.bi_buf|=ke<<St.bi_valid&65535,St.bi_valid+=Je)}function Ke(St,ke,Je){Ai(St,Je[ke*2],Je[ke*2+1])}function qe(St,ke){var Je=0;do Je|=St&1,St>>>=1,Je<<=1;while(--ke>0);return Je>>>1}function Ve(St){St.bi_valid===16?(oe(St,St.bi_buf),St.bi_buf=0,St.bi_valid=0):St.bi_valid>=8&&(St.pending_buf[St.pending++]=St.bi_buf&255,St.bi_buf>>=8,St.bi_valid-=8)}function di(St,ke){var Je=ke.dyn_tree,li=ke.max_code,Yt=ke.stat_desc.static_tree,Re=ke.stat_desc.has_stree,gt=ke.stat_desc.extra_bits,ze=ke.stat_desc.extra_base,we=ke.stat_desc.max_length,V,ve,Be,xt,Xt,ce,q=0;for(xt=0;xt<=j;xt++)St.bl_count[xt]=0;for(Je[St.heap[St.heap_max]*2+1]=0,V=St.heap_max+1;V<H;V++)ve=St.heap[V],xt=Je[Je[ve*2+1]*2+1]+1,xt>we&&(xt=we,q++),Je[ve*2+1]=xt,!(ve>li)&&(St.bl_count[xt]++,Xt=0,ve>=ze&&(Xt=gt[ve-ze]),ce=Je[ve*2],St.opt_len+=ce*(xt+Xt),Re&&(St.static_len+=ce*(Yt[ve*2+1]+Xt)));if(q!==0){do{for(xt=we-1;St.bl_count[xt]===0;)xt--;St.bl_count[xt]--,St.bl_count[xt+1]+=2,St.bl_count[we]--,q-=2}while(q>0);for(xt=we;xt!==0;xt--)for(ve=St.bl_count[xt];ve!==0;)Be=St.heap[--V],!(Be>li)&&(Je[Be*2+1]!==xt&&(St.opt_len+=(xt-Je[Be*2+1])*Je[Be*2],Je[Be*2+1]=xt),ve--)}}function cn(St,ke,Je){var li=new Array(j+1),Yt=0,Re,gt;for(Re=1;Re<=j;Re++)li[Re]=Yt=Yt+Je[Re-1]<<1;for(gt=0;gt<=ke;gt++){var ze=St[gt*2+1];ze!==0&&(St[gt*2]=qe(li[ze]++,ze))}}function Ri(){var St,ke,Je,li,Yt,Re=new Array(j+1);for(Je=0,li=0;li<C-1;li++)for(Rt[li]=Je,St=0;St<1<<Gt[li];St++)Ct[Je++]=li;for(Ct[Je-1]=li,Yt=0,li=0;li<16;li++)for(Nt[li]=Yt,St=0;St<1<<dt[li];St++)le[Yt++]=li;for(Yt>>=7;li<N;li++)for(Nt[li]=Yt<<7,St=0;St<1<<dt[li]-7;St++)le[256+Yt++]=li;for(ke=0;ke<=j;ke++)Re[ke]=0;for(St=0;St<=143;)ut[St*2+1]=8,St++,Re[8]++;for(;St<=255;)ut[St*2+1]=9,St++,Re[9]++;for(;St<=279;)ut[St*2+1]=7,St++,Re[7]++;for(;St<=287;)ut[St*2+1]=8,St++,Re[8]++;for(cn(ut,L+1,Re),St=0;St<N;St++)Et[St*2+1]=5,Et[St*2]=qe(St,5);re=new Zt(ut,Gt,S+1,L,j),se=new Zt(Et,dt,0,N,j),de=new Zt(new Array(0),lt,0,U,K)}function bi(St){var ke;for(ke=0;ke<L;ke++)St.dyn_ltree[ke*2]=0;for(ke=0;ke<N;ke++)St.dyn_dtree[ke*2]=0;for(ke=0;ke<U;ke++)St.bl_tree[ke*2]=0;St.dyn_ltree[Q*2]=1,St.opt_len=St.static_len=0,St.last_lit=St.matches=0}function Vn(St){St.bi_valid>8?oe(St,St.bi_buf):St.bi_valid>0&&(St.pending_buf[St.pending++]=St.bi_buf),St.bi_buf=0,St.bi_valid=0}function yi(St,ke,Je,li){Vn(St),oe(St,Je),oe(St,~Je),e.arraySet(St.pending_buf,St.window,ke,Je,St.pending),St.pending+=Je}function vi(St,ke,Je,li){var Yt=ke*2,Re=Je*2;return St[Yt]<St[Re]||St[Yt]===St[Re]&&li[ke]<=li[Je]}function un(St,ke,Je){for(var li=St.heap[Je],Yt=Je<<1;Yt<=St.heap_len&&(Yt<St.heap_len&&vi(ke,St.heap[Yt+1],St.heap[Yt],St.depth)&&Yt++,!vi(ke,li,St.heap[Yt],St.depth));)St.heap[Je]=St.heap[Yt],Je=Yt,Yt<<=1;St.heap[Je]=li}function Di(St,ke,Je){var li,Yt,Re=0,gt,ze;if(St.last_lit!==0)do li=St.pending_buf[St.d_buf+Re*2]<<8|St.pending_buf[St.d_buf+Re*2+1],Yt=St.pending_buf[St.l_buf+Re],Re++,li===0?Ke(St,Yt,ke):(gt=Ct[Yt],Ke(St,gt+S+1,ke),ze=Gt[gt],ze!==0&&(Yt-=Rt[gt],Ai(St,Yt,ze)),li--,gt=Se(li),Ke(St,gt,Je),ze=dt[gt],ze!==0&&(li-=Nt[gt],Ai(St,li,ze)));while(Re<St.last_lit);Ke(St,Q,ke)}function lr(St,ke){var Je=ke.dyn_tree,li=ke.stat_desc.static_tree,Yt=ke.stat_desc.has_stree,Re=ke.stat_desc.elems,gt,ze,we=-1,V;for(St.heap_len=0,St.heap_max=H,gt=0;gt<Re;gt++)Je[gt*2]!==0?(St.heap[++St.heap_len]=we=gt,St.depth[gt]=0):Je[gt*2+1]=0;for(;St.heap_len<2;)V=St.heap[++St.heap_len]=we<2?++we:0,Je[V*2]=1,St.depth[V]=0,St.opt_len--,Yt&&(St.static_len-=li[V*2+1]);for(ke.max_code=we,gt=St.heap_len>>1;gt>=1;gt--)un(St,Je,gt);V=Re;do gt=St.heap[1],St.heap[1]=St.heap[St.heap_len--],un(St,Je,1),ze=St.heap[1],St.heap[--St.heap_max]=gt,St.heap[--St.heap_max]=ze,Je[V*2]=Je[gt*2]+Je[ze*2],St.depth[V]=(St.depth[gt]>=St.depth[ze]?St.depth[gt]:St.depth[ze])+1,Je[gt*2+1]=Je[ze*2+1]=V,St.heap[1]=V++,un(St,Je,1);while(St.heap_len>=2);St.heap[--St.heap_max]=St.heap[1],di(St,ke),cn(Je,we,St.bl_count)}function Yn(St,ke,Je){var li,Yt=-1,Re,gt=ke[0*2+1],ze=0,we=7,V=4;for(gt===0&&(we=138,V=3),ke[(Je+1)*2+1]=65535,li=0;li<=Je;li++)Re=gt,gt=ke[(li+1)*2+1],!(++ze<we&&Re===gt)&&(ze<V?St.bl_tree[Re*2]+=ze:Re!==0?(Re!==Yt&&St.bl_tree[Re*2]++,St.bl_tree[pt*2]++):ze<=10?St.bl_tree[$*2]++:St.bl_tree[zt*2]++,ze=0,Yt=Re,gt===0?(we=138,V=3):Re===gt?(we=6,V=3):(we=7,V=4))}function mn(St,ke,Je){var li,Yt=-1,Re,gt=ke[0*2+1],ze=0,we=7,V=4;for(gt===0&&(we=138,V=3),li=0;li<=Je;li++)if(Re=gt,gt=ke[(li+1)*2+1],!(++ze<we&&Re===gt)){if(ze<V)do Ke(St,Re,St.bl_tree);while(--ze!==0);else Re!==0?(Re!==Yt&&(Ke(St,Re,St.bl_tree),ze--),Ke(St,pt,St.bl_tree),Ai(St,ze-3,2)):ze<=10?(Ke(St,$,St.bl_tree),Ai(St,ze-3,3)):(Ke(St,zt,St.bl_tree),Ai(St,ze-11,7));ze=0,Yt=Re,gt===0?(we=138,V=3):Re===gt?(we=6,V=3):(we=7,V=4)}}function ir(St){var ke;for(Yn(St,St.dyn_ltree,St.l_desc.max_code),Yn(St,St.dyn_dtree,St.d_desc.max_code),lr(St,St.bl_desc),ke=U-1;ke>=3&&St.bl_tree[Lt[ke]*2+1]===0;ke--);return St.opt_len+=3*(ke+1)+5+5+4,ke}function Hn(St,ke,Je,li){var Yt;for(Ai(St,ke-257,5),Ai(St,Je-1,5),Ai(St,li-4,4),Yt=0;Yt<li;Yt++)Ai(St,St.bl_tree[Lt[Yt]*2+1],3);mn(St,St.dyn_ltree,ke-1),mn(St,St.dyn_dtree,Je-1)}function Tn(St){var ke=4093624447,Je;for(Je=0;Je<=31;Je++,ke>>>=1)if(ke&1&&St.dyn_ltree[Je*2]!==0)return i;if(St.dyn_ltree[9*2]!==0||St.dyn_ltree[10*2]!==0||St.dyn_ltree[13*2]!==0)return n;for(Je=32;Je<S;Je++)if(St.dyn_ltree[Je*2]!==0)return n;return i}var $n=!1;function Ge(St){$n||(Ri(),$n=!0),St.l_desc=new Me(St.dyn_ltree,re),St.d_desc=new Me(St.dyn_dtree,se),St.bl_desc=new Me(St.bl_tree,de),St.bi_buf=0,St.bi_valid=0,bi(St)}function gi(St,ke,Je,li){Ai(St,(o<<1)+(li?1:0),3),yi(St,ke,Je)}function Mi(St){Ai(St,c<<1,3),Ke(St,Q,ut),Ve(St)}function rn(St,ke,Je,li){var Yt,Re,gt=0;St.level>0?(St.strm.data_type===r&&(St.strm.data_type=Tn(St)),lr(St,St.l_desc),lr(St,St.d_desc),gt=ir(St),Yt=St.opt_len+3+7>>>3,Re=St.static_len+3+7>>>3,Re<=Yt&&(Yt=Re)):Yt=Re=Je+5,Je+4<=Yt&&ke!==-1?gi(St,ke,Je,li):St.strategy===t||Re===Yt?(Ai(St,(c<<1)+(li?1:0),3),Di(St,ut,Et)):(Ai(St,(h<<1)+(li?1:0),3),Hn(St,St.l_desc.max_code+1,St.d_desc.max_code+1,gt+1),Di(St,St.dyn_ltree,St.dyn_dtree)),bi(St),li&&Vn(St)}function yr(St,ke,Je){return St.pending_buf[St.d_buf+St.last_lit*2]=ke>>>8&255,St.pending_buf[St.d_buf+St.last_lit*2+1]=ke&255,St.pending_buf[St.l_buf+St.last_lit]=Je&255,St.last_lit++,ke===0?St.dyn_ltree[Je*2]++:(St.matches++,ke--,St.dyn_ltree[(Ct[Je]+S+1)*2]++,St.dyn_dtree[Se(ke)*2]++),St.last_lit===St.lit_bufsize-1}return xf._tr_init=Ge,xf._tr_stored_block=gi,xf._tr_flush_block=rn,xf._tr_tally=yr,xf._tr_align=Mi,xf}var xC,J8;function X8(){if(J8)return xC;J8=1;function e(t,i,n,r){for(var s=t&65535|0,o=t>>>16&65535|0,c=0;n!==0;){c=n>2e3?2e3:n,n-=c;do s=s+i[r++]|0,o=o+s|0;while(--c);s%=65521,o%=65521}return s|o<<16|0}return xC=e,xC}var wC,Q8;function K8(){if(Q8)return wC;Q8=1;function e(){for(var n,r=[],s=0;s<256;s++){n=s;for(var o=0;o<8;o++)n=n&1?3988292384^n>>>1:n>>>1;r[s]=n}return r}var t=e();function i(n,r,s,o){var c=t,h=o+s;n^=-1;for(var A=o;A<h;A++)n=n>>>8^c[(n^r[A])&255];return n^-1}return wC=i,wC}var q8,Z8;function CC(){return Z8||(Z8=1,q8={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}),q8}var Y8;function Xbt(){if(Y8)return Sc;Y8=1;var e=fh(),t=Jbt(),i=X8(),n=K8(),r=CC(),s=0,o=1,c=3,h=4,A=5,_=0,C=1,S=-2,L=-3,N=-5,U=-1,H=1,j=2,tt=3,K=4,Q=0,pt=2,$=8,zt=9,Gt=15,dt=8,lt=29,Lt=256,J=Lt+1+lt,ut=30,Et=19,le=2*J+1,Ct=15,Rt=3,Nt=258,Zt=Nt+Rt+1,re=32,se=42,de=69,Me=73,Se=91,oe=103,Ai=113,Ke=666,qe=1,Ve=2,di=3,cn=4,Ri=3;function bi(V,ve){return V.msg=r[ve],ve}function Vn(V){return(V<<1)-(V>4?9:0)}function yi(V){for(var ve=V.length;--ve>=0;)V[ve]=0}function vi(V){var ve=V.state,Be=ve.pending;Be>V.avail_out&&(Be=V.avail_out),Be!==0&&(e.arraySet(V.output,ve.pending_buf,ve.pending_out,Be,V.next_out),V.next_out+=Be,ve.pending_out+=Be,V.total_out+=Be,V.avail_out-=Be,ve.pending-=Be,ve.pending===0&&(ve.pending_out=0))}function un(V,ve){t._tr_flush_block(V,V.block_start>=0?V.block_start:-1,V.strstart-V.block_start,ve),V.block_start=V.strstart,vi(V.strm)}function Di(V,ve){V.pending_buf[V.pending++]=ve}function lr(V,ve){V.pending_buf[V.pending++]=ve>>>8&255,V.pending_buf[V.pending++]=ve&255}function Yn(V,ve,Be,xt){var Xt=V.avail_in;return Xt>xt&&(Xt=xt),Xt===0?0:(V.avail_in-=Xt,e.arraySet(ve,V.input,V.next_in,Xt,Be),V.state.wrap===1?V.adler=i(V.adler,ve,Xt,Be):V.state.wrap===2&&(V.adler=n(V.adler,ve,Xt,Be)),V.next_in+=Xt,V.total_in+=Xt,Xt)}function mn(V,ve){var Be=V.max_chain_length,xt=V.strstart,Xt,ce,q=V.prev_length,nt=V.nice_match,at=V.strstart>V.w_size-Zt?V.strstart-(V.w_size-Zt):0,vt=V.window,Ot=V.w_mask,ft=V.prev,_t=V.strstart+Nt,st=vt[xt+q-1],wt=vt[xt+q];V.prev_length>=V.good_match&&(Be>>=2),nt>V.lookahead&&(nt=V.lookahead);do if(Xt=ve,!(vt[Xt+q]!==wt||vt[Xt+q-1]!==st||vt[Xt]!==vt[xt]||vt[++Xt]!==vt[xt+1])){xt+=2,Xt++;do;while(vt[++xt]===vt[++Xt]&&vt[++xt]===vt[++Xt]&&vt[++xt]===vt[++Xt]&&vt[++xt]===vt[++Xt]&&vt[++xt]===vt[++Xt]&&vt[++xt]===vt[++Xt]&&vt[++xt]===vt[++Xt]&&vt[++xt]===vt[++Xt]&&xt<_t);if(ce=Nt-(_t-xt),xt=_t-Nt,ce>q){if(V.match_start=ve,q=ce,ce>=nt)break;st=vt[xt+q-1],wt=vt[xt+q]}}while((ve=ft[ve&Ot])>at&&--Be!==0);return q<=V.lookahead?q:V.lookahead}function ir(V){var ve=V.w_size,Be,xt,Xt,ce,q;do{if(ce=V.window_size-V.lookahead-V.strstart,V.strstart>=ve+(ve-Zt)){e.arraySet(V.window,V.window,ve,ve,0),V.match_start-=ve,V.strstart-=ve,V.block_start-=ve,xt=V.hash_size,Be=xt;do Xt=V.head[--Be],V.head[Be]=Xt>=ve?Xt-ve:0;while(--xt);xt=ve,Be=xt;do Xt=V.prev[--Be],V.prev[Be]=Xt>=ve?Xt-ve:0;while(--xt);ce+=ve}if(V.strm.avail_in===0)break;if(xt=Yn(V.strm,V.window,V.strstart+V.lookahead,ce),V.lookahead+=xt,V.lookahead+V.insert>=Rt)for(q=V.strstart-V.insert,V.ins_h=V.window[q],V.ins_h=(V.ins_h<<V.hash_shift^V.window[q+1])&V.hash_mask;V.insert&&(V.ins_h=(V.ins_h<<V.hash_shift^V.window[q+Rt-1])&V.hash_mask,V.prev[q&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=q,q++,V.insert--,!(V.lookahead+V.insert<Rt)););}while(V.lookahead<Zt&&V.strm.avail_in!==0)}function Hn(V,ve){var Be=65535;for(Be>V.pending_buf_size-5&&(Be=V.pending_buf_size-5);;){if(V.lookahead<=1){if(ir(V),V.lookahead===0&&ve===s)return qe;if(V.lookahead===0)break}V.strstart+=V.lookahead,V.lookahead=0;var xt=V.block_start+Be;if((V.strstart===0||V.strstart>=xt)&&(V.lookahead=V.strstart-xt,V.strstart=xt,un(V,!1),V.strm.avail_out===0)||V.strstart-V.block_start>=V.w_size-Zt&&(un(V,!1),V.strm.avail_out===0))return qe}return V.insert=0,ve===h?(un(V,!0),V.strm.avail_out===0?di:cn):(V.strstart>V.block_start&&(un(V,!1),V.strm.avail_out),qe)}function Tn(V,ve){for(var Be,xt;;){if(V.lookahead<Zt){if(ir(V),V.lookahead<Zt&&ve===s)return qe;if(V.lookahead===0)break}if(Be=0,V.lookahead>=Rt&&(V.ins_h=(V.ins_h<<V.hash_shift^V.window[V.strstart+Rt-1])&V.hash_mask,Be=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),Be!==0&&V.strstart-Be<=V.w_size-Zt&&(V.match_length=mn(V,Be)),V.match_length>=Rt)if(xt=t._tr_tally(V,V.strstart-V.match_start,V.match_length-Rt),V.lookahead-=V.match_length,V.match_length<=V.max_lazy_match&&V.lookahead>=Rt){V.match_length--;do V.strstart++,V.ins_h=(V.ins_h<<V.hash_shift^V.window[V.strstart+Rt-1])&V.hash_mask,Be=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart;while(--V.match_length!==0);V.strstart++}else V.strstart+=V.match_length,V.match_length=0,V.ins_h=V.window[V.strstart],V.ins_h=(V.ins_h<<V.hash_shift^V.window[V.strstart+1])&V.hash_mask;else xt=t._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++;if(xt&&(un(V,!1),V.strm.avail_out===0))return qe}return V.insert=V.strstart<Rt-1?V.strstart:Rt-1,ve===h?(un(V,!0),V.strm.avail_out===0?di:cn):V.last_lit&&(un(V,!1),V.strm.avail_out===0)?qe:Ve}function $n(V,ve){for(var Be,xt,Xt;;){if(V.lookahead<Zt){if(ir(V),V.lookahead<Zt&&ve===s)return qe;if(V.lookahead===0)break}if(Be=0,V.lookahead>=Rt&&(V.ins_h=(V.ins_h<<V.hash_shift^V.window[V.strstart+Rt-1])&V.hash_mask,Be=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart),V.prev_length=V.match_length,V.prev_match=V.match_start,V.match_length=Rt-1,Be!==0&&V.prev_length<V.max_lazy_match&&V.strstart-Be<=V.w_size-Zt&&(V.match_length=mn(V,Be),V.match_length<=5&&(V.strategy===H||V.match_length===Rt&&V.strstart-V.match_start>4096)&&(V.match_length=Rt-1)),V.prev_length>=Rt&&V.match_length<=V.prev_length){Xt=V.strstart+V.lookahead-Rt,xt=t._tr_tally(V,V.strstart-1-V.prev_match,V.prev_length-Rt),V.lookahead-=V.prev_length-1,V.prev_length-=2;do++V.strstart<=Xt&&(V.ins_h=(V.ins_h<<V.hash_shift^V.window[V.strstart+Rt-1])&V.hash_mask,Be=V.prev[V.strstart&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=V.strstart);while(--V.prev_length!==0);if(V.match_available=0,V.match_length=Rt-1,V.strstart++,xt&&(un(V,!1),V.strm.avail_out===0))return qe}else if(V.match_available){if(xt=t._tr_tally(V,0,V.window[V.strstart-1]),xt&&un(V,!1),V.strstart++,V.lookahead--,V.strm.avail_out===0)return qe}else V.match_available=1,V.strstart++,V.lookahead--}return V.match_available&&(xt=t._tr_tally(V,0,V.window[V.strstart-1]),V.match_available=0),V.insert=V.strstart<Rt-1?V.strstart:Rt-1,ve===h?(un(V,!0),V.strm.avail_out===0?di:cn):V.last_lit&&(un(V,!1),V.strm.avail_out===0)?qe:Ve}function Ge(V,ve){for(var Be,xt,Xt,ce,q=V.window;;){if(V.lookahead<=Nt){if(ir(V),V.lookahead<=Nt&&ve===s)return qe;if(V.lookahead===0)break}if(V.match_length=0,V.lookahead>=Rt&&V.strstart>0&&(Xt=V.strstart-1,xt=q[Xt],xt===q[++Xt]&&xt===q[++Xt]&&xt===q[++Xt])){ce=V.strstart+Nt;do;while(xt===q[++Xt]&&xt===q[++Xt]&&xt===q[++Xt]&&xt===q[++Xt]&&xt===q[++Xt]&&xt===q[++Xt]&&xt===q[++Xt]&&xt===q[++Xt]&&Xt<ce);V.match_length=Nt-(ce-Xt),V.match_length>V.lookahead&&(V.match_length=V.lookahead)}if(V.match_length>=Rt?(Be=t._tr_tally(V,1,V.match_length-Rt),V.lookahead-=V.match_length,V.strstart+=V.match_length,V.match_length=0):(Be=t._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++),Be&&(un(V,!1),V.strm.avail_out===0))return qe}return V.insert=0,ve===h?(un(V,!0),V.strm.avail_out===0?di:cn):V.last_lit&&(un(V,!1),V.strm.avail_out===0)?qe:Ve}function gi(V,ve){for(var Be;;){if(V.lookahead===0&&(ir(V),V.lookahead===0)){if(ve===s)return qe;break}if(V.match_length=0,Be=t._tr_tally(V,0,V.window[V.strstart]),V.lookahead--,V.strstart++,Be&&(un(V,!1),V.strm.avail_out===0))return qe}return V.insert=0,ve===h?(un(V,!0),V.strm.avail_out===0?di:cn):V.last_lit&&(un(V,!1),V.strm.avail_out===0)?qe:Ve}function Mi(V,ve,Be,xt,Xt){this.good_length=V,this.max_lazy=ve,this.nice_length=Be,this.max_chain=xt,this.func=Xt}var rn;rn=[new Mi(0,0,0,0,Hn),new Mi(4,4,8,4,Tn),new Mi(4,5,16,8,Tn),new Mi(4,6,32,32,Tn),new Mi(4,4,16,16,$n),new Mi(8,16,32,32,$n),new Mi(8,16,128,128,$n),new Mi(8,32,128,256,$n),new Mi(32,128,258,1024,$n),new Mi(32,258,258,4096,$n)];function yr(V){V.window_size=2*V.w_size,yi(V.head),V.max_lazy_match=rn[V.level].max_lazy,V.good_match=rn[V.level].good_length,V.nice_match=rn[V.level].nice_length,V.max_chain_length=rn[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=Rt-1,V.match_available=0,V.ins_h=0}function St(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new e.Buf16(le*2),this.dyn_dtree=new e.Buf16((2*ut+1)*2),this.bl_tree=new e.Buf16((2*Et+1)*2),yi(this.dyn_ltree),yi(this.dyn_dtree),yi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new e.Buf16(Ct+1),this.heap=new e.Buf16(2*J+1),yi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new e.Buf16(2*J+1),yi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ke(V){var ve;return!V||!V.state?bi(V,S):(V.total_in=V.total_out=0,V.data_type=pt,ve=V.state,ve.pending=0,ve.pending_out=0,ve.wrap<0&&(ve.wrap=-ve.wrap),ve.status=ve.wrap?se:Ai,V.adler=ve.wrap===2?0:1,ve.last_flush=s,t._tr_init(ve),_)}function Je(V){var ve=ke(V);return ve===_&&yr(V.state),ve}function li(V,ve){return!V||!V.state||V.state.wrap!==2?S:(V.state.gzhead=ve,_)}function Yt(V,ve,Be,xt,Xt,ce){if(!V)return S;var q=1;if(ve===U&&(ve=6),xt<0?(q=0,xt=-xt):xt>15&&(q=2,xt-=16),Xt<1||Xt>zt||Be!==$||xt<8||xt>15||ve<0||ve>9||ce<0||ce>K)return bi(V,S);xt===8&&(xt=9);var nt=new St;return V.state=nt,nt.strm=V,nt.wrap=q,nt.gzhead=null,nt.w_bits=xt,nt.w_size=1<<nt.w_bits,nt.w_mask=nt.w_size-1,nt.hash_bits=Xt+7,nt.hash_size=1<<nt.hash_bits,nt.hash_mask=nt.hash_size-1,nt.hash_shift=~~((nt.hash_bits+Rt-1)/Rt),nt.window=new e.Buf8(nt.w_size*2),nt.head=new e.Buf16(nt.hash_size),nt.prev=new e.Buf16(nt.w_size),nt.lit_bufsize=1<<Xt+6,nt.pending_buf_size=nt.lit_bufsize*4,nt.pending_buf=new e.Buf8(nt.pending_buf_size),nt.d_buf=1*nt.lit_bufsize,nt.l_buf=3*nt.lit_bufsize,nt.level=ve,nt.strategy=ce,nt.method=Be,Je(V)}function Re(V,ve){return Yt(V,ve,$,Gt,dt,Q)}function gt(V,ve){var Be,xt,Xt,ce;if(!V||!V.state||ve>A||ve<0)return V?bi(V,S):S;if(xt=V.state,!V.output||!V.input&&V.avail_in!==0||xt.status===Ke&&ve!==h)return bi(V,V.avail_out===0?N:S);if(xt.strm=V,Be=xt.last_flush,xt.last_flush=ve,xt.status===se)if(xt.wrap===2)V.adler=0,Di(xt,31),Di(xt,139),Di(xt,8),xt.gzhead?(Di(xt,(xt.gzhead.text?1:0)+(xt.gzhead.hcrc?2:0)+(xt.gzhead.extra?4:0)+(xt.gzhead.name?8:0)+(xt.gzhead.comment?16:0)),Di(xt,xt.gzhead.time&255),Di(xt,xt.gzhead.time>>8&255),Di(xt,xt.gzhead.time>>16&255),Di(xt,xt.gzhead.time>>24&255),Di(xt,xt.level===9?2:xt.strategy>=j||xt.level<2?4:0),Di(xt,xt.gzhead.os&255),xt.gzhead.extra&&xt.gzhead.extra.length&&(Di(xt,xt.gzhead.extra.length&255),Di(xt,xt.gzhead.extra.length>>8&255)),xt.gzhead.hcrc&&(V.adler=n(V.adler,xt.pending_buf,xt.pending,0)),xt.gzindex=0,xt.status=de):(Di(xt,0),Di(xt,0),Di(xt,0),Di(xt,0),Di(xt,0),Di(xt,xt.level===9?2:xt.strategy>=j||xt.level<2?4:0),Di(xt,Ri),xt.status=Ai);else{var q=$+(xt.w_bits-8<<4)<<8,nt=-1;xt.strategy>=j||xt.level<2?nt=0:xt.level<6?nt=1:xt.level===6?nt=2:nt=3,q|=nt<<6,xt.strstart!==0&&(q|=re),q+=31-q%31,xt.status=Ai,lr(xt,q),xt.strstart!==0&&(lr(xt,V.adler>>>16),lr(xt,V.adler&65535)),V.adler=1}if(xt.status===de)if(xt.gzhead.extra){for(Xt=xt.pending;xt.gzindex<(xt.gzhead.extra.length&65535)&&!(xt.pending===xt.pending_buf_size&&(xt.gzhead.hcrc&&xt.pending>Xt&&(V.adler=n(V.adler,xt.pending_buf,xt.pending-Xt,Xt)),vi(V),Xt=xt.pending,xt.pending===xt.pending_buf_size));)Di(xt,xt.gzhead.extra[xt.gzindex]&255),xt.gzindex++;xt.gzhead.hcrc&&xt.pending>Xt&&(V.adler=n(V.adler,xt.pending_buf,xt.pending-Xt,Xt)),xt.gzindex===xt.gzhead.extra.length&&(xt.gzindex=0,xt.status=Me)}else xt.status=Me;if(xt.status===Me)if(xt.gzhead.name){Xt=xt.pending;do{if(xt.pending===xt.pending_buf_size&&(xt.gzhead.hcrc&&xt.pending>Xt&&(V.adler=n(V.adler,xt.pending_buf,xt.pending-Xt,Xt)),vi(V),Xt=xt.pending,xt.pending===xt.pending_buf_size)){ce=1;break}xt.gzindex<xt.gzhead.name.length?ce=xt.gzhead.name.charCodeAt(xt.gzindex++)&255:ce=0,Di(xt,ce)}while(ce!==0);xt.gzhead.hcrc&&xt.pending>Xt&&(V.adler=n(V.adler,xt.pending_buf,xt.pending-Xt,Xt)),ce===0&&(xt.gzindex=0,xt.status=Se)}else xt.status=Se;if(xt.status===Se)if(xt.gzhead.comment){Xt=xt.pending;do{if(xt.pending===xt.pending_buf_size&&(xt.gzhead.hcrc&&xt.pending>Xt&&(V.adler=n(V.adler,xt.pending_buf,xt.pending-Xt,Xt)),vi(V),Xt=xt.pending,xt.pending===xt.pending_buf_size)){ce=1;break}xt.gzindex<xt.gzhead.comment.length?ce=xt.gzhead.comment.charCodeAt(xt.gzindex++)&255:ce=0,Di(xt,ce)}while(ce!==0);xt.gzhead.hcrc&&xt.pending>Xt&&(V.adler=n(V.adler,xt.pending_buf,xt.pending-Xt,Xt)),ce===0&&(xt.status=oe)}else xt.status=oe;if(xt.status===oe&&(xt.gzhead.hcrc?(xt.pending+2>xt.pending_buf_size&&vi(V),xt.pending+2<=xt.pending_buf_size&&(Di(xt,V.adler&255),Di(xt,V.adler>>8&255),V.adler=0,xt.status=Ai)):xt.status=Ai),xt.pending!==0){if(vi(V),V.avail_out===0)return xt.last_flush=-1,_}else if(V.avail_in===0&&Vn(ve)<=Vn(Be)&&ve!==h)return bi(V,N);if(xt.status===Ke&&V.avail_in!==0)return bi(V,N);if(V.avail_in!==0||xt.lookahead!==0||ve!==s&&xt.status!==Ke){var at=xt.strategy===j?gi(xt,ve):xt.strategy===tt?Ge(xt,ve):rn[xt.level].func(xt,ve);if((at===di||at===cn)&&(xt.status=Ke),at===qe||at===di)return V.avail_out===0&&(xt.last_flush=-1),_;if(at===Ve&&(ve===o?t._tr_align(xt):ve!==A&&(t._tr_stored_block(xt,0,0,!1),ve===c&&(yi(xt.head),xt.lookahead===0&&(xt.strstart=0,xt.block_start=0,xt.insert=0))),vi(V),V.avail_out===0))return xt.last_flush=-1,_}return ve!==h?_:xt.wrap<=0?C:(xt.wrap===2?(Di(xt,V.adler&255),Di(xt,V.adler>>8&255),Di(xt,V.adler>>16&255),Di(xt,V.adler>>24&255),Di(xt,V.total_in&255),Di(xt,V.total_in>>8&255),Di(xt,V.total_in>>16&255),Di(xt,V.total_in>>24&255)):(lr(xt,V.adler>>>16),lr(xt,V.adler&65535)),vi(V),xt.wrap>0&&(xt.wrap=-xt.wrap),xt.pending!==0?_:C)}function ze(V){var ve;return!V||!V.state?S:(ve=V.state.status,ve!==se&&ve!==de&&ve!==Me&&ve!==Se&&ve!==oe&&ve!==Ai&&ve!==Ke?bi(V,S):(V.state=null,ve===Ai?bi(V,L):_))}function we(V,ve){var Be=ve.length,xt,Xt,ce,q,nt,at,vt,Ot;if(!V||!V.state||(xt=V.state,q=xt.wrap,q===2||q===1&&xt.status!==se||xt.lookahead))return S;for(q===1&&(V.adler=i(V.adler,ve,Be,0)),xt.wrap=0,Be>=xt.w_size&&(q===0&&(yi(xt.head),xt.strstart=0,xt.block_start=0,xt.insert=0),Ot=new e.Buf8(xt.w_size),e.arraySet(Ot,ve,Be-xt.w_size,xt.w_size,0),ve=Ot,Be=xt.w_size),nt=V.avail_in,at=V.next_in,vt=V.input,V.avail_in=Be,V.next_in=0,V.input=ve,ir(xt);xt.lookahead>=Rt;){Xt=xt.strstart,ce=xt.lookahead-(Rt-1);do xt.ins_h=(xt.ins_h<<xt.hash_shift^xt.window[Xt+Rt-1])&xt.hash_mask,xt.prev[Xt&xt.w_mask]=xt.head[xt.ins_h],xt.head[xt.ins_h]=Xt,Xt++;while(--ce);xt.strstart=Xt,xt.lookahead=Rt-1,ir(xt)}return xt.strstart+=xt.lookahead,xt.block_start=xt.strstart,xt.insert=xt.lookahead,xt.lookahead=0,xt.match_length=xt.prev_length=Rt-1,xt.match_available=0,V.next_in=at,V.input=vt,V.avail_in=nt,xt.wrap=q,_}return Sc.deflateInit=Re,Sc.deflateInit2=Yt,Sc.deflateReset=Je,Sc.deflateResetKeep=ke,Sc.deflateSetHeader=li,Sc.deflate=gt,Sc.deflateEnd=ze,Sc.deflateSetDictionary=we,Sc.deflateInfo="pako deflate (from Nodeca project)",Sc}var wf={},$8;function t5(){if($8)return wf;$8=1;var e=fh(),t=!0,i=!0;try{String.fromCharCode.apply(null,[0])}catch{t=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{i=!1}for(var n=new e.Buf8(256),r=0;r<256;r++)n[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;n[254]=n[254]=1,wf.string2buf=function(o){var c,h,A,_,C,S=o.length,L=0;for(_=0;_<S;_++)h=o.charCodeAt(_),(h&64512)===55296&&_+1<S&&(A=o.charCodeAt(_+1),(A&64512)===56320&&(h=65536+(h-55296<<10)+(A-56320),_++)),L+=h<128?1:h<2048?2:h<65536?3:4;for(c=new e.Buf8(L),C=0,_=0;C<L;_++)h=o.charCodeAt(_),(h&64512)===55296&&_+1<S&&(A=o.charCodeAt(_+1),(A&64512)===56320&&(h=65536+(h-55296<<10)+(A-56320),_++)),h<128?c[C++]=h:h<2048?(c[C++]=192|h>>>6,c[C++]=128|h&63):h<65536?(c[C++]=224|h>>>12,c[C++]=128|h>>>6&63,c[C++]=128|h&63):(c[C++]=240|h>>>18,c[C++]=128|h>>>12&63,c[C++]=128|h>>>6&63,c[C++]=128|h&63);return c};function s(o,c){if(c<65534&&(o.subarray&&i||!o.subarray&&t))return String.fromCharCode.apply(null,e.shrinkBuf(o,c));for(var h="",A=0;A<c;A++)h+=String.fromCharCode(o[A]);return h}return wf.buf2binstring=function(o){return s(o,o.length)},wf.binstring2buf=function(o){for(var c=new e.Buf8(o.length),h=0,A=c.length;h<A;h++)c[h]=o.charCodeAt(h);return c},wf.buf2string=function(o,c){var h,A,_,C,S=c||o.length,L=new Array(S*2);for(A=0,h=0;h<S;){if(_=o[h++],_<128){L[A++]=_;continue}if(C=n[_],C>4){L[A++]=65533,h+=C-1;continue}for(_&=C===2?31:C===3?15:7;C>1&&h<S;)_=_<<6|o[h++]&63,C--;if(C>1){L[A++]=65533;continue}_<65536?L[A++]=_:(_-=65536,L[A++]=55296|_>>10&1023,L[A++]=56320|_&1023)}return s(L,A)},wf.utf8border=function(o,c){var h;for(c=c||o.length,c>o.length&&(c=o.length),h=c-1;h>=0&&(o[h]&192)===128;)h--;return h<0||h===0?c:h+n[o[h]]>c?h:c},wf}var EC,e5;function i5(){if(e5)return EC;e5=1;function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}return EC=e,EC}var n5;function Qbt(){if(n5)return Fp;n5=1;var e=Xbt(),t=fh(),i=t5(),n=CC(),r=i5(),s=Object.prototype.toString,o=0,c=4,h=0,A=1,_=2,C=-1,S=0,L=8;function N(tt){if(!(this instanceof N))return new N(tt);this.options=t.assign({level:C,method:L,chunkSize:16384,windowBits:15,memLevel:8,strategy:S,to:""},tt||{});var K=this.options;K.raw&&K.windowBits>0?K.windowBits=-K.windowBits:K.gzip&&K.windowBits>0&&K.windowBits<16&&(K.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var Q=e.deflateInit2(this.strm,K.level,K.method,K.windowBits,K.memLevel,K.strategy);if(Q!==h)throw new Error(n[Q]);if(K.header&&e.deflateSetHeader(this.strm,K.header),K.dictionary){var pt;if(typeof K.dictionary=="string"?pt=i.string2buf(K.dictionary):s.call(K.dictionary)==="[object ArrayBuffer]"?pt=new Uint8Array(K.dictionary):pt=K.dictionary,Q=e.deflateSetDictionary(this.strm,pt),Q!==h)throw new Error(n[Q]);this._dict_set=!0}}N.prototype.push=function(tt,K){var Q=this.strm,pt=this.options.chunkSize,$,zt;if(this.ended)return!1;zt=K===~~K?K:K===!0?c:o,typeof tt=="string"?Q.input=i.string2buf(tt):s.call(tt)==="[object ArrayBuffer]"?Q.input=new Uint8Array(tt):Q.input=tt,Q.next_in=0,Q.avail_in=Q.input.length;do{if(Q.avail_out===0&&(Q.output=new t.Buf8(pt),Q.next_out=0,Q.avail_out=pt),$=e.deflate(Q,zt),$!==A&&$!==h)return this.onEnd($),this.ended=!0,!1;(Q.avail_out===0||Q.avail_in===0&&(zt===c||zt===_))&&(this.options.to==="string"?this.onData(i.buf2binstring(t.shrinkBuf(Q.output,Q.next_out))):this.onData(t.shrinkBuf(Q.output,Q.next_out)))}while((Q.avail_in>0||Q.avail_out===0)&&$!==A);return zt===c?($=e.deflateEnd(this.strm),this.onEnd($),this.ended=!0,$===h):(zt===_&&(this.onEnd(h),Q.avail_out=0),!0)},N.prototype.onData=function(tt){this.chunks.push(tt)},N.prototype.onEnd=function(tt){tt===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=tt,this.msg=this.strm.msg};function U(tt,K){var Q=new N(K);if(Q.push(tt,!0),Q.err)throw Q.msg||n[Q.err];return Q.result}function H(tt,K){return K=K||{},K.raw=!0,U(tt,K)}function j(tt,K){return K=K||{},K.gzip=!0,U(tt,K)}return Fp.Deflate=N,Fp.deflate=U,Fp.deflateRaw=H,Fp.gzip=j,Fp}var kp={},Ga={},BC,r5;function Kbt(){if(r5)return BC;r5=1;var e=30,t=12;return BC=function(i,n){var r,s,o,c,h,A,_,C,S,L,N,U,H,j,tt,K,Q,pt,$,zt,Gt,dt,lt,Lt,J;r=i.state,s=i.next_in,Lt=i.input,o=s+(i.avail_in-5),c=i.next_out,J=i.output,h=c-(n-i.avail_out),A=c+(i.avail_out-257),_=r.dmax,C=r.wsize,S=r.whave,L=r.wnext,N=r.window,U=r.hold,H=r.bits,j=r.lencode,tt=r.distcode,K=(1<<r.lenbits)-1,Q=(1<<r.distbits)-1;t:do{H<15&&(U+=Lt[s++]<<H,H+=8,U+=Lt[s++]<<H,H+=8),pt=j[U&K];e:for(;;){if($=pt>>>24,U>>>=$,H-=$,$=pt>>>16&255,$===0)J[c++]=pt&65535;else if($&16){zt=pt&65535,$&=15,$&&(H<$&&(U+=Lt[s++]<<H,H+=8),zt+=U&(1<<$)-1,U>>>=$,H-=$),H<15&&(U+=Lt[s++]<<H,H+=8,U+=Lt[s++]<<H,H+=8),pt=tt[U&Q];i:for(;;){if($=pt>>>24,U>>>=$,H-=$,$=pt>>>16&255,$&16){if(Gt=pt&65535,$&=15,H<$&&(U+=Lt[s++]<<H,H+=8,H<$&&(U+=Lt[s++]<<H,H+=8)),Gt+=U&(1<<$)-1,Gt>_){i.msg="invalid distance too far back",r.mode=e;break t}if(U>>>=$,H-=$,$=c-h,Gt>$){if($=Gt-$,$>S&&r.sane){i.msg="invalid distance too far back",r.mode=e;break t}if(dt=0,lt=N,L===0){if(dt+=C-$,$<zt){zt-=$;do J[c++]=N[dt++];while(--$);dt=c-Gt,lt=J}}else if(L<$){if(dt+=C+L-$,$-=L,$<zt){zt-=$;do J[c++]=N[dt++];while(--$);if(dt=0,L<zt){$=L,zt-=$;do J[c++]=N[dt++];while(--$);dt=c-Gt,lt=J}}}else if(dt+=L-$,$<zt){zt-=$;do J[c++]=N[dt++];while(--$);dt=c-Gt,lt=J}for(;zt>2;)J[c++]=lt[dt++],J[c++]=lt[dt++],J[c++]=lt[dt++],zt-=3;zt&&(J[c++]=lt[dt++],zt>1&&(J[c++]=lt[dt++]))}else{dt=c-Gt;do J[c++]=J[dt++],J[c++]=J[dt++],J[c++]=J[dt++],zt-=3;while(zt>2);zt&&(J[c++]=J[dt++],zt>1&&(J[c++]=J[dt++]))}}else if(($&64)===0){pt=tt[(pt&65535)+(U&(1<<$)-1)];continue i}else{i.msg="invalid distance code",r.mode=e;break t}break}}else if(($&64)===0){pt=j[(pt&65535)+(U&(1<<$)-1)];continue e}else if($&32){r.mode=t;break t}else{i.msg="invalid literal/length code",r.mode=e;break t}break}}while(s<o&&c<A);zt=H>>3,s-=zt,H-=zt<<3,U&=(1<<H)-1,i.next_in=s,i.next_out=c,i.avail_in=s<o?5+(o-s):5-(s-o),i.avail_out=c<A?257+(A-c):257-(c-A),r.hold=U,r.bits=H},BC}var TC,o5;function qbt(){if(o5)return TC;o5=1;var e=fh(),t=15,i=852,n=592,r=0,s=1,o=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],A=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],_=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];return TC=function(C,S,L,N,U,H,j,tt){var K=tt.bits,Q=0,pt=0,$=0,zt=0,Gt=0,dt=0,lt=0,Lt=0,J=0,ut=0,Et,le,Ct,Rt,Nt,Zt=null,re=0,se,de=new e.Buf16(t+1),Me=new e.Buf16(t+1),Se=null,oe=0,Ai,Ke,qe;for(Q=0;Q<=t;Q++)de[Q]=0;for(pt=0;pt<N;pt++)de[S[L+pt]]++;for(Gt=K,zt=t;zt>=1&&de[zt]===0;zt--);if(Gt>zt&&(Gt=zt),zt===0)return U[H++]=1<<24|64<<16|0,U[H++]=1<<24|64<<16|0,tt.bits=1,0;for($=1;$<zt&&de[$]===0;$++);for(Gt<$&&(Gt=$),Lt=1,Q=1;Q<=t;Q++)if(Lt<<=1,Lt-=de[Q],Lt<0)return-1;if(Lt>0&&(C===r||zt!==1))return-1;for(Me[1]=0,Q=1;Q<t;Q++)Me[Q+1]=Me[Q]+de[Q];for(pt=0;pt<N;pt++)S[L+pt]!==0&&(j[Me[S[L+pt]]++]=pt);if(C===r?(Zt=Se=j,se=19):C===s?(Zt=c,re-=257,Se=h,oe-=257,se=256):(Zt=A,Se=_,se=-1),ut=0,pt=0,Q=$,Nt=H,dt=Gt,lt=0,Ct=-1,J=1<<Gt,Rt=J-1,C===s&&J>i||C===o&&J>n)return 1;for(;;){Ai=Q-lt,j[pt]<se?(Ke=0,qe=j[pt]):j[pt]>se?(Ke=Se[oe+j[pt]],qe=Zt[re+j[pt]]):(Ke=96,qe=0),Et=1<<Q-lt,le=1<<dt,$=le;do le-=Et,U[Nt+(ut>>lt)+le]=Ai<<24|Ke<<16|qe|0;while(le!==0);for(Et=1<<Q-1;ut&Et;)Et>>=1;if(Et!==0?(ut&=Et-1,ut+=Et):ut=0,pt++,--de[Q]===0){if(Q===zt)break;Q=S[L+j[pt]]}if(Q>Gt&&(ut&Rt)!==Ct){for(lt===0&&(lt=Gt),Nt+=$,dt=Q-lt,Lt=1<<dt;dt+lt<zt&&(Lt-=de[dt+lt],!(Lt<=0));)dt++,Lt<<=1;if(J+=1<<dt,C===s&&J>i||C===o&&J>n)return 1;Ct=ut&Rt,U[Ct]=Gt<<24|dt<<16|Nt-H|0}}return ut!==0&&(U[Nt+ut]=Q-lt<<24|64<<16|0),tt.bits=Gt,0},TC}var s5;function Zbt(){if(s5)return Ga;s5=1;var e=fh(),t=X8(),i=K8(),n=Kbt(),r=qbt(),s=0,o=1,c=2,h=4,A=5,_=6,C=0,S=1,L=2,N=-2,U=-3,H=-4,j=-5,tt=8,K=1,Q=2,pt=3,$=4,zt=5,Gt=6,dt=7,lt=8,Lt=9,J=10,ut=11,Et=12,le=13,Ct=14,Rt=15,Nt=16,Zt=17,re=18,se=19,de=20,Me=21,Se=22,oe=23,Ai=24,Ke=25,qe=26,Ve=27,di=28,cn=29,Ri=30,bi=31,Vn=32,yi=852,vi=592,un=15,Di=un;function lr(Yt){return(Yt>>>24&255)+(Yt>>>8&65280)+((Yt&65280)<<8)+((Yt&255)<<24)}function Yn(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new e.Buf16(320),this.work=new e.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function mn(Yt){var Re;return!Yt||!Yt.state?N:(Re=Yt.state,Yt.total_in=Yt.total_out=Re.total=0,Yt.msg="",Re.wrap&&(Yt.adler=Re.wrap&1),Re.mode=K,Re.last=0,Re.havedict=0,Re.dmax=32768,Re.head=null,Re.hold=0,Re.bits=0,Re.lencode=Re.lendyn=new e.Buf32(yi),Re.distcode=Re.distdyn=new e.Buf32(vi),Re.sane=1,Re.back=-1,C)}function ir(Yt){var Re;return!Yt||!Yt.state?N:(Re=Yt.state,Re.wsize=0,Re.whave=0,Re.wnext=0,mn(Yt))}function Hn(Yt,Re){var gt,ze;return!Yt||!Yt.state||(ze=Yt.state,Re<0?(gt=0,Re=-Re):(gt=(Re>>4)+1,Re<48&&(Re&=15)),Re&&(Re<8||Re>15))?N:(ze.window!==null&&ze.wbits!==Re&&(ze.window=null),ze.wrap=gt,ze.wbits=Re,ir(Yt))}function Tn(Yt,Re){var gt,ze;return Yt?(ze=new Yn,Yt.state=ze,ze.window=null,gt=Hn(Yt,Re),gt!==C&&(Yt.state=null),gt):N}function $n(Yt){return Tn(Yt,Di)}var Ge=!0,gi,Mi;function rn(Yt){if(Ge){var Re;for(gi=new e.Buf32(512),Mi=new e.Buf32(32),Re=0;Re<144;)Yt.lens[Re++]=8;for(;Re<256;)Yt.lens[Re++]=9;for(;Re<280;)Yt.lens[Re++]=7;for(;Re<288;)Yt.lens[Re++]=8;for(r(o,Yt.lens,0,288,gi,0,Yt.work,{bits:9}),Re=0;Re<32;)Yt.lens[Re++]=5;r(c,Yt.lens,0,32,Mi,0,Yt.work,{bits:5}),Ge=!1}Yt.lencode=gi,Yt.lenbits=9,Yt.distcode=Mi,Yt.distbits=5}function yr(Yt,Re,gt,ze){var we,V=Yt.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new e.Buf8(V.wsize)),ze>=V.wsize?(e.arraySet(V.window,Re,gt-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(we=V.wsize-V.wnext,we>ze&&(we=ze),e.arraySet(V.window,Re,gt-ze,we,V.wnext),ze-=we,ze?(e.arraySet(V.window,Re,gt-ze,ze,0),V.wnext=ze,V.whave=V.wsize):(V.wnext+=we,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=we))),0}function St(Yt,Re){var gt,ze,we,V,ve,Be,xt,Xt,ce,q,nt,at,vt,Ot,ft=0,_t,st,wt,g,ct,Ce,Kt,Ee,Pe=new e.Buf8(4),Le,he,Fe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Yt||!Yt.state||!Yt.output||!Yt.input&&Yt.avail_in!==0)return N;gt=Yt.state,gt.mode===Et&&(gt.mode=le),ve=Yt.next_out,we=Yt.output,xt=Yt.avail_out,V=Yt.next_in,ze=Yt.input,Be=Yt.avail_in,Xt=gt.hold,ce=gt.bits,q=Be,nt=xt,Ee=C;t:for(;;)switch(gt.mode){case K:if(gt.wrap===0){gt.mode=le;break}for(;ce<16;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(gt.wrap&2&&Xt===35615){gt.check=0,Pe[0]=Xt&255,Pe[1]=Xt>>>8&255,gt.check=i(gt.check,Pe,2,0),Xt=0,ce=0,gt.mode=Q;break}if(gt.flags=0,gt.head&&(gt.head.done=!1),!(gt.wrap&1)||(((Xt&255)<<8)+(Xt>>8))%31){Yt.msg="incorrect header check",gt.mode=Ri;break}if((Xt&15)!==tt){Yt.msg="unknown compression method",gt.mode=Ri;break}if(Xt>>>=4,ce-=4,Kt=(Xt&15)+8,gt.wbits===0)gt.wbits=Kt;else if(Kt>gt.wbits){Yt.msg="invalid window size",gt.mode=Ri;break}gt.dmax=1<<Kt,Yt.adler=gt.check=1,gt.mode=Xt&512?J:Et,Xt=0,ce=0;break;case Q:for(;ce<16;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(gt.flags=Xt,(gt.flags&255)!==tt){Yt.msg="unknown compression method",gt.mode=Ri;break}if(gt.flags&57344){Yt.msg="unknown header flags set",gt.mode=Ri;break}gt.head&&(gt.head.text=Xt>>8&1),gt.flags&512&&(Pe[0]=Xt&255,Pe[1]=Xt>>>8&255,gt.check=i(gt.check,Pe,2,0)),Xt=0,ce=0,gt.mode=pt;case pt:for(;ce<32;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}gt.head&&(gt.head.time=Xt),gt.flags&512&&(Pe[0]=Xt&255,Pe[1]=Xt>>>8&255,Pe[2]=Xt>>>16&255,Pe[3]=Xt>>>24&255,gt.check=i(gt.check,Pe,4,0)),Xt=0,ce=0,gt.mode=$;case $:for(;ce<16;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}gt.head&&(gt.head.xflags=Xt&255,gt.head.os=Xt>>8),gt.flags&512&&(Pe[0]=Xt&255,Pe[1]=Xt>>>8&255,gt.check=i(gt.check,Pe,2,0)),Xt=0,ce=0,gt.mode=zt;case zt:if(gt.flags&1024){for(;ce<16;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}gt.length=Xt,gt.head&&(gt.head.extra_len=Xt),gt.flags&512&&(Pe[0]=Xt&255,Pe[1]=Xt>>>8&255,gt.check=i(gt.check,Pe,2,0)),Xt=0,ce=0}else gt.head&&(gt.head.extra=null);gt.mode=Gt;case Gt:if(gt.flags&1024&&(at=gt.length,at>Be&&(at=Be),at&&(gt.head&&(Kt=gt.head.extra_len-gt.length,gt.head.extra||(gt.head.extra=new Array(gt.head.extra_len)),e.arraySet(gt.head.extra,ze,V,at,Kt)),gt.flags&512&&(gt.check=i(gt.check,ze,at,V)),Be-=at,V+=at,gt.length-=at),gt.length))break t;gt.length=0,gt.mode=dt;case dt:if(gt.flags&2048){if(Be===0)break t;at=0;do Kt=ze[V+at++],gt.head&&Kt&&gt.length<65536&&(gt.head.name+=String.fromCharCode(Kt));while(Kt&&at<Be);if(gt.flags&512&&(gt.check=i(gt.check,ze,at,V)),Be-=at,V+=at,Kt)break t}else gt.head&&(gt.head.name=null);gt.length=0,gt.mode=lt;case lt:if(gt.flags&4096){if(Be===0)break t;at=0;do Kt=ze[V+at++],gt.head&&Kt&&gt.length<65536&&(gt.head.comment+=String.fromCharCode(Kt));while(Kt&&at<Be);if(gt.flags&512&&(gt.check=i(gt.check,ze,at,V)),Be-=at,V+=at,Kt)break t}else gt.head&&(gt.head.comment=null);gt.mode=Lt;case Lt:if(gt.flags&512){for(;ce<16;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(Xt!==(gt.check&65535)){Yt.msg="header crc mismatch",gt.mode=Ri;break}Xt=0,ce=0}gt.head&&(gt.head.hcrc=gt.flags>>9&1,gt.head.done=!0),Yt.adler=gt.check=0,gt.mode=Et;break;case J:for(;ce<32;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}Yt.adler=gt.check=lr(Xt),Xt=0,ce=0,gt.mode=ut;case ut:if(gt.havedict===0)return Yt.next_out=ve,Yt.avail_out=xt,Yt.next_in=V,Yt.avail_in=Be,gt.hold=Xt,gt.bits=ce,L;Yt.adler=gt.check=1,gt.mode=Et;case Et:if(Re===A||Re===_)break t;case le:if(gt.last){Xt>>>=ce&7,ce-=ce&7,gt.mode=Ve;break}for(;ce<3;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}switch(gt.last=Xt&1,Xt>>>=1,ce-=1,Xt&3){case 0:gt.mode=Ct;break;case 1:if(rn(gt),gt.mode=de,Re===_){Xt>>>=2,ce-=2;break t}break;case 2:gt.mode=Zt;break;case 3:Yt.msg="invalid block type",gt.mode=Ri}Xt>>>=2,ce-=2;break;case Ct:for(Xt>>>=ce&7,ce-=ce&7;ce<32;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if((Xt&65535)!==(Xt>>>16^65535)){Yt.msg="invalid stored block lengths",gt.mode=Ri;break}if(gt.length=Xt&65535,Xt=0,ce=0,gt.mode=Rt,Re===_)break t;case Rt:gt.mode=Nt;case Nt:if(at=gt.length,at){if(at>Be&&(at=Be),at>xt&&(at=xt),at===0)break t;e.arraySet(we,ze,V,at,ve),Be-=at,V+=at,xt-=at,ve+=at,gt.length-=at;break}gt.mode=Et;break;case Zt:for(;ce<14;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(gt.nlen=(Xt&31)+257,Xt>>>=5,ce-=5,gt.ndist=(Xt&31)+1,Xt>>>=5,ce-=5,gt.ncode=(Xt&15)+4,Xt>>>=4,ce-=4,gt.nlen>286||gt.ndist>30){Yt.msg="too many length or distance symbols",gt.mode=Ri;break}gt.have=0,gt.mode=re;case re:for(;gt.have<gt.ncode;){for(;ce<3;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}gt.lens[Fe[gt.have++]]=Xt&7,Xt>>>=3,ce-=3}for(;gt.have<19;)gt.lens[Fe[gt.have++]]=0;if(gt.lencode=gt.lendyn,gt.lenbits=7,Le={bits:gt.lenbits},Ee=r(s,gt.lens,0,19,gt.lencode,0,gt.work,Le),gt.lenbits=Le.bits,Ee){Yt.msg="invalid code lengths set",gt.mode=Ri;break}gt.have=0,gt.mode=se;case se:for(;gt.have<gt.nlen+gt.ndist;){for(;ft=gt.lencode[Xt&(1<<gt.lenbits)-1],_t=ft>>>24,st=ft>>>16&255,wt=ft&65535,!(_t<=ce);){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(wt<16)Xt>>>=_t,ce-=_t,gt.lens[gt.have++]=wt;else{if(wt===16){for(he=_t+2;ce<he;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(Xt>>>=_t,ce-=_t,gt.have===0){Yt.msg="invalid bit length repeat",gt.mode=Ri;break}Kt=gt.lens[gt.have-1],at=3+(Xt&3),Xt>>>=2,ce-=2}else if(wt===17){for(he=_t+3;ce<he;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}Xt>>>=_t,ce-=_t,Kt=0,at=3+(Xt&7),Xt>>>=3,ce-=3}else{for(he=_t+7;ce<he;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}Xt>>>=_t,ce-=_t,Kt=0,at=11+(Xt&127),Xt>>>=7,ce-=7}if(gt.have+at>gt.nlen+gt.ndist){Yt.msg="invalid bit length repeat",gt.mode=Ri;break}for(;at--;)gt.lens[gt.have++]=Kt}}if(gt.mode===Ri)break;if(gt.lens[256]===0){Yt.msg="invalid code -- missing end-of-block",gt.mode=Ri;break}if(gt.lenbits=9,Le={bits:gt.lenbits},Ee=r(o,gt.lens,0,gt.nlen,gt.lencode,0,gt.work,Le),gt.lenbits=Le.bits,Ee){Yt.msg="invalid literal/lengths set",gt.mode=Ri;break}if(gt.distbits=6,gt.distcode=gt.distdyn,Le={bits:gt.distbits},Ee=r(c,gt.lens,gt.nlen,gt.ndist,gt.distcode,0,gt.work,Le),gt.distbits=Le.bits,Ee){Yt.msg="invalid distances set",gt.mode=Ri;break}if(gt.mode=de,Re===_)break t;case de:gt.mode=Me;case Me:if(Be>=6&&xt>=258){Yt.next_out=ve,Yt.avail_out=xt,Yt.next_in=V,Yt.avail_in=Be,gt.hold=Xt,gt.bits=ce,n(Yt,nt),ve=Yt.next_out,we=Yt.output,xt=Yt.avail_out,V=Yt.next_in,ze=Yt.input,Be=Yt.avail_in,Xt=gt.hold,ce=gt.bits,gt.mode===Et&&(gt.back=-1);break}for(gt.back=0;ft=gt.lencode[Xt&(1<<gt.lenbits)-1],_t=ft>>>24,st=ft>>>16&255,wt=ft&65535,!(_t<=ce);){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(st&&(st&240)===0){for(g=_t,ct=st,Ce=wt;ft=gt.lencode[Ce+((Xt&(1<<g+ct)-1)>>g)],_t=ft>>>24,st=ft>>>16&255,wt=ft&65535,!(g+_t<=ce);){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}Xt>>>=g,ce-=g,gt.back+=g}if(Xt>>>=_t,ce-=_t,gt.back+=_t,gt.length=wt,st===0){gt.mode=qe;break}if(st&32){gt.back=-1,gt.mode=Et;break}if(st&64){Yt.msg="invalid literal/length code",gt.mode=Ri;break}gt.extra=st&15,gt.mode=Se;case Se:if(gt.extra){for(he=gt.extra;ce<he;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}gt.length+=Xt&(1<<gt.extra)-1,Xt>>>=gt.extra,ce-=gt.extra,gt.back+=gt.extra}gt.was=gt.length,gt.mode=oe;case oe:for(;ft=gt.distcode[Xt&(1<<gt.distbits)-1],_t=ft>>>24,st=ft>>>16&255,wt=ft&65535,!(_t<=ce);){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if((st&240)===0){for(g=_t,ct=st,Ce=wt;ft=gt.distcode[Ce+((Xt&(1<<g+ct)-1)>>g)],_t=ft>>>24,st=ft>>>16&255,wt=ft&65535,!(g+_t<=ce);){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}Xt>>>=g,ce-=g,gt.back+=g}if(Xt>>>=_t,ce-=_t,gt.back+=_t,st&64){Yt.msg="invalid distance code",gt.mode=Ri;break}gt.offset=wt,gt.extra=st&15,gt.mode=Ai;case Ai:if(gt.extra){for(he=gt.extra;ce<he;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}gt.offset+=Xt&(1<<gt.extra)-1,Xt>>>=gt.extra,ce-=gt.extra,gt.back+=gt.extra}if(gt.offset>gt.dmax){Yt.msg="invalid distance too far back",gt.mode=Ri;break}gt.mode=Ke;case Ke:if(xt===0)break t;if(at=nt-xt,gt.offset>at){if(at=gt.offset-at,at>gt.whave&&gt.sane){Yt.msg="invalid distance too far back",gt.mode=Ri;break}at>gt.wnext?(at-=gt.wnext,vt=gt.wsize-at):vt=gt.wnext-at,at>gt.length&&(at=gt.length),Ot=gt.window}else Ot=we,vt=ve-gt.offset,at=gt.length;at>xt&&(at=xt),xt-=at,gt.length-=at;do we[ve++]=Ot[vt++];while(--at);gt.length===0&&(gt.mode=Me);break;case qe:if(xt===0)break t;we[ve++]=gt.length,xt--,gt.mode=Me;break;case Ve:if(gt.wrap){for(;ce<32;){if(Be===0)break t;Be--,Xt|=ze[V++]<<ce,ce+=8}if(nt-=xt,Yt.total_out+=nt,gt.total+=nt,nt&&(Yt.adler=gt.check=gt.flags?i(gt.check,we,nt,ve-nt):t(gt.check,we,nt,ve-nt)),nt=xt,(gt.flags?Xt:lr(Xt))!==gt.check){Yt.msg="incorrect data check",gt.mode=Ri;break}Xt=0,ce=0}gt.mode=di;case di:if(gt.wrap&&gt.flags){for(;ce<32;){if(Be===0)break t;Be--,Xt+=ze[V++]<<ce,ce+=8}if(Xt!==(gt.total&4294967295)){Yt.msg="incorrect length check",gt.mode=Ri;break}Xt=0,ce=0}gt.mode=cn;case cn:Ee=S;break t;case Ri:Ee=U;break t;case bi:return H;case Vn:default:return N}return Yt.next_out=ve,Yt.avail_out=xt,Yt.next_in=V,Yt.avail_in=Be,gt.hold=Xt,gt.bits=ce,(gt.wsize||nt!==Yt.avail_out&&gt.mode<Ri&&(gt.mode<Ve||Re!==h))&&yr(Yt,Yt.output,Yt.next_out,nt-Yt.avail_out),q-=Yt.avail_in,nt-=Yt.avail_out,Yt.total_in+=q,Yt.total_out+=nt,gt.total+=nt,gt.wrap&&nt&&(Yt.adler=gt.check=gt.flags?i(gt.check,we,nt,Yt.next_out-nt):t(gt.check,we,nt,Yt.next_out-nt)),Yt.data_type=gt.bits+(gt.last?64:0)+(gt.mode===Et?128:0)+(gt.mode===de||gt.mode===Rt?256:0),(q===0&&nt===0||Re===h)&&Ee===C&&(Ee=j),Ee}function ke(Yt){if(!Yt||!Yt.state)return N;var Re=Yt.state;return Re.window&&(Re.window=null),Yt.state=null,C}function Je(Yt,Re){var gt;return!Yt||!Yt.state||(gt=Yt.state,(gt.wrap&2)===0)?N:(gt.head=Re,Re.done=!1,C)}function li(Yt,Re){var gt=Re.length,ze,we,V;return!Yt||!Yt.state||(ze=Yt.state,ze.wrap!==0&&ze.mode!==ut)?N:ze.mode===ut&&(we=1,we=t(we,Re,gt,0),we!==ze.check)?U:(V=yr(Yt,Re,gt,gt),V?(ze.mode=bi,H):(ze.havedict=1,C))}return Ga.inflateReset=ir,Ga.inflateReset2=Hn,Ga.inflateResetKeep=mn,Ga.inflateInit=$n,Ga.inflateInit2=Tn,Ga.inflate=St,Ga.inflateEnd=ke,Ga.inflateGetHeader=Je,Ga.inflateSetDictionary=li,Ga.inflateInfo="pako inflate (from Nodeca project)",Ga}var a5,c5;function l5(){return c5||(c5=1,a5={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}),a5}var SC,u5;function Ybt(){if(u5)return SC;u5=1;function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}return SC=e,SC}var h5;function $bt(){if(h5)return kp;h5=1;var e=Zbt(),t=fh(),i=t5(),n=l5(),r=CC(),s=i5(),o=Ybt(),c=Object.prototype.toString;function h(C){if(!(this instanceof h))return new h(C);this.options=t.assign({chunkSize:16384,windowBits:0,to:""},C||{});var S=this.options;S.raw&&S.windowBits>=0&&S.windowBits<16&&(S.windowBits=-S.windowBits,S.windowBits===0&&(S.windowBits=-15)),S.windowBits>=0&&S.windowBits<16&&!(C&&C.windowBits)&&(S.windowBits+=32),S.windowBits>15&&S.windowBits<48&&(S.windowBits&15)===0&&(S.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var L=e.inflateInit2(this.strm,S.windowBits);if(L!==n.Z_OK)throw new Error(r[L]);if(this.header=new o,e.inflateGetHeader(this.strm,this.header),S.dictionary&&(typeof S.dictionary=="string"?S.dictionary=i.string2buf(S.dictionary):c.call(S.dictionary)==="[object ArrayBuffer]"&&(S.dictionary=new Uint8Array(S.dictionary)),S.raw&&(L=e.inflateSetDictionary(this.strm,S.dictionary),L!==n.Z_OK)))throw new Error(r[L])}h.prototype.push=function(C,S){var L=this.strm,N=this.options.chunkSize,U=this.options.dictionary,H,j,tt,K,Q,pt=!1;if(this.ended)return!1;j=S===~~S?S:S===!0?n.Z_FINISH:n.Z_NO_FLUSH,typeof C=="string"?L.input=i.binstring2buf(C):c.call(C)==="[object ArrayBuffer]"?L.input=new Uint8Array(C):L.input=C,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new t.Buf8(N),L.next_out=0,L.avail_out=N),H=e.inflate(L,n.Z_NO_FLUSH),H===n.Z_NEED_DICT&&U&&(H=e.inflateSetDictionary(this.strm,U)),H===n.Z_BUF_ERROR&&pt===!0&&(H=n.Z_OK,pt=!1),H!==n.Z_STREAM_END&&H!==n.Z_OK)return this.onEnd(H),this.ended=!0,!1;L.next_out&&(L.avail_out===0||H===n.Z_STREAM_END||L.avail_in===0&&(j===n.Z_FINISH||j===n.Z_SYNC_FLUSH))&&(this.options.to==="string"?(tt=i.utf8border(L.output,L.next_out),K=L.next_out-tt,Q=i.buf2string(L.output,tt),L.next_out=K,L.avail_out=N-K,K&&t.arraySet(L.output,L.output,tt,K,0),this.onData(Q)):this.onData(t.shrinkBuf(L.output,L.next_out))),L.avail_in===0&&L.avail_out===0&&(pt=!0)}while((L.avail_in>0||L.avail_out===0)&&H!==n.Z_STREAM_END);return H===n.Z_STREAM_END&&(j=n.Z_FINISH),j===n.Z_FINISH?(H=e.inflateEnd(this.strm),this.onEnd(H),this.ended=!0,H===n.Z_OK):(j===n.Z_SYNC_FLUSH&&(this.onEnd(n.Z_OK),L.avail_out=0),!0)},h.prototype.onData=function(C){this.chunks.push(C)},h.prototype.onEnd=function(C){C===n.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=t.flattenChunks(this.chunks)),this.chunks=[],this.err=C,this.msg=this.strm.msg};function A(C,S){var L=new h(S);if(L.push(C,!0),L.err)throw L.msg||r[L.err];return L.result}function _(C,S){return S=S||{},S.raw=!0,A(C,S)}return kp.Inflate=h,kp.inflate=A,kp.inflateRaw=_,kp.ungzip=A,kp}var IC,f5;function t2t(){if(f5)return IC;f5=1;var e=fh().assign,t=Qbt(),i=$bt(),n=l5(),r={};return e(r,t,i,n),IC=r,IC}var e2t=t2t();const Np=zh(e2t),d5=[0],i2t={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:j8,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,i)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}};class MC extends To{initializeState(){"onTileLoadFail"in this.props&&Zi.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:i,changeFlags:n}){if(t.data&&t.data!==i.data&&this._loadTileset(t.data),n.viewportChanged){const{activeViewports:r}=this.state;Object.keys(r).length&&(this._updateTileset(r),this.state.lastUpdatedViewports=r,this.state.activeViewports={})}if(n.propsChanged){const{layerMap:r}=this.state;for(const s in r)r[s].needsUpdate=!0}}activateViewport(t){const{activeViewports:i,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,i[t.id]=t;const r=n?.[t.id];(!r||!t.equals(r))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:i}){const n=i&&i.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer({layer:t,viewport:i}){const{tile:n}=t.props,{id:r}=i;return n.selected&&n.viewportIds.includes(r)}_updateAutoHighlight(t){const i=t.sourceTile,n=this.state.layerMap[i?.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){const{loadOptions:i={}}=this.props,n=this.props.loader||this.props.loaders,r=Array.isArray(n)?n[0]:n,s={loadOptions:{...i}};let o=t;if(r.preload){const A=await r.preload(t,i);A.url&&(o=A.url),A.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:A.headers}),Object.assign(s,A)}const c=await tp(o,r,s.loadOptions),h=new Iyt(c,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:h,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(h)}_onTileLoad(t){const{lastUpdatedViewports:i}=this.state;this.props.onTileLoad(t),this._updateTileset(i),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;const{tileset3d:i}=this.state,{timeline:n}=this.context,r=Object.keys(t).length;!n||!r||!i||i.selectTiles(Object.values(t)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(t,i){if(!t.content)return null;switch(t.type){case ru.POINTCLOUD:return this._makePointCloudLayer(t,i);case ru.SCENEGRAPH:return this._make3DModelLayer(t);case ru.MESH:return this._makeSimpleMeshLayer(t,i);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${t.content.type}`)}}_makePointCloudLayer(t,i){const{attributes:n,pointCount:r,constantRGBA:s,cartographicOrigin:o,modelMatrix:c}=t.content,{positions:h,normals:A,colors:_}=n;if(!h)return null;const C=i&&i.props.data||{header:{vertexCount:r},attributes:{POSITION:h,NORMAL:A,COLOR_0:_}},{pointSize:S,getPointColor:L}=this.props,N=this.getSubLayerClass("pointcloud",Sg);return new N({pointSize:S},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${t.id}`,tile:t,data:C,coordinateSystem:$i.METER_OFFSETS,coordinateOrigin:o,modelMatrix:c,getColor:s||L,_offset:0})}_make3DModelLayer(t){const{gltf:i,instances:n,cartographicOrigin:r,modelMatrix:s}=t.content,o=this.getSubLayerClass("scenegraph",Jg);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${t.id}`,tile:t,data:n||d5,scenegraph:i,coordinateSystem:$i.METER_OFFSETS,coordinateOrigin:r,modelMatrix:s,getTransformMatrix:c=>c.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,i){const n=t.content,{attributes:r,indices:s,modelMatrix:o,cartographicOrigin:c,coordinateSystem:h=$i.METER_OFFSETS,material:A,featureIds:_}=n,{_getMeshColor:C}=this.props,S=i&&i.props.mesh||new Yo({topology:"triangle-list",attributes:n2t(r),indices:s}),L=this.getSubLayerClass("mesh",Nw);return new L(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${t.id}`,tile:t,mesh:S,data:d5,getColor:C(t),pbrMaterial:A,modelMatrix:o,coordinateOrigin:c,coordinateSystem:h,featureIds:_,_offset:0})}renderLayers(){const{tileset3d:t,layerMap:i}=this.state;return t?t.tiles.map(n=>{const r=i[n.id]=i[n.id]||{tile:n};let{layer:s}=r;return n.selected&&(s?r.needsUpdate&&(s=this._getSubLayer(n,s),r.needsUpdate=!1):s=this._getSubLayer(n)),r.layer=s,s}).filter(Boolean):null}}MC.defaultProps=i2t,MC.layerName="Tile3DLayer";function n2t(e){const t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}const r2t="4.3.1",p5={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:r2t,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};({...p5});const A5=[1],o2t={...nu.defaultProps,elevationData:Qy,texture:{...Qy,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[p5]};function g5(e){return Array.isArray(e)?e.join(";"):e||""}class PC extends To{updateState({props:t,oldProps:i}){const n=t.elevationData!==i.elevationData;if(n){const{elevationData:s}=t,o=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:o})}const r=n||t.meshMaxError!==i.meshMaxError||t.elevationDecoder!==i.elevationDecoder||t.bounds!==i.bounds;if(!this.state.isTiled&&r){const s=this.loadTerrain(t);this.setState({terrain:s})}t.workerUrl&&Zi.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:t,bounds:i,elevationDecoder:n,meshMaxError:r,signal:s}){if(!t)return null;let o=this.getLoadOptions();o={...o,terrain:{skirtHeight:this.state.isTiled?r*2:0,...o?.terrain,bounds:i,meshMaxError:r,elevationDecoder:n}};const{fetch:c}=this.props;return c(t,{propName:"elevationData",layer:this,loadOptions:o,signal:s})}getTiledTerrainData(t){const{elevationData:i,fetch:n,texture:r,elevationDecoder:s,meshMaxError:o}=this.props,{viewport:c}=this.context,h=pf(i,t),A=r&&pf(r,t),{signal:_}=t;let C=[0,0],S=[0,0];if(c.isGeospatial){const H=t.bbox;C=c.projectFlat([H.west,H.south]),S=c.projectFlat([H.east,H.north])}else{const H=t.bbox;C=[H.left,H.bottom],S=[H.right,H.top]}const L=[C[0],C[1],S[0],S[1]],N=this.loadTerrain({elevationData:h,bounds:L,elevationDecoder:s,meshMaxError:o,signal:_}),U=A?n(A,{propName:"texture",layer:this,loaders:[],signal:_}).catch(H=>null):Promise.resolve(null);return Promise.all([N,U])}renderSubLayers(t){const i=this.getSubLayerClass("mesh",Af),{color:n,wireframe:r,material:s}=this.props,{data:o}=t;if(!o)return null;const[c,h]=o;return new i(t,{data:A5,mesh:c,texture:h,_instanced:!1,coordinateSystem:$i.CARTESIAN,getPosition:A=>[0,0,0],getColor:n,wireframe:r,material:s})}onViewportLoad(t){if(!t)return;const{zRange:i}=this.state,n=t.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(c=>c[2]));if(n.length===0)return;const r=Math.min(...n.map(o=>o[0])),s=Math.max(...n.map(o=>o[1]));(!i||r<i[0]||s>i[1])&&this.setState({zRange:[r,s]})}renderLayers(){const{color:t,material:i,elevationData:n,texture:r,wireframe:s,meshMaxError:o,elevationDecoder:c,tileSize:h,maxZoom:A,minZoom:_,extent:C,maxRequests:S,onTileLoad:L,onTileUnload:N,onTileError:U,maxCacheSize:H,maxCacheByteSize:j,refinementStrategy:tt}=this.props;if(this.state.isTiled)return new nu(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:g5(n),texture:g5(r),meshMaxError:o,elevationDecoder:c}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:h,maxZoom:A,minZoom:_,extent:C,maxRequests:S,onTileLoad:L,onTileUnload:N,onTileError:U,maxCacheSize:H,maxCacheByteSize:j,refinementStrategy:tt});if(!n)return null;const K=this.getSubLayerClass("mesh",Af);return new K(this.getSubLayerProps({id:"mesh"}),{data:A5,mesh:this.state.terrain,texture:r,_instanced:!1,getPosition:Q=>[0,0,0],getColor:t,material:i,wireframe:s})}}PC.defaultProps=o2t,PC.layerName="TerrainLayer";const s2t={clipBounds:[0,0,1,1],clipByInstance:void 0},m5=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,a2t={name:"clip",vs:m5,uniformTypes:{bounds:"vec4<f32>"}},c2t={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},l2t={name:"clip",fs:m5,uniformTypes:{bounds:"vec4<f32>"}},u2t={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`};class Ov extends H0{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(t=!!this.props.clipByInstance),this.state.clipByInstance=t,t?{modules:[a2t],inject:c2t}:{modules:[l2t],inject:u2t}}draw(){const{clipBounds:t}=this.props,i={};if(this.state.clipByInstance)i.bounds=t;else{const n=this.projectPosition([t[0],t[1],0]),r=this.projectPosition([t[2],t[3],0]);i.bounds=[Math.min(n[0],r[0]),Math.min(n[1],r[1]),Math.max(n[0],r[0]),Math.max(n[1],r[1])]}this.setShaderModuleProps({clip:i})}}Ov.defaultProps=s2t,Ov.extensionName="ClipExtension";const h2t=`
in float collisionPriorities;

uniform sampler2D collision_texture;

uniform collisionUniforms {
  bool sort;
  bool enabled;
} collision;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision.enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project.viewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,f2t={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision.sort) {
    float collisionPriority = collisionPriorities;
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision.enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},d2t=e=>{if(!e||!("dummyCollisionMap"in e))return{};const{enabled:t,collisionFBO:i,drawToCollisionMap:n,dummyCollisionMap:r}=e;return{enabled:t&&!n,sort:!!n,collision_texture:!n&&i?i.colorAttachments[0]:r}},p2t={name:"collision",dependencies:[B0],vs:h2t,inject:f2t,getUniforms:d2t,uniformTypes:{sort:"i32",enabled:"i32"}};class A2t extends S0{renderCollisionMap(t,i){const n=[0,0,0,0],r=[1,1,t.width-2*1,t.height-2*1];this.render({...i,clearColor:n,scissorRect:r,target:t,pass:"collision"})}getLayerParameters(t,i,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}}const RC=2;class g2t{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(t){this.context=t;const{device:i}=t;this.dummyCollisionMap=i.createTexture({width:1,height:1}),this.collisionFilterPass=new A2t(i,{id:"default-collision-filter"})}preRender({effects:t,layers:i,layerFilter:n,viewports:r,onViewportActive:s,views:o,isPicking:c,preRenderStats:h={}}){const{device:A}=this.context;if(c)return;const _=i.filter(({props:{visible:H,collisionEnabled:j}})=>H&&j);if(_.length===0){this.channels={};return}const C=t?.filter(H=>H.useInPicking&&h[H.id]),S=h["mask-effect"]?.didRender,L=this._groupByCollisionGroup(A,_),N=r[0],U=!this.lastViewport||!this.lastViewport.equals(N)||S;for(const H in L){const j=this.collisionFBOs[H],tt=L[H],[K,Q]=A.canvasContext.getPixelSize();j.resize({width:K/RC,height:Q/RC}),this._render(tt,{effects:C,layerFilter:n,onViewportActive:s,views:o,viewport:N,viewportChanged:U})}}_render(t,{effects:i,layerFilter:n,onViewportActive:r,views:s,viewport:o,viewportChanged:c}){const{collisionGroup:h}=t,A=this.channels[h];if(!A)return;const _=c||t===A||!Yr(A.layers,t.layers,1)||t.layerBounds.some((C,S)=>!ca(C,A.layerBounds[S]))||t.allLayersLoaded!==A.allLayersLoaded||t.layers.some(C=>C.props.transitions);if(this.channels[h]=t,_){this.lastViewport=o;const C=this.collisionFBOs[h];this.collisionFilterPass.renderCollisionMap(C,{pass:"collision-filter",isPicking:!0,layers:t.layers,effects:i,layerFilter:n,viewports:o?[o]:[],onViewportActive:r,views:s,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:C.device.canvasContext.getDevicePixelRatio()/RC}}})}}_groupByCollisionGroup(t,i){const n={};for(const r of i){const s=r.props.collisionGroup;let o=n[s];o||(o={collisionGroup:s,layers:[],layerBounds:[],allLayersLoaded:!0},n[s]=o),o.layers.push(r),o.layerBounds.push(r.getBounds()),r.isLoaded||(o.allLayersLoaded=!1)}for(const r of Object.keys(n))this.collisionFBOs[r]||this.createFBO(t,r),this.channels[r]||(this.channels[r]=n[r]);for(const r of Object.keys(this.collisionFBOs))n[r]||this.destroyFBO(r);return n}getShaderModuleProps(t){const{collisionGroup:i,collisionEnabled:n}=t.props,{collisionFBOs:r,dummyCollisionMap:s}=this,o=r[i];return{collision:{enabled:n&&!!o,collisionFBO:o,dummyCollisionMap:s}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const t of Object.keys(this.collisionFBOs))this.destroyFBO(t);this.collisionFBOs={},this.lastViewport=void 0}createFBO(t,i){const{width:n,height:r}=t.gl.canvas,s=t.createTexture({format:"rgba8unorm",width:n,height:r,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=t.createTexture({format:"depth16unorm",width:n,height:r,mipmaps:!1});this.collisionFBOs[i]=t.createFramebuffer({id:`collision-${i}`,width:n,height:r,colorAttachments:[s],depthStencilAttachment:o})}destroyFBO(t){const i=this.collisionFBOs[t];i.colorAttachments[0]?.destroy(),i.depthStencilAttachment?.destroy(),i.destroy(),delete this.collisionFBOs[t]}}const m2t={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}};class DC extends H0{getShaders(){return{modules:[p2t]}}draw({shaderModuleProps:t}){t.collision?.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(t,i){this.getAttributeManager()!==null&&(this.context.deck?._addDefaultEffect(new g2t),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}}))}getNeedsPickingBuffer(){return this.props.collisionEnabled}}DC.defaultProps=m2t,DC.extensionName="CollisionFilterExtension";function OC(e,t){const i=t?.globalFeatureId;return i!==void 0?y2t(e,i):v2t(e,t?.type)}function y2t(e,t){const i=y5(e);for(const n of i){let r=0,s=n.featureIds.value[0];for(let o=0;o<n.featureIds.value.length;o++){const c=n.featureIds.value[o];if(c!==s){if(t===n.globalFeatureIds.value[r])return Lv(n,r,o);r=o,s=c}}if(t===n.globalFeatureIds.value[r])return Lv(n,r,n.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}function v2t(e,t){const i=y5(e);return b2t(i)}function _2t(e,t,i){switch(e.type){case"Point":return E2t(e,t,i);case"LineString":return C2t(e,t,i);case"Polygon":return v5(e,t,i);default:const n=e;throw new Error(`Unsupported geometry type: ${n?.type}`)}}function y5(e,t){const i=[];return e.points&&(e.points.type="Point",i.push(e.points)),e.lines&&(e.lines.type="LineString",i.push(e.lines)),e.polygons&&(e.polygons.type="Polygon",i.push(e.polygons)),i}function b2t(e){const t=[];for(const i of e){if(i.featureIds.value.length===0)continue;let n=0,r=i.featureIds.value[0];for(let s=0;s<i.featureIds.value.length;s++){const o=i.featureIds.value[s];o!==r&&(t.push(Lv(i,n,s)),n=s,r=o)}t.push(Lv(i,n,i.featureIds.value.length))}return t}function Lv(e,t,i){const n=_2t(e,t,i),r=w2t(e,t),s=x2t(e,t);return{type:"Feature",geometry:n,properties:r,...s}}function x2t(e,t=0,i){return e.fields&&e.fields[e.featureIds.value[t]]}function w2t(e,t=0,i){const n=Object.assign({},e.properties[e.featureIds.value[t]]);for(const r in e.numericProps)n[r]=e.numericProps[r].value[t];return n}function v5(e,t=-1/0,i=1/0){const{positions:n}=e,r=e.polygonIndices.value.filter(c=>c>=t&&c<=i),s=e.primitivePolygonIndices.value.filter(c=>c>=t&&c<=i);if(!(r.length>2)){const c=[];for(let h=0;h<s.length-1;h++){const A=s[h],_=s[h+1],C=Fv(n,A,_);c.push(C)}return{type:"Polygon",coordinates:c}}const o=[];for(let c=0;c<r.length-1;c++){const h=r[c],A=r[c+1],_=v5(e,h,A).coordinates;o.push(_)}return{type:"MultiPolygon",coordinates:o}}function C2t(e,t=-1/0,i=1/0){const{positions:n}=e,r=e.pathIndices.value.filter(o=>o>=t&&o<=i);if(!(r.length>2))return{type:"LineString",coordinates:Fv(n,r[0],r[1])};const s=[];for(let o=0;o<r.length-1;o++){const c=Fv(n,r[o],r[o+1]);s.push(c)}return{type:"MultiLineString",coordinates:s}}function E2t(e,t,i){const{positions:n}=e,r=Fv(n,t,i);return r.length>1?{type:"MultiPoint",coordinates:r}:{type:"Point",coordinates:r[0]}}function Fv(e,t,i){t=t||0,i=i||e.value.length/e.size;const n=[];for(let r=t;r<i;r++){const s=Array();for(let o=r*e.size;o<(r+1)*e.size;o++)s.push(Number(e.value[o]));n.push(s)}return n}var LC={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var _5;function B2t(){return _5||(_5=1,LC.read=function(e,t,i,n,r){var s,o,c=r*8-n-1,h=(1<<c)-1,A=h>>1,_=-7,C=i?r-1:0,S=i?-1:1,L=e[t+C];for(C+=S,s=L&(1<<-_)-1,L>>=-_,_+=c;_>0;s=s*256+e[t+C],C+=S,_-=8);for(o=s&(1<<-_)-1,s>>=-_,_+=n;_>0;o=o*256+e[t+C],C+=S,_-=8);if(s===0)s=1-A;else{if(s===h)return o?NaN:(L?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-A}return(L?-1:1)*o*Math.pow(2,s-n)},LC.write=function(e,t,i,n,r,s){var o,c,h,A=s*8-r-1,_=(1<<A)-1,C=_>>1,S=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=n?0:s-1,N=n?1:-1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(c=isNaN(t)?1:0,o=_):(o=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-o))<1&&(o--,h*=2),o+C>=1?t+=S/h:t+=S*Math.pow(2,1-C),t*h>=2&&(o++,h/=2),o+C>=_?(c=0,o=_):o+C>=1?(c=(t*h-1)*Math.pow(2,r),o=o+C):(c=t*Math.pow(2,C-1)*Math.pow(2,r),o=0));r>=8;e[i+L]=c&255,L+=N,c/=256,r-=8);for(o=o<<r|c,A+=r;A>0;e[i+L]=o&255,L+=N,o/=256,A-=8);e[i+L-N]|=U*128}),LC}var FC,b5;function T2t(){if(b5)return FC;b5=1,FC=t;var e=B2t();function t(J){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(J)?J:new Uint8Array(J||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var i=65536*65536,n=1/i,r=12,s=typeof TextDecoder>"u"?null:new TextDecoder("utf8");t.prototype={destroy:function(){this.buf=null},readFields:function(J,ut,Et){for(Et=Et||this.length;this.pos<Et;){var le=this.readVarint(),Ct=le>>3,Rt=this.pos;this.type=le&7,J(Ct,ut,this),this.pos===Rt&&this.skip(le)}return ut},readMessage:function(J,ut){return this.readFields(J,ut,this.readVarint()+this.pos)},readFixed32:function(){var J=$(this.buf,this.pos);return this.pos+=4,J},readSFixed32:function(){var J=Gt(this.buf,this.pos);return this.pos+=4,J},readFixed64:function(){var J=$(this.buf,this.pos)+$(this.buf,this.pos+4)*i;return this.pos+=8,J},readSFixed64:function(){var J=$(this.buf,this.pos)+Gt(this.buf,this.pos+4)*i;return this.pos+=8,J},readFloat:function(){var J=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,J},readDouble:function(){var J=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,J},readVarint:function(J){var ut=this.buf,Et,le;return le=ut[this.pos++],Et=le&127,le<128||(le=ut[this.pos++],Et|=(le&127)<<7,le<128)||(le=ut[this.pos++],Et|=(le&127)<<14,le<128)||(le=ut[this.pos++],Et|=(le&127)<<21,le<128)?Et:(le=ut[this.pos],Et|=(le&15)<<28,o(Et,J,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var J=this.readVarint();return J%2===1?(J+1)/-2:J/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var J=this.readVarint()+this.pos,ut=this.pos;return this.pos=J,J-ut>=r&&s?lt(this.buf,ut,J):dt(this.buf,ut,J)},readBytes:function(){var J=this.readVarint()+this.pos,ut=this.buf.subarray(this.pos,J);return this.pos=J,ut},readPackedVarint:function(J,ut){if(this.type!==t.Bytes)return J.push(this.readVarint(ut));var Et=c(this);for(J=J||[];this.pos<Et;)J.push(this.readVarint(ut));return J},readPackedSVarint:function(J){if(this.type!==t.Bytes)return J.push(this.readSVarint());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readSVarint());return J},readPackedBoolean:function(J){if(this.type!==t.Bytes)return J.push(this.readBoolean());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readBoolean());return J},readPackedFloat:function(J){if(this.type!==t.Bytes)return J.push(this.readFloat());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readFloat());return J},readPackedDouble:function(J){if(this.type!==t.Bytes)return J.push(this.readDouble());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readDouble());return J},readPackedFixed32:function(J){if(this.type!==t.Bytes)return J.push(this.readFixed32());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readFixed32());return J},readPackedSFixed32:function(J){if(this.type!==t.Bytes)return J.push(this.readSFixed32());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readSFixed32());return J},readPackedFixed64:function(J){if(this.type!==t.Bytes)return J.push(this.readFixed64());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readFixed64());return J},readPackedSFixed64:function(J){if(this.type!==t.Bytes)return J.push(this.readSFixed64());var ut=c(this);for(J=J||[];this.pos<ut;)J.push(this.readSFixed64());return J},skip:function(J){var ut=J&7;if(ut===t.Varint)for(;this.buf[this.pos++]>127;);else if(ut===t.Bytes)this.pos=this.readVarint()+this.pos;else if(ut===t.Fixed32)this.pos+=4;else if(ut===t.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+ut)},writeTag:function(J,ut){this.writeVarint(J<<3|ut)},realloc:function(J){for(var ut=this.length||16;ut<this.pos+J;)ut*=2;if(ut!==this.length){var Et=new Uint8Array(ut);Et.set(this.buf),this.buf=Et,this.length=ut}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(J){this.realloc(4),zt(this.buf,J,this.pos),this.pos+=4},writeSFixed32:function(J){this.realloc(4),zt(this.buf,J,this.pos),this.pos+=4},writeFixed64:function(J){this.realloc(8),zt(this.buf,J&-1,this.pos),zt(this.buf,Math.floor(J*n),this.pos+4),this.pos+=8},writeSFixed64:function(J){this.realloc(8),zt(this.buf,J&-1,this.pos),zt(this.buf,Math.floor(J*n),this.pos+4),this.pos+=8},writeVarint:function(J){if(J=+J||0,J>268435455||J<0){A(J,this);return}this.realloc(4),this.buf[this.pos++]=J&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=(J>>>=7)&127|(J>127?128:0),!(J<=127)&&(this.buf[this.pos++]=J>>>7&127)))},writeSVarint:function(J){this.writeVarint(J<0?-J*2-1:J*2)},writeBoolean:function(J){this.writeVarint(!!J)},writeString:function(J){J=String(J),this.realloc(J.length*4),this.pos++;var ut=this.pos;this.pos=Lt(this.buf,J,this.pos);var Et=this.pos-ut;Et>=128&&S(ut,Et,this),this.pos=ut-1,this.writeVarint(Et),this.pos+=Et},writeFloat:function(J){this.realloc(4),e.write(this.buf,J,this.pos,!0,23,4),this.pos+=4},writeDouble:function(J){this.realloc(8),e.write(this.buf,J,this.pos,!0,52,8),this.pos+=8},writeBytes:function(J){var ut=J.length;this.writeVarint(ut),this.realloc(ut);for(var Et=0;Et<ut;Et++)this.buf[this.pos++]=J[Et]},writeRawMessage:function(J,ut){this.pos++;var Et=this.pos;J(ut,this);var le=this.pos-Et;le>=128&&S(Et,le,this),this.pos=Et-1,this.writeVarint(le),this.pos+=le},writeMessage:function(J,ut,Et){this.writeTag(J,t.Bytes),this.writeRawMessage(ut,Et)},writePackedVarint:function(J,ut){ut.length&&this.writeMessage(J,L,ut)},writePackedSVarint:function(J,ut){ut.length&&this.writeMessage(J,N,ut)},writePackedBoolean:function(J,ut){ut.length&&this.writeMessage(J,j,ut)},writePackedFloat:function(J,ut){ut.length&&this.writeMessage(J,U,ut)},writePackedDouble:function(J,ut){ut.length&&this.writeMessage(J,H,ut)},writePackedFixed32:function(J,ut){ut.length&&this.writeMessage(J,tt,ut)},writePackedSFixed32:function(J,ut){ut.length&&this.writeMessage(J,K,ut)},writePackedFixed64:function(J,ut){ut.length&&this.writeMessage(J,Q,ut)},writePackedSFixed64:function(J,ut){ut.length&&this.writeMessage(J,pt,ut)},writeBytesField:function(J,ut){this.writeTag(J,t.Bytes),this.writeBytes(ut)},writeFixed32Field:function(J,ut){this.writeTag(J,t.Fixed32),this.writeFixed32(ut)},writeSFixed32Field:function(J,ut){this.writeTag(J,t.Fixed32),this.writeSFixed32(ut)},writeFixed64Field:function(J,ut){this.writeTag(J,t.Fixed64),this.writeFixed64(ut)},writeSFixed64Field:function(J,ut){this.writeTag(J,t.Fixed64),this.writeSFixed64(ut)},writeVarintField:function(J,ut){this.writeTag(J,t.Varint),this.writeVarint(ut)},writeSVarintField:function(J,ut){this.writeTag(J,t.Varint),this.writeSVarint(ut)},writeStringField:function(J,ut){this.writeTag(J,t.Bytes),this.writeString(ut)},writeFloatField:function(J,ut){this.writeTag(J,t.Fixed32),this.writeFloat(ut)},writeDoubleField:function(J,ut){this.writeTag(J,t.Fixed64),this.writeDouble(ut)},writeBooleanField:function(J,ut){this.writeVarintField(J,!!ut)}};function o(J,ut,Et){var le=Et.buf,Ct,Rt;if(Rt=le[Et.pos++],Ct=(Rt&112)>>4,Rt<128||(Rt=le[Et.pos++],Ct|=(Rt&127)<<3,Rt<128)||(Rt=le[Et.pos++],Ct|=(Rt&127)<<10,Rt<128)||(Rt=le[Et.pos++],Ct|=(Rt&127)<<17,Rt<128)||(Rt=le[Et.pos++],Ct|=(Rt&127)<<24,Rt<128)||(Rt=le[Et.pos++],Ct|=(Rt&1)<<31,Rt<128))return h(J,Ct,ut);throw new Error("Expected varint not more than 10 bytes")}function c(J){return J.type===t.Bytes?J.readVarint()+J.pos:J.pos+1}function h(J,ut,Et){return Et?ut*4294967296+(J>>>0):(ut>>>0)*4294967296+(J>>>0)}function A(J,ut){var Et,le;if(J>=0?(Et=J%4294967296|0,le=J/4294967296|0):(Et=~(-J%4294967296),le=~(-J/4294967296),Et^4294967295?Et=Et+1|0:(Et=0,le=le+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ut.realloc(10),_(Et,le,ut),C(le,ut)}function _(J,ut,Et){Et.buf[Et.pos++]=J&127|128,J>>>=7,Et.buf[Et.pos++]=J&127|128,J>>>=7,Et.buf[Et.pos++]=J&127|128,J>>>=7,Et.buf[Et.pos++]=J&127|128,J>>>=7,Et.buf[Et.pos]=J&127}function C(J,ut){var Et=(J&7)<<4;ut.buf[ut.pos++]|=Et|((J>>>=3)?128:0),J&&(ut.buf[ut.pos++]=J&127|((J>>>=7)?128:0),J&&(ut.buf[ut.pos++]=J&127|((J>>>=7)?128:0),J&&(ut.buf[ut.pos++]=J&127|((J>>>=7)?128:0),J&&(ut.buf[ut.pos++]=J&127|((J>>>=7)?128:0),J&&(ut.buf[ut.pos++]=J&127)))))}function S(J,ut,Et){var le=ut<=16383?1:ut<=2097151?2:ut<=268435455?3:Math.floor(Math.log(ut)/(Math.LN2*7));Et.realloc(le);for(var Ct=Et.pos-1;Ct>=J;Ct--)Et.buf[Ct+le]=Et.buf[Ct]}function L(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeVarint(J[Et])}function N(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeSVarint(J[Et])}function U(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeFloat(J[Et])}function H(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeDouble(J[Et])}function j(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeBoolean(J[Et])}function tt(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeFixed32(J[Et])}function K(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeSFixed32(J[Et])}function Q(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeFixed64(J[Et])}function pt(J,ut){for(var Et=0;Et<J.length;Et++)ut.writeSFixed64(J[Et])}function $(J,ut){return(J[ut]|J[ut+1]<<8|J[ut+2]<<16)+J[ut+3]*16777216}function zt(J,ut,Et){J[Et]=ut,J[Et+1]=ut>>>8,J[Et+2]=ut>>>16,J[Et+3]=ut>>>24}function Gt(J,ut){return(J[ut]|J[ut+1]<<8|J[ut+2]<<16)+(J[ut+3]<<24)}function dt(J,ut,Et){for(var le="",Ct=ut;Ct<Et;){var Rt=J[Ct],Nt=null,Zt=Rt>239?4:Rt>223?3:Rt>191?2:1;if(Ct+Zt>Et)break;var re,se,de;Zt===1?Rt<128&&(Nt=Rt):Zt===2?(re=J[Ct+1],(re&192)===128&&(Nt=(Rt&31)<<6|re&63,Nt<=127&&(Nt=null))):Zt===3?(re=J[Ct+1],se=J[Ct+2],(re&192)===128&&(se&192)===128&&(Nt=(Rt&15)<<12|(re&63)<<6|se&63,(Nt<=2047||Nt>=55296&&Nt<=57343)&&(Nt=null))):Zt===4&&(re=J[Ct+1],se=J[Ct+2],de=J[Ct+3],(re&192)===128&&(se&192)===128&&(de&192)===128&&(Nt=(Rt&15)<<18|(re&63)<<12|(se&63)<<6|de&63,(Nt<=65535||Nt>=1114112)&&(Nt=null))),Nt===null?(Nt=65533,Zt=1):Nt>65535&&(Nt-=65536,le+=String.fromCharCode(Nt>>>10&1023|55296),Nt=56320|Nt&1023),le+=String.fromCharCode(Nt),Ct+=Zt}return le}function lt(J,ut,Et){return s.decode(J.subarray(ut,Et))}function Lt(J,ut,Et){for(var le=0,Ct,Rt;le<ut.length;le++){if(Ct=ut.charCodeAt(le),Ct>55295&&Ct<57344)if(Rt)if(Ct<56320){J[Et++]=239,J[Et++]=191,J[Et++]=189,Rt=Ct;continue}else Ct=Rt-55296<<10|Ct-56320|65536,Rt=null;else{Ct>56319||le+1===ut.length?(J[Et++]=239,J[Et++]=191,J[Et++]=189):Rt=Ct;continue}else Rt&&(J[Et++]=239,J[Et++]=191,J[Et++]=189,Rt=null);Ct<128?J[Et++]=Ct:(Ct<2048?J[Et++]=Ct>>6|192:(Ct<65536?J[Et++]=Ct>>12|224:(J[Et++]=Ct>>18|240,J[Et++]=Ct>>12&63|128),J[Et++]=Ct>>6&63|128),J[Et++]=Ct&63|128)}return Et}return FC}var S2t=T2t();const I2t=zh(S2t),M2t="4.3.1",x5={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:M2t,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}};({...x5});const P2t={Point:w5,MultiPoint:R2t,LineString:C5,MultiLineString:D2t,Polygon:E5,MultiPolygon:O2t};function w5([e,t],[i,n],r){const s=hc(i[0],n[0],e),o=hc(i[1],n[1],t);return r.unprojectFlat([s,o])}function kC(e,t,i){return e.map(n=>w5(n,t,i))}function R2t(e,t,i){return kC(e,t,i)}function C5(e,t,i){return kC(e,t,i)}function D2t(e,t,i){return e.map(n=>C5(n,t,i))}function E5(e,t,i){return e.map(n=>kC(n,t,i))}function O2t(e,t,i){return e.map(n=>E5(n,t,i))}function L2t(e,t,i){const n=i.projectFlat([t.west,t.north]),r=i.projectFlat([t.east,t.south]),s=[n,r];return{...e,coordinates:P2t[e.type](e.coordinates,s,i)}}const F2t=["points","lines","polygons"];function k2t(e,t,i,n){for(const r of F2t){const s=e[r]&&N2t(e[r],t,i,n);if(s>=0)return s}return-1}function N2t(e,t,i,n){const r=e.featureIds.value;if(!r.length)return-1;let s=0,o=r[r.length-1]+1;if(n){const h=U2t(e,n);if(h)s=h[0],o=h[1]+1;else return-1}let c=-1;if(t in e.numericProps){const h=e.numericProps[t].value.findIndex((A,_)=>A===i&&r[_]>=s&&r[_]<o);return h>=0?e.globalFeatureIds.value[h]:-1}else t?c=B5(e.properties,h=>h[t]===i,s,o):e.fields&&(c=B5(e.fields,h=>h.id===i,s,o));return c>=0?z2t(e,c):-1}function U2t(e,t){if(!e.__layers){const i={},{properties:n}=e;for(let r=0;r<n.length;r++){const{layerName:s}=n[r];s&&(i[s]?i[s][1]=r:i[s]=[r,r])}e.__layers=i}return e.__layers[t]}function z2t(e,t){if(!e.__ids){const i=[],n=e.featureIds.value,r=e.globalFeatureIds.value;for(let s=0;s<n.length;s++)i[n[s]]=r[s];e.__ids=i}return e.__ids[t]}function B5(e,t,i,n){for(let r=i;r<n;r++)if(t(e[r],r))return r;return-1}const NC=512,G2t={...$l.defaultProps,data:Qy,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[x5],binary:!0};class Up extends nu{initializeState(){super.initializeState();const t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:t,oldProps:i,context:n,changeFlags:r}){r.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:t,oldProps:i,context:n,changeFlags:r}),this._setWGS84PropertyForTiles());const{highlightColor:s}=t;s!==i.highlightColor&&Array.isArray(s)&&this.setState({highlightColor:s})}async _updateTileData(){let t=this.props.data,i=null;if(typeof t=="string"&&!Adt(t)){const{onDataLoad:n,fetch:r}=this.props;this.setState({data:null,tileJSON:null});try{i=await r(t,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),t=null}n&&n(i,{propName:"data",layer:this})}else t&&typeof t=="object"&&"tilejson"in t&&(i=t);i&&(t=i.tiles),this.setState({data:t,tileJSON:i})}_getTilesetOptions(){const t=super._getTilesetOptions(),i=this.state.tileJSON,{minZoom:n,maxZoom:r}=this.props;return i&&(Number.isFinite(i.minzoom)&&i.minzoom>n&&(t.minZoom=i.minzoom),Number.isFinite(i.maxzoom)&&(!Number.isFinite(r)||i.maxzoom<r)&&(t.maxZoom=i.maxzoom)),t}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(t){const{data:i,binary:n}=this.state,{index:r,signal:s}=t,o=pf(i,t);if(!o)return Promise.reject("Invalid URL");let c=this.getLoadOptions();const{fetch:h}=this.props;return c={...c,mimeType:"application/x-protobuf",mvt:{...c?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:r},gis:n?{format:"binary"}:{}},h(o,{propName:"data",layer:this,loadOptions:c,signal:s})}renderSubLayers(t){const{x:i,y:n,z:r}=t.tile.index,s=Math.pow(2,r),o=NC/s,c=-o,h=NC*i/s,A=NC*(1-n/s),_=new yn().scale([o,c,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=_,t.coordinateOrigin=[h,A,0],t.coordinateSystem=$i.CARTESIAN,t.extensions=[...t.extensions||[],new Ov]);const C=super.renderSubLayers(t);return this.state.binary&&!(C instanceof $l)&&Zi.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),C}_updateAutoHighlight(t){const{uniqueIdProperty:i}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:r}=this.state,s=t.object;let o=null,c=null;s&&(o=UC(s,i),c=T5(s));let{highlightColor:h}=this.props;typeof h=="function"&&(h=h(t)),(n!==o||r!==c)&&this.setState({highlightColor:h,hoveredFeatureId:o,hoveredFeatureLayerName:c})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(t){const i=super.getPickingInfo(t);if(this.state.binary&&i.index!==-1){const{data:n}=t.sourceLayer.props;i.object=OC(n,{globalFeatureId:i.index})}return i.object&&!this._isWGS84()&&(i.object=I5(i.object,i.tile.bbox,this.context.viewport)),i}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:i,hoveredFeatureLayerName:n,binary:r}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,c=t.content,h=S5(o);if(!(S5(i)||h))return-1;const A=h?o:i;return Array.isArray(c)?c.findIndex(_=>{const C=UC(_,s)===A,S=h||T5(_)===n;return C&&S}):c&&r?k2t(c,s,A,h?"":n):-1}_pickObjects(t){const{deck:i,viewport:n}=this.context,r=n.width,s=n.height,o=n.x,c=n.y,h=[this.id];return i.pickObjects({x:o,y:c,width:r,height:s,layerIds:h,maxObjects:t})}getRenderedFeatures(t=null){const i=this._pickObjects(t),n=new Set,r=[];for(const s of i){const o=UC(s.object,this.props.uniqueIdProperty);o===void 0?r.push(s.object):n.has(o)||(n.add(o),r.push(s.object))}return r}_setWGS84PropertyForTiles(){const t="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(t)||Object.defineProperty(i,t,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];const{bbox:n}=i;if(i._contentWGS84===void 0&&gdt(n)){const r=this.state.binary?OC(i.content):i.content;i._contentWGS84=r.map(s=>I5(s,n,this.context.viewport))}return i._contentWGS84}})})}}Up.layerName="MVTLayer",Up.defaultProps=G2t;function UC(e,t){if(e.properties&&t)return e.properties[t];if("id"in e)return e.id}function T5(e){return e.properties?.layerName||null}function S5(e){return e!=null&&e!==""}function I5(e,t,i){const n={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>L2t(e.geometry,t,i).coordinates}),n}const M5="0123456789bcdefghjkmnpqrstuvwxyz",P5={};for(let e=0;e<M5.length;e++)P5[M5.charAt(e)]=e;const j2t=-90,V2t=90,H2t=-180,W2t=180;function J2t(e){let t=!0,i=V2t,n=j2t,r=W2t,s=H2t,o,c=0;for(let h=0,A=e.length;h<A;h++){const _=e[h].toLowerCase();c=P5[_];for(let C=4;C>=0;C--){const S=c>>C&1;t?(o=(r+s)/2,S===1?s=o:r=o):(o=(i+n)/2,S===1?n=o:i=o),t=!t}}return[n,s,i,r]}function X2t(e){const[t,i,n,r]=J2t(e);return[r,n,r,t,i,t,i,n,r,n]}const Q2t={getGeohash:{type:"accessor",value:e=>e.geohash}};class kv extends sh{indexToBounds(){const{data:t,getGeohash:i}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,r)=>X2t(i(n,r))}}}kv.layerName="GeohashLayer",kv.defaultProps=Q2t;const K2t=Object.freeze(Object.defineProperty({__proto__:null,GeohashLayer:kv,GreatCircleLayer:Zx,H3ClusterLayer:iv,H3HexagonLayer:gl,MVTLayer:Up,QuadkeyLayer:Vy,S2Layer:jy,TerrainLayer:PC,Tile3DLayer:MC,TileLayer:nu,TripsLayer:Zy,_GeoCellLayer:sh,_Tile2DHeader:zL,_Tileset2D:qy,_WMSLayer:qx,_getURLFromTemplate:pf},Symbol.toStringTag,{value:"Module"}));function q2t({pointCount:e,getBinId:t}){const i=new Map;for(let n=0;n<e;n++){const r=t(n);if(r===null)continue;let s=i.get(String(r));s?s.points.push(n):(s={id:r,index:i.size,points:[n]},i.set(String(r),s))}return Array.from(i.values())}function Z2t({bins:e,dimensions:t,target:i}){const n=e.length*t;(!i||i.length<n)&&(i=new Float32Array(n));for(let r=0;r<e.length;r++){const{id:s}=e[r];Array.isArray(s)?i.set(s,r*t):i[r]=s}return i}const Y2t=e=>e.length,R5=(e,t)=>{let i=0;for(const n of e)i+=t(n);return i},$2t=(e,t)=>e.length===0?NaN:R5(e,t)/e.length,txt=(e,t)=>{let i=1/0;for(const n of e){const r=t(n);r<i&&(i=r)}return i},ext=(e,t)=>{let i=-1/0;for(const n of e){const r=t(n);r>i&&(i=r)}return i},ixt={COUNT:Y2t,SUM:R5,MEAN:$2t,MIN:txt,MAX:ext};function nxt({bins:e,getValue:t,operation:i,target:n}){(!n||n.length<e.length)&&(n=new Float32Array(e.length));let r=1/0,s=-1/0;for(let o=0;o<e.length;o++){const{points:c}=e[o];n[o]=i(c,t),n[o]<r&&(r=n[o]),n[o]>s&&(s=n[o])}return{value:n,domain:[r,s]}}function D5(e,t,i){const n={};for(const s of e.sources||[]){const o=t[s];if(o)n[s]=rxt(o);else throw new Error(`Cannot find attribute ${s}`)}const r={};return s=>{for(const o in n)r[o]=n[o](s);return e.getValue(r,s,i)}}function rxt(e){const t=e.value,{offset:i=0,stride:n,size:r}=e.getAccessor(),s=t.BYTES_PER_ELEMENT,o=i/s,c=n?n/s:r;if(r===1)return e.isConstant?()=>t[0]:A=>{const _=o+c*A;return t[_]};let h;return e.isConstant?(h=Array.from(t),()=>h):(h=new Array(r),A=>{const _=o+c*A;for(let C=0;C<r;C++)h[C]=t[_+C];return h})}class zp{constructor(t){this.bins=[],this.binIds=null,this.results=[],this.dimensions=t.dimensions,this.channelCount=t.getValue.length,this.props={...t,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(t)}destroy(){}get binCount(){return this.bins.length}setProps(t){const i=this.props;if(t.binOptions&&(Yr(t.binOptions,i.binOptions,2)||this.setNeedsUpdate()),t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==i.operations[n]&&this.setNeedsUpdate(n);if(t.customOperations)for(let n=0;n<this.channelCount;n++)!!t.customOperations[n]!=!!i.customOperations[n]&&this.setNeedsUpdate(n);t.pointCount!==void 0&&t.pointCount!==i.pointCount&&this.setNeedsUpdate(),t.attributes&&(t.attributes={...i.attributes,...t.attributes}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[t]=!0)}update(){if(this.needsUpdate===!0){this.bins=q2t({pointCount:this.props.pointCount,getBinId:D5(this.props.getBin,this.props.attributes,this.props.binOptions)});const t=Z2t({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:t,type:"float32",size:this.dimensions}}for(let t=0;t<this.channelCount;t++)if(this.needsUpdate===!0||this.needsUpdate[t]){const i=this.props.customOperations[t]||ixt[this.props.operations[t]],{value:n,domain:r}=nxt({bins:this.bins,getValue:D5(this.props.getValue[t],this.props.attributes,void 0),operation:i,target:this.results[t]?.value});this.results[t]={value:n,domain:r,type:"float32",size:1},this.props.onUpdate?.({channel:t})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(t){return this.results[t]}getResultDomain(t){return this.results[t]?.domain??[1/0,-1/0]}getBin(t){const i=this.bins[t];if(!i)return null;const n=new Array(this.channelCount);for(let r=0;r<n.length;r++){const s=this.results[r];n[r]=s?.value[t]}return{id:i.id,value:n,count:i.points.length,pointIndices:i.points}}}function O5(e,t,i){return e.createFramebuffer({width:t,height:i,colorAttachments:[e.createTexture({width:t,height:i,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const oxt=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,sxt={name:"binSorter",vs:oxt,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},L5=[1,2,4,8],F5=3e38,axt={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Nv=1024;class cxt{constructor(t,i){this.binsFBO=null,this.device=t,this.model=uxt(t,i)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(t){if(!this.binsFBO)return null;const i=t%Nv,n=Math.floor(t/Nv),r=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:i,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(r)}setDimensions(t,i){const n=Nv,r=Math.ceil(t/n);this.binsFBO?this.binsFBO.height<r&&this.binsFBO.resize({width:n,height:r}):this.binsFBO=O5(this.device,n,r);const s={binIdRange:[i[0][0],i[0][1],i[1]?.[0]||0,i[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:s})}setModelProps(t){const i=this.model;t.attributes&&i.setAttributes(t.attributes),t.constantAttributes&&i.setConstantAttributes(t.constantAttributes),t.vertexCount!==void 0&&i.setVertexCount(t.vertexCount),t.shaderModuleProps&&i.shaderInputs.setProps(t.shaderModuleProps)}update(t){if(!this.binsFBO)return;const i=lxt(t);this._updateBins("SUM",i.SUM+i.MEAN),this._updateBins("MIN",i.MIN),this._updateBins("MAX",i.MAX)}_updateBins(t,i){if(i===0)return;i|=L5[3];const n=this.model,r=this.binsFBO,s=t==="MAX"?-F5:t==="MIN"?F5:0,o=this.device.beginRenderPass({id:`gpu-aggregation-${t}`,framebuffer:r,parameters:{viewport:[0,0,r.width,r.height],colorMask:i},clearColor:[s,s,s,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:t==="MAX"?"max":t==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(o),o.end()}}function lxt(e){const t={...axt};for(let i=0;i<e.length;i++){const n=e[i];n&&(t[n]+=L5[i])}return t}function uxt(e,t){let i=t.vs;t.dimensions===2&&(i+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${i}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,r=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Lr(e,{bufferLayout:t.bufferLayout,modules:[...t.modules||[],sxt],defines:{...t.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:t.channelCount},isInstanced:!1,vs:n,fs:r,topology:"point-list",disableWarnings:!0})}const hxt=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,fxt={name:"aggregatorTransform",vs:hxt,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class dxt{constructor(t,i){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=t,this.channelCount=i.channelCount,this.transform=pxt(t,i),this.domainFBO=O5(t,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const t=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,i=new Float32Array(t);this._domains=[[-i[4],i[0]],[-i[5],i[1]],[-i[6],i[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(t,i){const{model:n,transformFeedback:r}=this.transform;n.setVertexCount(t);const s={binIdRange:[i[0][0],i[0][1],i[1]?.[0]||0,i[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:s});const o=t*i.length*4;(!this.binBuffer||this.binBuffer.byteLength<o)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:o}),r.setBuffer("binIds",this.binBuffer));const c=t*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<c)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:c}),r.setBuffer("values",this.valueBuffer))}update(t,i){if(!t)return;const n=this.transform,r=this.domainFBO,s=[0,1,2].map(h=>i[h]==="COUNT"?1:0),o=[0,1,2].map(h=>i[h]==="MEAN"?1:0),c={isCount:s,isMean:o,bins:t};n.model.shaderInputs.setProps({aggregatorTransform:c}),n.run({id:"gpu-aggregation-domain",framebuffer:r,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function pxt(e,t){const i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Mf(e,{vs:i,fs:n,topology:"point-list",modules:[fxt],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:t.dimensions,NUM_CHANNELS:t.channelCount,SAMPLER_WIDTH:Nv},varyings:["binIds","values"],disableWarnings:!0})}class ja{static isSupported(t){return t.features.has("float32-renderable-webgl")&&t.features.has("texture-blend-float-webgl")}constructor(t,i){this.binCount=0,this.binIds=null,this.results=[],this.device=t,this.dimensions=i.dimensions,this.channelCount=i.channelCount,this.props={...i,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new cxt(t,i),this.aggregationTransform=new dxt(t,i),this.setProps(i)}getBins(){const t=this.aggregationTransform.binBuffer;return t?(this.binIds?.buffer!==t&&(this.binIds={buffer:t,type:"float32",size:this.dimensions}),this.binIds):null}getResult(t){const i=this.aggregationTransform.valueBuffer;return!i||t>=this.channelCount?null:(this.results[t]?.buffer!==i&&(this.results[t]={buffer:i,type:"float32",size:1,stride:this.channelCount*4,offset:t*4}),this.results[t])}getResultDomain(t){return this.aggregationTransform.domains[t]}getBin(t){if(t<0||t>=this.binCount)return null;const{binIdRange:i}=this.props;let n;if(this.dimensions===1)n=[t+i[0][0]];else{const[[c,h],[A]]=i,_=h-c;n=[t%_+c,Math.floor(t/_)+A]}const r=this.binSorter.getBinValues(t);if(!r)return null;const s=r[3],o=[];for(let c=0;c<this.channelCount;c++){const h=this.props.operations[c];h==="COUNT"?o[c]=s:s===0?o[c]=NaN:o[c]=h==="MEAN"?r[c]/s:r[c]}return{id:n,value:o,count:s}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(t){const i=this.props;if("binIdRange"in t&&!Yr(t.binIdRange,i.binIdRange,2)){const n=t.binIdRange;if(Zi.assert(n.length===this.dimensions),this.dimensions===1){const[[r,s]]=n;this.binCount=s-r}else{const[[r,s],[o,c]]=n;this.binCount=(s-r)*(c-o)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==i.operations[n]&&this.setNeedsUpdate(n);if(t.pointCount!==void 0&&t.pointCount!==i.pointCount&&(this.binSorter.setModelProps({vertexCount:t.pointCount}),this.setNeedsUpdate()),t.binOptions&&(Yr(t.binOptions,i.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:t.binOptions})),t.attributes){const n={},r={};for(const s of Object.values(t.attributes))for(const[o,c]of Object.entries(s.getValue()))ArrayBuffer.isView(c)?r[o]=c:c&&(n[o]=c);this.binSorter.setModelProps({attributes:n,constantAttributes:r})}t.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:t.shaderModuleProps}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate.fill(!0):this.needsUpdate[t]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;const{operations:t}=this.props,i=this.needsUpdate.map((n,r)=>n?t[r]:null);this.binSorter.update(i),this.aggregationTransform.update(this.binSorter.texture,t);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}}let Gp=class extends To{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){super.updateState(e);const t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){this.state.aggregator?.destroy();const i=this.createAggregator(t);return i.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:i,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const i in e)this.onAttributeChange(i);t.update()}draw({shaderModuleProps:e}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new U0(this.context.device,{id:this.props.id,stats:this.context.stats})}};Gp.layerName="AggregationLayer";const Uv=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function k5(e,t=!1,i=Float32Array){let n;if(Number.isFinite(e[0]))n=new i(e);else{n=new i(e.length*4);let r=0;for(let s=0;s<e.length;s++){const o=e[s];n[r++]=o[0],n[r++]=o[1],n[r++]=o[2],n[r++]=Number.isFinite(o[3])?o[3]:255}}if(t)for(let r=0;r<n.length;r++)n[r]/=255;return n}const zv={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function zC(e,t){e.setSampler({minFilter:zv[t],magFilter:zv[t]})}function GC(e,t,i="linear"){const n=k5(t,!1,Uint8Array);return e.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:zv[i],magFilter:zv[i],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}const Axt=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`,gxt=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,mxt=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,yxt={name:"screenGrid",vs:mxt,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class N5 extends Bo{getShaders(){return super.getShaders({vs:Axt,fs:gxt,modules:[ua,yxt]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(t){super.updateState(t);const{props:i,oldProps:n,changeFlags:r}=t,s=this.state.model;if(n.colorRange!==i.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=GC(this.context.device,i.colorRange,i.colorScaleType);const o={colorRange:this.state.colorTexture};s.shaderInputs.setProps({screenGrid:o})}else n.colorScaleType!==i.colorScaleType&&zC(this.state.colorTexture,i.colorScaleType);if(n.cellMarginPixels!==i.cellMarginPixels||n.cellSizePixels!==i.cellSizePixels||r.viewportChanged){const{width:o,height:c}=this.context.viewport,{cellSizePixels:h,cellMarginPixels:A}=this.props,_=Math.max(h-A,0),C={gridSizeClipspace:[h/o*2,h/c*2],cellSizeClipspace:[_/o*2,_/c*2]};s.shaderInputs.setProps({screenGrid:C})}}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){const i=this.props.colorDomain(),n=this.state.model,r={colorDomain:i};n.shaderInputs.setProps({screenGrid:r}),n.draw(this.context.renderPass)}_getModel(){return new Lr(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Yo({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}N5.layerName="ScreenGridCellLayer";const vxt=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,_xt={name:"binOptions",vs:vxt,uniformTypes:{cellSizePixels:"f32"}},bxt={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:Uv,colorScaleType:"linear",getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class jC extends Gp{getAggregatorType(){return this.props.gpuAggregation&&ja.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"||!ja.isSupported(this.context.device)?new zp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:i},n,r)=>{const s=this.context.viewport,o=s.project(i),c=r.cellSizePixels;return o[0]<0||o[0]>=s.width||o[1]<0||o[1]>=s.height?null:[Math.floor(o[0]/c),Math.floor(o[1]/c)]}},getValue:[{sources:["counts"],getValue:({counts:i})=>i}]}):new ja(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fo,_xt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){const i=super.updateState(t),{props:n,oldProps:r,changeFlags:s}=t,{cellSizePixels:o,aggregation:c}=n;if(i||s.dataChanged||s.updateTriggersChanged||s.viewportChanged||c!==r.aggregation||o!==r.cellSizePixels){const{width:h,height:A}=this.context.viewport,{aggregator:_}=this.state;_ instanceof ja&&_.setProps({binIdRange:[[0,Math.ceil(h/o)],[0,Math.ceil(A/o)]]}),_.setProps({pointCount:this.getNumInstances(),operations:[c],binOptions:{cellSizePixels:o}})}return s.viewportChanged&&this.state.aggregator.setNeedsUpdate(),i}onAttributeChange(t){const{aggregator:i}=this.state;switch(t){case"positions":i.setNeedsUpdate();break;case"counts":i.setNeedsUpdate(0);break}}renderLayers(){const{aggregator:t}=this.state,i=this.getSubLayerClass("cells",N5),n=t.getBins(),r=t.getResult(0);return new i(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:t.binCount,attributes:{getBin:n,getWeight:r}},dataComparator:(s,o)=>s.length===o.length,updateTriggers:{getBin:[n],getWeight:[r]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||t.getResultDomain(0),extensions:[]})}getPickingInfo(t){const i=t.info,{index:n}=i;if(n>=0){const r=this.state.aggregator.getBin(n);let s;r&&(s={col:r.id[0],row:r.id[1],value:r.value[0],count:r.count},r.pointIndices&&(s.pointIndices=r.pointIndices,s.points=Array.isArray(this.props.data)?r.pointIndices.map(o=>this.props.data[o]):[])),i.object=s}return i}}jC.layerName="ScreenGridLayer",jC.defaultProps=bxt;class Gv{constructor(t,i){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=t,this.inputLength=i,this.attribute=t}getScalePercentile(){if(!this._percentile){const t=U5(this.input,this.inputLength);this._percentile=wxt(t)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const t=U5(this.input,this.inputLength);this._ordinal=xxt(t)}return this._ordinal}getCutoff({scaleType:t,lowerPercentile:i,upperPercentile:n}){if(t==="quantile")return[i,n-1];if(i>0||n<100){const{domain:r}=this.getScalePercentile();let s=r[Math.floor(i)-1]??-1/0,o=r[Math.floor(n)-1]??1/0;if(t==="ordinal"){const{domain:c}=this.getScaleOrdinal();s=c.findIndex(h=>h>=s),o=c.findIndex(h=>h>o)-1,o===-2&&(o=c.length-1)}return[s,o]}return null}update(t){const i=this.props;if(t.scaleType!==i.scaleType)switch(t.scaleType){case"quantile":{const{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{const{attribute:n,domain:r}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,r.length-1];break}default:this.attribute=this.input,this.domain=null}return(t.scaleType!==i.scaleType||t.lowerPercentile!==i.lowerPercentile||t.upperPercentile!==i.upperPercentile)&&(this.cutoff=this.getCutoff(t)),this.props=t,this}}function xxt(e){const t=new Set;for(const r of e)Number.isFinite(r)&&t.add(r);const i=Array.from(t).sort(),n=new Map;for(let r=0;r<i.length;r++)n.set(i[r],r);return{attribute:{value:e.map(r=>Number.isFinite(r)?n.get(r):NaN),type:"float32",size:1},domain:i}}function wxt(e,t=100){const i=Array.from(e).filter(Number.isFinite).sort(Cxt);let n=0;const r=Math.max(1,t),s=new Array(r-1);for(;++n<r;)s[n-1]=Ext(i,n/r);return{attribute:{value:e.map(o=>Number.isFinite(o)?Bxt(s,o):NaN),type:"float32",size:1},domain:s}}function U5(e,t){const i=(e.stride??4)/4,n=(e.offset??0)/4;let r=e.value;if(!r){const o=e.buffer?.readSyncWebGL(0,i*4*t);o&&(r=new Float32Array(o.buffer),e.value=r)}if(i===1)return r.subarray(0,t);const s=new Float32Array(t);for(let o=0;o<t;o++)s[o]=r[o*i+n];return s}function Cxt(e,t){return e-t}function Ext(e,t){const i=e.length;if(t<=0||i<2)return e[0];if(t>=1)return e[i-1];const n=(i-1)*t,r=Math.floor(n),s=e[r],o=e[r+1];return s+(o-s)*(n-r)}function Bxt(e,t){let i=0,n=e.length;for(;i<n;){const r=i+n>>>1;e[r]>t?n=r:i=r+1}return i}function VC({dataBounds:e,getBinId:t,padding:i=0}){const n=[e[0],e[1],[e[0][0],e[1][1]],[e[1][0],e[0][1]]].map(h=>t(h)),r=Math.min(...n.map(h=>h[0]))-i,s=Math.min(...n.map(h=>h[1]))-i,o=Math.max(...n.map(h=>h[0]))+i+1,c=Math.max(...n.map(h=>h[1]))+i+1;return[[r,o],[s,c]]}const z5=Math.PI/3,jv=2*Math.sin(z5),Vv=1.5,Txt=Array.from({length:6},(e,t)=>{const i=t*z5;return[Math.sin(i),-Math.cos(i)]});function HC([e,t],i){let n=Math.round(t=t/i/Vv),r=Math.round(e=e/i/jv-(n&1)/2);const s=t-n;if(Math.abs(s)*3>1){const o=e-r,c=r+(e<r?-1:1)/2,h=n+(t<n?-1:1),A=e-c,_=t-h;o*o+s*s>A*A+_*_&&(r=c+(n&1?1:-1)/2,n=h)}return[r,n]}const Sxt=`
const vec2 DIST = vec2(${jv}, ${Vv});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function G5([e,t],i){return[(e+(t&1)/2)*i*jv,t*i*Vv]}const Ixt=`
const vec2 DIST = vec2(${jv}, ${Vv});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,Mxt=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${Ixt}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Pxt=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,Rxt={name:"hexagon",vs:Pxt,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class j5 extends hl{getShaders(){const t=super.getShaders();return t.modules.push(Rxt),{...t,vs:Mxt}}initializeState(){super.initializeState();const t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t,r=this.state.fillModel;if(n.colorRange!==i.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=GC(this.context.device,i.colorRange,i.colorScaleType);const s={colorRange:this.state.colorTexture};r.shaderInputs.setProps({hexagon:s})}else n.colorScaleType!==i.colorScaleType&&zC(this.state.colorTexture,i.colorScaleType)}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){const{radius:i,hexOriginCommon:n,elevationRange:r,elevationScale:s,extruded:o,coverage:c,colorDomain:h,elevationDomain:A}=this.props,_=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel;S.vertexArray.indexBuffer&&S.setIndexBuffer(null),S.setVertexCount(this.state.fillVertexCount);const L={colorDomain:[Math.max(h[0],_[0]),Math.min(h[1],_[1]),Math.max(h[0]-1,_[0]),Math.min(h[1]+1,_[1])],elevationDomain:[Math.max(A[0],C[0]),Math.min(A[1],C[1]),Math.max(A[0]-1,C[0]),Math.min(A[1]+1,C[1])],elevationRange:[r[0]*s,r[1]*s],originCommon:n};S.shaderInputs.setProps({column:{extruded:o,coverage:c,radius:i},hexagon:L}),S.draw(this.context.renderPass)}}j5.layerName="HexagonCellLayer";const Dxt=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,Oxt={name:"binOptions",vs:Dxt,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function V5(){}const Lxt={gpuAggregation:!0,colorDomain:null,colorRange:Uv,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:V5,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:V5,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class WC extends Gp{getAggregatorType(){const{gpuAggregation:t,hexagonAggregator:i,getColorValue:n,getElevationValue:r}=this.props;return t&&(i||n||r)?(Zi.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&ja.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){const{hexagonAggregator:i,radius:n}=this.props;return new zp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},s,o)=>{if(i)return i(r,n);const c=this.state.aggregatorViewport.projectPosition(r),{radiusCommon:h,hexOriginCommon:A}=o;return HC([c[0]-A[0],c[1]-A[1]],h)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:r})=>r},{sources:["elevationWeights"],getValue:({elevationWeights:r})=>r}]})}return new ja(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fo,Oxt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${Sxt}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){const i=super.updateState(t),{props:n,oldProps:r,changeFlags:s}=t,{aggregator:o}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(sl(n.data).iterable)),i||s.dataChanged||n.radius!==r.radius||n.getColorValue!==r.getColorValue||n.getElevationValue!==r.getElevationValue||n.colorAggregation!==r.colorAggregation||n.elevationAggregation!==r.elevationAggregation){this._updateBinOptions();const{radiusCommon:c,hexOriginCommon:h,binIdRange:A,dataAsArray:_}=this.state;if(o.setProps({binIdRange:A,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:c,hexOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),_){const{getColorValue:C,getElevationValue:S}=this.props;o.setProps({customOperations:[C&&(L=>C(L.map(N=>_[N]),{indices:L,data:n.data})),S&&(L=>S(L.map(N=>_[N]),{indices:L,data:n.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),i}_updateBinOptions(){const t=this.getBounds();let i=1,n=[0,0],r=[[0,1],[0,1]],s=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2];const{radius:c}=this.props,{unitsPerMeter:h}=s.getDistanceScales(o);i=h[0]*c;const A=HC(s.projectFlat(o),i);o=s.unprojectFlat(G5(A,i));const _=s.constructor;s=s.isGeospatial?new _({longitude:o[0],latitude:o[1],zoom:12}):new au({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(s.center[0]),Math.fround(s.center[1])],r=VC({dataBounds:t,getBinId:C=>{const S=s.projectFlat(C);return S[0]-=n[0],S[1]-=n[1],HC(S,i)},padding:1})}this.setState({radiusCommon:i,hexOriginCommon:n,binIdRange:r,aggregatorViewport:s})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){const i=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){const r=n.getResult(0);this.setState({colors:new Gv(r,n.binCount)}),i.onSetColorDomain(n.getResultDomain(0))}else if(t===1){const r=n.getResult(1);this.setState({elevations:new Gv(r,n.binCount)}),i.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){const{aggregator:i}=this.state;switch(t){case"positions":i.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:n,hexOriginCommon:r,binIdRange:s}=this.state;i.setProps({binIdRange:s,binOptions:{radiusCommon:n,hexOriginCommon:r}});break;case"colorWeights":i.setNeedsUpdate(0);break;case"elevationWeights":i.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:t,radiusCommon:i,hexOriginCommon:n}=this.state,{elevationScale:r,colorRange:s,elevationRange:o,extruded:c,coverage:h,material:A,transitions:_,colorScaleType:C,lowerPercentile:S,upperPercentile:L,colorDomain:N,elevationScaleType:U,elevationLowerPercentile:H,elevationUpperPercentile:j,elevationDomain:tt}=this.props,K=this.getSubLayerClass("cells",j5),Q=t.getBins(),pt=this.state.colors?.update({scaleType:C,lowerPercentile:S,upperPercentile:L}),$=this.state.elevations?.update({scaleType:U,lowerPercentile:H,upperPercentile:j});return!pt||!$?null:new K(this.getSubLayerProps({id:"cells"}),{data:{length:t.binCount,attributes:{getBin:Q,getColorValue:pt.attribute,getElevationValue:$.attribute}},dataComparator:(zt,Gt)=>zt.length===Gt.length,updateTriggers:{getBin:[Q],getColorValue:[pt.attribute],getElevationValue:[$.attribute]},diskResolution:6,vertices:Txt,radius:i,hexOriginCommon:n,elevationScale:r,colorRange:s,colorScaleType:C,elevationRange:o,extruded:c,coverage:h,material:A,colorDomain:pt.domain||N||t.getResultDomain(0),elevationDomain:$.domain||tt||t.getResultDomain(1),colorCutoff:pt.cutoff,elevationCutoff:$.cutoff,transitions:_&&{getFillColor:_.getColorValue||_.getColorWeight,getElevation:_.getElevationValue||_.getElevationWeight},extensions:[]})}getPickingInfo(t){const i=t.info,{index:n}=i;if(n>=0){const r=this.state.aggregator.getBin(n);let s;if(r){const o=G5(r.id,this.state.radiusCommon),c=this.context.viewport.unprojectFlat(o);s={col:r.id[0],row:r.id[1],position:c,colorValue:r.value[0],elevationValue:r.value[1],count:r.count},r.pointIndices&&(s.pointIndices=r.pointIndices,s.points=Array.isArray(this.props.data)?r.pointIndices.map(h=>this.props.data[h]):[])}i.object=s}return i}}WC.layerName="HexagonLayer",WC.defaultProps=Lxt;const ci=.5,wi=1/6,_e={N:[0,ci],E:[ci,0],S:[0,-ci],W:[-ci,0],NE:[ci,ci],NW:[-ci,ci],SE:[ci,-ci],SW:[-ci,-ci]},jp=[_e.W,_e.SW,_e.S],Vp=[_e.S,_e.SE,_e.E],Hp=[_e.E,_e.NE,_e.N],Wp=[_e.NW,_e.W,_e.N],Jp=[[-ci,wi],[-ci,-wi],[-wi,-ci],[wi,-ci]],Xp=[[-wi,-ci],[wi,-ci],[ci,-wi],[ci,wi]],Qp=[[ci,-wi],[ci,wi],[wi,ci],[-wi,ci]],Kp=[[-ci,wi],[-ci,-wi],[wi,ci],[-wi,ci]],H5=[_e.W,_e.SW,_e.SE,_e.E],W5=[_e.S,_e.SE,_e.NE,_e.N],J5=[_e.NW,_e.W,_e.E,_e.NE],X5=[_e.NW,_e.SW,_e.S,_e.N],Q5=[[-ci,wi],[-ci,-wi],[ci,-wi],[ci,wi]],K5=[[-wi,-ci],[wi,-ci],[wi,ci],[-wi,ci]],Fxt=[_e.NW,_e.SW,_e.SE,_e.NE],q5=[_e.NW,_e.SW,_e.SE,_e.E,_e.N],Z5=[_e.W,_e.SW,_e.SE,_e.NE,_e.N],Y5=[_e.NW,_e.W,_e.S,_e.SE,_e.NE],$5=[_e.NW,_e.SW,_e.S,_e.E,_e.NE],tk=[_e.NW,_e.W,[ci,-wi],[ci,wi],_e.N],ek=[[-wi,-ci],[wi,-ci],_e.E,_e.NE,_e.N],ik=[[-ci,wi],[-ci,-wi],_e.S,_e.SE,_e.E],nk=[_e.W,_e.SW,_e.S,[wi,ci],[-wi,ci]],rk=[_e.NW,_e.W,[-wi,-ci],[wi,-ci],_e.N],ok=[[-ci,wi],[-ci,-wi],_e.E,_e.NE,_e.N],sk=[_e.S,_e.SE,_e.E,[wi,ci],[-wi,ci]],ak=[_e.W,_e.SW,_e.S,[ci,-wi],[ci,wi]],ck=[_e.W,_e.SW,_e.SE,_e.E,[wi,ci],[-wi,ci]],lk=[[-ci,wi],[-ci,-wi],_e.S,_e.SE,_e.NE,_e.N],uk=[_e.NW,_e.W,[-wi,-ci],[wi,-ci],_e.E,_e.NE],hk=[_e.NW,_e.SW,_e.S,[ci,-wi],[ci,wi],_e.N],qp=[_e.W,_e.SW,_e.S,_e.E,_e.NE,_e.N],Zp=[_e.NW,_e.W,_e.S,_e.SE,_e.E,_e.N],Hv=[[-ci,wi],[-ci,-wi],[-wi,-ci],[wi,-ci],_e.E,_e.NE,_e.N],Wv=[_e.W,_e.SW,_e.S,[ci,-wi],[ci,wi],[wi,ci],[-wi,ci]],Jv=[_e.NW,_e.W,[-wi,-ci],[wi,-ci],[ci,-wi],[ci,wi],_e.N],Xv=[[-ci,wi],[-ci,-wi],_e.S,_e.SE,_e.E,[wi,ci],[-wi,ci]],fk=[[-ci,wi],[-ci,-wi],[-wi,-ci],[wi,-ci],[ci,-wi],[ci,wi],[wi,ci],[-wi,ci]],kxt={0:[],1:[[_e.W,_e.S]],2:[[_e.S,_e.E]],3:[[_e.W,_e.E]],4:[[_e.N,_e.E]],5:{0:[[_e.W,_e.S],[_e.N,_e.E]],1:[[_e.W,_e.N],[_e.S,_e.E]]},6:[[_e.N,_e.S]],7:[[_e.W,_e.N]],8:[[_e.W,_e.N]],9:[[_e.N,_e.S]],10:{0:[[_e.W,_e.N],[_e.S,_e.E]],1:[[_e.W,_e.S],[_e.N,_e.E]]},11:[[_e.N,_e.E]],12:[[_e.W,_e.E]],13:[[_e.S,_e.E]],14:[[_e.W,_e.S]],15:[]};function hi(e){return parseInt(e,4)}const Nxt={[hi("0000")]:[],[hi("2222")]:[],[hi("2221")]:[jp],[hi("2212")]:[Vp],[hi("2122")]:[Hp],[hi("1222")]:[Wp],[hi("0001")]:[jp],[hi("0010")]:[Vp],[hi("0100")]:[Hp],[hi("1000")]:[Wp],[hi("2220")]:[Jp],[hi("2202")]:[Xp],[hi("2022")]:[Qp],[hi("0222")]:[Kp],[hi("0002")]:[Jp],[hi("0020")]:[Xp],[hi("0200")]:[Qp],[hi("2000")]:[Kp],[hi("0011")]:[H5],[hi("0110")]:[W5],[hi("1100")]:[J5],[hi("1001")]:[X5],[hi("2211")]:[H5],[hi("2112")]:[W5],[hi("1122")]:[J5],[hi("1221")]:[X5],[hi("2200")]:[Q5],[hi("2002")]:[K5],[hi("0022")]:[Q5],[hi("0220")]:[K5],[hi("1111")]:[Fxt],[hi("1211")]:[q5],[hi("2111")]:[Z5],[hi("1112")]:[Y5],[hi("1121")]:[$5],[hi("1011")]:[q5],[hi("0111")]:[Z5],[hi("1110")]:[Y5],[hi("1101")]:[$5],[hi("1200")]:[tk],[hi("0120")]:[ek],[hi("0012")]:[ik],[hi("2001")]:[nk],[hi("1022")]:[tk],[hi("2102")]:[ek],[hi("2210")]:[ik],[hi("0221")]:[nk],[hi("1002")]:[rk],[hi("2100")]:[ok],[hi("0210")]:[sk],[hi("0021")]:[ak],[hi("1220")]:[rk],[hi("0122")]:[ok],[hi("2012")]:[sk],[hi("2201")]:[ak],[hi("0211")]:[ck],[hi("2110")]:[lk],[hi("1102")]:[uk],[hi("1021")]:[hk],[hi("2011")]:[ck],[hi("0112")]:[lk],[hi("1120")]:[uk],[hi("1201")]:[hk],[hi("2101")]:[qp],[hi("0121")]:[qp],[hi("1012")]:[Zp],[hi("1210")]:[Zp],[hi("0101")]:{0:[jp,Hp],1:[qp],2:[qp]},[hi("1010")]:{0:[Wp,Vp],1:[Zp],2:[Zp]},[hi("2121")]:{0:[qp],1:[qp],2:[jp,Hp]},[hi("1212")]:{0:[Zp],1:[Zp],2:[Wp,Vp]},[hi("2120")]:{0:[Hv],1:[Hv],2:[Jp,Hp]},[hi("2021")]:{0:[Wv],1:[Wv],2:[jp,Qp]},[hi("1202")]:{0:[Jv],1:[Jv],2:[Wp,Xp]},[hi("0212")]:{0:[Xv],1:[Xv],2:[Vp,Kp]},[hi("0102")]:{0:[Jp,Hp],1:[Hv],2:[Hv]},[hi("0201")]:{0:[jp,Qp],1:[Wv],2:[Wv]},[hi("1020")]:{0:[Wp,Xp],1:[Jv],2:[Jv]},[hi("2010")]:{0:[Vp,Kp],1:[Xv],2:[Xv]},[hi("2020")]:{0:[Kp,Xp],1:[fk],2:[Jp,Qp]},[hi("0202")]:{0:[Qp,Jp],1:[fk],2:[Kp,Xp]}};function Yg(e,t){return Number.isNaN(e)?0:Array.isArray(t)?e<t[0]?0:e<t[1]?1:2:e>=t?1:0}function Uxt(e){const{x:t,y:i,xRange:n,yRange:r,getValue:s,threshold:o}=e,c=t<n[0],h=t>=n[1]-1,A=i<r[0],_=i>=r[1]-1,C=c||h||A||_;let S=0,L,N,U,H;if(c||_)U=0;else{const K=s(t,i+1);U=Yg(K,o),S+=K}if(h||_)H=0;else{const K=s(t+1,i+1);H=Yg(K,o),S+=K}if(h||A)N=0;else{const K=s(t+1,i);N=Yg(K,o),S+=K}if(c||A)L=0;else{const K=s(t,i);L=Yg(K,o),S+=K}let j=-1;Number.isFinite(o)&&(j=U<<3|H<<2|N<<1|L),Array.isArray(o)&&(j=U<<6|H<<4|N<<2|L);let tt=0;return C||(tt=Yg(S/4,o)),{code:j,meanCode:tt}}function zxt(e){const{x:t,y:i,z:n,code:r,meanCode:s}=e;let o=Nxt[r];Array.isArray(o)||(o=o[s]);const c=t+1,h=i+1,A=[];return o.forEach(_=>{const C=[];_.forEach(S=>{const L=c+S[0],N=h+S[1];C.push([L,N,n])}),A.push(C)}),A}function Gxt(e){const{x:t,y:i,z:n,code:r,meanCode:s}=e;let o=kxt[r];Array.isArray(o)||(o=o[s]);const c=t+1,h=i+1,A=[];return o.forEach(_=>{_.forEach(C=>{const S=c+C[0],L=h+C[1];A.push([S,L,n])})}),A}function jxt({contours:e,getValue:t,xRange:i,yRange:n}){const r=[],s=[];let o=0,c=0;for(let h=0;h<e.length;h++){const A=e[h],_=A.zIndex??h,{threshold:C}=A;for(let S=i[0]-1;S<i[1];S++)for(let L=n[0]-1;L<n[1];L++){const{code:N,meanCode:U}=Uxt({getValue:t,threshold:C,x:S,y:L,xRange:i,yRange:n}),H={x:S,y:L,z:_,code:N,meanCode:U};if(Array.isArray(C)){const j=zxt(H);for(const tt of j)s[c++]={vertices:tt,contour:A}}else{const j=Gxt(H);j.length>0&&(r[o++]={vertices:j,contour:A})}}}return{lines:r,polygons:s}}function Vxt(e){const{aggregator:t,binIdRange:i,channel:n}=e;if(t instanceof ja){const r=t.getResult(n)?.buffer;if(r){const s=new Float32Array(r.readSyncWebGL().buffer);return Hxt(s,i)}}if(t instanceof zp){const r=t.getResult(n)?.value,s=t.getBins()?.value;if(s&&r)return Wxt(r,s,t.binCount)}return null}function Hxt(e,t){const[[i,n],[r,s]]=t,o=n-i,c=s-r;return(h,A)=>(h-=i,A-=r,h<0||h>=o||A<0||A>=c?NaN:e[A*o+h])}function Wxt(e,t,i){const n={};for(let r=0;r<i;r++){const s=t[r*2],o=t[r*2+1];n[s]=n[s]||{},n[s][o]=e[r]}return(r,s)=>n[r]?.[s]??NaN}const Jxt=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,Xxt={name:"binOptions",vs:Jxt,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}},dk=[255,255,255,255],Qxt=1,Kxt={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005};let JC=class extends Gp{getAggregatorType(){return this.props.gpuAggregation&&ja.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new zp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:t},i,n)=>{const r=this.state.aggregatorViewport.projectPosition(t),{cellSizeCommon:s,cellOriginCommon:o}=n;return[Math.floor((r[0]-o[0])/s[0]),Math.floor((r[1]-o[1])/s[1])]}},getValue:[{sources:["counts"],getValue:({counts:t})=>t}],onUpdate:this._onAggregationUpdate.bind(this)}):new ja(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fo,Xxt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){const t=super.updateState(e),{props:i,oldProps:n,changeFlags:r}=e,{aggregator:s}=this.state;if(t||r.dataChanged||i.cellSize!==n.cellSize||!Yr(i.gridOrigin,n.gridOrigin,1)||i.aggregation!==n.aggregation){this._updateBinOptions();const{cellSizeCommon:o,cellOriginCommon:c,binIdRange:h}=this.state;s.setProps({binIdRange:h,pointCount:this.getNumInstances(),operations:[i.aggregation],binOptions:{cellSizeCommon:o,cellOriginCommon:c}})}return Yr(n.contours,i.contours,2)||this.setState({contourData:null}),t}_updateBinOptions(){const e=this.getBounds(),t=[1,1];let i=[0,0],n=[[0,1],[0,1]],r=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let s=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{cellSize:o,gridOrigin:c}=this.props,{unitsPerMeter:h}=r.getDistanceScales(s);t[0]=h[0]*o,t[1]=h[1]*o;const A=r.projectFlat(s);i=[Math.floor((A[0]-c[0])/t[0])*t[0]+c[0],Math.floor((A[1]-c[1])/t[1])*t[1]+c[1]],s=r.unprojectFlat(i);const _=r.constructor;r=r.isGeospatial?new _({longitude:s[0],latitude:s[1],zoom:12}):new au({position:[s[0],s[1],0],zoom:12}),i=[Math.fround(r.center[0]),Math.fround(r.center[1])],n=VC({dataBounds:e,getBinId:C=>{const S=r.projectFlat(C);return[Math.floor((S[0]-i[0])/t[0]),Math.floor((S[1]-i[1])/t[1])]}})}this.setState({cellSizeCommon:t,cellOriginCommon:i,binIdRange:n,aggregatorViewport:r})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){const{aggregator:e,binIdRange:t}=this.state;this.setState({aggregatedValueReader:Vxt({aggregator:e,binIdRange:t,channel:0}),contourData:null})}_getContours(){const{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){const{binIdRange:t}=this.state,{contours:i}=this.props,n=jxt({contours:i,getValue:e,xRange:t[0],yRange:t[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:i,cellOriginCommon:n,binIdRange:r}=this.state;t.setProps({binIdRange:r,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"counts":t.setNeedsUpdate(0);break}}renderLayers(){const e=this._getContours();if(!e)return null;const{lines:t,polygons:i}=e,{zOffset:n}=this.props,{cellOriginCommon:r,cellSizeCommon:s}=this.state,o=this.getSubLayerClass("lines",ih),c=this.getSubLayerClass("bands",rh),h=new yn().translate([r[0],r[1],0]).scale([s[0],s[1],n]),A=t&&t.length>0&&new o(this.getSubLayerProps({id:"lines"}),{data:t,coordinateSystem:$i.CARTESIAN,modelMatrix:h,getPath:C=>C.vertices,getColor:C=>C.contour.color??dk,getWidth:C=>C.contour.strokeWidth??Qxt,widthUnits:"pixels"}),_=i&&i.length>0&&new c(this.getSubLayerProps({id:"bands"}),{data:i,coordinateSystem:$i.CARTESIAN,modelMatrix:h,getPolygon:C=>C.vertices,getFillColor:C=>C.contour.color??dk});return[A,_]}getPickingInfo(e){const t=e.info,{object:i}=t;return i&&(t.object={contour:i.contour}),t}};JC.layerName="ContourLayer",JC.defaultProps=Kxt;const qxt=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Zxt=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,Yxt={name:"grid",vs:Zxt,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};class pk extends hl{getShaders(){const t=super.getShaders();return t.modules.push(Yxt),{...t,vs:qxt}}initializeState(){super.initializeState();const t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){super.updateState(t);const{props:i,oldProps:n}=t,r=this.state.fillModel;if(n.colorRange!==i.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=GC(this.context.device,i.colorRange,i.colorScaleType);const s={colorRange:this.state.colorTexture};r.shaderInputs.setProps({grid:s})}else n.colorScaleType!==i.colorScaleType&&zC(this.state.colorTexture,i.colorScaleType)}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}_updateGeometry(){const t=new SM;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){const{cellOriginCommon:i,cellSizeCommon:n,elevationRange:r,elevationScale:s,extruded:o,coverage:c,colorDomain:h,elevationDomain:A}=this.props,_=this.props.colorCutoff||[-1/0,1/0],C=this.props.elevationCutoff||[-1/0,1/0],S=this.state.fillModel,L={colorDomain:[Math.max(h[0],_[0]),Math.min(h[1],_[1]),Math.max(h[0]-1,_[0]),Math.min(h[1]+1,_[1])],elevationDomain:[Math.max(A[0],C[0]),Math.min(A[1],C[1]),Math.max(A[0]-1,C[0]),Math.min(A[1]+1,C[1])],elevationRange:[r[0]*s,r[1]*s],originCommon:i,sizeCommon:n};S.shaderInputs.setProps({column:{extruded:o,coverage:c},grid:L}),S.draw(this.context.renderPass)}}pk.layerName="GridCellLayer";const $xt=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,twt={name:"binOptions",vs:$xt,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function Ak(){}const ewt={gpuAggregation:!0,colorDomain:null,colorRange:Uv,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Ak,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:Ak,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class XC extends Gp{getAggregatorType(){const{gpuAggregation:t,gridAggregator:i,getColorValue:n,getElevationValue:r}=this.props;return t&&(i||n||r)?(Zi.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&ja.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){const{gridAggregator:i,cellSize:n}=this.props;return new zp({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},s,o)=>{if(i)return i(r,n);const c=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:h,cellOriginCommon:A}=o;return[Math.floor((c[0]-A[0])/h[0]),Math.floor((c[1]-A[1])/h[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:r})=>r},{sources:["elevationWeights"],getValue:({elevationWeights:r})=>r}]})}return new ja(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Fo,twt],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){const i=super.updateState(t),{props:n,oldProps:r,changeFlags:s}=t,{aggregator:o}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(sl(n.data).iterable)),i||s.dataChanged||n.cellSize!==r.cellSize||n.getColorValue!==r.getColorValue||n.getElevationValue!==r.getElevationValue||n.colorAggregation!==r.colorAggregation||n.elevationAggregation!==r.elevationAggregation){this._updateBinOptions();const{cellSizeCommon:c,cellOriginCommon:h,binIdRange:A,dataAsArray:_}=this.state;if(o.setProps({binIdRange:A,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:c,cellOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),_){const{getColorValue:C,getElevationValue:S}=this.props;o.setProps({customOperations:[C&&(L=>C(L.map(N=>_[N]),{indices:L,data:n.data})),S&&(L=>S(L.map(N=>_[N]),{indices:L,data:n.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),i}_updateBinOptions(){const t=this.getBounds(),i=[1,1];let n=[0,0],r=[[0,1],[0,1]],s=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2];const{cellSize:c}=this.props,{unitsPerMeter:h}=s.getDistanceScales(o);i[0]=h[0]*c,i[1]=h[1]*c;const A=s.projectFlat(o);n=[Math.floor(A[0]/i[0])*i[0],Math.floor(A[1]/i[1])*i[1]],o=s.unprojectFlat(n);const _=s.constructor;s=s.isGeospatial?new _({longitude:o[0],latitude:o[1],zoom:12}):new au({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(s.center[0]),Math.fround(s.center[1])],r=VC({dataBounds:t,getBinId:C=>{const S=s.projectFlat(C);return[Math.floor((S[0]-n[0])/i[0]),Math.floor((S[1]-n[1])/i[1])]}})}this.setState({cellSizeCommon:i,cellOriginCommon:n,binIdRange:r,aggregatorViewport:s})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){const i=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){const r=n.getResult(0);this.setState({colors:new Gv(r,n.binCount)}),i.onSetColorDomain(n.getResultDomain(0))}else if(t===1){const r=n.getResult(1);this.setState({elevations:new Gv(r,n.binCount)}),i.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){const{aggregator:i}=this.state;switch(t){case"positions":i.setNeedsUpdate(),this._updateBinOptions();const{cellSizeCommon:n,cellOriginCommon:r,binIdRange:s}=this.state;i.setProps({binIdRange:s,binOptions:{cellSizeCommon:n,cellOriginCommon:r}});break;case"colorWeights":i.setNeedsUpdate(0);break;case"elevationWeights":i.setNeedsUpdate(1);break}}renderLayers(){const{aggregator:t,cellOriginCommon:i,cellSizeCommon:n}=this.state,{elevationScale:r,colorRange:s,elevationRange:o,extruded:c,coverage:h,material:A,transitions:_,colorScaleType:C,lowerPercentile:S,upperPercentile:L,colorDomain:N,elevationScaleType:U,elevationLowerPercentile:H,elevationUpperPercentile:j,elevationDomain:tt}=this.props,K=this.getSubLayerClass("cells",pk),Q=t.getBins(),pt=this.state.colors?.update({scaleType:C,lowerPercentile:S,upperPercentile:L}),$=this.state.elevations?.update({scaleType:U,lowerPercentile:H,upperPercentile:j});return!pt||!$?null:new K(this.getSubLayerProps({id:"cells"}),{data:{length:t.binCount,attributes:{getBin:Q,getColorValue:pt.attribute,getElevationValue:$.attribute}},dataComparator:(zt,Gt)=>zt.length===Gt.length,updateTriggers:{getBin:[Q],getColorValue:[pt.attribute],getElevationValue:[$.attribute]},cellOriginCommon:i,cellSizeCommon:n,elevationScale:r,colorRange:s,colorScaleType:C,elevationRange:o,extruded:c,coverage:h,material:A,colorDomain:pt.domain||N||t.getResultDomain(0),elevationDomain:$.domain||tt||t.getResultDomain(1),colorCutoff:pt.cutoff,elevationCutoff:$.cutoff,transitions:_&&{getFillColor:_.getColorValue||_.getColorWeight,getElevation:_.getElevationValue||_.getElevationWeight},extensions:[]})}getPickingInfo(t){const i=t.info,{index:n}=i;if(n>=0){const r=this.state.aggregator.getBin(n);let s;r&&(s={col:r.id[0],row:r.id[1],colorValue:r.value[0],elevationValue:r.value[1],count:r.count},r.pointIndices&&(s.pointIndices=r.pointIndices,s.points=Array.isArray(this.props.data)?r.pointIndices.map(o=>this.props.data[o]):[])),i.object=s}return i}}XC.layerName="GridLayer",XC.defaultProps=ewt;function iwt(e){const t=e.map(c=>c[0]),i=e.map(c=>c[1]),n=Math.min.apply(null,t),r=Math.max.apply(null,t),s=Math.min.apply(null,i),o=Math.max.apply(null,i);return[n,s,r,o]}function nwt(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}const gk=new Float32Array(12);function mk(e,t=2){let i=0;for(const n of e)for(let r=0;r<t;r++)gk[i++]=n[r]||0;return gk}function rwt(e,t,i){const[n,r,s,o]=e,c=s-n,h=o-r;let A=c,_=h;c/h<t/i?A=t/i*h:_=i/t*c,A<t&&(A=t,_=i);const C=(s+n)/2,S=(o+r)/2;return[C-A/2,S-_/2,C+A/2,S+_/2]}function owt(e,t){const[i,n,r,s]=t;return[(e[0]-i)/(r-i),(e[1]-n)/(s-n)]}const swt=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,awt=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,yk=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,cwt={name:"triangle",vs:yk,fs:yk,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class vk extends Bo{getShaders(){return super.getShaders({vs:swt,fs:awt,modules:[Fo,cwt]})}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){const{vertexCount:i,data:n}=this.props;return new Lr(t,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:i})}draw(){const{model:t}=this.state,{aggregationMode:i,colorDomain:n,intensity:r,threshold:s,colorTexture:o,maxTexture:c,weightsTexture:h}=this.props,A={aggregationMode:i,colorDomain:n,intensity:r,threshold:s,colorTexture:o,maxTexture:c,weightsTexture:h};t.shaderInputs.setProps({triangle:A}),t.draw(this.context.renderPass)}}vk.layerName="TriangleLayer";function lwt(e,t){const i={};for(const n in e)t.includes(n)||(i[n]=e[n]);return i}class _k extends To{initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:lwt(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);const{changeFlags:i}=t;if(i.extensionsChanged){const n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:t,mousePosition:i,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:i,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,i={}){const{props:n,oldProps:r,changeFlags:s}=t,{compareAll:o=!1,dimension:c}=i,{ignoreProps:h}=this.state,{props:A,accessors:_=[]}=c,{updateTriggersChanged:C}=s;if(s.dataChanged)return!0;if(C){if(C.all)return!0;for(const S of _)if(C[S])return!0}if(o)return s.extensionsChanged?!0:Ub({oldProps:r,newProps:n,ignoreProps:h,propTypes:this.constructor._propTypes});for(const S of A)if(n[S]!==r[S])return!0;return!1}isAttributeChanged(t){const{changedAttributes:i}=this.state;return t?i&&i[t]!==void 0:!uwt(i)}_getAttributeManager(){return new U0(this.context.device,{id:this.props.id,stats:this.context.stats})}}_k.layerName="AggregationLayer";function uwt(e){let t=!0;for(const i in e){t=!1;break}return t}const bk=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,xk=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,hwt=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,fwt=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,dwt=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,pwt={name:"weight",vs:dwt,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},Awt={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},gwt=2,QC={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},wk=[0,0],mwt={SUM:0,MEAN:1},ywt={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Uv,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},vwt=["float32-renderable-webgl","texture-blend-float-webgl"],_wt={data:{props:["radiusPixels"]}};class KC extends _k{getShaders(t){let i=[Fo];return t.modules&&(i=[...i,...t.modules]),super.getShaders({...t,modules:i})}initializeState(){super.initializeAggregationLayer(_wt),this.setState({colorDomain:wk}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){const{props:i,oldProps:n}=t,r=this._getChangeFlags(t);(r.dataChanged||r.viewportChanged)&&(r.boundsChanged=this._updateBounds(r.dataChanged),this._updateTextureRenderingBounds()),r.dataChanged||r.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):r.viewportZoomChanged&&this._debouncedUpdateWeightmap(),i.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){const{weightsTexture:t,triPositionBuffer:i,triTexCoordBuffer:n,maxWeightsTexture:r,colorTexture:s,colorDomain:o}=this.state,{updateTriggers:c,intensity:h,threshold:A,aggregation:_}=this.props,C=this.getSubLayerClass("triangle",vk);return new C(this.getSubLayerProps({id:"triangle-layer",updateTriggers:c}),{coordinateSystem:$i.DEFAULT,data:{attributes:{positions:i,texCoords:n}},vertexCount:4,maxTexture:r,colorTexture:s,aggregationMode:mwt[_]||0,weightsTexture:t,intensity:h,threshold:A,colorDomain:o})}finalizeState(t){super.finalizeState(t);const{weightsTransform:i,weightsTexture:n,maxWeightTransform:r,maxWeightsTexture:s,triPositionBuffer:o,triTexCoordBuffer:c,colorTexture:h,updateTimer:A}=this.state;i?.destroy(),n?.destroy(),r?.destroy(),s?.destroy(),o?.destroy(),c?.destroy(),h?.destroy(),A&&clearTimeout(A)}_getAttributeManager(){return new U0(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){const i={},{dimensions:n}=this.state;i.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",i.viewportChanged=t.changeFlags.viewportChanged;const{zoom:r}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==r)&&(i.viewportZoomChanged=!0),i}_createTextures(){const{textureSize:t,format:i}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...QC,width:t,height:t,format:i}),maxWeightsTexture:this.context.device.createTexture({...QC,width:1,height:1,format:i})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:t}=this.context,{weightsTextureSize:i}=this.props,n=Math.min(i,t.limits.maxTextureDimension2D),r=vwt.every(c=>t.features.has(c)),s=r?"rgba32float":"rgba8unorm",o=r?1:1/255;this.setState({textureSize:n,format:s,weightsScale:o}),r||Zi.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:i}=this.state;const{weightsTexture:n}=this.state,r=this.getAttributeManager();i?.destroy(),i=new BM(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:r.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t,modules:[...t.modules,pwt]}),this.setState({weightsTransform:i})}_setupResources(){this._createTextures();const{device:t}=this.context,{textureSize:i,weightsTexture:n,maxWeightsTexture:r}=this.state,s=this.getShaders({vs:bk,fs:xk});this._createWeightsTransform(s);const o=this.getShaders({vs:hwt,fs:fwt,modules:[Awt]}),c=new BM(t,{id:`${this.id}-max-weights-transform`,targetTexture:r,...o,vertexCount:i*i,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),h={inTexture:n,textureSize:i};c.model.shaderInputs.setProps({maxWeight:h}),this.setState({weightsTexture:n,maxWeightsTexture:r,maxWeightTransform:c,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:bk,fs:xk,...t})}_updateMaxWeightValue(){const{maxWeightTransform:t}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){const{viewport:i}=this.context,n=[i.unproject([0,0]),i.unproject([i.width,0]),i.unproject([0,i.height]),i.unproject([i.width,i.height])].map(c=>c.map(Math.fround)),r=iwt(n),s={visibleWorldBounds:r,viewportCorners:n};let o=!1;if(t||!this.state.worldBounds||!nwt(this.state.worldBounds,r)){const c=this._worldToCommonBounds(r),h=this._commonToWorldBounds(c);this.props.coordinateSystem===$i.LNGLAT&&(h[1]=Math.max(h[1],-85.051129),h[3]=Math.min(h[3],85.051129),h[0]=Math.max(h[0],-360),h[2]=Math.min(h[2],360));const A=this._worldToCommonBounds(h);s.worldBounds=h,s.normalizedCommonBounds=A,o=!0}return this.setState(s),o}_updateTextureRenderingBounds(){const{triPositionBuffer:t,triTexCoordBuffer:i,normalizedCommonBounds:n,viewportCorners:r}=this.state,{viewport:s}=this.context;t.write(mk(r,3));const o=r.map(c=>owt(s.projectPosition(c),n));i.write(mk(o,2))}_updateColorTexture(t){const{colorRange:i}=t.props;let{colorTexture:n}=this.state;const r=k5(i,!1,Uint8Array);n&&n?.width===i.length?n.setTexture2DData({data:r}):(n?.destroy(),n=this.context.device.createTexture({...QC,data:r,width:i.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){const{radiusPixels:t,colorDomain:i,aggregation:n}=this.props,{worldBounds:r,textureSize:s,weightsScale:o,weightsTexture:c}=this.state,h=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const A=this._worldToCommonBounds(r,{useLayerCoordinateSystem:!0});if(i&&n==="SUM"){const{viewport:tt}=this.context,K=tt.distanceScales.metersPerUnit[2]*(A[2]-A[0])/s;this.state.colorDomain=i.map(Q=>Q*K*o)}else this.state.colorDomain=i||wk;const _=this.getAttributeManager().getAttributes(),C=this.getModuleSettings();this._setModelAttributes(h.model,_),h.model.setVertexCount(this.getNumInstances());const S={radiusPixels:t,commonBounds:A,textureWidth:s,weightsScale:o,weightsTexture:c},{viewport:L,devicePixelRatio:N,coordinateSystem:U,coordinateOrigin:H}=C,{modelMatrix:j}=this.props;h.model.shaderInputs.setProps({project:{viewport:L,devicePixelRatio:N,modelMatrix:j,coordinateSystem:U,coordinateOrigin:H},weight:S}),h.run({parameters:{viewport:[0,0,s,s]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:i}=this.state;const{debounceTimeout:n}=this.props;t?(i=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(i),i=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:i})}_worldToCommonBounds(t,i={}){const{useLayerCoordinateSystem:n=!1}=i,[r,s,o,c]=t,{viewport:h}=this.context,{textureSize:A}=this.state,{coordinateSystem:_}=this.props,C=n&&(_===$i.LNGLAT_OFFSETS||_===$i.METER_OFFSETS),S=C?h.projectPosition(this.props.coordinateOrigin):[0,0],L=A*gwt/h.scale;let N,U;return n&&!C?(N=this.projectPosition([r,s,0]),U=this.projectPosition([o,c,0])):(N=h.projectPosition([r,s,0]),U=h.projectPosition([o,c,0])),rwt([N[0]-S[0],N[1]-S[1],U[0]-S[0],U[1]-S[1]],L,L)}_commonToWorldBounds(t){const[i,n,r,s]=t,{viewport:o}=this.context,c=o.unprojectPosition([i,n]),h=o.unprojectPosition([r,s]);return c.slice(0,2).concat(h.slice(0,2))}}KC.layerName="HeatmapLayer",KC.defaultProps=ywt;const bwt=Object.freeze(Object.defineProperty({__proto__:null,CPUAggregator:zp,ContourLayer:JC,GridLayer:XC,HeatmapLayer:KC,HexagonLayer:WC,ScreenGridLayer:jC,WebGLAggregator:ja,_AggregationLayer:Gp},Symbol.toStringTag,{value:"Module"})),Ck=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],Ek=[0n,1n,2n,4n,8n,16n];function xwt(e){return BigInt(`0x${e}`)}function qC(e){return e.toString(16)}function wwt(e){if(e.z<0||e.z>26)throw new Error("Wrong zoom");const t=BigInt(e.z);let i=BigInt(e.x)<<32n-t,n=BigInt(e.y)<<32n-t;for(let r=0;r<5;r++){const s=Ek[5-r],o=Ck[4-r];i=(i|i<<s)&o,n=(n|n<<s)&o}return 0x4000000000000000n|1n<<59n|t<<52n|(i|n<<1n)>>12n|0xfffffffffffffn>>t*2n}function Bk(e){const t=e>>59n&7n,i=e>>57n&3n,n=e>>52n&0x1fn,r=(e&0xfffffffffffffn)<<12n;if(t!==1n&&i!==0n)throw new Error("Wrong mode");let s=r,o=r>>1n;for(let c=0;c<6;c++){const h=Ek[c],A=Ck[c];s=(s|s>>h)&A,o=(o|o>>h)&A}return s=s>>32n-n,o=o>>32n-n,{z:Number(n),x:Number(s),y:Number(o)}}function ZC(e){return e>>52n&0x1fn}function Tk(e){const t=ZC(e)-1n;return e&~(0x1fn<<52n)|t<<52n|0xfffffffffffffn>>t*2n}function Cf(e,t){Zi.assert(e,t)}function Cwt(e,t){const{properties:i,numericProps:n}=e;return new Proxy(i[t]||{},{get(r,s){return s in n?n[s].value[t]:r[s]},has(r,s){return s in n||s in r},ownKeys(r){return[...Object.keys(n),...Reflect.ownKeys(r)]},getOwnPropertyDescriptor(r,s){return{enumerable:!0,configurable:!0}}})}function Qv(e,t){return`https://unpkg.com/@deck.gl/carto@${t}/dist/${e}-worker.js`}const $g=new Uint16Array,YC={positions:{value:new Float32Array,size:2},properties:[],numericProps:{},featureIds:{value:$g,size:1},globalFeatureIds:{value:$g,size:1}};function Sk(){return{shape:"binary-feature-collection",points:{type:"Point",...YC},lines:{type:"LineString",pathIndices:{value:$g,size:1},...YC},polygons:{type:"Polygon",polygonIndices:{value:$g,size:1},primitivePolygonIndices:{value:$g,size:1},...YC}}}function $C(e,t,i,n,r,s=2){return{type:"Point",positions:{value:new Float32Array(e),size:s},featureIds:{value:new Uint16Array(t),size:1},globalFeatureIds:{value:new Uint32Array(i),size:1},numericProps:n,properties:r}}function Ik(e,t){const i={};return t&&Object.keys(t).forEach(n=>{i[n]={value:new Float32Array(e),size:1}}),i}function Mk(e,t,i,n){Object.keys(e).forEach(r=>{t[r].value[n]=e[r].value[i]})}function Ewt(e,t,i,n=[],r,s){if(!e.content)return!1;e.userData||(e.userData={});const o=t.get(i)?.[0];if(o){if(n.every(h=>h.name in o))return!1;t.clear()}const c={};for(const h of e.content){let A=h.id;const _=typeof r=="function"?r(h,{}):r;for(let U=0;U<i-1;U++)A=Tk(A);const C=Number(A);if(!(C in c)){c[C]={id:A,count:0,position:[0,0]};for(const{name:U,aggregation:H}of n)H==="any"?c[C][U]=h.properties[U]:c[C][U]=0}const S=c[C].count;c[C].count+=typeof s=="function"?s(h,{}):s;const L=c[C].count,N=L-S;c[C].position[0]=(S*c[C].position[0]+N*_[0])/L,c[C].position[1]=(S*c[C].position[1]+N*_[1])/L;for(const{name:U,aggregation:H}of n){const j=c[C][U],tt=h.properties[U];H==="average"?c[C][U]=(S*j+N*tt)/L:H==="count"||H==="sum"?c[C][U]=j+tt:H==="max"?c[C][U]=Math.max(j,tt):H==="min"&&(c[C][U]=Math.min(j,tt))}}return t.set(i,Object.values(c)),!0}function Bwt(e){const t=[],i=["any","average","count","min","max","sum"];for(const n of Object.keys(e.content[0].properties)){let r=n.split("_").pop().toLowerCase();i.includes(r)||(Zi.warn(`No valid aggregation present in ${n} property`)(),r="any"),t.push({name:n,aggregation:r})}return t}function Twt(e,t){const i={};for(const{name:n,aggregation:r}of t)if(i[n]={min:1/0,max:-1/0},r!=="any")for(const s of e)i[n].min=Math.min(i[n].min,s[n]),i[n].max=Math.max(i[n].max,s[n]);return i}function Swt(e){const t=new Float32Array(e.length*2),i=new Uint16Array(e.length);for(let n=0;n<e.length;n++)t.set(e[n].position,2*n),i[n]=n;return{...Sk(),points:$C(t,i,i,{},e)}}const Yp=512;class tE extends qy{getTileIndices(t){return super.getTileIndices(t).map(wwt).map(i=>({q:i,i:qC(i)}))}getTileId({q:t,i}){return i||qC(t)}getTileMetadata({q:t}){return super.getTileMetadata(Bk(t))}getTileZoom({q:t}){return Number(ZC(t))}getParentIndex({q:t}){return{q:Tk(t)}}}const Pk=512;function Rk(e){const{x:t,y:i,z:n}=Bk(e),r=Pk/(1<<n);return[t*r,Pk-i*r,r]}function Iwt(e,t){const[i,n,r]=Rk(e);return[[i,n],[i+t*r,n-t*r]]}function Dk(e,t=1){const[i,n]=Iwt(e,t),[r,s]=rl(i),[o,c]=rl(n);return[o,s,o,c,r,c,r,s,o,s]}const Kv=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Ok=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ok&&parseFloat(Ok[1]);function Mwt(e){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,e)}function Pwt(...e){return Rwt(e)}function Rwt(e){const t=e.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),i=t.reduce((s,o)=>s+o.byteLength,0),n=new Uint8Array(i);let r=0;for(const s of t)n.set(s,r),r+=s.byteLength;return n.buffer}async function Dwt(e){const t=[];for await(const i of e)t.push(i);return Pwt(...t)}function Owt(e){return e&&typeof e=="object"&&e.isBuffer}function qv(e){if(Owt(e)||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Zv(e){return t=>new Promise((i,n)=>e(t,(r,s)=>r?n(r):i(s)))}class Lwt{constructor(t){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(t={}){Mwt(t)}async compress(t){return await this.preload(),this.compressSync(t)}async decompress(t,i){return await this.preload(),this.decompressSync(t,i)}compressSync(t){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(t,i){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(t){const i=await this.concatenate(t);yield this.compress(i)}async*decompressBatches(t){const i=await this.concatenate(t);yield this.decompress(i)}concatenate(t){return Dwt(t)}improveError(t){return t.message.includes(this.name)||(t.message=`${this.name} ${t.message}`),t}}class Fwt extends Lwt{name="deflate";extensions=[];contentEncodings=["deflate"];isSupported=!0;options;_chunks=[];constructor(t={}){super(t),this.options=t}async compress(t){if(!Kv&&this.options.deflate?.useZlib){const i=this.options.deflate?.gzip?await Zv(Nu.gzip)(t):await Zv(Nu.deflate)(t);return qv(i)}return this.compressSync(t)}async decompress(t){if(!Kv&&this.options.deflate?.useZlib){const i=this.options.deflate?.gzip?await Zv(Nu.gunzip)(t):await Zv(Nu.inflate)(t);return qv(i)}return this.decompressSync(t)}compressSync(t){if(!Kv&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?Nu.gzipSync(t):Nu.deflateSync(t);return qv(r)}const i=this.options?.deflate||{},n=new Uint8Array(t);return(this.options?.raw?Np.deflateRaw:Np.deflate)(n,i).buffer}decompressSync(t){if(!Kv&&this.options.deflate?.useZlib){const r=this.options.deflate?.gzip?Nu.gunzipSync(t):Nu.inflateSync(t);return qv(r)}const i=this.options?.deflate||{},n=new Uint8Array(t);return(this.options?.raw?Np.inflateRaw:Np.inflate)(n,i).buffer}async*compressBatches(t){const i=this.options?.deflate||{},n=new Np.Deflate(i);yield*this.transformBatches(n,t)}async*decompressBatches(t){const i=this.options?.deflate||{},n=new Np.Inflate(i);yield*this.transformBatches(n,t)}async*transformBatches(t,i){t.onData=this._onData.bind(this),t.onEnd=this._onEnd.bind(this);for await(const r of i){const s=new Uint8Array(r);if(!t.push(s,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const n=new Uint8Array(0);t.push(n,!0),yield*this._getChunks()}_onData(t){this._chunks.push(t)}_onEnd(t){if(t!==0)throw new Error(this._getError(t)+this._chunks.length)}_getChunks(){const t=this._chunks;return this._chunks=[],t}_getError(t=0){const i={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${i[t]}`}}class kwt extends Fwt{name="gzip";extensions=["gz","gzip"];contentEncodings=["gzip","x-gzip"];isSupported=!0;constructor(t){super({...t,deflate:{...t?.gzip,gzip:!0}})}}function Yv(e,t,i,n){const r=t.type===2?t.readVarint()+t.pos:t.pos+1,s=t.buf.buffer.slice(t.pos,r);if(n?.compression==="gzip"){const o=new kwt().decompressSync(s);i.value=new e(o)}else i.value=new e(s);return t.pos=r,i.value}class zE{static read(t,i){return t.readFields(zE._readField,{key:"",value:null},i)}static _readField(t,i,n){t===1?i.key=n.readString():t===2&&(i.value=n.readString())}}class Tf{static read(t,i){return t.readFields(Tf._readField,{},i)}static _readField(t,i,n){if(t===1){const{key:r,value:s}=zE.read(n,n.readVarint()+n.pos);i[r]=s}}}class nm{static read(t,i){const{value:n,size:r}=t.readFields(nm._readField,{value:[],size:0},i);return{value:n,size:r}}static _readField(t,i,n){t===1?Yv(Float64Array,n,i):t===2&&(i.size=n.readVarint(!0))}}class Wa{static read(t,i){const{value:n,size:r}=t.readFields(Wa._readField,{value:[],size:0},i);return{value:new Uint32Array(n),size:r}}static _readField(t,i,n){t===1?n.readPackedVarint(i.value):t===2&&(i.size=n.readVarint(!0))}}class rm{static read(t,i){return t.readFields(rm._readField,{id:0},i)}static _readField(t,i,n){t===1&&(i.id=n.readVarint())}}class GE{static read(t,i){return t.readFields(GE._readField,{value:[]},i)}static _readField(t,i,n){t===1&&Yv(Float64Array,n,i)}}class Sf{static read(t,i){return t.readFields(Sf._readField,{key:"",value:null},i)}static _readField(t,i,n){t===1?i.key=n.readString():t===2&&(i.value=GE.read(n,n.readVarint()+n.pos))}}class jE{static read(t,i){return t.readFields(jE._readField,{positions:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,n){if(t===1)i.positions=nm.read(n,n.readVarint()+n.pos);else if(t===2)i.globalFeatureIds=Wa.read(n,n.readVarint()+n.pos);else if(t===3)i.featureIds=Wa.read(n,n.readVarint()+n.pos);else if(t===4)i.properties.push(Tf.read(n,n.readVarint()+n.pos));else if(t===5){const r=Sf.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}else t===6&&i.fields.push(rm.read(n,n.readVarint()+n.pos))}}class VE{static read(t,i){return t.readFields(VE._readField,{positions:null,pathIndices:null,globalFeatureIds:null,featureIds:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,n){if(t===1)i.positions=nm.read(n,n.readVarint()+n.pos);else if(t===2)i.pathIndices=Wa.read(n,n.readVarint()+n.pos);else if(t===3)i.globalFeatureIds=Wa.read(n,n.readVarint()+n.pos);else if(t===4)i.featureIds=Wa.read(n,n.readVarint()+n.pos);else if(t===5)i.properties.push(Tf.read(n,n.readVarint()+n.pos));else if(t===6){const r=Sf.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}else t===7&&i.fields.push(rm.read(n,n.readVarint()+n.pos))}}class HE{static read(t,i){return t.readFields(HE._readField,{positions:null,polygonIndices:null,globalFeatureIds:null,featureIds:null,primitivePolygonIndices:null,triangles:null,properties:[],numericProps:{},fields:[]},i)}static _readField(t,i,n){if(t===1)i.positions=nm.read(n,n.readVarint()+n.pos);else if(t===2)i.polygonIndices=Wa.read(n,n.readVarint()+n.pos);else if(t===3)i.globalFeatureIds=Wa.read(n,n.readVarint()+n.pos);else if(t===4)i.featureIds=Wa.read(n,n.readVarint()+n.pos);else if(t===5)i.primitivePolygonIndices=Wa.read(n,n.readVarint()+n.pos);else if(t===6)i.triangles=Wa.read(n,n.readVarint()+n.pos);else if(t===7)i.properties.push(Tf.read(n,n.readVarint()+n.pos));else if(t===8){const r=Sf.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}else t===9&&i.fields.push(rm.read(n,n.readVarint()+n.pos))}}let Nwt=class C9{static read(t,i){return t.readFields(C9._readField,{points:null,lines:null,polygons:null},i)}static _readField(t,i,n){t===1?i.points=jE.read(n,n.readVarint()+n.pos):t===2?i.lines=VE.read(n,n.readVarint()+n.pos):t===3&&(i.polygons=HE.read(n,n.readVarint()+n.pos))}};class WE{static read(t,i){return t.readFields(WE._readField,{value:[]},i)}static _readField(t,i,n){t===1&&Yv(BigUint64Array,n,i)}}class JE{static read(t,i){return t.readFields(JE._readField,{indices:null,properties:[],numericProps:{}},i)}static _readField(t,i,n){if(t===1)i.indices=WE.read(n,n.readVarint()+n.pos);else if(t===2)i.properties.push(Tf.read(n,n.readVarint()+n.pos));else if(t===3){const r=Sf.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}}}let Uwt=class E9{static read(t,i){return t.readFields(E9._readField,{scheme:0,cells:null},i)}static _readField(t,i,n){t===1?i.scheme=n.readVarint():t===2&&(i.cells=JE.read(n,n.readVarint()+n.pos))}};function $v(e,t){const i=new I2t(e);return t.read(i)}function zwt(e){const{cells:t,scheme:i}=e,n=t.indices.value.length,r=[];for(let s=0;s<n;s++){const o=i==="h3"?qC(t.indices.value[s]):t.indices.value[s],c={...t.properties[s]};for(const h of Object.keys(t.numericProps))c[h]=t.numericProps[h].value[s];r.push({id:o,properties:c})}return r}const Lk="9.1.14",Fk="cartoSpatialTile",Gwt={cartoSpatialTile:{scheme:"quadbin",workerUrl:Qv(Fk,Lk)}},kk={name:"CARTO Spatial Tile",version:Lk,id:Fk,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(e,t)=>Nk(e,t),parseSync:Nk,worker:!0,options:Gwt};function Nk(e,t){if(!e)return null;const i=$v(e,Uwt),{cells:n}=i,r=t?.cartoSpatialTile?.scheme;return zwt({cells:n,scheme:r})}function $p(e,t,i=0){if(!e)return t;if(!t)return e;if(i>10)return t;const n={...e};for(const r in t){const s=t[r];s===e||s===t||(typeof s=="object"&&s!==null?n[r]=$p(e[r],s,i+1):n[r]=s)}return n}function jwt(e,t){const i={};for(const{geoid:n,...r}of t.properties)n in i?Zi.warn("Duplicate geoid key in boundary mapping, using first occurance")():i[n]=r;for(const n of["points","lines","polygons"]){const r=e[n];if(r.positions.value.length===0)continue;r.properties=r.properties.map(({geoid:A})=>i[A]);const{positions:s,globalFeatureIds:o}=r;let c=null;n==="lines"&&(c=r.pathIndices.value),n==="polygons"&&(c=r.polygonIndices.value);const h=s.value.length/s.size;for(const A in t.numericProps){const _=t.numericProps[A].value,C=_.constructor,S=new C(h);if(r.numericProps[A]={value:S,size:1},c)for(let L=0;L<c.length-1;L++){const N=c[L],U=c[L+1],H=o.value[N];S.fill(_[H],N,U)}else for(let L=0;L<h;L++){const N=o.value[L];S[L]=_[N]}}}return e}const Ef={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="object"&&Array.isArray(e.tiles)&&e.tiles.every(i=>typeof i=="string"),equal:(e,t)=>Yr(e,t,2),async:!0};hg([kk]);const Uk={data:Ef,clusterLevel:{type:"number",value:5,min:1},getPosition:{type:"accessor",value:({id:e})=>Dk(e,.5).slice(2,4)},getWeight:{type:"accessor",value:1},refinementStrategy:"no-overlap",tileSize:Yp};class eE extends nu{initializeState(){super.initializeState(),this.state.aggregationCache=new WeakMap}renderLayers(){const t=this.state.tileset?.tiles.filter(S=>S.isLoaded&&S.content&&this.state.tileset.isTileVisible(S));if(!t?.length)return null;t.sort((S,L)=>L.zoom-S.zoom);const{zoom:i}=this.context.viewport,{clusterLevel:n,getPosition:r,getWeight:s}=this.props,{aggregationCache:o}=this.state,c=Bwt(t[0]),h=[];let A=!1;for(const S of t){const L=Math.round(i-S.zoom),N=Math.round(n)-L;let U=o.get(S.content);U||(U=new Map,o.set(S.content,U));const H=Ewt(S,U,N,c,r,s);A||(A=H),h.push(...U.get(N))}h.sort((S,L)=>Number(L.count-S.count));const _=h?.map(S=>S.id);if(A||(A=!Yr(_,this.state.clusterIds,1)),this.setState({clusterIds:_}),A){const S=Twt(h,c),L=Swt(h);L.points.attributes={stats:S},this.setState({data:L})}const C={...this.props,id:"clusters",data:this.state.data,dataComparator:(S,L)=>{const N=S?.points?.properties?.map(H=>H.id),U=L?.points?.properties?.map(H=>H.id);return Yr(N,U,1)}};return new $l(this.getSubLayerProps(C))}getPickingInfo(t){const i=t.info;if(i.index!==-1){const{data:n}=t.sourceLayer.props;i.object=OC(n,{globalFeatureId:i.index})}return i}_updateAutoHighlight(t){for(const i of this.getSubLayers())i.updateAutoHighlight(t)}filterSubLayer(){return!0}}eE.layerName="ClusterGeoJsonLayer",eE.defaultProps=Uk;class iE extends To{getLoadOptions(){const t=this.props.data;return $p(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,maxresolution:n}=t;return[new eE(this.props,{id:`cluster-geojson-layer-${this.props.id}`,data:i,TilesetClass:tE,maxZoom:n,loadOptions:this.getLoadOptions()})]}}iE.layerName="ClusterTileLayer",iE.defaultProps=Uk;const zk=85.051128;function Gk({west:e,north:t,east:i,south:n},r,s=1){const o=[[t,i],[n,i],[n,e],[t,e]].map(A=>dw(A[0],A[1],r)).map(A=>Math.max(...lpt(A).map(_=>hpt(_,_p.rads)))*180/Math.PI),c=Math.max(...o)*s,h=Math.min(180,c/Math.cos((t+n)/2*Math.PI/180));return{north:Math.min(t+c,zk),east:i+h,south:Math.max(n-c,-zk),west:e-h}}function jk({west:e,north:t,east:i,south:n},r){const s=Math.abs(i-e);if(s>180){const o=Math.ceil(s/180);let c=[];for(let h=0;h<o;h++){const A=e+h*180,_=Math.min(A+179.9999999,i);c=c.concat(jk({west:A,north:t,east:_,south:n},r))}return[...new Set(c)]}return apt([[t,i],[n,i],[n,e],[t,e],[t,i]],r)}function Vwt(e){const t=v6(e),i=t.map(h=>h[0]),n=t.map(h=>h[1]),r=Math.min(...n),s=Math.min(...i),o=Math.max(...n),c=Math.max(...i);return Gk({west:r,south:s,east:o,north:c},ev(e),.12)}const Hwt=2;function nE(e,t){const i=Math.log2(t/512),n=2/3*(e.zoom-i),r=Math.log(1/Math.cos(Math.PI*e.latitude/180));return Math.max(0,Math.floor(n+r-Hwt))}class Wwt extends qy{getTileIndices({viewport:t,minZoom:i,maxZoom:n}){if(t.latitude===void 0)return[];const[r,s,o,c]=t.getBounds(),{tileSize:h}=this.opts;let A=nE(t,h),_;if(typeof i=="number"&&Number.isFinite(i)&&A<i)return[];if(typeof n=="number"&&Number.isFinite(n)&&A>n){A=n;const C=dw(t.latitude,t.longitude,n);_=spt(C,1)}else{const C=Gk({west:r,north:c,east:o,south:s},A);_=jk(C,A)}return _.map(C=>({i:C}))}getTileId({i:t}){return t}getTileMetadata({i:t}){return{bbox:Vwt(t)}}getTileZoom({i:t}){return ev(t)}getParentIndex(t){const i=ev(t.i);return{i:opt(t.i,i-1)}}}hg([kk]);function Jwt(e){return e!=null&&e!==""}const Xwt={tileSize:Yp};class t_ extends nu{_updateAutoHighlight(t){const{hoveredFeatureId:i}=this.state,n=t.object;let r=null;if(n&&(r=n.id),i!==r){let{highlightColor:s}=this.props;typeof s=="function"&&(s=s(t)),this.setState({highlightColor:s,hoveredFeatureId:r})}}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){const{hoveredFeatureId:i}=this.state,n=t.content;return!Jwt(i)||!Array.isArray(n)||!this._featureInTile(t,i)?-1:n.findIndex(r=>r.id===i)}_featureInTile(t,i){const n=this.state.tileset,r=n.getTileZoom(t.index),s=t.index.q?"q":"i";let o={[s]:i},c=n.getTileZoom(o);for(;!(c<=r);)o=n.getParentIndex(o),c=n.getTileZoom(o);return o[s]===t.index[s]}}t_.layerName="SpatialIndexTileLayer",t_.defaultProps=Xwt;const Qwt=e=>{const{data:t}=e,{index:i}=e.tile;return!t||!t.length?null:new gl(e,{getHexagon:n=>n.id,centerHexagon:i,highPrecision:!0})},Kwt={data:Ef,tileSize:Yp};class rE extends To{initializeState(){gl._checkH3Lib()}getLoadOptions(){const t=this.props.data;return $p(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},cartoSpatialTile:{scheme:"h3"}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i}=t;let{minresolution:n,maxresolution:r}=t;this.props.minZoom&&(n=Math.max(n,nE({zoom:this.props.minZoom,latitude:0},this.props.tileSize))),this.props.maxZoom&&(r=Math.min(r,nE({zoom:this.props.maxZoom,latitude:0},this.props.tileSize)));const s=this.getSubLayerClass("spatial-index-tile",t_);return new s(this.props,{id:`h3-tile-layer-${this.props.id}`,data:i,TilesetClass:Wwt,renderSubLayers:Qwt,minZoom:n,maxZoom:r,loadOptions:this.getLoadOptions()})}}rE.layerName="H3TileLayer",rE.defaultProps=Kwt;const qwt=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  return color;
}
`,Zwt={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:e=>{if(!e)return{};const{colorDomain:t=[0,1],colorTexture:i,delta:n=[1,0],intensity:r=1,opacity:s=1,radiusPixels:o=20}=e;return{colorDomain:t,colorTexture:i,delta:n,intensity:r,opacity:s,radiusPixels:o}},fs:qwt,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},Ywt={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function oE(e){for(;e.parent&&!e.applyPostProcess;)e=e.parent;return e}class Vk extends Bo{initializeState(){this.id=`draw-callback-${oE(this).props.id}`}_drawLayer(){oE(this).applyPostProcess()}}Vk.layerName="DrawCallbackLayer";function Hk(e){var t;return t=class extends e{draw(i){const{shaderModuleProps:n}=i,{picking:r}=n,s=oE(this);r.isActive||s.enableRTT(i),super.draw(i),r.isActive||s.disableRTT()}},t.layerName=`RTT-${e.layerName}`,t}function Wk(e,t){var i;return i=class extends e{initializeState(n){super.initializeState(n),this._createTextures(),this.internalState.postProcess=new fQ(t,this.props),this.internalState.postProcess.setup(n)}updateState(n){super.updateState(n),this.internalState.postProcess.setProps(this.props)}renderLayers(){let n=super.renderLayers();return n?(n=Array.isArray(n)?n:[n],[...n,new Vk]):null}_createTextures(){const{device:n}=this.context;this.internalState.renderBuffers=[0,1].map(r=>n.createFramebuffer({id:`layer-fbo-${r}`,colorAttachments:[n.createTexture(Ywt)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(n){const{shaderModuleProps:r}=n,{viewport:s}=this.context,{devicePixelRatio:o}=r.project,c=o*s.width,h=o*s.height;this.internalState.renderBuffers.forEach(A=>A.resize({width:c,height:h}))}enableRTT(n){this._resizeBuffers(n),this.internalState.originalRenderPass=this.context.renderPass;const[r]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:r,parameters:{viewport:[0,0,r.width,r.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[n,r]=this.internalState.renderBuffers,{framebuffer:s}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:n,swapBuffer:r,target:s}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(n=>{n.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},i.layerName=`PostProcess${e.layerName}`,i}const $wt=`vec4 copy_filterColor_ext(vec4 color, vec2 texSize, vec2 texCoord) {
  return color;
}
`,tCt={name:"copy",fs:$wt,getUniforms:()=>({}),passes:[{filter:!0}]},eCt={getQuadbin:{type:"accessor",value:e=>e.quadbin}};class sE extends sh{indexToBounds(){const{data:t,extruded:i,getQuadbin:n}=this.props,r=i?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>Dk(n(s,o),r),updateTriggers:{getPolygon:r}}}}sE.layerName="QuadbinLayer",sE.defaultProps=eCt;const iCt=e=>{const{data:t}=e;if(!t||!t.length)return null;const i=typeof t[0].id=="bigint";return new sE(e,{getQuadbin:i?n=>n.id:n=>xwt(n.id)})},nCt={data:Ef,tileSize:Yp};class e_ extends To{getLoadOptions(){const t=this.props.data;return $p(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,maxresolution:n}=t,r=this.getSubLayerClass("spatial-index-tile",t_);return new r(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:i,TilesetClass:tE,renderSubLayers:iCt,maxZoom:n,loadOptions:this.getLoadOptions()})}}e_.layerName="QuadbinTileLayer",e_.defaultProps=nCt;const rCt=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],oCt={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function Jk(e){const t=Number(ZC(e));return Math.pow(4,t)}function sCt(e){const t=new Uint8Array(e.length*4);let i=0;for(let n=0;n<e.length;n++){const r=e[n];t[i++]=r[0],t[i++]=r[1],t[i++]=r[2],t[i++]=Number.isFinite(r[3])?r[3]:255}return t}const aCt=`uniform densityUniforms {
  float factor;
} density;
`,cCt={name:"density",vs:aCt,uniformTypes:{factor:"f32"}};class Xk extends Hk(rh){getShaders(t){const i=super.getShaders(t);return i.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},i.modules=[...i.modules,cCt],i}draw(t){const i=this.props.data[0],n=this.props.elevationScale,r={factor:Jk(i.id)/n};for(const s of this.state.models)s.shaderInputs.setProps({density:r});super.draw(t)}}Xk.layerName="RTTSolidPolygonLayer";const lCt=Wk(e_,Zwt),uCt={data:Ef,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:rCt,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class aE extends To{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:t}){const{viewportChanged:i}=t;return this.setState({viewportChanged:i}),t.somethingChanged}updateState(t){const{props:i,oldProps:n}=t;super.updateState(t),i.colorRange!==n.colorRange&&this._updateColorTexture(t)}renderLayers(){const{data:t,getWeight:i,colorDomain:n,intensity:r,radiusPixels:s,_subLayerProps:o,updateTriggers:c,onMaxDensityChange:h,onViewportLoad:A,onTileLoad:_,onTileUnload:C,...S}=this.props,L={...o,cell:{...o?.cell,_subLayerProps:{...o?.cell?._subLayerProps,fill:{...o?.cell?._subLayerProps?.fill,type:Xk}}}};let N=0,U=0;const H=[...this.state.tiles].filter(Q=>Q.content),j=H.filter(Q=>Q.isVisible),tt=j.length?j:H;for(const Q of tt){const pt=Q.content[0],$=Jk(pt.id);U=Math.max(Q.userData.maxWeight*$,U),N=Math.max(Q.zoom,N)}const K=this.context.viewport.zoom-N;return U=U*Math.pow(2,K),typeof h=="function"&&h(U),new lCt(S,this.getSubLayerProps({id:"heatmap",data:t,getFillColor:0,getElevation:i,elevationScale:U,colorDomain:n,radiusPixels:s,intensity:r,_subLayerProps:L,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:c.getWeight},onViewportLoad:Q=>{this.setState({isLoaded:!0}),typeof A=="function"&&A(Q)},onTileLoad:Q=>{let pt=-1/0;if(typeof i!="function")pt=i;else if(Q.content)for(const $ of Q.content)pt=Math.max(i($,{}),pt);Q.userData={maxWeight:pt},this.state.tiles.add(Q),typeof _=="function"&&_(Q)},onTileUnload:Q=>{this.state.tiles.delete(Q),typeof C=="function"&&C(Q)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(t){const{colorRange:i}=t.props;let{colorTexture:n}=this.state;const r=sCt(i);n&&n?.width===i.length?n.setTexture2DData({data:r}):(n?.destroy(),n=this.context.device.createTexture({...oCt,data:r,width:i.length,height:1})),this.setState({colorTexture:n})}}aE.layerName="HeatmapTileLayer",aE.defaultProps=uCt;const[Qk,Kk,qk,Zk]=[0,1,2,3];class Yk extends Dg{getShaders(){const t=super.getShaders();let i=t.vs;return i=i.replaceAll("textBackground.padding.","_padding."),i=i.replace("void main(void) {",`void main(void) {
  vec4 _padding = textBackground.padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...t,vs:i}}}Yk.layerName="EnhancedTextBackgroundLayer";class $k extends hf{filterSubLayer({layer:t,renderPass:i}){const n=t.id.includes("primary-background");return i==="collision"?n:!n}}$k.layerName="EnhancedTextLayer";const hCt={...hf.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}};class i_ extends To{calculatePixelOffset(t){const{getTextAnchor:i,getAlignmentBaseline:n,getRadius:r,getSecondaryText:s,radiusScale:o,secondarySizeScale:c,sizeScale:h}=this.props,A=i==="middle"?0:i==="start"?1:-1,_=n==="center"?0:n==="bottom"?1:-1,C=h/4,S=h*(1+1/4),L=.6*(1-_)*h;let N=t?L:0;i==="middle"&&n==="top"&&s&&(N-=L,N-=c,N+=h);const U=1+1/4;return typeof r=="function"?(H,j)=>{const tt=(j?r(H,j):1)*o*U;return[A*(tt+C),_*(tt+S)+N]}:[A*(r*o*U+C),_*(r*o*U+S)+N]}calculateBackgroundPadding(){const{getTextAnchor:t,getAlignmentBaseline:i,sizeScale:n}=this.props,r=12*n,s=3*n,o=[0,0,0,0];return i==="top"?o[Kk]=s:i==="bottom"?o[Zk]=s:(o[Kk]=.5*s,o[Zk]=.5*s),t==="start"?o[Qk]=r:t==="end"?o[qk]=r:(o[Qk]=.5*r,o[qk]=.5*r),o}renderTextLayer(t,{updateTriggers:i={},...n}){const{data:r,characterSet:s,fontFamily:o,fontSettings:c,fontWeight:h,outlineColor:A,outlineWidth:_,sizeScale:C,radiusScale:S,getAlignmentBaseline:L,getColor:N,getPosition:U,getTextAnchor:H,updateTriggers:j}=this.props;if(C<2){const tt=this.parent?.props?.textSizeScale?"textSizeScale":"sizeScale";Zi.warn(`${tt} has small value (${C}). Note getTextSize is not supported on PointLabelLayer`)()}return new $k(this.getSubLayerProps({id:t,data:r,characterSet:s,fontFamily:o,fontSettings:c,fontWeight:h,outlineColor:A,outlineWidth:_,sizeScale:C,getAlignmentBaseline:L,getColor:N,getPosition:U,getTextAnchor:H,updateTriggers:{...j,...i,getPixelOffset:[j.getRadius,j.getTextAnchor,j.getAlignmentBaseline,S,C]}}),{getSize:1,_subLayerProps:{background:{type:Yk}}},n)}renderLayers(){const{getText:t,getSecondaryColor:i,getSecondaryText:n,secondaryOutlineColor:r,secondarySizeScale:s,updateTriggers:o}=this.props,c=this.calculatePixelOffset(!1),h=this.calculateBackgroundPadding();return[this.renderTextLayer(`${o.getText}-primary`,{backgroundPadding:h,getText:t,getPixelOffset:c,background:!0}),!!n&&this.renderTextLayer(`${o.getSecondaryText}-secondary`,{getText:n,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...i&&{getColor:i},...s&&{sizeScale:s},...r&&{outlineColor:r}})]}}i_.layerName="PointLabelLayer",i_.defaultProps=hCt;const fCt=`#version 300 es
#define SHADER_NAME raster-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif
void main(void) {
vec2 tileOrigin = column.offset.xy;
float scale = column.widthScale;
int yIndex = - (gl_InstanceID / BLOCK_WIDTH);
int xIndex = gl_InstanceID + (yIndex * BLOCK_WIDTH);
vec2 cellCenter = scale * vec2(float(xIndex) + 0.5, float(yIndex) - 0.5);
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float cellWidth = column.coverage * scale;
geometry.position = vec4(tileOrigin, 0.0, 1.0);
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
geometry.position.xyz -= project.commonOrigin;
}
geometry.position.xy += cellCenter;
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float halfOffset = project_pixel_size(column.widthScale) / cellWidth;
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
geometry.pickingColor = instancePickingColors;
vec2 base = positions.xy * scale * strokeOffsetRatio * column.coverage * shouldRender;
vec3 cell = vec3(base, project_size(elevation));
DECKGL_FILTER_SIZE(cell, geometry);
geometry.position.xyz += cell;
gl_Position = project_common_position_to_clipspace(geometry.position);
geometry.normal = project_normal(normals);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,dCt={...hl.defaultProps,extruded:!1,diskResolution:4,vertices:[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]};class t9 extends Hk(hl){getShaders(){const t=super.getShaders(),i=this.props.data,n=i.data.blockSize??Math.sqrt(i.length);return{...t,defines:{...t.defines,BLOCK_WIDTH:n},vs:fCt}}initializeState(){this.getAttributeManager().addInstanced({instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:[255,255,255,255]}})}}t9.layerName="RasterColumnLayer";function pCt(e,t){return e.data===t.data&&e.length===t.length}class cE extends To{renderLayers(){const{data:t,getElevation:i,getFillColor:n,getLineColor:r,getLineWidth:s,tileIndex:o,updateTriggers:c}=this.props;if(!t||!o)return null;const h=t.blockSize??0,[A,_,C]=Rk(o),S=[A,_],L=C/h,N=this.getSubLayerClass("column",t9),{highlightedObjectIndex:U,highlightColor:H}=this.state;return new N(this.props,this.getSubLayerProps({id:"cell",updateTriggers:c,getElevation:this.getSubLayerAccessor(i),getFillColor:this.getSubLayerAccessor(n),getLineColor:this.getSubLayerAccessor(r),getLineWidth:this.getSubLayerAccessor(s)}),{data:{data:t,length:h*h},dataComparator:pCt,offset:S,lineWidthScale:L,highlightedObjectIndex:U,highlightColor:H,parameters:{blendColorSrcFactor:"one",blendAlphaSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaDstFactor:"zero",blendColorOperation:"add",blendAlphaOperation:"add"}})}getSubLayerAccessor(t){return typeof t!="function"?super.getSubLayerAccessor(t):(i,n)=>{const{data:r,index:s}=n,o=r.data,c=Cwt(o.cells,s);return t({properties:c},n)}}getPickingInfo(t){const i=super.getPickingInfo(t);return i.index!==-1&&(i.object=this.getSubLayerAccessor(n=>n)(void 0,{data:this.props,index:i.index})),i}_updateAutoHighlight(t){const{highlightedObjectIndex:i}=this.state;let n=-1;if(t.index!==-1&&(n=t.index),i!==n){let{highlightColor:r}=this.props;typeof r=="function"&&(r=r(t)),this.setState({highlightColor:r,highlightedObjectIndex:n})}}}cE.layerName="RasterLayer",cE.defaultProps=dCt;const ACt={uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:BigUint64Array,int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:BigInt64Array,float32:Float32Array,float64:Float64Array};class XE{static read(t,i){return t.readFields(XE._readField,{name:"",type:"",data:null},i)}static _readField(t,i,n){if(t===1)i.name=n.readString();else if(t===2)i.type=n.readString();else if(t===3){const r=ACt[i.type];if(!r)throw Error(`Invalid data type: ${i.type}`);i.data={};const{compression:s}=lE;Yv(r,n,i.data,{compression:s})}}}let lE=class B9{static read(t,i){return t.readFields(B9._readField,{blockSize:0,bands:[]},i)}static _readField(t,i,n){t===1?i.blockSize=n.readVarint():t===2&&i.bands.push(XE.read(n,n.readVarint()+n.pos))}};const e9="9.1.14",i9="cartoRasterTile",gCt={cartoRasterTile:{metadata:null,workerUrl:Qv(i9,e9)}},mCt={name:"CARTO Raster Tile",version:e9,id:i9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-raster-tile"],category:"geometry",parse:async(e,t)=>n9(e,t),parseSync:n9,worker:!0,options:gCt};function n9(e,t){const i=t?.cartoRasterTile?.metadata;if(!e||!i)return null;lE.compression=i.compression;const n=$v(e,lE),{bands:r,blockSize:s}=n,o={};for(let c=0;c<r.length;c++){const{name:h,data:A}=r[c];o[h]=A}return{blockSize:s,cells:{numericProps:o,properties:[]}}}hg([mCt]);const yCt=e=>{const t=e.tile?.index?.q;return t?new cE(e,{tileIndex:t}):null},vCt={data:Ef,refinementStrategy:"no-overlap",tileSize:Yp};class _Ct extends Wk(nu,tCt){filterSubLayer(t){const{tile:i}=t.layer.props;return i?super.filterSubLayer(t):!0}}class uE extends To{getLoadOptions(){const t=this.props.data;return $p(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}}})}renderLayers(){const t=this.props.data;if(!t)return null;const{tiles:i,minzoom:n,maxzoom:r,raster_metadata:s}=t,o=this.getSubLayerClass("tile",_Ct),c=this.getLoadOptions();return new o(this.props,{id:`raster-tile-layer-${this.props.id}`,data:i,TilesetClass:tE,renderSubLayers:yCt,minZoom:n,maxZoom:r,loadOptions:{...c,cartoRasterTile:{...c?.cartoRasterTile,metadata:s}}})}}uE.layerName="RasterTileLayer",uE.defaultProps=vCt;class QE{static read(t,i){return t.readFields(QE._readField,{properties:[],numericProps:{}},i)}static _readField(t,i,n){if(t===1)i.properties.push(Tf.read(n,n.readVarint()+n.pos));else if(t===2){const r=Sf.read(n,n.readVarint()+n.pos);i.numericProps[r.key]=r.value}}}const r9="9.1.14",o9="cartoPropertiesTile",bCt={cartoPropertiesTile:{workerUrl:Qv(o9,r9)}},xCt={name:"CARTO Properties Tile",version:r9,id:o9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-properties-tile"],category:"geometry",worker:!0,parse:async(e,t)=>s9(e),parseSync:s9,options:bCt};function s9(e,t){return e?$v(e,QE):null}const a9="9.1.14",c9="cartoVectorTile",wCt={cartoVectorTile:{workerUrl:Qv(c9,a9)}},CCt={name:"CARTO Vector Tile",version:a9,id:c9,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-vector-tile"],category:"geometry",parse:async(e,t)=>l9(e),parseSync:l9,worker:!0,options:wCt};function ECt(e,t,{startPosition:i,endPosition:n,indices:r}){const s=e.positions.size,o=i*s,c=n*s,h=e.positions.value.subarray(o,c),A=r.slice(1).map(C=>C-i),_=TO(h,A,s);for(let C=0,S=_.length;C<S;++C)t.push(i+_[C])}function BCt(e){const{polygonIndices:t,primitivePolygonIndices:i}=e,n=[];let r=0;for(let s=0;s<t.value.length-1;s++){const o=t.value[s],c=t.value[s+1],h=i.value.indexOf(c),A=i.value.subarray(r,h);r=h,ECt(e,n,{startPosition:o,endPosition:c,indices:A})}e.triangles={value:new Uint32Array(n),size:1}}function l9(e,t){if(!e)return null;const i=$v(e,Nwt);return i.polygons&&!i.polygons.triangles&&BCt(i.polygons),i}function TCt(e,t){const i=t?t in e.numericProps:!1,n=new Map;for(let _=0;_<e.pathIndices.value.length-1;_++){const C=e.pathIndices.value[_],S=e.featureIds.value[C];let L;t===void 0?L=S:i?L=e.numericProps[t].value[C]:e.properties[S]&&t in e.properties[S]?L=e.properties[S][t]:L=void 0;const N=OCt(e,_);(!n.has(L)||N>n.get(L).length)&&n.set(L,{index:_,length:N})}const r=[],s=[],o=[],c=[],h=Ik(n.size,e.numericProps);let A=0;for(const[_,{index:C}]of n){const S=LCt(e,C);r.push(...S);const L=e.pathIndices.value[C],N=e.featureIds.value[L];o.push(A),s.push(e.properties[N]),c.push(e.globalFeatureIds.value[L]),Mk(e.numericProps,h,L,A),A++}return $C(r,o,c,h,s)}function SCt(e,t,i){const{west:n,south:r,east:s,north:o}=t,c=(s-n)*(o-r)*1e-4,h=[],A=[],_=[],C=[],S=Ik(e.polygonIndices.value.length-1,e.numericProps);let L=0,N=0;const{extruded:U}=i;for(let H=0;H<e.polygonIndices.value.length-1;H++){const j=e.polygonIndices.value[H],tt=e.polygonIndices.value[H+1];if(ICt(e,H)<c)continue;const K=RCt(e,H);let Q=-1,pt=[0,0],$=!1;for(;N<e.triangles.value.length;){const Gt=e.triangles.value[N];if(Gt>=tt)break;if($){N+=3;continue}const dt=e.triangles.value[N+1],lt=e.triangles.value[N+2],Lt=e.positions.value.subarray(Gt*e.positions.size,Gt*e.positions.size+e.positions.size),J=e.positions.value.subarray(dt*e.positions.size,dt*e.positions.size+e.positions.size),ut=e.positions.value.subarray(lt*e.positions.size,lt*e.positions.size+e.positions.size);if(PCt(K,Lt,J,ut))$=!0;else{const Et=u9(Lt,J,ut);Et>Q&&(Q=Et,pt=[(Lt[0]+J[0]+ut[0])/3,(Lt[1]+J[1]+ut[1])/3])}N+=3}const zt=$?K:pt;if(MCt(zt,t)){h.push(...zt);const Gt=e.featureIds.value[j];if(U){const dt=i.getElevation(void 0,{data:e,index:Gt});h.push(dt*i.elevationScale)}A.push(e.properties[Gt]),_.push(L),C.push(e.globalFeatureIds.value[j]),Mk(e.numericProps,S,j,L),L++}}return e.numericProps&&Object.keys(S).forEach(H=>{S[H].value=S[H].value.slice(0,L)}),$C(h,_,C,S,A,U?3:2)}function ICt(e,t){const{positions:{value:i,size:n},polygonIndices:{value:r},triangles:{value:s}}=e,o=r[t],c=r[t+1];let h=0,A=0;for(;A<s.length&&!(s[A]>=o);)A+=3;for(;A<s.length;){const _=s[A];if(_>=c)break;const C=s[A+1],S=s[A+2],L=i.subarray(_*n,_*n+n),N=i.subarray(C*n,C*n+n),U=i.subarray(S*n,S*n+n);h+=u9(L,N,U),A+=3}return h}function MCt([e,t],{west:i,east:n,south:r,north:s}){return e>=i&&e<n&&t>=r&&t<s}function PCt(e,t,i,n){const r=Math.abs((i[0]-t[0])*(n[1]-t[1])-(n[0]-t[0])*(i[1]-t[1]))/2,s=Math.abs((t[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(t[1]-e[1]))/2,o=Math.abs((i[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(i[1]-e[1]))/2,c=Math.abs((n[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(n[1]-e[1]))/2;return Math.abs(r-(s+o+c))<1e-10}function u9([e,t],[i,n],[r,s]){return Math.abs((e*(n-s)+i*(s-t)+r*(t-n))/2)}function RCt(e,t){const{positions:{value:i,size:n}}=e,r=n*e.polygonIndices.value[t],s=n*e.polygonIndices.value[t+1];let o=1/0,c=1/0,h=-1/0,A=-1/0;for(let _=r;_<s;_+=n){const[C,S]=i.subarray(_,_+2);o=Math.min(o,C),c=Math.min(c,S),h=Math.max(h,C),A=Math.max(A,S)}return[(o+h)/2,(c+A)/2]}function DCt(e,t){const{positions:{value:i}}=e,[n,r,s,o]=i.subarray(t,t+4);return Math.sqrt(Math.pow(s-n,2)+Math.pow(o-r,2))}function OCt(e,t){const{positions:{size:i}}=e,n=i*e.pathIndices.value[t],r=i*e.pathIndices.value[t+1];let s=0;for(let o=n;o<r;o+=i)s+=DCt(e,o);return s}function LCt(e,t){const{positions:{value:i},pathIndices:{value:n}}=e,r=n[t]*2,s=(n[t+1]*2-r)/2;if(s===2){const[c,h,A,_]=i.subarray(r,r+4);return[(c+A)/2,(h+_)/2]}const o=r+Math.floor(s/2)*2;return[i[o],i[o+1]]}hg([xCt,CCt]);const FCt={...Up.defaultProps,autoLabels:!1,data:Ef,dataComparator:Ef.equal,tileSize:Yp};class hE extends Up{constructor(...t){super(...t)}initializeState(){super.initializeState(),this.setState({binary:!0})}updateState(t){const{props:i}=t;if(i.data){super.updateState(t);const n=new URL(i.data.tiles[0]).searchParams.get("formatTiles")==="mvt";this.setState({mvt:n})}}getLoadOptions(){const t=this.props.data;return $p(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${t.accessToken}`}},gis:{format:"binary"}})}async getTileData(t){const i=this.props.data,{tiles:n,properties_tiles:r}=i,s=pf(n,t);if(!s)return Promise.reject("Invalid URL");const o=this.getLoadOptions(),{fetch:c}=this.props,{signal:h}=t,A=c(s,{propName:"data",layer:this,loadOptions:o,signal:h});if(!r)return await A;const _=pf(r,t);if(!_)return Promise.reject("Invalid properties URL");const C=c(_,{propName:"data",layer:this,loadOptions:o,signal:h}),[S,L]=await Promise.all([A,C]);return S?L?jwt(S,L):S:null}renderSubLayers(t){if(t.data===null)return null;const i=t.tile.bbox,n=[],r={"points-text":{type:i_,...t?._subLayerProps?.["points-text"],extensions:[new DC,...t.extensions||[],...t?._subLayerProps?.["points-text"]?.extensions||[]]}};if(this.state.mvt)n.push(super.renderSubLayers(t));else{const{west:s,south:o,east:c,north:h}=i,A=[new Ov,...t.extensions||[]],_={clipBounds:[s,o,c,h]},C=L=>({[L]:{..._,...t?._subLayerProps?.[L],extensions:[...A,...t?._subLayerProps?.[L]?.extensions||[]]}}),S={...t,data:{...t.data,tileBbox:i},autoHighlight:!1,_subLayerProps:{...t._subLayerProps,...r,...C("polygons-fill"),...C("polygons-stroke"),...C("linestrings")}};n.push(new $l(S))}if(n[0]&&t.autoLabels){const s=Sk();t.data.lines&&t.data.lines.positions.value.length>0&&(s.points=TCt(t.data.lines,typeof t.autoLabels=="object"?t.autoLabels.uniqueIdProperty:void 0)),t.data.polygons&&t.data.polygons.positions.value.length>0&&(s.points=SCt(t.data.polygons,i,t)),n.push(n[0].clone({id:`${t.id}-labels`,data:s,pickable:!1,autoHighlight:!1}))}return n}renderLayers(){const t=super.renderLayers();if(!this.props.autoLabels)return t;const i=t.flat().filter(Boolean);return i.sort((n,r)=>{const s=n.id.includes("labels"),o=r.id.includes("labels");return s&&!o?1:!s&&o?-1:0}),i.map(n=>n.id.includes("labels")?n.clone({highlightedObjectIndex:-1}):n)}_isWGS84(){return this.state.mvt?super._isWGS84():!0}}hE.layerName="VectorTileLayer",hE.defaultProps=FCt;var Pn={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]}},kCt={2:["#ffc6c4","#672044"],3:["#ffc6c4","#cc607d","#672044"],4:["#ffc6c4","#e38191","#ad466c","#672044"],5:["#ffc6c4","#ee919b","#cc607d","#9e3963","#672044"],6:["#ffc6c4","#f29ca3","#da7489","#b95073","#93345d","#672044"],7:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],tags:["quantitative"]},NCt={2:["#fbe6c5","#70284a"],3:["#fbe6c5","#dc7176","#70284a"],4:["#fbe6c5","#ee8a82","#c8586c","#70284a"],5:["#fbe6c5","#f2a28a","#dc7176","#b24b65","#70284a"],6:["#fbe6c5","#f4b191","#e7807d","#d06270","#a44360","#70284a"],7:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],tags:["quantitative"]},UCt={2:["#f6d2a9","#b13f64"],3:["#f6d2a9","#ea8171","#b13f64"],4:["#f6d2a9","#f19c7c","#dd686c","#b13f64"],5:["#f6d2a9","#f3aa84","#ea8171","#d55d6a","#b13f64"],6:["#f6d2a9","#f4b28a","#ef9177","#e3726d","#cf5669","#b13f64"],7:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],tags:["quantitative"]},zCt={2:["#ecda9a","#ee4d5a"],3:["#ecda9a","#f7945d","#ee4d5a"],4:["#ecda9a","#f3ad6a","#f97b57","#ee4d5a"],5:["#ecda9a","#f1b973","#f7945d","#f86f56","#ee4d5a"],6:["#ecda9a","#f0c079","#f5a363","#f98558","#f76856","#ee4d5a"],7:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],tags:["quantitative"]},GCt={2:["#fde0c5","#eb4a40"],3:["#fde0c5","#f59e72","#eb4a40"],4:["#fde0c5","#f8b58b","#f2855d","#eb4a40"],5:["#fde0c5","#f9c098","#f59e72","#f17854","#eb4a40"],6:["#fde0c5","#fac7a1","#f7ac80","#f38f65","#f0704f","#eb4a40"],7:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],tags:["quantitative"]},jCt={2:["#fef6b5","#e15383"],3:["#fef6b5","#ffa679","#e15383"],4:["#fef6b5","#ffc285","#fa8a76","#e15383"],5:["#fef6b5","#ffd08e","#ffa679","#f67b77","#e15383"],6:["#fef6b5","#ffd795","#ffb77f","#fd9576","#f37378","#e15383"],7:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],tags:["quantitative"]},VCt={2:["#e4f1e1","#0d585f"],3:["#e4f1e1","#63a6a0","#0d585f"],4:["#e4f1e1","#89c0b6","#448c8a","#0d585f"],5:["#E4F1E1","#9CCDC1","#63A6A0","#337F7F","#0D585F"],6:["#e4f1e1","#abd4c7","#7ab5ad","#509693","#2c7778","#0d585f"],7:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],tags:["quantitative"]},HCt={2:["#c4e6c3","#1d4f60"],3:["#c4e6c3","#4da284","#1d4f60"],4:["#c4e6c3","#6dbc90","#36877a","#1d4f60"],5:["#c4e6c3","#80c799","#4da284","#2d7974","#1d4f60"],6:["#c4e6c3","#8dce9f","#5fb28b","#3e927e","#297071","#1d4f60"],7:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],tags:["quantitative"]},WCt={2:["#d2fbd4","#123f5a"],3:["#d2fbd4","#559c9e","#123f5a"],4:["#d2fbd4","#7bbcb0","#3a7c89","#123f5a"],5:["#d2fbd4","#8eccb9","#559c9e","#2b6c7f","#123f5a"],6:["#d2fbd4","#9cd5be","#6cafa9","#458892","#266377","#123f5a"],7:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],tags:["quantitative"]},JCt={2:["#d3f2a3","#074050"],3:["#d3f2a3","#4c9b82","#074050"],4:["#d3f2a3","#6cc08b","#217a79","#074050"],5:["#d3f2a3","#82d091","#4c9b82","#19696f","#074050"],6:["#d3f2a3","#8fda94","#60b187","#35877d","#145f69","#074050"],7:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],tags:["quantitative"]},XCt={2:["#245668","#EDEF5D"],3:["#245668","#39AB7E","#EDEF5D"],4:["#245668","#0D8F81","#6EC574","#EDEF5D"],5:["#245668","#04817E","#39AB7E","#8BD16D","#EDEF5D"],6:["#245668","#09787C","#1D9A81","#58BB79","#9DD869","#EDEF5D"],7:["#245668","#0F7279","#0D8F81","#39AB7E","#6EC574","#A9DC67","#EDEF5D"],tags:["aggregation"]},QCt={2:["#f7feae","#045275"],3:["#f7feae","#46aea0","#045275"],4:["#f7feae","#7ccba2","#089099","#045275"],5:["#f7feae","#9bd8a4","#46aea0","#058092","#045275"],6:["#f7feae","#ace1a4","#68bfa1","#2a9c9c","#02778e","#045275"],7:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],tags:["quantitative"]},KCt={2:["#d1eeea","#2a5674"],3:["#d1eeea","#68abb8","#2a5674"],4:["#d1eeea","#85c4c9","#4f90a6","#2a5674"],5:["#d1eeea","#96d0d1","#68abb8","#45829b","#2a5674"],6:["#d1eeea","#a1d7d6","#79bbc3","#599bae","#3f7994","#2a5674"],7:["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],tags:["quantitative"]},qCt={2:["#b0f2bc","#257d98"],3:["#b0f2bc","#4cc8a3","#257d98"],4:["#b0f2bc","#67dba5","#38b2a3","#257d98"],5:["#b0f2bc","#77e2a8","#4cc8a3","#31a6a2","#257d98"],6:["#b0f2bc","#82e6aa","#5bd4a4","#3fbba3","#2e9ea1","#257d98"],7:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],tags:["quantitative"]},ZCt={2:["#f3e0f7","#63589f"],3:["#f3e0f7","#b998dd","#63589f"],4:["#f3e0f7","#d1afe8","#9f82ce","#63589f"],5:["#f3e0f7","#dbbaed","#b998dd","#9178c4","#63589f"],6:["#f3e0f7","#e0c2ef","#c8a5e4","#aa8bd4","#8871be","#63589f"],7:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],tags:["quantitative"]},YCt={2:["#f9ddda","#573b88"],3:["#f9ddda","#ce78b3","#573b88"],4:["#f9ddda","#e597b9","#ad5fad","#573b88"],5:["#f9ddda","#eda8bd","#ce78b3","#9955a8","#573b88"],6:["#f9ddda","#f0b2c1","#dd8ab6","#bb69b0","#8c4fa4","#573b88"],7:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],tags:["quantitative"]},$Ct={2:["#f3e79b","#5c53a5"],3:["#f3e79b","#eb7f86","#5c53a5"],4:["#f3e79b","#f8a07e","#ce6693","#5c53a5"],5:["#f3e79b","#fab27f","#eb7f86","#b95e9a","#5c53a5"],6:["#f3e79b","#fabc82","#f59280","#dc6f8e","#ab5b9e","#5c53a5"],7:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],tags:["quantitative"]},tEt={2:["#f3cbd3","#6c2167"],3:["#f3cbd3","#ca699d","#6c2167"],4:["#f3cbd3","#dd88ac","#b14d8e","#6c2167"],5:["#f3cbd3","#e498b4","#ca699d","#a24186","#6c2167"],6:["#f3cbd3","#e7a2b9","#d67ba5","#bc5894","#983a81","#6c2167"],7:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],tags:["quantitative"]},eEt={2:["#fcde9c","#7c1d6f"],3:["#fcde9c","#e34f6f","#7c1d6f"],4:["#fcde9c","#f0746e","#dc3977","#7c1d6f"],5:["#fcde9c","#f58670","#e34f6f","#d72d7c","#7c1d6f"],6:["#fcde9c","#f89872","#ec666d","#df4273","#c5287b","#7c1d6f"],7:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],tags:["quantitative"]},iEt={2:["#4b2991","#edd9a3"],3:["#4b2991","#ea4f88","#edd9a3"],4:["#4b2991","#c0369d","#fa7876","#edd9a3"],5:["#4b2991","#a52fa2","#ea4f88","#fa9074","#edd9a3"],6:["#4b2991","#932da3","#d43f96","#f7667c","#f89f77","#edd9a3"],7:["#4b2991","#872ca2","#c0369d","#ea4f88","#fa7876","#f6a97a","#edd9a3"],tags:["aggregation"]},nEt={2:["#ede5cf","#541f3f"],3:["#ede5cf","#c1766f","#541f3f"],4:["#ede5cf","#d39c83","#a65461","#541f3f"],5:["#ede5cf","#daaf91","#c1766f","#95455a","#541f3f"],6:["#ede5cf","#ddba9b","#cd8c7a","#b26166","#8a3c56","#541f3f"],7:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],tags:["quantitative"]},rEt={2:["#929b4f","#db8195"],3:["#a3ad62","#fdfbe4","#df91a3"],4:["#929b4f","#d9dbaf","#f3d1ca","#db8195"],5:["#879043","#c1c68c","#fdfbe4","#ebb4b8","#d8758b"],6:["#7f883b","#b0b874","#e3e4be","#f6ddd1","#e4a0ac","#d66d85"],7:["#798234","#a3ad62","#d0d3a2","#fdfbe4","#f0c6c3","#df91a3","#d46780"],tags:["diverging"]},oEt={2:["#3d5941","#ca562c"],3:["#3d5941","#f6edbd","#ca562c"],4:["#3d5941","#b5b991","#edbb8a","#ca562c"],5:["#3d5941","#96a07c","#f6edbd","#e6a272","#ca562c"],6:["#3d5941","#839170","#cecea2","#f1cf9e","#e19464","#ca562c"],7:["#3d5941","#778868","#b5b991","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},sEt={2:["#008080","#ca562c"],3:["#008080","#f6edbd","#ca562c"],4:["#008080","#b4c8a8","#edbb8a","#ca562c"],5:["#008080","#92b69e","#f6edbd","#e6a272","#ca562c"],6:["#008080","#7eab98","#ced7b1","#f1cf9e","#e19464","#ca562c"],7:["#008080","#70a494","#b4c8a8","#f6edbd","#edbb8a","#de8a5a","#ca562c"],tags:["diverging"]},aEt={2:["#009392","#cf597e"],3:["#009392","#e9e29c","#cf597e"],4:["#009392","#9ccb86","#eeb479","#cf597e"],5:["#009392","#71be83","#e9e29c","#ed9c72","#cf597e"],6:["#009392","#52b684","#bcd48c","#edc783","#eb8d71","#cf597e"],7:["#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"],tags:["diverging"]},cEt={2:["#009392","#d0587e"],3:["#009392","#f1eac8","#d0587e"],4:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],5:["#009392","#91b8aa","#f1eac8","#dfa0a0","#d0587e"],6:["#009392","#72aaa1","#b1c7b3","#e5b9ad","#d98994","#d0587e"],7:["#009392","#72aaa1","#b1c7b3","#f1eac8","#e5b9ad","#d98994","#d0587e"],tags:["diverging"]},lEt={2:["#009B9E","#C75DAB"],3:["#009B9E","#F1F1F1","#C75DAB"],4:["#009B9E","#A7D3D4","#E4C1D9","#C75DAB"],5:["#009B9E","#7CC5C6","#F1F1F1","#DDA9CD","#C75DAB"],6:["#009B9E","#5DBCBE","#C6DFDF","#E9D4E2","#D99BC6","#C75DAB"],7:["#009B9E","#42B7B9","#A7D3D4","#F1F1F1","#E4C1D9","#D691C1","#C75DAB"],tags:["diverging"]},uEt={2:["#A16928","#2887a1"],3:["#A16928","#edeac2","#2887a1"],4:["#A16928","#d6bd8d","#b5c8b8","#2887a1"],5:["#A16928","#caa873","#edeac2","#98b7b2","#2887a1"],6:["#A16928","#c29b64","#e0cfa2","#cbd5bc","#85adaf","#2887a1"],7:["#A16928","#bd925a","#d6bd8d","#edeac2","#b5c8b8","#79a7ac","#2887a1"],tags:["diverging"]},hEt={2:["#855C75","#D9AF6B","#7C7C7C"],3:["#855C75","#D9AF6B","#AF6458","#7C7C7C"],4:["#855C75","#D9AF6B","#AF6458","#736F4C","#7C7C7C"],5:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#7C7C7C"],6:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#7C7C7C"],7:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#7C7C7C"],8:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#7C7C7C"],9:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#7C7C7C"],10:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#7C7C7C"],11:["#855C75","#D9AF6B","#AF6458","#736F4C","#526A83","#625377","#68855C","#9C9C5E","#A06177","#8C785D","#467378","#7C7C7C"],tags:["qualitative"]},fEt={2:["#7F3C8D","#11A579","#A5AA99"],3:["#7F3C8D","#11A579","#3969AC","#A5AA99"],4:["#7F3C8D","#11A579","#3969AC","#F2B701","#A5AA99"],5:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#A5AA99"],6:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#A5AA99"],7:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#A5AA99"],8:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#A5AA99"],9:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#A5AA99"],10:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#A5AA99"],11:["#7F3C8D","#11A579","#3969AC","#F2B701","#E73F74","#80BA5A","#E68310","#008695","#CF1C90","#f97b72","#4b4b8f","#A5AA99"],tags:["qualitative"]},dEt={2:["#66C5CC","#F6CF71","#B3B3B3"],3:["#66C5CC","#F6CF71","#F89C74","#B3B3B3"],4:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#B3B3B3"],5:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#B3B3B3"],6:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#B3B3B3"],7:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#B3B3B3"],8:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#B3B3B3"],9:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B3B3B3"],10:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#B3B3B3"],11:["#66C5CC","#F6CF71","#F89C74","#DCB0F2","#87C55F","#9EB9F3","#FE88B1","#C9DB74","#8BE0A4","#B497E7","#D3B484","#B3B3B3"],tags:["qualitative"]},pEt={2:["#5F4690","#1D6996","#666666"],3:["#5F4690","#1D6996","#38A6A5","#666666"],4:["#5F4690","#1D6996","#38A6A5","#0F8554","#666666"],5:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#666666"],6:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#666666"],7:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#666666"],8:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#666666"],9:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#666666"],10:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#666666"],11:["#5F4690","#1D6996","#38A6A5","#0F8554","#73AF48","#EDAD08","#E17C05","#CC503E","#94346E","#6F4070","#994E95","#666666"],tags:["qualitative"]},AEt={2:["#88CCEE","#CC6677","#888888"],3:["#88CCEE","#CC6677","#DDCC77","#888888"],4:["#88CCEE","#CC6677","#DDCC77","#117733","#888888"],5:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#888888"],6:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#888888"],7:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#888888"],8:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#888888"],9:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#888888"],10:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#888888"],11:["#88CCEE","#CC6677","#DDCC77","#117733","#332288","#AA4499","#44AA99","#999933","#882255","#661100","#6699CC","#888888"],tags:["qualitative","colorblind"]},gEt={2:["#E58606","#5D69B1","#A5AA99"],3:["#E58606","#5D69B1","#52BCA3","#A5AA99"],4:["#E58606","#5D69B1","#52BCA3","#99C945","#A5AA99"],5:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#A5AA99"],6:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#A5AA99"],7:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#A5AA99"],8:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#A5AA99"],9:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#A5AA99"],10:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#A5AA99"],11:["#E58606","#5D69B1","#52BCA3","#99C945","#CC61B0","#24796C","#DAA51B","#2F8AC4","#764E9F","#ED645A","#CC3A8E","#A5AA99"],tags:["qualitative"]},mEt={...Pn.BuGn,tags:["quantitative"]},yEt={...Pn.BuPu,tags:["quantitative"]},vEt={...Pn.GnBu,tags:["quantitative"]},_Et={...Pn.OrRd,tags:["quantitative"]},bEt={...Pn.PuBu,tags:["quantitative"]},xEt={...Pn.PuBuGn,tags:["quantitative"]},wEt={...Pn.PuRd,tags:["quantitative"]},CEt={...Pn.RdPu,tags:["quantitative"]},EEt={...Pn.YlGn,tags:["quantitative"]},BEt={...Pn.YlGnBu,tags:["quantitative"]},TEt={...Pn.YlOrBr,tags:["quantitative"]},SEt={...Pn.YlOrRd,tags:["quantitative"]},IEt={...Pn.Accent,tags:["qualitative"]},MEt={...Pn.Dark2,tags:["qualitative"]},PEt={...Pn.Paired,tags:["qualitative"]},REt={...Pn.Pastel1,tags:["qualitative"]},DEt={...Pn.Pastel2,tags:["qualitative"]},OEt={...Pn.Set1,tags:["qualitative"]},LEt={...Pn.Set2,tags:["qualitative"]},FEt={...Pn.Set3,tags:["qualitative"]},kEt={...Pn.Blues,tags:["quantitative"]},NEt={...Pn.Greens,tags:["quantitative"]},UEt={...Pn.Greys,tags:["quantitative"]},zEt={...Pn.Oranges,tags:["quantitative"]},GEt={...Pn.Purples,tags:["quantitative"]},jEt={...Pn.Reds,tags:["quantitative"]},VEt={...Pn.BrBG,tags:["diverging"]},HEt={...Pn.PiYG,tags:["diverging"]},WEt={...Pn.PRGn,tags:["diverging"]},JEt={...Pn.PuOr,tags:["diverging"]},XEt={...Pn.RdBu,tags:["diverging"]},QEt={...Pn.RdGy,tags:["diverging"]},KEt={...Pn.RdYlBu,tags:["diverging"]},qEt={...Pn.RdYlGn,tags:["diverging"]},ZEt={...Pn.Spectral,tags:["diverging"]};const YEt=Object.freeze(Object.defineProperty({__proto__:null,Antique:hEt,ArmyRose:rEt,BluGrn:HCt,BluYl:QCt,Bold:fEt,BrwnYl:nEt,Burg:kCt,BurgYl:NCt,DarkMint:WCt,Earth:uEt,Emrld:JCt,Fall:oEt,Geyser:sEt,Magenta:tEt,Mint:VCt,OrYel:zCt,Pastel:dEt,Peach:GCt,PinkYl:jCt,Prism:pEt,Purp:ZCt,PurpOr:YCt,RedOr:UCt,Safe:AEt,Sunset:$Ct,SunsetDark:eEt,Teal:KCt,TealGrn:qCt,TealRose:cEt,Temps:aEt,Tropic:lEt,Vivid:gEt,ag_GrnYl:XCt,ag_Sunset:iEt,cb_Accent:IEt,cb_Blues:kEt,cb_BrBG:VEt,cb_BuGn:mEt,cb_BuPu:yEt,cb_Dark2:MEt,cb_GnBu:vEt,cb_Greens:NEt,cb_Greys:UEt,cb_OrRd:_Et,cb_Oranges:zEt,cb_PRGn:WEt,cb_Paired:PEt,cb_Pastel1:REt,cb_Pastel2:DEt,cb_PiYG:HEt,cb_PuBu:bEt,cb_PuBuGn:xEt,cb_PuOr:JEt,cb_PuRd:wEt,cb_Purples:GEt,cb_RdBu:XEt,cb_RdGy:QEt,cb_RdPu:CEt,cb_RdYlBu:KEt,cb_RdYlGn:qEt,cb_Reds:jEt,cb_Set1:OEt,cb_Set2:LEt,cb_Set3:FEt,cb_Spectral:ZEt,cb_YlGn:EEt,cb_YlGnBu:BEt,cb_YlOrBr:TEt,cb_YlOrRd:SEt},Symbol.toStringTag,{value:"Module"})),fE="PurpOr",dE=[204,204,204],$Et=[119,119,119];function pE(e,t){const i=YEt[e];let n=t;Cf(i,`Palette "${e}" not found. Expected a CARTOColors string`);const r=Object.keys(i).filter(h=>h!=="tags").map(Number),s=Math.max(...r),o=Math.min(...r);!Number.isInteger(t)||t>s?n=s:t<o&&(n=o);let c=i[n];return i.tags&&i.tags.includes("qualitative")&&(c=c.slice(0,-1)),c.map(h=>t3t(h))}function t3t(e){let t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e);return t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),255]:(t=/^#?([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})([a-f\d]{1})$/i.exec(e),t?[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),parseInt(t[4]+t[4],16)]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),255]:(t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),Cf(t,`Hexadecimal color "${e}" was not parsed correctly`),[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16)])))}const e3t=Object.freeze(["function","string"]);function AE(e,t,i){return Cf(typeof t=="object",'Expected "data" to be an object'),Cf(e3t.includes(typeof e),'Expected "attr" to be a function or string'),typeof e=="function"?e(t,i):t?.properties?.[e]}function i3t({attr:e,domain:t,colors:i=fE,nullColor:n=dE}){Cf(Array.isArray(t),'Expected "domain" to be an array of numbers');const r=typeof i=="string"?pE(i,t.length+1):i,s=mU().domain(t).range(r);return(o,c)=>{const h=AE(e,o,c);return typeof h=="number"&&Number.isFinite(h)?s(h):n}}function n3t({attr:e,domain:t,colors:i=fE,nullColor:n=dE,othersColor:r=$Et}){Cf(Array.isArray(t),'Expected "domain" to be an array of numbers or strings');const s={},o=typeof i=="string"?pE(i,t.length):i;for(const[c,h]of t.entries())s[h]=o[c];return(c,h)=>{const A=AE(e,c,h);return typeof A=="number"&&Number.isFinite(A)||typeof A=="string"?s[A]||r:n}}function r3t({attr:e,domain:t,colors:i=fE,nullColor:n=dE}){Cf(Array.isArray(t),'Expected "domain" to be an array of numbers');const r=typeof i=="string"?pE(i,t.length):i,s=yU().domain(t).range(r);return(o,c)=>{const h=AE(e,o,c);return typeof h=="number"&&Number.isFinite(h)?s(h):n}}const o3t={ClusterTileLayer:iE,H3TileLayer:rE,HeatmapTileLayer:aE,PointLabelLayer:i_,QuadbinTileLayer:e_,RasterTileLayer:uE,VectorTileLayer:hE};function gE(e,t=""){if(!e)throw new Error(`JSON conversion error ${t}`)}function s3t(e,t){const i=c3t(t);let n=e;for(const r of i)n=a3t(n)?n[r]:void 0;return n}function a3t(e){return e!==null&&typeof e=="object"}const h9={};function c3t(e){if(typeof e=="string"){let t=h9[e];return t||(t=e.split("."),h9[e]=t),t}return Array.isArray(e)?e:[e]}var mE={exports:{}},f9;function l3t(){return f9||(f9=1,function(e,t){(function(i){var n="Compound",r="Identifier",s="MemberExpression",o="Literal",c="ThisExpression",h="CallExpression",A="UnaryExpression",_="BinaryExpression",C="LogicalExpression",S="ConditionalExpression",L="ArrayExpression",N=46,U=44,H=39,j=34,tt=40,K=41,Q=91,pt=93,$=63,zt=59,Gt=58,dt=function(Se,oe){var Ai=new Error(Se+" at character "+oe);throw Ai.index=oe,Ai.description=Se,Ai},lt=!0,Lt={"-":lt,"!":lt,"~":lt,"+":lt},J={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},ut=function(Se){var oe=0,Ai;for(var Ke in Se)(Ai=Ke.length)>oe&&Se.hasOwnProperty(Ke)&&(oe=Ai);return oe},Et=ut(Lt),le=ut(J),Ct={true:!0,false:!1,null:null},Rt="this",Nt=function(Se){return J[Se]||0},Zt=function(Se,oe,Ai){var Ke=Se==="||"||Se==="&&"?C:_;return{type:Ke,operator:Se,left:oe,right:Ai}},re=function(Se){return Se>=48&&Se<=57},se=function(Se){return Se===36||Se===95||Se>=65&&Se<=90||Se>=97&&Se<=122||Se>=128&&!J[String.fromCharCode(Se)]},de=function(Se){return Se===36||Se===95||Se>=65&&Se<=90||Se>=97&&Se<=122||Se>=48&&Se<=57||Se>=128&&!J[String.fromCharCode(Se)]},Me=function(Se){for(var oe=0,Ai=Se.charAt,Ke=Se.charCodeAt,qe=function(Ge){return Ai.call(Se,Ge)},Ve=function(Ge){return Ke.call(Se,Ge)},di=Se.length,cn=function(){for(var Ge=Ve(oe);Ge===32||Ge===9||Ge===10||Ge===13;)Ge=Ve(++oe)},Ri=function(){var Ge=Vn(),gi,Mi;if(cn(),Ve(oe)===$){if(oe++,gi=Ri(),gi||dt("Expected expression",oe),cn(),Ve(oe)===Gt)return oe++,Mi=Ri(),Mi||dt("Expected expression",oe),{type:S,test:Ge,consequent:gi,alternate:Mi};dt("Expected :",oe)}else return Ge},bi=function(){cn();for(var Ge=Se.substr(oe,le),gi=Ge.length;gi>0;){if(J.hasOwnProperty(Ge)&&(!se(Ve(oe))||oe+Ge.length<Se.length&&!de(Ve(oe+Ge.length))))return oe+=gi,Ge;Ge=Ge.substr(0,--gi)}return!1},Vn=function(){var Ge,gi,Mi,rn,yr,St,ke,Je,li;if(St=yi(),gi=bi(),!gi)return St;for(yr={value:gi,prec:Nt(gi)},ke=yi(),ke||dt("Expected expression after "+gi,oe),rn=[St,yr,ke];(gi=bi())&&(Mi=Nt(gi),Mi!==0);){for(yr={value:gi,prec:Mi},li=gi;rn.length>2&&Mi<=rn[rn.length-2].prec;)ke=rn.pop(),gi=rn.pop().value,St=rn.pop(),Ge=Zt(gi,St,ke),rn.push(Ge);Ge=yi(),Ge||dt("Expected expression after "+li,oe),rn.push(yr,Ge)}for(Je=rn.length-1,Ge=rn[Je];Je>1;)Ge=Zt(rn[Je-1].value,rn[Je-2],Ge),Je-=2;return Ge},yi=function(){var Ge,gi,Mi;if(cn(),Ge=Ve(oe),re(Ge)||Ge===N)return vi();if(Ge===H||Ge===j)return un();if(Ge===Q)return ir();for(gi=Se.substr(oe,Et),Mi=gi.length;Mi>0;){if(Lt.hasOwnProperty(gi)&&(!se(Ve(oe))||oe+gi.length<Se.length&&!de(Ve(oe+gi.length))))return oe+=Mi,{type:A,operator:gi,argument:yi(),prefix:!0};gi=gi.substr(0,--Mi)}return se(Ge)||Ge===tt?Yn():!1},vi=function(){for(var Ge="",gi,Mi;re(Ve(oe));)Ge+=qe(oe++);if(Ve(oe)===N)for(Ge+=qe(oe++);re(Ve(oe));)Ge+=qe(oe++);if(gi=qe(oe),gi==="e"||gi==="E"){for(Ge+=qe(oe++),gi=qe(oe),(gi==="+"||gi==="-")&&(Ge+=qe(oe++));re(Ve(oe));)Ge+=qe(oe++);re(Ve(oe-1))||dt("Expected exponent ("+Ge+qe(oe)+")",oe)}return Mi=Ve(oe),se(Mi)?dt("Variable names cannot start with a number ("+Ge+qe(oe)+")",oe):Mi===N&&dt("Unexpected period",oe),{type:o,value:parseFloat(Ge),raw:Ge}},un=function(){for(var Ge="",gi=qe(oe++),Mi=!1,rn;oe<di;)if(rn=qe(oe++),rn===gi){Mi=!0;break}else if(rn==="\\")switch(rn=qe(oe++),rn){case"n":Ge+=`
`;break;case"r":Ge+="\r";break;case"t":Ge+="	";break;case"b":Ge+="\b";break;case"f":Ge+="\f";break;case"v":Ge+="\v";break;default:Ge+=rn}else Ge+=rn;return Mi||dt('Unclosed quote after "'+Ge+'"',oe),{type:o,value:Ge,raw:gi+Ge+gi}},Di=function(){var Ge=Ve(oe),gi=oe,Mi;for(se(Ge)?oe++:dt("Unexpected "+qe(oe),oe);oe<di&&(Ge=Ve(oe),de(Ge));)oe++;return Mi=Se.slice(gi,oe),Ct.hasOwnProperty(Mi)?{type:o,value:Ct[Mi],raw:Mi}:Mi===Rt?{type:c}:{type:r,name:Mi}},lr=function(Ge){for(var gi,Mi=[],rn,yr=!1,St=0;oe<di;)if(cn(),gi=Ve(oe),gi===Ge){yr=!0,oe++,Ge===K&&St&&St>=Mi.length&&dt("Unexpected token "+String.fromCharCode(Ge),oe);break}else if(gi===U){if(oe++,St++,St!==Mi.length){if(Ge===K)dt("Unexpected token ,",oe);else if(Ge===pt)for(var ke=Mi.length;ke<St;ke++)Mi.push(null)}}else rn=Ri(),(!rn||rn.type===n)&&dt("Expected comma",oe),Mi.push(rn);return yr||dt("Expected "+String.fromCharCode(Ge),oe),Mi},Yn=function(){var Ge,gi;for(Ge=Ve(oe),Ge===tt?gi=mn():gi=Di(),cn(),Ge=Ve(oe);Ge===N||Ge===Q||Ge===tt;)oe++,Ge===N?(cn(),gi={type:s,computed:!1,object:gi,property:Di()}):Ge===Q?(gi={type:s,computed:!0,object:gi,property:Ri()},cn(),Ge=Ve(oe),Ge!==pt&&dt("Unclosed [",oe),oe++):Ge===tt&&(gi={type:h,arguments:lr(K),callee:gi}),cn(),Ge=Ve(oe);return gi},mn=function(){oe++;var Ge=Ri();if(cn(),Ve(oe)===K)return oe++,Ge;dt("Unclosed (",oe)},ir=function(){return oe++,{type:L,elements:lr(pt)}},Hn=[],Tn,$n;oe<di;)Tn=Ve(oe),Tn===zt||Tn===U?oe++:($n=Ri())?Hn.push($n):oe<di&&dt('Unexpected "'+qe(oe)+'"',oe);return Hn.length===1?Hn[0]:{type:n,body:Hn}};Me.version="0.3.5",Me.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Me.version},Me.addUnaryOp=function(Se){return Et=Math.max(Se.length,Et),Lt[Se]=lt,this},Me.addBinaryOp=function(Se,oe){return le=Math.max(Se.length,le),J[Se]=oe,this},Me.addLiteral=function(Se,oe){return Ct[Se]=oe,this},Me.removeUnaryOp=function(Se){return delete Lt[Se],Se.length===Et&&(Et=ut(Lt)),this},Me.removeAllUnaryOps=function(){return Lt={},Et=0,this},Me.removeBinaryOp=function(Se){return delete J[Se],Se.length===le&&(le=ut(J)),this},Me.removeAllBinaryOps=function(){return J={},le=0,this},Me.removeLiteral=function(Se){return delete Ct[Se],this},Me.removeAllLiterals=function(){return Ct={},this},e.exports?t=e.exports=Me:t.parse=Me})()}(mE,mE.exports)),mE.exports}var u3t=l3t();const h3t=zh(u3t),d9={"||":(e,t)=>e||t,"&&":(e,t)=>e&&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"&":(e,t)=>e&t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"<":(e,t)=>e<t,">":(e,t)=>e>t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t},f3t={"-":e=>-e,"+":e=>+e,"~":e=>~e,"!":e=>!e};function p9(e,t){return e.map(function(i){return es(i,t)})}function A9(e,t){const i=es(e.object,t);let n;if(e.computed?n=es(e.property,t):n=e.property.name,/^__proto__|prototype|constructor$/.test(n))throw Error(`Access to member "${n}" disallowed.`);return[i,i[n]]}function es(e,t){const i=e;switch(i.type){case"ArrayExpression":return p9(i.elements,t);case"BinaryExpression":return d9[i.operator](es(i.left,t),es(i.right,t));case"CallExpression":let n,r,s;return i.callee.type==="MemberExpression"?(s=A9(i.callee,t),n=s[0],r=s[1]):r=es(i.callee,t),typeof r!="function"?void 0:r.apply(n,p9(i.arguments,t));case"ConditionalExpression":return es(i.test,t)?es(i.consequent,t):es(i.alternate,t);case"Identifier":return t[i.name];case"Literal":return i.value;case"LogicalExpression":return i.operator==="||"?es(i.left,t)||es(i.right,t):i.operator==="&&"?es(i.left,t)&&es(i.right,t):d9[i.operator](es(i.left,t),es(i.right,t));case"MemberExpression":return A9(i,t)[1];case"ThisExpression":return t;case"UnaryExpression":return f3t[i.operator](es(i.argument,t));default:return}}const yE={"-":e=>e};function g9(e,t){if(e in yE)return yE[e];let i;const n=h3t(e);return n.type==="Identifier"?i=r=>s3t(r,e):(vE(n,r=>{if(r.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),i=r=>es(n,r)),yE[e]=i,i}function vE(e,t){if(Array.isArray(e))e.forEach(i=>vE(i,t));else if(e&&typeof e=="object"){e.type&&t(e);for(const i in e)vE(e[i],t)}}const n_="@@=",m9="@@#",d3t="@@type",y9="@@function",v9=e=>e&&typeof e=="object";class _E{constructor(...t){this.typeKey=d3t,this.functionKey=y9,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=g9,this.preProcessClassProps=(i,n)=>n,this.postProcessConvertedJson=i=>i;for(const i of t)this.merge(i)}merge(t){for(const i in t)switch(i){case"layers":case"views":Object.assign(this.classes,t[i]);break;default:if(i in this){const n=t[i];this[i]=v9(this[i])?Object.assign(this[i],n):n}}}validate(t){return gE(!this.typeKey||typeof this.typeKey=="string"),gE(v9(this.classes)),!0}}function p3t(e){return typeof e=="string"&&e.startsWith(n_)}function A3t(e){return e.replace(n_,"")}function _9(e,t){const i={};for(const n in e){let r=e[n];p3t(r)&&(r=A3t(r),r=g9(r)),i[n]=r}return i}function g3t(e,t,i){const n=i.classes[e],r=i.reactComponents[e];if(!n&&!r){const{log:s}=i;if(s){const o=JSON.stringify(t,null,0).slice(0,40);s.warn(`JSON converter: No registered class of type ${e}(${o}...)  `)}return null}return n?m3t(n,t,i):y3t(r,t,i)}function m3t(e,t,i){return i.preProcessClassProps&&(t=i.preProcessClassProps(e,t,i)),t=_9(t),new e(t)}function y3t(e,t,i){const{React:n}=i,{children:r=[]}=t;return delete t.children,i.preProcessClassProps&&(t=i.preProcessClassProps(e,t,i)),t=_9(t),n.createElement(e,t,r)}function v3t(e,t,i){const n=i.functions[e];if(!n){const{log:r}=i;if(r){const s=JSON.stringify(t,null,0).slice(0,40);r.warn(`JSON converter: No registered function ${e}(${s}...)  `)}return null}return n(t)}function _3t(e){return typeof e=="string"?JSON.parse(e):e}const bE=e=>e&&typeof e=="object";class b3t{constructor(t){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(t)}finalize(){}setProps(t){"configuration"in t&&(this.configuration=t.configuration instanceof _E?t.configuration:new _E(t.configuration)),"onJSONChange"in t&&(this.onJSONChange=t.onJSONChange)}mergeConfiguration(t){this.configuration.merge(t)}convert(t){if(!t||t===this.json)return this.convertedJson;this.json=t;const i=_3t(t);let n=x3t(i,this.configuration);return n=this.configuration.postProcessConvertedJson(n),this.convertedJson=n,n}convertJson(t){return this.convert(t)}}function x3t(e,t){return t=new _E(t),xE(e,"",t)}function xE(e,t,i){return Array.isArray(e)?e.map((n,r)=>xE(n,String(r),i)):w3t(e,i)?C3t(e,i):bE(e)?y9 in e?E3t(e,i):wE(e,i):typeof e=="string"?B3t(e,t,i):e}function w3t(e,t){const{typeKey:i}=t;return bE(e)&&!!e[i]}function C3t(e,t){const{typeKey:i}=t,n=e[i];let r={...e};return delete r[i],r=wE(r,t),g3t(n,r,t)}function E3t(e,t){const{functionKey:i}=t,n=e[i];let r={...e};return delete r[i],r=wE(r,t),v3t(n,r,t)}function wE(e,t){gE(bE(e));const i={};for(const n in e){const r=e[n];i[n]=xE(r,n,t)}return i}function B3t(e,t,i){if(e.startsWith(n_)&&i.convertFunction)return e=e.replace(n_,""),i.convertFunction(e,i);if(e.startsWith(m9)){if(e=e.replace(m9,""),i.constants[e])return i.constants[e];const[n,r]=e.split(".");return i.enumerations[n][r]}return e}const T3t={classes:{...Eut,...bwt,...K2t,...S0t,...o3t},functions:{colorBins:i3t,colorCategories:n3t,colorContinuous:r3t}},b9=new b3t({configuration:T3t}),S3t={[kv.layerName]:["getFillColor"],[iv.layerName]:["getFillColor"],[gl.layerName]:["getFillColor"],[Up.layerName]:["getFillColor"],[Vy.layerName]:["getFillColor"],[jy.layerName]:["getFillColor"],[Zy.layerName]:["getColor"],[Bg.layerName]:["getTargetColor","getSourceColor"],[hl.layerName]:["getFillColor"],[$l.layerName]:["getFillColor"],[fp.layerName]:["getColor"],[by.layerName]:["getColor"],[ih.layerName]:["getColor"],[Sg.layerName]:["getColor"],[oh.layerName]:["getFillColor"],[Ig.layerName]:["getFillColor","getColor","getLineColor"],[rh.layerName]:["getFillColor"],[hf.layerName]:["getColor"],[Jg.layerName]:["getColor"],[Af.layerName]:["getColor"]},I3t=({object:e,objectInfo:t,originalFillFunction:i})=>{const n=typeof i=="function"?i(e,t):i;if(Array.isArray(n))return[n[0]||0,n[1]||0,n[2]||0,n[3]||255];if(typeof n=="string"&&n.startsWith("@@=")){const r=b9.convert({originalColor:n}).originalColor(e);return[r[0]||0,r[1]||0,r[2]||0,r[3]||255]}return null},x9=({isSelected:e,object:t,objectInfo:i,opacity:n,originalFillFunction:r})=>{const s=I3t({object:t,objectInfo:i,originalFillFunction:r});if(!s)return null;let o=0;return e?o=Math.max(typeof s[3]=="number"?s[3]:n,n):o=Math.min(typeof s[3]=="number"?s[3]:n,n),[s[0]||0,s[1]||0,s[2]||0,o]},M3t=({isSelected:e,object:t,objectInfo:i,originalFillFunction:n,selectedColor:r,selectedOpacity:s=255,unselectedColor:o,unselectedOpacity:c=Math.floor(255*.4)})=>e?x9({opacity:s,isSelected:!0,object:t,objectInfo:i,originalFillFunction:n})||r:x9({opacity:c,isSelected:!1,object:t,objectInfo:i,originalFillFunction:n})||o,tm={selection:{indices:{},objects:{}}},w9=(e,t)=>{const i=t.match(/{(.*?)}/g);return i&&i.forEach(n=>{const r=n.substring(1,n.length-1);Object.hasOwn(e.object,r)?t=t.replace(n,e.object[r]):Object.hasOwn(e.object,"properties")&&Object.hasOwn(e.object.properties,r)&&(t=t.replace(n,e.object.properties[r]))}),t};function P3t(e,t){return t.id?e.getElementState(t.id,"selection")??tm:tm}function R3t(e,t){if(!t.id)return tm;const i=e.getStringValue(t);return(i?G_.parse(i):null)??tm}function D3t(e,t,i,n){e.id&&t.setStringValue(e,JSON.stringify(i.value),{fromUi:i.fromUi},n)}const O3t=e=>{const{height:t,width:i,expanded:n}=yB(bB),{element:r,fragmentId:s,isLightTheme:o,theme:c,widgetMgr:h}=e,{selectionMode:A,tooltip:_,useContainerWidth:C}=r,S=n??!1,[L,N]=gU({element:r,getDefaultState:P3t,getStateFromWidgetMgr:R3t,updateWidgetMgrState:D3t,widgetMgr:h,fragmentId:s}),[U,H]=Te.useState(null),{height:j,width:tt}=hct({element:r,isFullScreen:S,shouldUseContainerWidth:C,container:{height:t,width:i},heightFallback:U?.initialViewState?.height||c.sizes.defaultMapHeight}),[K,Q]=Te.useState(null),pt=A[0],$=pt!==void 0,zt=$&&Object.keys(L.selection.indices).length>0,Gt=Te.useMemo(()=>Object.freeze(G_.parse(r.json)),[S,o,r.json]),dt=Te.useMemo(()=>{const J={...Gt};if(J.mapStyle||(J.mapStyle=o?"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json":"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json"),(J?.mapProvider=="carto"||J?.mapStyle&&J.mapStyle?.indexOf("cartocdn")>=0)&&!J.cartoKey&&(J.cartoKey="x7g2plm9yq8vfrc"),J.layers){const ut=Object.values(L.selection.indices).some(le=>le?.length),Et=J.layers.some(le=>Object.hasOwn(le,"pickable"));J.layers=J.layers.map(le=>{if(!le||Array.isArray(le)||!$)return le;Et||(le.pickable=!0);const Ct=`${le.id||null}`,Rt=L?.selection?.indices?.[Ct]||[],Nt=S3t[le["@@type"]];if(!Nt)return le;const Zt={...le};return Nt.forEach(re=>{Zt.updateTriggers={[re]:[...Zt.updateTriggers?.[re]||[],Rt,ut]};const se=!ut,de=le[re];if(se||!de)return Zt;const Me=255,Se=Math.floor(255*.4),oe=vB(c.colors.primary),Ai=[oe[0],oe[1],oe[2],Me],Ke=vB(c.colors.gray20),qe=[Ke[0],Ke[1],Ke[2],Se],Ve=(di,cn)=>M3t({isSelected:Rt.includes(cn.index),object:di,objectInfo:cn,originalFillFunction:de,selectedColor:Ai,unselectedColor:qe,selectedOpacity:Me,unselectedOpacity:Se});Zt[re]=Ve}),Zt})}return delete J?.views,b9.convert(J)},[L.selection.indices,o,$,Gt,c.colors.gray20,c.colors.primary]);Te.useEffect(()=>{if(!cU(dt.initialViewState,K)){const J=Object.keys(dt.initialViewState).reduce((ut,Et)=>dt.initialViewState[Et]===K?.[Et]?ut:{...ut,[Et]:dt.initialViewState[Et]},{});H(ut=>({...ut,...J})),Q(dt.initialViewState)}},[dt.initialViewState,K,U]);const lt=Te.useCallback(J=>{if(!J||!J.object||!_)return null;const ut=G_.parse(_);return ut.html?ut.html=w9(J,ut.html):ut.text=w9(J,ut.text),ut},[_]),Lt=Te.useCallback(({viewState:J})=>{H(J)},[H]);return{createTooltip:lt,data:L,deck:dt,hasActiveSelection:zt,height:j,isSelectionModeActivated:$,onViewStateChange:Lt,selectionMode:pt,setSelection:N,viewState:U,width:tt}};hg([c2,P2]);const CE=tm.selection,L3t=[],F3t=e=>{const{disabled:t,disableFullscreenMode:i,element:n,fragmentId:r,widgetMgr:s}=e,{libConfig:o}=Te.useContext(lU),c=uU(),{expanded:h,expand:A,collapse:_}=yB(bB),{createTooltip:C,data:S,deck:L,hasActiveSelection:N,height:U,isSelectionModeActivated:H,onViewStateChange:j,selectionMode:tt,setSelection:K,viewState:Q,width:pt}=O3t({element:n,fragmentId:r,isLightTheme:mB(c),theme:c,widgetMgr:s}),$=n.mapboxToken||o.mapboxToken,zt=L.mapProvider=="mapbox"||L?.mapStyle&&L.mapStyle?.indexOf("mapbox")>=0,[Gt,dt]=Te.useState(!1);Te.useEffect(()=>{dt(!0)},[]);const lt=Te.useCallback(J=>{if(tt===void 0)return;const{index:ut,object:Et}=J,le=`${J.layer?.id||null}`,Ct=S,Rt=ut===-1,Nt=(()=>{if(Rt)return CE;switch(tt){case _B.SelectionMode.SINGLE_OBJECT:return Ct.selection.indices[le]?.[0]===ut?CE:{indices:{[`${le}`]:[ut]},objects:{[`${le}`]:[Et]}};case _B.SelectionMode.MULTI_OBJECT:{const Zt=new Map((Ct?.selection?.indices?.[le]||[]).map((re,se)=>[re,Ct.selection?.objects?.[le]?.[se]]));if(Zt.has(ut)?Zt.delete(ut):Zt.set(ut,Et),Zt.size===0){const{[le]:re,...se}=Ct.selection.indices,{[le]:de,...Me}=Ct.selection.objects;return{indices:se,objects:Me}}return{indices:{...Ct.selection.indices,[`${le}`]:Array.from(Zt.keys())},objects:{...Ct.selection.objects,[`${le}`]:Array.from(Zt.values())}}}default:throw hU(tt),new Error("Invalid selection mode")}})();JSON.stringify(Nt)!==JSON.stringify(Ct.selection)&&K({fromUi:!0,value:{selection:Nt}})},[tt,S,K]),Lt=Te.useCallback(()=>{K({value:{selection:CE},fromUi:!0})},[K]);return Yc.jsxs($D,{className:"stDeckGlJsonChart","data-testid":"stDeckGlJsonChart",height:U,children:[zt?Yc.jsx(lct,{}):null,Yc.jsx(pU,{isFullScreen:h,disableFullscreenMode:i,onExpand:A,onCollapse:_,target:$D,locked:N&&!t?!0:void 0,children:N&&!t&&Yc.jsx(AU,{label:"Clear selection",onClick:Lt,icon:fU})}),Q&&Yc.jsxs(LY,{viewState:Q,onViewStateChange:j,height:U,width:pt,layers:Gt?L.layers:L3t,getTooltip:C,ContextProvider:lf.Provider,controller:!0,onClick:H&&!t?lt:void 0,children:[Yc.jsx(Kl,{height:U,width:pt,mapStyle:L.mapStyle&&(typeof L.mapStyle=="string"?L.mapStyle:L.mapStyle[0]),mapboxApiAccessToken:$}),Yc.jsx(uct,{children:Yc.jsx(oct,{"data-testid":"stDeckGlJsonChartZoomButton",showCompass:!1})})]})]})},k3t=dU(F3t),N3t=Te.memo(k3t);export{N3t as default};
