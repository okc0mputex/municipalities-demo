<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>stlite + Streamlit</title>
    
    <style>
      html, body, #root { height: 100%; margin: 0; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      import { mount } from "https://cdn.jsdelivr.net/npm/@stlite/mount@latest/+esm";

      const rootEl = document.getElementById("root");

      async function loadFileAsArrayBuffer(path) {
        const res = await fetch(path);
        if (!res.ok) return null;
        return await res.arrayBuffer();
      }

      async function main() {
        const code = await fetch("app.py").then(r => r.text());

        // Preload cleaned CSVs into the in-browser filesystem for immediate use
        const csvFilenames = [
          "Στοιχεία Συμβάσεων_Demo Έκδοση__Raw_Data.csv",
          "Στοιχεία Συμβάσεων_Demo Έκδοση__Widget_Γενική_Επισκόπηση.csv",
          "Στοιχεία Συμβάσεων_Demo Έκδοση__Widget_Συμβάσεις.csv",
          "Στοιχεία Συμβάσεων_Demo Έκδοση__Λίστα.csv",
        ];

        const files = {};
        for (const name of csvFilenames) {
          const buf = await loadFileAsArrayBuffer(`clean_csv/${encodeURIComponent(name)}`);
          if (buf) {
            // Place under clean_csv/ so Path("clean_csv").glob("*.csv") works in app.py
            files[`clean_csv/${name}`] = new Uint8Array(buf);
          }
        }

        mount(
          {
            code,
            // streamlit, pandas, numpy come via Pyodide; add extra pure-Python deps if needed
            requirements: ["plotly", "openpyxl"],
            files,
          },
          rootEl
        );
      }

      main();
    </script>
  </body>
  </html>

